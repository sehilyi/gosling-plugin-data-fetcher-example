/*! For license information please see main.ce22009c.chunk.js.LICENSE.txt */
(this["webpackJsonpgosling-plugin-datafetcher-example"]=this["webpackJsonpgosling-plugin-datafetcher-example"]||[]).push([[0],{201:function(I,g,C){"use strict";(function(I,A){C.d(g,"a",(function(){return Am}));var i=C(14),e=C(31),l=C(13),o=C(10),t=C(16),c=C(17),n=C(32),d=C(21),s=C(18),a=C(28),Z=C(29),m=C(2),b=C(11),r=C(9),h=C(129),G=C(43),u=C(138),y=C(108),B=C(137),V=C(135),p=C(219),X=C(205),W=C(38),H=C(350),Y=C(353),R=C(136),f=C(217),K=C(22),w=C(167),J=C(348),S=C(349),F=C(218),N=C(340),v=C(351),k=C(341),D=C(342),z=C(343),M=C(344),U=C(345),x=C(346),T=C(53),Q=C(166),P=C(207),O=C.n(P),j=C(352),L=C(347),E=C(70),_=C.n(E),$=C(212),q=C(134),II=C(120),gI=C.n(II),CI=C(160),AI=C.n(CI),iI=C(106),eI=C(220),lI=C(15),oI=C.n(lI),tI=(C(116),C(208)),cI={$ref:"#/definitions/GoslingSpec",$schema:"http://json-schema.org/draft-07/schema#",definitions:{Aggregate:{enum:["max","min","mean","bin","count"],type:"string"},Assembly:{enum:["hg38","hg19","hg18","hg17","hg16","mm10","mm9","unknown"],type:"string"},AxisPosition:{enum:["none","top","bottom","left","right"],type:"string"},BAMData:{additionalProperties:!1,description:"Binary Alignment Map (BAM) is the comprehensive raw data of genome sequencing; it consists of the lossless, compressed binary representation of the Sequence Alignment Map-files.",properties:{extractJunction:{description:"Determine whether to extract exon-to-exon junctions. __Default__: `false`",type:"boolean"},indexUrl:{description:"URL link to the index file of the BAM file",type:"string"},junctionMinCoverage:{description:"Determine the threshold of coverage when extracting exon-to-exon junctions. __Default__: `1`",type:"number"},loadMates:{description:"Load mates that are located in the same chromosome. __Default__: `false`",type:"boolean"},maxInsertSize:{description:"Determines the threshold of insert sizes for determining the structural variants. __Default__: `5000`",type:"number"},type:{const:"bam",type:"string"},url:{description:"URL link to the BAM data file",type:"string"}},required:["type","url","indexUrl"],type:"object"},BEDDBData:{additionalProperties:!1,description:"Regular BED or similar files can be pre-aggregated for the scalable data exploration. Find our more about this format at [HiGlass Docs](https://docs.higlass.io/data_preparation.html#bed-files).",properties:{exonIntervalFields:{description:"experimental",items:[{additionalProperties:!1,properties:{index:{type:"number"},name:{type:"string"}},required:["index","name"],type:"object"},{additionalProperties:!1,properties:{index:{type:"number"},name:{type:"string"}},required:["index","name"],type:"object"}],maxItems:2,minItems:2,type:"array"},genomicFields:{description:"Specify the name of genomic data fields.",items:{additionalProperties:!1,properties:{index:{type:"number"},name:{type:"string"}},required:["index","name"],type:"object"},type:"array"},type:{const:"beddb",type:"string"},url:{description:"Specify the URL address of the data file.",type:"string"},valueFields:{description:"Specify the column indexes, field names, and field types.",items:{additionalProperties:!1,properties:{index:{type:"number"},name:{type:"string"},type:{enum:["nominal","quantitative"],type:"string"}},required:["index","name","type"],type:"object"},type:"array"}},required:["type","url","genomicFields"],type:"object"},BIGWIGData:{additionalProperties:!1,properties:{aggregation:{$ref:"#/definitions/BinAggregate",description:'Determine aggregation function to apply within bins. __Default__: `"mean"`'},binSize:{description:"Binning the genomic interval in tiles (unit size: 256).",type:"number"},column:{description:"Assign a field name of the middle position of genomic intervals.",type:"string"},end:{description:"Assign a field name of the end position of genomic intervals.",type:"string"},start:{description:"Assign a field name of the start position of genomic intervals.",type:"string"},type:{const:"bigwig",type:"string"},url:{description:"Specify the URL address of the data file.",type:"string"},value:{description:"Assign a field name of quantitative values.",type:"string"}},required:["type","url","column","value"],type:"object"},BinAggregate:{enum:["mean","sum"],type:"string"},CSVData:{additionalProperties:!1,description:'Any small enough tabular data files, such as tsv, csv, BED, BEDPE, and GFF, can be loaded using "csv" data specification.',properties:{chromosomeField:{description:"Specify the name of chromosome data fields.",type:"string"},chromosomePrefix:{description:"experimental",type:"string"},genomicFields:{description:"Specify the name of genomic data fields.",items:{type:"string"},type:"array"},genomicFieldsToConvert:{description:"experimental",items:{additionalProperties:!1,properties:{chromosomeField:{type:"string"},genomicFields:{items:{type:"string"},type:"array"}},required:["chromosomeField","genomicFields"],type:"object"},type:"array"},headerNames:{description:"Specify the names of data fields if a CSV file does not contain a header.",items:{type:"string"},type:"array"},longToWideId:{description:"experimental",type:"string"},sampleLength:{description:"Specify the number of rows loaded from the URL.\n\n__Default:__ `1000`",type:"number"},separator:{description:"Specify file separator, __Default:__ ','",type:"string"},type:{const:"csv",type:"string"},url:{description:"Specify the URL address of the data file.",type:"string"}},required:["type","url"],type:"object"},Channel:{anyOf:[{$ref:"#/definitions/ChannelDeep"},{$ref:"#/definitions/ChannelValue"}]},ChannelDeep:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/Y"},{$ref:"#/definitions/Row"},{$ref:"#/definitions/Color"},{$ref:"#/definitions/Size"},{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/Text"}]},ChannelValue:{additionalProperties:!1,properties:{value:{description:"Assign a constant value for a visual channel.",type:["number","string"]}},required:["value"],type:"object"},Chromosome:{enum:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","X","Y","M","chr1","chr2","chr3","chr4","chr5","chr6","chr7","chr8","chr9","chr10","chr11","chr12","chr13","chr14","chr15","chr16","chr17","chr18","chr19","chr20","chr21","chr22","chrX","chrY","chrM"],type:"string"},Color:{additionalProperties:!1,properties:{domain:{$ref:"#/definitions/ValueExtent",description:"Values of the data"},field:{description:"Name of the data field",type:"string"},legend:{description:"Whether to display legend. __Default__: `false`",type:"boolean"},range:{$ref:"#/definitions/Range",description:"Determine the colors that should be bound to data value. Default properties are determined considering the field type."},scale:{enum:["linear","log"],type:"string"},scaleOffset:{description:"Whether to use offset of the domain proportionally. This is bound to brushes on the color legend. __Default__: `[0, 1]`",items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,type:"array"},title:{description:"Title of the legend. __Default__: `undefined`",type:"string"},type:{description:"Specify the data type",enum:["quantitative","nominal"],type:"string"}},type:"object"},CoverageTransform:{additionalProperties:!1,description:"Aggregate rows and calculate coverage",properties:{endField:{type:"string"},groupField:{description:"The name of a nominal field to group rows by in prior to piling-up",type:"string"},newField:{type:"string"},startField:{type:"string"},type:{const:"coverage",type:"string"}},required:["type","startField","endField"],type:"object"},DataDeep:{anyOf:[{$ref:"#/definitions/JSONData"},{$ref:"#/definitions/CSVData"},{$ref:"#/definitions/BIGWIGData"},{$ref:"#/definitions/MultivecData"},{$ref:"#/definitions/BEDDBData"},{$ref:"#/definitions/VectorData"},{$ref:"#/definitions/MatrixData"},{$ref:"#/definitions/BAMData"},{$ref:"#/definitions/VCFData"},{$ref:"#/definitions/PluginData"}]},DataTrack:{additionalProperties:!1,description:"Partial specification of `BasicSingleTrack` to use default visual encoding predefined by data type.",properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},data:{$ref:"#/definitions/DataDeep"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},width:{description:"Specify the track width in pixels.",type:"number"},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["data","height","width"],type:"object"},DataTransform:{anyOf:[{$ref:"#/definitions/FilterTransform"},{$ref:"#/definitions/StrConcatTransform"},{$ref:"#/definitions/StrReplaceTransform"},{$ref:"#/definitions/LogTransform"},{$ref:"#/definitions/DisplaceTransform"},{$ref:"#/definitions/ExonSplitTransform"},{$ref:"#/definitions/GenomicLengthTransform"},{$ref:"#/definitions/SvTypeTransform"},{$ref:"#/definitions/CoverageTransform"},{$ref:"#/definitions/JSONParseTransform"}]},Datum:{additionalProperties:{type:["number","string"]},description:"Values in the form of JSON.",type:"object"},DisplaceTransform:{additionalProperties:!1,properties:{boundingBox:{additionalProperties:!1,properties:{endField:{description:"The name of a quantitative field that represents the end position.",type:"string"},groupField:{description:"The name of a nominal field to group rows by in prior to piling-up.",type:"string"},isPaddingBP:{description:"Whether to consider `padding` as the bp length.",type:"boolean"},padding:{description:"The padding around visual lements. Either px or bp",type:"number"},startField:{description:"The name of a quantitative field that represents the start position.",type:"string"}},required:["startField","endField"],type:"object"},maxRows:{description:"Specify maximum rows to be generated (default has no limit).",type:"number"},method:{$ref:"#/definitions/DisplacementType",description:"A string that specifies the type of displacement."},newField:{type:"string"},type:{const:"displace",type:"string"}},required:["type","boundingBox","method","newField"],type:"object"},Displacement:{additionalProperties:!1,properties:{padding:{type:"number"},type:{$ref:"#/definitions/DisplacementType"}},required:["type"],type:"object"},DisplacementType:{enum:["pile","spread"],type:"string"},DomainChr:{additionalProperties:!1,properties:{chromosome:{$ref:"#/definitions/Chromosome"}},required:["chromosome"],type:"object"},DomainChrInterval:{additionalProperties:!1,properties:{chromosome:{$ref:"#/definitions/Chromosome",description:"If specified, only showing a certain interval in a chromosome."},interval:{items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,type:"array"}},required:["chromosome","interval"],type:"object"},DomainGene:{additionalProperties:!1,properties:{gene:{anyOf:[{type:"string"},{items:[{type:"string"},{type:"string"}],maxItems:2,minItems:2,type:"array"}]}},required:["gene"],type:"object"},DomainInterval:{additionalProperties:!1,properties:{interval:{description:"Show a certain interval within entire chromosome",items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,type:"array"}},required:["interval"],type:"object"},EventStyle:{additionalProperties:!1,description:"The styles defined here will be applied to the target marks of mouse events, such as a point mark after the user clicks on it.",properties:{arrange:{description:"Show event effects behind or in front of marks.",enum:["behind","front"],type:"string"},color:{description:"color of the marks when mouse events are triggered",type:"string"},opacity:{description:"opacity of the marks when mouse events are triggered",type:"number"},stroke:{description:"stroke color of the marks when mouse events are triggered",type:"string"},strokeOpacity:{type:"number"},strokeWidth:{description:"stroke width of the marks when mouse events are triggered",type:"number"}},type:"object"},ExonSplitTransform:{additionalProperties:!1,properties:{fields:{items:{additionalProperties:!1,properties:{chrField:{type:"string"},field:{type:"string"},newField:{type:"string"},type:{$ref:"#/definitions/FieldType"}},required:["field","type","newField","chrField"],type:"object"},type:"array"},flag:{additionalProperties:!1,properties:{field:{type:"string"},value:{type:["number","string"]}},required:["field","value"],type:"object"},separator:{type:"string"},type:{const:"exonSplit",type:"string"}},required:["type","separator","flag","fields"],type:"object"},FieldType:{enum:["genomic","nominal","quantitative"],type:"string"},FilterTransform:{anyOf:[{$ref:"#/definitions/OneOfFilter"},{$ref:"#/definitions/RangeFilter"},{$ref:"#/definitions/IncludeFilter"}]},GenomicDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"},{$ref:"#/definitions/DomainGene"}]},GenomicLengthTransform:{additionalProperties:!1,description:"Calculate genomic length using two genomic fields",properties:{endField:{type:"string"},newField:{type:"string"},startField:{type:"string"},type:{const:"genomicLength",type:"string"}},required:["type","startField","endField","newField"],type:"object"},GoslingSpec:{anyOf:[{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{const:"overlay",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},description:{type:"string"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},responsiveSize:{$ref:"#/definitions/ResponsiveSize",description:"Determine whether to make the size of `GoslingComponent` bound to its parent element. __Default__: `false`"},responsiveSpec:{items:{additionalProperties:!1,properties:{selectivity:{items:{$ref:"#/definitions/SelectivityCondition"},type:"array"},spec:{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{enum:["overlay","stack"],type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{anyOf:[{items:{$ref:"#/definitions/PartialTrack"},type:"array"},{items:{anyOf:[{$ref:"#/definitions/PartialTrack"},{$ref:"#/definitions/OverlaidTracks"}]},type:"array"}]},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},type:"object"}},required:["spec","selectivity"],type:"object"},type:"array"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{items:{$ref:"#/definitions/PartialTrack"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["alignment","height","tracks","width"],type:"object"},{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{const:"stack",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},description:{type:"string"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},responsiveSize:{$ref:"#/definitions/ResponsiveSize",description:"Determine whether to make the size of `GoslingComponent` bound to its parent element. __Default__: `false`"},responsiveSpec:{items:{additionalProperties:!1,properties:{selectivity:{items:{$ref:"#/definitions/SelectivityCondition"},type:"array"},spec:{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{enum:["overlay","stack"],type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{anyOf:[{items:{$ref:"#/definitions/PartialTrack"},type:"array"},{items:{anyOf:[{$ref:"#/definitions/PartialTrack"},{$ref:"#/definitions/OverlaidTracks"}]},type:"array"}]},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},type:"object"}},required:["spec","selectivity"],type:"object"},type:"array"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{items:{anyOf:[{$ref:"#/definitions/PartialTrack"},{$ref:"#/definitions/OverlaidTracks"}]},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["tracks"],type:"object"},{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},description:{type:"string"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},responsiveSize:{$ref:"#/definitions/ResponsiveSize",description:"Determine whether to make the size of `GoslingComponent` bound to its parent element. __Default__: `false`"},responsiveSpec:{items:{additionalProperties:!1,properties:{selectivity:{items:{$ref:"#/definitions/SelectivityCondition"},type:"array"},spec:{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{enum:["overlay","stack"],type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{anyOf:[{items:{$ref:"#/definitions/PartialTrack"},type:"array"},{items:{anyOf:[{$ref:"#/definitions/PartialTrack"},{$ref:"#/definitions/OverlaidTracks"}]},type:"array"}]},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},type:"object"}},required:["spec","selectivity"],type:"object"},type:"array"},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},title:{type:"string"},tracks:{items:{$ref:"#/definitions/Track"},type:"array"},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["tracks"],type:"object"},{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},arrangement:{description:"Specify how multiple views are arranged.",enum:["parallel","serial","horizontal","vertical"],type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},description:{type:"string"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},responsiveSize:{$ref:"#/definitions/ResponsiveSize",description:"Determine whether to make the size of `GoslingComponent` bound to its parent element. __Default__: `false`"},responsiveSpec:{items:{additionalProperties:!1,properties:{selectivity:{items:{$ref:"#/definitions/SelectivityCondition"},type:"array"},spec:{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},arrangement:{description:"Specify how multiple views are arranged.",enum:["parallel","serial","horizontal","vertical"],type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},views:{description:"An array of view specifications",items:{anyOf:[{$ref:"#/definitions/SingleView"},{$ref:"#/definitions/MultipleViews"}]},type:"array"},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},type:"object"}},required:["spec","selectivity"],type:"object"},type:"array"},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},title:{type:"string"},views:{description:"An array of view specifications",items:{anyOf:[{$ref:"#/definitions/SingleView"},{$ref:"#/definitions/MultipleViews"}]},type:"array"},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["views"],type:"object"}]},IncludeFilter:{additionalProperties:!1,properties:{field:{description:"A filter is applied based on the values of the specified data field",type:"string"},include:{description:"Check whether the value includes a substring.",type:"string"},not:{description:'when `{"not": true}`, apply a NOT logical operation to the filter.\n\n__Default:__ `false`',type:"boolean"},type:{const:"filter",type:"string"}},required:["field","include","type"],type:"object"},JSONData:{additionalProperties:!1,description:"The JSON data format allows users to include data directly in the Gosling's JSON specification.",properties:{chromosomeField:{description:"Specify the name of chromosome data fields.",type:"string"},genomicFields:{description:"Specify the name of genomic data fields.",items:{type:"string"},type:"array"},genomicFieldsToConvert:{description:"experimental",items:{additionalProperties:!1,properties:{chromosomeField:{type:"string"},genomicFields:{items:{type:"string"},type:"array"}},required:["chromosomeField","genomicFields"],type:"object"},type:"array"},sampleLength:{description:"Specify the number of rows loaded from the URL.\n\n__Default:__ `1000`",type:"number"},type:{const:"json",description:"Define data type.",type:"string"},values:{description:"Values in the form of JSON.",items:{$ref:"#/definitions/Datum"},type:"array"}},required:["type","values"],type:"object"},JSONParseTransform:{additionalProperties:!1,description:"Parse JSON Object Array and append vertically",properties:{baseGenomicField:{description:"Base genomic position when parsing relative position.",type:"string"},field:{description:"The field that contains the JSON object array.",type:"string"},genomicField:{description:"Relative genomic position to parse.",type:"string"},genomicLengthField:{description:"Length of genomic interval.",type:"string"},type:{const:"subjson",type:"string"}},required:["type","field","baseGenomicField","genomicField","genomicLengthField"],type:"object"},Layout:{enum:["linear","circular"],type:"string"},LogBase:{anyOf:[{type:"number"},{const:"e",type:"string"}]},LogTransform:{additionalProperties:!1,properties:{base:{$ref:"#/definitions/LogBase",description:"If not specified, 10 is used."},field:{type:"string"},newField:{description:"If specified, store transformed values in a new field.",type:"string"},type:{const:"log",type:"string"}},required:["type","field"],type:"object"},LogicalOperation:{enum:["less-than","lt","LT","greater-than","gt","GT","less-than-or-equal-to","ltet","LTET","greater-than-or-equal-to","gtet","GTET"],type:"string"},Mark:{enum:["point","line","area","bar","rect","text","withinLink","betweenLink","rule","triangleLeft","triangleRight","triangleBottom","brush","header"],type:"string"},MatrixData:{additionalProperties:!1,properties:{binSize:{description:"Determine the number of nearby cells to aggregate. __Default__: `1`",type:"number"},column:{description:"The name of the first genomic field. __Default__: `x`",type:"string"},row:{description:"The name of the first genomic field. __Default__: `y`",type:"string"},type:{const:"matrix",type:"string"},url:{description:"URL link to the matrix data file",type:"string"},value:{description:"The name of the value field. __Default__: `value`",type:"string"}},required:["type","url"],type:"object"},MouseEventsDeep:{additionalProperties:!1,properties:{click:{type:"boolean"},enableMouseOverOnMultipleMarks:{description:"Determine whether all marks underneath the mouse point should be affected by mouse over. __Default__: `false`",type:"boolean"},groupMarksByField:{description:"Group marks using keys in a data field. This affects how a set of marks are highlighted/selected by interaction. __Default__: `undefined`",type:"string"},mouseOver:{type:"boolean"},rangeSelect:{type:"boolean"}},type:"object"},MultipleViews:{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},arrangement:{description:"Specify how multiple views are arranged.",enum:["parallel","serial","horizontal","vertical"],type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},views:{description:"An array of view specifications",items:{anyOf:[{$ref:"#/definitions/SingleView"},{$ref:"#/definitions/MultipleViews"}]},type:"array"},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["views"],type:"object"},MultivecData:{additionalProperties:!1,description:'Two-dimensional quantitative values, one axis for genomic coordinate and the other for different samples, can be converted into HiGlass\' `"multivec"` data. For example, multiple BigWig files can be converted into a single multivec file. You can also convert sequence data (FASTA) into this format where rows will be different nucleotide bases (e.g., A, T, G, C) and quantitative values represent the frequency. Find out more about this format at [HiGlass Docs](https://docs.higlass.io/data_preparation.html#multivec-files).',properties:{aggregation:{$ref:"#/definitions/BinAggregate",description:'Determine aggregation function to apply within bins. __Default__: `"mean"`'},binSize:{description:"Binning the genomic interval in tiles (unit size: 256).",type:"number"},categories:{description:"assign names of individual samples.",items:{type:"string"},type:"array"},column:{description:"Assign a field name of the middle position of genomic intervals.",type:"string"},end:{description:"Assign a field name of the end position of genomic intervals.",type:"string"},row:{description:"Assign a field name of samples.",type:"string"},start:{description:"Assign a field name of the start position of genomic intervals.",type:"string"},type:{const:"multivec",type:"string"},url:{description:"Specify the URL address of the data file.",type:"string"},value:{description:"Assign a field name of quantitative values.",type:"string"}},required:["type","url","column","row","value"],type:"object"},OneOfFilter:{additionalProperties:!1,properties:{field:{description:"A filter is applied based on the values of the specified data field",type:"string"},not:{description:'when `{"not": true}`, apply a NOT logical operation to the filter.\n\n__Default:__ `false`',type:"boolean"},oneOf:{anyOf:[{items:{type:"string"},type:"array"},{items:{type:"number"},type:"array"}],description:"Check whether the value is an element in the provided list."},type:{const:"filter",type:"string"}},required:["field","oneOf","type"],type:"object"},Opacity:{additionalProperties:!1,properties:{domain:{$ref:"#/definitions/ValueExtent",description:"Values of the data"},field:{description:"Name of the data field",type:"string"},range:{$ref:"#/definitions/ValueExtent",description:"Ranges of visual channel values"},type:{description:"Specify the data type",enum:["quantitative","nominal"],type:"string"}},type:"object"},Orientation:{enum:["horizontal","vertical"],type:"string"},OverlaidTrack:{additionalProperties:!1,description:"Superposing multiple tracks.",properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlay:{items:{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},type:"object"},type:"array"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["height","overlay","width"],type:"object"},OverlaidTracks:{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{const:"overlay",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{items:{$ref:"#/definitions/PartialTrack"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["alignment","tracks","width","height"],type:"object"},PartialTrack:{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},encoding:{additionalProperties:{$ref:"#/definitions/Channel"},type:"object"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlay:{items:{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},type:"object"},type:"array"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},template:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},type:"object"},PluginData:{additionalProperties:!1,description:"A data spec to use plugin data fetcher that are defined externally",properties:{name:{description:"The name of the plugin data that should match the `type` of a plugin data fetcher",type:"string"},options:{description:"All custom options used in the plugin data fetcher",type:"object"},type:{const:"experimentalPlugin",type:"string"}},required:["type","name","options"],type:"object"},PredefinedColors:{enum:["viridis","grey","spectral","warm","cividis","bupu","rdbu","hot","pink"],type:"string"},Range:{anyOf:[{$ref:"#/definitions/ValueExtent"},{$ref:"#/definitions/PredefinedColors"}]},RangeFilter:{additionalProperties:!1,properties:{field:{description:"A filter is applied based on the values of the specified data field",type:"string"},inRange:{description:"Check whether the value is in a number range.",items:{type:"number"},type:"array"},not:{description:'when `{"not": true}`, apply a NOT logical operation to the filter.\n\n__Default:__ `false`',type:"boolean"},type:{const:"filter",type:"string"}},required:["field","inRange","type"],type:"object"},ResponsiveSize:{anyOf:[{type:"boolean"},{additionalProperties:!1,properties:{height:{type:"boolean"},width:{type:"boolean"}},type:"object"}]},Row:{additionalProperties:!1,properties:{clip:{description:"Clip row when the actual y value exceeds the max value of the y scale. Used only for bar marks at the moment. __Default__: `true`",type:"boolean"},domain:{$ref:"#/definitions/ValueExtent",description:"Values of the data"},field:{description:"Name of the data field",type:"string"},grid:{description:"Whether to display grid. __Default__: `false`",type:"boolean"},legend:{description:"Whether to display legend. __Default__: `false`",type:"boolean"},padding:{description:"Determines the size of inner white spaces on the top and bottom of individiual rows. __Default__: `0`",type:"number"},range:{$ref:"#/definitions/ValueExtent",description:"Determine the start and end position of rendering area of this track along vertical axis. __Default__: `[0, height]`"},type:{const:"nominal",description:"Specify the data type",type:"string"}},type:"object"},SelectivityCondition:{additionalProperties:!1,properties:{measure:{enum:["width","height","aspectRatio"],type:"string"},operation:{$ref:"#/definitions/LogicalOperation"},target:{description:"Does the condition applied to the visualization itself or its container? __Default__: `'self'`",enum:["self","container"],type:"string"},threshold:{description:"Threshold in the unit of pixels.",type:"number"}},required:["operation","measure","threshold"],type:"object"},SingleTrack:{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["data","height","mark","width"],type:"object"},SingleView:{anyOf:[{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{const:"overlay",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},responsiveSpec:{items:{additionalProperties:!1,properties:{selectivity:{items:{$ref:"#/definitions/SelectivityCondition"},type:"array"},spec:{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{enum:["overlay","stack"],type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{anyOf:[{items:{$ref:"#/definitions/PartialTrack"},type:"array"},{items:{anyOf:[{$ref:"#/definitions/PartialTrack"},{$ref:"#/definitions/OverlaidTracks"}]},type:"array"}]},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},type:"object"}},required:["spec","selectivity"],type:"object"},type:"array"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{items:{$ref:"#/definitions/PartialTrack"},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["alignment","height","tracks","width"],type:"object"},{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{const:"stack",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},responsiveSpec:{items:{additionalProperties:!1,properties:{selectivity:{items:{$ref:"#/definitions/SelectivityCondition"},type:"array"},spec:{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{enum:["overlay","stack"],type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{anyOf:[{items:{$ref:"#/definitions/PartialTrack"},type:"array"},{items:{anyOf:[{$ref:"#/definitions/PartialTrack"},{$ref:"#/definitions/OverlaidTracks"}]},type:"array"}]},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},type:"object"}},required:["spec","selectivity"],type:"object"},type:"array"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{items:{anyOf:[{$ref:"#/definitions/PartialTrack"},{$ref:"#/definitions/OverlaidTracks"}]},type:"array"},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["tracks"],type:"object"},{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},responsiveSpec:{items:{additionalProperties:!1,properties:{selectivity:{items:{$ref:"#/definitions/SelectivityCondition"},type:"array"},spec:{additionalProperties:!1,properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},alignment:{enum:["overlay","stack"],type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},baselineY:{type:"number"},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},color:{anyOf:[{$ref:"#/definitions/Color"},{$ref:"#/definitions/ChannelValue"}]},data:{$ref:"#/definitions/DataDeep"},dataTransform:{items:{$ref:"#/definitions/DataTransform"},type:"array"},displacement:{$ref:"#/definitions/Displacement"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},experimental:{additionalProperties:!1,properties:{mouseEvents:{anyOf:[{type:"boolean"},{$ref:"#/definitions/MouseEventsDeep"}]}},type:"object"},flipY:{type:"boolean"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},mark:{$ref:"#/definitions/Mark"},opacity:{anyOf:[{$ref:"#/definitions/Opacity"},{$ref:"#/definitions/ChannelValue"}]},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},overrideTemplate:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},row:{anyOf:[{$ref:"#/definitions/Row"},{$ref:"#/definitions/ChannelValue"}]},size:{anyOf:[{$ref:"#/definitions/Size"},{$ref:"#/definitions/ChannelValue"}]},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},stretch:{type:"boolean"},stroke:{anyOf:[{$ref:"#/definitions/Stroke"},{$ref:"#/definitions/ChannelValue"}]},strokeWidth:{anyOf:[{$ref:"#/definitions/StrokeWidth"},{$ref:"#/definitions/ChannelValue"}]},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},text:{anyOf:[{$ref:"#/definitions/Text"},{$ref:"#/definitions/ChannelValue"}]},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},tooltip:{items:{$ref:"#/definitions/Tooltip"},type:"array"},tracks:{anyOf:[{items:{$ref:"#/definitions/PartialTrack"},type:"array"},{items:{anyOf:[{$ref:"#/definitions/PartialTrack"},{$ref:"#/definitions/OverlaidTracks"}]},type:"array"}]},visibility:{items:{$ref:"#/definitions/VisibilityCondition"},type:"array"},width:{description:"Specify the track width in pixels.",type:"number"},x:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},x1e:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},xe:{anyOf:[{$ref:"#/definitions/X"},{$ref:"#/definitions/ChannelValue"}]},y:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},y1e:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},ye:{anyOf:[{$ref:"#/definitions/Y"},{$ref:"#/definitions/ChannelValue"}]},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},type:"object"}},required:["spec","selectivity"],type:"object"},type:"array"},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},tracks:{items:{$ref:"#/definitions/Track"},type:"array"},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["tracks"],type:"object"}]},Size:{additionalProperties:!1,properties:{domain:{$ref:"#/definitions/ValueExtent",description:"Values of the data"},field:{description:"Name of the data field",type:"string"},legend:{description:"not supported: Whether to display legend. __Default__: `false`",type:"boolean"},range:{$ref:"#/definitions/ValueExtent",description:"Ranges of visual channel values"},type:{description:"Specify the data type",enum:["quantitative","nominal"],type:"string"}},type:"object"},SizeVisibilityCondition:{additionalProperties:!1,properties:{conditionPadding:{description:"Specify the buffer size (in pixel) of width or height when calculating the visibility.\n\n__Default__: `0`",type:"number"},measure:{description:"Specify which aspect of the `target` will be compared to the `threshold`.",enum:["width","height"],type:"string"},operation:{$ref:"#/definitions/LogicalOperation",description:'A string that specifies the logical operation to conduct between `threshold` and the `measure` of `target`. Support\n\n- greater than : "greater-than", "gt", "GT"\n\n- less than : "less-than", "lt", "LT"\n\n- greater than or equal to : "greater-than-or-equal-to", "gtet", "GTET"\n\n- less than or equal to : "less-than-or-equal-to", "ltet", "LTET"'},target:{description:"Target specifies the object that you want to compare with the threshold.",enum:["track","mark"],type:"string"},threshold:{anyOf:[{type:"number"},{const:"|xe-x|",type:"string"}],description:'Specify the threshold as one of:\n\n- A number representing a fixed threshold in the unit of pixels;\n\n- `"|xe-x|"`, using the distance between `xe` and `x` as threshold'},transitionPadding:{description:"Specify the buffer size (in pixel) of width or height for smooth transition.\n\n__Default__: `0`",type:"number"}},required:["measure","operation","target","threshold"],type:"object"},StrConcatTransform:{additionalProperties:!1,properties:{fields:{items:{type:"string"},type:"array"},newField:{type:"string"},separator:{type:"string"},type:{const:"concat",type:"string"}},required:["type","fields","newField","separator"],type:"object"},StrReplaceTransform:{additionalProperties:!1,properties:{field:{type:"string"},newField:{type:"string"},replace:{items:{additionalProperties:!1,properties:{from:{type:"string"},to:{type:"string"}},required:["from","to"],type:"object"},type:"array"},type:{const:"replace",type:"string"}},required:["type","field","newField","replace"],type:"object"},Stroke:{additionalProperties:!1,properties:{domain:{$ref:"#/definitions/ValueExtent",description:"Values of the data"},field:{description:"Name of the data field",type:"string"},legend:{description:"Whether to display legend. __Default__: `false`",type:"boolean"},range:{$ref:"#/definitions/Range",description:"Ranges of visual channel values"},scaleOffset:{description:"Whether to use offset of the domain proportionally. This is bound to brushes on the color legend. __Default__: `[0, 1]`",items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,type:"array"},title:{description:"Title of the legend. __Default__: `undefined`",type:"string"},type:{description:"Specify the data type",enum:["quantitative","nominal"],type:"string"}},type:"object"},StrokeWidth:{additionalProperties:!1,properties:{domain:{$ref:"#/definitions/ValueExtent",description:"Values of the data"},field:{description:"Name of the data field",type:"string"},range:{$ref:"#/definitions/ValueExtent",description:"Ranges of visual channel values"},type:{description:"Specify the data type",enum:["quantitative","nominal"],type:"string"}},type:"object"},Style:{additionalProperties:!1,properties:{align:{description:"Specify the alignment of marks. This property is currently only supported for `triangle` marks.",enum:["left","right"],type:"string"},background:{type:"string"},backgroundOpacity:{type:"number"},brush:{additionalProperties:!1,description:"Customize the style of the brush mark in the `rangeSelect` mouse event.",properties:{color:{description:"color of the marks when mouse events are triggered",type:"string"},opacity:{description:"opacity of the marks when mouse events are triggered",type:"number"},stroke:{description:"stroke color of the marks when mouse events are triggered",type:"string"},strokeOpacity:{type:"number"},strokeWidth:{description:"stroke width of the marks when mouse events are triggered",type:"number"}},type:"object"},curve:{description:"Specify the curve of `rule` marks.",enum:["top","bottom","left","right"],type:"string"},dashed:{description:"Specify the pattern of dashes and gaps for `rule` marks.",items:[{type:"number"},{type:"number"}],maxItems:2,minItems:2,type:"array"},dx:{description:"Offset the position of marks in x direction. This property is currently only supported for `text` marks",type:"number"},dy:{description:"Offset the position of marks in y direction. This property is currently only supported for `text` marks.",type:"number"},enableSmoothPath:{description:"Whether to enable smooth paths when drawing curves.\n\n__Default__: `false`",type:"boolean"},inlineLegend:{description:"Specify whether to show legend in a single horizontal line?",type:"boolean"},legendTitle:{description:"If defined, show legend title on the top or left",type:"string"},linePattern:{additionalProperties:!1,description:"Specify the pattern of dashes and gaps for `rule` marks.",properties:{size:{type:"number"},type:{enum:["triangleLeft","triangleRight"],type:"string"}},required:["type","size"],type:"object"},linkConnectionType:{description:'Specify the connetion type of `betweenLink` marks.\n\n__Default__: `"corner"`',enum:["straight","curve","corner"],type:"string"},linkMinHeight:{description:"The minimum height of `withinLink` and `betweenLink` marks. Unit is a percentagle. __Default__: `0.5`",type:"number"},linkStyle:{description:"The style of `withinLink` and `betweenLink` marks. __Default__: `'circular'` `'elliptical'` will be used as a default option.",enum:["elliptical","circular","straight","experimentalEdgeBundling"],type:"string"},matrixExtent:{description:'Determine to show only one side of the diagonal in a HiGlass matrix. __Default__: `"full"`',enum:["full","upper-right","lower-left"],type:"string"},mouseOver:{$ref:"#/definitions/EventStyle",description:"Customize visual effects of `mouseOver` events on marks."},outline:{type:"string"},outlineWidth:{type:"number"},select:{$ref:"#/definitions/EventStyle",description:"Customize visual effects of `rangeSelect` events on marks ."},textAnchor:{description:"Specify the alignment of `text` marks to a given point.",enum:["start","middle","end"],type:"string"},textFontSize:{description:"Specify the font size of `text` marks. Can also be specified using the `size` channel option of `text` marks.",type:"number"},textFontWeight:{description:"Specify the font weight of `text` marks.",enum:["bold","normal"],type:"string"},textStroke:{description:"Specify the stroke of `text` marks. Can also be specified using the `stroke` channel option of `text` marks.",type:"string"},textStrokeWidth:{description:"Specify the stroke width of `text` marks. Can also be specified using the `strokeWidth` channel option of `text` marks.",type:"number"}},type:"object"},SvTypeTransform:{additionalProperties:!1,properties:{firstBp:{additionalProperties:!1,description:"Based on the BEDPE, infer SV types. SV types are specified as one of the following strings: DUP, TRA, DEL, t2tINV, h2hINV.",properties:{chrField:{type:"string"},posField:{type:"string"},strandField:{type:"string"}},required:["chrField","posField","strandField"],type:"object"},newField:{type:"string"},secondBp:{additionalProperties:!1,description:"Based on the BEDPE, infer SV types. SV types are specified as one of the following strings: DUP, TRA, DEL, t2tINV, h2hINV.",properties:{chrField:{type:"string"},posField:{type:"string"},strandField:{type:"string"}},required:["chrField","posField","strandField"],type:"object"},type:{const:"svType",type:"string"}},required:["type","firstBp","secondBp","newField"],type:"object"},TemplateTrack:{additionalProperties:!1,description:"Template specification that will be internally converted into `SingleTrack` for rendering.",properties:{_assignedHeight:{type:"number"},_assignedWidth:{description:"Internal: Used for responsive spec",type:"number"},_invalidTrack:{description:"internal",type:"boolean"},_renderingId:{description:"internal",type:"string"},assembly:{$ref:"#/definitions/Assembly",description:'A string that specifies the genome builds to use. Currently support `"hg38"`, `"hg19"`, `"hg18"`, `"hg17"`, `"hg16"`, `"mm10"`, `"mm9"`, and `"unknown"`.\n\n__Note:__: with `"unknown"` assembly, genomic axes do not show chrN: in labels.'},centerRadius:{description:"Proportion of the radius of the center white space.\n\n__Default:__ `0.3`",type:"number"},data:{$ref:"#/definitions/DataDeep"},encoding:{additionalProperties:{$ref:"#/definitions/Channel"},type:"object"},endAngle:{description:'Specify the end angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},height:{description:"Specify the track height in pixels.",type:"number"},id:{type:"string"},innerRadius:{description:'Specify the inner radius of tracks when (`{"layout": "circular"}`).',type:"number"},layout:{$ref:"#/definitions/Layout",description:"Specify the layout type of all tracks."},linkingId:{description:"Specify an ID for [linking multiple views](http://gosling-lang.org/docs/user-interaction#linking-views)",type:"string"},orientation:{$ref:"#/definitions/Orientation",description:"Specify the orientation."},outerRadius:{description:'Specify the outer radius of tracks when `{"layout": "circular"}`.',type:"number"},overlayOnPreviousTrack:{type:"boolean"},prerelease:{additionalProperties:!1,description:"internal",type:"object"},spacing:{description:'- If `{"layout": "linear"}`, specify the space between tracks in pixels;\n\n- If `{"layout": "circular"}`, specify the space between tracks in percentage ranging from 0 to 100.',type:"number"},startAngle:{description:'Specify the start angle (in the range of [0, 360]) of circular tracks (`{"layout": "circular"}`).',type:"number"},static:{description:"Whether to disable [Zooming and Panning](http://gosling-lang.org/docs/user-interaction#zooming-and-panning), __Default:__ `false`.",type:"boolean"},style:{$ref:"#/definitions/Style",description:"Define the [style](http://gosling-lang.org/docs/visual-channel#style-related-properties) of multive views. Will be overwritten by the style of children elements (e.g., view, track)."},subtitle:{type:"string"},template:{type:"string"},title:{description:"If defined, will show the textual label on the left-top corner of a track.",type:"string"},width:{description:"Specify the track width in pixels.",type:"number"},xAxis:{$ref:"#/definitions/AxisPosition",description:"not supported"},xDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic x-axis"},xOffset:{description:"Specify the x offset of views in the unit of pixels",type:"number"},yDomain:{anyOf:[{$ref:"#/definitions/DomainInterval"},{$ref:"#/definitions/DomainChrInterval"},{$ref:"#/definitions/DomainChr"}],description:"Specify the visible region of genomic y-axis"},yOffset:{description:"Specify the y offset of views in the unit of pixels",type:"number"},zoomLimits:{$ref:"#/definitions/ZoomLimits"}},required:["data","height","template","width"],type:"object"},Text:{additionalProperties:!1,properties:{domain:{description:"Values of the data",items:{type:"string"},type:"array"},field:{description:"Name of the data field",type:"string"},range:{description:"Ranges of visual channel values",items:{type:"string"},type:"array"},type:{description:"Specify the data type",enum:["quantitative","nominal"],type:"string"}},type:"object"},Tooltip:{additionalProperties:!1,properties:{alt:{description:"Name of the data field for showing in the tooltip. Will use the field name if not specified.",type:"string"},field:{description:"Specifiy a data field whose value will show in the tooltip.",type:"string"},format:{description:"format of the data value.",type:"string"},type:{$ref:"#/definitions/FieldType",description:"Type of the data field."}},required:["field","type"],type:"object"},Track:{anyOf:[{$ref:"#/definitions/SingleTrack"},{$ref:"#/definitions/OverlaidTrack"},{$ref:"#/definitions/DataTrack"},{$ref:"#/definitions/TemplateTrack"}]},VCFData:{additionalProperties:!1,description:"The Variant Call Format (VCF).",properties:{indexUrl:{description:"URL link to the tabix index file",type:"string"},sampleLength:{description:"The maximum number of rows to be loaded from the URL. __Default:__ `1000`",type:"number"},type:{const:"vcf",type:"string"},url:{description:"URL link to the VCF file",type:"string"}},required:["type","url","indexUrl"],type:"object"},ValueExtent:{anyOf:[{items:{type:"string"},type:"array"},{items:{type:"number"},type:"array"}]},VectorData:{additionalProperties:!1,description:'One-dimensional quantitative values along genomic position (e.g., bigwig) can be converted into HiGlass\' `"vector"` format data. Find out more about this format at [HiGlass Docs](https://docs.higlass.io/data_preparation.html#bigwig-files).',properties:{aggregation:{$ref:"#/definitions/BinAggregate",description:'Determine aggregation function to apply within bins. __Default__: `"mean"`'},binSize:{description:"Binning the genomic interval in tiles (unit size: 256).",type:"number"},column:{description:"Assign a field name of the middle position of genomic intervals.",type:"string"},end:{description:"Assign a field name of the end position of genomic intervals.",type:"string"},start:{description:"Assign a field name of the start position of genomic intervals.",type:"string"},type:{const:"vector",type:"string"},url:{description:"Specify the URL address of the data file.",type:"string"},value:{description:"Assign a field name of quantitative values.",type:"string"}},required:["type","url","column","value"],type:"object"},VisibilityCondition:{anyOf:[{$ref:"#/definitions/SizeVisibilityCondition"},{$ref:"#/definitions/ZoomLevelVisibilityCondition"}]},X:{additionalProperties:!1,properties:{aggregate:{$ref:"#/definitions/Aggregate",description:"Specify how to aggregate data. __Default__: `undefined`"},axis:{$ref:"#/definitions/AxisPosition",description:"Specify where should the axis be put"},domain:{$ref:"#/definitions/GenomicDomain",description:"Values of the data"},field:{description:"Name of the data field.",type:"string"},grid:{description:"Whether to display grid. __Default__: `false`",type:"boolean"},legend:{description:"Whether to display legend. __Default__: `false`",type:"boolean"},linkingId:{description:"Users need to assign a unique linkingId for [linking views](/docs/user-interaction#linking-views) and [Brushing and Linking](/docs/user-interaction#brushing-and-linking)",type:"string"},range:{$ref:"#/definitions/ValueExtent",description:"Values of the visual channel."},type:{const:"genomic",description:"Specify the data type.",type:"string"}},type:"object"},Y:{additionalProperties:!1,properties:{aggregate:{$ref:"#/definitions/Aggregate",description:"Specify how to aggregate data. __Default__: `undefined`"},axis:{$ref:"#/definitions/AxisPosition",description:"Specify where should the axis be put"},baseline:{description:"Custom baseline of the y-axis. __Default__: `0`",type:["string","number"]},domain:{anyOf:[{$ref:"#/definitions/ValueExtent"},{$ref:"#/definitions/GenomicDomain"}],description:"Values of the data"},field:{description:"Name of the data field.",type:"string"},flip:{description:"Whether to flip the y-axis. This is done by inverting the `range` property. __Default__: `false`",type:"boolean"},grid:{description:"Whether to display grid. __Default__: `false`",type:"boolean"},legend:{description:"Whether to display legend. __Default__: `false`",type:"boolean"},linkingId:{description:"Users need to assign a unique linkingId for [linking views](/docs/user-interaction#linking-views) and [Brushing and Linking](/docs/user-interaction#brushing-and-linking)",type:"string"},range:{$ref:"#/definitions/ValueExtent",description:"Values of the visual channel."},type:{description:"Specify the data type.",enum:["quantitative","nominal","genomic"],type:"string"},zeroBaseline:{description:"Specify whether to use zero baseline. __Default__: `true`",type:"boolean"}},type:"object"},ZoomLevelVisibilityCondition:{additionalProperties:!1,properties:{conditionPadding:{description:"Specify the buffer size (in pixel) of width or height when calculating the visibility.\n\n__Default__: `0`",type:"number"},measure:{const:"zoomLevel",description:"Specify which aspect of the `target` will be compared to the `threshold`.",type:"string"},operation:{$ref:"#/definitions/LogicalOperation",description:'A string that specifies the logical operation to conduct between `threshold` and the `measure` of `target`. Support\n\n- greater than : "greater-than", "gt", "GT"\n\n- less than : "less-than", "lt", "LT"\n\n- greater than or equal to : "greater-than-or-equal-to", "gtet", "GTET"\n\n- less than or equal to : "less-than-or-equal-to", "ltet", "LTET"'},target:{description:"Target specifies the object that you want to compare with the threshold.",enum:["track","mark"],type:"string"},threshold:{description:"Set a threshold in the unit of base pairs (bp)",type:"number"},transitionPadding:{description:"Specify the buffer size (in pixel) of width or height for smooth transition.\n\n__Default__: `0`",type:"number"}},required:["measure","operation","target","threshold"],type:"object"},ZoomLimits:{items:[{type:["number","null"]},{type:["number","null"]}],maxItems:2,minItems:2,type:"array"}}},nI=10,dI=function(I){var g=Object(G.e)(I);return g||(g=Object(G.e)("gray")),h.utils.rgb2hex([g.rgb().r/255,g.rgb().g/255,g.rgb().b/255])};function sI(I,g,C,A,i){var e=Math.max(Math.min(g,I),0),l=null!=i?i:0,o=(A-C)/360*Math.PI*2-2*l;return-(C/360*Math.PI*2+e/g*o)-Math.PI/2-l}function aI(I,g,C,A,i,e,l){return{x:A+C*Math.cos(sI(I,g,e,l)),y:i+C*Math.sin(sI(I,g,e,l))}}function ZI(I,g,C,A){return C<=I?Math.atan((g-A)/(I-C)):Math.atan((g-A)/(I-C))-Math.PI}var mI={fontSize:"12px",fontFamily:"sans-serif",fontWeight:"normal",fill:"black",background:"white",lineJoin:"round",stroke:"#ffffff",strokeThickness:0};function bI(I,g,C){var A,i,e,l,o,t,c,n;if("experimentalEdgeBundling"!==(null==(A=C.spec().style)?void 0:A.linkStyle)){var d=C.spec();if(d.width&&d.height){var s=C.data(),a=Object(r.a)(g.dimensions,2),Z=a[0],m=a[1],b="circular"===d.layout,h=null!=(i=d.innerRadius)?i:220,G=null!=(e=d.outerRadius)?e:300,u=null!=(l=d.startAngle)?l:0,y=null!=(o=d.endAngle)?o:360,B=G-h,V=Z/2,p=m/2,W=null!=(t=C.getChannelDomainArray("row"))?t:["___SINGLE_ROW___"],H=m/W.length,Y=null!=(n=null==(c=d.style)?void 0:c.linkMinHeight)?n:.5;W.forEach((function(g){var A=C.encodedValue("row",g);s.filter((function(I){return!UI(I,d.row)||UI(I,d.row)===g})).forEach((function(g){var i,e,l,o,t,c=C.encodedPIXIProperty("x",g),n=C.encodedPIXIProperty("xe",g),s=C.encodedPIXIProperty("x1",g),a=C.encodedPIXIProperty("x1e",g),h=C.encodedPIXIProperty("y",g),W=C.encodedPIXIProperty("stroke",g),R=C.encodedPIXIProperty("strokeWidth",g),f=C.encodedPIXIProperty("color",g),K=C.encodedPIXIProperty("opacity",g);if("undefined"!==typeof n){var w=[c,n].sort((function(I,g){return I-g})),J=Object(r.a)(w,2);c=J[0],n=J[1]}if("undefined"!==typeof s&&"undefined"!==typeof a){var S=[s,a].sort((function(I,g){return I-g})),F=Object(r.a)(S,2);s=F[0],a=F[1]}var N="undefined"!==typeof n&&"undefined"!==typeof s&&"undefined"!==typeof a&&Math.abs(c-n)>.1&&Math.abs(s-a)>.1;if(!N&&void 0===n&&!NI(d)){if(void 0===s&&void 0===a)return;n=void 0!==s?s:a}!N&&Math.abs(c-n)<=.1&&Math.abs(s-a)<=.1&&(c=(c+n)/2,n=(s+a)/2),I.lineStyle(R,dI(W),K,.5);var v=DI(d.y)&&d.y.flip||d.flipY,k=null!=(i=d.baselineY)?i:A+(v?0:H),D=[];if(N){I.beginFill(dI("none"===f?"white":f),"none"===f?0:K);var z=c,M=n,U=s,x=a,T=[z,M,U,x].sort((function(I,g){return I-g})),Q=Object(r.a)(T,4);if(z=Q[0],M=Q[1],U=Q[2],x=Q[3],z>Z||x<0||Math.abs(x-z)<.5)return;if(b){if(z<0||x>Z)return;var P=G-A/m*B,O=aI(z,Z,P,V,p,u,y),j=aI(M,Z,P,V,p,u,y),L=aI(U,Z,P,V,p,u,y),E=aI(x,Z,P,V,p,u,y);I.moveTo(O.x,O.y),I.bezierCurveTo(V,p,V,p,E.x,E.y),I.arc(V,p,G,ZI(E.x,E.y,V,p),ZI(L.x,L.y,V,p),!1),I.bezierCurveTo(V,p,V,p,j.x,j.y),I.arc(V,p,G,ZI(j.x,j.y,V,p),ZI(O.x,O.y,V,p),!1),D=Array.from(I.currentPath.points),I.endFill()}else I.moveTo(z,k),(null==(e=d.style)?void 0:e.linkStyle)&&"circular"!==(null==(l=d.style)?void 0:l.linkStyle)?(I.lineTo(U,A+H),I.bezierCurveTo(U+(M-U)/3,A+H-(M-U)/2,U+(M-U)/3*2,A+H-(M-U)/2,M,A+H),I.lineTo(x,A+H),I.bezierCurveTo(z+(x-z)/3*2,A+H-(x-z)/2,z+(x-z)/3,A+H-(x-z)/2,z,A+H),D=Array.from(I.currentPath.points),I.endFill()):(I.arc((z+x)/2,k,(x-z)/2,-Math.PI,Math.PI,!1),I.arc((M+U)/2,k,(U-M)/2,Math.PI,-Math.PI,!0),D=Array.from(I.currentPath.points),I.closePath());C.getMouseEventModel().addPolygonBasedEvent(g,D)}else{var _=(c+n)/2;if(I.beginFill(dI("white"),0),b){if(c<0||n>Z)return;if("straight"===(null==(o=d.style)?void 0:o.linkStyle)){var $=G-A/m*B,q=aI(c,Z,$,V,p,u,y),II=aI(n,Z,$,V,p,u,y),gI=q.x,CI=q.y,AI=II.x,iI=II.y;I.moveTo(gI,CI),I.lineTo(AI,iI);var eI=Array.from({length:100},(function(I,g){return{x:(AI-gI)/99*g+gI,y:(iI-CI)/99*g+CI}}));D=eI.flatMap((function(I){return[I.x,I.y]}))}else{var lI=G-A/m*B,oI=aI(c,Z,lI,V,p,u,y),tI=aI(n,Z,lI,V,p,u,y),cI=oI.x,nI=oI.y,sI=oI.x,mI=oI.y,bI=Z/2,rI=m/2,hI=tI.x,GI=tI.y;I.moveTo(cI,nI);var uI=new X.Bezier(cI,nI,sI,mI,bI,rI,hI,GI);uI.getLUT(14).forEach((function(g){return I.lineTo(g.x,g.y)})),D=uI.getLUT(1e3).flatMap((function(I){return[I.x,I.y]}))}}else if("elliptical"===(null==(t=d.style)?void 0:t.linkStyle)){if(!(0<=c&&c<=Z)&&!(0<=n&&n<=Z))return;for(var yI=[],BI=1e3,VI=DI(d.y),pI=0;pI<=BI;pI++){var XI=Math.PI*(pI/BI),WI=(n-c)/2*Math.cos(XI)+(c+n)/2,HI=k-h*Math.sin(XI)*(VI?1:Math.min(n-c+Z*Y,Z)/Z)*(v?-1:1);pI%20!==0&&pI!==BI||(0===pI?I.moveTo(WI,HI):I.lineTo(WI,HI)),yI.push({x:WI,y:HI})}D=yI.flatMap((function(I){return[I.x,I.y]}))}else{if(n<0||c>Z)return;I.arc(_,k,(n-c)/2,-Math.PI,Math.PI),D=Array.from(I.currentPath.points),I.closePath()}C.getMouseEventModel().addLineBasedEvent(g,D)}}))}))}else console.warn("Size of a track is not properly determined, so visual mark cannot be rendered")}else!function(I,g,C){var A,i,e,l,o=C.spec();if(o.width&&o.height){var t=C.data(),c=Object(r.a)(g.dimensions,2),n=c[0],d=c[1],s="circular"===o.layout,a=null!=(A=o.innerRadius)?A:220,Z=null!=(i=o.outerRadius)?i:300,m=null!=(e=o.startAngle)?e:0,b=null!=(l=o.endAngle)?l:360,h=Z-a,G=n/2,u=d/2;t.forEach((function(g){var A=C.encodedPIXIProperty("x",g),i=C.encodedPIXIProperty("xe",g),e=C.encodedPIXIProperty("stroke",g),l=C.encodedPIXIProperty("strokeWidth",g),o=C.encodedPIXIProperty("opacity",g);if(I.lineStyle(l,dI(e),o,.5),s){var t=Z-h/d,c=aI(A,n,t,G,u,m,b),a=aI(i,n,t,G,u,m,b),r=c.x,y=c.y,B=a.x,V=a.y;I.moveTo(r,y),I.lineTo(B,V)}else{var p=(A+i)/2;I.beginFill(dI("white"),0),I.arc(p,0,(i-A)/2,-Math.PI,Math.PI),I.closePath()}}))}else console.warn("Size of a track is not properly determined, so visual mark cannot be rendered")}(I,g,C)}function rI(I,g,C){!function(I,g,C){var A,i,e,l,o,t=g.spec();if(!DI(t.y)||!0!==t.y.grid)return;var c=Object(r.a)(I.position,2),n=c[0],d=c[1],s=Object(r.a)(I.dimensions,2),a=s[0],Z=s[1],m=n,b=n+a,h="circular"===g.spec().layout,G=null!=(A=t.innerRadius)?A:220,u=null!=(i=t.outerRadius)?i:300,y=null!=(e=t.startAngle)?e:0,B=null!=(l=t.endAngle)?l:360,V=u-G,p=a/2,X=Z/2,W=null!=(o=g.getChannelDomainArray("row"))?o:["___SINGLE_ROW___"],H=Z/W.length,Y=g.getChannelScale("y"),R=g.getChannelDomainArray("y");if(!Y||!R)return;if(h&&H/Z*V<=20||!h&&H<=20)return;var f=I.pBackground,K=C.axis.gridStrokeWidth;W.forEach((function(I){var A=g.encodedValue("row",I),i=h?H/Z*V:H,e=Math.max(Math.ceil(i/40),1),l=Y.ticks(e).filter((function(I){return R[0]<=I&&I<=R[1]}));1===l.length&&(l=Y.ticks(e+1).filter((function(I){return R[0]<=I&&I<=R[1]}))),h?l.forEach((function(I){var g=Y(I),i=u-(A+H-g)/Z*V,e=i+K/2,l=i-K/2,o=aI(0,a,l,p,X,y,B),t=sI(0,a,y,B),c=sI(a,a,y,B);f.lineStyle(K,dI("black"),0,.5),f.beginFill(dI(C.axis.gridColor),1),f.moveTo(n+o.x,d+o.y),f.arc(n+p,d+X,l,t,c,!0),f.arc(n+p,d+X,e,c,t,!1),f.closePath()})):(f.lineStyle(K,dI(C.axis.gridColor),1,.5),l.forEach((function(I){var g,i=d+A+H-Y(I);if("solid"===C.axis.gridStrokeType)f.moveTo(m,i),f.lineTo(b,i);else if("dashed"===C.axis.gridStrokeType)for(var e=null!=(g=C.axis.gridStrokeDash)?g:[1,1],l=Object(r.a)(e,2),o=l[0],t=l[1],c=m;c<b;c+=o+t)f.moveTo(c,i),f.lineTo(c+o,i)})))}))}(I,g,C),function(I,g,C){var A,i,e,l,o=g.spec();if(!DI(o.row)||!0!==o.row.grid)return;var t=Object(r.a)(I.position,2),c=t[0],n=t[1],d=Object(r.a)(I.dimensions,2),s=d[0],a=d[1],Z="circular"===g.spec().layout,m=null!=(A=o.innerRadius)?A:220,b=null!=(i=o.outerRadius)?i:300,h=null!=(e=o.startAngle)?e:0,G=null!=(l=o.endAngle)?l:360,u=b-m,y=s/2,B=a/2,V=g.getChannelDomainArray("row");if(!V)return;var p=a/V.length;if(Z&&u<=20||!Z&&p<=20)return;var X=I.pBackground,W=C.axis.gridStrokeWidth;V.forEach((function(I){var A=g.encodedValue("row",I);if(Z){var i=b-(A+p/2)/a*u,e=i+W/2,l=i-W/2,o=aI(0,s,l,y,B,h,G),t=sI(0,s,h,G),d=sI(s,s,h,G);X.lineStyle(W,dI("black"),0,.5),X.beginFill(dI(C.axis.gridColor),1),X.moveTo(c+o.x,n+o.y),X.arc(c+y,n+B,l,t,d,!0),X.arc(c+y,n+B,e,d,t,!1),X.closePath()}else{X.lineStyle(W,dI(C.axis.gridColor),1,.5);var m=n+A+p/2;X.moveTo(c,m),X.lineTo(c+s,m)}}))}(I,g,C)}var hI={color:"black",size:10,fontFamily:"Arial",fontWeight:"normal",stroke:"#ffffff",strokeThickness:0};function GI(){var I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},g=Object(m.a)(Object(m.a)({},hI),I),C={fontSize:"".concat(g.size,"px"),fontFamily:g.fontFamily,fontWeight:"light"===g.fontWeight?"lighter":g.fontWeight,fill:g.color,lineJoin:"round",stroke:g.stroke,strokeThickness:g.strokeThickness};return C}function uI(I,g,C,A,i){if(g.gLegend){g.gLegend.selectAll(".brush").remove();var e=A.spec(),l={offsetRight:0};if(DI(e.color)&&e.color.legend)switch(e.color.type){case"nominal":!function(I,g,C,A,i){var e,l,o,t,c,n=A.spec();if(!DI(n.color)||"nominal"!==n.color.type||!n.color.legend)return;var d=null!=(e=A.getChannelDomainArray("color"))?e:["___SINGLE_COLOR___"];if(0===d.length)return;var s=g.pBorder,a=10,Z=4,b=Z,r=0,h=[],G=GI({color:i.legend.labelColor,size:i.legend.labelFontSize,fontWeight:i.legend.labelFontWeight,fontFamily:i.legend.labelFontFamily});if(null==(l=n.style)?void 0:l.inlineLegend)d.map((function(I){return I})).reverse().forEach((function(C){if(!(r>g.dimensions[0])){var i=A.encodedValue("color",C),e=new I.libraries.PIXI.Text(C,G);e.anchor.x=1,e.anchor.y=0,e.position.x=g.position[0]+g.dimensions[0]-r-a,e.position.y=g.position[1]+Z,s.addChild(e);var l=new I.libraries.PIXI.TextStyle(G),o=I.libraries.PIXI.TextMetrics.measureText(C,l);b<o.height+3*Z&&(b=o.height+3*Z),h.push({x:g.position[0]+g.dimensions[0]-o.width-r-2*a,y:g.position[1]+Z+o.height/2,color:i}),r+=o.width+3*a}}));else{if(null==(o=n.style)?void 0:o.legendTitle){var u=new I.libraries.PIXI.Text(null==(t=n.style)?void 0:t.legendTitle,Object(m.a)(Object(m.a)({},G),{},{fontWeight:"bold"}));u.anchor.x=1,u.anchor.y=0,u.position.x=g.position[0]+g.dimensions[0]-a,u.position.y=g.position[1]+b;var y=new I.libraries.PIXI.TextStyle(Object(m.a)(Object(m.a)({},G),{},{fontWeight:"bold"})),B=I.libraries.PIXI.TextMetrics.measureText(null==(c=n.style)?void 0:c.legendTitle,y);s.addChild(u),b+=B.height+2*Z}d.forEach((function(C){if(!(b>g.dimensions[1])){var i=A.encodedValue("color",C),e=new I.libraries.PIXI.Text(C,G);e.anchor.x=1,e.anchor.y=0,e.position.x=g.position[0]+g.dimensions[0]-a,e.position.y=g.position[1]+b,s.addChild(e);var l=new I.libraries.PIXI.TextStyle(G),o=I.libraries.PIXI.TextMetrics.measureText(C,l);r<o.width+3*a&&(r=o.width+3*a),h.push({x:g.position[0]+g.dimensions[0]-o.width-2*a,y:g.position[1]+b+o.height/2,color:i}),b+=o.height+2*Z}}))}s.beginFill(dI(i.legend.background),i.legend.backgroundOpacity),s.lineStyle(1,dI(i.legend.backgroundStroke),i.legend.backgroundOpacity,0),s.drawRect(g.position[0]+g.dimensions[0]-r-1,g.position[1]+1,r,b-Z),h.forEach((function(I){s.lineStyle(1,dI("black"),0,0),s.beginFill(dI(I.color),1),s.drawCircle(I.x,I.y,4)}))}(I,g,0,A,i);break;case"quantitative":yI(I,g,C,A,i,"color",l)}if(DI(e.stroke)&&e.stroke.legend&&"quantitative"===e.stroke.type)yI(I,g,C,A,i,"stroke",l)}}function yI(I,g,C,A,i,e,l){var o=A.spec(),t=o[e];if(DI(t)&&"quantitative"===t.type&&t.legend){var c=Object(r.a)(g.position,2),n=c[0],d=c[1],s=Object(r.a)(g.dimensions,2),a=s[0],Z=s[1],h=Z-2>110?110:Math.max(Z-2,38),G={top:10,left:55,width:20,height:h-20},u=n+a-80-1-l.offsetRight,y=d+1,B=A.getChannelScale(e),V=A.getChannelDomainArray(e);if(B&&V){var p=g.pBorder;if(p.beginFill(dI(i.legend.background),i.legend.backgroundOpacity),p.lineStyle(1,dI(i.legend.backgroundStroke),i.legend.backgroundOpacity,0),p.drawRect(u,y,80,h),t.title){var X=t.title,H=GI({color:i.legend.labelColor,size:i.legend.labelFontSize,fontWeight:i.legend.labelFontWeight,fontFamily:i.legend.labelFontFamily}),Y=new I.libraries.PIXI.Text(X,Object(m.a)(Object(m.a)({},H),{},{fontWeight:"bold"}));Y.anchor.x=0,Y.anchor.y=0,Y.position.x=u+10,Y.position.y=y+10;var R=new I.libraries.PIXI.TextStyle(Object(m.a)(Object(m.a)({},H),{},{fontWeight:"bold"})),f=I.libraries.PIXI.TextMetrics.measureText(X,R);p.addChild(Y),G.top+=f.height+4,G.height-=f.height+4}var K=Object(r.a)(V,2),w=K[0],J=K[1],S=J-w,F=DI(t)&&t.scaleOffset?t.scaleOffset:[0,1];Object(b.a)(Array(G.height).keys()).forEach((function(I){var g,C=Array.from(F).sort();if(I/G.height>=C[1])g=J;else if(I/G.height<=C[0])g=w;else{var A=Object(W.a)().domain([G.height*C[0],G.height*C[1]]).range([0,G.height]);g=Object(W.a)().domain([0,G.height]).range([w,J])(A(I))}p.beginFill(dI(B(g)),1),p.lineStyle(1,dI(i.legend.backgroundStroke),0,.5),p.drawRect(u+G.left,y+G.top+G.height-I,G.width,1)}));g.colorBrushes=g.gLegend.append("g").attr("class",e).selectAll(".brush").data(F.map((function(I,g){return{y:I,id:g}}))).enter().append("rect").attr("class","brush").attr("pointer-events","all").attr("cursor","ns-resize").attr("transform",(function(I){return"translate(".concat(u+G.left,", ").concat(y+G.top-2+G.height-G.height*I.y,")")})).attr("width","".concat(G.width,"px")).attr("height","".concat(4,"px")).attr("fill","lightgrey").attr("stroke","black").attr("stroke-width","0.5px").call(I.libraries.d3Drag.drag().on("start",(function(){g.startEvent=I.libraries.d3Selection.event.sourceEvent})).on("drag",(function(C){if(t&&t.scaleOffset){var A=I.libraries.d3Selection.event.sourceEvent,i=g.startEvent.clientY-A.clientY,l=[t.scaleOffset[0],t.scaleOffset[1]];0===C.id?l[0]+=i/G.height:l[1]+=i/G.height,l[0]=Math.min(1,Math.max(0,l[0])),l[1]=Math.min(1,Math.max(0,l[1])),g.updateScaleOffsetFromOriginalSpec(o._renderingId,l,e),g.shareScaleOffsetAcrossTracksAndTiles(l,e),g.draw(),g.startEvent=I.libraries.d3Selection.event.sourceEvent}})));var N=Math.max(Math.ceil(G.height/30),2),v=B.ticks(N).filter((function(I){return V[0]<=I&&I<=V[1]}));1===v.length&&(v=B.ticks(N+1).filter((function(I){return V[0]<=I&&I<=V[1]})));p.lineStyle(1,dI(i.legend.tickColor),1,.5);var k=GI({color:i.legend.labelColor,size:i.legend.labelFontSize,fontWeight:i.legend.labelFontWeight,fontFamily:i.legend.labelFontFamily}),D=u+G.left;v.forEach((function(g){var C=y+G.top+G.height-(g-w)/S*G.height;C===y+G.top?C+=.5:C===y+G.top+G.height&&(C-=.5),p.moveTo(D-3,C),p.lineTo(D,C);var A=new I.libraries.PIXI.Text(g,k);A.anchor.x=1,A.anchor.y=.5,A.position.x=D-6,A.position.y=C,p.addChild(A)})),l.offsetRight=a-u}}}function BI(I,g,C){var A,i,e,l,o,t=C.spec();if(t.width&&t.height){var c=C.data(),n=Object(r.a)(g.dimensions,2),d=n[0],s=n[1],a="circular"===t.layout,Z=null!=(A=t.innerRadius)?A:220,m=null!=(i=t.outerRadius)?i:300,b=null!=(e=t.startAngle)?e:0,h=null!=(l=t.endAngle)?l:360,G=m-Z,u=d/2,y=s/2,B=null!=(o=C.getChannelDomainArray("row"))?o:["___SINGLE_ROW___"],V=s/B.length;B.forEach((function(g){var A=C.encodedValue("row",g);c.filter((function(I){return!UI(I,t.row)||UI(I,t.row)===g})).forEach((function(g){var i,e,l=C.encodedPIXIProperty("x",g),o=C.encodedPIXIProperty("xe",g),c=C.encodedPIXIProperty("x1",g),n=C.encodedPIXIProperty("x1e",g),Z=C.encodedPIXIProperty("y",g),B=C.encodedPIXIProperty("stroke",g),p=C.encodedPIXIProperty("strokeWidth",g),X=C.encodedPIXIProperty("color",g),W=C.encodedPIXIProperty("opacity",g);if("undefined"!==typeof o){var H=[l,o].sort((function(I,g){return I-g})),Y=Object(r.a)(H,2);l=Y[0],o=Y[1]}if("undefined"!==typeof c&&"undefined"!==typeof n){var R=[c,n].sort((function(I,g){return I-g})),f=Object(r.a)(R,2);c=f[0],n=f[1]}var K="undefined"!==typeof o&&"undefined"!==typeof c&&"undefined"!==typeof n&&Math.abs(l-o)>.1&&Math.abs(c-n)>.1;if(!K&&void 0===o&&!NI(t)){if(void 0===c&&void 0===n)return;o=void 0!==c?c:n}if(!K&&Math.abs(l-o)<=.1&&Math.abs(c-n)<=.1&&(l=(l+o)/2,o=(c+n)/2),I.lineStyle(p,dI(B),W,.5),K){I.beginFill(dI("none"===X?"white":X),"none"===X?0:W);var w=l,J=o,S=c,F=n,N=[w,J].sort((function(I,g){return I-g})),v=Object(r.a)(N,2);w=v[0],J=v[1];var k=[S,F].sort((function(I,g){return I-g})),D=Object(r.a)(k,2);if(S=D[0],F=D[1],w>d||F<0||Math.abs(F-w)<.5)return;if(a){if(w<0||F>d)return;var z=m-A/s*G,M=aI(w,d,z,u,y,b,h),U=aI(J,d,z,u,y,b,h),x=aI(S,d,z,u,y,b,h),T=aI(F,d,z,u,y,b,h);I.moveTo(M.x,M.y),I.bezierCurveTo(u,y,u,y,T.x,T.y),I.arc(u,y,m,ZI(T.x,T.y,u,y),ZI(x.x,x.y,u,y),!1),I.bezierCurveTo(u,y,u,y,U.x,U.y),I.arc(u,y,m,ZI(U.x,U.y,u,y),ZI(M.x,M.y,u,y),!1),I.endFill()}else I.moveTo(w,A),I.lineTo(J,A),I.lineTo(F,A+V),I.lineTo(S,A+V),I.lineTo(w,A),I.closePath()}else{if(NI(t))return void("curve"===(null==(i=t.style)?void 0:i.linkConnectionType)?(I.moveTo(l,0),I.bezierCurveTo(l/5*4,(A+V-Z)/2,l/2,(A+V-Z)/5*4,0,A+V-Z)):"straight"===(null==(e=t.style)?void 0:e.linkConnectionType)?(I.moveTo(l,0),I.lineTo(0,A+V-Z)):(I.moveTo(l,0),I.lineTo(l,A+V-Z),I.lineTo(0,A+V-Z)));if(a){for(var Q,P,O=function(g){var C=function(I){return m-1/(1+Math.exp(function(I){return Math.log(I/(1-I))}(I)))*G+3},A=function(I,g,C){return((C-g)*I+g)/d},i=u+C(g)*Math.cos(2*-A(g,l,o)*Math.PI-Math.PI/2),e=y+C(g)*Math.sin(2*-A(g,l,o)*Math.PI-Math.PI/2);Q&&P&&(I.lineStyle(p,dI(B),W,.5),I.moveTo(Q,P),I.lineTo(i,e)),Q=i,P=e},j=0;j<=1;j+=.02)O(j);return}I.moveTo(o,A+V),I.lineTo(l,A)}}))}))}else console.warn("Size of a track is not properly determined, so visual mark cannot be rendered")}var VI=["x","xe","x1","x1e","y","ye","y1","y1e","color","size","row","stroke","strokeWidth","opacity","text"];function pI(I,g,C,A){if(I&&g&&C&&"brush"!==A.spec().mark){if(["x","x1","x1e","xe"].forEach((function(I){A.setChannelScale(I,g._xScale)})),NI(A.spec())||SI(e=A.spec())&&!DI(e.x)&&DI(e.y)&&"genomic"===e.y.type){var i=g._yScale.copy();i.range([i.range()[1],i.range()[0]]),["y","y1","y1e","ye"].forEach((function(I){A.setChannelScale(I,i)}))}var e,l=Object(r.a)(g.dimensions,2),o=l[0],t=l[1];switch(A.spec().mark){case"point":!function(I,g,C){var A,i,e,l,o,t=C.spec();if(t.width&&t.height){var c=C.data(),n=Object(r.a)(I.dimensions,2),d=n[0],s=n[1],a=C.getChannelScale("x").invert(d)-C.getChannelScale("x").invert(0),Z="circular"===t.layout,m=null!=(A=t.innerRadius)?A:220,b=null!=(i=t.outerRadius)?i:300,h=null!=(e=t.startAngle)?e:0,G=null!=(l=t.endAngle)?l:360,u=b-m,y=d/2,B=s/2,V=null!=(o=C.getChannelDomainArray("row"))?o:["___SINGLE_ROW___"],p=s/V.length;V.forEach((function(I){var A=C.encodedValue("row",I);c.filter((function(g){return!UI(g,t.row)||UI(g,t.row)===I})).forEach((function(I){var i=C.encodedPIXIProperty("x-center",I),e=C.encodedPIXIProperty("y-center",I),l=C.encodedPIXIProperty("color",I),o=C.encodedPIXIProperty("p-size",I),t=C.encodedPIXIProperty("strokeWidth",I),c=C.encodedPIXIProperty("stroke",I),n=C.encodedPIXIProperty("opacity",I),m=C.markVisibility(I,{width:o,zoomLevel:a}),r=Math.min(m,n);if(!(o<=.1||0===r||i+o<0||i-o>d))if(g.lineStyle(t,dI(c),r,1),Z){var V=aI(i,d,b-(A+p-e)/s*u,y,B,h,G);g.beginFill(dI(l),r),g.drawCircle(V.x,V.y,o),C.getMouseEventModel().addPointBasedEvent(I,[V.x,V.y,o])}else g.beginFill(dI(l),r),g.drawCircle(i,A+p-e,o),C.getMouseEventModel().addPointBasedEvent(I,[i,A+p-e,o])}))}))}else console.warn("Size of a track is not properly determined, so visual mark cannot be rendered")}(g,C.graphics,A);break;case"bar":!function(I,g,C){var A,i,e,l,o,t,c,n=C.spec();if(n.width&&n.height){var d=C.data(),s=Object(r.a)(I.dimensions,2),a=s[0],Z=s[1],m=I.tilesetInfo.tile_size,h=I.getTilePosAndDimensions(g.gos.zoomLevel,g.gos.tilePos,m),G=h.tileX,y=h.tileWidth,B=C.getChannelScale("x").invert(a)-C.getChannelScale("x").invert(0),V="circular"===n.layout,p=null!=(A=n.innerRadius)?A:220,X=null!=(i=n.outerRadius)?i:300,W=null!=(e=n.startAngle)?e:0,H=null!=(l=n.endAngle)?l:360,Y=X-p,R=a/2,f=Z/2,K=C.getChannelScale("x"),w=K(G+y/m)-K(G),J=null!=(o=C.getChannelDomainArray("row"))?o:["___SINGLE_ROW___"],S=Z/J.length,F=!DI(n.row)||DI(n.row)&&"undefined"===typeof n.row.clip||n.row.clip,N=DI(n.y)?null==(t=n.y)?void 0:t.baseline:void 0,v=null!=(c=C.encodedValue("y",N))?c:0,k=g.graphics;if(MI(n)){var D=C.getGenomicChannel();if(!D||!D.field)return void console.warn("Genomic field is not provided in the specification");var z=Object(u.a)(d,(function(I){return I[D.field]}));Object(b.a)(z.keys()).forEach((function(I){var g,A=0;null==(g=z.get(I))||g.forEach((function(I){var g=C.encodedPIXIProperty("color",I),i=C.encodedPIXIProperty("stroke",I),e=C.encodedPIXIProperty("strokeWidth",I),l=C.encodedPIXIProperty("opacity",I),o=C.encodedPIXIProperty("y",I),t=C.encodedPIXIProperty("width",I,{tileUnitWidth:w}),c=C.encodedPIXIProperty("x-start",I,{markWidth:t}),n=c+t,d=C.markVisibility(I,{width:t,zoomLevel:B}),s=Math.min(d,l);if(!(0===s||t<=0||o<=0)){k.lineStyle(e,dI(i),s,0);var m=[];if(V){var b=X-(S-A)/Z*Y,r=X-(S-o-A)/Z*Y,h=aI(c,a,r,R,f,W,H),G=sI(c,a,W,H),u=sI(c+t,a,W,H);k.beginFill(dI(g),"none"===g?0:s),k.moveTo(h.x,h.y),k.arc(R,f,r,G,u,!0),k.arc(R,f,b,u,G,!1),m=Array.from(k.currentPath.points),k.closePath()}else{k.beginFill(dI(g),"none"===g?0:s),k.drawRect(c,S-o-A,t,o);var y=S-o-A,p=y+o;m=[c,y,c,p,n,p,n,y]}C.getMouseEventModel().addPolygonBasedEvent(I,m),A+=o}}))}))}else J.forEach((function(I){var g=C.encodedValue("row",I);d.filter((function(g){var C=UI(g,n.row);return!C||C===I})).forEach((function(I){var A=C.encodedPIXIProperty("color",I),i=C.encodedPIXIProperty("stroke",I),e=C.encodedPIXIProperty("strokeWidth",I),l=C.encodedPIXIProperty("opacity"),o=C.encodedPIXIProperty("y",I),t=C.encodedPIXIProperty("ye",I);if("undefined"!==typeof t&&o>t){var c=[t,o];o=c[0],t=c[1]}var d,s=C.encodedPIXIProperty("width",I,{tileUnitWidth:w}),m=C.encodedPIXIProperty("x-start",I,{markWidth:s}),b=m+s;"undefined"===typeof t?(d=g+S-v-o,t=g+S-v,(DI(n.y)&&n.y.flip||n.flipY)&&(t=d,d=g)):(d=g+S-t,t=g+S-o),F&&(d=Math.max(g,d),d=Math.min(d,g+S),t=Math.max(g,t),t=Math.min(t,g+S));var r=C.markVisibility(I,{width:s,zoomLevel:B}),h=Math.min(r,l);if(0!==h&&0!==s&&0!==o){k.lineStyle(e,dI(i),h,0);var G=[];if(V){var u=X-d/Z*Y,y=X-t/Z*Y,p=aI(m,a,y,R,f,W,H),K=sI(m,a,W,H),J=sI(m+s,a,W,H);k.beginFill(dI(A),"none"===A?0:h),k.moveTo(p.x,p.y),k.arc(R,f,y,K,J,!0),k.arc(R,f,u,J,K,!1),G=Array.from(k.currentPath.points),k.closePath()}else k.beginFill(dI(A),"none"===A?0:h),k.drawRect(m,d,s,t-d),G=[m,d,m,t,b,t,b,d];C.getMouseEventModel().addPolygonBasedEvent(I,G)}}))}))}else console.warn("Size of a track is not properly determined, so visual mark cannot be rendered")}(g,C,A);break;case"line":!function(I,g,C,A){var i,e,l,o,t,c,n=g.spec();if(n.width&&n.height){var d=g.data(),s="circular"===n.layout,a=null!=(i=n.innerRadius)?i:220,Z=null!=(e=n.outerRadius)?e:300,m=null!=(l=n.startAngle)?l:0,b=null!=(o=n.endAngle)?o:360,r=Z-a,h=C/2,G=A/2,u=null!=(t=g.getChannelDomainArray("row"))?t:["___SINGLE_ROW___"],y=A/u.length,B=null!=(c=g.getChannelDomainArray("color"))?c:["___SINGLE_COLOR___"];u.forEach((function(i){var e=g.encodedValue("row",i);B.forEach((function(l){d.filter((function(I){return(!UI(I,n.row)||UI(I,n.row)===i)&&(!UI(I,n.color)||UI(I,n.color)===l)})).sort((function(I,g){return UI(I,n.x)-UI(g,n.x)})).forEach((function(i,l){var o=g.encodedPIXIProperty("x",i),t=g.encodedPIXIProperty("y",i),c=g.encodedPIXIProperty("size",i),n=g.encodedPIXIProperty("color",i),d=g.encodedPIXIProperty("opacity",i);if(I.lineStyle(c,dI(n),d,.5),s){var a=aI(o,C,Z-(e+y-t)/A*r,h,G,m,b);0===l?I.moveTo(a.x,a.y):I.lineTo(a.x,a.y),g.getMouseEventModel().addPointBasedEvent(i,[a.x,a.y,1])}else 0===l?I.moveTo(o,e+y-t):I.lineTo(o,e+y-t),g.getMouseEventModel().addPointBasedEvent(i,[o,e+y-t,1])}))}))}))}else console.warn("Size of a track is not properly determined, so visual mark cannot be rendered")}(C.graphics,A,o,t);break;case"area":!function(I,g,C,A){var i,e,l,o,t,c,n=A.spec(),d=A.data(),s=Object(r.a)(g.dimensions,2),a=s[0],Z=s[1],m=g.tilesetInfo.tile_size,h=g.getTilePosAndDimensions(C.gos.zoomLevel,C.gos.tilePos,m).tileX,G="circular"===n.layout,V=null!=(i=n.innerRadius)?i:220,p=null!=(e=n.outerRadius)?e:300,X=null!=(l=n.startAngle)?l:0,W=null!=(o=n.endAngle)?o:360,H=p-V,Y=a/2,R=Z/2,f=g._xScale,K=null!=(t=A.getChannelDomainArray("row"))?t:["___SINGLE_ROW___"],w=Z/K.length,J=null!=(c=A.getChannelDomainArray("color"))?c:["___SINGLE_COLOR___"],S=A.encodedPIXIProperty("opacity"),F=A.encodedPIXIProperty("strokeWidth"),N=A.encodedPIXIProperty("stroke"),v=C.graphics;if(MI(n)){var k=A.getGenomicChannel();if(!k||!k.field)return void console.warn("Genomic field is not provided in the specification");var D=Object(u.a)(d,(function(I){return I[k.field]})),z=Object(b.a)(D.keys());v.lineStyle(F,dI(N),S,1);var M={};J.forEach((function(I){var g=[],C=[];z.forEach((function(i,e,l){var o,t;null==(t=null==(o=D.get(i))?void 0:o.filter((function(g){return UI(g,n.color)===I})))||t.forEach((function(I){var o=f(+i),t=Object(y.a)([A.encodedPIXIProperty("y",I),0]);"undefined"===typeof M[i]&&(M[i]=0);var c=w-t-M[i],n=w-M[i];if(G){if(0===e){var d=aI(o,a,p-w/Z*H,Y,R,X,W);g.push([d.x,d.y]),C.push([d.x,d.y])}var s=aI(o,a,p-c/Z*H,Y,R,X,W);g.push([s.x,s.y]);var m=aI(o,a,p-n/Z*H,Y,R,X,W);if(C.push([m.x,m.y]),e===l.length-1){var b=aI(o,a,p-w/Z*H,Y,R,X,W);g.push([b.x,b.y]),C.push([b.x,b.y])}A.getMouseEventModel().addPointBasedEvent(I,[m.x,m.y,1])}else 0===e&&(g.push([o,w]),C.push([o,w])),g.push([o,c]),C.push([o,n]),e===l.length-1&&(g.push([o,w]),C.push([o,w])),A.getMouseEventModel().addPointBasedEvent(I,[o,c,1]);M[i]+=t}))}));var i=A.encodedValue("color",I);v.beginFill(dI(i),S),v.drawPolygon([].concat(Object(b.a)(g.reduce((function(I,g){return I.concat(g)}))),Object(b.a)(C.reverse().reduce((function(I,g){return I.concat(g)}))))),v.endFill()}))}else K.forEach((function(I){var g=A.encodedValue("row",I);v.lineStyle(F,dI(N),S,0),J.forEach((function(C){var i=[],e=[],l=p-(g+w)/Z*H;d.filter((function(g){return("undefined"===typeof UI(g,n.row)||UI(g,n.row)===I)&&("undefined"===typeof UI(g,n.color)||UI(g,n.color)===C)})).sort((function(I,g){return A.encodedPIXIProperty("x",I)-A.encodedPIXIProperty("x",g)})).forEach((function(I,C,o){var t=Object(B.a)([Object(y.a)([A.encodedPIXIProperty("y",I),0]),w]),c=A.encodedPIXIProperty("x",I);if(G){var n=aI(c,a,l,Y,R,X,W);i.push([n.x,n.y]),0===C&&e.push(n.x,n.y);var d=aI(c,a,p-(g+w-t)/Z*H,Y,R,X,W);if(e.push(d.x,d.y),C===o.length-1){var s=aI(c,a,p-(g+w)/Z*H,Y,R,X,W);e.push(s.x,s.y)}A.getMouseEventModel().addPointBasedEvent(I,[d.x,d.y,1])}else{if(0===C&&e.push(c,g+w),e.push(c,g+w-t),C===o.length-1){var m=f(h);e.push(c,g+w),e.push(m,g+w)}A.getMouseEventModel().addPointBasedEvent(I,[c,g+w-t,1])}})),G&&0!==i.length&&e.push.apply(e,Object(b.a)(i.reverse().reduce((function(I,g){return I.concat(g)}))));var o=A.encodedValue("color",C);v.beginFill(dI(o),S),v.drawPolygon(e),v.endFill()}))}))}(0,g,C,A);break;case"rect":!function(I,g,C,A){var i,e,l,o,t,c,n=A.spec(),d=A.data(),s=Object(r.a)(g.dimensions,2),a=s[0],Z=s[1],m=g.tilesetInfo.tile_size,b=g.getTilePosAndDimensions(C.gos.zoomLevel,C.gos.tilePos,m),h=b.tileX,G=b.tileWidth,u="circular"===n.layout,y=null!=(i=n.innerRadius)?i:220,B=null!=(e=n.outerRadius)?e:300,V=null!=(l=n.startAngle)?l:0,p=null!=(o=n.endAngle)?o:360,X=B-y,W=a/2,H=Z/2,Y=g._xScale,R=Y(h+G/m)-Y(h),f=null!=(t=A.getChannelDomainArray("row"))?t:["___SINGLE_ROW___"],K=Z/f.length,w=DI(n.row)&&n.row.padding?n.row.padding:0,J=null!=(c=A.getChannelDomainArray("y"))?c:["___SINGLE_Y_POSITION___"],S=K/J.length-2*w,F=C.graphics;d.forEach((function(I){var C,i=A.encodedPIXIProperty("row",I)+w,e=A.encodedPIXIProperty("x",I),l=A.encodedPIXIProperty("color",I),o=A.encodedPIXIProperty("stroke",I),t=A.encodedPIXIProperty("strokeWidth",I),c=A.encodedPIXIProperty("opacity",I),n=A.encodedPIXIProperty("width",I,{markWidth:R}),d=A.encodedPIXIProperty("height",I,{markHeight:S}),s=A.encodedPIXIProperty("y",I),m=A.markVisibility(I,{width:n,zoomLevel:g._xScale.invert(a)-g._xScale.invert(0)}),b=Math.min(m,c);if(!(0===b||0===d||n<=1e-4)){var r=e,h=e+n,G=i+K-s-d/2,y=i+K-s+d/2,Y=null!=(C=A.visualPropertyByChannel("size",I))?C:void 0;F.lineStyle(t,dI(o),b,.5);var f=[];if(u){if(h<0||a<r)return;var J=B-G/Z*X,N=B-y/Z*X;if(Y){var v=B-(i+s)/Z*X;J=v-Y/2,N=v+Y/2}var k=aI(r,a,N,W,H,V,p),D=sI(r,a,V,p),z=sI(h,a,V,p);F.beginFill(dI("none"===l?"white":l),"none"===l?0:b),F.moveTo(k.x,k.y),F.arc(W,H,N,D,z,!0),F.arc(W,H,J,z,D,!1),f=Array.from(F.currentPath.points),F.closePath()}else F.beginFill(dI("none"===l?"white":l),"none"===l?0:b),F.drawRect(r,G,h-r,y-G),f=[r,G,r,y,h,y,h,G];A.getMouseEventModel().addPolygonBasedEvent(I,f)}}))}(0,g,C,A);break;case"triangleLeft":case"triangleRight":case"triangleBottom":!function(I,g,C,A){var i,e,l,o,t,c,n,d=g.spec();if(d.width&&d.height){var s=g.data(),a=g.getChannelScale("x").invert(C)-g.getChannelScale("x").invert(0),Z="circular"===d.layout,m=null!=(i=d.innerRadius)?i:220,b=null!=(e=d.outerRadius)?e:300,r=null!=(l=d.startAngle)?l:0,h=null!=(o=d.endAngle)?o:360,G=b-m,u=C/2,y=A/2,B=null!=(t=g.getChannelDomainArray("row"))?t:["___SINGLE_ROW___"],V=A/B.length,p=null!=(c=g.getChannelDomainArray("y"))?c:["___SINGLE_Y___"],X=null!=(n=g.encodedValue("size"))?n:Z?G/B.length/p.length:V/p.length;B.forEach((function(i){var e=g.encodedValue("row",i);s.filter((function(I){return!UI(I,d.row)||UI(I,d.row)===i})).forEach((function(i){var l,o,t,c=g.encodedPIXIProperty("x",i),n=g.encodedPIXIProperty("xe",i),s=null!=(l=g.encodedPIXIProperty("size",i))?l:void 0===n?X:n-c,m=g.encodedPIXIProperty("y",i),B=g.encodedPIXIProperty("strokeWidth",i),p=g.encodedPIXIProperty("stroke",i),W=g.encodedPIXIProperty("color",i),H=g.encodedPIXIProperty("opacity",i),Y=[];if(Z){var R=c||n-s,f=n||c+s,K=(R+f)/2,w=b-(e+V-m)/A*G,J=w-X/2,S=w+X/2;if("right"!==(null==(o=d.style)?void 0:o.align)||n||(R-=s,f-=s,K-=s),"triangleLeft"===d.mark){var F=aI(f,C,J,u,y,r,h),N=aI(R,C,w,u,y,r,h),v=aI(f,C,S,u,y,r,h),k=aI(f,C,J,u,y,r,h);Y=[F.x,F.y,N.x,N.y,v.x,v.y,k.x,k.y]}else if("triangleRight"===d.mark){var D=aI(R,C,J,u,y,r,h),z=aI(f,C,w,u,y,r,h),M=aI(R,C,S,u,y,r,h),U=aI(R,C,J,u,y,r,h);Y=[D.x,D.y,z.x,z.y,M.x,M.y,U.x,U.y]}else if("triangleBottom"===d.mark){f=K+s/2;var x=aI(R=K-s/2,C,S,u,y,r,h),T=aI(f,C,S,u,y,r,h),Q=aI(K,C,J,u,y,r,h),P=aI(R,C,S,u,y,r,h);Y=[x.x,x.y,T.x,T.y,Q.x,Q.y,P.x,P.y]}var O=g.markVisibility(i,{width:f-R,zoomLevel:a}),j=Math.min(O,H);I.lineStyle(B,dI(p),f-R>2?j:0,0),I.beginFill(dI(W),j),I.drawPolygon(Y),I.endFill()}else{var L=c||n-s,E=n||c+s,_=L+(E-L)/2,$=e+V-m,q=e+V-m-X/2,II=e+V-m+X/2;"right"!==(null==(t=d.style)?void 0:t.align)||n||(L-=s,E-=s,_-=s),Y={triangleLeft:[E,q,L,$,E,II,E,q],triangleRight:[L,q,E,$,L,II,L,q],triangleBottom:[L,q,E,q,_,II,L,q]}[d.mark];var gI=g.markVisibility(i,{width:E-L,zoomLevel:a}),CI=Math.min(gI,H);I.lineStyle(B,dI(p),E-L>2?CI:0,.5),I.beginFill(dI(W),CI),I.drawPolygon(Y),I.endFill()}g.getMouseEventModel().addPolygonBasedEvent(i,Y)}))}))}else console.warn("Size of a track is not properly determined, so visual mark cannot be rendered")}(C.graphics,A,o,t);break;case"text":!function(I,g,C,A){var i,e,l,o,t,c,n,d,s,a,Z=A.spec(),h=A.data(),G=Object(r.a)(g.dimensions,2),y=G[0],B=G[1],V="circular"===Z.layout,p=null!=(i=Z.innerRadius)?i:220,X=null!=(e=Z.outerRadius)?e:300,W=null!=(l=Z.startAngle)?l:0,H=null!=(o=Z.endAngle)?o:360,Y=X-p,R=y/2,f=B/2,K=null!=(t=A.getChannelDomainArray("row"))?t:["___SINGLE_ROW___"],w=B/K.length,J=null!=(n=null==(c=Z.style)?void 0:c.dx)?n:0,S=null!=(s=null==(d=Z.style)?void 0:d.dy)?s:0,F=(null==(a=Z.style)?void 0:a.textAnchor)?Z.style.textAnchor:"middle";if(MI(Z)){if(V)return;var N=C.graphics,v=A.getGenomicChannel();if(!v||!v.field)return void console.warn("Genomic field is not provided in the specification");var k=Object(u.a)(h,(function(I){return I[v.field]}));Object(b.a)(k.keys()).forEach((function(C){var i,e=0;null==(i=k.get(C))||i.forEach((function(C){var i,l,o,t,c,n,d,s,a=A.encodedPIXIProperty("text",C),b=A.encodedPIXIProperty("color",C),r=A.encodedPIXIProperty("x",C)+J,h=A.encodedPIXIProperty("xe",C)+J,G=A.encodedPIXIProperty("x-center",C)+J,u=A.encodedPIXIProperty("y",C)+S,B=A.encodedPIXIProperty("size",C),V=A.encodedPIXIProperty("stroke",C),p=A.encodedPIXIProperty("strokeWidth",C),X=A.encodedPIXIProperty("opacity",C);if(!(G<0||G>y)&&!(g.textsBeingUsed>1e3)){var W,H=Object(m.a)(Object(m.a)({},mI),{},{fontSize:null!=B?B:(null==(i=Z.style)?void 0:i.textFontSize)?"".concat(null==(l=Z.style)?void 0:l.textFontSize,"px"):mI.fontSize,stroke:null!=(t=null!=V?V:null==(o=Z.style)?void 0:o.textStroke)?t:mI.stroke,strokeThickness:null!=(n=null!=p?p:null==(c=Z.style)?void 0:c.textStrokeWidth)?n:mI.strokeThickness,fontWeight:null!=(s=null==(d=Z.style)?void 0:d.textFontWeight)?s:mI.fontWeight}),Y=new I.libraries.PIXI.TextStyle(H);g.textGraphics.length>g.textsBeingUsed?((W=g.textGraphics[g.textsBeingUsed]).style.fill=b,W.visible=!0,W.text=a,W.alpha=1):(W=new I.libraries.PIXI.Text(a,Object(m.a)(Object(m.a)({},H),{},{fill:b})),g.textGraphics.push(W));var R=I.libraries.PIXI.TextMetrics.measureText(a,Y);g.textsBeingUsed++;var f=A.markVisibility(C,Object(m.a)(Object(m.a)({},R),{},{zoomLevel:g._xScale.invert(y)-g._xScale.invert(0)})),K=Math.min(f,X);if(!a||0===K)return g.textsBeingUsed--,void(W.visible=!1);W.alpha=K,W.resolution=8,W.updateText(),W.texture.baseTexture.scaleMode=I.libraries.PIXI.SCALE_MODES.LINEAR;var F=new I.libraries.PIXI.Sprite(W.texture);F.x=r,F.y=w-u-e,F.width=h-r,F.height=u,N.addChild(F),e+=u}}))}))}else K.forEach((function(i){var e=C.graphics,l=A.encodedValue("row",i);h.filter((function(I){return!UI(I,Z.row)||UI(I,Z.row)===i})).forEach((function(C){var i,o,t,c,n,d,s,a,b=A.encodedPIXIProperty("text",C),r=A.encodedPIXIProperty("color",C),h=A.encodedPIXIProperty("x-center",C)+J,G=A.encodedPIXIProperty("y",C)+S,u=A.encodedPIXIProperty("size",C),p=A.encodedPIXIProperty("stroke",C),K=A.encodedPIXIProperty("strokeWidth",C),N=A.encodedPIXIProperty("opacity",C);if(!(h<0||h>y)&&!(g.textsBeingUsed>1e3)){var v,k=Object(m.a)(Object(m.a)({},mI),{},{fontSize:null!=u?u:(null==(i=Z.style)?void 0:i.textFontSize)?"".concat(null==(o=Z.style)?void 0:o.textFontSize,"px"):mI.fontSize,stroke:null!=(c=null!=p?p:null==(t=Z.style)?void 0:t.textStroke)?c:mI.stroke,strokeThickness:null!=(d=null!=K?K:null==(n=Z.style)?void 0:n.textStrokeWidth)?d:mI.strokeThickness,fontWeight:null!=(a=null==(s=Z.style)?void 0:s.textFontWeight)?a:mI.fontWeight}),D=new I.libraries.PIXI.TextStyle(k);g.textGraphics.length>g.textsBeingUsed?((v=g.textGraphics[g.textsBeingUsed]).style.fill=r,v.visible=!0,v.text=b,v.alpha=1):(v=new I.libraries.PIXI.Text(b,Object(m.a)(Object(m.a)({},k),{},{fill:r})),g.textGraphics.push(v));var z=I.libraries.PIXI.TextMetrics.measureText(b,D);g.textsBeingUsed++;var M=A.markVisibility(C,Object(m.a)(Object(m.a)({},z),{},{zoomLevel:g._xScale.invert(y)-g._xScale.invert(0)})),U=Math.min(M,N);if(!b||0===U)return g.textsBeingUsed--,void(v.visible=!1);v.alpha=U,v.anchor.y=.5,v.anchor.x="middle"===F?.5:"start"===F?0:1;var x=[];if(V){var T=X-(l+w-G)/B*Y,Q=aI(h,y,T,R,f,W,H);v.x=Q.x,v.y=Q.y,v.resolution=4;var P=z.width/(2*T*Math.PI)*y,O=h-P/2,j=h+P/2;if(O<0){var L=-O;O=0,j+=L}else if(j>y){var E=j-y;j=y,O-=E}for(var _=[],$=[],q=[],II=j;II>=O;II-=P/10){var gI=aI(II,y,T,R,f,W,H);_.push(new I.libraries.PIXI.Point(gI.x,gI.y));var CI=aI(II,y,T+z.height/2,R,f,W,H),AI=aI(II,y,T-z.height/2,R,f,W,H);$.push(CI.x,CI.y),II===j&&q.push(CI.y,CI.x),q.push(AI.y,AI.x)}v.updateText();var iI=new I.libraries.PIXI.SimpleRope(v.texture,_);iI.alpha=U,e.addChild(iI),q.reverse(),x=$.concat(q)}else{v.position.x=h,v.position.y=l+w-G,e.addChild(v);var eI=z.height,lI=z.width,oI=v.position.y-eI/2,tI=oI+eI,cI=0,nI=0;"start"===F?(cI=h,nI=h+lI):"middle"===F?(cI=h-lI/2,nI=h+lI/2):(cI=h-lI,nI=h),x=[cI,oI,cI,tI,nI,tI,nI,oI]}A.getMouseEventModel().addPolygonBasedEvent(C,x)}}))}))}(I,g,C,A);break;case"rule":!function(I,g,C,A){var i,e,l,o,t,c,n,d,s=A.spec(),a=A.data(),Z=Object(r.a)(g.dimensions,2),m=Z[0],b=Z[1],h="circular"===s.layout,G=null!=(i=s.innerRadius)?i:220,u=null!=(e=s.outerRadius)?e:300,y=null!=(l=s.startAngle)?l:0,B=null!=(o=s.endAngle)?o:360,V=u-G,p=m/2,X=b/2,W=null!=(t=A.getChannelDomainArray("row"))?t:["___SINGLE_ROW___"],H=b/W.length,Y=null==(c=s.style)?void 0:c.dashed,R=null==(n=s.style)?void 0:n.linePattern,f=null==(d=s.style)?void 0:d.curve,K=C.graphics;W.forEach((function(I){var C=A.encodedValue("row",I);a.filter((function(g){return!UI(g,s.row)||UI(g,s.row)===I})).forEach((function(I){var i=A.encodedPIXIProperty("x",I),e=A.encodedPIXIProperty("xe",I),l=A.encodedPIXIProperty("y",I),o=A.encodedPIXIProperty("color",I),t=A.encodedPIXIProperty("strokeWidth",I),c=A.encodedPIXIProperty("opacity",I),n=A.markVisibility(I,{width:e-i,zoomLevel:g._xScale.invert(m)-g._xScale.invert(0)}),d=Math.min(n,c);if(K.lineStyle(t,dI(o),d,.5),e||s.y&&"field"in s.y)if(!e&&l)if(h){K.lineStyle(t,dI(o),0,.5);var a=u-(C+l)/b*V,Z=a+t/2,G=a-t/2,W=aI(0,m,G,p,X,y,B),w=sI(0,m,y,B),J=sI(m,m,y,B);K.beginFill(dI(o),d),K.moveTo(W.x,W.y),K.arc(p,X,G,w,J,!0),K.arc(p,X,Z,J,w,!1),K.closePath()}else if(Y){var S=Object(r.a)(Y,2),F=S[0],N=S[1],v=0;do{K.moveTo(v,C+H-l),K.lineTo(v+F,C+H-l),v+=F+N}while(v<m)}else K.moveTo(0,C+H-l),K.lineTo(m,C+H-l);else{if(h){if(0===t)return;K.lineStyle(t,dI(o),0,.5);var k=u-(C+l)/b*V,D=k+t/2,z=k-t/2,M=aI(i,m,z,p,X,y,B),U=sI(i,m,y,B),x=sI(e,m,y,B);K.beginFill(dI(o),d),K.moveTo(M.x,M.y),K.arc(p,X,z,U,x,!0),K.arc(p,X,D,x,U,!1),K.closePath()}else if(Y){var T=Object(r.a)(Y,2),Q=T[0],P=T[1],O=i;do{K.moveTo(O,C+H-l),K.lineTo(O+Q,C+H-l),O+=Q+P}while(O<e)}else if(void 0===f)K.moveTo(i,C+H-l),K.lineTo(e,C+H-l);else if("top"===f){var j=i+(e-i)/2;K.moveTo(i,C+H-l+1),K.lineTo(j,C+H-l-1),K.moveTo(j,C+H-l-1),K.lineTo(e,C+H-l+1)}if(R&&void 0===f&&!h){var L=R.type,E=R.size,_=Math.max(i,0);K.lineStyle(0);for(var $=2*E,q=0;_<Math.min(e,m)&&q<100;){var II=_,gI=_+E,CI=C+H-l,AI=CI-E/2,iI=CI+E/2;K.beginFill(dI(o),d),K.drawPolygon("triangleLeft"===L?[gI,AI,II,CI,gI,iI,gI,AI]:[II,AI,gI,CI,II,iI,II,AI]),K.endFill(),_+=E+$,q++}}}else{if(h)return;if(Y){var eI=Object(r.a)(Y,2),lI=eI[0],oI=eI[1],tI=0;do{K.moveTo(i,tI),K.lineTo(i,tI+lI),tI+=lI+oI}while(tI<b)}else K.moveTo(i,0),K.lineTo(i,b)}}))}))}(0,g,C,A);break;case"betweenLink":BI(C.graphics,g,A);break;case"withinLink":bI(C.graphics,g,A);break;default:console.warn("Unsupported mark type")}}}function XI(I,g,C,A,i){if(I&&g&&C&&"brush"!==A.spec().mark){g.pBackground.clear(),g.pBackground.removeChildren(),g.pBorder.clear(),g.pBorder.removeChildren();var e="circular"===A.spec().layout;["x","x1","x1e","xe"].forEach((function(I){A.setChannelScale(I,g._xScale)})),e?function(I,g,C,A,i){var e,l,o,t,c,n,d,s,a,Z,m,b,h=A.spec(),G=Object(r.a)(g.position,2),u=G[0],y=G[1],B=Object(r.a)(g.dimensions,2),V=B[0],p=B[1],X=null!=(e=h.innerRadius)?e:220,W=null!=(l=h.outerRadius)?l:300,H=null!=(o=h.startAngle)?o:0,Y=null!=(t=h.endAngle)?t:360,R=u+V/2,f=y+p/2,K=aI(0,V,X,R,f,H,Y),w=sI(0,V,H,Y),J=sI(V,V,H,Y),S=g.pBackground;"circular"===h.layout&&"withinLink"===h.mark||(S.lineStyle((null==(c=h.style)?void 0:c.outlineWidth)?(null==(n=h.style)?void 0:n.outlineWidth)/2.5:0,dI(null!=(s=null==(d=h.style)?void 0:d.outline)?s:"#DBDBDB"),1,1),S.beginFill(dI(null!=(Z=null==(a=A.spec().style)?void 0:a.background)?Z:i.track.background),null!=(b=null==(m=A.spec().style)?void 0:m.backgroundOpacity)?b:i.track.background&&"transparent"!==i.track.background?1:0),S.moveTo(K.x,K.y),S.arc(R,f,X,w,J,!0),S.arc(R,f,W,J,w,!1),S.closePath()),DI(h.x)&&"top"===h.x.axis&&(S.lineStyle(.5,dI("black"),0,.5),S.beginFill(dI("white"),0),S.moveTo(K.x,K.y),S.arc(R,f,W-.5,w,J,!0),S.arc(R,f,W,J,w,!1),S.closePath()),S.lineStyle(.5,dI("black"),0,.5),S.beginFill(dI("white"),0),S.moveTo(R,f),S.arc(R,f,W+3,w,J,!1),S.closePath(),S.lineStyle(1,dI("#DBDBDB"),0,0),S.beginFill(dI("white"),0),S.drawCircle(R,f,X-1)}(0,g,0,A,i):(function(I,g,C,A,i){var e,l,o,t,c,n,d=Object(r.a)(g.position,2),s=d[0],a=d[1],Z=Object(r.a)(g.dimensions,2),m=Z[0],b=Z[1],h=g.pBackground;if((null==(e=A.spec().style)?void 0:e.background)||i.track.background&&"transparent"!==i.track.background){h.clear();var G=null!=(o=null==(l=A.spec().style)?void 0:l.background)?o:i.track.background,u=Object(f.a)(null==(t=A.spec().style)?void 0:t.backgroundOpacity)?1:null==(c=A.spec().style)?void 0:c.backgroundOpacity;h.lineStyle(1,dI("white"),0,0),h.beginFill(dI(G),u),h.drawRect(s,a,m,b)}if(i.track.alternatingBackground&&"transparent"!==i.track.alternatingBackground){var y=A.spec();if(!DI(y.row)||"nominal"!==y.row.type)return;var B=null!=(n=A.getChannelDomainArray("row"))?n:["___SINGLE_ROW___"];if(0===B.length)return;B.forEach((function(I,C){var e,l,o,t;if(C%2!==0){var c=A.encodedValue("row",I),n=null!=(l=null==(e=A.spec().style)?void 0:e.background)?l:i.track.alternatingBackground,d=Object(f.a)(null==(o=A.spec().style)?void 0:o.backgroundOpacity)?1:null==(t=A.spec().style)?void 0:t.backgroundOpacity;h.lineStyle(1,dI("white"),0,0),h.beginFill(dI(n),d),h.drawRect(g.position[0],g.position[1]+c,m,b/B.length)}}))}}(0,g,0,A,i),function(I,g,C,A){var i,e,l,o,t=g.pBorder,c=Object(r.a)(g.position,2),n=c[0],d=c[1],s=Object(r.a)(g.dimensions,2),a=s[0],Z=s[1];t.lineStyle(null!=(e=null==(i=C.spec().style)?void 0:i.outlineWidth)?e:1,dI(null!=(o=null==(l=C.spec().style)?void 0:l.outline)?o:A.track.outline),1,.5),t.beginFill(dI("white"),0),t.drawRect(n,d,a,Z);var m=C.spec().x;t.lineStyle(1,dI(A.axis.baselineColor),1,.5),DI(m)&&"top"===m.axis?(t.moveTo(n,d),t.lineTo(n+a,d)):DI(m)&&"bottom"===m.axis&&(t.moveTo(n,d+Z),t.lineTo(n+a,d+Z))}(0,g,A,i)),rI(g,A,i)}}function WI(I,g,C,A,i){if(I&&g&&C&&"brush"!==A.spec().mark){var e="circular"===A.spec().layout;["x","x1","x1e","xe"].forEach((function(I){A.setChannelScale(I,g._xScale)})),e?(function(I,g,C,A,i){var e,l,o,t,c,n=A.spec(),d="circular"===n.layout,s=A.getChannelDomainArray("y"),a=A.getChannelRangeArray("y");if(d&&A.isShowYAxis()&&s&&a){var Z=Object(r.a)(g.dimensions,2),m=Z[0],b=Z[1],h=null!=(e=n.innerRadius)?e:220,G=null!=(l=n.outerRadius)?l:300,u=G-h,y=null!=(o=n.startAngle)?o:0,B=null!=(t=n.endAngle)?t:360,V=m/2,p=b/2,X=null!=(c=A.getChannelDomainArray("row"))?c:["___SINGLE_ROW___"],H=b/X.length;if(!(H/b*u<=20)){var Y=A.spec().y,R=!DI(Y)||!("axis"in Y)||"right"!==Y.axis,f=Object(W.a)().domain(s).range(a),K=C.graphics;X.forEach((function(g){var C=A.encodedValue("row",g),e=G-C/b*u,l=aI(R?0:m,m,G-(C+H)/b*u,V,p,y,B),o=aI(R?0:m,m,e,V,p,y,B);K.lineStyle(1,dI(i.axis.baselineColor),1,.5),K.moveTo(l.x,l.y),K.lineTo(o.x,o.y);var t=function(I){return 6*m/2/Math.PI/I},c=function(I){return 8*m/2/Math.PI/I},n=H/b*u,d=Math.max(Math.ceil(n/40),1),a=f.ticks(d).filter((function(I){return s[0]<=I&&I<=s[1]}));1===a.length&&(a=f.ticks(d+1).filter((function(I){return s[0]<=I&&I<=s[1]}))),K.lineStyle(1,dI(i.axis.tickColor),1,.5),a.forEach((function(I){var g=f(I),A=G-(C+H-g)/b*u,i=R?0:m-t(A),e=R?t(A):m,l=aI(i,m,A,V,p,y,B),o=sI(i,m,y,B),c=sI(e,m,y,B);K.moveTo(l.x,l.y),K.arc(V,p,A,o,c,!0),K.arc(V,p,A,c,o,!1),K.closePath()}));var Z=R?0:m-c(h),r=R?c(h):m,X=sI(Z,m,y,B),W=sI(r,m,y,B);K.moveTo(l.x,l.y),K.arc(V,p,h,X,W,!0),K.arc(V,p,h,W,X,!1),K.closePath();var Y=R?0:m-c(G),w=R?c(G):m,J=sI(Y,m,y,B),S=sI(w,m,y,B);K.moveTo(o.x,o.y),K.arc(V,p,G,J,S,!0),K.arc(V,p,G,S,J,!1),K.closePath(),a.forEach((function(g){var A=f(g),e=G-(C+H-A)/b*u,l=aI(2*t(e),m,e,V,p,y,B),o=GI({color:i.axis.labelColor,size:i.axis.labelFontSize,fontFamily:i.axis.labelFontFamily,fontWeight:i.axis.labelFontWeight}),c=new I.libraries.PIXI.Text(g,o);c.anchor.x=R?1:0,c.anchor.y=.5,c.position.x=l.x,c.position.y=l.y,c.resolution=4;for(var n=new I.libraries.PIXI.TextStyle(o),d=I.libraries.PIXI.TextMetrics.measureText(c.text,n).width/(2*e*Math.PI)*m*360/(B-y),s=R?2*t(e):m-2*t(e)-d,a=[],Z=R?2*t(e)+d:m-2*t(e);Z>=s;Z-=d/10){var r=aI(Z,m,e,V,p,y,B);a.push(new I.libraries.PIXI.Point(r.x,r.y))}c.updateText();var h=new I.libraries.PIXI.SimpleRope(c.texture,a);K.addChild(h)}))}))}}}(I,g,C,A,i),function(I,g,C,A,i){var e,l,o,t=A.spec(),c=t.title;if("circular"===t.layout&&c){var n=Object(r.a)(g.dimensions,2),d=n[0],s=n[1],a=null!=(e=t.outerRadius)?e:300,Z=null!=(l=t.startAngle)?l:0,m=null!=(o=t.endAngle)?o:360,b=d/2,h=s/2,G=C.graphics,u=a-1,y=aI(1,d,u,b,h,Z,m),B=GI({color:i.track.titleColor,size:12,fontFamily:i.axis.labelFontFamily,fontWeight:i.axis.labelFontWeight}),V=new I.libraries.PIXI.Text(c,B);V.anchor.x=1,V.anchor.y=.5,V.position.x=y.x,V.position.y=y.y,V.resolution=4;for(var p=new I.libraries.PIXI.TextStyle(B),X=I.libraries.PIXI.TextMetrics.measureText(V.text,p),W=X.width/(2*u*Math.PI)*d*360/(m-Z),H=1+W,Y=[],R=H;R>=1;R-=W/10){var f=aI(R,d,u-X.height/2,b,h,Z,m);Y.push(new I.libraries.PIXI.Point(f.x,f.y))}var K=sI(1,d,Z,m),w=sI(H+1,d,Z,m);G.lineStyle(1,dI("red"),0,.5),G.beginFill(dI(i.track.titleBackground),.5),G.moveTo(y.x,y.y),G.arc(b,h,u-X.height,K,w,!0),G.arc(b,h,u,w,K,!1),G.closePath(),V.updateText();var J=new I.libraries.PIXI.SimpleRope(V.texture,Y);G.addChild(J)}}(I,g,C,A,i)):(function(I,g,C,A,i){var e,l="circular"===A.spec().layout,o=A.getChannelDomainArray("y"),t=A.getChannelRangeArray("y");if(!l&&A.isShowYAxis()&&o&&t){var c=Object(r.a)(g.dimensions,2),n=c[0],d=c[1],s=Object(r.a)(g.position,2),a=s[0],Z=s[1],m=null!=(e=A.getChannelDomainArray("row"))?e:["___SINGLE_ROW___"],b=d/m.length;if(!(b<=20)){var h=A.spec().y,G=!DI(h)||!("axis"in h)||"right"!==h.axis,u=Object(W.a)().domain(o).range(t),y=g.pBorder;m.forEach((function(g){var C=A.encodedValue("row",g),e=G?a:a+n,l=Z+C;y.lineStyle(1,dI(i.axis.baselineColor),1,.5),y.moveTo(e,l),y.lineTo(e,l+b);var t=Math.max(Math.ceil(b/40),1),c=u.ticks(t).filter((function(I){return o[0]<=I&&I<=o[1]}));1===c.length&&(c=u.ticks(t+1).filter((function(I){return o[0]<=I&&I<=o[1]}))),y.lineStyle(1,dI(i.axis.tickColor),1,.5);var d=G?e+6:e-6;c.forEach((function(I){var g=u(I);y.moveTo(e,l+b-g),y.lineTo(d,l+b-g)})),d=G?e+8:e-8,y.moveTo(e,l),y.lineTo(d,l),y.moveTo(e,l+b),y.lineTo(d,l+b);var s=GI({color:i.axis.labelColor,size:i.axis.labelFontSize,fontFamily:i.axis.labelFontFamily,fontWeight:i.axis.labelFontWeight});c.forEach((function(g){var C=u(g);d=G?e+12:e-12;var A=new I.libraries.PIXI.Text(g,s);A.anchor.x=G?0:1,A.anchor.y=0===C?.9:.5,A.position.x=d,A.position.y=l+b-C,y.addChild(A)}))}))}}}(I,g,0,A,i),function(I,g,C,A,i){var e,l=A.spec();if(DI(l.row)&&"nominal"===l.row.type&&l.row.legend){var o=null!=(e=A.getChannelDomainArray("row"))?e:["___SINGLE_ROW___"];if(0!==o.length){var t=g.pBorder,c=GI({color:i.legend.labelColor,size:i.legend.labelFontSize,fontWeight:i.legend.labelFontWeight,fontFamily:i.legend.labelFontFamily});o.forEach((function(C){var e=A.encodedValue("row",C),l=new I.libraries.PIXI.Text(C,c);l.anchor.x=0,l.anchor.y=0,l.position.x=g.position[0]+4,l.position.y=g.position[1]+e+2,t.addChild(l);var o=new I.libraries.PIXI.TextStyle(c),n=I.libraries.PIXI.TextMetrics.measureText(C,o);t.beginFill(dI(i.legend.background),i.legend.backgroundOpacity),t.lineStyle(1,dI(i.legend.backgroundStroke),0,0),t.drawRect(g.position[0]+1,g.position[1]+e+1,n.width+8,n.height+4)}))}}}(I,g,0,A,i)),uI(I,g,C,A,i)}}function HI(I){if(wI(I))return[];if(!FI(I))return[I];if(0===I.overlay.length)return[Object(m.a)(Object(m.a)({},I),{},{superpose:void 0})];var g=JSON.parse(JSON.stringify(I));delete g.overlay;var C=[];I.overlay.forEach((function(I,A){var i=Object.assign(JSON.parse(JSON.stringify(g)),I);i.title&&0!==A&&delete i.title,C.push(i)}));var A=void 0;return C.forEach((function(I){DI(I.x)&&I.x.axis&&!A&&(A=I.x.axis)})),C.map((function(I){return Object(m.a)(Object(m.a)({},I),{},{x:Object(m.a)(Object(m.a)({},I.x),{},{axis:A})})}))}function YI(I){if(0===I.length)return!1;var g=I.filter((function(I){return I}));if(g.length!==I.length)return!1;var C=Object.keys(g[0]).sort(),A=!0;return C.forEach((function(I){1===Array.from(new Set(g.map((function(g){return JSON.stringify(g[I])})))).length||(A=!1)})),A}var RI,fI={viridis:F.a,grey:N.a,warm:v.a,spectral:k.a,cividis:D.a,bupu:z.a,rdbu:M.a,hot:U.a,pink:x.a};function KI(I){return!("alignment"in I)&&!I.tracks.find((function(I){return"overlay"===I.alignment||"tracks"in I}))}function wI(I){return!FI(I)&&"data"in I&&!("mark"in I)}function JI(I){return"object"===typeof I}function SI(I){return!("overlay"in I)}function FI(I){return"overlay"in I}function NI(I){var g=SI(I)?I:HI(I)[0];return DI(g.x)&&"genomic"===g.x.type&&DI(g.y)&&"genomic"===g.y.type}function vI(I){return null!==I&&"object"===typeof I&&"value"in I}function kI(I){return void 0!==I&&("vector"===I.type||"beddb"===I.type||"multivec"===I.type||"bigwig"===I.type||"matrix"===I.type||"bam"===I.type||"vcf"===I.type)}function DI(I){return"object"===typeof I&&!("value"in I)}function zI(I){return Object(K.a)(I)}function MI(I){return("bar"===I.mark||"area"===I.mark||"text"===I.mark)&&DI(I.color)&&"nominal"===I.color.type&&(!I.row||vI(I.row))&&DI(I.y)&&"quantitative"===I.y.type&&!DI(I.ye)}function UI(I,g){if(DI(g)&&g.field)return I[null==g?void 0:g.field]}function xI(I,g){var C=[];return VI.forEach((function(A){var i=I[A];DI(i)&&i.type===g&&C.push(A)})),C}function TI(I){if((SI(I)||FI(I))&&DI(I.x)&&I.x.axis&&"none"!==I.x.axis)return!0;if(FI(I)){var g=!1;return I.overlay.forEach((function(I){g||DI(I.x)&&I.x.axis&&"none"!==I.x.axis&&(g=!0)})),g}return!1}function QI(I){return"object"===typeof I}var PI=new Uint8Array(16);function OI(){if(!RI&&!(RI="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return RI(PI)}var jI=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function LI(I){return"string"===typeof I&&jI.test(I)}for(var EI,_I,$I=[],qI=0;qI<256;++qI)$I.push((qI+256).toString(16).substr(1));function Ig(I){var g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=($I[I[g+0]]+$I[I[g+1]]+$I[I[g+2]]+$I[I[g+3]]+"-"+$I[I[g+4]]+$I[I[g+5]]+"-"+$I[I[g+6]]+$I[I[g+7]]+"-"+$I[I[g+8]]+$I[I[g+9]]+"-"+$I[I[g+10]]+$I[I[g+11]]+$I[I[g+12]]+$I[I[g+13]]+$I[I[g+14]]+$I[I[g+15]]).toLowerCase();if(!LI(C))throw TypeError("Stringified UUID is invalid");return C}var gg=0,Cg=0;function Ag(I,g,C){var A=g&&C||0,i=g||new Array(16),e=(I=I||{}).node||EI,l=void 0!==I.clockseq?I.clockseq:_I;if(null==e||null==l){var o=I.random||(I.rng||OI)();null==e&&(e=EI=[1|o[0],o[1],o[2],o[3],o[4],o[5]]),null==l&&(l=_I=16383&(o[6]<<8|o[7]))}var t=void 0!==I.msecs?I.msecs:Date.now(),c=void 0!==I.nsecs?I.nsecs:Cg+1,n=t-gg+(c-Cg)/1e4;if(n<0&&void 0===I.clockseq&&(l=l+1&16383),(n<0||t>gg)&&void 0===I.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");gg=t,Cg=c,_I=l;var d=(1e4*(268435455&(t+=122192928e5))+c)%4294967296;i[A++]=d>>>24&255,i[A++]=d>>>16&255,i[A++]=d>>>8&255,i[A++]=255&d;var s=t/4294967296*1e4&268435455;i[A++]=s>>>8&255,i[A++]=255&s,i[A++]=s>>>24&15|16,i[A++]=s>>>16&255,i[A++]=l>>>8|128,i[A++]=255&l;for(var a=0;a<6;++a)i[A+a]=e[a];return g||Ig(i)}function ig(I,g,C){function A(I,A,i,e){if("string"===typeof I&&(I=function(I){I=unescape(encodeURIComponent(I));for(var g=[],C=0;C<I.length;++C)g.push(I.charCodeAt(C));return g}(I)),"string"===typeof A&&(A=function(I){if(!LI(I))throw TypeError("Invalid UUID");var g,C=new Uint8Array(16);return C[0]=(g=parseInt(I.slice(0,8),16))>>>24,C[1]=g>>>16&255,C[2]=g>>>8&255,C[3]=255&g,C[4]=(g=parseInt(I.slice(9,13),16))>>>8,C[5]=255&g,C[6]=(g=parseInt(I.slice(14,18),16))>>>8,C[7]=255&g,C[8]=(g=parseInt(I.slice(19,23),16))>>>8,C[9]=255&g,C[10]=(g=parseInt(I.slice(24,36),16))/1099511627776&255,C[11]=g/4294967296&255,C[12]=g>>>24&255,C[13]=g>>>16&255,C[14]=g>>>8&255,C[15]=255&g,C}(A)),16!==A.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var l=new Uint8Array(16+I.length);if(l.set(A),l.set(I,A.length),(l=C(l))[6]=15&l[6]|g,l[8]=63&l[8]|128,i){e=e||0;for(var o=0;o<16;++o)i[e+o]=l[o];return i}return Ig(l)}try{A.name=I}catch(i){}return A.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",A.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",A}function eg(I){return 14+(I+64>>>9<<4)+1}function lg(I,g){var C=(65535&I)+(65535&g);return(I>>16)+(g>>16)+(C>>16)<<16|65535&C}function og(I,g,C,A,i,e){return lg((l=lg(lg(g,I),lg(A,e)))<<(o=i)|l>>>32-o,C);var l,o}function tg(I,g,C,A,i,e,l){return og(g&C|~g&A,I,g,i,e,l)}function cg(I,g,C,A,i,e,l){return og(g&A|C&~A,I,g,i,e,l)}function ng(I,g,C,A,i,e,l){return og(g^C^A,I,g,i,e,l)}function dg(I,g,C,A,i,e,l){return og(C^(g|~A),I,g,i,e,l)}function sg(I,g,C){var A=(I=I||{}).random||(I.rng||OI)();if(A[6]=15&A[6]|64,A[8]=63&A[8]|128,g){C=C||0;for(var i=0;i<16;++i)g[C+i]=A[i];return g}return Ig(A)}function ag(I,g,C,A){switch(I){case 0:return g&C^~g&A;case 1:case 3:return g^C^A;case 2:return g&C^g&A^C&A}}function Zg(I,g){return I<<g|I>>>32-g}function mg(I,g){var C=I?JSON.parse(JSON.stringify(I)):{};return g?Object.assign(C,g):C}function bg(I,g){"tracks"in I?I.tracks.forEach((function(I,C,A){g(I,C,A),bg(I,g)})):"views"in I&&I.views.forEach((function(I){return bg(I,g)}))}function rg(I,g){"tracks"in I?I.tracks.forEach((function(I){g(I),rg(I,g)})):"views"in I&&I.views.forEach((function(I){g(I),rg(I,g)}))}function hg(I,g){"tracks"in I||(g(I),I.views.forEach((function(I){hg(I,g)})))}function Gg(I){if(KI(I)){var g=JSON.parse(JSON.stringify(I));return delete g.tracks,I.tracks.filter((function(I){return!I._invalidTrack})).map((function(I){return Object.assign(JSON.parse(JSON.stringify(g)),I)}))}var C,A=[];return KI(C=I)||function(I){return"alignment"in I&&"overlay"===I.alignment}(C)?A.push(Object(m.a)(Object(m.a)({},I),{},{overlay:Object(b.a)(I.tracks.filter((function(I){return!I._invalidTrack}))),tracks:void 0,alignment:void 0})):I.tracks.filter((function(I){return!I._invalidTrack})).map((function(g){if("alignment"in g)A.push(Object(m.a)(Object(m.a)({},g),{},{overlay:Object(b.a)(g.tracks),tracks:void 0,alignment:void 0}));else{var C=JSON.parse(JSON.stringify(I));delete C.tracks;var i=Object.assign(JSON.parse(JSON.stringify(C)),g);A.push(i)}})),JSON.parse(JSON.stringify(A))}function ug(I,g){if(g?(void 0===I.assembly&&(I.assembly=g.assembly),void 0===I.layout&&(I.layout=g.layout),void 0===I.orientation&&(I.orientation=g.orientation),void 0===I.static&&(I.static=void 0!==g.static&&g.static),void 0===I.zoomLimits&&(I.zoomLimits=g.zoomLimits),void 0===I.xDomain&&(I.xDomain=g.xDomain),void 0===I.yDomain&&(I.yDomain=g.yDomain),void 0===I.linkingId&&(I.linkingId=g.linkingId),void 0===I.centerRadius&&(I.centerRadius=g.centerRadius),void 0!==I.spacing||"tracks"in I||(I.spacing=g.spacing),void 0===I.xOffset&&(I.xOffset=g.xOffset),void 0===I.yOffset&&(I.yOffset=g.yOffset),"views"in I&&"arrangement"in g&&void 0===I.arrangement&&(I.arrangement=g.arrangement),I.style=mg(g.style,I.style)):(void 0===I.assembly&&(I.assembly="hg38"),void 0===I.layout&&(I.layout="linear"),void 0===I.orientation&&(I.orientation="horizontal"),void 0===I.static&&(I.static=!1),void 0===I.zoomLimits&&(I.zoomLimits=[1,null]),void 0===I.centerRadius&&(I.centerRadius=.3),void 0===I.spacing&&(I.spacing=nI),"views"in I&&void 0===I.arrangement&&(I.arrangement="vertical"),void 0===I.xOffset&&(I.xOffset=0),void 0===I.yOffset&&(I.yOffset=0)),"tracks"in I){var C=Gg(I);C=function(I){var g;return(g=[]).concat.apply(g,Object(b.a)(I.map((function(I){if(wI(I)||!FI(I)||I.overlay.length<=1)return[I];if(0===I.overlay.filter((function(I){return I.data})).length)return[I];if(YI([I.data].concat(Object(b.a)(I.overlay.map((function(I){return I.data}))))))return[I];var g=JSON.parse(JSON.stringify(I));delete g.overlay;var C=[],A=JSON.parse(JSON.stringify(g));return A.overlay=[],I.overlay.forEach((function(I){if(A.data||(A.data=I.data),I.data&&!YI([A.data,I.data])){var i=Object.assign(JSON.parse(JSON.stringify(g)),I);C.push(i)}else A.overlay.push(I)})),(A.overlay.length>0?[A].concat(C):C).map((function(I,g,C){var A=0!==g,i=SI(I)&&DI(I.y)&&!I.y.axis&&A?Object(m.a)(Object(m.a)({},I.y),{},{axis:1===g?"right":"none"}):SI(I)?I.y:void 0;return I.title&&g!==C.length-1&&1!==C.length&&delete I.title,Object(m.a)(Object(m.a)({},I),{},{overlayOnPreviousTrack:A,y:i})}))}))))}(C);var A=sg();C.forEach((function(g,i,e){var l,o,t;if(g.width||(g.width=360),g.height||(g.height=180),"displacement"in g)if("pile"===(null==(l=g.displacement)?void 0:l.type)&&void 0===g.row&&DI(g.x)&&g.x.field&&DI(g.xe)&&g.xe.field){var c=sg(),n={type:"displace",newField:c,boundingBox:{startField:g.x.field,endField:g.xe.field,padding:g.displacement.padding},method:"pile"};g.dataTransform||(g.dataTransform=[]),g.dataTransform=[].concat(Object(b.a)(g.dataTransform),[n]),g.row={field:c,type:"nominal"}}else null==(o=g.displacement)||o.type;if(g.layout&&(g.layout=void 0),g.zoomLimits&&(g.zoomLimits=void 0),g.assembly||(g.assembly=I.assembly),g.layout||(g.layout=I.layout),g.orientation||(g.orientation=I.orientation),void 0===g.static&&(g.static=void 0!==I.static&&I.static),g.zoomLimits||(g.zoomLimits=I.zoomLimits),g.style=mg(I.style,g.style),FI(g)&&g.overlay.forEach((function(I){I.style=mg(g.style,I.style)})),"circular"!==g.layout&&!NI(g)||"vertical"!==g.orientation||(g.orientation="horizontal"),NI(g)&&(g.layout="linear",(SI(g)||FI(g))&&DI(g.y)&&!g.y.domain?g.y.domain=I.yDomain:FI(g)&&g.overlay.forEach((function(g){DI(g.y)&&!g.y.domain&&(g.y.domain=I.yDomain)}))),(SI(g)||FI(g))&&DI(g.x)&&!g.x.domain?g.x.domain=I.xDomain:FI(g)&&g.overlay.forEach((function(g){DI(g.x)&&!g.x.domain&&(g.x.domain=I.xDomain)})),(SI(g)||FI(g))&&DI(g.x)&&!g.x.linkingId)g.x.linkingId=null!=(t=I.linkingId)?t:A;else if(FI(g)){var d=!1;g.overlay.forEach((function(g){var C;d||DI(g.x)&&!g.x.linkingId&&(g.x.linkingId=null!=(C=I.linkingId)?C:A,d=!0)}))}0===i&&(g.overlayOnPreviousTrack=!1),(0===i||0!==i&&1===C.slice(0,i).filter((function(I){return!I.overlayOnPreviousTrack})).length&&!0===g.overlayOnPreviousTrack)&&((SI(g)||FI(g))&&DI(g.x)&&!g.x.axis?"vertical"===g.orientation?g.x.axis="left":g.x.axis="top":FI(g)&&g.overlay.forEach((function(I){DI(I.x)&&!I.x.axis&&("vertical"===g.orientation?I.x.axis="left":I.x.axis="top")}))),(SI(g)||FI(g))&&DI(g.x)&&g.x.axis&&"none"!==g.x.axis?"vertical"===g.orientation?"top"===g.x.axis?g.x.axis="left":"bottom"===g.x.axis&&(g.x.axis="right"):"left"===g.x.axis?g.x.axis="top":"right"===g.x.axis&&(g.x.axis="bottom"):FI(g)&&g.overlay.forEach((function(I){DI(I.x)&&I.x.axis&&"none"!==I.x.axis&&("vertical"===g.orientation?"top"===I.x.axis?I.x.axis="left":"bottom"===I.x.axis&&(I.x.axis="right"):"left"===I.x.axis?I.x.axis="top":"right"===I.x.axis&&(I.x.axis="bottom"))})),0!==i&&(i===e.length-1&&e.slice(0,i+1).filter((function(I){return I.overlayOnPreviousTrack})).length<i||i!==e.length-1&&e.slice(i+1).filter((function(I){return I.overlayOnPreviousTrack})).length===e.length-i-1&&e.slice(0,i+1).filter((function(I){return I.overlayOnPreviousTrack})).length<i)&&(SI(g)&&"withinLink"===g.mark&&void 0===g.flipY?g.flipY=!0:FI(g)&&("withinLink"===g.mark&&void 0===g.flipY&&(g.flipY=!0),g.overlay.forEach((function(I){"withinLink"===I.mark&&void 0===I.flipY&&(I.flipY=!0)})))),g.overlayOnPreviousTrack&&e[i-1]&&(g.width=e[i-1].width,g.height=e[i-1].height,g.layout=e[i-1].layout,g.assembly=e[i-1].assembly)})),I.tracks=C}else I.views.forEach((function(g){ug(g,I)}))}ig("v3",48,(function(I){if("string"===typeof I){var g=unescape(encodeURIComponent(I));I=new Uint8Array(g.length);for(var C=0;C<g.length;++C)I[C]=g.charCodeAt(C)}return function(I){for(var g=[],C=32*I.length,A="0123456789abcdef",i=0;i<C;i+=8){var e=I[i>>5]>>>i%32&255,l=parseInt(A.charAt(e>>>4&15)+A.charAt(15&e),16);g.push(l)}return g}(function(I,g){I[g>>5]|=128<<g%32,I[eg(g)-1]=g;for(var C=1732584193,A=-271733879,i=-1732584194,e=271733878,l=0;l<I.length;l+=16){var o=C,t=A,c=i,n=e;C=tg(C,A,i,e,I[l],7,-680876936),e=tg(e,C,A,i,I[l+1],12,-389564586),i=tg(i,e,C,A,I[l+2],17,606105819),A=tg(A,i,e,C,I[l+3],22,-1044525330),C=tg(C,A,i,e,I[l+4],7,-176418897),e=tg(e,C,A,i,I[l+5],12,1200080426),i=tg(i,e,C,A,I[l+6],17,-1473231341),A=tg(A,i,e,C,I[l+7],22,-45705983),C=tg(C,A,i,e,I[l+8],7,1770035416),e=tg(e,C,A,i,I[l+9],12,-1958414417),i=tg(i,e,C,A,I[l+10],17,-42063),A=tg(A,i,e,C,I[l+11],22,-1990404162),C=tg(C,A,i,e,I[l+12],7,1804603682),e=tg(e,C,A,i,I[l+13],12,-40341101),i=tg(i,e,C,A,I[l+14],17,-1502002290),C=cg(C,A=tg(A,i,e,C,I[l+15],22,1236535329),i,e,I[l+1],5,-165796510),e=cg(e,C,A,i,I[l+6],9,-1069501632),i=cg(i,e,C,A,I[l+11],14,643717713),A=cg(A,i,e,C,I[l],20,-373897302),C=cg(C,A,i,e,I[l+5],5,-701558691),e=cg(e,C,A,i,I[l+10],9,38016083),i=cg(i,e,C,A,I[l+15],14,-660478335),A=cg(A,i,e,C,I[l+4],20,-405537848),C=cg(C,A,i,e,I[l+9],5,568446438),e=cg(e,C,A,i,I[l+14],9,-1019803690),i=cg(i,e,C,A,I[l+3],14,-187363961),A=cg(A,i,e,C,I[l+8],20,1163531501),C=cg(C,A,i,e,I[l+13],5,-1444681467),e=cg(e,C,A,i,I[l+2],9,-51403784),i=cg(i,e,C,A,I[l+7],14,1735328473),C=ng(C,A=cg(A,i,e,C,I[l+12],20,-1926607734),i,e,I[l+5],4,-378558),e=ng(e,C,A,i,I[l+8],11,-2022574463),i=ng(i,e,C,A,I[l+11],16,1839030562),A=ng(A,i,e,C,I[l+14],23,-35309556),C=ng(C,A,i,e,I[l+1],4,-1530992060),e=ng(e,C,A,i,I[l+4],11,1272893353),i=ng(i,e,C,A,I[l+7],16,-155497632),A=ng(A,i,e,C,I[l+10],23,-1094730640),C=ng(C,A,i,e,I[l+13],4,681279174),e=ng(e,C,A,i,I[l],11,-358537222),i=ng(i,e,C,A,I[l+3],16,-722521979),A=ng(A,i,e,C,I[l+6],23,76029189),C=ng(C,A,i,e,I[l+9],4,-640364487),e=ng(e,C,A,i,I[l+12],11,-421815835),i=ng(i,e,C,A,I[l+15],16,530742520),C=dg(C,A=ng(A,i,e,C,I[l+2],23,-995338651),i,e,I[l],6,-198630844),e=dg(e,C,A,i,I[l+7],10,1126891415),i=dg(i,e,C,A,I[l+14],15,-1416354905),A=dg(A,i,e,C,I[l+5],21,-57434055),C=dg(C,A,i,e,I[l+12],6,1700485571),e=dg(e,C,A,i,I[l+3],10,-1894986606),i=dg(i,e,C,A,I[l+10],15,-1051523),A=dg(A,i,e,C,I[l+1],21,-2054922799),C=dg(C,A,i,e,I[l+8],6,1873313359),e=dg(e,C,A,i,I[l+15],10,-30611744),i=dg(i,e,C,A,I[l+6],15,-1560198380),A=dg(A,i,e,C,I[l+13],21,1309151649),C=dg(C,A,i,e,I[l+4],6,-145523070),e=dg(e,C,A,i,I[l+11],10,-1120210379),i=dg(i,e,C,A,I[l+2],15,718787259),A=dg(A,i,e,C,I[l+9],21,-343485551),C=lg(C,o),A=lg(A,t),i=lg(i,c),e=lg(e,n)}return[C,A,i,e]}(function(I){if(0===I.length)return[];for(var g=8*I.length,C=new Uint32Array(eg(g)),A=0;A<g;A+=8)C[A>>5]|=(255&I[A/8])<<A%32;return C}(I),8*I.length))})),ig("v5",80,(function(I){var g=[1518500249,1859775393,2400959708,3395469782],C=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"===typeof I){var A=unescape(encodeURIComponent(I));I=[];for(var i=0;i<A.length;++i)I.push(A.charCodeAt(i))}else Array.isArray(I)||(I=Array.prototype.slice.call(I));I.push(128);for(var e=I.length/4+2,l=Math.ceil(e/16),o=new Array(l),t=0;t<l;++t){for(var c=new Uint32Array(16),n=0;n<16;++n)c[n]=I[64*t+4*n]<<24|I[64*t+4*n+1]<<16|I[64*t+4*n+2]<<8|I[64*t+4*n+3];o[t]=c}o[l-1][14]=8*(I.length-1)/Math.pow(2,32),o[l-1][14]=Math.floor(o[l-1][14]),o[l-1][15]=8*(I.length-1)&4294967295;for(var d=0;d<l;++d){for(var s=new Uint32Array(80),a=0;a<16;++a)s[a]=o[d][a];for(var Z=16;Z<80;++Z)s[Z]=Zg(s[Z-3]^s[Z-8]^s[Z-14]^s[Z-16],1);for(var m=C[0],b=C[1],r=C[2],h=C[3],G=C[4],u=0;u<80;++u){var y=Math.floor(u/20),B=Zg(m,5)+ag(y,b,r,h)+G+g[y]+s[u]>>>0;G=h,h=r,r=Zg(b,30)>>>0,b=m,m=B}C[0]=C[0]+m>>>0,C[1]=C[1]+b>>>0,C[2]=C[2]+r>>>0,C[3]=C[3]+h>>>0,C[4]=C[4]+G>>>0}return[C[0]>>24&255,C[0]>>16&255,C[0]>>8&255,255&C[0],C[1]>>24&255,C[1]>>16&255,C[1]>>8&255,255&C[1],C[2]>>24&255,C[2]>>16&255,C[2]>>8&255,255&C[2],C[3]>>24&255,C[3]>>16&255,C[3]>>8&255,255&C[3],C[4]>>24&255,C[4]>>16&255,C[4]>>8&255,255&C[4]]}));var yg=[{name:"gene",channels:[{name:"startPosition",type:"genomic",required:!0},{name:"endPosition",type:"genomic",required:!0},{name:"strandColor",type:"nominal",required:!0},{name:"strandRow",type:"nominal",required:!0},{name:"opacity",type:"value",required:!1},{name:"geneHeight",type:"value",required:!1},{name:"geneLabel",type:"nominal",required:!0},{name:"geneLabelColor",type:"nominal",required:!0},{name:"geneLabelFontSize",type:"value",required:!1},{name:"geneLabelStroke",type:"value",required:!1},{name:"geneLabelStrokeThickness",type:"value",required:!1},{name:"geneLabelOpacity",type:"value",required:!1},{name:"type",type:"nominal",required:!0}],mapping:[{dataTransform:[{type:"filter",base:"type",oneOf:["gene"]},{type:"filter",base:"strandColor",oneOf:["-"]}],mark:"triangleLeft",x:{base:"startPosition",type:"genomic"},size:{base:"geneHeight",value:12},row:{base:"strandRow",type:"nominal",domain:["+","-"]},color:{base:"strandColor",type:"nominal",domain:["+","-"],range:["blue","red"]},opacity:{base:"opacity",value:.4},style:{align:"right"}},{dataTransform:[{type:"filter",base:"type",oneOf:["gene"]},{type:"filter",base:"strandColor",oneOf:["+"]}],mark:"triangleRight",x:{base:"endPosition",type:"genomic"},size:{base:"geneHeight",value:12},row:{base:"strandRow",type:"nominal",domain:["+","-"]},color:{base:"strandColor",type:"nominal",domain:["+","-"],range:["blue","red"]},opacity:{base:"opacity",value:.4},style:{align:"left"}},{dataTransform:[{type:"filter",base:"type",oneOf:["exon"]}],mark:"rect",x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},size:{base:"geneHeight",value:12},row:{base:"strandRow",type:"nominal",domain:["+","-"]},color:{base:"strandColor",type:"nominal",domain:["+","-"],range:["blue","red"]},opacity:{base:"opacity",value:.4}},{dataTransform:[{type:"filter",base:"type",oneOf:["gene"]},{type:"filter",base:"strandColor",oneOf:["+"]}],mark:"rect",x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},row:{base:"strandRow",type:"nominal",domain:["+","-"]},color:{base:"strandColor",type:"nominal",domain:["+","-"],range:["blue","red"]},opacity:{base:"opacity",value:.4},size:{value:3}},{dataTransform:[{type:"filter",base:"type",oneOf:["gene"]},{type:"filter",base:"strandColor",oneOf:["-"]}],mark:"rect",x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},row:{base:"strandRow",type:"nominal",domain:["+","-"]},color:{base:"strandColor",type:"nominal",domain:["+","-"],range:["blue","red"]},opacity:{base:"opacity",value:.4},size:{value:3}},{dataTransform:[{type:"filter",base:"type",oneOf:["gene"]}],mark:"text",text:{base:"geneLabel",type:"nominal"},x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},row:{base:"strandRow",type:"nominal",domain:["+","-"]},color:{base:"geneLabelColor",type:"nominal",domain:["+","-"],range:["blue","red"]},opacity:{base:"opacity",value:1},size:{base:"geneLabelFontSize",value:18},stroke:{base:"geneLabelStroke",value:"white"},strokeWidth:{base:"geneLabelStrokeThickness",value:2},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}]}]},{name:"ideogram",channels:[{name:"startPosition",type:"genomic",required:!0},{name:"endPosition",type:"genomic",required:!0},{name:"chrHeight",type:"value",required:!1},{name:"name",type:"nominal",required:!0},{name:"stainBackgroundColor",type:"nominal",required:!0},{name:"stainLabelColor",type:"nominal",required:!0},{name:"stainStroke",type:"value",required:!1},{name:"stainStrokeWidth",type:"value",required:!1}],mapping:[{mark:"rect",dataTransform:[{type:"filter",base:"stainBackgroundColor",oneOf:["acen"],not:!0}],color:{base:"stainBackgroundColor",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar","acen"],range:["white","lightgray","gray","gray","black","#7B9CC8","#DC4542"]},size:{base:"chrHeight",value:18},x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},stroke:{base:"stainStroke",value:"gray"},strokeWidth:{base:"stainStrokeWidth",value:.3}},{mark:"triangleRight",dataTransform:[{type:"filter",base:"stainBackgroundColor",oneOf:["acen"]},{type:"filter",base:"name",include:"q"}],color:{base:"stainBackgroundColor",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar","acen"],range:["white","lightgray","gray","gray","black","#7B9CC8","#DC4542"]},size:{base:"chrHeight",value:18},x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},stroke:{base:"stainStroke",value:"gray"},strokeWidth:{base:"stainStrokeWidth",value:.3}},{mark:"triangleLeft",dataTransform:[{type:"filter",base:"stainBackgroundColor",oneOf:["acen"]},{type:"filter",base:"name",include:"p"}],color:{base:"stainBackgroundColor",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar","acen"],range:["white","lightgray","gray","gray","black","#7B9CC8","#DC4542"]},size:{base:"chrHeight",value:18},x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},stroke:{base:"stainStroke",value:"gray"},strokeWidth:{base:"stainStrokeWidth",value:.3}},{mark:"text",dataTransform:[{type:"filter",base:"stainLabelColor",oneOf:["acen"],not:!0}],color:{base:"stainLabelColor",type:"nominal",domain:["gneg","gpos25","gpos50","gpos75","gpos100","gvar"],range:["black","black","black","black","white","black"]},text:{base:"name",type:"nominal"},x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:10,target:"mark"}]}]},{name:"sequence",channels:[{name:"startPosition",type:"genomic",required:!0},{name:"endPosition",type:"genomic",required:!0},{name:"barLength",type:"quantitative",required:!0},{name:"baseBackground",type:"nominal",required:!0},{name:"baseLabelColor",type:"nominal",required:!0},{name:"baseLabelFontSize",type:"value",required:!1}],mapping:[{mark:"bar",x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},y:{base:"barLength",type:"quantitative",axis:"none"},color:{base:"baseBackground",type:"nominal",domain:["A","T","G","C"]}},{dataTransform:[{type:"filter",base:"barLength",oneOf:[0],not:!0}],mark:"text",x:{base:"startPosition",type:"genomic"},xe:{base:"endPosition",type:"genomic"},color:{base:"baseLabelColor",type:"nominal",domain:["A","T","G","C"],range:["white"]},text:{base:"baseBackground",type:"nominal"},size:{base:"baseLabelFontSize",value:18},visibility:[{operation:"less-than",measure:"width",threshold:"|xe-x|",transitionPadding:30,target:"mark"},{operation:"LT",measure:"zoomLevel",threshold:10,target:"track"}]}]}];function Bg(I,g){if((C=(I=g?I.toExponential(g-1):I.toExponential()).indexOf("e"))<0)return null;var C,A=I.slice(0,C);return[A.length>1?A[0]+A.slice(2):A,+I.slice(C+1)]}function Vg(I){return(I=Bg(Math.abs(I)))?I[1]:NaN}var pg,Xg=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Wg(I){if(!(g=Xg.exec(I)))throw new Error("invalid format: "+I);var g;return new Hg({fill:g[1],align:g[2],sign:g[3],symbol:g[4],zero:g[5],width:g[6],comma:g[7],precision:g[8]&&g[8].slice(1),trim:g[9],type:g[10]})}function Hg(I){this.fill=void 0===I.fill?" ":I.fill+"",this.align=void 0===I.align?">":I.align+"",this.sign=void 0===I.sign?"-":I.sign+"",this.symbol=void 0===I.symbol?"":I.symbol+"",this.zero=!!I.zero,this.width=void 0===I.width?void 0:+I.width,this.comma=!!I.comma,this.precision=void 0===I.precision?void 0:+I.precision,this.trim=!!I.trim,this.type=void 0===I.type?"":I.type+""}function Yg(I,g){var C=Bg(I,g);if(!C)return I+"";var A=C[0],i=C[1];return i<0?"0."+new Array(-i).join("0")+A:A.length>i+1?A.slice(0,i+1)+"."+A.slice(i+1):A+new Array(i-A.length+2).join("0")}Wg.prototype=Hg.prototype,Hg.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Rg={"%":function(I,g){return(100*I).toFixed(g)},b:function(I){return Math.round(I).toString(2)},c:function(I){return I+""},d:function(I){return Math.abs(I=Math.round(I))>=1e21?I.toLocaleString("en").replace(/,/g,""):I.toString(10)},e:function(I,g){return I.toExponential(g)},f:function(I,g){return I.toFixed(g)},g:function(I,g){return I.toPrecision(g)},o:function(I){return Math.round(I).toString(8)},p:function(I,g){return Yg(100*I,g)},r:Yg,s:function(I,g){var C=Bg(I,g);if(!C)return I+"";var A=C[0],i=C[1],e=i-(pg=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,l=A.length;return e===l?A:e>l?A+new Array(e-l+1).join("0"):e>0?A.slice(0,e)+"."+A.slice(e):"0."+new Array(1-e).join("0")+Bg(I,Math.max(0,g+e-1))[0]},X:function(I){return Math.round(I).toString(16).toUpperCase()},x:function(I){return Math.round(I).toString(16)}};function fg(I){return I}var Kg,wg,Jg,Sg=Array.prototype.map,Fg=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function Ng(I){var g,C,A=void 0===I.grouping||void 0===I.thousands?fg:(g=Sg.call(I.grouping,Number),C=I.thousands+"",function(I,A){for(var i=I.length,e=[],l=0,o=g[0],t=0;i>0&&o>0&&(t+o+1>A&&(o=Math.max(1,A-t)),e.push(I.substring(i-=o,i+o)),!((t+=o+1)>A));)o=g[l=(l+1)%g.length];return e.reverse().join(C)}),i=void 0===I.currency?"":I.currency[0]+"",e=void 0===I.currency?"":I.currency[1]+"",l=void 0===I.decimal?".":I.decimal+"",o=void 0===I.numerals?fg:function(I){return function(g){return g.replace(/[0-9]/g,(function(g){return I[+g]}))}}(Sg.call(I.numerals,String)),t=void 0===I.percent?"%":I.percent+"",c=void 0===I.minus?"-":I.minus+"",n=void 0===I.nan?"NaN":I.nan+"";function d(I){var g=(I=Wg(I)).fill,C=I.align,d=I.sign,s=I.symbol,a=I.zero,Z=I.width,m=I.comma,b=I.precision,r=I.trim,h=I.type;"n"===h?(m=!0,h="g"):Rg[h]||(void 0===b&&(b=12),r=!0,h="g"),(a||"0"===g&&"="===C)&&(a=!0,g="0",C="=");var G="$"===s?i:"#"===s&&/[boxX]/.test(h)?"0"+h.toLowerCase():"",u="$"===s?e:/[%p]/.test(h)?t:"",y=Rg[h],B=/[defgprs%]/.test(h);function V(I){var i,e,t,s=G,V=u;if("c"===h)V=y(I)+V,I="";else{var p=(I=+I)<0||1/I<0;if(I=isNaN(I)?n:y(Math.abs(I),b),r&&(I=function(I){I:for(var g,C=I.length,A=1,i=-1;A<C;++A)switch(I[A]){case".":i=g=A;break;case"0":0===i&&(i=A),g=A;break;default:if(!+I[A])break I;i>0&&(i=0)}return i>0?I.slice(0,i)+I.slice(g+1):I}(I)),p&&0===+I&&"+"!==d&&(p=!1),s=(p?"("===d?d:c:"-"===d||"("===d?"":d)+s,V=("s"===h?Fg[8+pg/3]:"")+V+(p&&"("===d?")":""),B)for(i=-1,e=I.length;++i<e;)if(48>(t=I.charCodeAt(i))||t>57){V=(46===t?l+I.slice(i+1):I.slice(i))+V,I=I.slice(0,i);break}}m&&!a&&(I=A(I,1/0));var X=s.length+I.length+V.length,W=X<Z?new Array(Z-X+1).join(g):"";switch(m&&a&&(I=A(W+I,W.length?Z-V.length:1/0),W=""),C){case"<":I=s+I+V+W;break;case"=":I=s+W+I+V;break;case"^":I=W.slice(0,X=W.length>>1)+s+I+V+W.slice(X);break;default:I=W+s+I+V}return o(I)}return b=void 0===b?6:/[gprs]/.test(h)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b)),V.toString=function(){return I+""},V}return{format:d,formatPrefix:function(I,g){var C=d(((I=Wg(I)).type="f",I)),A=3*Math.max(-8,Math.min(8,Math.floor(Vg(g)/3))),i=Math.pow(10,-A),e=Fg[8+A/3];return function(I){return C(i*I)+e}}}}Kg=Ng({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),wg=Kg.format,Jg=Kg.formatPrefix;var vg={chr1:248956422,chr2:242193529,chr3:198295559,chr4:190214555,chr5:181538259,chr6:170805979,chr7:159345973,chr8:145138636,chr9:138394717,chr10:133797422,chr11:135086622,chr12:133275309,chr13:114364328,chr14:107043718,chr15:101991189,chr16:90338345,chr17:83257441,chr18:80373285,chr19:58617616,chr20:64444167,chr21:46709983,chr22:50818468,chrX:156040895,chrY:57227415},kg={chr1:249250621,chr2:243199373,chr3:198022430,chr4:191154276,chr5:180915260,chr6:171115067,chr7:159138663,chr8:146364022,chr9:141213431,chr10:135534747,chr11:135006516,chr12:133851895,chr13:115169878,chr14:107349540,chr15:102531392,chr16:90354753,chr17:81195210,chr18:78077248,chr19:59128983,chr20:63025520,chr21:48129895,chr22:51304566,chrX:155270560,chrY:59373566,chrM:16571},Dg={chr1:247249719,chr2:242951149,chr3:199501827,chr4:191273063,chr5:180857866,chr6:170899992,chr7:158821424,chr8:146274826,chr9:140273252,chr10:135374737,chr11:134452384,chr12:132349534,chr13:114142980,chr14:106368585,chr15:100338915,chr16:88827254,chr17:78774742,chr18:76117153,chr19:63811651,chr20:62435964,chr21:46944323,chr22:49691432,chrX:154913754,chrY:57772954,chrM:16571},zg={chr1:245522847,chr2:243018229,chr3:199505740,chr4:191411218,chr5:180857866,chr6:170975699,chr7:158628139,chr8:146274826,chr9:138429268,chr10:135413628,chr11:134452384,chr12:132449811,chr13:114142980,chr14:106368585,chr15:100338915,chr16:88827254,chr17:78774742,chr18:76117153,chr19:63811651,chr20:62435964,chr21:46944323,chr22:49554710,chrX:154824264,chrY:57701691,chrM:16571},Mg={chr1:246127941,chr2:243615958,chr3:199344050,chr4:191731959,chr5:181034922,chr6:170914576,chr7:158545518,chr8:146308819,chr9:136372045,chr10:135037215,chr11:134482954,chr12:132078379,chr13:113042980,chr14:105311216,chr15:100256656,chr16:90041932,chr17:81860266,chr18:76115139,chr19:63811651,chr20:63741868,chr21:46976097,chr22:49396972,chrX:153692391,chrY:50286555,chrM:16571},Ug={chr1:195471971,chr2:182113224,chr3:160039680,chr4:156508116,chr5:151834684,chr6:149736546,chr7:145441459,chr8:129401213,chr9:124595110,chr10:130694993,chr11:122082543,chr12:120129022,chr13:120421639,chr14:124902244,chr15:104043685,chr16:98207768,chr17:94987271,chr18:90702639,chr19:61431566,chrX:171031299,chrY:91744698,chrM:16299},xg={chr1:197195432,chr2:181748087,chr3:159599783,chr4:155630120,chr5:152537259,chr6:149517037,chr7:152524553,chr8:131738871,chr9:124076172,chr10:129993255,chr11:121843856,chr12:121257530,chr13:120284312,chr14:125194864,chr15:103494974,chr16:98319150,chr17:95272651,chr18:90772031,chr19:61342430,chrX:166650296,chrY:15902555,chrM:16299};function Tg(I,g){var C,A=null!=(C=Object.entries(Qg(g).interval).find((function(g){var C=Object(r.a)(g[1],2),A=C[0],i=C[1];return A<=I&&I<i})))?C:[null,null],i=Object(r.a)(A,2),e=i[0],l=i[1];return e&&l?{chromosome:e,position:I-l[0]}:{chromosome:"unknown",position:I}}function Qg(I){return I&&I in Og?Og[I]:Og.hg38}var Pg=function(I){return"https://s3.amazonaws.com/gosling-lang.org/data/".concat(I,".chrom.sizes")},Og=Object.freeze({hg38:{size:vg,interval:jg(vg),total:Lg(vg),path:Pg("hg38")},hg19:{size:kg,interval:jg(kg),total:Lg(kg),path:Pg("hg19")},hg18:{size:Dg,interval:jg(Dg),total:Lg(Dg),path:Pg("hg18")},hg17:{size:zg,interval:jg(zg),total:Lg(zg),path:Pg("hg17")},hg16:{size:Mg,interval:jg(Mg),total:Lg(Mg),path:Pg("hg16")},mm10:{size:Ug,interval:jg(Ug),total:Lg(Ug),path:Pg("mm10")},mm9:{size:xg,interval:jg(xg),total:Lg(xg),path:Pg("mm9")},unknown:{size:{chr:Number.MAX_VALUE},interval:{chr:[0,Number.MAX_VALUE]},total:Number.MAX_VALUE,path:Pg("hg38")}});function jg(I){var g={};return Object.keys(I).reduce((function(C,A){return g[A]=[C,C+I[A]],C+I[A]}),0),g}function Lg(I){return Object.values(I).reduce((function(I,g){return I+g}),0)}var Eg=7829367,_g=function(I,g){var C;function A(){if(!(this instanceof A?this.constructor:void 0))throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');return g.apply(void 0,arguments)}return A.config=Object(m.a)(Object(m.a)({},I),{},{availableOptions:Object.keys(null!=(C=I.defaultOptions)?C:{})}),A}({type:"axis-track",datatype:["multivec","epilogos"],local:!1,orientation:"1d-horizontal",thumbnail:(new DOMParser).parseFromString('<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 5640 5420" preserveAspectRatio="xMidYMid meet"> <g id="layer101" fill="#000000" stroke="none"> <path d="M0 2710 l0 -2710 2820 0 2820 0 0 2710 0 2710 -2820 0 -2820 0 0 -2710z"/> </g> <g id="layer102" fill="#750075" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> <path d="M4340 2710 l0 -2510 560 0 560 0 0 2510 0 2510 -560 0 -560 0 0 -2510z"/> <path d="M200 1870 l0 -1670 630 0 630 0 0 1670 0 1670 -630 0 -630 0 0 -1670z"/> <path d="M1660 1810 l0 -1610 570 0 570 0 0 1610 0 1610 -570 0 -570 0 0 -1610z"/> <path d="M3000 840 l0 -640 570 0 570 0 0 640 0 640 -570 0 -570 0 0 -640z"/> </g> <g id="layer103" fill="#ffff04" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> </g> </svg>',"text/xml").documentElement,defaultOptions:{innerRadius:340,outerRadius:310,startAngle:0,endAngle:360,width:700,height:700,layout:"linear",labelPosition:"none",labelColor:"black",labelTextOpacity:.4,trackBorderWidth:0,trackBorderColor:"black",tickPositions:"even",fontSize:12,fontFamily:"sans-serif",fontWeight:"normal",color:"#808080",stroke:"#ffffff",backgroundColor:"transparent",showMousePosition:!1,tickColor:Eg}},(function(I,g,C){var A=I.utils,i=A.absToChr,e=A.colorToHex,l=A.pixiTextToSvg,o=A.svgLine,h=A.showMousePosition;function G(g,C){return Object.assign(new I.libraries.PIXI.Text(g,C),{hashValue:Math.random()})}var u=function(A){Object(a.a)(y,A);var u=Object(Z.a)(y);function y(){var A;Object(t.a)(this,y),A=u.call(this,g,C);var i=g.dataConfig,l=g.animate,o=g.chromInfoPath,c=g.isShowGlobalMousePosition;A.searchField=null,A.dataConfig=i,A.allTexts=[],A.pTicksCircular=new I.libraries.PIXI.Graphics,A.pTicks=new I.libraries.PIXI.Graphics,A.pMain.addChild(A.pTicks),A.pMain.addChild(A.pTicksCircular),A.gTicks={},A.tickTexts={},A.options=C,A.isShowGlobalMousePosition=c,A.pixiTextConfig=GI({size:+A.options.fontSize,fontFamily:A.options.fontFamily,fontWeight:A.options.fontWeight,color:A.options.color,stroke:A.options.stroke,strokeThickness:2}),A.stroke=e(A.pixiTextConfig.stroke),A.tickWidth=200,A.tickHeight=6,A.tickTextSeparation=2,A.tickColor=e(A.options.tickColor),A.animate=l,A.pubSubs=[],A.options.showMousePosition&&!A.hideMousePosition&&(A.hideMousePosition=h(Object(n.a)(A),A.is2d,A.isShowGlobalMousePosition()));o||"".concat(i.server,"/chrom-sizes/?id=").concat(i.tilesetUid);var d=A.options.assembly,s={},a=Object(m.a)({},Qg(d).size),Z=[];return Object.keys(Qg(d).size).forEach((function(I){s[I]={chr:I,pos:Qg(d).size[I]}})),Object.keys(Qg(d).interval).forEach((function(I){Z.push({chr:I,pos:Qg(d).interval[I][0]})})),A.chromInfo={chrPositions:s,chromLengths:a,cumPositions:Z},A.rerender(A.options,!0),A.draw(),A.animate(),A}return Object(c.a)(y,[{key:"initBoundsTicks",value:function(){this.pTicks&&(this.pMain.removeChild(this.pTicks),this.pTicks=null),this.gBoundTicks||(this.gBoundTicks=new I.libraries.PIXI.Graphics,this.leftBoundTick=G("",this.pixiTextConfig),this.rightBoundTick=G("",this.pixiTextConfig),this.gBoundTicks.addChild(this.leftBoundTick),this.gBoundTicks.addChild(this.rightBoundTick),this.pMain.addChild(this.gBoundTicks)),this.texts=[]}},{key:"initChromLabels",value:function(){var g=this;this.chromInfo&&(this.gBoundTicks&&(this.pMain.removeChild(this.gBoundTicks),this.gBoundTicks=void 0),this.pTicks||(this.pTicks=new I.libraries.PIXI.Graphics,this.pMain.addChild(this.pTicks)),this.texts=[],this.pTicks.removeChildren(),this.chromInfo.cumPositions.forEach((function(C){var A,i,e,l=C.chr;g.gTicks[l]=new I.libraries.PIXI.Graphics,g.tickTexts[l]||(g.tickTexts[l]=[]);var o=G(l,g.pixiTextConfig);null==(A=g.pTicks)||A.addChild(o),null==(i=g.pTicks)||i.addChild(g.gTicks[l]),null==(e=g.texts)||e.push(o)})))}},{key:"rerender",value:function(I,g){var C=JSON.stringify(I);(g||C!==this.prevOptions)&&(this.prevOptions=C,this.options=I,this.pixiTextConfig.fontSize=+this.options.fontSize?"".concat(+this.options.fontSize,"px"):this.pixiTextConfig.fontSize,this.pixiTextConfig.fill=this.options.color||this.pixiTextConfig.fill,this.pixiTextConfig.stroke=this.options.stroke||this.pixiTextConfig.stroke,this.stroke=e(this.pixiTextConfig.stroke),this.tickColor=this.options.tickColor?e(this.options.tickColor):Eg,"ends"===this.options.tickPositions&&"circular"!==this.options.layout?this.initBoundsTicks():this.initChromLabels(),Object(d.a)(Object(s.a)(y.prototype),"rerender",this).call(this,I,g),this.options.showMousePosition&&!this.hideMousePosition&&(this.hideMousePosition=h(this,this.is2d,this.isShowGlobalMousePosition())),!this.options.showMousePosition&&this.hideMousePosition&&(this.hideMousePosition(),this.hideMousePosition=void 0))}},{key:"formatTick",value:function(I){if(isNaN(I))return"null";var g,C,A=this._xScale.domain(),i=A[1]-A[0],e=(g=I,C=i,Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Vg(C)/3)))-Vg(Math.abs(g)))),l=wg(","),o=Jg(",.".concat(e),i),t=l;return"si"===this.options.tickFormat?t=o:"plain"===this.options.tickFormat?t=l:"ends"===this.options.tickPositions&&(t=o),t(I)}},{key:"drawBoundsTicks",value:function(I,g){if(this.gBoundTicks&&this.leftBoundTick&&this.rightBoundTick){var C=this.gBoundTicks;C.clear(),C.lineStyle(1,0);var A=this.options.reverseOrientation?0:this.dimensions[1],i=this.options.reverseOrientation?this.tickHeight:this.dimensions[1]-this.tickHeight;C.moveTo(1,A),C.lineTo(1,i),C.moveTo(this.dimensions[0]-1,A),C.lineTo(this.dimensions[0]-1,i),this.leftBoundTick.x=0,this.leftBoundTick.y=this.options.reverseOrientation?i+this.tickTextSeparation:i-this.tickTextSeparation,this.leftBoundTick.text="unknown"===this.options.assembly?"".concat(this.formatTick(I[1])):"".concat(I[0],": ").concat(this.formatTick(I[1])),this.leftBoundTick.anchor.y=this.options.reverseOrientation?0:1,this.rightBoundTick.x=this.dimensions[0],this.rightBoundTick.text="unknown"===this.options.assembly?"".concat(this.formatTick(g[1])):"".concat(g[0],": ").concat(this.formatTick(g[1])),this.rightBoundTick.y=this.options.reverseOrientation?i+this.tickTextSeparation:i-this.tickTextSeparation,this.rightBoundTick.anchor.y=this.options.reverseOrientation?0:1,this.rightBoundTick.anchor.x=1,this.flipText&&(this.leftBoundTick.scale.x=-1,this.leftBoundTick.anchor.x=1,this.rightBoundTick.scale.x=-1,this.rightBoundTick.anchor.x=0),this.leftBoundTick.tickLine=[1,this.dimensions[1],1,this.dimensions[1]-this.tickHeight],this.rightBoundTick.tickLine=[this.dimensions[0]-1,this.dimensions[1],this.dimensions[0]-1,this.dimensions[1]-this.tickHeight],this.tickTexts={},this.tickTexts.all=[this.leftBoundTick,this.rightBoundTick]}}},{key:"drawTicks",value:function(I){var g=this.gTicks[I.chr];g.visible=!0,g.clear();var C=+this.chromInfo.chromLengths[I.chr],A=Math.max(this._xScale(I.pos),0),i=Math.min(this._xScale(I.pos+C),this.dimensions[0]),e=(i-A)/this.tickWidth,l=Object(W.a)().domain([Math.max(1,this._xScale.invert(0)-I.pos),Math.min(C,this._xScale.invert(this.dimensions[0])-I.pos)]).range([A,i]).ticks(e).filter((function(I){return Number.isInteger(I)})),o=this.tickTexts[I.chr],t=this.tickHeight,c=t+this.tickTextSeparation;for(this.options.reverseOrientation&&(c=this.dimensions[1]-c);o.length<l.length;){var n=G("",this.pixiTextConfig);o.push(n),this.gTicks[I.chr].addChild(n)}for(;o.length>l.length;){var d=o.pop();this.gTicks[I.chr].removeChild(d)}for(var s=0;s<l.length;){o[s].visible=!0,o[s].anchor.x=.5,o[s].anchor.y="circular"===this.options.layout||this.options.reverseOrientation?0:1,this.flipText&&(o[s].scale.x=-1);var a="unknown"===this.options.assembly?"":"".concat(I.chr,": ");o[s].text=0===l[s]?"".concat(a,"1"):"".concat(a).concat(this.formatTick(l[s]));var Z=this._xScale(I.pos+l[s]);if("circular"===this.options.layout){var m=this.addCurvedText(o[s],Z+0);m&&this.pTicksCircular.addChild(m)}else{o[s].x=Z+0,o[s].y=this.dimensions[1]-c,o[s].tickLine=[Z-1,this.dimensions[1],Z-1,this.dimensions[1]-t-1];var b=this.options.reverseOrientation?0:this.dimensions[1],r=this.options.reverseOrientation?t:this.dimensions[1]-t;g.lineStyle(1,this.tickColor),g.moveTo(Z,b),g.lineTo(Z,r)}s+=1}for("circular"===this.options.layout&&(s=0);s<o.length;)o[s].visible=!1,s+=1;return l.length}},{key:"addCurvedText",value:function(g,C){var A=Object(r.a)(this.dimensions,2),i=A[0],e=A[1],l=this.options,o=l.startAngle,t=l.endAngle,c=Math.min(i,e)/Math.min(this.options.width,this.options.height),n=this.options.innerRadius*c,d=(this.options.outerRadius*c+n)/2,s=aI(C,i,d,i/2,e/2,o,t);g.x=s.x,g.y=s.y,g.resolution=4;var a=new I.libraries.PIXI.TextStyle(this.pixiTextConfig),Z=I.libraries.PIXI.TextMetrics.measureText(g.text,a),m=Z.width/(2*d*Math.PI)*i*360/(t-o),b=C-m/2,h=C+m/2;if(b<0){var G=-b;b=0,h+=G}else if(h>i){var u=h-i;h=i,b-=u}for(var y=[],B=n+Z.height/2+3,V=h;V>=b;V-=m/10){var p=aI(V,i,B,i/2,e/2,o,t);y.push(new I.libraries.PIXI.Point(p.x,p.y))}if(0!==y.length)return g.updateText(),new I.libraries.PIXI.SimpleRope(g.texture,y)}},{key:"draw",value:function(){var I=this;if(this.allTexts=[],this.texts){var g=i(this._xScale.domain()[0],this.chromInfo),C=i(this._xScale.domain()[1],this.chromInfo);if(g&&C){if("ends"===this.options.tickPositions&&"circular"!==this.options.layout){if(!this.gBoundTicks)return;return this.gBoundTicks.visible=!0,void this.drawBoundsTicks(g,C)}if(this.pTicks){for(var A="circular"===this.options.layout,e=0;e<this.texts.length;e++)this.texts[e].visible=!1,this.gTicks[this.chromInfo.cumPositions[e].chr].visible=!1;var l=this.tickHeight+this.tickTextSeparation;this.options.reverseOrientation&&(l=this.dimensions[1]-l),Object.keys(this.chromInfo.chrPositions).forEach((function(g){I.tickTexts[g]&&I.tickTexts[g].forEach((function(I){I.visible=!1}))})),this.pTicksCircular.removeChildren();for(var o=g[3];o<=C[3];o++){var t=this.chromInfo.cumPositions[o],c=t.pos+this.chromInfo.chromLengths[t.chr]/2,n=this._xScale(c),d=this.texts[o];d.anchor.x=.5,d.anchor.y=A?.5:this.options.reverseOrientation?0:1;var s=void 0;A?(s=this.addCurvedText(d,n))&&this.pTicksCircular.addChild(s):(d.x=n,d.y=this.dimensions[1]-l),d.updateTransform(),this.flipText&&(d.scale.x=-1);var a=this.drawTicks(t);A?a>0&&s&&this.pTicksCircular.removeChild(s):d.visible=a<=0,this.allTexts.push({importance:d.hashValue,text:d,rope:s})}this.hideOverlaps(this.allTexts)}}else console.warn("Empty chromInfo:",this.dataConfig,this.chromInfo)}}},{key:"hideOverlaps",value:function(I){var g=this,C=new O.a;I.sort((function(I,g){return g.importance-I.importance})).forEach((function(I){var A=I.text,i=I.rope;A.updateTransform();var e=A.getBounds(),l={minX:e.x-5,minY:e.y-5,maxX:e.x+e.width+10,maxY:e.y+e.height+10};C.collides(l)?(A.visible=!1,"circular"===g.options.layout&&i&&g.pTicksCircular.removeChild(i)):C.insert(l)}))}},{key:"setPosition",value:function(I){Object(d.a)(Object(s.a)(y.prototype),"setPosition",this).call(this,I);var g=Object(r.a)(this.position,2);this.pMain.position.x=g[0],this.pMain.position.y=g[1]}},{key:"zoomed",value:function(I,g){0===[].concat(Object(b.a)(I.domain()),Object(b.a)(g.domain())).filter((function(I){return isNaN(I)})).length&&(this.xScale(I),this.yScale(g),this.draw())}},{key:"exportSVG",value:function(){var I=this,g=null,C=null;if(Object(d.a)(Object(s.a)(y.prototype),"exportSVG",this)){var A=Object(d.a)(Object(s.a)(y.prototype),"exportSVG",this).call(this),i=Object(r.a)(A,2);C=i[0],g=i[1]}else g=C=document.createElement("g");C.setAttribute("class","chromosome-labels");var e=document.createElement("g");return g.appendChild(e),e.setAttribute("transform","translate(".concat(this.position[0],",").concat(this.position[1],")")),this.allTexts.filter((function(I){return I.text.visible})).forEach((function(I){var g=l(I.text);e.appendChild(g)})),Object.values(this.tickTexts).forEach((function(g){g.filter((function(I){return I.visible})).forEach((function(g){if(g.tickLine){var C=l(g);e.appendChild(C),C=o(g.x,I.options.reverseOrientation?0:I.dimensions[1],g.x,I.options.reverseOrientation?I.tickHeight:I.dimensions[1]-I.tickHeight,1,I.tickColor);var A=document.createElement("line");A.setAttribute("x1",String(g.tickLine[0])),A.setAttribute("y1",String(g.tickLine[1])),A.setAttribute("x2",String(g.tickLine[2])),A.setAttribute("y2",String(g.tickLine[3])),A.setAttribute("style","stroke: grey"),e.appendChild(C),e.appendChild(A)}}))})),[C,g]}}]),y}(I.tracks.PixiTrack);return new u}));function $g(I){if(!(this instanceof $g?this.constructor:void 0))throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');for(var g=function(g){Object(a.a)(A,g);var C=Object(Z.a)(A);function A(I){var g,i,e;Object(t.a)(this,A),g=C.call.apply(C,[this].concat(Object(b.a)(I)));var l=Object(r.a)(I,2),o=l[0],c=l[1],d=o.registerViewportChanged,s=o.removeViewportChanged,a=o.setDomainsCallback;g.uid=Ag(),g.options=c,g.hasFromView=!o.projectionXDomain,g.removeViewportChanged=s,g.setDomainsCallback=a,g.viewportXDomain=g.hasFromView?null:o.projectionXDomain,g.viewportYDomain=g.hasFromView?null:[0,0],g.prevExtent=[0,0],g.RR=.02;var Z=[0,1.7*Math.PI];return g.circularBrushData=g.getBrushData(Z),g.brush=Object(j.a)().innerRadius(null!=(i=g.options.innerRadius)?i:100).outerRadius(null!=(e=g.options.outerRadius)?e:200),g.gBrush=g.gMain.append("g").attr("id","brush-".concat(g.uid)).selectAll(".brush").data(g.circularBrushData).enter().append("path").attr("class","brush").attr("d",g.brush).attr("fill",g.options.projectionFillColor).attr("stroke",g.options.projectionStrokeColor).attr("fill-opacity",(function(I){return"brush"===I.type?g.options.projectionFillOpacity:0})).attr("stroke-opacity",(function(I){return"brush"===I.type?g.options.projectionStrokeOpacity:0})).attr("stroke-width",g.options.strokeWidth).style("pointer-events","all").style("cursor",(function(I){return I.cursor})).call(g.dragged()),d(g.uid,g.viewportChanged.bind(Object(n.a)(g))),g.draw(),g}return Object(c.a)(A,[{key:"getBrushData",value:function(I){return[{type:"brush",startAngle:I[0],endAngle:I[1],cursor:"grab"},{type:"start",startAngle:I[0],endAngle:I[0]+this.RR,cursor:"move"},{type:"end",startAngle:I[1]-this.RR,endAngle:I[1],cursor:"move"}]}},{key:"cropExtent",value:function(I){for(var g=Object(r.a)(I,2),C=g[0],A=g[1],i=0;(C>2*Math.PI||A>2*Math.PI||C<0||A<0)&&!(i++>10);)C>2*Math.PI||A>2*Math.PI?(C-=2*Math.PI,A-=2*Math.PI):(C<0||A<0)&&(C+=2*Math.PI,A+=2*Math.PI);return[C,A].sort((function(I,g){return I-g}))}},{key:"updateBrush",value:function(I){var g=Object(r.a)(I,2),C=g[0],A=g[1];C<=0&&A<=0||C>=2*Math.PI-0&&A>=2*Math.PI-0?this.gBrush.attr("visibility","hidden"):(C<0&&(C=0),C>2*Math.PI-0&&(C=2*Math.PI-0),A<0&&(A=0),A>2*Math.PI-0&&(A=2*Math.PI-0),this.circularBrushData=this.getBrushData(I),this.gBrush.data(this.circularBrushData).attr("d",this.brush).attr("visibility","visible"))}},{key:"dragged",value:function(){var g=this;return I.libraries.d3Drag.drag().on("start",(function(){g.startEvent=I.libraries.d3Selection.event.sourceEvent,g.prevExtent=[g.circularBrushData[0].startAngle,g.circularBrushData[0].endAngle]})).on("drag",(function(C){var A=Object(r.a)(g.position,2),i=A[0],e=A[1],l=Object(r.a)(g.dimensions,2),o=l[0],t=l[1],c=I.libraries.d3Selection.event.sourceEvent,n=g.startEvent.layerX-i,d=g.startEvent.layerY-e,s=c.layerX-i,a=c.layerY-e,Z=Math.atan2(n-o/2,d-t/2)-Math.atan2(s-o/2,a-t/2),m=Object(r.a)(g.prevExtent,2),b=m[0],h=m[1];if("brush"===C.type){if(h+=Z,(b+=Z)<0||2*Math.PI-0<h){var G=0-b,u=h-(2*Math.PI-0);G>u?(h+=G,b+=G):(b-=u,h-=u)}}else"start"===C.type?b+=Z:"end"===C.type&&(h+=Z);var y=g.cropExtent([b,h]),B=Object(r.a)(y,2);if(b=B[0],h=B[1],g._xScale&&g._yScale){var V=(g.options.endAngle-g.options.startAngle)/360,p=b-g.options.startAngle/360*Math.PI*2,X=h-g.options.startAngle/360*Math.PI*2,W=[g._xScale.invert(o-o*X/(2*Math.PI*V)),g._xScale.invert(o-o*p/(2*Math.PI*V))],H=g.viewportYDomain;g.hasFromView||(g.viewportXDomain=W),g.setDomainsCallback(W,H),g.updateBrush([b,h])}}))}},{key:"draw",value:function(){if(this._xScale&&this.yScale&&this.viewportXDomain&&this.viewportYDomain){var I=this._xScale(this.viewportXDomain[0]),g=this._xScale(this.viewportXDomain[1]),C=Object(r.a)(this.dimensions,1)[0],A=sI(I,C,this.options.startAngle,this.options.endAngle)+Math.PI/2,i=sI(g,C,this.options.startAngle,this.options.endAngle)+Math.PI/2,e=this.cropExtent([i,A]),l=Object(r.a)(e,2);i=l[0],A=l[1],this.updateBrush([i,A])}}},{key:"viewportChanged",value:function(I,g){var C=I.domain(),A=g.domain();this.viewportXDomain=C,this.viewportYDomain=A,this.draw()}},{key:"remove",value:function(){this.removeViewportChanged(this.uid),Object(d.a)(Object(s.a)(A.prototype),"remove",this).call(this)}},{key:"rerender",value:function(){}},{key:"zoomed",value:function(I,g){this.xScale(I),this.yScale(g),this.draw()}},{key:"setPosition",value:function(I){Object(d.a)(Object(s.a)(A.prototype),"setPosition",this).call(this,I),this.draw()}},{key:"setDimensions",value:function(I){Object(d.a)(Object(s.a)(A.prototype),"setDimensions",this).call(this,I),this.gBrush.attr("transform","translate(".concat(I[0]/2,",").concat(I[1]/2,")")),this.draw()}}]),A}(I.tracks.SVGTrack),C=arguments.length,A=new Array(C>1?C-1:0),i=1;i<C;i++)A[i-1]=arguments[i];return new g(A)}function qg(I,g){var C=I.field,A=I.not,i=Array.from(g);if("oneOf"in I){var e=I.oneOf;i=i.filter((function(I){return A?-1===e.indexOf(I[C]):-1!==e.indexOf(I[C])}))}else if(function(I){return"inRange"in I}(I)){var l=I.inRange;i=i.filter((function(I){return A?!(l[0]<=I[C]&&I[C]<=l[1]):l[0]<=I[C]&&I[C]<=l[1]}))}else if(function(I){return"include"in I}(I)){var o=I.include;i=i.filter((function(I){return A?"".concat(I[C]).includes(o):!"".concat(I[C]).includes(o)}))}return i}function IC(I,g){var C=I.fields,A=I.separator,i=I.newField,e=Array.from(g);return e=e.map((function(I){var g=C.map((function(g){return I[g]}));return I[i]=g.join(A),I}))}function gC(I,g){var C=I.field,A=I.replace,i=I.newField,e=Array.from(g);return e=e.map((function(I){return I[i]=I[C],A.forEach((function(g){var C=g.from,A=g.to;I[i]=I[i].toString().replaceAll(C,A)})),I}))}function CC(I,g){var C=I.field,A=I.base,i=I.newField,e=Array.from(g);return e=e.map((function(I){return+I[C]&&(I[null!=i?i:C]="e"===A?Math.log(+I[C]):Math.log(+I[C])/Math.log(null!=A?A:10)),I}))}function AC(I,g){var C=I.startField,A=I.endField,i=I.newField,e=Array.from(g);return e.forEach((function(I){var g=I[C],e=I[A];g&&e&&(I[i]=Math.abs(+e-+g))})),e}function iC(I,g){var C=I.firstBp,A=I.secondBp,i=I.newField,e=Array.from(g);return e.forEach((function(I){if(I[C.chrField]===I[A.chrField]){var g=I[C.posField],e=I[A.posField],l=I[C.strandField],o=I[A.strandField];if(g>e){var t=g,c=l;g=e,l=o,e=t,o=c}switch("".concat(l).concat(o)){case"+-":I[i]="DEL";break;case"--":I[i]="t2tINV";break;case"++":I[i]="h2hINV";break;case"-+":I[i]="DUP";break;default:I[i]="unknown"}}else I[i]="TRA"})),e}function eC(I,g,C){var A=I.startField,i=I.endField,e=I.newField,l=I.groupField,t={};return g.forEach((function(I){for(var g=C(I[A]),e=C(I[i]),o=l?I[l]:"__NO_GROUP__",c=Math.floor(g);c<e;c+=1)t[o]||(t[o]={}),t[o][c]||(t[o][c]=0),t[o][c]++})),Object.entries(t).flatMap((function(I){var g=Object(r.a)(I,2),t=g[0],c=g[1];return Object.entries(c).map((function(I){var g,c=Object(r.a)(I,2),n=c[0],d=c[1];return g={},Object(o.a)(g,A,C.invert(+n)),Object(o.a)(g,i,C.invert(+n+1)),Object(o.a)(g,null!=e?e:"coverage",d),Object(o.a)(g,null!=l?l:"group",t),g}))}))}function lC(I,g,C){var A=I.boundingBox,i=I.method,e=I.newField,l=A.startField,o=A.endField,t=A.groupField,c=0;A.padding&&C&&!A.isPaddingBP?c=Math.abs(C.invert(A.padding)-C.invert(0)):A.padding&&A.isPaddingBP&&(c=A.padding);var n=Array.from(g);if(n&&n.length>0&&(!Object.keys(n[0]).find((function(I){return I===l}))||!Object.keys(n[0]).find((function(I){return I===o}))))return n;if("pile"===i){var d=I.maxRows,s={};n.sort((function(I,g){return I[l]-g[l]})).forEach((function(I){var g=I[l]-c,C=I[o]+c,A=t?I[t]:"__NO_GROUP__";s[A]||(s[A]=[]);var i=s[A].findIndex((function(I){return C<I.start?(I.start=g,!0):I.end<g&&(I.end=C,!0)}));-1===i&&(s[A].push({start:g,end:C}),i=s[A].length-1),I[e]="".concat(d&&d<=i?d-1:i)}))}else if("spread"===i){var a=[];n.sort((function(I,g){return I[l]-g[l]})).forEach((function(I){var g=I[l]-c,C=I[o]+c,A=a.filter((function(I){return I.start===g&&C===I.end||I.start<g&&g<I.end||I.start<C&&C<I.end||g<I.start&&I.end<C}));if(A.length>0){var i=0;do{(A=a.filter((function(I){return I.start===g&&C===I.end||I.start<g&&g<I.end||I.start<C&&C<I.end||g<I.start&&I.end<C}))).length>0&&(i%2===0?(g+=c*i,C+=c*i):(g-=c*i,C-=c*i)),i++}while(A.length>0&&i<1e3)}I["".concat(e,"Start")]="".concat(g+c),I["".concat(e,"Etart")]="".concat(C-c),a.push({start:g,end:C})}))}return n}function oC(I,g){var C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"hg38",A=I.separator,i=I.fields,e=I.flag,l=Array.from(g);return l=l.map((function(I){var g=[];return i.forEach((function(i){var l=i.field,t=i.type,c=i.newField,n=i.chrField;I[l].toString().split(A).forEach((function(A,i){var l,d=A;("genomic"===t&&(d=Qg(C).interval[I[n]][0]+ +A),g[i])?g[i][c]=d:g[i]=Object.assign(JSON.parse(JSON.stringify(I)),(l={},Object(o.a)(l,c,d),Object(o.a)(l,e.field,e.value),l))}))})),[I].concat(g)})).reduce((function(I,g){return I.concat(g)}),[]),l}function tC(I,g){var C=I.field,A=I.genomicField,i=I.baseGenomicField,e=I.genomicLengthField,l=Array.from(g);return l=l.map((function(I){var g=JSON.parse(I[C]);return g=g.map((function(g){var C,l,t;return g[A]&&I[i]&&(g["".concat(A,"_start")]=+g[A]+ +I[i],g["".concat(A,"_end")]=+g[A]+ +I[i]+ +g[e]),Object.assign(JSON.parse(JSON.stringify(I)),Object(m.a)(Object(m.a)({},g),{},(C={},Object(o.a)(C,"".concat(A,"_start"),g["".concat(A,"_start")]),Object(o.a)(C,"".concat(A,"_end"),g["".concat(A,"_end")]),Object(o.a)(C,"type",null!=(t=null!=(l=g.type)?l:g.variant)?t:null),Object(o.a)(C,"isParsedRow","yes"),C)))})),[I].concat(Object(b.a)(g))})).reduce((function(I,g){return I.concat(g)}),[])}function cC(I,g){if(0===function(I){var g=[];return VI.forEach((function(C){var A=I[C];DI(A)&&"aggregate"in A&&g.push(C)})),g}(I).length)return g;var C=xI(I,"nominal");if(1!==C.length)return console.warn("Currently, we only support aggregating datasets with single nominal field."),g;var A=I[C[0]];if(!DI(A))return g;var i=A.field;if(!i)return g;var e=[].concat(Object(b.a)(xI(I,"quantitative")),Object(b.a)(xI(I,"genomic"))),l=[],o=Array.from(new Set(g.map((function(I){return I[i]})))),t=!1;return o.forEach((function(C){var A={};A[i]=C,e.forEach((function(e){var l=I[e];if(DI(l)){var o=l.field;o&&"aggregate"in l?A[o]="max"===l.aggregate?Math.max.apply(Math,Object(b.a)(g.filter((function(I){return I[i]===C})).map((function(I){return+I[o]})))):Math.min.apply(Math,Object(b.a)(g.filter((function(I){return I[i]===C})).map((function(I){return+I[o]})))):t=!0}else t=!0})),l.push(A)})),t?g:l}function nC(I){if(!(this instanceof nC?this.constructor:void 0))throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');for(var g=function(){function I(g){var C=this;Object(t.a)(this,I);var A=Object(r.a)(g,1)[0];if(this.dataConfig=A,this.tilesetInfoLoading=!1,this.assembly=this.dataConfig.assembly,this.filter=this.dataConfig.filter,A.url){var i=Qg(this.assembly).size,e=[],l={},o=0;Object.keys(Qg(this.assembly).size).forEach((function(I,g){var A={id:g,chr:I,pos:o};e.push(A),l[I]=A,o+=Qg(C.assembly).size[I]})),this.chromSizes={chrToAbs:function(I,g){return C.chromSizes.chrPositions[I].pos+g},cumPositions:e,chrPositions:l,totalLength:o,chromLengths:i},A.data?this.values=A.data:this.dataPromise=this.fetchCSV()}else console.error("Please provide the `url` of the data")}return Object(c.a)(I,[{key:"fetchCSV",value:function(){var I,g=this,C=this.dataConfig,A=C.url,i=C.chromosomeField,e=C.genomicFields,l=C.headerNames,o=C.chromosomePrefix,t=C.longToWideId,c=C.genomicFieldsToConvert,n=null!=(I=this.dataConfig.separator)?I:",";return fetch(A).then((function(I){return I.ok?I.text():Promise.reject(I.status)})).then((function(I){var C=l?"".concat(l.join(n),"\n").concat(I):I;return Object(L.a)(n).parse(C,(function(I){var C=!0;if(c?c.forEach((function(A){var i=A.chromosomeField;A.genomicFields.forEach((function(A){try{if("unknown"!==g.assembly){var e=o?I[i].replace(o,"chr"):I[i].includes("chr")?I[i]:"chr".concat(I[i]);I[A]=Qg(g.assembly).interval[e][0]+ +I[A]}}catch(l){C=!1}}))})):e.forEach((function(A){if(I[i])try{var e=o?I[i].replace(o,"chr"):I[i].includes("chr")?I[i]:"chr".concat(I[i]);I[A]=Qg(g.assembly).interval[e][0]+ +I[A]}catch(l){C=!1}})),C)return I}))})).then((function(I){var C;if(t&&(null==(C=I[0])?void 0:C[t])){var A=Object.keys(I[0]),i={};I.forEach((function(I){i[I[t]]?A.forEach((function(g){i[I[t]]["".concat(g,"_2")]=I[g]})):i[I[t]]=JSON.parse(JSON.stringify(I))})),g.values=Object.keys(i).map((function(I){return i[I]}))}else g.values=I})).catch((function(I){console.error("[Gosling Data Fetcher] Error fetching data",I)}))}},{key:"generateTilesetInfo",value:function(I){this.tilesetInfoLoading=!1;var g=this.chromSizes.totalLength,C={tile_size:1024,max_zoom:Math.ceil(Math.log(g/1024)/Math.log(2)),max_width:g,min_pos:[0,0],max_pos:[g,g]};return I&&I(C),C}},{key:"tilesetInfo",value:function(I){var g=this;if(this.dataPromise)return this.tilesetInfoLoading=!0,this.dataPromise.then((function(){return g.generateTilesetInfo(I)})).catch((function(I){g.tilesetInfoLoading=!1,console.error("[Gosling Data Fetcher] Error parsing data:",I)}))}},{key:"fetchTilesDebounced",value:function(I,g){var C,A={},i=[],e=[],o=Object(l.a)(g);try{for(o.s();!(C=o.n()).done;){var t=C.value,c=t.split("."),n=parseInt(c[0],10),d=parseInt(c[1],10),s=parseInt(c[2],10);Number.isNaN(d)||Number.isNaN(n)?console.warn("[Gosling Data Fetcher] Invalid tile zoom or position:",n,d,s):(i.push(t),e.push(this.tile(n,d,s)))}}catch(a){o.e(a)}finally{o.f()}return Promise.all(e).then((function(g){g.forEach((function(I,g){var C=i[g];A[C]=I,A[C].tilePositionId=C})),I(A)})),A}},{key:"tile",value:function(I,g,C){var A,i=this;return null==(A=this.tilesetInfo())?void 0:A.then((function(A){var e,l,o=+A.max_width/Math.pow(2,+I),t=A.min_pos[0]+g*o,c=A.min_pos[0]+(g+1)*o,n=i.values.filter((function(I){if(i.dataConfig.genomicFields)return i.dataConfig.genomicFields.find((function(g){return t<I[g]&&I[g]<=c}));var g=[];return i.dataConfig.genomicFieldsToConvert.forEach((function(I){return g.push.apply(g,Object(b.a)(I.genomicFields))})),g.find((function(g){return t<I[g]&&I[g]<=c}))}));null==(e=i.filter)||e.forEach((function(I){n=qg(I,n)}));var d=null!=(l=i.dataConfig.sampleLength)?l:1e3;return{tabularData:n.length>d?Object(w.a)(n,d):n,server:null,tilePos:[g,C],zoomLevel:I}}))}}]),I}(),C=arguments.length,A=new Array(C>1?C-1:0),i=1;i<C;i++)A[i-1]=arguments[i];return new g(A)}function dC(I){if(!(this instanceof dC?this.constructor:void 0))throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');for(var g=function(){function I(g){var C=this;Object(t.a)(this,I);var A=Object(r.a)(g,1)[0];if(this.dataConfig=A,this.tilesetInfoLoading=!1,this.assembly=this.dataConfig.assembly,A.values){var i=Qg(this.assembly).size,e=[],l={},o=0;Object.keys(Qg(this.assembly).size).forEach((function(I,g){var A={id:g,chr:I,pos:o};e.push(A),l[I]=A,o+=Qg(C.assembly).size[I]})),this.chromSizes={chrToAbs:function(I,g){return C.chromSizes.chrPositions[I].pos+g},cumPositions:e,chrPositions:l,totalLength:o,chromLengths:i},this.values=A.values.map((function(I){var g=!0;if(C.dataConfig.genomicFields.forEach((function(A){if(I[C.dataConfig.chromosomeField])try{var i=I[C.dataConfig.chromosomeField].includes("chr")?I[C.dataConfig.chromosomeField]:"chr".concat(I[C.dataConfig.chromosomeField]);I[A]=Qg(C.assembly).interval[i][0]+ +I[A]}catch(e){g=!1}})),g)return I}))}else console.error("Please provide `values` of the raw data")}return Object(c.a)(I,[{key:"tilesetInfo",value:function(I){this.tilesetInfoLoading=!1;var g=this.chromSizes.totalLength,C={tile_size:1024,max_zoom:Math.ceil(Math.log(g/1024)/Math.log(2)),max_width:g,min_pos:[0,0],max_pos:[g,g]};return I&&I(C),C}},{key:"fetchTilesDebounced",value:function(I,g){var C,A={},i=[],e=[],o=Object(l.a)(g);try{for(o.s();!(C=o.n()).done;){var t=C.value,c=t.split("."),n=parseInt(c[0],10),d=parseInt(c[1],10),s=parseInt(c[2],10);Number.isNaN(d)||Number.isNaN(n)?console.warn("[Gosling Data Fetcher] Invalid tile zoom or position:",n,d,s):(i.push(t),e.push(this.tile(n,d,s)))}}catch(a){o.e(a)}finally{o.f()}return Promise.all(e).then((function(g){g.forEach((function(I,g){var C=i[g];A[C]=I,A[C].tilePositionId=C})),I(A)})),A}},{key:"tile",value:function(I,g,C){var A,i=this,e=this.tilesetInfo(),l=+e.max_width/Math.pow(2,+I),o=e.min_pos[0]+g*l,t=e.min_pos[0]+(g+1)*l,c=this.values,n=null!=(A=this.dataConfig.sampleLength)?A:1e3;return n<c.length&&(c=c.filter((function(I){return i.dataConfig.genomicFields.find((function(g){return o<I[g]&&I[g]<=t}))}))),n<c.length&&(c=Object(w.a)(c,n)),{tabularData:c,server:null,tilePos:[g,C],zoomLevel:I}}}]),I}(),C=arguments.length,A=new Array(C>1?C-1:0),i=1;i<C;i++)A[i-1]=arguments[i];return new g(A)}$g.config={type:"brush-track",datatype:["projection"],local:!1,projection:!0,orientation:"2d",thumbnail:(new DOMParser).parseFromString('<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 5640 5420" preserveAspectRatio="xMidYMid meet"> <g id="layer101" fill="#000000" stroke="none"> <path d="M0 2710 l0 -2710 2820 0 2820 0 0 2710 0 2710 -2820 0 -2820 0 0 -2710z"/> </g> <g id="layer102" fill="#750075" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> <path d="M4340 2710 l0 -2510 560 0 560 0 0 2510 0 2510 -560 0 -560 0 0 -2510z"/> <path d="M200 1870 l0 -1670 630 0 630 0 0 1670 0 1670 -630 0 -630 0 0 -1670z"/> <path d="M1660 1810 l0 -1610 570 0 570 0 0 1610 0 1610 -570 0 -570 0 0 -1610z"/> <path d="M3000 840 l0 -640 570 0 570 0 0 640 0 640 -570 0 -570 0 0 -640z"/> </g> <g id="layer103" fill="#ffff04" stroke="none"> <path d="M200 4480 l0 -740 630 0 630 0 0 740 0 740 -630 0 -630 0 0 -740z"/> <path d="M1660 4420 l0 -800 570 0 570 0 0 800 0 800 -570 0 -570 0 0 -800z"/> <path d="M3000 3450 l0 -1770 570 0 570 0 0 1770 0 1770 -570 0 -570 0 0 -1770z"/> </g> </svg>',"text/xml").documentElement,availableOptions:["innerRadius","outerRadius","startAngle","endAngle","axisPositionHorizontal","projectionFillColor","projectionStrokeColor","projectionFillOpacity","projectionStrokeOpacity","strokeWidth"],defaultOptions:{innerRadius:100,outerRadius:200,startAngle:0,endAngle:360,axisPositionHorizontal:"left",projectionFillColor:"#777",projectionStrokeColor:"#777",projectionFillOpacity:.3,projectionStrokeOpacity:.7,strokeWidth:1}},nC.config={type:"csv"},dC.config={type:"json"};var sC="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof I?I:"undefined"!==typeof self?self:{};function aC(I){if(I.__esModule)return I;var g=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(I).forEach((function(C){var A=Object.getOwnPropertyDescriptor(I,C);Object.defineProperty(g,C,A.get?A:{enumerable:!0,get:function(){return I[C]}})})),g}var ZC={},mC={},bC={exports:{}};!function(I){I.exports=function(I){return I&&I.__esModule?I:{default:I}},I.exports.default=I.exports,I.exports.__esModule=!0}(bC);var rC={exports:{}};!function(I){var g=function(I){var g,C=Object.prototype,A=C.hasOwnProperty,i="function"===typeof Symbol?Symbol:{},e=i.iterator||"@@iterator",l=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function t(I,g,C){return Object.defineProperty(I,g,{value:C,enumerable:!0,configurable:!0,writable:!0}),I[g]}try{t({},"")}catch(K){t=function(I,g,C){return I[g]=C}}function c(I,g,C,A){var i=g&&g.prototype instanceof b?g:b,e=Object.create(i.prototype),l=new Y(A||[]);return e._invoke=function(I,g,C){var A=d;return function(i,e){if(A===a)throw new Error("Generator is already running");if(A===Z){if("throw"===i)throw e;return f()}for(C.method=i,C.arg=e;;){var l=C.delegate;if(l){var o=X(l,C);if(o){if(o===m)continue;return o}}if("next"===C.method)C.sent=C._sent=C.arg;else if("throw"===C.method){if(A===d)throw A=Z,C.arg;C.dispatchException(C.arg)}else"return"===C.method&&C.abrupt("return",C.arg);A=a;var t=n(I,g,C);if("normal"===t.type){if(A=C.done?Z:s,t.arg===m)continue;return{value:t.arg,done:C.done}}"throw"===t.type&&(A=Z,C.method="throw",C.arg=t.arg)}}}(I,C,l),e}function n(I,g,C){try{return{type:"normal",arg:I.call(g,C)}}catch(K){return{type:"throw",arg:K}}}I.wrap=c;var d="suspendedStart",s="suspendedYield",a="executing",Z="completed",m={};function b(){}function r(){}function h(){}var G={};t(G,e,(function(){return this}));var u=Object.getPrototypeOf,y=u&&u(u(R([])));y&&y!==C&&A.call(y,e)&&(G=y);var B=h.prototype=b.prototype=Object.create(G);function V(I){["next","throw","return"].forEach((function(g){t(I,g,(function(I){return this._invoke(g,I)}))}))}function p(I,g){function C(i,e,l,o){var t=n(I[i],I,e);if("throw"!==t.type){var c=t.arg,d=c.value;return d&&"object"===typeof d&&A.call(d,"__await")?g.resolve(d.__await).then((function(I){C("next",I,l,o)}),(function(I){C("throw",I,l,o)})):g.resolve(d).then((function(I){c.value=I,l(c)}),(function(I){return C("throw",I,l,o)}))}o(t.arg)}var i;this._invoke=function(I,A){function e(){return new g((function(g,i){C(I,A,g,i)}))}return i=i?i.then(e,e):e()}}function X(I,C){var A=I.iterator[C.method];if(A===g){if(C.delegate=null,"throw"===C.method){if(I.iterator.return&&(C.method="return",C.arg=g,X(I,C),"throw"===C.method))return m;C.method="throw",C.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=n(A,I.iterator,C.arg);if("throw"===i.type)return C.method="throw",C.arg=i.arg,C.delegate=null,m;var e=i.arg;return e?e.done?(C[I.resultName]=e.value,C.next=I.nextLoc,"return"!==C.method&&(C.method="next",C.arg=g),C.delegate=null,m):e:(C.method="throw",C.arg=new TypeError("iterator result is not an object"),C.delegate=null,m)}function W(I){var g={tryLoc:I[0]};1 in I&&(g.catchLoc=I[1]),2 in I&&(g.finallyLoc=I[2],g.afterLoc=I[3]),this.tryEntries.push(g)}function H(I){var g=I.completion||{};g.type="normal",delete g.arg,I.completion=g}function Y(I){this.tryEntries=[{tryLoc:"root"}],I.forEach(W,this),this.reset(!0)}function R(I){if(I){var C=I[e];if(C)return C.call(I);if("function"===typeof I.next)return I;if(!isNaN(I.length)){var i=-1,l=function C(){for(;++i<I.length;)if(A.call(I,i))return C.value=I[i],C.done=!1,C;return C.value=g,C.done=!0,C};return l.next=l}}return{next:f}}function f(){return{value:g,done:!0}}return r.prototype=h,t(B,"constructor",h),t(h,"constructor",r),r.displayName=t(h,o,"GeneratorFunction"),I.isGeneratorFunction=function(I){var g="function"===typeof I&&I.constructor;return!!g&&(g===r||"GeneratorFunction"===(g.displayName||g.name))},I.mark=function(I){return Object.setPrototypeOf?Object.setPrototypeOf(I,h):(I.__proto__=h,t(I,o,"GeneratorFunction")),I.prototype=Object.create(B),I},I.awrap=function(I){return{__await:I}},V(p.prototype),t(p.prototype,l,(function(){return this})),I.AsyncIterator=p,I.async=function(g,C,A,i,e){void 0===e&&(e=Promise);var l=new p(c(g,C,A,i),e);return I.isGeneratorFunction(C)?l:l.next().then((function(I){return I.done?I.value:l.next()}))},V(B),t(B,o,"Generator"),t(B,e,(function(){return this})),t(B,"toString",(function(){return"[object Generator]"})),I.keys=function(I){var g=[];for(var C in I)g.push(C);return g.reverse(),function C(){for(;g.length;){var A=g.pop();if(A in I)return C.value=A,C.done=!1,C}return C.done=!0,C}},I.values=R,Y.prototype={constructor:Y,reset:function(I){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(H),!I)for(var C in this)"t"===C.charAt(0)&&A.call(this,C)&&!isNaN(+C.slice(1))&&(this[C]=g)},stop:function(){this.done=!0;var I=this.tryEntries[0].completion;if("throw"===I.type)throw I.arg;return this.rval},dispatchException:function(I){if(this.done)throw I;var C=this;function i(A,i){return o.type="throw",o.arg=I,C.next=A,i&&(C.method="next",C.arg=g),!!i}for(var e=this.tryEntries.length-1;e>=0;--e){var l=this.tryEntries[e],o=l.completion;if("root"===l.tryLoc)return i("end");if(l.tryLoc<=this.prev){var t=A.call(l,"catchLoc"),c=A.call(l,"finallyLoc");if(t&&c){if(this.prev<l.catchLoc)return i(l.catchLoc,!0);if(this.prev<l.finallyLoc)return i(l.finallyLoc)}else if(t){if(this.prev<l.catchLoc)return i(l.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<l.finallyLoc)return i(l.finallyLoc)}}}},abrupt:function(I,g){for(var C=this.tryEntries.length-1;C>=0;--C){var i=this.tryEntries[C];if(i.tryLoc<=this.prev&&A.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var e=i;break}}e&&("break"===I||"continue"===I)&&e.tryLoc<=g&&g<=e.finallyLoc&&(e=null);var l=e?e.completion:{};return l.type=I,l.arg=g,e?(this.method="next",this.next=e.finallyLoc,m):this.complete(l)},complete:function(I,g){if("throw"===I.type)throw I.arg;return"break"===I.type||"continue"===I.type?this.next=I.arg:"return"===I.type?(this.rval=this.arg=I.arg,this.method="return",this.next="end"):"normal"===I.type&&g&&(this.next=g),m},finish:function(I){for(var g=this.tryEntries.length-1;g>=0;--g){var C=this.tryEntries[g];if(C.finallyLoc===I)return this.complete(C.completion,C.afterLoc),H(C),m}},catch:function(I){for(var g=this.tryEntries.length-1;g>=0;--g){var C=this.tryEntries[g];if(C.tryLoc===I){var A=C.completion;if("throw"===A.type){var i=A.arg;H(C)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(I,C,A){return this.delegate={iterator:R(I),resultName:C,nextLoc:A},"next"===this.method&&(this.arg=g),m}},I}(I.exports);try{regeneratorRuntime=g}catch(C){"object"===typeof globalThis?globalThis.regeneratorRuntime=g:Function("r","regeneratorRuntime = r")(g)}}(rC);var hC=rC.exports,GC={exports:{}};!function(I){function g(I,g,C,A,i,e,l){try{var o=I[e](l),t=o.value}catch(c){return void C(c)}o.done?g(t):Promise.resolve(t).then(A,i)}I.exports=function(I){return function(){var C=this,A=arguments;return new Promise((function(i,e){var l=I.apply(C,A);function o(I){g(l,i,e,o,t,"next",I)}function t(I){g(l,i,e,o,t,"throw",I)}o(void 0)}))}},I.exports.default=I.exports,I.exports.__esModule=!0}(GC);var uC={exports:{}};!function(I){I.exports=function(I,g){if(!(I instanceof g))throw new TypeError("Cannot call a class as a function")},I.exports.default=I.exports,I.exports.__esModule=!0}(uC);var yC={exports:{}};!function(I){function g(I,g){for(var C=0;C<g.length;C++){var A=g[C];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(I,A.key,A)}}I.exports=function(I,C,A){return C&&g(I.prototype,C),A&&g(I,A),I},I.exports.default=I.exports,I.exports.__esModule=!0}(yC);var BC={exports:{}},VC={exports:{}};!function(I){function g(C,A){return I.exports=g=Object.setPrototypeOf||function(I,g){return I.__proto__=g,I},I.exports.default=I.exports,I.exports.__esModule=!0,g(C,A)}I.exports=g,I.exports.default=I.exports,I.exports.__esModule=!0}(VC),function(I){var g=VC.exports;I.exports=function(I,C){if("function"!==typeof C&&null!==C)throw new TypeError("Super expression must either be null or a function");I.prototype=Object.create(C&&C.prototype,{constructor:{value:I,writable:!0,configurable:!0}}),C&&g(I,C)},I.exports.default=I.exports,I.exports.__esModule=!0}(BC);var pC={exports:{}},XC={exports:{}};!function(I){function g(C){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?(I.exports=g=function(I){return typeof I},I.exports.default=I.exports,I.exports.__esModule=!0):(I.exports=g=function(I){return I&&"function"===typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},I.exports.default=I.exports,I.exports.__esModule=!0),g(C)}I.exports=g,I.exports.default=I.exports,I.exports.__esModule=!0}(XC);var WC={exports:{}};!function(I){I.exports=function(I){if(void 0===I)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I},I.exports.default=I.exports,I.exports.__esModule=!0}(WC),function(I){var g=XC.exports.default,C=WC.exports;I.exports=function(I,A){if(A&&("object"===g(A)||"function"===typeof A))return A;if(void 0!==A)throw new TypeError("Derived constructors may only return object or undefined");return C(I)},I.exports.default=I.exports,I.exports.__esModule=!0}(pC);var HC={exports:{}};!function(I){function g(C){return I.exports=g=Object.setPrototypeOf?Object.getPrototypeOf:function(I){return I.__proto__||Object.getPrototypeOf(I)},I.exports.default=I.exports,I.exports.__esModule=!0,g(C)}I.exports=g,I.exports.default=I.exports,I.exports.__esModule=!0}(HC);var YC={},RC={exports:{}};!function(I){I.exports=function(I,g,C){return g in I?Object.defineProperty(I,g,{value:C,enumerable:!0,configurable:!0,writable:!0}):I[g]=C,I},I.exports.default=I.exports,I.exports.__esModule=!0}(RC);var fC={},KC={};KC.runInThisContext=function(I){return new Function("code","return eval(code);").call(globalThis,I)};var wC={};function JC(I){return(JC="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"===typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I})(I)}var SC=function(){this.code="",this.scopes=[["vars"]],this.isAsync=!1,this.bitFields=[],this.tmpVariableCount=0,this.references={}};SC.prototype.generateVariable=function(I){var g=[];for(Array.prototype.push.apply(g,this.scopes[this.scopes.length-1]);/^\$parent\./.test(I);)g.pop(),I=I.replace(/^\$parent\./,"");return I&&g.push(I),g.join(".")},SC.prototype.generateOption=function(I){switch(JC(I)){case"number":return I.toString();case"string":return this.generateVariable(I);case"function":return"(".concat(I,").call(").concat(this.generateVariable(),", vars)");default:return}},SC.prototype.generateError=function(){var I=Array.prototype.slice.call(arguments),g=SC.interpolate.apply(this,I);this.isAsync?this.pushCode("return process.nextTick(function() { callback(new Error(".concat(g,"), vars); });")):this.pushCode("throw new Error(".concat(g,");"))},SC.prototype.generateTmpVariable=function(){return"$tmp".concat(this.tmpVariableCount++)},SC.prototype.pushCode=function(){var I=Array.prototype.slice.call(arguments);this.code+="".concat(SC.interpolate.apply(this,I),"\n")},SC.prototype.pushPath=function(I){I&&this.scopes[this.scopes.length-1].push(I)},SC.prototype.popPath=function(I){I&&this.scopes[this.scopes.length-1].pop()},SC.prototype.pushScope=function(I){this.scopes.push([I])},SC.prototype.popScope=function(){this.scopes.pop()},SC.prototype.addReference=function(I){this.references[I]||(this.references[I]={resolved:!1,requested:!1})},SC.prototype.markResolved=function(I){this.references[I].resolved=!0},SC.prototype.markRequested=function(I){I.forEach(function(I){this.references[I].requested=!0}.bind(this))},SC.prototype.getUnresolvedReferences=function(){var I=this.references;return Object.keys(this.references).filter((function(g){return!I[g].resolved&&!I[g].requested}))},SC.interpolate=function(I){var g=/{\d+}/g,C=I.match(g),A=Array.prototype.slice.call(arguments,1);return C&&C.forEach((function(g){var C=parseInt(g.substr(1,g.length-2),10);I=I.replace(g,A[C].toString())})),I},wC.Context=SC;var FC=vC,NC=null;try{NC=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(im){}function vC(I,g,C){this.low=0|I,this.high=0|g,this.unsigned=!!C}function kC(I){return!0===(I&&I.__isLong__)}vC.prototype.__isLong__,Object.defineProperty(vC.prototype,"__isLong__",{value:!0}),vC.isLong=kC;var DC={},zC={};function MC(I,g){var C,A,i;return g?(i=0<=(I>>>=0)&&I<256)&&(A=zC[I])?A:(C=xC(I,(0|I)<0?-1:0,!0),i&&(zC[I]=C),C):(i=-128<=(I|=0)&&I<128)&&(A=DC[I])?A:(C=xC(I,I<0?-1:0,!1),i&&(DC[I]=C),C)}function UC(I,g){if(isNaN(I))return g?$C:_C;if(g){if(I<0)return $C;if(I>=jC)return AA}else{if(I<=-LC)return iA;if(I+1>=LC)return CA}return I<0?UC(-I,g).neg():xC(I%OC|0,I/OC|0,g)}function xC(I,g,C){return new vC(I,g,C)}vC.fromInt=MC,vC.fromNumber=UC,vC.fromBits=xC;var TC=Math.pow;function QC(I,g,C){if(0===I.length)throw Error("empty string");if("NaN"===I||"Infinity"===I||"+Infinity"===I||"-Infinity"===I)return _C;if("number"===typeof g?(C=g,g=!1):g=!!g,(C=C||10)<2||36<C)throw RangeError("radix");var A;if((A=I.indexOf("-"))>0)throw Error("interior hyphen");if(0===A)return QC(I.substring(1),g,C).neg();for(var i=UC(TC(C,8)),e=_C,l=0;l<I.length;l+=8){var o=Math.min(8,I.length-l),t=parseInt(I.substring(l,l+o),C);if(o<8){var c=UC(TC(C,o));e=e.mul(c).add(UC(t))}else e=(e=e.mul(i)).add(UC(t))}return e.unsigned=g,e}function PC(I,g){return"number"===typeof I?UC(I,g):"string"===typeof I?QC(I,g):xC(I.low,I.high,"boolean"===typeof g?g:I.unsigned)}vC.fromString=QC,vC.fromValue=PC;var OC=4294967296,jC=OC*OC,LC=jC/2,EC=MC(1<<24),_C=MC(0);vC.ZERO=_C;var $C=MC(0,!0);vC.UZERO=$C;var qC=MC(1);vC.ONE=qC;var IA=MC(1,!0);vC.UONE=IA;var gA=MC(-1);vC.NEG_ONE=gA;var CA=xC(-1,2147483647,!1);vC.MAX_VALUE=CA;var AA=xC(-1,-1,!0);vC.MAX_UNSIGNED_VALUE=AA;var iA=xC(0,-2147483648,!1);vC.MIN_VALUE=iA;var eA=vC.prototype;function lA(I){return(lA="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(I){return typeof I}:function(I){return I&&"function"===typeof Symbol&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I})(I)}eA.toInt=function(){return this.unsigned?this.low>>>0:this.low},eA.toNumber=function(){return this.unsigned?(this.high>>>0)*OC+(this.low>>>0):this.high*OC+(this.low>>>0)},eA.toString=function(I){if((I=I||10)<2||36<I)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(iA)){var g=UC(I),C=this.div(g),A=C.mul(g).sub(this);return C.toString(I)+A.toInt().toString(I)}return"-"+this.neg().toString(I)}for(var i=UC(TC(I,6),this.unsigned),e=this,l="";;){var o=e.div(i),t=(e.sub(o.mul(i)).toInt()>>>0).toString(I);if((e=o).isZero())return t+l;for(;t.length<6;)t="0"+t;l=""+t+l}},eA.getHighBits=function(){return this.high},eA.getHighBitsUnsigned=function(){return this.high>>>0},eA.getLowBits=function(){return this.low},eA.getLowBitsUnsigned=function(){return this.low>>>0},eA.getNumBitsAbs=function(){if(this.isNegative())return this.eq(iA)?64:this.neg().getNumBitsAbs();for(var I=0!=this.high?this.high:this.low,g=31;g>0&&0==(I&1<<g);g--);return 0!=this.high?g+33:g+1},eA.isZero=function(){return 0===this.high&&0===this.low},eA.eqz=eA.isZero,eA.isNegative=function(){return!this.unsigned&&this.high<0},eA.isPositive=function(){return this.unsigned||this.high>=0},eA.isOdd=function(){return 1===(1&this.low)},eA.isEven=function(){return 0===(1&this.low)},eA.equals=function(I){return kC(I)||(I=PC(I)),(this.unsigned===I.unsigned||this.high>>>31!==1||I.high>>>31!==1)&&(this.high===I.high&&this.low===I.low)},eA.eq=eA.equals,eA.notEquals=function(I){return!this.eq(I)},eA.neq=eA.notEquals,eA.ne=eA.notEquals,eA.lessThan=function(I){return this.comp(I)<0},eA.lt=eA.lessThan,eA.lessThanOrEqual=function(I){return this.comp(I)<=0},eA.lte=eA.lessThanOrEqual,eA.le=eA.lessThanOrEqual,eA.greaterThan=function(I){return this.comp(I)>0},eA.gt=eA.greaterThan,eA.greaterThanOrEqual=function(I){return this.comp(I)>=0},eA.gte=eA.greaterThanOrEqual,eA.ge=eA.greaterThanOrEqual,eA.compare=function(I){if(kC(I)||(I=PC(I)),this.eq(I))return 0;var g=this.isNegative(),C=I.isNegative();return g&&!C?-1:!g&&C?1:this.unsigned?I.high>>>0>this.high>>>0||I.high===this.high&&I.low>>>0>this.low>>>0?-1:1:this.sub(I).isNegative()?-1:1},eA.comp=eA.compare,eA.negate=function(){return!this.unsigned&&this.eq(iA)?iA:this.not().add(qC)},eA.neg=eA.negate,eA.add=function(I){kC(I)||(I=PC(I));var g=this.high>>>16,C=65535&this.high,A=this.low>>>16,i=65535&this.low,e=I.high>>>16,l=65535&I.high,o=I.low>>>16,t=0,c=0,n=0,d=0;return n+=(d+=i+(65535&I.low))>>>16,c+=(n+=A+o)>>>16,t+=(c+=C+l)>>>16,t+=g+e,xC((n&=65535)<<16|(d&=65535),(t&=65535)<<16|(c&=65535),this.unsigned)},eA.subtract=function(I){return kC(I)||(I=PC(I)),this.add(I.neg())},eA.sub=eA.subtract,eA.multiply=function(I){if(this.isZero())return _C;if(kC(I)||(I=PC(I)),NC)return xC(NC.mul(this.low,this.high,I.low,I.high),NC.get_high(),this.unsigned);if(I.isZero())return _C;if(this.eq(iA))return I.isOdd()?iA:_C;if(I.eq(iA))return this.isOdd()?iA:_C;if(this.isNegative())return I.isNegative()?this.neg().mul(I.neg()):this.neg().mul(I).neg();if(I.isNegative())return this.mul(I.neg()).neg();if(this.lt(EC)&&I.lt(EC))return UC(this.toNumber()*I.toNumber(),this.unsigned);var g=this.high>>>16,C=65535&this.high,A=this.low>>>16,i=65535&this.low,e=I.high>>>16,l=65535&I.high,o=I.low>>>16,t=65535&I.low,c=0,n=0,d=0,s=0;return d+=(s+=i*t)>>>16,n+=(d+=A*t)>>>16,d&=65535,n+=(d+=i*o)>>>16,c+=(n+=C*t)>>>16,n&=65535,c+=(n+=A*o)>>>16,n&=65535,c+=(n+=i*l)>>>16,c+=g*t+C*o+A*l+i*e,xC((d&=65535)<<16|(s&=65535),(c&=65535)<<16|(n&=65535),this.unsigned)},eA.mul=eA.multiply,eA.divide=function(I){if(kC(I)||(I=PC(I)),I.isZero())throw Error("division by zero");var g,C,A;if(NC)return this.unsigned||-2147483648!==this.high||-1!==I.low||-1!==I.high?xC((this.unsigned?NC.div_u:NC.div_s)(this.low,this.high,I.low,I.high),NC.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?$C:_C;if(this.unsigned){if(I.unsigned||(I=I.toUnsigned()),I.gt(this))return $C;if(I.gt(this.shru(1)))return IA;A=$C}else{if(this.eq(iA))return I.eq(qC)||I.eq(gA)?iA:I.eq(iA)?qC:(g=this.shr(1).div(I).shl(1)).eq(_C)?I.isNegative()?qC:gA:(C=this.sub(I.mul(g)),A=g.add(C.div(I)));if(I.eq(iA))return this.unsigned?$C:_C;if(this.isNegative())return I.isNegative()?this.neg().div(I.neg()):this.neg().div(I).neg();if(I.isNegative())return this.div(I.neg()).neg();A=_C}for(C=this;C.gte(I);){g=Math.max(1,Math.floor(C.toNumber()/I.toNumber()));for(var i=Math.ceil(Math.log(g)/Math.LN2),e=i<=48?1:TC(2,i-48),l=UC(g),o=l.mul(I);o.isNegative()||o.gt(C);)o=(l=UC(g-=e,this.unsigned)).mul(I);l.isZero()&&(l=qC),A=A.add(l),C=C.sub(o)}return A},eA.div=eA.divide,eA.modulo=function(I){return kC(I)||(I=PC(I)),NC?xC((this.unsigned?NC.rem_u:NC.rem_s)(this.low,this.high,I.low,I.high),NC.get_high(),this.unsigned):this.sub(this.div(I).mul(I))},eA.mod=eA.modulo,eA.rem=eA.modulo,eA.not=function(){return xC(~this.low,~this.high,this.unsigned)},eA.and=function(I){return kC(I)||(I=PC(I)),xC(this.low&I.low,this.high&I.high,this.unsigned)},eA.or=function(I){return kC(I)||(I=PC(I)),xC(this.low|I.low,this.high|I.high,this.unsigned)},eA.xor=function(I){return kC(I)||(I=PC(I)),xC(this.low^I.low,this.high^I.high,this.unsigned)},eA.shiftLeft=function(I){return kC(I)&&(I=I.toInt()),0===(I&=63)?this:I<32?xC(this.low<<I,this.high<<I|this.low>>>32-I,this.unsigned):xC(0,this.low<<I-32,this.unsigned)},eA.shl=eA.shiftLeft,eA.shiftRight=function(I){return kC(I)&&(I=I.toInt()),0===(I&=63)?this:I<32?xC(this.low>>>I|this.high<<32-I,this.high>>I,this.unsigned):xC(this.high>>I-32,this.high>=0?0:-1,this.unsigned)},eA.shr=eA.shiftRight,eA.shiftRightUnsigned=function(I){if(kC(I)&&(I=I.toInt()),0===(I&=63))return this;var g=this.high;return I<32?xC(this.low>>>I|g<<32-I,g>>>I,this.unsigned):xC(32===I?g:g>>>I-32,0,this.unsigned)},eA.shru=eA.shiftRightUnsigned,eA.shr_u=eA.shiftRightUnsigned,eA.toSigned=function(){return this.unsigned?xC(this.low,this.high,!1):this},eA.toUnsigned=function(){return this.unsigned?this:xC(this.low,this.high,!0)},eA.toBytes=function(I){return I?this.toBytesLE():this.toBytesBE()},eA.toBytesLE=function(){var I=this.high,g=this.low;return[255&g,g>>>8&255,g>>>16&255,g>>>24,255&I,I>>>8&255,I>>>16&255,I>>>24]},eA.toBytesBE=function(){var I=this.high,g=this.low;return[I>>>24,I>>>16&255,I>>>8&255,255&I,g>>>24,g>>>16&255,g>>>8&255,255&g]},vC.fromBytes=function(I,g,C){return C?vC.fromBytesLE(I,g):vC.fromBytesBE(I,g)},vC.fromBytesLE=function(I,g){return new vC(I[0]|I[1]<<8|I[2]<<16|I[3]<<24,I[4]|I[5]<<8|I[6]<<16|I[7]<<24,g)},vC.fromBytesBE=function(I,g){return new vC(I[4]<<24|I[5]<<16|I[6]<<8|I[7],I[0]<<24|I[1]<<16|I[2]<<8|I[3],g)};var oA=_.a.Buffer,tA=KC,cA=wC.Context,nA=FC;"undefined"!==typeof window&&(window.Buffer=oA),"undefined"!==typeof self&&(self.Buffer=oA);var dA={UInt8:1,UInt16LE:2,UInt16BE:2,UInt32LE:4,UInt32BE:4,Int8:1,Int16LE:2,Int16BE:2,Int32LE:4,Int32BE:4,FloatLE:4,FloatBE:4,DoubleLE:8,DoubleBE:8,UInt64:8,Int64:8},sA={},aA="___parser_",ZA=[];!function(){var I;for(I=1;I<=32;I++)ZA.push(I)}();var mA={};Object.keys(dA).concat(Object.keys({String:null,Buffer:null,Array:null,Skip:null,Choice:null,Nest:null,Bit:null,Itf8:null,Ltf8:null})).forEach((function(I){mA[I.toLowerCase()]=I}));var bA=function(){this.varName="",this.type="",this.options={},this.next=null,this.head=null,this.compiled=null,this.endian="le",this.constructorFn=null,this.alias=null};bA.start=function(){return new bA},Object.keys(dA).forEach((function(I){bA.prototype[I.toLowerCase()]=function(g,C){return this.setNextParser(I.toLowerCase(),g,C)};var g=I.replace(/BE|LE/,"").toLowerCase();g in bA.prototype||(bA.prototype[g]=function(I,C){return this[g+this.endian](I,C)})})),ZA.forEach((function(I){bA.prototype["bit".concat(I.toString())]=function(g,C){return C||(C={}),C.length=I,this.setNextParser("bit",g,C)}})),bA.prototype.namely=function(I){return sA[I]=this,this.alias=I,this},bA.prototype.skip=function(I,g){if(g&&g.assert)throw new Error("assert option on skip is not allowed.");return this.setNextParser("skip","",{length:I})},bA.prototype.string=function(I,g){if(!g.zeroTerminated&&!g.length&&!g.greedy)throw new Error("Neither length, zeroTerminated, nor greedy is defined for string.");if((g.zeroTerminated||g.length)&&g.greedy)throw new Error("greedy is mutually exclusive with length and zeroTerminated for string.");if(g.stripNull&&!g.length&&!g.greedy)throw new Error("Length or greedy must be defined if stripNull is defined.");return g.encoding=g.encoding||"utf8",this.setNextParser("string",I,g)},bA.prototype.buffer=function(I,g){if(!g.length&&!g.readUntil)throw new Error("Length nor readUntil is defined in buffer parser");return this.setNextParser("buffer",I,g)},bA.prototype.array=function(I,g){if(!g.readUntil&&!g.length&&!g.lengthInBytes)throw new Error("Length option of array is not defined.");if(!g.type)throw new Error("Type option of array is not defined.");if("string"===typeof g.type&&!sA[g.type]&&Object.keys(dA).indexOf(mA[g.type])<0)throw new Error('Specified primitive type "'.concat(g.type,'" is not supported.'));return this.setNextParser("array",I,g)},bA.prototype.choice=function(I,g){if(1===arguments.length&&"object"===lA(I)&&(g=I,I=null),!g.tag)throw new Error("Tag option of array is not defined.");if(!g.choices)throw new Error("Choices option of array is not defined.");return Object.keys(g.choices).forEach((function(C){if(!g.choices[C])throw new Error("Choice Case ".concat(C," of ").concat(I," is not valid."));if("string"===typeof g.choices[C]&&!sA[g.choices[C]]&&Object.keys(dA).indexOf(mA[g.choices[C]])<0)throw new Error('Specified primitive type "'.concat(g.choices[C],'" is not supported.'))}),this),this.setNextParser("choice",I,g)},bA.prototype.nest=function(I,g){if(1===arguments.length&&"object"===lA(I)&&(g=I,I=null),!g.type)throw new Error("Type option of nest is not defined.");if(!(g.type instanceof bA)&&!sA[g.type])throw new Error("Type option of nest must be a Parser object.");if(!(g.type instanceof bA)&&!I)throw new Error("options.type must be a object if variable name is omitted.");return this.setNextParser("nest",I,g)},bA.prototype.endianess=function(I){switch(I.toLowerCase()){case"little":this.endian="le";break;case"big":this.endian="be";break;default:throw new Error("Invalid endianess: ".concat(I))}return this},bA.prototype.create=function(I){if(!(I instanceof Function))throw new Error("Constructor must be a Function object.");return this.constructorFn=I,this},bA.prototype.getCode=function(){var I=new cA;return I.pushCode("if (!Buffer.isBuffer(buffer)) {"),I.generateError('"argument buffer is not a Buffer object"'),I.pushCode("}"),this.alias?this.addAliasedCode(I):this.addRawCode(I),this.alias?I.pushCode("return {0}(0)",aA+this.alias):I.pushCode("return { offset: offset, result: vars };"),I.code},bA.prototype.addRawCode=function(I){I.pushCode("var offset = 0;"),this.constructorFn?I.pushCode("var vars = new constructorFn();"):I.pushCode("var vars = {};"),this.generate(I),this.resolveReferences(I),I.pushCode("return { offset: offset, result: vars };")},bA.prototype.addAliasedCode=function(I){return I.pushCode("function {0}(offset) {",aA+this.alias),this.constructorFn?I.pushCode("var vars = new constructorFn();"):I.pushCode("var vars = {};"),this.generate(I),I.markResolved(this.alias),this.resolveReferences(I),I.pushCode("return { offset: offset, result: vars };"),I.pushCode("}"),I},bA.prototype.resolveReferences=function(I){var g=I.getUnresolvedReferences();I.markRequested(g),g.forEach((function(g){sA[g].addAliasedCode(I)}))},bA.prototype.compile=function(){var I="(function(buffer, constructorFn, Long) { ".concat(this.getCode()," })");this.compiled=tA.runInThisContext(I)},bA.prototype.sizeOf=function(){var I=NaN;if(Object.keys(dA).indexOf(this.type)>=0)I=dA[this.type];else if("String"===this.type&&"number"===typeof this.options.length)I=this.options.length;else if("Buffer"===this.type&&"number"===typeof this.options.length)I=this.options.length;else if("Array"===this.type&&"number"===typeof this.options.length){var g=NaN;"string"===typeof this.options.type?g=dA[mA[this.options.type]]:this.options.type instanceof bA&&(g=this.options.type.sizeOf()),I=this.options.length*g}else"Skip"===this.type?I=this.options.length:"Nest"===this.type?I=this.options.type.sizeOf():this.type||(I=0);return this.next&&(I+=this.next.sizeOf()),I},bA.prototype.parse=function(I){return this.compiled||this.compile(),this.compiled(I,this.constructorFn,nA)},bA.prototype.setNextParser=function(I,g,C){var A=new bA;return A.type=mA[I],A.varName=g,A.options=C||A.options,A.endian=this.endian,this.head?this.head.next=A:this.next=A,this.head=A,this},bA.prototype.generate=function(I){this.type&&(this["generate".concat(this.type)](I),this.generateAssert(I));var g=I.generateVariable(this.varName);return this.options.formatter&&this.generateFormatter(I,g,this.options.formatter),this.generateNext(I)},bA.prototype.generateAssert=function(I){if(this.options.assert){var g=I.generateVariable(this.varName);switch(lA(this.options.assert)){case"function":I.pushCode("if (!({0}).call(vars, {1})) {",this.options.assert,g);break;case"number":I.pushCode("if ({0} !== {1}) {",this.options.assert,g);break;case"string":I.pushCode('if ("{0}" !== {1}) {',this.options.assert,g);break;default:throw new Error("Assert option supports only strings, numbers and assert functions.")}I.generateError('"Assert error: {0} is " + {0}',g),I.pushCode("}")}},bA.prototype.generateNext=function(I){return this.next&&(I=this.next.generate(I)),I},Object.keys(dA).forEach((function(I){bA.prototype["generate".concat(I)]=function(g){"UInt64"===I?g.pushCode("{0} = Long.fromBytes(buffer.slice(offset,offset+8), true, this.endian === 'le').toNumber();",g.generateVariable(this.varName),I):"Int64"===I?g.pushCode("{0} = Long.fromBytes(buffer.slice(offset,offset+8), false, this.endian === 'le').toNumber();",g.generateVariable(this.varName),I):g.pushCode("{0} = buffer.read{1}(offset);",g.generateVariable(this.varName),I),g.pushCode("offset += {0};",dA[I])}})),bA.prototype.generateBit=function(I){var g=JSON.parse(JSON.stringify(this));if(g.varName=I.generateVariable(g.varName),I.bitFields.push(g),!this.next||this.next&&["Bit","Nest"].indexOf(this.next.type)<0){var C=0;I.bitFields.forEach((function(I){C+=I.options.length}));var A=I.generateTmpVariable();if(C<=8)I.pushCode("var {0} = buffer.readUInt8(offset);",A),C=8;else if(C<=16)I.pushCode("var {0} = buffer.readUInt16BE(offset);",A),C=16;else if(C<=24){var i=I.generateTmpVariable(),e=I.generateTmpVariable();I.pushCode("var {0} = buffer.readUInt16BE(offset);",i),I.pushCode("var {0} = buffer.readUInt8(offset + 2);",e),I.pushCode("var {2} = ({0} << 8) | {1};",i,e,A),C=24}else{if(!(C<=32))throw new Error("Currently, bit field sequence longer than 4-bytes is not supported.");I.pushCode("var {0} = buffer.readUInt32BE(offset);",A),C=32}I.pushCode("offset += {0};",C/8);var l=0,o="be"===this.endian;I.bitFields.forEach((function(g){I.pushCode("{0} = {1} >> {2} & {3};",g.varName,A,o?C-l-g.options.length:l,(1<<g.options.length)-1),l+=g.options.length})),I.bitFields=[]}},bA.prototype.generateSkip=function(I){var g=I.generateOption(this.options.length);I.pushCode("offset += {0};",g)},bA.prototype.generateString=function(I){var g=I.generateVariable(this.varName),C=I.generateTmpVariable();this.options.length&&this.options.zeroTerminated?(I.pushCode("var {0} = offset;",C),I.pushCode("while(buffer.readUInt8(offset++) !== 0 && offset - {0}  < {1});",C,this.options.length),I.pushCode("{0} = buffer.toString('{1}', {2}, offset - {2} < {3} ? offset - 1 : offset);",g,this.options.encoding,C,this.options.length)):this.options.length?(I.pushCode("{0} = buffer.toString('{1}', offset, offset + {2});",g,this.options.encoding,I.generateOption(this.options.length)),I.pushCode("offset += {0};",I.generateOption(this.options.length))):this.options.zeroTerminated?(I.pushCode("var {0} = offset;",C),I.pushCode("while(buffer.readUInt8(offset++) !== 0);"),I.pushCode("{0} = buffer.toString('{1}', {2}, offset - 1);",g,this.options.encoding,C)):this.options.greedy&&(I.pushCode("var {0} = offset;",C),I.pushCode("while(buffer.length > offset++);"),I.pushCode("{0} = buffer.toString('{1}', {2}, offset);",g,this.options.encoding,C)),this.options.stripNull&&I.pushCode("{0} = {0}.replace(/\\x00+$/g, '')",g)},bA.prototype.generateBuffer=function(I){"eof"===this.options.readUntil?I.pushCode("{0} = buffer.slice(offset);",I.generateVariable(this.varName)):(I.pushCode("{0} = buffer.slice(offset, offset + {1});",I.generateVariable(this.varName),I.generateOption(this.options.length)),I.pushCode("offset += {0};",I.generateOption(this.options.length))),this.options.clone&&I.pushCode("{0} = Buffer.from({0});",I.generateVariable(this.varName))},bA.prototype.generateArray=function(I){var g=I.generateOption(this.options.length),C=I.generateOption(this.options.lengthInBytes),A=this.options.type,i=I.generateTmpVariable(),e=I.generateVariable(this.varName),l=I.generateTmpVariable(),o=this.options.key,t="string"===typeof o;if(t?I.pushCode("{0} = {};",e):I.pushCode("{0} = [];",e),"function"===typeof this.options.readUntil?I.pushCode("do {"):"eof"===this.options.readUntil?I.pushCode("for (var {0} = 0; offset < buffer.length; {0}++) {",i):void 0!==C?I.pushCode("for (var {0} = offset; offset - {0} < {1}; ) {",i,C):I.pushCode("for (var {0} = 0; {0} < {1}; {0}++) {",i,g),"string"===typeof A)if(sA[A]){var c=I.generateTmpVariable();I.pushCode("var {0} = {1}(offset);",c,aA+A),I.pushCode("var {0} = {1}.result; offset = {1}.offset;",l,c),A!==this.alias&&I.addReference(A)}else I.pushCode("var {0} = buffer.read{1}(offset);",l,mA[A]),I.pushCode("offset += {0};",dA[mA[A]]);else A instanceof bA&&(I.pushCode("var {0} = {};",l),I.pushScope(l),A.generate(I),I.popScope());t?I.pushCode("{0}[{2}.{1}] = {2};",e,o,l):I.pushCode("{0}.push({1});",e,l),I.pushCode("}"),"function"===typeof this.options.readUntil&&I.pushCode(" while (!({0}).call(this, {1}, buffer.slice(offset)));",this.options.readUntil,l)},bA.prototype.generateChoiceCase=function(I,g,C){if("string"===typeof C)if(sA[C]){var A=I.generateTmpVariable();I.pushCode("var {0} = {1}(offset);",A,aA+C),I.pushCode("{0} = {1}.result; offset = {1}.offset;",I.generateVariable(this.varName),A),C!==this.alias&&I.addReference(C)}else I.pushCode("{0} = buffer.read{1}(offset);",I.generateVariable(this.varName),mA[C]),I.pushCode("offset += {0};",dA[mA[C]]);else C instanceof bA&&(I.pushPath(g),C.generate(I),I.popPath(g))},bA.prototype.generateChoice=function(I){var g=I.generateOption(this.options.tag);this.varName&&I.pushCode("{0} = {};",I.generateVariable(this.varName)),I.pushCode("switch({0}) {",g),Object.keys(this.options.choices).forEach((function(g){var C=this.options.choices[g];Number.isNaN(parseInt(g,10))?I.pushCode("case '{0}':",g):I.pushCode("case {0}:",g),this.generateChoiceCase(I,this.varName,C),I.pushCode("break;")}),this),I.pushCode("default:"),this.options.defaultChoice?this.generateChoiceCase(I,this.varName,this.options.defaultChoice):I.generateError('"Met undefined tag value " + {0} + " at choice"',g),I.pushCode("}")},bA.prototype.generateNest=function(I){var g=I.generateVariable(this.varName);if(this.options.type instanceof bA)this.varName&&I.pushCode("{0} = {};",g),I.pushPath(this.varName),this.options.type.generate(I),I.popPath(this.varName);else if(sA[this.options.type]){var C=I.generateTmpVariable();I.pushCode("var {0} = {1}(offset);",C,aA+this.options.type),I.pushCode("{0} = {1}.result; offset = {1}.offset;",g,C),this.options.type!==this.alias&&I.addReference(this.options.type)}},bA.prototype.generateFormatter=function(I,g,C){"function"===typeof C&&I.pushCode("{0} = ({1}).call(this, {0});",g,C)},bA.prototype.isInteger=function(){return!!this.type.match(/U?Int[8|16|32][BE|LE]?|Bit\d+/)},bA.prototype.itf8=function(I,g){return this.setNextParser("itf8",I,g)},bA.prototype.itf8=function(I,g){return this.setNextParser("itf8",I,g)},bA.prototype.generateItf8=function(I){var g=I.generateVariable(this.varName),C=I.generateTmpVariable();I.pushCode("\n    var ".concat(C," = buffer[offset];\n    if (").concat(C," < 0x80) {\n      ").concat(g," = ").concat(C,";\n      offset += 1;\n    } else if (").concat(C," < 0xc0) {\n      ").concat(g," = ((").concat(C,"<<8) | buffer[offset+1]) & 0x3fff;\n      offset += 2;\n    } else if (").concat(C," < 0xe0) {\n      ").concat(g," = ((").concat(C,"<<16) | (buffer[offset+1]<< 8) |  buffer[offset+2]) & 0x1fffff;\n      offset += 3;\n    } else if (").concat(C," < 0xf0) {\n      ").concat(g," = ((").concat(C,"<<24) | (buffer[offset+1]<<16) | (buffer[offset+2]<<8) | buffer[offset+3]) & 0x0fffffff;\n      offset += 4\n    } else {\n      ").concat(g," = ((").concat(C," & 0x0f)<<28) | (buffer[offset+1]<<20) | (buffer[offset+2]<<12) | (buffer[offset+3]<<4) | (buffer[offset+4] & 0x0f);\n      // x=((0xff & 0x0f)<<28) | (0xff<<20) | (0xff<<12) | (0xff<<4) | (0x0f & 0x0f);\n      // TODO *val_p = uv < 0x80000000UL ? uv : -((int32_t) (0xffffffffUL - uv)) - 1;\n      offset += 5\n    }\n  "))},bA.prototype.ltf8=function(I,g){return this.setNextParser("ltf8",I,g)},bA.prototype.generateLtf8=function(I){var g=I.generateVariable(this.varName),C=I.generateTmpVariable();I.pushCode("\n  var ".concat(C," = buffer[offset];\n  if (").concat(C," < 0x80) {\n    ").concat(g," = ").concat(C,";\n    offset += 1;\n  } else if (").concat(C," < 0xc0) {\n    ").concat(g," = ((buffer[offset]<<8) | buffer[offset+1]) & 0x3fff;\n    offset += 2;\n  } else if (").concat(C," < 0xe0) {\n    ").concat(g," = ((buffer[offset]<<16) | (buffer[offset+1]<<8) | buffer[offset+2]) & 0x1fffff;\n    ").concat(g," = (((").concat(C," & 63) << 16) | buffer.readUInt16LE(offset + 1));\n    offset += 3;\n  } else if (").concat(C," < 0xf0) {\n    ").concat(g," = ((buffer[offset]<<24) | (buffer[offset+1]<<16) | (buffer[offset+2]<<8) | buffer[offset+3]) & 0x0fffffff;\n    offset += 4;\n  } else if (").concat(C," < 0xf8) {\n    ").concat(g," = (((buffer[offset] & 15) * Math.pow(2,32))) +\n      (buffer[offset+1]<<24) | (buffer[offset+2]<<16 | buffer[offset+3]<<8 | buffer[offset+4])\n    // TODO *val_p = uv < 0x80000000UL ? uv : -((int32_t) (0xffffffffUL - uv)) - 1;\n    offset += 5;\n  } else if (").concat(C," < 0xfc) {\n    ").concat(g," = ((((buffer[offset] & 7) << 8) | buffer[offset+1] )) * Math.pow(2,32) +\n      (buffer[offset+2]<<24) | (buffer[offset+3]<<16 | buffer[offset+4]<<8 | buffer[offset+5])\n    offset += 6;\n  } else if (").concat(C," < 0xfe) {\n    ").concat(g," = ((((buffer[offset] & 3) << 16) | buffer[offset+1]<<8 | buffer[offset+2])) * Math.pow(2,32) +\n      (buffer[offset+3]<<24) | (buffer[offset+4]<<16 | buffer[offset+5]<<8 | buffer[offset+6])\n    offset += 7;\n  } else if (").concat(C," < 0xff) {\n    ").concat(g," = Long.fromBytesBE(buffer.slice(offset+1,offset+8));\n    if (").concat(g,".greaterThan(Number.MAX_SAFE_INTEGER) || ").concat(g,".lessThan(Number.MIN_SAFE_INTEGER))\n      throw new Error('integer overflow')\n    ").concat(g," = ").concat(g,".toNumber()\n    offset += 8;\n  } else {\n    ").concat(g," = Long.fromBytesBE(buffer.slice(offset+1,offset+9));\n    if (").concat(g,".greaterThan(Number.MAX_SAFE_INTEGER) || ").concat(g,".lessThan(Number.MIN_SAFE_INTEGER))\n      throw new Error('integer overflow')\n    ").concat(g," = ").concat(g,".toNumber()\n    offset += 9;\n  }\n  "))},fC.Parser=bA;var rA={},hA={},GA={},uA={};function yA(I,g){if(!(I instanceof g))throw new TypeError("Cannot call a class as a function")}function BA(I,g){for(var C=0;C<g.length;C++){var A=g[C];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(I,A.key,A)}}function VA(I,g,C){return g&&BA(I.prototype,g),C&&BA(I,C),I}function pA(I){return(pA=Object.setPrototypeOf?Object.getPrototypeOf:function(I){return I.__proto__||Object.getPrototypeOf(I)})(I)}function XA(I,g){return(XA=Object.setPrototypeOf||function(I,g){return I.__proto__=g,I})(I,g)}function WA(I){if(void 0===I)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I}function HA(I,g){return!g||"object"!==typeof g&&"function"!==typeof g?WA(I):g}function YA(I){var g=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(im){return!1}}();return function(){var C,A=pA(I);if(g){var i=pA(this).constructor;C=Reflect.construct(A,arguments,i)}else C=A.apply(this,arguments);return HA(this,C)}}function RA(I,g,C){return RA="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(I,g,C){var A=function(I,g){for(;!Object.prototype.hasOwnProperty.call(I,g)&&null!==(I=pA(I)););return I}(I,g);if(A){var i=Object.getOwnPropertyDescriptor(A,g);return i.get?i.get.call(C):i.value}},RA(I,g,C||I)}Object.defineProperty(uA,"__esModule",{value:!0});var fA=function(){function I(){yA(this,I),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return VA(I,[{key:"addEventListener",value:function(I,g,C){I in this.listeners||(this.listeners[I]=[]),this.listeners[I].push({callback:g,options:C})}},{key:"removeEventListener",value:function(I,g){if(I in this.listeners)for(var C=this.listeners[I],A=0,i=C.length;A<i;A++)if(C[A].callback===g)return void C.splice(A,1)}},{key:"dispatchEvent",value:function(I){if(I.type in this.listeners){for(var g=this.listeners[I.type].slice(),C=0,A=g.length;C<A;C++){var i=g[C];try{i.callback.call(this,I)}catch(im){Promise.resolve().then((function(){throw im}))}i.options&&i.options.once&&this.removeEventListener(I.type,i.callback)}return!I.defaultPrevented}}}]),I}(),KA=function(I){!function(I,g){if("function"!==typeof g&&null!==g)throw new TypeError("Super expression must either be null or a function");I.prototype=Object.create(g&&g.prototype,{constructor:{value:I,writable:!0,configurable:!0}}),g&&XA(I,g)}(C,I);var g=YA(C);function C(){var I;return yA(this,C),(I=g.call(this)).listeners||fA.call(WA(I)),Object.defineProperty(WA(I),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(WA(I),"onabort",{value:null,writable:!0,configurable:!0}),I}return VA(C,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(I){"abort"===I.type&&(this.aborted=!0,"function"===typeof this.onabort&&this.onabort.call(this,I)),RA(pA(C.prototype),"dispatchEvent",this).call(this,I)}}]),C}(fA),wA=function(){function I(){yA(this,I),Object.defineProperty(this,"signal",{value:new KA,writable:!0,configurable:!0})}return VA(I,[{key:"abort",value:function(){var I;try{I=new Event("abort")}catch(im){"undefined"!==typeof document?document.createEvent?(I=document.createEvent("Event")).initEvent("abort",!1,!1):(I=document.createEventObject()).type="abort":I={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(I)}},{key:"toString",value:function(){return"[object AbortController]"}}]),I}();"undefined"!==typeof Symbol&&Symbol.toStringTag&&(wA.prototype[Symbol.toStringTag]="AbortController",KA.prototype[Symbol.toStringTag]="AbortSignal"),uA.AbortController=wA,uA.AbortSignal=KA,uA.abortableFetch=function(I){"function"===typeof I&&(I={fetch:I});var g,C=I,A=C.fetch,i=C.Request,e=void 0===i?A.Request:i,l=C.AbortController,o=C.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL,t=void 0!==o&&o;if(!((g={fetch:A,Request:e,AbortController:l,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:t}).__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),1):"function"===typeof g.Request&&!g.Request.prototype.hasOwnProperty("signal")||!g.AbortController))return{fetch:A,Request:c};var c=e;(c&&!c.prototype.hasOwnProperty("signal")||t)&&((c=function(I,g){var C;g&&g.signal&&(C=g.signal,delete g.signal);var A=new e(I,g);return C&&Object.defineProperty(A,"signal",{writable:!1,enumerable:!1,configurable:!0,value:C}),A}).prototype=e.prototype);var n=A;return{fetch:function(I,g){var C=c&&c.prototype.isPrototypeOf(I)?I.signal:g?g.signal:void 0;if(C){var A;try{A=new DOMException("Aborted","AbortError")}catch(e){(A=new Error("Aborted")).name="AbortError"}if(C.aborted)return Promise.reject(A);var i=new Promise((function(I,g){C.addEventListener("abort",(function(){return g(A)}),{once:!0})}));return g&&g.signal&&delete g.signal,Promise.race([i,n(I,g)])}return n(I,g)},Request:c}},Object.defineProperty(GA,"__esModule",{value:!0}),GA.AbortSignal=GA.AbortController=void 0;var JA=uA,SA=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof sC)return sC;throw new Error("unable to locate global object")},FA="undefined"===typeof SA().AbortController?JA.AbortController:SA().AbortController;GA.AbortController=FA;var NA="undefined"===typeof SA().AbortController?JA.AbortSignal:SA().AbortSignal;GA.AbortSignal=NA;var vA={},kA=bC.exports;Object.defineProperty(vA,"__esModule",{value:!0}),vA.default=void 0;var DA=kA(yC.exports),zA=kA(RC.exports),MA=kA(uC.exports),UA=GA,xA=function I(){(0,MA.default)(this,I)},TA=function(){function I(){(0,MA.default)(this,I),(0,zA.default)(this,"signals",new Set),(0,zA.default)(this,"abortController",new UA.AbortController)}return(0,DA.default)(I,[{key:"addSignal",value:function(){var I=this,g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xA;if(this.signal.aborted)throw new Error("cannot add a signal, already aborted!");this.signals.add(g),g.aborted?this.handleAborted(g):"function"===typeof g.addEventListener&&g.addEventListener("abort",(function(){I.handleAborted(g)}))}},{key:"handleAborted",value:function(I){this.signals.delete(I),0===this.signals.size&&this.abortController.abort()}},{key:"abort",value:function(){this.abortController.abort()}},{key:"signal",get:function(){return this.abortController.signal}}]),I}();vA.default=TA;var QA={},PA=bC.exports;Object.defineProperty(QA,"__esModule",{value:!0}),QA.default=void 0;var OA=PA(uC.exports),jA=PA(yC.exports),LA=PA(RC.exports),EA=function(){function I(){(0,OA.default)(this,I),(0,LA.default)(this,"callbacks",new Set),(0,LA.default)(this,"currentMessage",void 0)}return(0,jA.default)(I,[{key:"addCallback",value:function(){var I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.callbacks.add(I),I(this.currentMessage)}},{key:"callback",value:function(I){this.currentMessage=I,this.callbacks.forEach((function(g){g(I)}))}}]),I}();QA.default=EA;var _A=bC.exports;Object.defineProperty(hA,"__esModule",{value:!0}),hA.default=void 0;var $A=_A(XC.exports),qA=_A(uC.exports),Ii=_A(yC.exports),gi=_A(RC.exports),Ci=GA,Ai=_A(vA),ii=_A(QA),ei=function(){function I(g){var C=g.fill,A=g.cache;if((0,qA.default)(this,I),(0,gi.default)(this,"cache",void 0),(0,gi.default)(this,"fillCallback",void 0),"function"!==typeof C)throw new TypeError("must pass a fill function");if("object"!==(0,$A.default)(A))throw new TypeError("must pass a cache object");if("function"!==typeof A.get||"function"!==typeof A.set||"function"!==typeof A.delete)throw new TypeError("cache must implement get(key), set(key, val), and and delete(key)");this.cache=A,this.fillCallback=C}return(0,Ii.default)(I,[{key:"evict",value:function(I,g){this.cache.get(I)===g&&this.cache.delete(I)}},{key:"fill",value:function(I,g,C,A){var i=this,e=new Ai.default,l=new ii.default;l.addCallback(A);var o={aborter:e,promise:this.fillCallback(g,e.signal,(function(I){l.callback(I)})),settled:!1,statusReporter:l,get aborted(){return this.aborter.signal.aborted}};o.aborter.addSignal(C),o.aborter.signal.addEventListener("abort",(function(){o.settled||i.evict(I,o)})),o.promise.then((function(){o.settled=!0}),(function(g){o.settled=!0,i.evict(I,o)})).catch((function(I){throw console.error(I),I})),this.cache.set(I,o)}},{key:"has",value:function(I){return this.cache.has(I)}},{key:"get",value:function(g,C,A,i){if(!A&&C instanceof Ci.AbortSignal)throw new TypeError("second get argument appears to be an AbortSignal, perhaps you meant to pass `null` for the fill data?");var e=this.cache.get(g);return e?e.aborted&&!e.settled?(this.evict(g,e),this.get(g,C,A,i)):e.settled?e.promise:(e.aborter.addSignal(A),e.statusReporter.addCallback(i),I.checkSinglePromise(e.promise,A)):(this.fill(g,C,A,i),I.checkSinglePromise(this.cache.get(g).promise,A))}},{key:"delete",value:function(I){var g=this.cache.get(I);g&&(g.settled||g.aborter.abort(),this.cache.delete(I))}},{key:"clear",value:function(){for(var I=this.cache.keys(),g=0,C=I.next();!C.done;C=I.next())this.delete(C.value),g+=1;return g}}],[{key:"isAbortException",value:function(I){return"AbortError"===I.name||"ERR_ABORTED"===I.code||"AbortError: aborted"===I.message||"Error: aborted"===I.message}},{key:"checkSinglePromise",value:function(I,g){function C(){if(g&&g.aborted)throw Object.assign(new Error("aborted"),{code:"ERR_ABORTED"})}return I.then((function(I){return C(),I}),(function(I){throw C(),I}))}}]),I}();hA.default=ei;var li=bC.exports;Object.defineProperty(rA,"__esModule",{value:!0}),rA.default=void 0;var oi=li(hA).default;function ti(I){return E.Buffer.from(Object($.a)(I))}rA.default=oi;var ci={inflateSync:ti},ni=aC(Object.freeze(Object.defineProperty({__proto__:null,inflateSync:ti,default:ci},Symbol.toStringTag,{value:"Module"}))),di={},si=bC.exports;Object.defineProperty(di,"__esModule",{value:!0}),di.default=void 0;var ai=si(uC.exports),Zi=si(yC.exports),mi=si(RC.exports),bi=function(){function I(g,C){(0,ai.default)(this,I),(0,mi.default)(this,"ranges",void 0),this.ranges=2===arguments.length?[{min:g,max:C}]:0 in g?Object.assign({},g):[g]}return(0,Zi.default)(I,[{key:"min",value:function(){return this.ranges[0].min}},{key:"max",value:function(){return this.ranges[this.ranges.length-1].max}},{key:"contains",value:function(I){for(var g=0;g<this.ranges.length;g+=1){var C=this.ranges[g];if(C.min<=I&&C.max>=I)return!0}return!1}},{key:"isContiguous",value:function(){return this.ranges.length>1}},{key:"getRanges",value:function(){return this.ranges.map((function(g){return new I(g.min,g.max)}))}},{key:"toString",value:function(){return this.ranges.map((function(I){return"[".concat(I.min,"-").concat(I.max,"]")})).join(",")}},{key:"union",value:function(g){for(var C=this.getRanges().concat(g.getRanges()).sort(this.rangeOrder),A=[],i=C[0],e=1;e<C.length;e+=1){var l=C[e];l.min()>i.max()+1?(A.push(i),i=l):l.max()>i.max()&&(i=new I(i.min(),l.max()))}return A.push(i),1===A.length?A[0]:new I(A)}},{key:"intersection",value:function(g){for(var C=this,A=g,i=this.ranges(),e=A.ranges(),l=i.length,o=e.length,t=0,c=0,n=[];t<l&&c<o;){C=i[t],A=e[c];var d=Math.max(C.min(),A.min()),s=Math.min(C.max(),A.max());s>=d&&n.push(new I(d,s)),C.max()>A.max()?c+=1:t+=1}if(0===n.length)throw new Error("found range of length 0");return 1===n.length?n[0]:new I(n)}},{key:"coverage",value:function(){for(var I=0,g=this.ranges(),C=0;C<g.length;C+=1){var A=g[C];I+=A.max()-A.min()+1}return I}},{key:"rangeOrder",value:function(I,g){var C=I,A=g;return arguments.length<2&&(A=C,C=this),C.min()<A.min()?-1:C.min()>A.min()?1:C.max()<A.max()?-1:A.max()>C.max()?1:0}}]),I}();di.default=bi;var ri={},hi={exports:{}},Gi={exports:{}};!function(I){I.exports=function(I){return-1!==Function.toString.call(I).indexOf("[native code]")},I.exports.default=I.exports,I.exports.__esModule=!0}(Gi);var ui={exports:{}},yi={exports:{}};!function(I){I.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(im){return!1}},I.exports.default=I.exports,I.exports.__esModule=!0}(yi),function(I){var g=VC.exports,C=yi.exports;function A(i,e,l){return C()?(I.exports=A=Reflect.construct,I.exports.default=I.exports,I.exports.__esModule=!0):(I.exports=A=function(I,C,A){var i=[null];i.push.apply(i,C);var e=new(Function.bind.apply(I,i));return A&&g(e,A.prototype),e},I.exports.default=I.exports,I.exports.__esModule=!0),A.apply(null,arguments)}I.exports=A,I.exports.default=I.exports,I.exports.__esModule=!0}(ui),function(I){var g=HC.exports,C=VC.exports,A=Gi.exports,i=ui.exports;function e(l){var o="function"===typeof Map?new Map:void 0;return I.exports=e=function(I){if(null===I||!A(I))return I;if("function"!==typeof I)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof o){if(o.has(I))return o.get(I);o.set(I,e)}function e(){return i(I,arguments,g(this).constructor)}return e.prototype=Object.create(I.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),C(e,I)},I.exports.default=I.exports,I.exports.__esModule=!0,e(l)}I.exports=e,I.exports.default=I.exports,I.exports.__esModule=!0}(hi);var Bi=bC.exports;Object.defineProperty(ri,"__esModule",{value:!0}),ri.groupBlocks=function(I){I.sort((function(I,g){return(0|I.offset)-(0|g.offset)}));for(var g,C,A=[],i=0;i<I.length;i+=1)g&&I[i].offset-C<=2e3?(g.length+=I[i].length-C+I[i].offset,g.blocks.push(I[i])):A.push(g={blocks:[I[i]],length:I[i].length,offset:I[i].offset}),C=g.offset+g.length;return A},ri.checkAbortSignal=Si,ri.abortBreakPoint=function(I){return Fi.apply(this,arguments)},ri.AbortError=void 0;var Vi=Bi(hC),pi=Bi(GC.exports),Xi=Bi(uC.exports),Wi=Bi(WC.exports),Hi=Bi(BC.exports),Yi=Bi(pC.exports),Ri=Bi(HC.exports),fi=Bi(hi.exports),Ki=Bi(RC.exports);function wi(I){var g=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(im){return!1}}();return function(){var C,A=(0,Ri.default)(I);if(g){var i=(0,Ri.default)(this).constructor;C=Reflect.construct(A,arguments,i)}else C=A.apply(this,arguments);return(0,Yi.default)(this,C)}}var Ji=function(I){(0,Hi.default)(C,I);var g=wi(C);function C(I){var A;return(0,Xi.default)(this,C),A=g.call(this,I),(0,Ki.default)((0,Wi.default)(A),"code",void 0),A.code="ERR_ABORTED",A}return C}((0,fi.default)(Error));function Si(I){if(I&&I.aborted){if("undefined"!==typeof DOMException)throw new DOMException("aborted","AbortError");var g=new Ji("aborted");throw g.code="ERR_ABORTED",g}}function Fi(){return(Fi=(0,pi.default)(Vi.default.mark((function I(g){return Vi.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,Promise.resolve();case 2:Si(g);case 3:case"end":return I.stop()}}),I)})))).apply(this,arguments)}ri.AbortError=Ji;var Ni=bC.exports;Object.defineProperty(YC,"__esModule",{value:!0}),YC.BlockView=void 0;var vi=Ni(hC),ki=Ni(GC.exports),Di=Ni(uC.exports),zi=Ni(yC.exports),Mi=Ni(RC.exports),Ui=fC,xi=Ni(rA),Ti=Ni(ni),Qi=Ni(q.a),Pi=Ni(di),Oi=ri;function ji(I,g){var C=Object.keys(I);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(I);g&&(A=A.filter((function(g){return Object.getOwnPropertyDescriptor(I,g).enumerable}))),C.push.apply(C,A)}return C}function Li(I){for(var g=1;g<arguments.length;g++){var C=null!=arguments[g]?arguments[g]:{};g%2?ji(Object(C),!0).forEach((function(g){(0,Mi.default)(I,g,C[g])})):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(C)):ji(Object(C)).forEach((function(g){Object.defineProperty(I,g,Object.getOwnPropertyDescriptor(C,g))}))}return I}var Ei=function(){function I(g,C,i,e,l,o,t){var c=this;if((0,Di.default)(this,I),(0,Mi.default)(this,"cirTreeOffset",void 0),(0,Mi.default)(this,"cirTreeLength",void 0),(0,Mi.default)(this,"bbi",void 0),(0,Mi.default)(this,"isCompressed",void 0),(0,Mi.default)(this,"isBigEndian",void 0),(0,Mi.default)(this,"refsByName",void 0),(0,Mi.default)(this,"blockType",void 0),(0,Mi.default)(this,"cirTreePromise",void 0),(0,Mi.default)(this,"featureCache",new xi.default({cache:new Qi.default({maxSize:1e3}),fill:function(){var I=(0,ki.default)(vi.default.mark((function I(g,C){var i,e,l,o;return vi.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return i=g.length,e=g.offset,I.next=3,c.bbi.read(A.alloc(i),0,i,e,{signal:C});case 3:return l=I.sent,o=l.buffer,I.abrupt("return",o);case 6:case"end":return I.stop()}}),I)})));return function(g,C){return I.apply(this,arguments)}}()})),(0,Mi.default)(this,"leafParser",void 0),(0,Mi.default)(this,"bigWigParser",void 0),(0,Mi.default)(this,"bigBedParser",void 0),(0,Mi.default)(this,"summaryParser",void 0),!(i>=0))throw new Error("invalid cirTreeOffset!");if(!(e>0))throw new Error("invalid cirTreeLength!");this.cirTreeOffset=i,this.cirTreeLength=e,this.isCompressed=o,this.refsByName=C,this.isBigEndian=l,this.bbi=g,this.blockType=t,Object.assign(this,function(I){var g,C=I?"big":"little",A=(new Ui.Parser).endianess(C).uint32("chromId").uint32("start").uint32("end").uint32("validCnt").float("minScore").float("maxScore").float("sumData").float("sumSqData"),i=(new Ui.Parser).endianess(C).uint8("isLeaf").skip(1).uint16("cnt").choice({tag:"isLeaf",choices:{1:(new Ui.Parser).array("blocksToFetch",{length:"cnt",type:(new Ui.Parser).uint32("startChrom").uint32("startBase").uint32("endChrom").uint32("endBase").uint64("blockOffset").uint64("blockSize")}),0:(new Ui.Parser).array("recurOffsets",{length:"cnt",type:(new Ui.Parser).uint32("startChrom").uint32("startBase").uint32("endChrom").uint32("endBase").uint64("blockOffset")})}}),e=(new Ui.Parser).endianess(C).uint32("chromId").int32("start").int32("end").string("rest",{zeroTerminated:!0});return{bigWigParser:(new Ui.Parser).endianess(C).skip(4).int32("blockStart").skip(4).uint32("itemStep").uint32("itemSpan").uint8("blockType").skip(1).uint16("itemCount").choice({tag:"blockType",choices:(g={},(0,Mi.default)(g,3,(new Ui.Parser).array("items",{length:"itemCount",type:(new Ui.Parser).float("score")})),(0,Mi.default)(g,2,(new Ui.Parser).array("items",{length:"itemCount",type:(new Ui.Parser).int32("start").float("score")})),(0,Mi.default)(g,1,(new Ui.Parser).array("items",{length:"itemCount",type:(new Ui.Parser).int32("start").int32("end").float("score")})),g)}),bigBedParser:e,summaryParser:A,leafParser:i}}(l))}return(0,zi.default)(I,[{key:"readWigData",value:function(){var I=(0,ki.default)(vi.default.mark((function I(g,C,i,e,l){var o,t,c,n,d,s,a,Z,m,b,r,h,G,u,y,B,V=this;return vi.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.prev=0,o=this.refsByName,t=this.bbi,c=this.cirTreeOffset,n=this.isBigEndian,d=l.signal,void 0===(s=o[g])&&e.complete(),a={chrId:s,start:C,end:i},this.cirTreePromise||(this.cirTreePromise=t.read(A.alloc(48),0,48,c,{signal:d})),I.next=9,this.cirTreePromise;case 9:return Z=I.sent,m=Z.buffer,b=n?m.readUInt32BE(4):m.readUInt32LE(4),r=[],h=0,u=function(I){return(I.startChrom<s||I.startChrom===s&&I.startBase<=i)&&(I.endChrom>s||I.endChrom===s&&I.endBase>=C)},y=function(){var I=(0,ki.default)(vi.default.mark((function I(g,C,A){var i,o,t,c;return vi.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.prev=0,i=C.max()-C.min(),o=C.min(),I.next=5,V.featureCache.get("".concat(i,"_").concat(o),{length:i,offset:o},d);case 5:for(t=I.sent,c=0;c<g.length;c+=1)C.contains(g[c])&&(G(t,g[c]-o,A,e,l),0===(h-=1)&&V.readFeatures(e,r,Li(Li({},l),{},{request:a})));I.next=12;break;case 9:I.prev=9,I.t0=I.catch(0),e.error(I.t0);case 12:case"end":return I.stop()}}),I,null,[[0,9]])})));return function(g,C,A){return I.apply(this,arguments)}}(),B=function(I,g){try{h+=I.length;for(var C=4+32*b,A=new Pi.default(I[0],I[0]+C),i=1;i<I.length;i+=1){var l=new Pi.default(I[i],I[i]+C);A=A.union(l)}A.getRanges().map((function(C){return y(I,C,g)}))}catch(im){e.error(im)}},G=function(I,g,C){try{var A=I.slice(g),i=V.leafParser.parse(A).result;if(i.blocksToFetch&&(r=r.concat(i.blocksToFetch.filter(u).map((function(I){return{offset:I.blockOffset,length:I.blockSize}})))),i.recurOffsets){var l=i.recurOffsets.filter(u).map((function(I){return I.blockOffset}));l.length>0&&B(l,C+1)}}catch(im){e.error(im)}},I.abrupt("return",B([c+48],1));case 21:I.prev=21,I.t0=I.catch(0),e.error(I.t0);case 24:case"end":return I.stop()}}),I,this,[[0,21]])})));return function(g,C,A,i,e){return I.apply(this,arguments)}}()},{key:"parseSummaryBlock",value:function(g,C,A){for(var i=[],e=C;e<g.byteLength;){var l=this.summaryParser.parse(g.slice(e));i.push(l.result),e+=l.offset}var o=i;return A&&(o=o.filter((function(I){return I.chromId===A.chrId}))),o=o.map((function(I){return{start:I.start,end:I.end,maxScore:I.maxScore,minScore:I.minScore,score:I.sumData/(I.validCnt||1),summary:!0}})),A?o.filter((function(g){return I.coordFilter(g,A)})):o}},{key:"parseBigBedBlock",value:function(g,C,A,i){for(var e=[],l=C;l<g.byteLength;){var o=this.bigBedParser.parse(g.slice(l));o.result.uniqueId="bb-".concat(A+l),e.push(o.result),l+=o.offset}return i?e.filter((function(g){return I.coordFilter(g,i)})):e}},{key:"parseBigWigBlock",value:function(g,C,A){var i=g.slice(C),e=this.bigWigParser.parse(i).result,l=e.items,o=e.itemSpan,t=e.itemStep,c=e.blockStart,n=e.blockType;if(3===n)for(var d=0;d<l.length;d++)l[d].start=c+d*t,l[d].end=c+d*t+o;else if(2===n)for(var s=0;s<l.length;s++)l[s].end=l[s].start+o;return A?l.filter((function(g){return I.coordFilter(g,A)})):l}},{key:"readFeatures",value:function(){var I=(0,ki.default)(vi.default.mark((function I(g,C){var A,i,e,l,o,t,c=this,n=arguments;return vi.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return A=n.length>2&&void 0!==n[2]?n[2]:{},I.prev=1,i=this.blockType,e=this.isCompressed,l=A.signal,o=A.request,t=(0,Oi.groupBlocks)(C),(0,Oi.checkAbortSignal)(l),I.next=8,Promise.all(t.map(function(){var I=(0,ki.default)(vi.default.mark((function I(C){var A,t,n;return vi.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return(0,Oi.checkAbortSignal)(l),A=C.length,t=C.offset,I.next=4,c.featureCache.get("".concat(A,"_").concat(t),C,l);case 4:n=I.sent,C.blocks.forEach((function(I){(0,Oi.checkAbortSignal)(l);var A=I.offset-C.offset,t=n;switch(e&&(t=Ti.default.inflateSync(n.slice(A)),A=0),(0,Oi.checkAbortSignal)(l),i){case"summary":g.next(c.parseSummaryBlock(t,A,o));break;case"bigwig":g.next(c.parseBigWigBlock(t,A,o));break;case"bigbed":g.next(c.parseBigBedBlock(t,A,256*I.offset,o));break;default:console.warn("Don't know what to do with ".concat(i))}}));case 6:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}()));case 8:g.complete(),I.next=14;break;case 11:I.prev=11,I.t0=I.catch(1),g.error(I.t0);case 14:case"end":return I.stop()}}),I,this,[[1,11]])})));return function(g,C){return I.apply(this,arguments)}}()}],[{key:"coordFilter",value:function(I,g){return I.start<g.end&&I.end>=g.start}}]),I}();YC.BlockView=Ei;var _i={},$i=function(I,g){return($i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,g){I.__proto__=g}||function(I,g){for(var C in g)g.hasOwnProperty(C)&&(I[C]=g[C])})(I,g)};function qi(I,g){function C(){this.constructor=I}$i(I,g),I.prototype=null===g?Object.create(g):(C.prototype=g.prototype,new C)}function Ie(I){return"function"===typeof I}var ge=!1,Ce={Promise:void 0,set useDeprecatedSynchronousErrorHandling(I){I&&(new Error).stack;ge=I},get useDeprecatedSynchronousErrorHandling(){return ge}};function Ae(I){setTimeout((function(){throw I}),0)}var ie={closed:!0,next:function(I){},error:function(I){if(Ce.useDeprecatedSynchronousErrorHandling)throw I;Ae(I)},complete:function(){}},ee=function(){return Array.isArray||function(I){return I&&"number"===typeof I.length}}();function le(I){return null!==I&&"object"===typeof I}var oe=function(){function I(I){return Error.call(this),this.message=I?I.length+" errors occurred during unsubscription:\n"+I.map((function(I,g){return g+1+") "+I.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=I,this}return I.prototype=Object.create(Error.prototype),I}(),te=oe,ce=function(){function I(I){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,I&&(this._ctorUnsubscribe=!0,this._unsubscribe=I)}var g;return I.prototype.unsubscribe=function(){var g;if(!this.closed){var C=this,A=C._parentOrParents,i=C._ctorUnsubscribe,e=C._unsubscribe,l=C._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,A instanceof I)A.remove(this);else if(null!==A)for(var o=0;o<A.length;++o){A[o].remove(this)}if(Ie(e)){i&&(this._unsubscribe=void 0);try{e.call(this)}catch(im){g=im instanceof te?ne(im.errors):[im]}}if(ee(l)){o=-1;for(var t=l.length;++o<t;){var c=l[o];if(le(c))try{c.unsubscribe()}catch(im){g=g||[],im instanceof te?g=g.concat(ne(im.errors)):g.push(im)}}}if(g)throw new te(g)}},I.prototype.add=function(g){var C=g;if(!g)return I.EMPTY;switch(typeof g){case"function":C=new I(g);case"object":if(C===this||C.closed||"function"!==typeof C.unsubscribe)return C;if(this.closed)return C.unsubscribe(),C;if(!(C instanceof I)){var A=C;(C=new I)._subscriptions=[A]}break;default:throw new Error("unrecognized teardown "+g+" added to Subscription.")}var i=C._parentOrParents;if(null===i)C._parentOrParents=this;else if(i instanceof I){if(i===this)return C;C._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return C;i.push(this)}var e=this._subscriptions;return null===e?this._subscriptions=[C]:e.push(C),C},I.prototype.remove=function(I){var g=this._subscriptions;if(g){var C=g.indexOf(I);-1!==C&&g.splice(C,1)}},I.EMPTY=((g=new I).closed=!0,g),I}();function ne(I){return I.reduce((function(I,g){return I.concat(g instanceof te?g.errors:g)}),[])}var de=function(){return"function"===typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),se=function(I){function g(C,A,i){var e=I.call(this)||this;switch(e.syncErrorValue=null,e.syncErrorThrown=!1,e.syncErrorThrowable=!1,e.isStopped=!1,arguments.length){case 0:e.destination=ie;break;case 1:if(!C){e.destination=ie;break}if("object"===typeof C){C instanceof g?(e.syncErrorThrowable=C.syncErrorThrowable,e.destination=C,C.add(e)):(e.syncErrorThrowable=!0,e.destination=new ae(e,C));break}default:e.syncErrorThrowable=!0,e.destination=new ae(e,C,A,i)}return e}return qi(g,I),g.prototype[de]=function(){return this},g.create=function(I,C,A){var i=new g(I,C,A);return i.syncErrorThrowable=!1,i},g.prototype.next=function(I){this.isStopped||this._next(I)},g.prototype.error=function(I){this.isStopped||(this.isStopped=!0,this._error(I))},g.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},g.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,I.prototype.unsubscribe.call(this))},g.prototype._next=function(I){this.destination.next(I)},g.prototype._error=function(I){this.destination.error(I),this.unsubscribe()},g.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},g.prototype._unsubscribeAndRecycle=function(){var I=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=I,this},g}(ce),ae=function(I){function g(g,C,A,i){var e,l=I.call(this)||this;l._parentSubscriber=g;var o=l;return Ie(C)?e=C:C&&(e=C.next,A=C.error,i=C.complete,C!==ie&&(Ie((o=Object.create(C)).unsubscribe)&&l.add(o.unsubscribe.bind(o)),o.unsubscribe=l.unsubscribe.bind(l))),l._context=o,l._next=e,l._error=A,l._complete=i,l}return qi(g,I),g.prototype.next=function(I){if(!this.isStopped&&this._next){var g=this._parentSubscriber;Ce.useDeprecatedSynchronousErrorHandling&&g.syncErrorThrowable?this.__tryOrSetError(g,this._next,I)&&this.unsubscribe():this.__tryOrUnsub(this._next,I)}},g.prototype.error=function(I){if(!this.isStopped){var g=this._parentSubscriber,C=Ce.useDeprecatedSynchronousErrorHandling;if(this._error)C&&g.syncErrorThrowable?(this.__tryOrSetError(g,this._error,I),this.unsubscribe()):(this.__tryOrUnsub(this._error,I),this.unsubscribe());else if(g.syncErrorThrowable)C?(g.syncErrorValue=I,g.syncErrorThrown=!0):Ae(I),this.unsubscribe();else{if(this.unsubscribe(),C)throw I;Ae(I)}}},g.prototype.complete=function(){var I=this;if(!this.isStopped){var g=this._parentSubscriber;if(this._complete){var C=function(){return I._complete.call(I._context)};Ce.useDeprecatedSynchronousErrorHandling&&g.syncErrorThrowable?(this.__tryOrSetError(g,C),this.unsubscribe()):(this.__tryOrUnsub(C),this.unsubscribe())}else this.unsubscribe()}},g.prototype.__tryOrUnsub=function(I,g){try{I.call(this._context,g)}catch(C){if(this.unsubscribe(),Ce.useDeprecatedSynchronousErrorHandling)throw C;Ae(C)}},g.prototype.__tryOrSetError=function(I,g,C){if(!Ce.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{g.call(this._context,C)}catch(A){return Ce.useDeprecatedSynchronousErrorHandling?(I.syncErrorValue=A,I.syncErrorThrown=!0,!0):(Ae(A),!0)}return!1},g.prototype._unsubscribe=function(){var I=this._parentSubscriber;this._context=null,this._parentSubscriber=null,I.unsubscribe()},g}(se);function Ze(I){for(;I;){var g=I,C=g.closed,A=g.destination,i=g.isStopped;if(C||i)return!1;I=A&&A instanceof se?A:null}return!0}var me=function(){return"function"===typeof Symbol&&Symbol.observable||"@@observable"}();function be(I){return I}function re(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];return he(I)}function he(I){return 0===I.length?be:1===I.length?I[0]:function(g){return I.reduce((function(I,g){return g(I)}),g)}}var Ge=function(){function I(I){this._isScalar=!1,I&&(this._subscribe=I)}return I.prototype.lift=function(g){var C=new I;return C.source=this,C.operator=g,C},I.prototype.subscribe=function(I,g,C){var A=this.operator,i=function(I,g,C){if(I){if(I instanceof se)return I;if(I[de])return I[de]()}return I||g||C?new se(I,g,C):new se(ie)}(I,g,C);if(A?i.add(A.call(i,this.source)):i.add(this.source||Ce.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),Ce.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},I.prototype._trySubscribe=function(I){try{return this._subscribe(I)}catch(g){Ce.useDeprecatedSynchronousErrorHandling&&(I.syncErrorThrown=!0,I.syncErrorValue=g),Ze(I)?I.error(g):console.warn(g)}},I.prototype.forEach=function(I,g){var C=this;return new(g=ue(g))((function(g,A){var i;i=C.subscribe((function(g){try{I(g)}catch(C){A(C),i&&i.unsubscribe()}}),A,g)}))},I.prototype._subscribe=function(I){var g=this.source;return g&&g.subscribe(I)},I.prototype[me]=function(){return this},I.prototype.pipe=function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];return 0===I.length?this:he(I)(this)},I.prototype.toPromise=function(I){var g=this;return new(I=ue(I))((function(I,C){var A;g.subscribe((function(I){return A=I}),(function(I){return C(I)}),(function(){return I(A)}))}))},I.create=function(g){return new I(g)},I}();function ue(I){if(I||(I=Ce.Promise||Promise),!I)throw new Error("no Promise impl found");return I}var ye=function(){function I(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return I.prototype=Object.create(Error.prototype),I}(),Be=function(I){function g(g,C){var A=I.call(this)||this;return A.subject=g,A.subscriber=C,A.closed=!1,A}return qi(g,I),g.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var I=this.subject,g=I.observers;if(this.subject=null,g&&0!==g.length&&!I.isStopped&&!I.closed){var C=g.indexOf(this.subscriber);-1!==C&&g.splice(C,1)}}},g}(ce),Ve=function(I){function g(g){var C=I.call(this,g)||this;return C.destination=g,C}return qi(g,I),g}(se),pe=function(I){function g(){var g=I.call(this)||this;return g.observers=[],g.closed=!1,g.isStopped=!1,g.hasError=!1,g.thrownError=null,g}return qi(g,I),g.prototype[de]=function(){return new Ve(this)},g.prototype.lift=function(I){var g=new Xe(this,this);return g.operator=I,g},g.prototype.next=function(I){if(this.closed)throw new ye;if(!this.isStopped)for(var g=this.observers,C=g.length,A=g.slice(),i=0;i<C;i++)A[i].next(I)},g.prototype.error=function(I){if(this.closed)throw new ye;this.hasError=!0,this.thrownError=I,this.isStopped=!0;for(var g=this.observers,C=g.length,A=g.slice(),i=0;i<C;i++)A[i].error(I);this.observers.length=0},g.prototype.complete=function(){if(this.closed)throw new ye;this.isStopped=!0;for(var I=this.observers,g=I.length,C=I.slice(),A=0;A<g;A++)C[A].complete();this.observers.length=0},g.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},g.prototype._trySubscribe=function(g){if(this.closed)throw new ye;return I.prototype._trySubscribe.call(this,g)},g.prototype._subscribe=function(I){if(this.closed)throw new ye;return this.hasError?(I.error(this.thrownError),ce.EMPTY):this.isStopped?(I.complete(),ce.EMPTY):(this.observers.push(I),new Be(this,I))},g.prototype.asObservable=function(){var I=new Ge;return I.source=this,I},g.create=function(I,g){return new Xe(I,g)},g}(Ge),Xe=function(I){function g(g,C){var A=I.call(this)||this;return A.destination=g,A.source=C,A}return qi(g,I),g.prototype.next=function(I){var g=this.destination;g&&g.next&&g.next(I)},g.prototype.error=function(I){var g=this.destination;g&&g.error&&this.destination.error(I)},g.prototype.complete=function(){var I=this.destination;I&&I.complete&&this.destination.complete()},g.prototype._subscribe=function(I){return this.source?this.source.subscribe(I):ce.EMPTY},g}(pe);function We(){return function(I){return I.lift(new He(I))}}var He=function(){function I(I){this.connectable=I}return I.prototype.call=function(I,g){var C=this.connectable;C._refCount++;var A=new Ye(I,C),i=g.subscribe(A);return A.closed||(A.connection=C.connect()),i},I}(),Ye=function(I){function g(g,C){var A=I.call(this,g)||this;return A.connectable=C,A}return qi(g,I),g.prototype._unsubscribe=function(){var I=this.connectable;if(I){this.connectable=null;var g=I._refCount;if(g<=0)this.connection=null;else if(I._refCount=g-1,g>1)this.connection=null;else{var C=this.connection,A=I._connection;this.connection=null,!A||C&&A!==C||A.unsubscribe()}}else this.connection=null},g}(se),Re=function(I){function g(g,C){var A=I.call(this)||this;return A.source=g,A.subjectFactory=C,A._refCount=0,A._isComplete=!1,A}return qi(g,I),g.prototype._subscribe=function(I){return this.getSubject().subscribe(I)},g.prototype.getSubject=function(){var I=this._subject;return I&&!I.isStopped||(this._subject=this.subjectFactory()),this._subject},g.prototype.connect=function(){var I=this._connection;return I||(this._isComplete=!1,(I=this._connection=new ce).add(this.source.subscribe(new Ke(this.getSubject(),this))),I.closed&&(this._connection=null,I=ce.EMPTY)),I},g.prototype.refCount=function(){return We()(this)},g}(Ge),fe=function(){var I=Re.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:I._subscribe},_isComplete:{value:I._isComplete,writable:!0},getSubject:{value:I.getSubject},connect:{value:I.connect},refCount:{value:I.refCount}}}(),Ke=function(I){function g(g,C){var A=I.call(this,g)||this;return A.connectable=C,A}return qi(g,I),g.prototype._error=function(g){this._unsubscribe(),I.prototype._error.call(this,g)},g.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),I.prototype._complete.call(this)},g.prototype._unsubscribe=function(){var I=this.connectable;if(I){this.connectable=null;var g=I._connection;I._refCount=0,I._subject=null,I._connection=null,g&&g.unsubscribe()}},g}(Ve);var we=function(){function I(I,g,C,A){this.keySelector=I,this.elementSelector=g,this.durationSelector=C,this.subjectSelector=A}return I.prototype.call=function(I,g){return g.subscribe(new Je(I,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},I}(),Je=function(I){function g(g,C,A,i,e){var l=I.call(this,g)||this;return l.keySelector=C,l.elementSelector=A,l.durationSelector=i,l.subjectSelector=e,l.groups=null,l.attemptedToUnsubscribe=!1,l.count=0,l}return qi(g,I),g.prototype._next=function(I){var g;try{g=this.keySelector(I)}catch(C){return void this.error(C)}this._group(I,g)},g.prototype._group=function(I,g){var C=this.groups;C||(C=this.groups=new Map);var A,i=C.get(g);if(this.elementSelector)try{A=this.elementSelector(I)}catch(o){this.error(o)}else A=I;if(!i){i=this.subjectSelector?this.subjectSelector():new pe,C.set(g,i);var e=new Fe(g,i,this);if(this.destination.next(e),this.durationSelector){var l=void 0;try{l=this.durationSelector(new Fe(g,i))}catch(o){return void this.error(o)}this.add(l.subscribe(new Se(g,i,this)))}}i.closed||i.next(A)},g.prototype._error=function(I){var g=this.groups;g&&(g.forEach((function(g,C){g.error(I)})),g.clear()),this.destination.error(I)},g.prototype._complete=function(){var I=this.groups;I&&(I.forEach((function(I,g){I.complete()})),I.clear()),this.destination.complete()},g.prototype.removeGroup=function(I){this.groups.delete(I)},g.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&I.prototype.unsubscribe.call(this))},g}(se),Se=function(I){function g(g,C,A){var i=I.call(this,C)||this;return i.key=g,i.group=C,i.parent=A,i}return qi(g,I),g.prototype._next=function(I){this.complete()},g.prototype._unsubscribe=function(){var I=this.parent,g=this.key;this.key=this.parent=null,I&&I.removeGroup(g)},g}(se),Fe=function(I){function g(g,C,A){var i=I.call(this)||this;return i.key=g,i.groupSubject=C,i.refCountSubscription=A,i}return qi(g,I),g.prototype._subscribe=function(I){var g=new ce,C=this.refCountSubscription,A=this.groupSubject;return C&&!C.closed&&g.add(new Ne(C)),g.add(A.subscribe(I)),g},g}(Ge),Ne=function(I){function g(g){var C=I.call(this)||this;return C.parent=g,g.count++,C}return qi(g,I),g.prototype.unsubscribe=function(){var g=this.parent;g.closed||this.closed||(I.prototype.unsubscribe.call(this),g.count-=1,0===g.count&&g.attemptedToUnsubscribe&&g.unsubscribe())},g}(ce),ve=function(I){function g(g){var C=I.call(this)||this;return C._value=g,C}return qi(g,I),Object.defineProperty(g.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),g.prototype._subscribe=function(g){var C=I.prototype._subscribe.call(this,g);return C&&!C.closed&&g.next(this._value),C},g.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new ye;return this._value},g.prototype.next=function(g){I.prototype.next.call(this,this._value=g)},g}(pe),ke=function(I){function g(g,C){var A=I.call(this,g,C)||this;return A.scheduler=g,A.work=C,A.pending=!1,A}return qi(g,I),g.prototype.schedule=function(I,g){if(void 0===g&&(g=0),this.closed)return this;this.state=I;var C=this.id,A=this.scheduler;return null!=C&&(this.id=this.recycleAsyncId(A,C,g)),this.pending=!0,this.delay=g,this.id=this.id||this.requestAsyncId(A,this.id,g),this},g.prototype.requestAsyncId=function(I,g,C){return void 0===C&&(C=0),setInterval(I.flush.bind(I,this),C)},g.prototype.recycleAsyncId=function(I,g,C){if(void 0===C&&(C=0),null!==C&&this.delay===C&&!1===this.pending)return g;clearInterval(g)},g.prototype.execute=function(I,g){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var C=this._execute(I,g);if(C)return C;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},g.prototype._execute=function(I,g){var C=!1,A=void 0;try{this.work(I)}catch(im){C=!0,A=!!im&&im||new Error(im)}if(C)return this.unsubscribe(),A},g.prototype._unsubscribe=function(){var I=this.id,g=this.scheduler,C=g.actions,A=C.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==A&&C.splice(A,1),null!=I&&(this.id=this.recycleAsyncId(g,I,null)),this.delay=null},g}(function(I){function g(g,C){return I.call(this)||this}return qi(g,I),g.prototype.schedule=function(I,g){return this},g}(ce)),De=function(I){function g(g,C){var A=I.call(this,g,C)||this;return A.scheduler=g,A.work=C,A}return qi(g,I),g.prototype.schedule=function(g,C){return void 0===C&&(C=0),C>0?I.prototype.schedule.call(this,g,C):(this.delay=C,this.state=g,this.scheduler.flush(this),this)},g.prototype.execute=function(g,C){return C>0||this.closed?I.prototype.execute.call(this,g,C):this._execute(g,C)},g.prototype.requestAsyncId=function(g,C,A){return void 0===A&&(A=0),null!==A&&A>0||null===A&&this.delay>0?I.prototype.requestAsyncId.call(this,g,C,A):g.flush(this)},g}(ke),ze=function(){function I(g,C){void 0===C&&(C=I.now),this.SchedulerAction=g,this.now=C}return I.prototype.schedule=function(I,g,C){return void 0===g&&(g=0),new this.SchedulerAction(this,I).schedule(C,g)},I.now=function(){return Date.now()},I}(),Me=function(I){function g(C,A){void 0===A&&(A=ze.now);var i=I.call(this,C,(function(){return g.delegate&&g.delegate!==i?g.delegate.now():A()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return qi(g,I),g.prototype.schedule=function(C,A,i){return void 0===A&&(A=0),g.delegate&&g.delegate!==this?g.delegate.schedule(C,A,i):I.prototype.schedule.call(this,C,A,i)},g.prototype.flush=function(I){var g=this.actions;if(this.active)g.push(I);else{var C;this.active=!0;do{if(C=I.execute(I.state,I.delay))break}while(I=g.shift());if(this.active=!1,C){for(;I=g.shift();)I.unsubscribe();throw C}}},g}(ze),Ue=function(I){function g(){return null!==I&&I.apply(this,arguments)||this}return qi(g,I),g}(Me),xe=new Ue(De),Te=xe,Qe=new Ge((function(I){return I.complete()}));function Pe(I){return I?function(I){return new Ge((function(g){return I.schedule((function(){return g.complete()}))}))}(I):Qe}function Oe(I){return I&&"function"===typeof I.schedule}var je,Le=function(I){return function(g){for(var C=0,A=I.length;C<A&&!g.closed;C++)g.next(I[C]);g.complete()}};function Ee(I,g){return new Ge((function(C){var A=new ce,i=0;return A.add(g.schedule((function(){i!==I.length?(C.next(I[i++]),C.closed||A.add(this.schedule())):C.complete()}))),A}))}function _e(I,g){return g?Ee(I,g):new Ge(Le(I))}function $e(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];var C=I[I.length-1];return Oe(C)?(I.pop(),Ee(I,C)):_e(I)}function qe(I,g){return new Ge(g?function(C){return g.schedule(Il,0,{error:I,subscriber:C})}:function(g){return g.error(I)})}function Il(I){var g=I.error;I.subscriber.error(g)}je||(je={});var gl=function(){function I(I,g,C){this.kind=I,this.value=g,this.error=C,this.hasValue="N"===I}return I.prototype.observe=function(I){switch(this.kind){case"N":return I.next&&I.next(this.value);case"E":return I.error&&I.error(this.error);case"C":return I.complete&&I.complete()}},I.prototype.do=function(I,g,C){switch(this.kind){case"N":return I&&I(this.value);case"E":return g&&g(this.error);case"C":return C&&C()}},I.prototype.accept=function(I,g,C){return I&&"function"===typeof I.next?this.observe(I):this.do(I,g,C)},I.prototype.toObservable=function(){switch(this.kind){case"N":return $e(this.value);case"E":return qe(this.error);case"C":return Pe()}throw new Error("unexpected notification kind value")},I.createNext=function(g){return"undefined"!==typeof g?new I("N",g):I.undefinedValueNotification},I.createError=function(g){return new I("E",void 0,g)},I.createComplete=function(){return I.completeNotification},I.completeNotification=new I("C"),I.undefinedValueNotification=new I("N",void 0),I}();var Cl=function(){function I(I,g){void 0===g&&(g=0),this.scheduler=I,this.delay=g}return I.prototype.call=function(I,g){return g.subscribe(new Al(I,this.scheduler,this.delay))},I}(),Al=function(I){function g(g,C,A){void 0===A&&(A=0);var i=I.call(this,g)||this;return i.scheduler=C,i.delay=A,i}return qi(g,I),g.dispatch=function(I){var g=I.notification,C=I.destination;g.observe(C),this.unsubscribe()},g.prototype.scheduleMessage=function(I){this.destination.add(this.scheduler.schedule(g.dispatch,this.delay,new il(I,this.destination)))},g.prototype._next=function(I){this.scheduleMessage(gl.createNext(I))},g.prototype._error=function(I){this.scheduleMessage(gl.createError(I)),this.unsubscribe()},g.prototype._complete=function(){this.scheduleMessage(gl.createComplete()),this.unsubscribe()},g}(se),il=function(){return function(I,g){this.notification=I,this.destination=g}}(),el=function(I){function g(g,C,A){void 0===g&&(g=Number.POSITIVE_INFINITY),void 0===C&&(C=Number.POSITIVE_INFINITY);var i=I.call(this)||this;return i.scheduler=A,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=g<1?1:g,i._windowTime=C<1?1:C,C===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return qi(g,I),g.prototype.nextInfiniteTimeWindow=function(g){if(!this.isStopped){var C=this._events;C.push(g),C.length>this._bufferSize&&C.shift()}I.prototype.next.call(this,g)},g.prototype.nextTimeWindow=function(g){this.isStopped||(this._events.push(new ll(this._getNow(),g)),this._trimBufferThenGetEvents()),I.prototype.next.call(this,g)},g.prototype._subscribe=function(I){var g,C=this._infiniteTimeWindow,A=C?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,e=A.length;if(this.closed)throw new ye;if(this.isStopped||this.hasError?g=ce.EMPTY:(this.observers.push(I),g=new Be(this,I)),i&&I.add(I=new Al(I,i)),C)for(var l=0;l<e&&!I.closed;l++)I.next(A[l]);else for(l=0;l<e&&!I.closed;l++)I.next(A[l].value);return this.hasError?I.error(this.thrownError):this.isStopped&&I.complete(),g},g.prototype._getNow=function(){return(this.scheduler||Te).now()},g.prototype._trimBufferThenGetEvents=function(){for(var I=this._getNow(),g=this._bufferSize,C=this._windowTime,A=this._events,i=A.length,e=0;e<i&&!(I-A[e].time<C);)e++;return i>g&&(e=Math.max(e,i-g)),e>0&&A.splice(0,e),A},g}(pe),ll=function(){return function(I,g){this.time=I,this.value=g}}(),ol=function(I){function g(){var g=null!==I&&I.apply(this,arguments)||this;return g.value=null,g.hasNext=!1,g.hasCompleted=!1,g}return qi(g,I),g.prototype._subscribe=function(g){return this.hasError?(g.error(this.thrownError),ce.EMPTY):this.hasCompleted&&this.hasNext?(g.next(this.value),g.complete(),ce.EMPTY):I.prototype._subscribe.call(this,g)},g.prototype.next=function(I){this.hasCompleted||(this.value=I,this.hasNext=!0)},g.prototype.error=function(g){this.hasCompleted||I.prototype.error.call(this,g)},g.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&I.prototype.next.call(this,this.value),I.prototype.complete.call(this)},g}(pe),tl=1,cl=function(){return Promise.resolve()}(),nl={};function dl(I){return I in nl&&(delete nl[I],!0)}var sl=function(I){var g=tl++;return nl[g]=!0,cl.then((function(){return dl(g)&&I()})),g},al=function(I){dl(I)},Zl=function(I){function g(g,C){var A=I.call(this,g,C)||this;return A.scheduler=g,A.work=C,A}return qi(g,I),g.prototype.requestAsyncId=function(g,C,A){return void 0===A&&(A=0),null!==A&&A>0?I.prototype.requestAsyncId.call(this,g,C,A):(g.actions.push(this),g.scheduled||(g.scheduled=sl(g.flush.bind(g,null))))},g.prototype.recycleAsyncId=function(g,C,A){if(void 0===A&&(A=0),null!==A&&A>0||null===A&&this.delay>0)return I.prototype.recycleAsyncId.call(this,g,C,A);0===g.actions.length&&(al(C),g.scheduled=void 0)},g}(ke),ml=function(I){function g(){return null!==I&&I.apply(this,arguments)||this}return qi(g,I),g.prototype.flush=function(I){this.active=!0,this.scheduled=void 0;var g,C=this.actions,A=-1,i=C.length;I=I||C.shift();do{if(g=I.execute(I.state,I.delay))break}while(++A<i&&(I=C.shift()));if(this.active=!1,g){for(;++A<i&&(I=C.shift());)I.unsubscribe();throw g}},g}(Me),bl=new ml(Zl),rl=bl,hl=new Me(ke),Gl=hl,ul=function(I){function g(g,C){var A=I.call(this,g,C)||this;return A.scheduler=g,A.work=C,A}return qi(g,I),g.prototype.requestAsyncId=function(g,C,A){return void 0===A&&(A=0),null!==A&&A>0?I.prototype.requestAsyncId.call(this,g,C,A):(g.actions.push(this),g.scheduled||(g.scheduled=requestAnimationFrame((function(){return g.flush(null)}))))},g.prototype.recycleAsyncId=function(g,C,A){if(void 0===A&&(A=0),null!==A&&A>0||null===A&&this.delay>0)return I.prototype.recycleAsyncId.call(this,g,C,A);0===g.actions.length&&(cancelAnimationFrame(C),g.scheduled=void 0)},g}(ke),yl=function(I){function g(){return null!==I&&I.apply(this,arguments)||this}return qi(g,I),g.prototype.flush=function(I){this.active=!0,this.scheduled=void 0;var g,C=this.actions,A=-1,i=C.length;I=I||C.shift();do{if(g=I.execute(I.state,I.delay))break}while(++A<i&&(I=C.shift()));if(this.active=!1,g){for(;++A<i&&(I=C.shift());)I.unsubscribe();throw g}},g}(Me),Bl=new yl(ul),Vl=Bl,pl=function(I){function g(g,C){void 0===g&&(g=Xl),void 0===C&&(C=Number.POSITIVE_INFINITY);var A=I.call(this,g,(function(){return A.frame}))||this;return A.maxFrames=C,A.frame=0,A.index=-1,A}return qi(g,I),g.prototype.flush=function(){for(var I,g,C=this.actions,A=this.maxFrames;(g=C[0])&&g.delay<=A&&(C.shift(),this.frame=g.delay,!(I=g.execute(g.state,g.delay))););if(I){for(;g=C.shift();)g.unsubscribe();throw I}},g.frameTimeFactor=10,g}(Me),Xl=function(I){function g(g,C,A){void 0===A&&(A=g.index+=1);var i=I.call(this,g,C)||this;return i.scheduler=g,i.work=C,i.index=A,i.active=!0,i.index=g.index=A,i}return qi(g,I),g.prototype.schedule=function(C,A){if(void 0===A&&(A=0),!this.id)return I.prototype.schedule.call(this,C,A);this.active=!1;var i=new g(this.scheduler,this.work);return this.add(i),i.schedule(C,A)},g.prototype.requestAsyncId=function(I,C,A){void 0===A&&(A=0),this.delay=I.frame+A;var i=I.actions;return i.push(this),i.sort(g.sortActions),!0},g.prototype.recycleAsyncId=function(I,g,C){},g.prototype._execute=function(g,C){if(!0===this.active)return I.prototype._execute.call(this,g,C)},g.sortActions=function(I,g){return I.delay===g.delay?I.index===g.index?0:I.index>g.index?1:-1:I.delay>g.delay?1:-1},g}(ke);function Wl(){}var Hl=function(){function I(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return I.prototype=Object.create(Error.prototype),I}(),Yl=function(){function I(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return I.prototype=Object.create(Error.prototype),I}(),Rl=function(){function I(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return I.prototype=Object.create(Error.prototype),I}();function fl(I,g){return function(C){if("function"!==typeof I)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return C.lift(new Kl(I,g))}}var Kl=function(){function I(I,g){this.project=I,this.thisArg=g}return I.prototype.call=function(I,g){return g.subscribe(new wl(I,this.project,this.thisArg))},I}(),wl=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.project=C,i.count=0,i.thisArg=A||i,i}return qi(g,I),g.prototype._next=function(I){var g;try{g=this.project.call(this.thisArg,I,this.count++)}catch(C){return void this.destination.error(C)}this.destination.next(g)},g}(se);function Jl(I){var g=this,C=I.args,A=I.subscriber,i=I.params,e=i.callbackFunc,l=i.context,o=i.scheduler,t=i.subject;if(!t){t=i.subject=new ol;try{e.apply(l,C.concat([function(){for(var I=[],C=0;C<arguments.length;C++)I[C]=arguments[C];var A=I.length<=1?I[0]:I;g.add(o.schedule(Sl,0,{value:A,subject:t}))}]))}catch(c){t.error(c)}}this.add(t.subscribe(A))}function Sl(I){var g=I.value,C=I.subject;C.next(g),C.complete()}function Fl(I){var g=this,C=I.params,A=I.subscriber,i=I.context,e=C.callbackFunc,l=C.args,o=C.scheduler,t=C.subject;if(!t){t=C.subject=new ol;try{e.apply(i,l.concat([function(){for(var I=[],C=0;C<arguments.length;C++)I[C]=arguments[C];var A=I.shift();if(A)g.add(o.schedule(vl,0,{err:A,subject:t}));else{var i=I.length<=1?I[0]:I;g.add(o.schedule(Nl,0,{value:i,subject:t}))}}]))}catch(c){this.add(o.schedule(vl,0,{err:c,subject:t}))}}this.add(t.subscribe(A))}function Nl(I){var g=I.value,C=I.subject;C.next(g),C.complete()}function vl(I){var g=I.err;I.subject.error(g)}var kl=function(I){function g(){return null!==I&&I.apply(this,arguments)||this}return qi(g,I),g.prototype.notifyNext=function(I,g,C,A,i){this.destination.next(g)},g.prototype.notifyError=function(I,g){this.destination.error(I)},g.prototype.notifyComplete=function(I){this.destination.complete()},g}(se),Dl=function(I){function g(g,C,A){var i=I.call(this)||this;return i.parent=g,i.outerValue=C,i.outerIndex=A,i.index=0,i}return qi(g,I),g.prototype._next=function(I){this.parent.notifyNext(this.outerValue,I,this.outerIndex,this.index++,this)},g.prototype._error=function(I){this.parent.notifyError(I,this),this.unsubscribe()},g.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},g}(se);function zl(){return"function"===typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var Ml=zl(),Ul=function(I){return I&&"number"===typeof I.length&&"function"!==typeof I};function xl(I){return!!I&&"function"!==typeof I.subscribe&&"function"===typeof I.then}var Tl=function(I){if(I&&"function"===typeof I[me])return A=I,function(I){var g=A[me]();if("function"!==typeof g.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return g.subscribe(I)};if(Ul(I))return Le(I);if(xl(I))return C=I,function(I){return C.then((function(g){I.closed||(I.next(g),I.complete())}),(function(g){return I.error(g)})).then(null,Ae),I};if(I&&"function"===typeof I[Ml])return g=I,function(I){for(var C=g[Ml]();;){var A=void 0;try{A=C.next()}catch(i){return I.error(i),I}if(A.done){I.complete();break}if(I.next(A.value),I.closed)break}return"function"===typeof C.return&&I.add((function(){C.return&&C.return()})),I};var g,C,A,i=le(I)?"an invalid object":"'"+I+"'";throw new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function Ql(I,g,C,A,i){if(void 0===i&&(i=new Dl(I,C,A)),!i.closed)return g instanceof Ge?g.subscribe(i):Tl(g)(i)}var Pl={};var Ol=function(){function I(I){this.resultSelector=I}return I.prototype.call=function(I,g){return g.subscribe(new jl(I,this.resultSelector))},I}(),jl=function(I){function g(g,C){var A=I.call(this,g)||this;return A.resultSelector=C,A.active=0,A.values=[],A.observables=[],A}return qi(g,I),g.prototype._next=function(I){this.values.push(Pl),this.observables.push(I)},g.prototype._complete=function(){var I=this.observables,g=I.length;if(0===g)this.destination.complete();else{this.active=g,this.toRespond=g;for(var C=0;C<g;C++){var A=I[C];this.add(Ql(this,A,void 0,C))}}},g.prototype.notifyComplete=function(I){0===(this.active-=1)&&this.destination.complete()},g.prototype.notifyNext=function(I,g,C){var A=this.values,i=A[C],e=this.toRespond?i===Pl?--this.toRespond:this.toRespond:0;A[C]=g,0===e&&(this.resultSelector?this._tryResultSelector(A):this.destination.next(A.slice()))},g.prototype._tryResultSelector=function(I){var g;try{g=this.resultSelector.apply(this,I)}catch(C){return void this.destination.error(C)}this.destination.next(g)},g}(kl);function Ll(I,g){if(null!=I){if(function(I){return I&&"function"===typeof I[me]}(I))return function(I,g){return new Ge((function(C){var A=new ce;return A.add(g.schedule((function(){var i=I[me]();A.add(i.subscribe({next:function(I){A.add(g.schedule((function(){return C.next(I)})))},error:function(I){A.add(g.schedule((function(){return C.error(I)})))},complete:function(){A.add(g.schedule((function(){return C.complete()})))}}))}))),A}))}(I,g);if(xl(I))return function(I,g){return new Ge((function(C){var A=new ce;return A.add(g.schedule((function(){return I.then((function(I){A.add(g.schedule((function(){C.next(I),A.add(g.schedule((function(){return C.complete()})))})))}),(function(I){A.add(g.schedule((function(){return C.error(I)})))}))}))),A}))}(I,g);if(Ul(I))return Ee(I,g);if(function(I){return I&&"function"===typeof I[Ml]}(I)||"string"===typeof I)return function(I,g){if(!I)throw new Error("Iterable cannot be null");return new Ge((function(C){var A,i=new ce;return i.add((function(){A&&"function"===typeof A.return&&A.return()})),i.add(g.schedule((function(){A=I[Ml](),i.add(g.schedule((function(){if(!C.closed){var I,g;try{var i=A.next();I=i.value,g=i.done}catch(e){return void C.error(e)}g?C.complete():(C.next(I),this.schedule())}})))}))),i}))}(I,g)}throw new TypeError((null!==I&&typeof I||I)+" is not observable")}function El(I,g){return g?Ll(I,g):I instanceof Ge?I:new Ge(Tl(I))}var _l=function(I){function g(g){var C=I.call(this)||this;return C.parent=g,C}return qi(g,I),g.prototype._next=function(I){this.parent.notifyNext(I)},g.prototype._error=function(I){this.parent.notifyError(I),this.unsubscribe()},g.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},g}(se),$l=function(I){function g(){return null!==I&&I.apply(this,arguments)||this}return qi(g,I),g.prototype.notifyNext=function(I){this.destination.next(I)},g.prototype.notifyError=function(I){this.destination.error(I)},g.prototype.notifyComplete=function(){this.destination.complete()},g}(se);function ql(I,g){if(!g.closed){if(I instanceof Ge)return I.subscribe(g);var C;try{C=Tl(I)(g)}catch(A){g.error(A)}return C}}function Io(I,g,C){return void 0===C&&(C=Number.POSITIVE_INFINITY),"function"===typeof g?function(A){return A.pipe(Io((function(C,A){return El(I(C,A)).pipe(fl((function(I,i){return g(C,I,A,i)})))}),C))}:("number"===typeof g&&(C=g),function(g){return g.lift(new go(I,C))})}var go=function(){function I(I,g){void 0===g&&(g=Number.POSITIVE_INFINITY),this.project=I,this.concurrent=g}return I.prototype.call=function(I,g){return g.subscribe(new Co(I,this.project,this.concurrent))},I}(),Co=function(I){function g(g,C,A){void 0===A&&(A=Number.POSITIVE_INFINITY);var i=I.call(this,g)||this;return i.project=C,i.concurrent=A,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return qi(g,I),g.prototype._next=function(I){this.active<this.concurrent?this._tryNext(I):this.buffer.push(I)},g.prototype._tryNext=function(I){var g,C=this.index++;try{g=this.project(I,C)}catch(A){return void this.destination.error(A)}this.active++,this._innerSub(g)},g.prototype._innerSub=function(I){var g=new _l(this),C=this.destination;C.add(g);var A=ql(I,g);A!==g&&C.add(A)},g.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},g.prototype.notifyNext=function(I){this.destination.next(I)},g.prototype.notifyComplete=function(){var I=this.buffer;this.active--,I.length>0?this._next(I.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},g}($l),Ao=Io;function io(I){return void 0===I&&(I=Number.POSITIVE_INFINITY),Io(be,I)}function eo(){return io(1)}function lo(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];return eo()($e.apply(void 0,I))}function oo(I){return new Ge((function(g){var C;try{C=I()}catch(A){return void g.error(A)}return(C?El(C):Pe()).subscribe(g)}))}function to(I,g){return new Ge((function(C){var A=I.length;if(0!==A)for(var i=new Array(A),e=0,l=0,o=function(o){var t=El(I[o]),c=!1;C.add(t.subscribe({next:function(I){c||(c=!0,l++),i[o]=I},error:function(I){return C.error(I)},complete:function(){++e!==A&&c||(l===A&&C.next(g?g.reduce((function(I,g,C){return I[g]=i[C],I}),{}):i),C.complete())}}))},t=0;t<A;t++)o(t);else C.complete()}))}function co(I,g,C,A,i){var e;if(function(I){return I&&"function"===typeof I.addEventListener&&"function"===typeof I.removeEventListener}(I)){var l=I;I.addEventListener(g,C,i),e=function(){return l.removeEventListener(g,C,i)}}else if(function(I){return I&&"function"===typeof I.on&&"function"===typeof I.off}(I)){var o=I;I.on(g,C),e=function(){return o.off(g,C)}}else if(function(I){return I&&"function"===typeof I.addListener&&"function"===typeof I.removeListener}(I)){var t=I;I.addListener(g,C),e=function(){return t.removeListener(g,C)}}else{if(!I||!I.length)throw new TypeError("Invalid event target");for(var c=0,n=I.length;c<n;c++)co(I[c],g,C,A,i)}A.add(e)}function no(I){var g=I.subscriber,C=I.condition;if(!g.closed){if(I.needIterate)try{I.state=I.iterate(I.state)}catch(e){return void g.error(e)}else I.needIterate=!0;if(C){var A=void 0;try{A=C(I.state)}catch(e){return void g.error(e)}if(!A)return void g.complete();if(g.closed)return}var i;try{i=I.resultSelector(I.state)}catch(e){return void g.error(e)}if(!g.closed&&(g.next(i),!g.closed))return this.schedule(I)}}function so(I){return!ee(I)&&I-parseFloat(I)+1>=0}function ao(I){var g=I.subscriber,C=I.counter,A=I.period;g.next(C),this.schedule({subscriber:g,counter:C+1,period:A},A)}function Zo(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];var C=Number.POSITIVE_INFINITY,A=null,i=I[I.length-1];return Oe(i)?(A=I.pop(),I.length>1&&"number"===typeof I[I.length-1]&&(C=I.pop())):"number"===typeof i&&(C=I.pop()),null===A&&1===I.length&&I[0]instanceof Ge?I[0]:io(C)(_e(I,A))}var mo=new Ge(Wl);function bo(I){var g=I.keys,C=I.index,A=I.subscriber,i=I.subscription,e=I.obj;if(!A.closed)if(C<g.length){var l=g[C];A.next([l,e[l]]),i.add(this.schedule({keys:g,index:C+1,subscriber:A,subscription:i,obj:e}))}else A.complete()}function ro(I,g){function C(){return!C.pred.apply(C.thisArg,arguments)}return C.pred=I,C.thisArg=g,C}function ho(I,g){return function(C){return C.lift(new Go(I,g))}}var Go=function(){function I(I,g){this.predicate=I,this.thisArg=g}return I.prototype.call=function(I,g){return g.subscribe(new uo(I,this.predicate,this.thisArg))},I}(),uo=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.predicate=C,i.thisArg=A,i.count=0,i}return qi(g,I),g.prototype._next=function(I){var g;try{g=this.predicate.call(this.thisArg,I,this.count++)}catch(C){return void this.destination.error(C)}g&&this.destination.next(I)},g}(se);function yo(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];if(1===I.length){if(!ee(I[0]))return I[0];I=I[0]}return _e(I,void 0).lift(new Bo)}var Bo=function(){function I(){}return I.prototype.call=function(I,g){return g.subscribe(new Vo(I))},I}(),Vo=function(I){function g(g){var C=I.call(this,g)||this;return C.hasFirst=!1,C.observables=[],C.subscriptions=[],C}return qi(g,I),g.prototype._next=function(I){this.observables.push(I)},g.prototype._complete=function(){var I=this.observables,g=I.length;if(0===g)this.destination.complete();else{for(var C=0;C<g&&!this.hasFirst;C++){var A=Ql(this,I[C],void 0,C);this.subscriptions&&this.subscriptions.push(A),this.add(A)}this.observables=null}},g.prototype.notifyNext=function(I,g,C){if(!this.hasFirst){this.hasFirst=!0;for(var A=0;A<this.subscriptions.length;A++)if(A!==C){var i=this.subscriptions[A];i.unsubscribe(),this.remove(i)}this.subscriptions=null}this.destination.next(g)},g}(kl);function po(I){var g=I.start,C=I.index,A=I.count,i=I.subscriber;C>=A?i.complete():(i.next(g),i.closed||(I.index=C+1,I.start=g+1,this.schedule(I)))}function Xo(I,g,C){void 0===I&&(I=0);var A=-1;return so(g)?A=Number(g)<1?1:Number(g):Oe(g)&&(C=g),Oe(C)||(C=Gl),new Ge((function(g){var i=so(I)?I:+I-C.now();return C.schedule(Wo,i,{index:0,period:A,subscriber:g})}))}function Wo(I){var g=I.index,C=I.period,A=I.subscriber;if(A.next(g),!A.closed){if(-1===C)return A.complete();I.index=g+1,this.schedule(I,C)}}function Ho(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];var C=I[I.length-1];return"function"===typeof C&&I.pop(),_e(I,void 0).lift(new Yo(C))}var Yo=function(){function I(I){this.resultSelector=I}return I.prototype.call=function(I,g){return g.subscribe(new Ro(I,this.resultSelector))},I}(),Ro=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.resultSelector=C,i.iterators=[],i.active=0,i.resultSelector="function"===typeof C?C:void 0,i}return qi(g,I),g.prototype._next=function(I){var g=this.iterators;ee(I)?g.push(new Ko(I)):"function"===typeof I[Ml]?g.push(new fo(I[Ml]())):g.push(new wo(this.destination,this,I))},g.prototype._complete=function(){var I=this.iterators,g=I.length;if(this.unsubscribe(),0!==g){this.active=g;for(var C=0;C<g;C++){var A=I[C];if(A.stillUnsubscribed)this.destination.add(A.subscribe());else this.active--}}else this.destination.complete()},g.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},g.prototype.checkIterators=function(){for(var I=this.iterators,g=I.length,C=this.destination,A=0;A<g;A++){if("function"===typeof(l=I[A]).hasValue&&!l.hasValue())return}var i=!1,e=[];for(A=0;A<g;A++){var l,o=(l=I[A]).next();if(l.hasCompleted()&&(i=!0),o.done)return void C.complete();e.push(o.value)}this.resultSelector?this._tryresultSelector(e):C.next(e),i&&C.complete()},g.prototype._tryresultSelector=function(I){var g;try{g=this.resultSelector.apply(this,I)}catch(C){return void this.destination.error(C)}this.destination.next(g)},g}(se),fo=function(){function I(I){this.iterator=I,this.nextResult=I.next()}return I.prototype.hasValue=function(){return!0},I.prototype.next=function(){var I=this.nextResult;return this.nextResult=this.iterator.next(),I},I.prototype.hasCompleted=function(){var I=this.nextResult;return Boolean(I&&I.done)},I}(),Ko=function(){function I(I){this.array=I,this.index=0,this.length=0,this.length=I.length}return I.prototype[Ml]=function(){return this},I.prototype.next=function(I){var g=this.index++,C=this.array;return g<this.length?{value:C[g],done:!1}:{value:null,done:!0}},I.prototype.hasValue=function(){return this.array.length>this.index},I.prototype.hasCompleted=function(){return this.array.length===this.index},I}(),wo=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.parent=C,i.observable=A,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return qi(g,I),g.prototype[Ml]=function(){return this},g.prototype.next=function(){var I=this.buffer;return 0===I.length&&this.isComplete?{value:null,done:!0}:{value:I.shift(),done:!1}},g.prototype.hasValue=function(){return this.buffer.length>0},g.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},g.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},g.prototype.notifyNext=function(I){this.buffer.push(I),this.parent.checkIterators()},g.prototype.subscribe=function(){return ql(this.observable,new _l(this))},g}($l),Jo=Object.freeze(Object.defineProperty({__proto__:null,Observable:Ge,ConnectableObservable:Re,GroupedObservable:Fe,observable:me,Subject:pe,BehaviorSubject:ve,ReplaySubject:el,AsyncSubject:ol,asap:rl,asapScheduler:bl,async:Gl,asyncScheduler:hl,queue:Te,queueScheduler:xe,animationFrame:Vl,animationFrameScheduler:Bl,VirtualTimeScheduler:pl,VirtualAction:Xl,Scheduler:ze,Subscription:ce,Subscriber:se,Notification:gl,get NotificationKind(){return je},pipe:re,noop:Wl,identity:be,isObservable:function(I){return!!I&&(I instanceof Ge||"function"===typeof I.lift&&"function"===typeof I.subscribe)},ArgumentOutOfRangeError:Hl,EmptyError:Yl,ObjectUnsubscribedError:ye,UnsubscriptionError:te,TimeoutError:Rl,bindCallback:function I(g,C,A){if(C){if(!Oe(C))return function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return I(g,A).apply(void 0,i).pipe(fl((function(I){return ee(I)?C.apply(void 0,I):C(I)})))};A=C}return function(){for(var I=[],C=0;C<arguments.length;C++)I[C]=arguments[C];var i,e=this,l={context:e,subject:i,callbackFunc:g,scheduler:A};return new Ge((function(C){if(A){var o={args:I,subscriber:C,params:l};return A.schedule(Jl,0,o)}if(!i){i=new ol;try{g.apply(e,I.concat([function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];i.next(I.length<=1?I[0]:I),i.complete()}]))}catch(t){Ze(i)?i.error(t):console.warn(t)}}return i.subscribe(C)}))}},bindNodeCallback:function I(g,C,A){if(C){if(!Oe(C))return function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return I(g,A).apply(void 0,i).pipe(fl((function(I){return ee(I)?C.apply(void 0,I):C(I)})))};A=C}return function(){for(var I=[],C=0;C<arguments.length;C++)I[C]=arguments[C];var i={subject:void 0,args:I,callbackFunc:g,scheduler:A,context:this};return new Ge((function(C){var e=i.context,l=i.subject;if(A)return A.schedule(Fl,0,{params:i,subscriber:C,context:e});if(!l){l=i.subject=new ol;try{g.apply(e,I.concat([function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];var C=I.shift();C?l.error(C):(l.next(I.length<=1?I[0]:I),l.complete())}]))}catch(o){Ze(l)?l.error(o):console.warn(o)}}return l.subscribe(C)}))}},combineLatest:function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];var C=void 0,A=void 0;return Oe(I[I.length-1])&&(A=I.pop()),"function"===typeof I[I.length-1]&&(C=I.pop()),1===I.length&&ee(I[0])&&(I=I[0]),_e(I,A).lift(new Ol(C))},concat:lo,defer:oo,empty:Pe,forkJoin:function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];if(1===I.length){var C=I[0];if(ee(C))return to(C,null);if(le(C)&&Object.getPrototypeOf(C)===Object.prototype){var A=Object.keys(C);return to(A.map((function(I){return C[I]})),A)}}if("function"===typeof I[I.length-1]){var i=I.pop();return to(I=1===I.length&&ee(I[0])?I[0]:I,null).pipe(fl((function(I){return i.apply(void 0,I)})))}return to(I,null)},from:El,fromEvent:function I(g,C,A,i){return Ie(A)&&(i=A,A=void 0),i?I(g,C,A).pipe(fl((function(I){return ee(I)?i.apply(void 0,I):i(I)}))):new Ge((function(I){co(g,C,(function(g){arguments.length>1?I.next(Array.prototype.slice.call(arguments)):I.next(g)}),I,A)}))},fromEventPattern:function I(g,C,A){return A?I(g,C).pipe(fl((function(I){return ee(I)?A.apply(void 0,I):A(I)}))):new Ge((function(I){var A,i=function(){for(var g=[],C=0;C<arguments.length;C++)g[C]=arguments[C];return I.next(1===g.length?g[0]:g)};try{A=g(i)}catch(e){return void I.error(e)}if(Ie(C))return function(){return C(i,A)}}))},generate:function(I,g,C,A,i){var e,l;if(1==arguments.length){var o=I;l=o.initialState,g=o.condition,C=o.iterate,e=o.resultSelector||be,i=o.scheduler}else void 0===A||Oe(A)?(l=I,e=be,i=A):(l=I,e=A);return new Ge((function(I){var A=l;if(i)return i.schedule(no,0,{subscriber:I,iterate:C,condition:g,resultSelector:e,state:A});for(;;){if(g){var o=void 0;try{o=g(A)}catch(c){return void I.error(c)}if(!o){I.complete();break}}var t=void 0;try{t=e(A)}catch(c){return void I.error(c)}if(I.next(t),I.closed)break;try{A=C(A)}catch(c){return void I.error(c)}}}))},iif:function(I,g,C){return void 0===g&&(g=Qe),void 0===C&&(C=Qe),oo((function(){return I()?g:C}))},interval:function(I,g){return void 0===I&&(I=0),void 0===g&&(g=Gl),(!so(I)||I<0)&&(I=0),g&&"function"===typeof g.schedule||(g=Gl),new Ge((function(C){return C.add(g.schedule(ao,I,{subscriber:C,counter:0,period:I})),C}))},merge:Zo,never:function(){return mo},of:$e,onErrorResumeNext:function I(){for(var g=[],C=0;C<arguments.length;C++)g[C]=arguments[C];if(0===g.length)return Qe;var A=g[0],i=g.slice(1);return 1===g.length&&ee(A)?I.apply(void 0,A):new Ge((function(g){var C=function(){return g.add(I.apply(void 0,i).subscribe(g))};return El(A).subscribe({next:function(I){g.next(I)},error:C,complete:C})}))},pairs:function(I,g){return new Ge(g?function(C){var A=Object.keys(I),i=new ce;return i.add(g.schedule(bo,0,{keys:A,index:0,subscriber:C,subscription:i,obj:I})),i}:function(g){for(var C=Object.keys(I),A=0;A<C.length&&!g.closed;A++){var i=C[A];I.hasOwnProperty(i)&&g.next([i,I[i]])}g.complete()})},partition:function(I,g,C){return[ho(g,C)(new Ge(Tl(I))),ho(ro(g,C))(new Ge(Tl(I)))]},race:yo,range:function(I,g,C){return void 0===I&&(I=0),new Ge((function(A){void 0===g&&(g=I,I=0);var i=0,e=I;if(C)return C.schedule(po,0,{index:i,count:g,start:I,subscriber:A});for(;;){if(i++>=g){A.complete();break}if(A.next(e++),A.closed)break}}))},throwError:qe,timer:Xo,using:function(I,g){return new Ge((function(C){var A,i;try{A=I()}catch(l){return void C.error(l)}try{i=g(A)}catch(l){return void C.error(l)}var e=(i?El(i):Qe).subscribe(C);return function(){e.unsubscribe(),A&&A.unsubscribe()}}))},zip:Ho,scheduled:Ll,EMPTY:Qe,NEVER:mo,config:Ce},Symbol.toStringTag,{value:"Module"})),So=aC(Jo);function Fo(I){return function(g){return g.lift(new No(I))}}var No=function(){function I(I){this.durationSelector=I}return I.prototype.call=function(I,g){return g.subscribe(new vo(I,this.durationSelector))},I}(),vo=function(I){function g(g,C){var A=I.call(this,g)||this;return A.durationSelector=C,A.hasValue=!1,A}return qi(g,I),g.prototype._next=function(I){if(this.value=I,this.hasValue=!0,!this.throttled){var g=void 0;try{g=(0,this.durationSelector)(I)}catch(A){return this.destination.error(A)}var C=ql(g,new _l(this));!C||C.closed?this.clearThrottle():this.add(this.throttled=C)}},g.prototype.clearThrottle=function(){var I=this,g=I.value,C=I.hasValue,A=I.throttled;A&&(this.remove(A),this.throttled=void 0,A.unsubscribe()),C&&(this.value=void 0,this.hasValue=!1,this.destination.next(g))},g.prototype.notifyNext=function(){this.clearThrottle()},g.prototype.notifyComplete=function(){this.clearThrottle()},g}($l);var ko=function(){function I(I){this.closingNotifier=I}return I.prototype.call=function(I,g){return g.subscribe(new Do(I,this.closingNotifier))},I}(),Do=function(I){function g(g,C){var A=I.call(this,g)||this;return A.buffer=[],A.add(ql(C,new _l(A))),A}return qi(g,I),g.prototype._next=function(I){this.buffer.push(I)},g.prototype.notifyNext=function(){var I=this.buffer;this.buffer=[],this.destination.next(I)},g}($l);var zo=function(){function I(I,g){this.bufferSize=I,this.startBufferEvery=g,this.subscriberClass=g&&I!==g?Uo:Mo}return I.prototype.call=function(I,g){return g.subscribe(new this.subscriberClass(I,this.bufferSize,this.startBufferEvery))},I}(),Mo=function(I){function g(g,C){var A=I.call(this,g)||this;return A.bufferSize=C,A.buffer=[],A}return qi(g,I),g.prototype._next=function(I){var g=this.buffer;g.push(I),g.length==this.bufferSize&&(this.destination.next(g),this.buffer=[])},g.prototype._complete=function(){var g=this.buffer;g.length>0&&this.destination.next(g),I.prototype._complete.call(this)},g}(se),Uo=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.bufferSize=C,i.startBufferEvery=A,i.buffers=[],i.count=0,i}return qi(g,I),g.prototype._next=function(I){var g=this,C=g.bufferSize,A=g.startBufferEvery,i=g.buffers,e=g.count;this.count++,e%A===0&&i.push([]);for(var l=i.length;l--;){var o=i[l];o.push(I),o.length===C&&(i.splice(l,1),this.destination.next(o))}},g.prototype._complete=function(){for(var g=this.buffers,C=this.destination;g.length>0;){var A=g.shift();A.length>0&&C.next(A)}I.prototype._complete.call(this)},g}(se);var xo=function(){function I(I,g,C,A){this.bufferTimeSpan=I,this.bufferCreationInterval=g,this.maxBufferSize=C,this.scheduler=A}return I.prototype.call=function(I,g){return g.subscribe(new Qo(I,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},I}(),To=function(){return function(){this.buffer=[]}}(),Qo=function(I){function g(g,C,A,i,e){var l=I.call(this,g)||this;l.bufferTimeSpan=C,l.bufferCreationInterval=A,l.maxBufferSize=i,l.scheduler=e,l.contexts=[];var o=l.openContext();if(l.timespanOnly=null==A||A<0,l.timespanOnly){var t={subscriber:l,context:o,bufferTimeSpan:C};l.add(o.closeAction=e.schedule(Po,C,t))}else{var c={subscriber:l,context:o},n={bufferTimeSpan:C,bufferCreationInterval:A,subscriber:l,scheduler:e};l.add(o.closeAction=e.schedule(jo,C,c)),l.add(e.schedule(Oo,A,n))}return l}return qi(g,I),g.prototype._next=function(I){for(var g,C=this.contexts,A=C.length,i=0;i<A;i++){var e=C[i],l=e.buffer;l.push(I),l.length==this.maxBufferSize&&(g=e)}g&&this.onBufferFull(g)},g.prototype._error=function(g){this.contexts.length=0,I.prototype._error.call(this,g)},g.prototype._complete=function(){for(var g=this.contexts,C=this.destination;g.length>0;){var A=g.shift();C.next(A.buffer)}I.prototype._complete.call(this)},g.prototype._unsubscribe=function(){this.contexts=null},g.prototype.onBufferFull=function(I){this.closeContext(I);var g=I.closeAction;if(g.unsubscribe(),this.remove(g),!this.closed&&this.timespanOnly){I=this.openContext();var C=this.bufferTimeSpan,A={subscriber:this,context:I,bufferTimeSpan:C};this.add(I.closeAction=this.scheduler.schedule(Po,C,A))}},g.prototype.openContext=function(){var I=new To;return this.contexts.push(I),I},g.prototype.closeContext=function(I){this.destination.next(I.buffer);var g=this.contexts;(g?g.indexOf(I):-1)>=0&&g.splice(g.indexOf(I),1)},g}(se);function Po(I){var g=I.subscriber,C=I.context;C&&g.closeContext(C),g.closed||(I.context=g.openContext(),I.context.closeAction=this.schedule(I,I.bufferTimeSpan))}function Oo(I){var g=I.bufferCreationInterval,C=I.bufferTimeSpan,A=I.subscriber,i=I.scheduler,e=A.openContext();A.closed||(A.add(e.closeAction=i.schedule(jo,C,{subscriber:A,context:e})),this.schedule(I,g))}function jo(I){var g=I.subscriber,C=I.context;g.closeContext(C)}var Lo=function(){function I(I,g){this.openings=I,this.closingSelector=g}return I.prototype.call=function(I,g){return g.subscribe(new Eo(I,this.openings,this.closingSelector))},I}(),Eo=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.closingSelector=A,i.contexts=[],i.add(Ql(i,C)),i}return qi(g,I),g.prototype._next=function(I){for(var g=this.contexts,C=g.length,A=0;A<C;A++)g[A].buffer.push(I)},g.prototype._error=function(g){for(var C=this.contexts;C.length>0;){var A=C.shift();A.subscription.unsubscribe(),A.buffer=null,A.subscription=null}this.contexts=null,I.prototype._error.call(this,g)},g.prototype._complete=function(){for(var g=this.contexts;g.length>0;){var C=g.shift();this.destination.next(C.buffer),C.subscription.unsubscribe(),C.buffer=null,C.subscription=null}this.contexts=null,I.prototype._complete.call(this)},g.prototype.notifyNext=function(I,g){I?this.closeBuffer(I):this.openBuffer(g)},g.prototype.notifyComplete=function(I){this.closeBuffer(I.context)},g.prototype.openBuffer=function(I){try{var g=this.closingSelector.call(this,I);g&&this.trySubscribe(g)}catch(C){this._error(C)}},g.prototype.closeBuffer=function(I){var g=this.contexts;if(g&&I){var C=I.buffer,A=I.subscription;this.destination.next(C),g.splice(g.indexOf(I),1),this.remove(A),A.unsubscribe()}},g.prototype.trySubscribe=function(I){var g=this.contexts,C=new ce,A={buffer:[],subscription:C};g.push(A);var i=Ql(this,I,A);!i||i.closed?this.closeBuffer(A):(i.context=A,this.add(i),C.add(i))},g}(kl);var _o=function(){function I(I){this.closingSelector=I}return I.prototype.call=function(I,g){return g.subscribe(new $o(I,this.closingSelector))},I}(),$o=function(I){function g(g,C){var A=I.call(this,g)||this;return A.closingSelector=C,A.subscribing=!1,A.openBuffer(),A}return qi(g,I),g.prototype._next=function(I){this.buffer.push(I)},g.prototype._complete=function(){var g=this.buffer;g&&this.destination.next(g),I.prototype._complete.call(this)},g.prototype._unsubscribe=function(){this.buffer=void 0,this.subscribing=!1},g.prototype.notifyNext=function(){this.openBuffer()},g.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},g.prototype.openBuffer=function(){var I=this.closingSubscription;I&&(this.remove(I),I.unsubscribe());var g,C=this.buffer;this.buffer&&this.destination.next(C),this.buffer=[];try{g=(0,this.closingSelector)()}catch(A){return this.error(A)}I=new ce,this.closingSubscription=I,this.add(I),this.subscribing=!0,I.add(ql(g,new _l(this))),this.subscribing=!1},g}($l);var qo=function(){function I(I){this.selector=I}return I.prototype.call=function(I,g){return g.subscribe(new It(I,this.selector,this.caught))},I}(),It=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.selector=C,i.caught=A,i}return qi(g,I),g.prototype.error=function(g){if(!this.isStopped){var C=void 0;try{C=this.selector(g,this.caught)}catch(e){return void I.prototype.error.call(this,e)}this._unsubscribeAndRecycle();var A=new _l(this);this.add(A);var i=ql(C,A);i!==A&&this.add(i)}},g}($l);function gt(I,g){return Io(I,g,1)}var Ct=function(){function I(I,g){this.predicate=I,this.source=g}return I.prototype.call=function(I,g){return g.subscribe(new At(I,this.predicate,this.source))},I}(),At=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.predicate=C,i.source=A,i.count=0,i.index=0,i}return qi(g,I),g.prototype._next=function(I){this.predicate?this._tryPredicate(I):this.count++},g.prototype._tryPredicate=function(I){var g;try{g=this.predicate(I,this.index++,this.source)}catch(C){return void this.destination.error(C)}g&&this.count++},g.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},g}(se);var it=function(){function I(I){this.durationSelector=I}return I.prototype.call=function(I,g){return g.subscribe(new et(I,this.durationSelector))},I}(),et=function(I){function g(g,C){var A=I.call(this,g)||this;return A.durationSelector=C,A.hasValue=!1,A}return qi(g,I),g.prototype._next=function(I){try{var g=this.durationSelector.call(this,I);g&&this._tryNext(I,g)}catch(C){this.destination.error(C)}},g.prototype._complete=function(){this.emitValue(),this.destination.complete()},g.prototype._tryNext=function(I,g){var C=this.durationSubscription;this.value=I,this.hasValue=!0,C&&(C.unsubscribe(),this.remove(C)),(C=ql(g,new _l(this)))&&!C.closed&&this.add(this.durationSubscription=C)},g.prototype.notifyNext=function(){this.emitValue()},g.prototype.notifyComplete=function(){this.emitValue()},g.prototype.emitValue=function(){if(this.hasValue){var g=this.value,C=this.durationSubscription;C&&(this.durationSubscription=void 0,C.unsubscribe(),this.remove(C)),this.value=void 0,this.hasValue=!1,I.prototype._next.call(this,g)}},g}($l);var lt=function(){function I(I,g){this.dueTime=I,this.scheduler=g}return I.prototype.call=function(I,g){return g.subscribe(new ot(I,this.dueTime,this.scheduler))},I}(),ot=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.dueTime=C,i.scheduler=A,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return qi(g,I),g.prototype._next=function(I){this.clearDebounce(),this.lastValue=I,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(tt,this.dueTime,this))},g.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},g.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var I=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(I)}},g.prototype.clearDebounce=function(){var I=this.debouncedSubscription;null!==I&&(this.remove(I),I.unsubscribe(),this.debouncedSubscription=null)},g}(se);function tt(I){I.debouncedNext()}function ct(I){return void 0===I&&(I=null),function(g){return g.lift(new nt(I))}}var nt=function(){function I(I){this.defaultValue=I}return I.prototype.call=function(I,g){return g.subscribe(new dt(I,this.defaultValue))},I}(),dt=function(I){function g(g,C){var A=I.call(this,g)||this;return A.defaultValue=C,A.isEmpty=!0,A}return qi(g,I),g.prototype._next=function(I){this.isEmpty=!1,this.destination.next(I)},g.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},g}(se);function st(I){return I instanceof Date&&!isNaN(+I)}var at=function(){function I(I,g){this.delay=I,this.scheduler=g}return I.prototype.call=function(I,g){return g.subscribe(new Zt(I,this.delay,this.scheduler))},I}(),Zt=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.delay=C,i.scheduler=A,i.queue=[],i.active=!1,i.errored=!1,i}return qi(g,I),g.dispatch=function(I){for(var g=I.source,C=g.queue,A=I.scheduler,i=I.destination;C.length>0&&C[0].time-A.now()<=0;)C.shift().notification.observe(i);if(C.length>0){var e=Math.max(0,C[0].time-A.now());this.schedule(I,e)}else this.unsubscribe(),g.active=!1},g.prototype._schedule=function(I){this.active=!0,this.destination.add(I.schedule(g.dispatch,this.delay,{source:this,destination:this.destination,scheduler:I}))},g.prototype.scheduleNotification=function(I){if(!0!==this.errored){var g=this.scheduler,C=new mt(g.now()+this.delay,I);this.queue.push(C),!1===this.active&&this._schedule(g)}},g.prototype._next=function(I){this.scheduleNotification(gl.createNext(I))},g.prototype._error=function(I){this.errored=!0,this.queue=[],this.destination.error(I),this.unsubscribe()},g.prototype._complete=function(){this.scheduleNotification(gl.createComplete()),this.unsubscribe()},g}(se),mt=function(){return function(I,g){this.time=I,this.notification=g}}();var bt=function(){function I(I){this.delayDurationSelector=I}return I.prototype.call=function(I,g){return g.subscribe(new rt(I,this.delayDurationSelector))},I}(),rt=function(I){function g(g,C){var A=I.call(this,g)||this;return A.delayDurationSelector=C,A.completed=!1,A.delayNotifierSubscriptions=[],A.index=0,A}return qi(g,I),g.prototype.notifyNext=function(I,g,C,A,i){this.destination.next(I),this.removeSubscription(i),this.tryComplete()},g.prototype.notifyError=function(I,g){this._error(I)},g.prototype.notifyComplete=function(I){var g=this.removeSubscription(I);g&&this.destination.next(g),this.tryComplete()},g.prototype._next=function(I){var g=this.index++;try{var C=this.delayDurationSelector(I,g);C&&this.tryDelay(C,I)}catch(A){this.destination.error(A)}},g.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},g.prototype.removeSubscription=function(I){I.unsubscribe();var g=this.delayNotifierSubscriptions.indexOf(I);return-1!==g&&this.delayNotifierSubscriptions.splice(g,1),I.outerValue},g.prototype.tryDelay=function(I,g){var C=Ql(this,I,g);C&&!C.closed&&(this.destination.add(C),this.delayNotifierSubscriptions.push(C))},g.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},g}(kl),ht=function(I){function g(g,C){var A=I.call(this)||this;return A.source=g,A.subscriptionDelay=C,A}return qi(g,I),g.prototype._subscribe=function(I){this.subscriptionDelay.subscribe(new Gt(I,this.source))},g}(Ge),Gt=function(I){function g(g,C){var A=I.call(this)||this;return A.parent=g,A.source=C,A.sourceSubscribed=!1,A}return qi(g,I),g.prototype._next=function(I){this.subscribeToSource()},g.prototype._error=function(I){this.unsubscribe(),this.parent.error(I)},g.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},g.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},g}(se);var ut=function(){function I(){}return I.prototype.call=function(I,g){return g.subscribe(new yt(I))},I}(),yt=function(I){function g(g){return I.call(this,g)||this}return qi(g,I),g.prototype._next=function(I){I.observe(this.destination)},g}(se);var Bt=function(){function I(I,g){this.keySelector=I,this.flushes=g}return I.prototype.call=function(I,g){return g.subscribe(new Vt(I,this.keySelector,this.flushes))},I}(),Vt=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.keySelector=C,i.values=new Set,A&&i.add(ql(A,new _l(i))),i}return qi(g,I),g.prototype.notifyNext=function(){this.values.clear()},g.prototype.notifyError=function(I){this._error(I)},g.prototype._next=function(I){this.keySelector?this._useKeySelector(I):this._finalizeNext(I,I)},g.prototype._useKeySelector=function(I){var g,C=this.destination;try{g=this.keySelector(I)}catch(A){return void C.error(A)}this._finalizeNext(g,I)},g.prototype._finalizeNext=function(I,g){var C=this.values;C.has(I)||(C.add(I),this.destination.next(g))},g}($l);function pt(I,g){return function(C){return C.lift(new Xt(I,g))}}var Xt=function(){function I(I,g){this.compare=I,this.keySelector=g}return I.prototype.call=function(I,g){return g.subscribe(new Wt(I,this.compare,this.keySelector))},I}(),Wt=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.keySelector=A,i.hasKey=!1,"function"===typeof C&&(i.compare=C),i}return qi(g,I),g.prototype.compare=function(I,g){return I===g},g.prototype._next=function(I){var g;try{var C=this.keySelector;g=C?C(I):I}catch(i){return this.destination.error(i)}var A=!1;if(this.hasKey)try{A=(0,this.compare)(this.key,g)}catch(i){return this.destination.error(i)}else this.hasKey=!0;A||(this.key=g,this.destination.next(I))},g}(se);function Ht(I){return void 0===I&&(I=ft),function(g){return g.lift(new Yt(I))}}var Yt=function(){function I(I){this.errorFactory=I}return I.prototype.call=function(I,g){return g.subscribe(new Rt(I,this.errorFactory))},I}(),Rt=function(I){function g(g,C){var A=I.call(this,g)||this;return A.errorFactory=C,A.hasValue=!1,A}return qi(g,I),g.prototype._next=function(I){this.hasValue=!0,this.destination.next(I)},g.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var I=void 0;try{I=this.errorFactory()}catch(im){I=im}this.destination.error(I)},g}(se);function ft(){return new Yl}function Kt(I){return function(g){return 0===I?Pe():g.lift(new wt(I))}}var wt=function(){function I(I){if(this.total=I,this.total<0)throw new Hl}return I.prototype.call=function(I,g){return g.subscribe(new Jt(I,this.total))},I}(),Jt=function(I){function g(g,C){var A=I.call(this,g)||this;return A.total=C,A.count=0,A}return qi(g,I),g.prototype._next=function(I){var g=this.total,C=++this.count;C<=g&&(this.destination.next(I),C===g&&(this.destination.complete(),this.unsubscribe()))},g}(se);var St=function(){function I(I,g,C){this.predicate=I,this.thisArg=g,this.source=C}return I.prototype.call=function(I,g){return g.subscribe(new Ft(I,this.predicate,this.thisArg,this.source))},I}(),Ft=function(I){function g(g,C,A,i){var e=I.call(this,g)||this;return e.predicate=C,e.thisArg=A,e.source=i,e.index=0,e.thisArg=A||e,e}return qi(g,I),g.prototype.notifyComplete=function(I){this.destination.next(I),this.destination.complete()},g.prototype._next=function(I){var g=!1;try{g=this.predicate.call(this.thisArg,I,this.index++,this.source)}catch(C){return void this.destination.error(C)}g||this.notifyComplete(!1)},g.prototype._complete=function(){this.notifyComplete(!0)},g}(se);var Nt=function(){function I(){}return I.prototype.call=function(I,g){return g.subscribe(new vt(I))},I}(),vt=function(I){function g(g){var C=I.call(this,g)||this;return C.hasCompleted=!1,C.hasSubscription=!1,C}return qi(g,I),g.prototype._next=function(I){this.hasSubscription||(this.hasSubscription=!0,this.add(ql(I,new _l(this))))},g.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},g.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},g}($l);var kt=function(){function I(I){this.project=I}return I.prototype.call=function(I,g){return g.subscribe(new Dt(I,this.project))},I}(),Dt=function(I){function g(g,C){var A=I.call(this,g)||this;return A.project=C,A.hasSubscription=!1,A.hasCompleted=!1,A.index=0,A}return qi(g,I),g.prototype._next=function(I){this.hasSubscription||this.tryNext(I)},g.prototype.tryNext=function(I){var g,C=this.index++;try{g=this.project(I,C)}catch(A){return void this.destination.error(A)}this.hasSubscription=!0,this._innerSub(g)},g.prototype._innerSub=function(I){var g=new _l(this),C=this.destination;C.add(g);var A=ql(I,g);A!==g&&C.add(A)},g.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},g.prototype.notifyNext=function(I){this.destination.next(I)},g.prototype.notifyError=function(I){this.destination.error(I)},g.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},g}($l);var zt=function(){function I(I,g,C){this.project=I,this.concurrent=g,this.scheduler=C}return I.prototype.call=function(I,g){return g.subscribe(new Mt(I,this.project,this.concurrent,this.scheduler))},I}(),Mt=function(I){function g(g,C,A,i){var e=I.call(this,g)||this;return e.project=C,e.concurrent=A,e.scheduler=i,e.index=0,e.active=0,e.hasCompleted=!1,A<Number.POSITIVE_INFINITY&&(e.buffer=[]),e}return qi(g,I),g.dispatch=function(I){var g=I.subscriber,C=I.result,A=I.value,i=I.index;g.subscribeToProjection(C,A,i)},g.prototype._next=function(I){var C=this.destination;if(C.closed)this._complete();else{var A=this.index++;if(this.active<this.concurrent){C.next(I);try{var i=(0,this.project)(I,A);if(this.scheduler){var e={subscriber:this,result:i,value:I,index:A};this.destination.add(this.scheduler.schedule(g.dispatch,0,e))}else this.subscribeToProjection(i,I,A)}catch(im){C.error(im)}}else this.buffer.push(I)}},g.prototype.subscribeToProjection=function(I,g,C){this.active++,this.destination.add(ql(I,new _l(this)))},g.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},g.prototype.notifyNext=function(I){this._next(I)},g.prototype.notifyComplete=function(){var I=this.buffer;this.active--,I&&I.length>0&&this._next(I.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},g}($l);var Ut=function(){function I(I){this.callback=I}return I.prototype.call=function(I,g){return g.subscribe(new xt(I,this.callback))},I}(),xt=function(I){function g(g,C){var A=I.call(this,g)||this;return A.add(new ce(C)),A}return qi(g,I),g}(se);var Tt=function(){function I(I,g,C,A){this.predicate=I,this.source=g,this.yieldIndex=C,this.thisArg=A}return I.prototype.call=function(I,g){return g.subscribe(new Qt(I,this.predicate,this.source,this.yieldIndex,this.thisArg))},I}(),Qt=function(I){function g(g,C,A,i,e){var l=I.call(this,g)||this;return l.predicate=C,l.source=A,l.yieldIndex=i,l.thisArg=e,l.index=0,l}return qi(g,I),g.prototype.notifyComplete=function(I){var g=this.destination;g.next(I),g.complete(),this.unsubscribe()},g.prototype._next=function(I){var g=this.predicate,C=this.thisArg,A=this.index++;try{g.call(C||this,I,A,this.source)&&this.notifyComplete(this.yieldIndex?A:I)}catch(i){this.destination.error(i)}},g.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},g}(se);var Pt=function(){function I(){}return I.prototype.call=function(I,g){return g.subscribe(new Ot(I))},I}(),Ot=function(I){function g(){return null!==I&&I.apply(this,arguments)||this}return qi(g,I),g.prototype._next=function(I){},g}(se);var jt=function(){function I(){}return I.prototype.call=function(I,g){return g.subscribe(new Lt(I))},I}(),Lt=function(I){function g(g){return I.call(this,g)||this}return qi(g,I),g.prototype.notifyComplete=function(I){var g=this.destination;g.next(I),g.complete()},g.prototype._next=function(I){this.notifyComplete(!1)},g.prototype._complete=function(){this.notifyComplete(!0)},g}(se);function Et(I){return function(g){return 0===I?Pe():g.lift(new _t(I))}}var _t=function(){function I(I){if(this.total=I,this.total<0)throw new Hl}return I.prototype.call=function(I,g){return g.subscribe(new $t(I,this.total))},I}(),$t=function(I){function g(g,C){var A=I.call(this,g)||this;return A.total=C,A.ring=new Array,A.count=0,A}return qi(g,I),g.prototype._next=function(I){var g=this.ring,C=this.total,A=this.count++;g.length<C?g.push(I):g[A%C]=I},g.prototype._complete=function(){var I=this.destination,g=this.count;if(g>0)for(var C=this.count>=this.total?this.total:this.count,A=this.ring,i=0;i<C;i++){var e=g++%C;I.next(A[e])}I.complete()},g}(se);var qt=function(){function I(I){this.value=I}return I.prototype.call=function(I,g){return g.subscribe(new Ic(I,this.value))},I}(),Ic=function(I){function g(g,C){var A=I.call(this,g)||this;return A.value=C,A}return qi(g,I),g.prototype._next=function(I){this.destination.next(this.value)},g}(se);var gc=function(){function I(){}return I.prototype.call=function(I,g){return g.subscribe(new Cc(I))},I}(),Cc=function(I){function g(g){return I.call(this,g)||this}return qi(g,I),g.prototype._next=function(I){this.destination.next(gl.createNext(I))},g.prototype._error=function(I){var g=this.destination;g.next(gl.createError(I)),g.complete()},g.prototype._complete=function(){var I=this.destination;I.next(gl.createComplete()),I.complete()},g}(se);function Ac(I,g){var C=!1;return arguments.length>=2&&(C=!0),function(A){return A.lift(new ic(I,g,C))}}var ic=function(){function I(I,g,C){void 0===C&&(C=!1),this.accumulator=I,this.seed=g,this.hasSeed=C}return I.prototype.call=function(I,g){return g.subscribe(new ec(I,this.accumulator,this.seed,this.hasSeed))},I}(),ec=function(I){function g(g,C,A,i){var e=I.call(this,g)||this;return e.accumulator=C,e._seed=A,e.hasSeed=i,e.index=0,e}return qi(g,I),Object.defineProperty(g.prototype,"seed",{get:function(){return this._seed},set:function(I){this.hasSeed=!0,this._seed=I},enumerable:!0,configurable:!0}),g.prototype._next=function(I){if(this.hasSeed)return this._tryNext(I);this.seed=I,this.destination.next(I)},g.prototype._tryNext=function(I){var g,C=this.index++;try{g=this.accumulator(this.seed,I,C)}catch(A){this.destination.error(A)}this.seed=g,this.destination.next(g)},g}(se);function lc(I,g){return arguments.length>=2?function(C){return re(Ac(I,g),Et(1),ct(g))(C)}:function(g){return re(Ac((function(g,C,A){return I(g,C,A+1)})),Et(1))(g)}}var oc=function(){function I(I,g,C){this.accumulator=I,this.seed=g,this.concurrent=C}return I.prototype.call=function(I,g){return g.subscribe(new tc(I,this.accumulator,this.seed,this.concurrent))},I}(),tc=function(I){function g(g,C,A,i){var e=I.call(this,g)||this;return e.accumulator=C,e.acc=A,e.concurrent=i,e.hasValue=!1,e.hasCompleted=!1,e.buffer=[],e.active=0,e.index=0,e}return qi(g,I),g.prototype._next=function(I){if(this.active<this.concurrent){var g=this.index++,C=this.destination,A=void 0;try{A=(0,this.accumulator)(this.acc,I,g)}catch(im){return C.error(im)}this.active++,this._innerSub(A)}else this.buffer.push(I)},g.prototype._innerSub=function(I){var g=new _l(this),C=this.destination;C.add(g);var A=ql(I,g);A!==g&&C.add(A)},g.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},g.prototype.notifyNext=function(I){var g=this.destination;this.acc=I,this.hasValue=!0,g.next(I)},g.prototype.notifyComplete=function(){var I=this.buffer;this.active--,I.length>0?this._next(I.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},g}($l);function cc(I,g){return function(C){var A;if(A="function"===typeof I?I:function(){return I},"function"===typeof g)return C.lift(new nc(A,g));var i=Object.create(C,fe);return i.source=C,i.subjectFactory=A,i}}var nc=function(){function I(I,g){this.subjectFactory=I,this.selector=g}return I.prototype.call=function(I,g){var C=this.selector,A=this.subjectFactory(),i=C(A).subscribe(I);return i.add(g.subscribe(A)),i},I}();var dc=function(){function I(I){this.nextSources=I}return I.prototype.call=function(I,g){return g.subscribe(new sc(I,this.nextSources))},I}(),sc=function(I){function g(g,C){var A=I.call(this,g)||this;return A.destination=g,A.nextSources=C,A}return qi(g,I),g.prototype.notifyError=function(){this.subscribeToNextSource()},g.prototype.notifyComplete=function(){this.subscribeToNextSource()},g.prototype._error=function(I){this.subscribeToNextSource(),this.unsubscribe()},g.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},g.prototype.subscribeToNextSource=function(){var I=this.nextSources.shift();if(I){var g=new _l(this),C=this.destination;C.add(g);var A=ql(I,g);A!==g&&C.add(A)}else this.destination.complete()},g}($l);var ac=function(){function I(){}return I.prototype.call=function(I,g){return g.subscribe(new Zc(I))},I}(),Zc=function(I){function g(g){var C=I.call(this,g)||this;return C.hasPrev=!1,C}return qi(g,I),g.prototype._next=function(I){var g;this.hasPrev?g=[this.prev,I]:this.hasPrev=!0,this.prev=I,g&&this.destination.next(g)},g}(se);function mc(I,g){return function(C){for(var A=C,i=0;i<g;i++){var e=null!=A?A[I[i]]:void 0;if(void 0===e)return;A=e}return A}}var bc=function(){function I(I,g){this.count=I,this.source=g}return I.prototype.call=function(I,g){return g.subscribe(new rc(I,this.count,this.source))},I}(),rc=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.count=C,i.source=A,i}return qi(g,I),g.prototype.complete=function(){if(!this.isStopped){var g=this.source,C=this.count;if(0===C)return I.prototype.complete.call(this);C>-1&&(this.count=C-1),g.subscribe(this._unsubscribeAndRecycle())}},g}(se);var hc=function(){function I(I){this.notifier=I}return I.prototype.call=function(I,g){return g.subscribe(new Gc(I,this.notifier,g))},I}(),Gc=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.notifier=C,i.source=A,i.sourceIsBeingSubscribedTo=!0,i}return qi(g,I),g.prototype.notifyNext=function(){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},g.prototype.notifyComplete=function(){if(!1===this.sourceIsBeingSubscribedTo)return I.prototype.complete.call(this)},g.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return I.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next(void 0)}},g.prototype._unsubscribe=function(){var I=this.notifications,g=this.retriesSubscription;I&&(I.unsubscribe(),this.notifications=void 0),g&&(g.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},g.prototype._unsubscribeAndRecycle=function(){var g=this._unsubscribe;return this._unsubscribe=null,I.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=g,this},g.prototype.subscribeToRetries=function(){var g;this.notifications=new pe;try{g=(0,this.notifier)(this.notifications)}catch(im){return I.prototype.complete.call(this)}this.retries=g,this.retriesSubscription=ql(g,new _l(this))},g}($l);var uc=function(){function I(I,g){this.count=I,this.source=g}return I.prototype.call=function(I,g){return g.subscribe(new yc(I,this.count,this.source))},I}(),yc=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.count=C,i.source=A,i}return qi(g,I),g.prototype.error=function(g){if(!this.isStopped){var C=this.source,A=this.count;if(0===A)return I.prototype.error.call(this,g);A>-1&&(this.count=A-1),C.subscribe(this._unsubscribeAndRecycle())}},g}(se);var Bc=function(){function I(I,g){this.notifier=I,this.source=g}return I.prototype.call=function(I,g){return g.subscribe(new Vc(I,this.notifier,this.source))},I}(),Vc=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.notifier=C,i.source=A,i}return qi(g,I),g.prototype.error=function(g){if(!this.isStopped){var C=this.errors,A=this.retries,i=this.retriesSubscription;if(A)this.errors=void 0,this.retriesSubscription=void 0;else{C=new pe;try{A=(0,this.notifier)(C)}catch(im){return I.prototype.error.call(this,im)}i=ql(A,new _l(this))}this._unsubscribeAndRecycle(),this.errors=C,this.retries=A,this.retriesSubscription=i,C.next(g)}},g.prototype._unsubscribe=function(){var I=this.errors,g=this.retriesSubscription;I&&(I.unsubscribe(),this.errors=void 0),g&&(g.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},g.prototype.notifyNext=function(){var I=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=I,this.source.subscribe(this)},g}($l);var pc=function(){function I(I){this.notifier=I}return I.prototype.call=function(I,g){var C=new Xc(I),A=g.subscribe(C);return A.add(ql(this.notifier,new _l(C))),A},I}(),Xc=function(I){function g(){var g=null!==I&&I.apply(this,arguments)||this;return g.hasValue=!1,g}return qi(g,I),g.prototype._next=function(I){this.value=I,this.hasValue=!0},g.prototype.notifyNext=function(){this.emitValue()},g.prototype.notifyComplete=function(){this.emitValue()},g.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},g}($l);var Wc=function(){function I(I,g){this.period=I,this.scheduler=g}return I.prototype.call=function(I,g){return g.subscribe(new Hc(I,this.period,this.scheduler))},I}(),Hc=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.period=C,i.scheduler=A,i.hasValue=!1,i.add(A.schedule(Yc,C,{subscriber:i,period:C})),i}return qi(g,I),g.prototype._next=function(I){this.lastValue=I,this.hasValue=!0},g.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},g}(se);function Yc(I){var g=I.subscriber,C=I.period;g.notifyNext(),this.schedule(I,C)}var Rc=function(){function I(I,g){this.compareTo=I,this.comparator=g}return I.prototype.call=function(I,g){return g.subscribe(new fc(I,this.compareTo,this.comparator))},I}(),fc=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.compareTo=C,i.comparator=A,i._a=[],i._b=[],i._oneComplete=!1,i.destination.add(C.subscribe(new Kc(g,i))),i}return qi(g,I),g.prototype._next=function(I){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(I),this.checkValues())},g.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},g.prototype.checkValues=function(){for(var I=this,g=I._a,C=I._b,A=I.comparator;g.length>0&&C.length>0;){var i=g.shift(),e=C.shift(),l=!1;try{l=A?A(i,e):i===e}catch(im){this.destination.error(im)}l||this.emit(!1)}},g.prototype.emit=function(I){var g=this.destination;g.next(I),g.complete()},g.prototype.nextB=function(I){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(I),this.checkValues())},g.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},g}(se),Kc=function(I){function g(g,C){var A=I.call(this,g)||this;return A.parent=C,A}return qi(g,I),g.prototype._next=function(I){this.parent.nextB(I)},g.prototype._error=function(I){this.parent.error(I),this.unsubscribe()},g.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},g}(se);function wc(){return new pe}var Jc=function(){function I(I,g){this.predicate=I,this.source=g}return I.prototype.call=function(I,g){return g.subscribe(new Sc(I,this.predicate,this.source))},I}(),Sc=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.predicate=C,i.source=A,i.seenValue=!1,i.index=0,i}return qi(g,I),g.prototype.applySingleValue=function(I){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=I)},g.prototype._next=function(I){var g=this.index++;this.predicate?this.tryNext(I,g):this.applySingleValue(I)},g.prototype.tryNext=function(I,g){try{this.predicate(I,g,this.source)&&this.applySingleValue(I)}catch(C){this.destination.error(C)}},g.prototype._complete=function(){var I=this.destination;this.index>0?(I.next(this.seenValue?this.singleValue:void 0),I.complete()):I.error(new Yl)},g}(se);var Fc=function(){function I(I){this.total=I}return I.prototype.call=function(I,g){return g.subscribe(new Nc(I,this.total))},I}(),Nc=function(I){function g(g,C){var A=I.call(this,g)||this;return A.total=C,A.count=0,A}return qi(g,I),g.prototype._next=function(I){++this.count>this.total&&this.destination.next(I)},g}(se);var vc=function(){function I(I){if(this._skipCount=I,this._skipCount<0)throw new Hl}return I.prototype.call=function(I,g){return 0===this._skipCount?g.subscribe(new se(I)):g.subscribe(new kc(I,this._skipCount))},I}(),kc=function(I){function g(g,C){var A=I.call(this,g)||this;return A._skipCount=C,A._count=0,A._ring=new Array(C),A}return qi(g,I),g.prototype._next=function(I){var g=this._skipCount,C=this._count++;if(C<g)this._ring[C]=I;else{var A=C%g,i=this._ring,e=i[A];i[A]=I,this.destination.next(e)}},g}(se);var Dc=function(){function I(I){this.notifier=I}return I.prototype.call=function(I,g){return g.subscribe(new zc(I,this.notifier))},I}(),zc=function(I){function g(g,C){var A=I.call(this,g)||this;A.hasValue=!1;var i=new _l(A);A.add(i),A.innerSubscription=i;var e=ql(C,i);return e!==i&&(A.add(e),A.innerSubscription=e),A}return qi(g,I),g.prototype._next=function(g){this.hasValue&&I.prototype._next.call(this,g)},g.prototype.notifyNext=function(){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},g.prototype.notifyComplete=function(){},g}($l);var Mc=function(){function I(I){this.predicate=I}return I.prototype.call=function(I,g){return g.subscribe(new Uc(I,this.predicate))},I}(),Uc=function(I){function g(g,C){var A=I.call(this,g)||this;return A.predicate=C,A.skipping=!0,A.index=0,A}return qi(g,I),g.prototype._next=function(I){var g=this.destination;this.skipping&&this.tryCallPredicate(I),this.skipping||g.next(I)},g.prototype.tryCallPredicate=function(I){try{var g=this.predicate(I,this.index++);this.skipping=Boolean(g)}catch(C){this.destination.error(C)}},g}(se);var xc=function(I){function g(g,C,A){void 0===C&&(C=0),void 0===A&&(A=rl);var i=I.call(this)||this;return i.source=g,i.delayTime=C,i.scheduler=A,(!so(C)||C<0)&&(i.delayTime=0),A&&"function"===typeof A.schedule||(i.scheduler=rl),i}return qi(g,I),g.create=function(I,C,A){return void 0===C&&(C=0),void 0===A&&(A=rl),new g(I,C,A)},g.dispatch=function(I){var g=I.source,C=I.subscriber;return this.add(g.subscribe(C))},g.prototype._subscribe=function(I){var C=this.delayTime,A=this.source;return this.scheduler.schedule(g.dispatch,C,{source:A,subscriber:I})},g}(Ge);var Tc=function(){function I(I,g){this.scheduler=I,this.delay=g}return I.prototype.call=function(I,g){return new xc(g,this.delay,this.scheduler).subscribe(I)},I}();function Qc(I,g){return"function"===typeof g?function(C){return C.pipe(Qc((function(C,A){return El(I(C,A)).pipe(fl((function(I,i){return g(C,I,A,i)})))})))}:function(g){return g.lift(new Pc(I))}}var Pc=function(){function I(I){this.project=I}return I.prototype.call=function(I,g){return g.subscribe(new Oc(I,this.project))},I}(),Oc=function(I){function g(g,C){var A=I.call(this,g)||this;return A.project=C,A.index=0,A}return qi(g,I),g.prototype._next=function(I){var g,C=this.index++;try{g=this.project(I,C)}catch(A){return void this.destination.error(A)}this._innerSub(g)},g.prototype._innerSub=function(I){var g=this.innerSubscription;g&&g.unsubscribe();var C=new _l(this),A=this.destination;A.add(C),this.innerSubscription=ql(I,C),this.innerSubscription!==C&&A.add(this.innerSubscription)},g.prototype._complete=function(){var g=this.innerSubscription;g&&!g.closed||I.prototype._complete.call(this),this.unsubscribe()},g.prototype._unsubscribe=function(){this.innerSubscription=void 0},g.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&I.prototype._complete.call(this)},g.prototype.notifyNext=function(I){this.destination.next(I)},g}($l);var jc=function(){function I(I){this.notifier=I}return I.prototype.call=function(I,g){var C=new Lc(I),A=ql(this.notifier,new _l(C));return A&&!C.seenValue?(C.add(A),g.subscribe(C)):C},I}(),Lc=function(I){function g(g){var C=I.call(this,g)||this;return C.seenValue=!1,C}return qi(g,I),g.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},g.prototype.notifyComplete=function(){},g}($l);var Ec=function(){function I(I,g){this.predicate=I,this.inclusive=g}return I.prototype.call=function(I,g){return g.subscribe(new _c(I,this.predicate,this.inclusive))},I}(),_c=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.predicate=C,i.inclusive=A,i.index=0,i}return qi(g,I),g.prototype._next=function(I){var g,C=this.destination;try{g=this.predicate(I,this.index++)}catch(A){return void C.error(A)}this.nextOrComplete(I,g)},g.prototype.nextOrComplete=function(I,g){var C=this.destination;Boolean(g)?C.next(I):(this.inclusive&&C.next(I),C.complete())},g}(se);var $c=function(){function I(I,g,C){this.nextOrObserver=I,this.error=g,this.complete=C}return I.prototype.call=function(I,g){return g.subscribe(new qc(I,this.nextOrObserver,this.error,this.complete))},I}(),qc=function(I){function g(g,C,A,i){var e=I.call(this,g)||this;return e._tapNext=Wl,e._tapError=Wl,e._tapComplete=Wl,e._tapError=A||Wl,e._tapComplete=i||Wl,Ie(C)?(e._context=e,e._tapNext=C):C&&(e._context=C,e._tapNext=C.next||Wl,e._tapError=C.error||Wl,e._tapComplete=C.complete||Wl),e}return qi(g,I),g.prototype._next=function(I){try{this._tapNext.call(this._context,I)}catch(g){return void this.destination.error(g)}this.destination.next(I)},g.prototype._error=function(I){try{this._tapError.call(this._context,I)}catch(g){return void this.destination.error(g)}this.destination.error(I)},g.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(I){return void this.destination.error(I)}return this.destination.complete()},g}(se),In={leading:!0,trailing:!1};var gn=function(){function I(I,g,C){this.durationSelector=I,this.leading=g,this.trailing=C}return I.prototype.call=function(I,g){return g.subscribe(new Cn(I,this.durationSelector,this.leading,this.trailing))},I}(),Cn=function(I){function g(g,C,A,i){var e=I.call(this,g)||this;return e.destination=g,e.durationSelector=C,e._leading=A,e._trailing=i,e._hasValue=!1,e}return qi(g,I),g.prototype._next=function(I){this._hasValue=!0,this._sendValue=I,this._throttled||(this._leading?this.send():this.throttle(I))},g.prototype.send=function(){var I=this._hasValue,g=this._sendValue;I&&(this.destination.next(g),this.throttle(g)),this._hasValue=!1,this._sendValue=void 0},g.prototype.throttle=function(I){var g=this.tryDurationSelector(I);g&&this.add(this._throttled=ql(g,new _l(this)))},g.prototype.tryDurationSelector=function(I){try{return this.durationSelector(I)}catch(g){return this.destination.error(g),null}},g.prototype.throttlingDone=function(){var I=this._throttled,g=this._trailing;I&&I.unsubscribe(),this._throttled=void 0,g&&this.send()},g.prototype.notifyNext=function(){this.throttlingDone()},g.prototype.notifyComplete=function(){this.throttlingDone()},g}($l);var An=function(){function I(I,g,C,A){this.duration=I,this.scheduler=g,this.leading=C,this.trailing=A}return I.prototype.call=function(I,g){return g.subscribe(new en(I,this.duration,this.scheduler,this.leading,this.trailing))},I}(),en=function(I){function g(g,C,A,i,e){var l=I.call(this,g)||this;return l.duration=C,l.scheduler=A,l.leading=i,l.trailing=e,l._hasTrailingValue=!1,l._trailingValue=null,l}return qi(g,I),g.prototype._next=function(I){this.throttled?this.trailing&&(this._trailingValue=I,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(ln,this.duration,{subscriber:this})),this.leading?this.destination.next(I):this.trailing&&(this._trailingValue=I,this._hasTrailingValue=!0))},g.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},g.prototype.clearThrottle=function(){var I=this.throttled;I&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),I.unsubscribe(),this.remove(I),this.throttled=null)},g}(se);function ln(I){I.subscriber.clearThrottle()}var on=function(){return function(I,g){this.value=I,this.interval=g}}();function tn(I,g,C){return void 0===C&&(C=Gl),function(A){var i=st(I),e=i?+I-C.now():Math.abs(I);return A.lift(new cn(e,i,g,C))}}var cn=function(){function I(I,g,C,A){this.waitFor=I,this.absoluteTimeout=g,this.withObservable=C,this.scheduler=A}return I.prototype.call=function(I,g){return g.subscribe(new nn(I,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},I}(),nn=function(I){function g(g,C,A,i,e){var l=I.call(this,g)||this;return l.absoluteTimeout=C,l.waitFor=A,l.withObservable=i,l.scheduler=e,l.scheduleTimeout(),l}return qi(g,I),g.dispatchTimeout=function(I){var g=I.withObservable;I._unsubscribeAndRecycle(),I.add(ql(g,new _l(I)))},g.prototype.scheduleTimeout=function(){var I=this.action;I?this.action=I.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(g.dispatchTimeout,this.waitFor,this))},g.prototype._next=function(g){this.absoluteTimeout||this.scheduleTimeout(),I.prototype._next.call(this,g)},g.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},g}($l);var dn=function(){return function(I,g){this.value=I,this.timestamp=g}}();function sn(I,g,C){return 0===C?[g]:(I.push(g),I)}var an=function(){function I(I){this.windowBoundaries=I}return I.prototype.call=function(I,g){var C=new Zn(I),A=g.subscribe(C);return A.closed||C.add(ql(this.windowBoundaries,new _l(C))),A},I}(),Zn=function(I){function g(g){var C=I.call(this,g)||this;return C.window=new pe,g.next(C.window),C}return qi(g,I),g.prototype.notifyNext=function(){this.openWindow()},g.prototype.notifyError=function(I){this._error(I)},g.prototype.notifyComplete=function(){this._complete()},g.prototype._next=function(I){this.window.next(I)},g.prototype._error=function(I){this.window.error(I),this.destination.error(I)},g.prototype._complete=function(){this.window.complete(),this.destination.complete()},g.prototype._unsubscribe=function(){this.window=null},g.prototype.openWindow=function(){var I=this.window;I&&I.complete();var g=this.destination,C=this.window=new pe;g.next(C)},g}($l);var mn=function(){function I(I,g){this.windowSize=I,this.startWindowEvery=g}return I.prototype.call=function(I,g){return g.subscribe(new bn(I,this.windowSize,this.startWindowEvery))},I}(),bn=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.destination=g,i.windowSize=C,i.startWindowEvery=A,i.windows=[new pe],i.count=0,g.next(i.windows[0]),i}return qi(g,I),g.prototype._next=function(I){for(var g=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,C=this.destination,A=this.windowSize,i=this.windows,e=i.length,l=0;l<e&&!this.closed;l++)i[l].next(I);var o=this.count-A+1;if(o>=0&&o%g===0&&!this.closed&&i.shift().complete(),++this.count%g===0&&!this.closed){var t=new pe;i.push(t),C.next(t)}},g.prototype._error=function(I){var g=this.windows;if(g)for(;g.length>0&&!this.closed;)g.shift().error(I);this.destination.error(I)},g.prototype._complete=function(){var I=this.windows;if(I)for(;I.length>0&&!this.closed;)I.shift().complete();this.destination.complete()},g.prototype._unsubscribe=function(){this.count=0,this.windows=null},g}(se);var rn=function(){function I(I,g,C,A){this.windowTimeSpan=I,this.windowCreationInterval=g,this.maxWindowSize=C,this.scheduler=A}return I.prototype.call=function(I,g){return g.subscribe(new Gn(I,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},I}(),hn=function(I){function g(){var g=null!==I&&I.apply(this,arguments)||this;return g._numberOfNextedValues=0,g}return qi(g,I),g.prototype.next=function(g){this._numberOfNextedValues++,I.prototype.next.call(this,g)},Object.defineProperty(g.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),g}(pe),Gn=function(I){function g(g,C,A,i,e){var l=I.call(this,g)||this;l.destination=g,l.windowTimeSpan=C,l.windowCreationInterval=A,l.maxWindowSize=i,l.scheduler=e,l.windows=[];var o=l.openWindow();if(null!==A&&A>=0){var t={subscriber:l,window:o,context:null},c={windowTimeSpan:C,windowCreationInterval:A,subscriber:l,scheduler:e};l.add(e.schedule(Bn,C,t)),l.add(e.schedule(yn,A,c))}else{var n={subscriber:l,window:o,windowTimeSpan:C};l.add(e.schedule(un,C,n))}return l}return qi(g,I),g.prototype._next=function(I){for(var g=this.windows,C=g.length,A=0;A<C;A++){var i=g[A];i.closed||(i.next(I),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},g.prototype._error=function(I){for(var g=this.windows;g.length>0;)g.shift().error(I);this.destination.error(I)},g.prototype._complete=function(){for(var I=this.windows;I.length>0;){var g=I.shift();g.closed||g.complete()}this.destination.complete()},g.prototype.openWindow=function(){var I=new hn;return this.windows.push(I),this.destination.next(I),I},g.prototype.closeWindow=function(I){I.complete();var g=this.windows;g.splice(g.indexOf(I),1)},g}(se);function un(I){var g=I.subscriber,C=I.windowTimeSpan,A=I.window;A&&g.closeWindow(A),I.window=g.openWindow(),this.schedule(I,C)}function yn(I){var g=I.windowTimeSpan,C=I.subscriber,A=I.scheduler,i=I.windowCreationInterval,e=C.openWindow(),l=this,o={action:l,subscription:null},t={subscriber:C,window:e,context:o};o.subscription=A.schedule(Bn,g,t),l.add(o.subscription),l.schedule(I,i)}function Bn(I){var g=I.subscriber,C=I.window,A=I.context;A&&A.action&&A.subscription&&A.action.remove(A.subscription),g.closeWindow(C)}var Vn=function(){function I(I,g){this.openings=I,this.closingSelector=g}return I.prototype.call=function(I,g){return g.subscribe(new pn(I,this.openings,this.closingSelector))},I}(),pn=function(I){function g(g,C,A){var i=I.call(this,g)||this;return i.openings=C,i.closingSelector=A,i.contexts=[],i.add(i.openSubscription=Ql(i,C,C)),i}return qi(g,I),g.prototype._next=function(I){var g=this.contexts;if(g)for(var C=g.length,A=0;A<C;A++)g[A].window.next(I)},g.prototype._error=function(g){var C=this.contexts;if(this.contexts=null,C)for(var A=C.length,i=-1;++i<A;){var e=C[i];e.window.error(g),e.subscription.unsubscribe()}I.prototype._error.call(this,g)},g.prototype._complete=function(){var g=this.contexts;if(this.contexts=null,g)for(var C=g.length,A=-1;++A<C;){var i=g[A];i.window.complete(),i.subscription.unsubscribe()}I.prototype._complete.call(this)},g.prototype._unsubscribe=function(){var I=this.contexts;if(this.contexts=null,I)for(var g=I.length,C=-1;++C<g;){var A=I[C];A.window.unsubscribe(),A.subscription.unsubscribe()}},g.prototype.notifyNext=function(I,g,C,A,i){if(I===this.openings){var e=void 0;try{e=(0,this.closingSelector)(g)}catch(im){return this.error(im)}var l=new pe,o=new ce,t={window:l,subscription:o};this.contexts.push(t);var c=Ql(this,e,t);c.closed?this.closeWindow(this.contexts.length-1):(c.context=t,o.add(c)),this.destination.next(l)}else this.closeWindow(this.contexts.indexOf(I))},g.prototype.notifyError=function(I){this.error(I)},g.prototype.notifyComplete=function(I){I!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(I.context))},g.prototype.closeWindow=function(I){if(-1!==I){var g=this.contexts,C=g[I],A=C.window,i=C.subscription;g.splice(I,1),A.complete(),i.unsubscribe()}},g}(kl);var Xn=function(){function I(I){this.closingSelector=I}return I.prototype.call=function(I,g){return g.subscribe(new Wn(I,this.closingSelector))},I}(),Wn=function(I){function g(g,C){var A=I.call(this,g)||this;return A.destination=g,A.closingSelector=C,A.openWindow(),A}return qi(g,I),g.prototype.notifyNext=function(I,g,C,A,i){this.openWindow(i)},g.prototype.notifyError=function(I){this._error(I)},g.prototype.notifyComplete=function(I){this.openWindow(I)},g.prototype._next=function(I){this.window.next(I)},g.prototype._error=function(I){this.window.error(I),this.destination.error(I),this.unsubscribeClosingNotification()},g.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},g.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},g.prototype.openWindow=function(I){void 0===I&&(I=null),I&&(this.remove(I),I.unsubscribe());var g=this.window;g&&g.complete();var C,A=this.window=new pe;this.destination.next(A);try{C=(0,this.closingSelector)()}catch(im){return this.destination.error(im),void this.window.error(im)}this.add(this.closingNotification=Ql(this,C))},g}(kl);var Hn=function(){function I(I,g){this.observables=I,this.project=g}return I.prototype.call=function(I,g){return g.subscribe(new Yn(I,this.observables,this.project))},I}(),Yn=function(I){function g(g,C,A){var i=I.call(this,g)||this;i.observables=C,i.project=A,i.toRespond=[];var e=C.length;i.values=new Array(e);for(var l=0;l<e;l++)i.toRespond.push(l);for(l=0;l<e;l++){var o=C[l];i.add(Ql(i,o,void 0,l))}return i}return qi(g,I),g.prototype.notifyNext=function(I,g,C){this.values[C]=g;var A=this.toRespond;if(A.length>0){var i=A.indexOf(C);-1!==i&&A.splice(i,1)}},g.prototype.notifyComplete=function(){},g.prototype._next=function(I){if(0===this.toRespond.length){var g=[I].concat(this.values);this.project?this._tryProject(g):this.destination.next(g)}},g.prototype._tryProject=function(I){var g;try{g=this.project.apply(this,I)}catch(C){return void this.destination.error(C)}this.destination.next(g)},g}(kl);var Rn=Object.freeze(Object.defineProperty({__proto__:null,audit:Fo,auditTime:function(I,g){return void 0===g&&(g=Gl),Fo((function(){return Xo(I,g)}))},buffer:function(I){return function(g){return g.lift(new ko(I))}},bufferCount:function(I,g){return void 0===g&&(g=null),function(C){return C.lift(new zo(I,g))}},bufferTime:function(I){var g=arguments.length,C=Gl;Oe(arguments[arguments.length-1])&&(C=arguments[arguments.length-1],g--);var A=null;g>=2&&(A=arguments[1]);var i=Number.POSITIVE_INFINITY;return g>=3&&(i=arguments[2]),function(g){return g.lift(new xo(I,A,i,C))}},bufferToggle:function(I,g){return function(C){return C.lift(new Lo(I,g))}},bufferWhen:function(I){return function(g){return g.lift(new _o(I))}},catchError:function(I){return function(g){var C=new qo(I),A=g.lift(C);return C.caught=A}},combineAll:function(I){return function(g){return g.lift(new Ol(I))}},combineLatest:function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];var C=null;return"function"===typeof I[I.length-1]&&(C=I.pop()),1===I.length&&ee(I[0])&&(I=I[0].slice()),function(g){return g.lift.call(El([g].concat(I)),new Ol(C))}},concat:function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];return function(g){return g.lift.call(lo.apply(void 0,[g].concat(I)))}},concatAll:eo,concatMap:gt,concatMapTo:function(I,g){return gt((function(){return I}),g)},count:function(I){return function(g){return g.lift(new Ct(I,g))}},debounce:function(I){return function(g){return g.lift(new it(I))}},debounceTime:function(I,g){return void 0===g&&(g=Gl),function(C){return C.lift(new lt(I,g))}},defaultIfEmpty:ct,delay:function(I,g){void 0===g&&(g=Gl);var C=st(I)?+I-g.now():Math.abs(I);return function(I){return I.lift(new at(C,g))}},delayWhen:function(I,g){return g?function(C){return new ht(C,g).lift(new bt(I))}:function(g){return g.lift(new bt(I))}},dematerialize:function(){return function(I){return I.lift(new ut)}},distinct:function(I,g){return function(C){return C.lift(new Bt(I,g))}},distinctUntilChanged:pt,distinctUntilKeyChanged:function(I,g){return pt((function(C,A){return g?g(C[I],A[I]):C[I]===A[I]}))},elementAt:function(I,g){if(I<0)throw new Hl;var C=arguments.length>=2;return function(A){return A.pipe(ho((function(g,C){return C===I})),Kt(1),C?ct(g):Ht((function(){return new Hl})))}},endWith:function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];return function(g){return lo(g,$e.apply(void 0,I))}},every:function(I,g){return function(C){return C.lift(new St(I,g,C))}},exhaust:function(){return function(I){return I.lift(new Nt)}},exhaustMap:function I(g,C){return C?function(A){return A.pipe(I((function(I,A){return El(g(I,A)).pipe(fl((function(g,i){return C(I,g,A,i)})))})))}:function(I){return I.lift(new kt(g))}},expand:function(I,g,C){return void 0===g&&(g=Number.POSITIVE_INFINITY),g=(g||0)<1?Number.POSITIVE_INFINITY:g,function(A){return A.lift(new zt(I,g,C))}},filter:ho,finalize:function(I){return function(g){return g.lift(new Ut(I))}},find:function(I,g){if("function"!==typeof I)throw new TypeError("predicate is not a function");return function(C){return C.lift(new Tt(I,C,!1,g))}},findIndex:function(I,g){return function(C){return C.lift(new Tt(I,C,!0,g))}},first:function(I,g){var C=arguments.length>=2;return function(A){return A.pipe(I?ho((function(g,C){return I(g,C,A)})):be,Kt(1),C?ct(g):Ht((function(){return new Yl})))}},groupBy:function(I,g,C,A){return function(i){return i.lift(new we(I,g,C,A))}},ignoreElements:function(){return function(I){return I.lift(new Pt)}},isEmpty:function(){return function(I){return I.lift(new jt)}},last:function(I,g){var C=arguments.length>=2;return function(A){return A.pipe(I?ho((function(g,C){return I(g,C,A)})):be,Et(1),C?ct(g):Ht((function(){return new Yl})))}},map:fl,mapTo:function(I){return function(g){return g.lift(new qt(I))}},materialize:function(){return function(I){return I.lift(new gc)}},max:function(I){return lc("function"===typeof I?function(g,C){return I(g,C)>0?g:C}:function(I,g){return I>g?I:g})},merge:function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];return function(g){return g.lift.call(Zo.apply(void 0,[g].concat(I)))}},mergeAll:io,mergeMap:Io,flatMap:Ao,mergeMapTo:function(I,g,C){return void 0===C&&(C=Number.POSITIVE_INFINITY),"function"===typeof g?Io((function(){return I}),g,C):("number"===typeof g&&(C=g),Io((function(){return I}),C))},mergeScan:function(I,g,C){return void 0===C&&(C=Number.POSITIVE_INFINITY),function(A){return A.lift(new oc(I,g,C))}},min:function(I){return lc("function"===typeof I?function(g,C){return I(g,C)<0?g:C}:function(I,g){return I<g?I:g})},multicast:cc,observeOn:function(I,g){return void 0===g&&(g=0),function(C){return C.lift(new Cl(I,g))}},onErrorResumeNext:function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];return 1===I.length&&ee(I[0])&&(I=I[0]),function(g){return g.lift(new dc(I))}},pairwise:function(){return function(I){return I.lift(new ac)}},partition:function(I,g){return function(C){return[ho(I,g)(C),ho(ro(I,g))(C)]}},pluck:function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];var C=I.length;if(0===C)throw new Error("list of properties cannot be empty.");return function(g){return fl(mc(I,C))(g)}},publish:function(I){return I?cc((function(){return new pe}),I):cc(new pe)},publishBehavior:function(I){return function(g){return cc(new ve(I))(g)}},publishLast:function(){return function(I){return cc(new ol)(I)}},publishReplay:function(I,g,C,A){C&&"function"!==typeof C&&(A=C);var i="function"===typeof C?C:void 0,e=new el(I,g,A);return function(I){return cc((function(){return e}),i)(I)}},race:function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];return function(g){return 1===I.length&&ee(I[0])&&(I=I[0]),g.lift.call(yo.apply(void 0,[g].concat(I)))}},reduce:lc,repeat:function(I){return void 0===I&&(I=-1),function(g){return 0===I?Pe():I<0?g.lift(new bc(-1,g)):g.lift(new bc(I-1,g))}},repeatWhen:function(I){return function(g){return g.lift(new hc(I))}},retry:function(I){return void 0===I&&(I=-1),function(g){return g.lift(new uc(I,g))}},retryWhen:function(I){return function(g){return g.lift(new Bc(I,g))}},refCount:We,sample:function(I){return function(g){return g.lift(new pc(I))}},sampleTime:function(I,g){return void 0===g&&(g=Gl),function(C){return C.lift(new Wc(I,g))}},scan:Ac,sequenceEqual:function(I,g){return function(C){return C.lift(new Rc(I,g))}},share:function(){return function(I){return We()(cc(wc)(I))}},shareReplay:function(I,g,C){var A;return A=I&&"object"===typeof I?I:{bufferSize:I,windowTime:g,refCount:!1,scheduler:C},function(I){return I.lift(function(I){var g,C,A=I.bufferSize,i=void 0===A?Number.POSITIVE_INFINITY:A,e=I.windowTime,l=void 0===e?Number.POSITIVE_INFINITY:e,o=I.refCount,t=I.scheduler,c=0,n=!1,d=!1;return function(I){var A;c++,!g||n?(n=!1,g=new el(i,l,t),A=g.subscribe(this),C=I.subscribe({next:function(I){g.next(I)},error:function(I){n=!0,g.error(I)},complete:function(){d=!0,C=void 0,g.complete()}}),d&&(C=void 0)):A=g.subscribe(this),this.add((function(){c--,A.unsubscribe(),A=void 0,C&&!d&&o&&0===c&&(C.unsubscribe(),C=void 0,g=void 0)}))}}(A))}},single:function(I){return function(g){return g.lift(new Jc(I,g))}},skip:function(I){return function(g){return g.lift(new Fc(I))}},skipLast:function(I){return function(g){return g.lift(new vc(I))}},skipUntil:function(I){return function(g){return g.lift(new Dc(I))}},skipWhile:function(I){return function(g){return g.lift(new Mc(I))}},startWith:function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];var C=I[I.length-1];return Oe(C)?(I.pop(),function(g){return lo(I,g,C)}):function(g){return lo(I,g)}},subscribeOn:function(I,g){return void 0===g&&(g=0),function(C){return C.lift(new Tc(I,g))}},switchAll:function(){return Qc(be)},switchMap:Qc,switchMapTo:function(I,g){return g?Qc((function(){return I}),g):Qc((function(){return I}))},take:Kt,takeLast:Et,takeUntil:function(I){return function(g){return g.lift(new jc(I))}},takeWhile:function(I,g){return void 0===g&&(g=!1),function(C){return C.lift(new Ec(I,g))}},tap:function(I,g,C){return function(A){return A.lift(new $c(I,g,C))}},throttle:function(I,g){return void 0===g&&(g=In),function(C){return C.lift(new gn(I,!!g.leading,!!g.trailing))}},throttleTime:function(I,g,C){return void 0===g&&(g=Gl),void 0===C&&(C=In),function(A){return A.lift(new An(I,g,C.leading,C.trailing))}},throwIfEmpty:Ht,timeInterval:function(I){return void 0===I&&(I=Gl),function(g){return oo((function(){return g.pipe(Ac((function(g,C){var A=g.current;return{value:C,current:I.now(),last:A}}),{current:I.now(),value:void 0,last:void 0}),fl((function(I){var g=I.current,C=I.last,A=I.value;return new on(A,g-C)})))}))}},timeout:function(I,g){return void 0===g&&(g=Gl),tn(I,qe(new Rl),g)},timeoutWith:tn,timestamp:function(I){return void 0===I&&(I=Gl),fl((function(g){return new dn(g,I.now())}))},toArray:function(){return lc(sn,[])},window:function(I){return function(g){return g.lift(new an(I))}},windowCount:function(I,g){return void 0===g&&(g=0),function(C){return C.lift(new mn(I,g))}},windowTime:function(I){var g=Gl,C=null,A=Number.POSITIVE_INFINITY;return Oe(arguments[3])&&(g=arguments[3]),Oe(arguments[2])?g=arguments[2]:so(arguments[2])&&(A=Number(arguments[2])),Oe(arguments[1])?g=arguments[1]:so(arguments[1])&&(C=Number(arguments[1])),function(i){return i.lift(new rn(I,C,A,g))}},windowToggle:function(I,g){return function(C){return C.lift(new Vn(I,g))}},windowWhen:function(I){return function(g){return g.lift(new Xn(I))}},withLatestFrom:function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];return function(g){var C;"function"===typeof I[I.length-1]&&(C=I.pop());var A=I;return g.lift(new Hn(A,C))}},zip:function(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];return function(g){return g.lift.call(Ho.apply(void 0,[g].concat(I)))}},zipAll:function(I){return function(g){return g.lift(new Yo(I))}}},Symbol.toStringTag,{value:"Module"})),fn=aC(Rn),Kn=bC.exports;Object.defineProperty(_i,"__esModule",{value:!0}),_i.BBI=void 0;var wn=Kn(hC),Jn=Kn(GC.exports),Sn=Kn(uC.exports),Fn=Kn(yC.exports),Nn=Kn(RC.exports),vn=fC,kn=gI.a,Dn=So,zn=fn,Mn=Kn(rA),Un=Kn(q.a),xn=YC;function Tn(I,g){var C=Object.keys(I);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(I);g&&(A=A.filter((function(g){return Object.getOwnPropertyDescriptor(I,g).enumerable}))),C.push.apply(C,A)}return C}function Qn(I){for(var g=1;g<arguments.length;g++){var C=null!=arguments[g]?arguments[g]:{};g%2?Tn(Object(C),!0).forEach((function(g){(0,Nn.default)(I,g,C[g])})):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(C)):Tn(Object(C)).forEach((function(g){Object.defineProperty(I,g,Object.getOwnPropertyDescriptor(C,g))}))}return I}var Pn=-2003829722,On=-2021002517;function jn(I){var g=I?"big":"little",C=(new vn.Parser).endianess(g).int32("magic").uint16("version").uint16("numZoomLevels").uint64("chromTreeOffset").uint64("unzoomedDataOffset").uint64("unzoomedIndexOffset").uint16("fieldCount").uint16("definedFieldCount").uint64("asOffset").uint64("totalSummaryOffset").uint32("uncompressBufSize").uint64("extHeaderOffset").array("zoomLevels",{length:"numZoomLevels",type:(new vn.Parser).uint32("reductionLevel").uint32("reserved").uint64("dataOffset").uint64("indexOffset")}),A=(new vn.Parser).endianess(g).uint64("basesCovered").double("scoreMin").double("scoreMax").double("scoreSum").double("scoreSumSquares");return{chromTreeParser:(new vn.Parser).endianess(g).uint32("magic").uint32("blockSize").uint32("keySize").uint32("valSize").uint64("itemCount"),totalSummaryParser:A,headerParser:C,isLeafNode:(new vn.Parser).endianess(g).uint8("isLeafNode").skip(1).uint16("cnt")}}var Ln=function(){function I(){var g=this,C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,Sn.default)(this,I),(0,Nn.default)(this,"bbi",void 0),(0,Nn.default)(this,"headerCache",new Mn.default({cache:new Un.default({maxSize:1}),fill:function(){var I=(0,Jn.default)(wn.default.mark((function I(C,A){return wn.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.abrupt("return",g._getHeader(Qn(Qn({},C),{},{signal:A})));case 1:case"end":return I.stop()}}),I)})));return function(g,C){return I.apply(this,arguments)}}()})),(0,Nn.default)(this,"renameRefSeqs",void 0);var A=C.filehandle,i=C.renameRefSeqs,e=C.path,l=C.url;if(this.renameRefSeqs=i||function(I){return I},A)this.bbi=A;else if(l)this.bbi=new kn.RemoteFile(l);else{if(!e)throw new Error("no file given");this.bbi=new kn.LocalFile(e)}}return(0,Fn.default)(I,[{key:"getHeader",value:function(){var I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},g="aborted"in I?{signal:I}:I;return this.headerCache.get(JSON.stringify(g),g,g.signal)}}]),(0,Fn.default)(I,[{key:"_getHeader",value:function(){var I=(0,Jn.default)(wn.default.mark((function I(g){var C,A;return wn.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this._getMainHeader(g);case 2:return C=I.sent,I.next=5,this._readChromTree(C,g);case 5:return A=I.sent,I.abrupt("return",Qn(Qn({},C),A));case 7:case"end":return I.stop()}}),I,this)})));return function(g){return I.apply(this,arguments)}}()},{key:"_getMainHeader",value:function(){var I=(0,Jn.default)(wn.default.mark((function I(g){var C,i,e,l,o,t,c,n=arguments;return wn.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return C=n.length>1&&void 0!==n[1]?n[1]:2e3,I.next=3,this.bbi.read(A.alloc(C),0,C,0,g);case 3:if(i=I.sent,e=i.buffer,l=this._isBigEndian(e),o=jn(l),(t=o.headerParser.parse(e).result).fileType=t.magic===On?"bigbed":"bigwig",!(t.asOffset>C||t.totalSummaryOffset>C)){I.next=11;break}return I.abrupt("return",this._getMainHeader(g,2*C));case 11:if(t.asOffset&&(t.autoSql=e.slice(t.asOffset,e.indexOf(0,t.asOffset)).toString("utf8")),!(t.totalSummaryOffset>C)){I.next=14;break}return I.abrupt("return",this._getMainHeader(g,2*C));case 14:return t.totalSummaryOffset&&(c=e.slice(t.totalSummaryOffset),t.totalSummary=o.totalSummaryParser.parse(c).result),I.abrupt("return",Qn(Qn({},t),{},{isBigEndian:l}));case 16:case"end":return I.stop()}}),I,this)})));return function(g){return I.apply(this,arguments)}}()},{key:"_isBigEndian",value:function(I){var g=I.readInt32LE(0);if(g===Pn||g===On)return!1;if((g=I.readInt32BE(0))===Pn||g===On)return!0;throw new Error("not a BigWig/BigBed file")}},{key:"_readChromTree",value:function(){var I=(0,Jn.default)(wn.default.mark((function I(g,C){var i,e,l,o,t,c,n,d,s,a,Z,m,b,r=this;return wn.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:for(i=g.isBigEndian,e=i?"big":"little",l=[],o={},t=g.chromTreeOffset,c=g.unzoomedDataOffset;c%4!==0;)c+=1;return I.next=9,this.bbi.read(A.alloc(c-t),0,c-t,t,C);case 9:return n=I.sent,d=n.buffer,s=jn(i),a=s.chromTreeParser.parse(d).result.keySize,Z=(new vn.Parser).endianess(e).string("key",{stripNull:!0,length:a}).uint32("refId").uint32("refSize"),m=(new vn.Parser).endianess(e).skip(a).uint64("childOffset"),32,b=function(){var I=(0,Jn.default)(wn.default.mark((function I(g){var C,A,i,e,c,n,a,h,G,u,y,B,V,p,X,W;return wn.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:if(!((C=g)>=d.length)){I.next=3;break}throw new Error("reading beyond end of buffer");case 3:if(A=s.isLeafNode.parse(d.slice(C)),i=A.result,e=i.isLeafNode,c=i.cnt,C+=A.offset,!e){I.next=10;break}for(n=0;n<c;n+=1)a=Z.parse(d.slice(C)),C+=a.offset,h=a.result,G=h.key,u=h.refId,y=h.refSize,B={name:G,id:u,length:y},o[r.renameRefSeqs(G)]=u,l[u]=B;I.next=14;break;case 10:for(V=[],p=0;p<c;p+=1)X=m.parse(d.slice(C)),W=X.result.childOffset,C+=X.offset,W-=t,V.push(b(W));return I.next=14,Promise.all(V);case 14:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),I.next=19,b(32);case 19:return I.abrupt("return",{refsByName:o,refsByNumber:l});case 20:case"end":return I.stop()}}),I,this)})));return function(g,C){return I.apply(this,arguments)}}()},{key:"getUnzoomedView",value:function(){var I=(0,Jn.default)(wn.default.mark((function I(g){var C,A,i,e,l,o,t,c,n;return wn.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.getHeader(g);case 2:return C=I.sent,A=C.unzoomedIndexOffset,i=C.zoomLevels,e=C.refsByName,l=C.uncompressBufSize,o=C.isBigEndian,t=C.fileType,c=i[0],n=c?c.dataOffset-A:4e3,I.abrupt("return",new xn.BlockView(this.bbi,e,A,n,o,l>0,t));case 12:case"end":return I.stop()}}),I,this)})));return function(g){return I.apply(this,arguments)}}()},{key:"getFeatureStream",value:function(){var I=(0,Jn.default)(wn.default.mark((function I(g,C,A){var i,e,l,o=arguments;return wn.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return i=o.length>3&&void 0!==o[3]?o[3]:{scale:1},I.next=3,this.getHeader(i);case 3:if(e=this.renameRefSeqs(g),!i.basesPerSpan){I.next=10;break}return I.next=7,this.getView(1/i.basesPerSpan,i);case 7:l=I.sent,I.next=19;break;case 10:if(!i.scale){I.next=16;break}return I.next=13,this.getView(i.scale,i);case 13:l=I.sent,I.next=19;break;case 16:return I.next=18,this.getView(1,i);case 18:l=I.sent;case 19:if(l){I.next=21;break}throw new Error("unable to get block view for data");case 21:return I.abrupt("return",new Dn.Observable((function(I){l.readWigData(e,C,A,I,i)})));case 22:case"end":return I.stop()}}),I,this)})));return function(g,C,A){return I.apply(this,arguments)}}()},{key:"getFeatures",value:function(){var I=(0,Jn.default)(wn.default.mark((function I(g,C,A){var i,e,l,o=arguments;return wn.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return i=o.length>3&&void 0!==o[3]?o[3]:{scale:1},I.next=3,this.getFeatureStream(g,C,A,i);case 3:return e=I.sent,I.next=6,e.pipe((0,zn.reduce)((function(I,g){return I.concat(g)}))).toPromise();case 6:return l=I.sent,I.abrupt("return",l||[]);case 8:case"end":return I.stop()}}),I,this)})));return function(g,C,A){return I.apply(this,arguments)}}()}]),I}();_i.BBI=Ln;var En=bC.exports;Object.defineProperty(mC,"__esModule",{value:!0}),mC.BigWig=void 0;var _n=En(hC),$n=En(GC.exports),qn=En(uC.exports),Id=En(yC.exports),gd=En(BC.exports),Cd=En(pC.exports),Ad=En(HC.exports),id=YC;function ed(I){var g=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(im){return!1}}();return function(){var C,A=(0,Ad.default)(I);if(g){var i=(0,Ad.default)(this).constructor;C=Reflect.construct(A,arguments,i)}else C=A.apply(this,arguments);return(0,Cd.default)(this,C)}}var ld=function(I){(0,gd.default)(C,I);var g=ed(C);function C(){return(0,qn.default)(this,C),g.apply(this,arguments)}return(0,Id.default)(C,[{key:"getView",value:function(){var I=(0,$n.default)(_n.default.mark((function I(g,C){var A,i,e,l,o,t,c,n,d,s,a;return _n.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.getHeader(C);case 2:A=I.sent,i=A.zoomLevels,e=A.refsByName,l=A.fileSize,o=A.isBigEndian,t=A.uncompressBufSize,c=1/g,n=i.length,l||(n-=1),d=n;case 12:if(!(d>=0)){I.next=20;break}if(!((s=i[d])&&s.reductionLevel<=2*c)){I.next=17;break}return a=d<i.length-1?i[d+1].dataOffset-s.indexOffset:l-4-s.indexOffset,I.abrupt("return",new id.BlockView(this.bbi,e,s.indexOffset,a,o,t>0,"summary"));case 17:d-=1,I.next=12;break;case 20:return I.abrupt("return",this.getUnzoomedView(C));case 21:case"end":return I.stop()}}),I,this)})));return function(g,C){return I.apply(this,arguments)}}()}]),C}(_i.BBI);mC.BigWig=ld;var od={},td={exports:{}},cd={exports:{}},nd={exports:{}};!function(I){I.exports=function(I,g){(null==g||g>I.length)&&(g=I.length);for(var C=0,A=new Array(g);C<g;C++)A[C]=I[C];return A},I.exports.default=I.exports,I.exports.__esModule=!0}(nd),function(I){var g=nd.exports;I.exports=function(I){if(Array.isArray(I))return g(I)},I.exports.default=I.exports,I.exports.__esModule=!0}(cd);var dd={exports:{}};!function(I){I.exports=function(I){if("undefined"!==typeof Symbol&&null!=I[Symbol.iterator]||null!=I["@@iterator"])return Array.from(I)},I.exports.default=I.exports,I.exports.__esModule=!0}(dd);var sd={exports:{}};!function(I){var g=nd.exports;I.exports=function(I,C){if(I){if("string"===typeof I)return g(I,C);var A=Object.prototype.toString.call(I).slice(8,-1);return"Object"===A&&I.constructor&&(A=I.constructor.name),"Map"===A||"Set"===A?Array.from(I):"Arguments"===A||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(A)?g(I,C):void 0}},I.exports.default=I.exports,I.exports.__esModule=!0}(sd);var ad={exports:{}};!function(I){I.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},I.exports.default=I.exports,I.exports.__esModule=!0}(ad),function(I){var g=cd.exports,C=dd.exports,A=sd.exports,i=ad.exports;I.exports=function(I){return g(I)||C(I)||A(I)||i()},I.exports.default=I.exports,I.exports.__esModule=!0}(td);var Zd=bC.exports;Object.defineProperty(od,"__esModule",{value:!0}),od.filterUndef=Jd,od.BigBed=void 0;var md=Zd(td.exports),bd=Zd(hC),rd=Zd(GC.exports),hd=Zd(uC.exports),Gd=Zd(yC.exports),ud=Zd(WC.exports),yd=Zd(BC.exports),Bd=Zd(pC.exports),Vd=Zd(HC.exports),pd=Zd(RC.exports),Xd=fC,Wd=So,Hd=fn,Yd=Zd(rA),Rd=Zd(q.a);function fd(I,g){var C=Object.keys(I);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(I);g&&(A=A.filter((function(g){return Object.getOwnPropertyDescriptor(I,g).enumerable}))),C.push.apply(C,A)}return C}function Kd(I){for(var g=1;g<arguments.length;g++){var C=null!=arguments[g]?arguments[g]:{};g%2?fd(Object(C),!0).forEach((function(g){(0,pd.default)(I,g,C[g])})):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(C)):fd(Object(C)).forEach((function(g){Object.defineProperty(I,g,Object.getOwnPropertyDescriptor(C,g))}))}return I}function wd(I){var g=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(im){return!1}}();return function(){var C,A=(0,Vd.default)(I);if(g){var i=(0,Vd.default)(this).constructor;C=Reflect.construct(A,arguments,i)}else C=A.apply(this,arguments);return(0,Bd.default)(this,C)}}function Jd(I){return I.filter((function(I){return!!I}))}var Sd=function(I){(0,yd.default)(C,I);var g=wd(C);function C(I){var A;return(0,hd.default)(this,C),A=g.call(this,I),(0,pd.default)((0,ud.default)(A),"readIndicesCache",new Yd.default({cache:new Rd.default({maxSize:1}),fill:function(){var I=(0,rd.default)(bd.default.mark((function I(g,C){return bd.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.abrupt("return",A._readIndices(Kd(Kd({},g),{},{signal:C})));case 1:case"end":return I.stop()}}),I)})));return function(g,C){return I.apply(this,arguments)}}()})),A}return(0,Gd.default)(C,[{key:"readIndices",value:function(){var I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},g="aborted"in I?{signal:I}:I;return this.readIndicesCache.get(JSON.stringify(g),g,g.signal)}},{key:"getView",value:function(){var I=(0,rd.default)(bd.default.mark((function I(g,C){return bd.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.abrupt("return",this.getUnzoomedView(C));case 1:case"end":return I.stop()}}),I,this)})));return function(g,C){return I.apply(this,arguments)}}()},{key:"_readIndices",value:function(){var I=(0,rd.default)(bd.default.mark((function I(g){var C,i,e,l,o,t,c,n,d,s,a,Z,m,b,r,h;return bd.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.getHeader(g);case 2:return C=I.sent,i=C.extHeaderOffset,e=C.isBigEndian,I.next=7,this.bbi.read(A.alloc(64),0,64,i);case 7:if(l=I.sent,o=l.buffer,t=e?"big":"little",c=(new Xd.Parser).endianess(t).uint16("size").uint16("count").uint64("offset").parse(o).result,n=c.count,d=c.offset,0!==n){I.next=14;break}return I.abrupt("return",[]);case 14:return a=(s=20)*n,I.next=18,this.bbi.read(A.alloc(a),0,a,d);case 18:for(Z=I.sent,m=Z.buffer,b=(new Xd.Parser).endianess(t).int16("type").int16("fieldcount").uint64("offset").skip(4).int16("field"),r=[],h=0;h<n;h+=1)r.push(b.parse(m.slice(h*s)).result);return I.abrupt("return",r);case 24:case"end":return I.stop()}}),I,this)})));return function(g){return I.apply(this,arguments)}}()},{key:"searchExtraIndexBlocks",value:function(){var I=(0,rd.default)(bd.default.mark((function I(g){var C,i,e,l,o,t=this,c=arguments;return bd.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return C=c.length>1&&void 0!==c[1]?c[1]:{},I.next=3,this.getHeader(C);case 3:return i=I.sent,e=i.isBigEndian,I.next=7,this.readIndices(C);case 7:if((l=I.sent).length){I.next=10;break}return I.abrupt("return",[]);case 10:return o=l.map(function(){var I=(0,rd.default)(bd.default.mark((function I(i){var l,o,c,n,d,s,a,Z,m,b,r;return bd.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return l=i.offset,o=i.field,I.next=3,t.bbi.read(A.alloc(32),0,32,l,C);case 3:return c=I.sent,n=c.buffer,d=(new Xd.Parser).endianess(e?"big":"little").int32("magic").int32("blockSize").int32("keySize").int32("valSize").uint64("itemCount"),s=d.parse(n).result,a=s.blockSize,Z=s.keySize,m=s.valSize,b=(new Xd.Parser).endianess(e?"big":"little").int8("nodeType").skip(1).int16("cnt").choice({tag:"nodeType",choices:{0:(new Xd.Parser).array("leafkeys",{length:"cnt",type:(new Xd.Parser).string("key",{length:Z,stripNull:!0}).uint64("offset")}),1:(new Xd.Parser).array("keys",{length:"cnt",type:(new Xd.Parser).string("key",{length:Z,stripNull:!0}).uint64("offset").uint32("length").uint32("reserved")})}}),r=function(){var I=(0,rd.default)(bd.default.mark((function I(i){var e,l,c,n,d,s,h,G;return bd.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return e=4+a*(Z+m),I.next=3,t.bbi.read(A.alloc(e),0,e,i,C);case 3:if(l=I.sent,c=l.buffer,!(n=b.parse(c).result).leafkeys){I.next=17;break}s=0;case 8:if(!(s<n.leafkeys.length)){I.next=16;break}if(h=n.leafkeys[s].key,!(g.localeCompare(h)<0&&d)){I.next=12;break}return I.abrupt("return",r(d));case 12:d=n.leafkeys[s].offset;case 13:s+=1,I.next=8;break;case 16:return I.abrupt("return",r(d));case 17:G=0;case 18:if(!(G<n.keys.length)){I.next=24;break}if(n.keys[G].key!==g){I.next=21;break}return I.abrupt("return",Kd(Kd({},n.keys[G]),{},{field:o}));case 21:G+=1,I.next=18;break;case 24:return I.abrupt("return",void 0);case 25:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}(),32,I.abrupt("return",r(l+32));case 11:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}()),I.t0=Jd,I.next=14,Promise.all(o);case 14:return I.t1=I.sent,I.abrupt("return",(0,I.t0)(I.t1));case 16:case"end":return I.stop()}}),I,this)})));return function(g){return I.apply(this,arguments)}}()},{key:"searchExtraIndex",value:function(){var I=(0,rd.default)(bd.default.mark((function I(g){var C,A,i,e,l,o=arguments;return bd.default.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return C=o.length>1&&void 0!==o[1]?o[1]:{},I.next=3,this.searchExtraIndexBlocks(g,C);case 3:if((A=I.sent).length){I.next=6;break}return I.abrupt("return",[]);case 6:return I.next=8,this.getUnzoomedView(C);case 8:return i=I.sent,e=A.map((function(I){return new Wd.Observable((function(g){i.readFeatures(g,[I],C)})).pipe((0,Hd.reduce)((function(I,g){return I.concat(g)})),(0,Hd.map)((function(g){for(var C=0;C<g.length;C+=1)g[C].field=I.field;return g})))})),I.next=12,Wd.merge.apply(void 0,(0,md.default)(e)).toPromise();case 12:return l=I.sent,I.abrupt("return",l.filter((function(I){return I.rest.split("\t")[I.field-3]===g})));case 14:case"end":return I.stop()}}),I,this)})));return function(g){return I.apply(this,arguments)}}()}]),C}(_i.BBI);od.BigBed=Sd,function(I){Object.defineProperty(I,"__esModule",{value:!0}),Object.defineProperty(I,"BigWig",{enumerable:!0,get:function(){return g.BigWig}}),Object.defineProperty(I,"BigBed",{enumerable:!0,get:function(){return C.BigBed}}),Object.defineProperty(I,"Feature",{enumerable:!0,get:function(){return A.Feature}}),Object.defineProperty(I,"Header",{enumerable:!0,get:function(){return A.Header}}),Object.defineProperty(I,"RequestOptions",{enumerable:!0,get:function(){return A.RequestOptions}});var g=mC,C=od,A=_i}(ZC),Object(V.a)((function(I){return I.pos})).left;var Fd=function(I){Object(a.a)(C,I);var g=Object(Z.a)(C);function C(){var I;return Object(t.a)(this,C),(I=g.apply(this,arguments)).read=function(){var g=Object(e.a)(Object(i.a)().mark((function g(C){var A,e,l,o,t,c,n,d,s,a,Z,b,r,h,G,u=arguments;return Object(i.a)().wrap((function(g){for(;;)switch(g.prev=g.next){case 0:return A=u.length>1&&void 0!==u[1]?u[1]:0,e=u.length>2?u[2]:void 0,l=u.length>3&&void 0!==u[3]?u[3]:0,o=u.length>4&&void 0!==u[4]?u[4]:{},t=o.headers,c=void 0===t?{}:t,n=o.signal,d=o.overrides,s=void 0===d?{}:d,e<1/0?c.range="bytes=".concat(l,"-").concat(l+e):e===1/0&&0!==l&&(c.range="bytes=".concat(l,"-")),a=Object(m.a)(Object(m.a)(Object(m.a)({},I.baseOverrides),s),{},{headers:Object(m.a)(Object(m.a)(Object(m.a)({},c),s.headers),I.baseOverrides.headers),method:"GET",redirect:"follow",mode:"cors",signal:n}),g.next=9,I.fetch(I.url,a);case 9:if((Z=g.sent).ok){g.next=12;break}throw new Error("HTTP ".concat(Z.status," ").concat(Z.statusText," ").concat(I.url));case 12:if(200!==Z.status&&206!==Z.status){g.next=21;break}return g.next=15,I.getBufferFromResponse(Z);case 15:return b=g.sent,r=b.copy(C,A,0,Math.min(e,b.length)),h=Z.headers.get("content-range"),(G=/\/(\d+)$/.exec(h||""))&&G[1]&&(I._stat={size:parseInt(G[1],10)}),g.abrupt("return",{bytesRead:r,buffer:C});case 21:throw new Error("HTTP ".concat(Z.status," fetching ").concat(I.url));case 22:case"end":return g.stop()}}),g)})));return function(I){return g.apply(this,arguments)}}(),I}return Object(c.a)(C)}(II.RemoteFile);function Nd(I,g){if(!(this instanceof Nd?this.constructor:void 0))throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');var C=function(){function C(){var I=this;Object(t.a)(this,C),g.chromSizesUrl="https://aveit.s3.amazonaws.com/higlass/data/sequence/hg38.chrom.sizes",this.dataConfig=g,this.bwFileHeader=null,this.bwFile=null,this.TILE_SIZE=1024,this.errorTxt="",this.dataPromises=[];var A=Qg(this.assembly).size,i=[],e={},l=0;Object.keys(Qg(this.assembly).size).forEach((function(g,C){var A={id:C,chr:g,pos:l};i.push(A),e[g]=A,l+=Qg(I.assembly).size[g]})),this.chromSizes={chrToAbs:function(g,C){return I.chromSizes.chrPositions[g].pos+C},cumPositions:i,chrPositions:e,totalLength:l,chromLengths:A},this.dataPromises.push(this.loadBBI(g))}return Object(c.a)(C,[{key:"loadBBI",value:function(I){var g=this;return I.url?(this.bwFile=new ZC.BigWig({filehandle:new Fd(I.url)}),this.bwFile.getHeader().then((function(I){g.bwFileHeader=I}))):(console.error('Please enter a "url" field to the data config'),null)}},{key:"tilesetInfo",value:function(I){var g=this;return this.tilesetInfoLoading=!0,Promise.all(this.dataPromises).then((function(){g.tilesetInfoLoading=!1;var C=g.chromSizes.totalLength,A={tile_size:g.TILE_SIZE,max_zoom:Math.ceil(Math.log(C/g.TILE_SIZE)/Math.log(2)),max_width:Math.pow(2,Math.ceil(Math.log(C)/Math.log(2))),min_pos:[0],max_pos:[C]};return I&&I(A),A})).catch((function(C){return g.tilesetInfoLoading=!1,console.error(C),I&&I({error:"Error parsing bigwig: ".concat(C)}),null}))}},{key:"fetchTilesDebounced",value:function(I,g){var C,A={},i=[],e=[],o=Object(l.a)(g);try{for(o.s();!(C=o.n()).done;){var t=C.value,c=t.split("."),n=parseInt(c[0],10),d=parseInt(c[1],10);Number.isNaN(d)||Number.isNaN(n)?console.warn("Invalid tile zoom or position:",n,d):(i.push(t),e.push(this.tile(n,d)))}}catch(s){o.e(s)}finally{o.f()}return Promise.all(e).then((function(g){for(var C=0;C<g.length;C++){var e=i[C];A[e]=g[C],A[e].tilePositionId=e}I(A)})),A}},{key:"tile",value:function(){var g=Object(e.a)(Object(i.a)().mark((function g(C,A){var e,l,o,t,c,n,d,s,a,Z,m,b,r,h=this;return Object(i.a)().wrap((function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.tilesetInfo();case 2:for(e=g.sent,l=+e.max_width/Math.pow(2,+C),o=[],t={tilePos:[A],tileId:"bigwig.".concat(C,".").concat(A),zoomLevel:C},c=e.min_pos[0]+A*l,n=c,d=e.min_pos[0]+(A+1)*l,s=this.determineScale(n,d),a=(d-n)/this.TILE_SIZE,Z=[],m=0;m<this.TILE_SIZE;m++)Z.push(n+m*a);return b=this.chromSizes,r=b.chromLengths,b.cumPositions.forEach((function(g){var C,A,i=g.chr,e=g.pos,l=g.pos+r[i];if(e<=n&&n<l){if(!(d>l)){if(C=Math.floor(n-e),A=Math.ceil(d-e),!h.bwFile)return;return void o.push(h.bwFile.getFeatures(i,C,A,{scale:1/s}).then((function(g){return g.forEach((function(g){g.startAbs=I.utils.chrToAbs(i,g.start,h.chromSizes),g.endAbs=I.utils.chrToAbs(i,g.end,h.chromSizes)})),g})))}C=n-e,A=l-e,o.push(h.bwFile.getFeatures(i,C,A,{scale:1/s}).then((function(g){return g.forEach((function(g){g.startAbs=I.utils.chrToAbs(i,g.start,h.chromSizes),g.endAbs=I.utils.chrToAbs(i,g.end,h.chromSizes)})),g}))),n=l}})),g.abrupt("return",Promise.all(o).then((function(g){for(var C=g.flat(),A=[],i=0;i<h.TILE_SIZE;i++)A.push(null);Z.forEach((function(I,g){if(!(I<c||I>d)){var i=C.filter((function(g){return I>=g.startAbs&&I<g.endAbs})).map((function(I){return I.score}));A[g]=i.length>0?i[0]:null}}));var e=new I.utils.DenseDataExtrema1D(A);return t.min_value=Math.min.apply(Math,A),t.max_value=Math.max.apply(Math,A),t.dense=A,t.denseDataExtrema=e,t.minNonZero=e.minNonZeroInTile,t.maxNonZero=e.maxNonZeroInTile,t})));case 16:case"end":return g.stop()}}),g,this)})));return function(I,C){return g.apply(this,arguments)}}()},{key:"determineScale",value:function(I,g){var C,A=this,i=[1],e=g-I;if(!this.bwFileHeader)throw Error("no bigwig header");return this.bwFileHeader.zoomLevels.forEach((function(I){i.push(I.reductionLevel)})),i.forEach((function(I){C||e/I<=20*A.TILE_SIZE&&(C=I)})),C||i.slice(-1)[0]}}]),C}();return new C}Nd.config={type:"bigwig"};var vd={exports:{}};(function(I){function g(){for(var I=arguments.length,g=Array(I),C=0;C<I;C++)g[C]=arguments[C];if(g.length>1){g[0]=g[0].slice(0,-1);for(var A=g.length-1,i=1;i<A;++i)g[i]=g[i].slice(1,-1);return g[A]=g[A].slice(1),g.join("")}return g[0]}function C(I){return"(?:"+I+")"}function A(I){return void 0===I?"undefined":null===I?"null":Object.prototype.toString.call(I).split(" ").pop().split("]").shift().toLowerCase()}function i(I){return I.toUpperCase()}function e(I){return void 0!==I&&null!==I?I instanceof Array?I:"number"!==typeof I.length||I.split||I.setInterval||I.call?[I]:Array.prototype.slice.call(I):[]}function l(I,g){var C=I;if(g)for(var A in g)C[A]=g[A];return C}function o(I){var A="[A-Za-z]",i="[0-9]",e=g(i,"[A-Fa-f]"),l=C(C("%[EFef]"+e+"%"+e+e+"%"+e+e)+"|"+C("%[89A-Fa-f]"+e+"%"+e+e)+"|"+C("%"+e+e)),o="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",t=g("[\\:\\/\\?\\#\\[\\]\\@]",o),c=I?"[\\uE000-\\uF8FF]":"[]",n=g(A,i,"[\\-\\.\\_\\~]",I?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]");C(A+g(A,i,"[\\+\\-\\.]")+"*"),C(C(l+"|"+g(n,o,"[\\:]"))+"*");var d=C(C("25[0-5]")+"|"+C("2[0-4]"+i)+"|"+C("1"+i+i)+"|"+C("0?[1-9]"+i)+"|0?0?"+i),s=C(d+"\\."+d+"\\."+d+"\\."+d),a=C(e+"{1,4}"),Z=C(C(a+"\\:"+a)+"|"+s),m=C(C(a+"\\:")+"{6}"+Z),b=C("\\:\\:"+C(a+"\\:")+"{5}"+Z),r=C(C(a)+"?\\:\\:"+C(a+"\\:")+"{4}"+Z),h=C(C(C(a+"\\:")+"{0,1}"+a)+"?\\:\\:"+C(a+"\\:")+"{3}"+Z),G=C(C(C(a+"\\:")+"{0,2}"+a)+"?\\:\\:"+C(a+"\\:")+"{2}"+Z),u=C(C(C(a+"\\:")+"{0,3}"+a)+"?\\:\\:"+a+"\\:"+Z),y=C(C(C(a+"\\:")+"{0,4}"+a)+"?\\:\\:"+Z),B=C(C(C(a+"\\:")+"{0,5}"+a)+"?\\:\\:"+a),V=C(C(C(a+"\\:")+"{0,6}"+a)+"?\\:\\:"),p=C([m,b,r,h,G,u,y,B,V].join("|")),X=C(C(n+"|"+l)+"+");C("[vV]"+e+"+\\."+g(n,o,"[\\:]")+"+"),C(C(l+"|"+g(n,o))+"*");var W=C(l+"|"+g(n,o,"[\\:\\@]"));return C(C(l+"|"+g(n,o,"[\\@]"))+"+"),C(C(W+"|"+g("[\\/\\?]",c))+"*"),{NOT_SCHEME:new RegExp(g("[^]",A,i,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(g("[^\\%\\:]",n,o),"g"),NOT_HOST:new RegExp(g("[^\\%\\[\\]\\:]",n,o),"g"),NOT_PATH:new RegExp(g("[^\\%\\/\\:\\@]",n,o),"g"),NOT_PATH_NOSCHEME:new RegExp(g("[^\\%\\/\\@]",n,o),"g"),NOT_QUERY:new RegExp(g("[^\\%]",n,o,"[\\:\\@\\/\\?]",c),"g"),NOT_FRAGMENT:new RegExp(g("[^\\%]",n,o,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(g("[^]",n,o),"g"),UNRESERVED:new RegExp(n,"g"),OTHER_CHARS:new RegExp(g("[^\\%]",n,t),"g"),PCT_ENCODED:new RegExp(l,"g"),IPV4ADDRESS:new RegExp("^("+s+")$"),IPV6ADDRESS:new RegExp("^\\[?("+p+")"+C(C("\\%25|\\%(?!"+e+"{2})")+"("+X+")")+"?\\]?$")}}var t=o(!1),c=o(!0),n=function(){function I(I,g){var C=[],A=!0,i=!1,e=void 0;try{for(var l,o=I[Symbol.iterator]();!(A=(l=o.next()).done)&&(C.push(l.value),!g||C.length!==g);A=!0);}catch(t){i=!0,e=t}finally{try{!A&&o.return&&o.return()}finally{if(i)throw e}}return C}return function(g,C){if(Array.isArray(g))return g;if(Symbol.iterator in Object(g))return I(g,C);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(I){if(Array.isArray(I)){for(var g=0,C=Array(I.length);g<I.length;g++)C[g]=I[g];return C}return Array.from(I)},s=2147483647,a=36,Z=1,m=26,b=38,r=700,h=72,G=128,u="-",y=/^xn--/,B=/[^\0-\x7E]/,V=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},X=a-Z,W=Math.floor,H=String.fromCharCode;function Y(I){throw new RangeError(p[I])}function R(I,g){for(var C=[],A=I.length;A--;)C[A]=g(I[A]);return C}function f(I,g){var C=I.split("@"),A="";return C.length>1&&(A=C[0]+"@",I=C[1]),A+R((I=I.replace(V,".")).split("."),g).join(".")}function K(I){for(var g=[],C=0,A=I.length;C<A;){var i=I.charCodeAt(C++);if(i>=55296&&i<=56319&&C<A){var e=I.charCodeAt(C++);56320==(64512&e)?g.push(((1023&i)<<10)+(1023&e)+65536):(g.push(i),C--)}else g.push(i)}return g}var w=function(I){return I-48<10?I-22:I-65<26?I-65:I-97<26?I-97:a},J=function(I,g){return I+22+75*(I<26)-((0!=g)<<5)},S=function(I,g,C){var A=0;for(I=C?W(I/r):I>>1,I+=W(I/g);I>X*m>>1;A+=a)I=W(I/X);return W(A+(X+1)*I/(I+b))},F=function(I){var g=[],C=I.length,A=0,i=G,e=h,l=I.lastIndexOf(u);l<0&&(l=0);for(var o=0;o<l;++o)I.charCodeAt(o)>=128&&Y("not-basic"),g.push(I.charCodeAt(o));for(var t=l>0?l+1:0;t<C;){for(var c=A,n=1,d=a;;d+=a){t>=C&&Y("invalid-input");var b=w(I.charCodeAt(t++));(b>=a||b>W((s-A)/n))&&Y("overflow"),A+=b*n;var r=d<=e?Z:d>=e+m?m:d-e;if(b<r)break;var y=a-r;n>W(s/y)&&Y("overflow"),n*=y}var B=g.length+1;e=S(A-c,B,0==c),W(A/B)>s-i&&Y("overflow"),i+=W(A/B),A%=B,g.splice(A++,0,i)}return String.fromCodePoint.apply(String,g)},N=function(I){var g=[],C=(I=K(I)).length,A=G,i=0,e=h,l=!0,o=!1,t=void 0;try{for(var c,n=I[Symbol.iterator]();!(l=(c=n.next()).done);l=!0){var d=c.value;d<128&&g.push(H(d))}}catch(P){o=!0,t=P}finally{try{!l&&n.return&&n.return()}finally{if(o)throw t}}var b=g.length,r=b;for(b&&g.push(u);r<C;){var y=s,B=!0,V=!1,p=void 0;try{for(var X,R=I[Symbol.iterator]();!(B=(X=R.next()).done);B=!0){var f=X.value;f>=A&&f<y&&(y=f)}}catch(P){V=!0,p=P}finally{try{!B&&R.return&&R.return()}finally{if(V)throw p}}var w=r+1;y-A>W((s-i)/w)&&Y("overflow"),i+=(y-A)*w,A=y;var F=!0,N=!1,v=void 0;try{for(var k,D=I[Symbol.iterator]();!(F=(k=D.next()).done);F=!0){var z=k.value;if(z<A&&++i>s&&Y("overflow"),z==A){for(var M=i,U=a;;U+=a){var x=U<=e?Z:U>=e+m?m:U-e;if(M<x)break;var T=M-x,Q=a-x;g.push(H(J(x+T%Q,0))),M=W(T/Q)}g.push(H(J(M,0))),e=S(i,w,r==b),i=0,++r}}}catch(P){N=!0,v=P}finally{try{!F&&D.return&&D.return()}finally{if(N)throw v}}++i,++A}return g.join("")},v=function(I){return f(I,(function(I){return y.test(I)?F(I.slice(4).toLowerCase()):I}))},k=function(I){return f(I,(function(I){return B.test(I)?"xn--"+N(I):I}))},D={version:"2.1.0",ucs2:{decode:K,encode:function(I){return String.fromCodePoint.apply(String,d(I))}},decode:F,encode:N,toASCII:k,toUnicode:v},z={};function M(I){var g=I.charCodeAt(0);return g<16?"%0"+g.toString(16).toUpperCase():g<128?"%"+g.toString(16).toUpperCase():g<2048?"%"+(g>>6|192).toString(16).toUpperCase()+"%"+(63&g|128).toString(16).toUpperCase():"%"+(g>>12|224).toString(16).toUpperCase()+"%"+(g>>6&63|128).toString(16).toUpperCase()+"%"+(63&g|128).toString(16).toUpperCase()}function U(I){for(var g="",C=0,A=I.length;C<A;){var i=parseInt(I.substr(C+1,2),16);if(i<128)g+=String.fromCharCode(i),C+=3;else if(i>=194&&i<224){if(A-C>=6){var e=parseInt(I.substr(C+4,2),16);g+=String.fromCharCode((31&i)<<6|63&e)}else g+=I.substr(C,6);C+=6}else if(i>=224){if(A-C>=9){var l=parseInt(I.substr(C+4,2),16),o=parseInt(I.substr(C+7,2),16);g+=String.fromCharCode((15&i)<<12|(63&l)<<6|63&o)}else g+=I.substr(C,9);C+=9}else g+=I.substr(C,3),C+=3}return g}function x(I,g){function C(I){var C=U(I);return C.match(g.UNRESERVED)?C:I}return I.scheme&&(I.scheme=String(I.scheme).replace(g.PCT_ENCODED,C).toLowerCase().replace(g.NOT_SCHEME,"")),void 0!==I.userinfo&&(I.userinfo=String(I.userinfo).replace(g.PCT_ENCODED,C).replace(g.NOT_USERINFO,M).replace(g.PCT_ENCODED,i)),void 0!==I.host&&(I.host=String(I.host).replace(g.PCT_ENCODED,C).toLowerCase().replace(g.NOT_HOST,M).replace(g.PCT_ENCODED,i)),void 0!==I.path&&(I.path=String(I.path).replace(g.PCT_ENCODED,C).replace(I.scheme?g.NOT_PATH:g.NOT_PATH_NOSCHEME,M).replace(g.PCT_ENCODED,i)),void 0!==I.query&&(I.query=String(I.query).replace(g.PCT_ENCODED,C).replace(g.NOT_QUERY,M).replace(g.PCT_ENCODED,i)),void 0!==I.fragment&&(I.fragment=String(I.fragment).replace(g.PCT_ENCODED,C).replace(g.NOT_FRAGMENT,M).replace(g.PCT_ENCODED,i)),I}function T(I){return I.replace(/^0*(.*)/,"$1")||"0"}function Q(I,g){var C=I.match(g.IPV4ADDRESS)||[],A=n(C,2)[1];return A?A.split(".").map(T).join("."):I}function P(I,g){var C=I.match(g.IPV6ADDRESS)||[],A=n(C,3),i=A[1],e=A[2];if(i){for(var l=i.toLowerCase().split("::").reverse(),o=n(l,2),t=o[0],c=o[1],d=c?c.split(":").map(T):[],s=t.split(":").map(T),a=g.IPV4ADDRESS.test(s[s.length-1]),Z=a?7:8,m=s.length-Z,b=Array(Z),r=0;r<Z;++r)b[r]=d[r]||s[m+r]||"";a&&(b[Z-1]=Q(b[Z-1],g));var h=b.reduce((function(I,g,C){if(!g||"0"===g){var A=I[I.length-1];A&&A.index+A.length===C?A.length++:I.push({index:C,length:1})}return I}),[]).sort((function(I,g){return g.length-I.length}))[0],G=void 0;if(h&&h.length>1){var u=b.slice(0,h.index),y=b.slice(h.index+h.length);G=u.join(":")+"::"+y.join(":")}else G=b.join(":");return e&&(G+="%"+e),G}return I}var O=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,j=void 0==="".match(/(){0}/)[1];function L(I){var g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C={},A=!1!==g.iri?c:t;"suffix"===g.reference&&(I=(g.scheme?g.scheme+":":"")+"//"+I);var i=I.match(O);if(i){j?(C.scheme=i[1],C.userinfo=i[3],C.host=i[4],C.port=parseInt(i[5],10),C.path=i[6]||"",C.query=i[7],C.fragment=i[8],isNaN(C.port)&&(C.port=i[5])):(C.scheme=i[1]||void 0,C.userinfo=-1!==I.indexOf("@")?i[3]:void 0,C.host=-1!==I.indexOf("//")?i[4]:void 0,C.port=parseInt(i[5],10),C.path=i[6]||"",C.query=-1!==I.indexOf("?")?i[7]:void 0,C.fragment=-1!==I.indexOf("#")?i[8]:void 0,isNaN(C.port)&&(C.port=I.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?i[4]:void 0)),C.host&&(C.host=P(Q(C.host,A),A)),void 0!==C.scheme||void 0!==C.userinfo||void 0!==C.host||void 0!==C.port||C.path||void 0!==C.query?void 0===C.scheme?C.reference="relative":void 0===C.fragment?C.reference="absolute":C.reference="uri":C.reference="same-document",g.reference&&"suffix"!==g.reference&&g.reference!==C.reference&&(C.error=C.error||"URI is not a "+g.reference+" reference.");var e=z[(g.scheme||C.scheme||"").toLowerCase()];if(g.unicodeSupport||e&&e.unicodeSupport)x(C,A);else{if(C.host&&(g.domainHost||e&&e.domainHost))try{C.host=D.toASCII(C.host.replace(A.PCT_ENCODED,U).toLowerCase())}catch(im){C.error=C.error||"Host's domain name can not be converted to ASCII via punycode: "+im}x(C,t)}e&&e.parse&&e.parse(C,g)}else C.error=C.error||"URI can not be parsed.";return C}function E(I,g){var C=!1!==g.iri?c:t,A=[];return void 0!==I.userinfo&&(A.push(I.userinfo),A.push("@")),void 0!==I.host&&A.push(P(Q(String(I.host),C),C).replace(C.IPV6ADDRESS,(function(I,g,C){return"["+g+(C?"%25"+C:"")+"]"}))),"number"!==typeof I.port&&"string"!==typeof I.port||(A.push(":"),A.push(String(I.port))),A.length?A.join(""):void 0}var _=/^\.\.?\//,$=/^\/\.(\/|$)/,q=/^\/\.\.(\/|$)/,II=/^\/?(?:.|\n)*?(?=\/|$)/;function gI(I){for(var g=[];I.length;)if(I.match(_))I=I.replace(_,"");else if(I.match($))I=I.replace($,"/");else if(I.match(q))I=I.replace(q,"/"),g.pop();else if("."===I||".."===I)I="";else{var C=I.match(II);if(!C)throw new Error("Unexpected dot segment condition");var A=C[0];I=I.slice(A.length),g.push(A)}return g.join("")}function CI(I){var g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=g.iri?c:t,A=[],i=z[(g.scheme||I.scheme||"").toLowerCase()];if(i&&i.serialize&&i.serialize(I,g),I.host)if(C.IPV6ADDRESS.test(I.host));else if(g.domainHost||i&&i.domainHost)try{I.host=g.iri?D.toUnicode(I.host):D.toASCII(I.host.replace(C.PCT_ENCODED,U).toLowerCase())}catch(im){I.error=I.error||"Host's domain name can not be converted to "+(g.iri?"Unicode":"ASCII")+" via punycode: "+im}x(I,C),"suffix"!==g.reference&&I.scheme&&(A.push(I.scheme),A.push(":"));var e=E(I,g);if(void 0!==e&&("suffix"!==g.reference&&A.push("//"),A.push(e),I.path&&"/"!==I.path.charAt(0)&&A.push("/")),void 0!==I.path){var l=I.path;g.absolutePath||i&&i.absolutePath||(l=gI(l)),void 0===e&&(l=l.replace(/^\/\//,"/%2F")),A.push(l)}return void 0!==I.query&&(A.push("?"),A.push(I.query)),void 0!==I.fragment&&(A.push("#"),A.push(I.fragment)),A.join("")}function AI(I,g){var C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},A={};return arguments[3]||(I=L(CI(I,C),C),g=L(CI(g,C),C)),!(C=C||{}).tolerant&&g.scheme?(A.scheme=g.scheme,A.userinfo=g.userinfo,A.host=g.host,A.port=g.port,A.path=gI(g.path||""),A.query=g.query):(void 0!==g.userinfo||void 0!==g.host||void 0!==g.port?(A.userinfo=g.userinfo,A.host=g.host,A.port=g.port,A.path=gI(g.path||""),A.query=g.query):(g.path?("/"===g.path.charAt(0)?A.path=gI(g.path):(void 0===I.userinfo&&void 0===I.host&&void 0===I.port||I.path?I.path?A.path=I.path.slice(0,I.path.lastIndexOf("/")+1)+g.path:A.path=g.path:A.path="/"+g.path,A.path=gI(A.path)),A.query=g.query):(A.path=I.path,void 0!==g.query?A.query=g.query:A.query=I.query),A.userinfo=I.userinfo,A.host=I.host,A.port=I.port),A.scheme=I.scheme),A.fragment=g.fragment,A}function iI(I,g,C){var A=l({scheme:"null"},C);return CI(AI(L(I,A),L(g,A),A,!0),A)}function eI(I,g){return"string"===typeof I?I=CI(L(I,g),g):"object"===A(I)&&(I=L(CI(I,g),g)),I}function lI(I,g,C){return"string"===typeof I?I=CI(L(I,C),C):"object"===A(I)&&(I=CI(I,C)),"string"===typeof g?g=CI(L(g,C),C):"object"===A(g)&&(g=CI(g,C)),I===g}function oI(I,g){return I&&I.toString().replace(g&&g.iri?c.ESCAPE:t.ESCAPE,M)}function tI(I,g){return I&&I.toString().replace(g&&g.iri?c.PCT_ENCODED:t.PCT_ENCODED,U)}var cI={scheme:"http",domainHost:!0,parse:function(I,g){return I.host||(I.error=I.error||"HTTP URIs must have a host."),I},serialize:function(I,g){var C="https"===String(I.scheme).toLowerCase();return I.port!==(C?443:80)&&""!==I.port||(I.port=void 0),I.path||(I.path="/"),I}},nI={scheme:"https",domainHost:cI.domainHost,parse:cI.parse,serialize:cI.serialize};function dI(I){return"boolean"===typeof I.secure?I.secure:"wss"===String(I.scheme).toLowerCase()}var sI={scheme:"ws",domainHost:!0,parse:function(I,g){var C=I;return C.secure=dI(C),C.resourceName=(C.path||"/")+(C.query?"?"+C.query:""),C.path=void 0,C.query=void 0,C},serialize:function(I,g){if(I.port!==(dI(I)?443:80)&&""!==I.port||(I.port=void 0),"boolean"===typeof I.secure&&(I.scheme=I.secure?"wss":"ws",I.secure=void 0),I.resourceName){var C=I.resourceName.split("?"),A=n(C,2),i=A[0],e=A[1];I.path=i&&"/"!==i?i:void 0,I.query=e,I.resourceName=void 0}return I.fragment=void 0,I}},aI={scheme:"wss",domainHost:sI.domainHost,parse:sI.parse,serialize:sI.serialize},ZI={},mI="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",bI="[0-9A-Fa-f]",rI=C(C("%[EFef]"+bI+"%"+bI+bI+"%"+bI+bI)+"|"+C("%[89A-Fa-f]"+bI+"%"+bI+bI)+"|"+C("%"+bI+bI)),hI="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",GI=g("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),uI="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",yI=new RegExp(mI,"g"),BI=new RegExp(rI,"g"),VI=new RegExp(g("[^]",hI,"[\\.]",'[\\"]',GI),"g"),pI=new RegExp(g("[^]",mI,uI),"g"),XI=pI;function WI(I){var g=U(I);return g.match(yI)?g:I}var HI={scheme:"mailto",parse:function(I,g){var C=I,A=C.to=C.path?C.path.split(","):[];if(C.path=void 0,C.query){for(var i=!1,e={},l=C.query.split("&"),o=0,t=l.length;o<t;++o){var c=l[o].split("=");switch(c[0]){case"to":for(var n=c[1].split(","),d=0,s=n.length;d<s;++d)A.push(n[d]);break;case"subject":C.subject=tI(c[1],g);break;case"body":C.body=tI(c[1],g);break;default:i=!0,e[tI(c[0],g)]=tI(c[1],g)}}i&&(C.headers=e)}C.query=void 0;for(var a=0,Z=A.length;a<Z;++a){var m=A[a].split("@");if(m[0]=tI(m[0]),g.unicodeSupport)m[1]=tI(m[1],g).toLowerCase();else try{m[1]=D.toASCII(tI(m[1],g).toLowerCase())}catch(im){C.error=C.error||"Email address's domain name can not be converted to ASCII via punycode: "+im}A[a]=m.join("@")}return C},serialize:function(I,g){var C=I,A=e(I.to);if(A){for(var l=0,o=A.length;l<o;++l){var t=String(A[l]),c=t.lastIndexOf("@"),n=t.slice(0,c).replace(BI,WI).replace(BI,i).replace(VI,M),d=t.slice(c+1);try{d=g.iri?D.toUnicode(d):D.toASCII(tI(d,g).toLowerCase())}catch(im){C.error=C.error||"Email address's domain name can not be converted to "+(g.iri?"Unicode":"ASCII")+" via punycode: "+im}A[l]=n+"@"+d}C.path=A.join(",")}var s=I.headers=I.headers||{};I.subject&&(s.subject=I.subject),I.body&&(s.body=I.body);var a=[];for(var Z in s)s[Z]!==ZI[Z]&&a.push(Z.replace(BI,WI).replace(BI,i).replace(pI,M)+"="+s[Z].replace(BI,WI).replace(BI,i).replace(XI,M));return a.length&&(C.query=a.join("&")),C}},YI=/^([^\:]+)\:(.*)/,RI={scheme:"urn",parse:function(I,g){var C=I.path&&I.path.match(YI),A=I;if(C){var i=g.scheme||A.scheme||"urn",e=C[1].toLowerCase(),l=C[2],o=i+":"+(g.nid||e),t=z[o];A.nid=e,A.nss=l,A.path=void 0,t&&(A=t.parse(A,g))}else A.error=A.error||"URN can not be parsed.";return A},serialize:function(I,g){var C=g.scheme||I.scheme||"urn",A=I.nid,i=C+":"+(g.nid||A),e=z[i];e&&(I=e.serialize(I,g));var l=I,o=I.nss;return l.path=(A||g.nid)+":"+o,l}},fI=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,KI={scheme:"urn:uuid",parse:function(I,g){var C=I;return C.uuid=C.nss,C.nss=void 0,g.tolerant||C.uuid&&C.uuid.match(fI)||(C.error=C.error||"UUID is not valid."),C},serialize:function(I,g){var C=I;return C.nss=(I.uuid||"").toLowerCase(),C}};z[cI.scheme]=cI,z[nI.scheme]=nI,z[sI.scheme]=sI,z[aI.scheme]=aI,z[HI.scheme]=HI,z[RI.scheme]=RI,z[KI.scheme]=KI,I.SCHEMES=z,I.pctEncChar=M,I.pctDecChars=U,I.parse=L,I.removeDotSegments=gI,I.serialize=CI,I.resolveComponents=AI,I.resolve=iI,I.normalize=eI,I.equal=lI,I.escapeComponent=oI,I.unescapeComponent=tI,Object.defineProperty(I,"__esModule",{value:!0})})(vd.exports);var kd=function I(g,C){if(g===C)return!0;if(g&&C&&"object"==typeof g&&"object"==typeof C){if(g.constructor!==C.constructor)return!1;var A,i,e;if(Array.isArray(g)){if((A=g.length)!=C.length)return!1;for(i=A;0!==i--;)if(!I(g[i],C[i]))return!1;return!0}if(g.constructor===RegExp)return g.source===C.source&&g.flags===C.flags;if(g.valueOf!==Object.prototype.valueOf)return g.valueOf()===C.valueOf();if(g.toString!==Object.prototype.toString)return g.toString()===C.toString();if((A=(e=Object.keys(g)).length)!==Object.keys(C).length)return!1;for(i=A;0!==i--;)if(!Object.prototype.hasOwnProperty.call(C,e[i]))return!1;for(i=A;0!==i--;){var l=e[i];if(!I(g[l],C[l]))return!1}return!0}return g!==g&&C!==C},Dd={copy:function(I,g){for(var C in g=g||{},I)g[C]=I[C];return g},checkDataType:zd,checkDataTypes:function(I,g,C){if(1===I.length)return zd(I[0],g,C,!0);var A="",i=Ud(I);for(var e in i.array&&i.object&&(A=i.null?"(":"(!"+g+" || ",A+="typeof "+g+' !== "object")',delete i.null,delete i.array,delete i.object),i.number&&delete i.integer,i)A+=(A?" && ":"")+zd(e,g,C,!0);return A},coerceToTypes:function(I,g){if(Array.isArray(g)){for(var C=[],A=0;A<g.length;A++){var i=g[A];(Md[i]||"array"===I&&"array"===i)&&(C[C.length]=i)}if(C.length)return C}else{if(Md[g])return[g];if("array"===I&&"array"===g)return["array"]}},toHash:Ud,getProperty:Qd,escapeQuotes:Pd,equal:kd,ucs2length:function(I){for(var g,C=0,A=I.length,i=0;i<A;)C++,(g=I.charCodeAt(i++))>=55296&&g<=56319&&i<A&&56320==(64512&(g=I.charCodeAt(i)))&&i++;return C},varOccurences:function(I,g){g+="[^0-9]";var C=I.match(new RegExp(g,"g"));return C?C.length:0},varReplace:function(I,g,C){return g+="([^0-9])",C=C.replace(/\$/g,"$$$$"),I.replace(new RegExp(g,"g"),C+"$1")},schemaHasRules:function(I,g){if("boolean"==typeof I)return!I;for(var C in I)if(g[C])return!0},schemaHasRulesExcept:function(I,g,C){if("boolean"==typeof I)return!I&&"not"!=C;for(var A in I)if(A!=C&&g[A])return!0},schemaUnknownRules:function(I,g){if("boolean"==typeof I)return;for(var C in I)if(!g[C])return C},toQuotedString:Od,getPathExpr:function(I,g,C,A){return Ed(I,C?"'/' + "+g+(A?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):A?"'[' + "+g+" + ']'":"'[\\'' + "+g+" + '\\']'")},getPath:function(I,g,C){var A=Od(C?"/"+_d(g):Qd(g));return Ed(I,A)},getData:function(I,g,C){var A,i,e,l;if(""===I)return"rootData";if("/"==I[0]){if(!jd.test(I))throw new Error("Invalid JSON-pointer: "+I);i=I,e="rootData"}else{if(!(l=I.match(Ld)))throw new Error("Invalid JSON-pointer: "+I);if(A=+l[1],"#"==(i=l[2])){if(A>=g)throw new Error("Cannot access property/index "+A+" levels up, current level is "+g);return C[g-A]}if(A>g)throw new Error("Cannot access data "+A+" levels up, current level is "+g);if(e="data"+(g-A||""),!i)return e}for(var o=e,t=i.split("/"),c=0;c<t.length;c++){var n=t[c];n&&(e+=Qd($d(n)),o+=" && "+e)}return o},unescapeFragment:function(I){return $d(decodeURIComponent(I))},unescapeJsonPointer:$d,escapeFragment:function(I){return encodeURIComponent(_d(I))},escapeJsonPointer:_d};function zd(I,g,C,A){var i=A?" !== ":" === ",e=A?" || ":" && ",l=A?"!":"",o=A?"":"!";switch(I){case"null":return g+i+"null";case"array":return l+"Array.isArray("+g+")";case"object":return"("+l+g+e+"typeof "+g+i+'"object"'+e+o+"Array.isArray("+g+"))";case"integer":return"(typeof "+g+i+'"number"'+e+o+"("+g+" % 1)"+e+g+i+g+(C?e+l+"isFinite("+g+")":"")+")";case"number":return"(typeof "+g+i+'"'+I+'"'+(C?e+l+"isFinite("+g+")":"")+")";default:return"typeof "+g+i+'"'+I+'"'}}var Md=Ud(["string","number","integer","boolean","null"]);function Ud(I){for(var g={},C=0;C<I.length;C++)g[I[C]]=!0;return g}var xd=/^[a-z$_][a-z$_0-9]*$/i,Td=/'|\\/g;function Qd(I){return"number"==typeof I?"["+I+"]":xd.test(I)?"."+I:"['"+Pd(I)+"']"}function Pd(I){return I.replace(Td,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function Od(I){return"'"+Pd(I)+"'"}var jd=/^\/(?:[^~]|~0|~1)*$/,Ld=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function Ed(I,g){return'""'==I?g:(I+" + "+g).replace(/([^\\])' \+ '/g,"$1")}function _d(I){return I.replace(/~/g,"~0").replace(/\//g,"~1")}function $d(I){return I.replace(/~1/g,"/").replace(/~0/g,"~")}var qd=Dd,Is=function(I){qd.copy(I,this)};var gs={exports:{}},Cs=gs.exports=function(I,g,C){"function"==typeof g&&(C=g,g={}),As(g,"function"==typeof(C=g.cb||C)?C:C.pre||function(){},C.post||function(){},I,"",I)};function As(I,g,C,A,i,e,l,o,t,c){if(A&&"object"==typeof A&&!Array.isArray(A)){for(var n in g(A,i,e,l,o,t,c),A){var d=A[n];if(Array.isArray(d)){if(n in Cs.arrayKeywords)for(var s=0;s<d.length;s++)As(I,g,C,d[s],i+"/"+n+"/"+s,e,i,n,A,s)}else if(n in Cs.propsKeywords){if(d&&"object"==typeof d)for(var a in d)As(I,g,C,d[a],i+"/"+n+"/"+a.replace(/~/g,"~0").replace(/\//g,"~1"),e,i,n,A,a)}else(n in Cs.keywords||I.allKeys&&!(n in Cs.skipKeywords))&&As(I,g,C,d,i+"/"+n,e,i,n,A)}C(A,i,e,l,o,t,c)}}Cs.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},Cs.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},Cs.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},Cs.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};var is=vd.exports,es=kd,ls=Dd,os=Is,ts=gs.exports,cs=ns;function ns(I,g,C){var A=this._refs[C];if("string"==typeof A){if(!this._refs[A])return ns.call(this,I,g,A);A=this._refs[A]}if((A=A||this._schemas[C])instanceof os)return bs(A.schema,this._opts.inlineRefs)?A.schema:A.validate||this._compile(A);var i,e,l,o=ds.call(this,g,C);return o&&(i=o.schema,g=o.root,l=o.baseId),i instanceof os?e=i.validate||I.call(this,i.schema,g,void 0,l):void 0!==i&&(e=bs(i,this._opts.inlineRefs)?i:I.call(this,i,g,void 0,l)),e}function ds(I,g){var C=is.parse(g),A=us(C),i=Gs(this._getId(I.schema));if(0===Object.keys(I.schema).length||A!==i){var e=Bs(A),l=this._refs[e];if("string"==typeof l)return ss.call(this,I,l,C);if(l instanceof os)l.validate||this._compile(l),I=l;else{if(!((l=this._schemas[e])instanceof os))return;if(l.validate||this._compile(l),e==Bs(g))return{schema:l,root:I,baseId:i};I=l}if(!I.schema)return;i=Gs(this._getId(I.schema))}return Zs.call(this,C,i,I.schema,I)}function ss(I,g,C){var A=ds.call(this,I,g);if(A){var i=A.schema,e=A.baseId;I=A.root;var l=this._getId(i);return l&&(e=Vs(e,l)),Zs.call(this,C,e,i,I)}}ns.normalizeId=Bs,ns.fullPath=Gs,ns.url=Vs,ns.ids=function(I){var g=Bs(this._getId(I)),C={"":g},A={"":Gs(g,!1)},i={},e=this;return ts(I,{allKeys:!0},(function(I,g,l,o,t,c,n){if(""!==g){var d=e._getId(I),s=C[o],a=A[o]+"/"+t;if(void 0!==n&&(a+="/"+("number"==typeof n?n:ls.escapeFragment(n))),"string"==typeof d){d=s=Bs(s?is.resolve(s,d):d);var Z=e._refs[d];if("string"==typeof Z&&(Z=e._refs[Z]),Z&&Z.schema){if(!es(I,Z.schema))throw new Error('id "'+d+'" resolves to more than one schema')}else if(d!=Bs(a))if("#"==d[0]){if(i[d]&&!es(I,i[d]))throw new Error('id "'+d+'" resolves to more than one schema');i[d]=I}else e._refs[d]=a}C[g]=s,A[g]=a}})),i},ns.inlineRef=bs,ns.schema=ds;var as=ls.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function Zs(I,g,C,A){if(I.fragment=I.fragment||"","/"==I.fragment.slice(0,1)){for(var i=I.fragment.split("/"),e=1;e<i.length;e++){var l=i[e];if(l){if(void 0===(C=C[l=ls.unescapeFragment(l)]))break;var o;if(!as[l]&&((o=this._getId(C))&&(g=Vs(g,o)),C.$ref)){var t=Vs(g,C.$ref),c=ds.call(this,A,t);c&&(C=c.schema,A=c.root,g=c.baseId)}}}return void 0!==C&&C!==A.schema?{schema:C,root:A,baseId:g}:void 0}}var ms=ls.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function bs(I,g){return!1!==g&&(void 0===g||!0===g?rs(I):g?hs(I)<=g:void 0)}function rs(I){var g;if(Array.isArray(I)){for(var C=0;C<I.length;C++)if("object"==typeof(g=I[C])&&!rs(g))return!1}else for(var A in I){if("$ref"==A)return!1;if("object"==typeof(g=I[A])&&!rs(g))return!1}return!0}function hs(I){var g,C=0;if(Array.isArray(I)){for(var A=0;A<I.length;A++)if("object"==typeof(g=I[A])&&(C+=hs(g)),C==1/0)return 1/0}else for(var i in I){if("$ref"==i)return 1/0;if(ms[i])C++;else if("object"==typeof(g=I[i])&&(C+=hs(g)+1),C==1/0)return 1/0}return C}function Gs(I,g){return!1!==g&&(I=Bs(I)),us(is.parse(I))}function us(I){return is.serialize(I).split("#")[0]+"#"}var ys=/#\/?$/;function Bs(I){return I?I.replace(ys,""):""}function Vs(I,g){return g=Bs(g),is.resolve(I,g)}var ps=cs,Xs={Validation:Hs((function(I){this.message="validation failed",this.errors=I,this.ajv=this.validation=!0})),MissingRef:Hs(Ws)};function Ws(I,g,C){this.message=C||Ws.message(I,g),this.missingRef=ps.url(I,g),this.missingSchema=ps.normalizeId(ps.fullPath(this.missingRef))}function Hs(I){return I.prototype=Object.create(Error.prototype),I.prototype.constructor=I,I}Ws.message=function(I,g){return"can't resolve reference "+g+" from id "+I};var Ys=function(I,g){g||(g={}),"function"===typeof g&&(g={cmp:g});var C,A="boolean"===typeof g.cycles&&g.cycles,i=g.cmp&&(C=g.cmp,function(I){return function(g,A){var i={key:g,value:I[g]},e={key:A,value:I[A]};return C(i,e)}}),e=[];return function I(g){if(g&&g.toJSON&&"function"===typeof g.toJSON&&(g=g.toJSON()),void 0!==g){if("number"==typeof g)return isFinite(g)?""+g:"null";if("object"!==typeof g)return JSON.stringify(g);var C,l;if(Array.isArray(g)){for(l="[",C=0;C<g.length;C++)C&&(l+=","),l+=I(g[C])||"null";return l+"]"}if(null===g)return"null";if(-1!==e.indexOf(g)){if(A)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var o=e.push(g)-1,t=Object.keys(g).sort(i&&i(g));for(l="",C=0;C<t.length;C++){var c=t[C],n=I(g[c]);n&&(l&&(l+=","),l+=JSON.stringify(c)+":"+n)}return e.splice(o,1),"{"+l+"}"}}(I)},Rs=function(I,g,C){var A="",i=!0===I.schema.$async,e=I.util.schemaHasRulesExcept(I.schema,I.RULES.all,"$ref"),l=I.self._getId(I.schema);if(I.opts.strictKeywords){var o=I.util.schemaUnknownRules(I.schema,I.RULES.keywords);if(o){var t="unknown keyword: "+o;if("log"!==I.opts.strictKeywords)throw new Error(t);I.logger.warn(t)}}if(I.isTop&&(A+=" var validate = ",i&&(I.async=!0,A+="async "),A+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",l&&(I.opts.sourceCode||I.opts.processCode)&&(A+=" /*# sourceURL="+l+" */ ")),"boolean"==typeof I.schema||!e&&!I.schema.$ref){g="false schema";var c=I.level,n=I.dataLevel,d=I.schema[g],s=I.schemaPath+I.util.getProperty(g),a=I.errSchemaPath+"/"+g,Z=!I.opts.allErrors,m="data"+(n||""),b="valid"+c;if(!1===I.schema){I.isTop?Z=!0:A+=" var "+b+" = false; ",(E=E||[]).push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'false schema' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(a)+" , params: {} ",!1!==I.opts.messages&&(A+=" , message: 'boolean schema is false' "),I.opts.verbose&&(A+=" , schema: false , parentSchema: validate.schema"+I.schemaPath+" , data: "+m+" "),A+=" } "):A+=" {} ";var r=A;A=E.pop(),!I.compositeRule&&Z?I.async?A+=" throw new ValidationError(["+r+"]); ":A+=" validate.errors = ["+r+"]; return false; ":A+=" var err = "+r+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else I.isTop?A+=i?" return data; ":" validate.errors = null; return true; ":A+=" var "+b+" = true; ";return I.isTop&&(A+=" }; return validate; "),A}if(I.isTop){var h=I.isTop;c=I.level=0,n=I.dataLevel=0,m="data";if(I.rootId=I.resolve.fullPath(I.self._getId(I.root.schema)),I.baseId=I.baseId||I.rootId,delete I.isTop,I.dataPathArr=[""],void 0!==I.schema.default&&I.opts.useDefaults&&I.opts.strictDefaults){var G="default is ignored in the schema root";if("log"!==I.opts.strictDefaults)throw new Error(G);I.logger.warn(G)}A+=" var vErrors = null; ",A+=" var errors = 0;     ",A+=" if (rootData === undefined) rootData = data; "}else{c=I.level,m="data"+((n=I.dataLevel)||"");if(l&&(I.baseId=I.resolve.url(I.baseId,l)),i&&!I.async)throw new Error("async schema in sync schema");A+=" var errs_"+c+" = errors;"}b="valid"+c,Z=!I.opts.allErrors;var u="",y="",B=I.schema.type,V=Array.isArray(B);if(B&&I.opts.nullable&&!0===I.schema.nullable&&(V?-1==B.indexOf("null")&&(B=B.concat("null")):"null"!=B&&(B=[B,"null"],V=!0)),V&&1==B.length&&(B=B[0],V=!1),I.schema.$ref&&e){if("fail"==I.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+I.errSchemaPath+'" (see option extendRefs)');!0!==I.opts.extendRefs&&(e=!1,I.logger.warn('$ref: keywords ignored in schema at path "'+I.errSchemaPath+'"'))}if(I.schema.$comment&&I.opts.$comment&&(A+=" "+I.RULES.all.$comment.code(I,"$comment")),B){if(I.opts.coerceTypes)var p=I.util.coerceToTypes(I.opts.coerceTypes,B);var X=I.RULES.types[B];if(p||V||!0===X||X&&!_(X)){s=I.schemaPath+".type",a=I.errSchemaPath+"/type",s=I.schemaPath+".type",a=I.errSchemaPath+"/type";var W=V?"checkDataTypes":"checkDataType";if(A+=" if ("+I.util[W](B,m,I.opts.strictNumbers,!0)+") { ",p){var H="dataType"+c,Y="coerced"+c;A+=" var "+H+" = typeof "+m+"; var "+Y+" = undefined; ","array"==I.opts.coerceTypes&&(A+=" if ("+H+" == 'object' && Array.isArray("+m+") && "+m+".length == 1) { "+m+" = "+m+"[0]; "+H+" = typeof "+m+"; if ("+I.util.checkDataType(I.schema.type,m,I.opts.strictNumbers)+") "+Y+" = "+m+"; } "),A+=" if ("+Y+" !== undefined) ; ";var R=p;if(R)for(var f,K=-1,w=R.length-1;K<w;)"string"==(f=R[K+=1])?A+=" else if ("+H+" == 'number' || "+H+" == 'boolean') "+Y+" = '' + "+m+"; else if ("+m+" === null) "+Y+" = ''; ":"number"==f||"integer"==f?(A+=" else if ("+H+" == 'boolean' || "+m+" === null || ("+H+" == 'string' && "+m+" && "+m+" == +"+m+" ","integer"==f&&(A+=" && !("+m+" % 1)"),A+=")) "+Y+" = +"+m+"; "):"boolean"==f?A+=" else if ("+m+" === 'false' || "+m+" === 0 || "+m+" === null) "+Y+" = false; else if ("+m+" === 'true' || "+m+" === 1) "+Y+" = true; ":"null"==f?A+=" else if ("+m+" === '' || "+m+" === 0 || "+m+" === false) "+Y+" = null; ":"array"==I.opts.coerceTypes&&"array"==f&&(A+=" else if ("+H+" == 'string' || "+H+" == 'number' || "+H+" == 'boolean' || "+m+" == null) "+Y+" = ["+m+"]; ");A+=" else {   ",(E=E||[]).push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'type' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(a)+" , params: { type: '",A+=V?""+B.join(","):""+B,A+="' } ",!1!==I.opts.messages&&(A+=" , message: 'should be ",A+=V?""+B.join(","):""+B,A+="' "),I.opts.verbose&&(A+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+m+" "),A+=" } "):A+=" {} ";r=A;A=E.pop(),!I.compositeRule&&Z?I.async?A+=" throw new ValidationError(["+r+"]); ":A+=" validate.errors = ["+r+"]; return false; ":A+=" var err = "+r+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",A+=" } if ("+Y+" !== undefined) {  ";var J=n?"data"+(n-1||""):"parentData";A+=" "+m+" = "+Y+"; ",n||(A+="if ("+J+" !== undefined)"),A+=" "+J+"["+(n?I.dataPathArr[n]:"parentDataProperty")+"] = "+Y+"; } "}else{(E=E||[]).push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'type' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(a)+" , params: { type: '",A+=V?""+B.join(","):""+B,A+="' } ",!1!==I.opts.messages&&(A+=" , message: 'should be ",A+=V?""+B.join(","):""+B,A+="' "),I.opts.verbose&&(A+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+m+" "),A+=" } "):A+=" {} ";r=A;A=E.pop(),!I.compositeRule&&Z?I.async?A+=" throw new ValidationError(["+r+"]); ":A+=" validate.errors = ["+r+"]; return false; ":A+=" var err = "+r+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}A+=" } "}}if(I.schema.$ref&&!e)A+=" "+I.RULES.all.$ref.code(I,"$ref")+" ",Z&&(A+=" } if (errors === ",A+=h?"0":"errs_"+c,A+=") { ",y+="}");else{var S=I.RULES;if(S)for(var F=-1,N=S.length-1;F<N;)if(_(X=S[F+=1])){if(X.type&&(A+=" if ("+I.util.checkDataType(X.type,m,I.opts.strictNumbers)+") { "),I.opts.useDefaults)if("object"==X.type&&I.schema.properties){d=I.schema.properties;var v=Object.keys(d);if(v)for(var k,D=-1,z=v.length-1;D<z;){if(void 0!==(x=d[k=v[D+=1]]).default){var M=m+I.util.getProperty(k);if(I.compositeRule){if(I.opts.strictDefaults){G="default is ignored for: "+M;if("log"!==I.opts.strictDefaults)throw new Error(G);I.logger.warn(G)}}else A+=" if ("+M+" === undefined ","empty"==I.opts.useDefaults&&(A+=" || "+M+" === null || "+M+" === '' "),A+=" ) "+M+" = ","shared"==I.opts.useDefaults?A+=" "+I.useDefault(x.default)+" ":A+=" "+JSON.stringify(x.default)+" ",A+="; "}}}else if("array"==X.type&&Array.isArray(I.schema.items)){var U=I.schema.items;if(U){K=-1;for(var x,T=U.length-1;K<T;)if(void 0!==(x=U[K+=1]).default){M=m+"["+K+"]";if(I.compositeRule){if(I.opts.strictDefaults){G="default is ignored for: "+M;if("log"!==I.opts.strictDefaults)throw new Error(G);I.logger.warn(G)}}else A+=" if ("+M+" === undefined ","empty"==I.opts.useDefaults&&(A+=" || "+M+" === null || "+M+" === '' "),A+=" ) "+M+" = ","shared"==I.opts.useDefaults?A+=" "+I.useDefault(x.default)+" ":A+=" "+JSON.stringify(x.default)+" ",A+="; "}}}var Q=X.rules;if(Q)for(var P,O=-1,j=Q.length-1;O<j;)if($(P=Q[O+=1])){var L=P.code(I,P.keyword,X.type);L&&(A+=" "+L+" ",Z&&(u+="}"))}if(Z&&(A+=" "+u+" ",u=""),X.type&&(A+=" } ",B&&B===X.type&&!p)){A+=" else { ";var E;s=I.schemaPath+".type",a=I.errSchemaPath+"/type";(E=E||[]).push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'type' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(a)+" , params: { type: '",A+=V?""+B.join(","):""+B,A+="' } ",!1!==I.opts.messages&&(A+=" , message: 'should be ",A+=V?""+B.join(","):""+B,A+="' "),I.opts.verbose&&(A+=" , schema: validate.schema"+s+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+m+" "),A+=" } "):A+=" {} ";r=A;A=E.pop(),!I.compositeRule&&Z?I.async?A+=" throw new ValidationError(["+r+"]); ":A+=" validate.errors = ["+r+"]; return false; ":A+=" var err = "+r+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",A+=" } "}Z&&(A+=" if (errors === ",A+=h?"0":"errs_"+c,A+=") { ",y+="}")}}function _(I){for(var g=I.rules,C=0;C<g.length;C++)if($(g[C]))return!0}function $(g){return void 0!==I.schema[g.keyword]||g.implements&&function(g){for(var C=g.implements,A=0;A<C.length;A++)if(void 0!==I.schema[C[A]])return!0}(g)}return Z&&(A+=" "+y+" "),h?(i?(A+=" if (errors === 0) return data;           ",A+=" else throw new ValidationError(vErrors); "):(A+=" validate.errors = vErrors; ",A+=" return errors === 0;       "),A+=" }; return validate;"):A+=" var "+b+" = errors === errs_"+c+";",A},fs=cs,Ks=Dd,ws=Xs,Js=Ys,Ss=Rs,Fs=Ks.ucs2length,Ns=kd,vs=ws.Validation,ks=function I(g,C,A,i){var e=this,l=this._opts,o=[void 0],t={},c=[],n={},d=[],s={},a=[];C=C||{schema:g,refVal:o,refs:t};var Z=Ds.call(this,g,C,i),m=this._compilations[Z.index];if(Z.compiling)return m.callValidate=function I(){var g=m.validate,C=g.apply(this,arguments);return I.errors=g.errors,C};var b=this._formats,r=this.RULES;try{var h=u(g,C,A,i);m.validate=h;var G=m.callValidate;return G&&(G.schema=h.schema,G.errors=null,G.refs=h.refs,G.refVal=h.refVal,G.root=h.root,G.$async=h.$async,l.sourceCode&&(G.source=h.source)),h}finally{zs.call(this,g,C,i)}function u(g,A,i,n){var s=!A||A&&A.schema==g;if(A.schema!=C.schema)return I.call(e,g,A,i,n);var Z,m=!0===g.$async,h=Ss({isTop:!0,schema:g,isRoot:s,baseId:n,root:A,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:ws.MissingRef,RULES:r,validate:Ss,util:Ks,resolve:fs,resolveRef:y,usePattern:p,useDefault:X,useCustomRule:W,opts:l,formats:b,logger:e.logger,self:e});h=Ps(o,Ts)+Ps(c,Us)+Ps(d,xs)+Ps(a,Qs)+h,l.processCode&&(h=l.processCode(h,g));try{Z=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",h)(e,r,b,C,o,d,a,Ns,Fs,vs),o[0]=Z}catch(im){throw e.logger.error("Error compiling schema, function code:",h),im}return Z.schema=g,Z.errors=null,Z.refs=t,Z.refVal=o,Z.root=s?Z:A,m&&(Z.$async=!0),!0===l.sourceCode&&(Z.source={code:h,patterns:c,defaults:d}),Z}function y(g,i,c){i=fs.url(g,i);var n,d,s=t[i];if(void 0!==s)return V(n=o[s],d="refVal["+s+"]");if(!c&&C.refs){var a=C.refs[i];if(void 0!==a)return V(n=C.refVal[a],d=B(i,n))}d=B(i);var Z=fs.call(e,u,C,i);if(void 0===Z){var m=A&&A[i];m&&(Z=fs.inlineRef(m,l.inlineRefs)?m:I.call(e,m,C,A,g))}if(void 0!==Z)return function(I,g){var C=t[I];o[C]=g}(i,Z),V(Z,d);!function(I){delete t[I]}(i)}function B(I,g){var C=o.length;return o[C]=g,t[I]=C,"refVal"+C}function V(I,g){return"object"==typeof I||"boolean"==typeof I?{code:g,schema:I,inline:!0}:{code:g,$async:I&&!!I.$async}}function p(I){var g=n[I];return void 0===g&&(g=n[I]=c.length,c[g]=I),"pattern"+g}function X(I){switch(typeof I){case"boolean":case"number":return""+I;case"string":return Ks.toQuotedString(I);case"object":if(null===I)return"null";var g=Js(I),C=s[g];return void 0===C&&(C=s[g]=d.length,d[C]=I),"default"+C}}function W(I,g,C,A){if(!1!==e._opts.validateSchema){var i=I.definition.dependencies;if(i&&!i.every((function(I){return Object.prototype.hasOwnProperty.call(C,I)})))throw new Error("parent schema must have all required keywords: "+i.join(","));var o=I.definition.validateSchema;if(o)if(!o(g)){var t="keyword schema is invalid: "+e.errorsText(o.errors);if("log"!=e._opts.validateSchema)throw new Error(t);e.logger.error(t)}}var c,n=I.definition.compile,d=I.definition.inline,s=I.definition.macro;if(n)c=n.call(e,g,C,A);else if(s)c=s.call(e,g,C,A),!1!==l.validateSchema&&e.validateSchema(c,!0);else if(d)c=d.call(e,A,I.keyword,g,C);else if(!(c=I.definition.validate))return;if(void 0===c)throw new Error('custom keyword "'+I.keyword+'"failed to compile');var Z=a.length;return a[Z]=c,{code:"customRule"+Z,validate:c}}};function Ds(I,g,C){var A=Ms.call(this,I,g,C);return A>=0?{index:A,compiling:!0}:(A=this._compilations.length,this._compilations[A]={schema:I,root:g,baseId:C},{index:A,compiling:!1})}function zs(I,g,C){var A=Ms.call(this,I,g,C);A>=0&&this._compilations.splice(A,1)}function Ms(I,g,C){for(var A=0;A<this._compilations.length;A++){var i=this._compilations[A];if(i.schema==I&&i.root==g&&i.baseId==C)return A}return-1}function Us(I,g){return"var pattern"+I+" = new RegExp("+Ks.toQuotedString(g[I])+");"}function xs(I){return"var default"+I+" = defaults["+I+"];"}function Ts(I,g){return void 0===g[I]?"":"var refVal"+I+" = refVal["+I+"];"}function Qs(I){return"var customRule"+I+" = customRules["+I+"];"}function Ps(I,g){if(!I.length)return"";for(var C="",A=0;A<I.length;A++)C+=g(A,I);return C}var Os={exports:{}},js=Os.exports=function(){this._cache={}};js.prototype.put=function(I,g){this._cache[I]=g},js.prototype.get=function(I){return this._cache[I]},js.prototype.del=function(I){delete this._cache[I]},js.prototype.clear=function(){this._cache={}};var Ls=Dd,Es=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,_s=[0,31,28,31,30,31,30,31,31,30,31,30,31],$s=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,qs=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,Ia=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,ga=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,Ca=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,Aa=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,ia=/^(?:\/(?:[^~/]|~0|~1)*)*$/,ea=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,la=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,oa=ta;function ta(I){return I="full"==I?"full":"fast",Ls.copy(ta[I])}function ca(I){var g=I.match(Es);if(!g)return!1;var C=+g[1],A=+g[2],i=+g[3];return A>=1&&A<=12&&i>=1&&i<=(2==A&&function(I){return I%4===0&&(I%100!==0||I%400===0)}(C)?29:_s[A])}function na(I,g){var C=I.match($s);if(!C)return!1;var A=C[1],i=C[2],e=C[3],l=C[5];return(A<=23&&i<=59&&e<=59||23==A&&59==i&&60==e)&&(!g||l)}ta.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":ga,url:Ca,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:qs,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:Za,uuid:Aa,"json-pointer":ia,"json-pointer-uri-fragment":ea,"relative-json-pointer":la},ta.full={date:ca,time:na,"date-time":function(I){var g=I.split(da);return 2==g.length&&ca(g[0])&&na(g[1],!0)},uri:function(I){return sa.test(I)&&Ia.test(I)},"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":ga,url:Ca,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:qs,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:Za,uuid:Aa,"json-pointer":ia,"json-pointer-uri-fragment":ea,"relative-json-pointer":la};var da=/t|\s/i;var sa=/\/|:/;var aa=/[^\\]\\Z/;function Za(I){if(aa.test(I))return!1;try{return new RegExp(I),!0}catch(im){return!1}}var ma=function(I,g,C){var A,i=" ",e=I.level,l=I.dataLevel,o=I.schema[g],t=I.schemaPath+I.util.getProperty(g),c=I.errSchemaPath+"/"+g,n=!I.opts.allErrors,d="data"+(l||""),s=I.opts.$data&&o&&o.$data;s?(i+=" var schema"+e+" = "+I.util.getData(o.$data,l,I.dataPathArr)+"; ",A="schema"+e):A=o;var a="maximum"==g,Z=a?"exclusiveMaximum":"exclusiveMinimum",m=I.schema[Z],b=I.opts.$data&&m&&m.$data,r=a?"<":">",h=a?">":"<",G=void 0;if(!s&&"number"!=typeof o&&void 0!==o)throw new Error(g+" must be number");if(!b&&void 0!==m&&"number"!=typeof m&&"boolean"!=typeof m)throw new Error(Z+" must be number or boolean");if(b){var u=I.util.getData(m.$data,l,I.dataPathArr),y="exclusive"+e,B="exclType"+e,V="exclIsNumber"+e,p="' + "+(H="op"+e)+" + '";i+=" var schemaExcl"+e+" = "+u+"; ",i+=" var "+y+"; var "+B+" = typeof "+(u="schemaExcl"+e)+"; if ("+B+" != 'boolean' && "+B+" != 'undefined' && "+B+" != 'number') { ";var X;G=Z;(X=X||[]).push(i),i="",!1!==I.createErrors?(i+=" { keyword: '"+(G||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(c)+" , params: {} ",!1!==I.opts.messages&&(i+=" , message: '"+Z+" should be boolean' "),I.opts.verbose&&(i+=" , schema: validate.schema"+t+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var W=i;i=X.pop(),!I.compositeRule&&n?I.async?i+=" throw new ValidationError(["+W+"]); ":i+=" validate.errors = ["+W+"]; return false; ":i+=" var err = "+W+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else if ( ",s&&(i+=" ("+A+" !== undefined && typeof "+A+" != 'number') || "),i+=" "+B+" == 'number' ? ( ("+y+" = "+A+" === undefined || "+u+" "+r+"= "+A+") ? "+d+" "+h+"= "+u+" : "+d+" "+h+" "+A+" ) : ( ("+y+" = "+u+" === true) ? "+d+" "+h+"= "+A+" : "+d+" "+h+" "+A+" ) || "+d+" !== "+d+") { var op"+e+" = "+y+" ? '"+r+"' : '"+r+"='; ",void 0===o&&(G=Z,c=I.errSchemaPath+"/"+Z,A=u,s=b)}else{p=r;if((V="number"==typeof m)&&s){var H="'"+p+"'";i+=" if ( ",s&&(i+=" ("+A+" !== undefined && typeof "+A+" != 'number') || "),i+=" ( "+A+" === undefined || "+m+" "+r+"= "+A+" ? "+d+" "+h+"= "+m+" : "+d+" "+h+" "+A+" ) || "+d+" !== "+d+") { "}else{V&&void 0===o?(y=!0,G=Z,c=I.errSchemaPath+"/"+Z,A=m,h+="="):(V&&(A=Math[a?"min":"max"](m,o)),m===(!V||A)?(y=!0,G=Z,c=I.errSchemaPath+"/"+Z,h+="="):(y=!1,p+="="));H="'"+p+"'";i+=" if ( ",s&&(i+=" ("+A+" !== undefined && typeof "+A+" != 'number') || "),i+=" "+d+" "+h+" "+A+" || "+d+" !== "+d+") { "}}G=G||g,(X=X||[]).push(i),i="",!1!==I.createErrors?(i+=" { keyword: '"+(G||"_limit")+"' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(c)+" , params: { comparison: "+H+", limit: "+A+", exclusive: "+y+" } ",!1!==I.opts.messages&&(i+=" , message: 'should be "+p+" ",i+=s?"' + "+A:A+"'"),I.opts.verbose&&(i+=" , schema:  ",i+=s?"validate.schema"+t:""+o,i+="         , parentSchema: validate.schema"+I.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";W=i;return i=X.pop(),!I.compositeRule&&n?I.async?i+=" throw new ValidationError(["+W+"]); ":i+=" validate.errors = ["+W+"]; return false; ":i+=" var err = "+W+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",n&&(i+=" else { "),i},ba=function(I,g,C){var A,i=" ",e=I.level,l=I.dataLevel,o=I.schema[g],t=I.schemaPath+I.util.getProperty(g),c=I.errSchemaPath+"/"+g,n=!I.opts.allErrors,d="data"+(l||""),s=I.opts.$data&&o&&o.$data;if(s?(i+=" var schema"+e+" = "+I.util.getData(o.$data,l,I.dataPathArr)+"; ",A="schema"+e):A=o,!s&&"number"!=typeof o)throw new Error(g+" must be number");i+="if ( ",s&&(i+=" ("+A+" !== undefined && typeof "+A+" != 'number') || "),i+=" "+d+".length "+("maxItems"==g?">":"<")+" "+A+") { ";var a=g,Z=Z||[];Z.push(i),i="",!1!==I.createErrors?(i+=" { keyword: '"+(a||"_limitItems")+"' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(c)+" , params: { limit: "+A+" } ",!1!==I.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxItems"==g?"more":"fewer",i+=" than ",i+=s?"' + "+A+" + '":""+o,i+=" items' "),I.opts.verbose&&(i+=" , schema:  ",i+=s?"validate.schema"+t:""+o,i+="         , parentSchema: validate.schema"+I.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var m=i;return i=Z.pop(),!I.compositeRule&&n?I.async?i+=" throw new ValidationError(["+m+"]); ":i+=" validate.errors = ["+m+"]; return false; ":i+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",n&&(i+=" else { "),i},ra=function(I,g,C){var A,i=" ",e=I.level,l=I.dataLevel,o=I.schema[g],t=I.schemaPath+I.util.getProperty(g),c=I.errSchemaPath+"/"+g,n=!I.opts.allErrors,d="data"+(l||""),s=I.opts.$data&&o&&o.$data;if(s?(i+=" var schema"+e+" = "+I.util.getData(o.$data,l,I.dataPathArr)+"; ",A="schema"+e):A=o,!s&&"number"!=typeof o)throw new Error(g+" must be number");var a="maxLength"==g?">":"<";i+="if ( ",s&&(i+=" ("+A+" !== undefined && typeof "+A+" != 'number') || "),!1===I.opts.unicode?i+=" "+d+".length ":i+=" ucs2length("+d+") ",i+=" "+a+" "+A+") { ";var Z=g,m=m||[];m.push(i),i="",!1!==I.createErrors?(i+=" { keyword: '"+(Z||"_limitLength")+"' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(c)+" , params: { limit: "+A+" } ",!1!==I.opts.messages&&(i+=" , message: 'should NOT be ",i+="maxLength"==g?"longer":"shorter",i+=" than ",i+=s?"' + "+A+" + '":""+o,i+=" characters' "),I.opts.verbose&&(i+=" , schema:  ",i+=s?"validate.schema"+t:""+o,i+="         , parentSchema: validate.schema"+I.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var b=i;return i=m.pop(),!I.compositeRule&&n?I.async?i+=" throw new ValidationError(["+b+"]); ":i+=" validate.errors = ["+b+"]; return false; ":i+=" var err = "+b+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",n&&(i+=" else { "),i},ha=function(I,g,C){var A,i=" ",e=I.level,l=I.dataLevel,o=I.schema[g],t=I.schemaPath+I.util.getProperty(g),c=I.errSchemaPath+"/"+g,n=!I.opts.allErrors,d="data"+(l||""),s=I.opts.$data&&o&&o.$data;if(s?(i+=" var schema"+e+" = "+I.util.getData(o.$data,l,I.dataPathArr)+"; ",A="schema"+e):A=o,!s&&"number"!=typeof o)throw new Error(g+" must be number");i+="if ( ",s&&(i+=" ("+A+" !== undefined && typeof "+A+" != 'number') || "),i+=" Object.keys("+d+").length "+("maxProperties"==g?">":"<")+" "+A+") { ";var a=g,Z=Z||[];Z.push(i),i="",!1!==I.createErrors?(i+=" { keyword: '"+(a||"_limitProperties")+"' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(c)+" , params: { limit: "+A+" } ",!1!==I.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxProperties"==g?"more":"fewer",i+=" than ",i+=s?"' + "+A+" + '":""+o,i+=" properties' "),I.opts.verbose&&(i+=" , schema:  ",i+=s?"validate.schema"+t:""+o,i+="         , parentSchema: validate.schema"+I.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var m=i;return i=Z.pop(),!I.compositeRule&&n?I.async?i+=" throw new ValidationError(["+m+"]); ":i+=" validate.errors = ["+m+"]; return false; ":i+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",n&&(i+=" else { "),i},Ga={$ref:function(I,g,C){var A,i,e=" ",l=I.level,o=I.dataLevel,t=I.schema[g],c=I.errSchemaPath+"/"+g,n=!I.opts.allErrors,d="data"+(o||""),s="valid"+l;if("#"==t||"#/"==t)I.isRoot?(A=I.async,i="validate"):(A=!0===I.root.schema.$async,i="root.refVal[0]");else{var a=I.resolveRef(I.baseId,t,I.isRoot);if(void 0===a){var Z=I.MissingRefError.message(I.baseId,t);if("fail"==I.opts.missingRefs){I.logger.error(Z),(h=h||[]).push(e),e="",!1!==I.createErrors?(e+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(c)+" , params: { ref: '"+I.util.escapeQuotes(t)+"' } ",!1!==I.opts.messages&&(e+=" , message: 'can\\'t resolve reference "+I.util.escapeQuotes(t)+"' "),I.opts.verbose&&(e+=" , schema: "+I.util.toQuotedString(t)+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+d+" "),e+=" } "):e+=" {} ";var m=e;e=h.pop(),!I.compositeRule&&n?I.async?e+=" throw new ValidationError(["+m+"]); ":e+=" validate.errors = ["+m+"]; return false; ":e+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",n&&(e+=" if (false) { ")}else{if("ignore"!=I.opts.missingRefs)throw new I.MissingRefError(I.baseId,t,Z);I.logger.warn(Z),n&&(e+=" if (true) { ")}}else if(a.inline){var b=I.util.copy(I);b.level++;var r="valid"+b.level;b.schema=a.schema,b.schemaPath="",b.errSchemaPath=t,e+=" "+I.validate(b).replace(/validate\.schema/g,a.code)+" ",n&&(e+=" if ("+r+") { ")}else A=!0===a.$async||I.async&&!1!==a.$async,i=a.code}if(i){var h;(h=h||[]).push(e),e="",I.opts.passContext?e+=" "+i+".call(this, ":e+=" "+i+"( ",e+=" "+d+", (dataPath || '')",'""'!=I.errorPath&&(e+=" + "+I.errorPath);var G=e+=" , "+(o?"data"+(o-1||""):"parentData")+" , "+(o?I.dataPathArr[o]:"parentDataProperty")+", rootData)  ";if(e=h.pop(),A){if(!I.async)throw new Error("async schema referenced by sync schema");n&&(e+=" var "+s+"; "),e+=" try { await "+G+"; ",n&&(e+=" "+s+" = true; "),e+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",n&&(e+=" "+s+" = false; "),e+=" } ",n&&(e+=" if ("+s+") { ")}else e+=" if (!"+G+") { if (vErrors === null) vErrors = "+i+".errors; else vErrors = vErrors.concat("+i+".errors); errors = vErrors.length; } ",n&&(e+=" else { ")}return e},allOf:function(I,g,C){var A=" ",i=I.schema[g],e=I.schemaPath+I.util.getProperty(g),l=I.errSchemaPath+"/"+g,o=!I.opts.allErrors,t=I.util.copy(I),c="";t.level++;var n="valid"+t.level,d=t.baseId,s=!0,a=i;if(a)for(var Z,m=-1,b=a.length-1;m<b;)Z=a[m+=1],(I.opts.strictKeywords?"object"==typeof Z&&Object.keys(Z).length>0||!1===Z:I.util.schemaHasRules(Z,I.RULES.all))&&(s=!1,t.schema=Z,t.schemaPath=e+"["+m+"]",t.errSchemaPath=l+"/"+m,A+="  "+I.validate(t)+" ",t.baseId=d,o&&(A+=" if ("+n+") { ",c+="}"));return o&&(A+=s?" if (true) { ":" "+c.slice(0,-1)+" "),A},anyOf:function(I,g,C){var A=" ",i=I.level,e=I.dataLevel,l=I.schema[g],o=I.schemaPath+I.util.getProperty(g),t=I.errSchemaPath+"/"+g,c=!I.opts.allErrors,n="data"+(e||""),d="valid"+i,s="errs__"+i,a=I.util.copy(I),Z="";a.level++;var m="valid"+a.level;if(l.every((function(g){return I.opts.strictKeywords?"object"==typeof g&&Object.keys(g).length>0||!1===g:I.util.schemaHasRules(g,I.RULES.all)}))){var b=a.baseId;A+=" var "+s+" = errors; var "+d+" = false;  ";var r=I.compositeRule;I.compositeRule=a.compositeRule=!0;var h=l;if(h)for(var G,u=-1,y=h.length-1;u<y;)G=h[u+=1],a.schema=G,a.schemaPath=o+"["+u+"]",a.errSchemaPath=t+"/"+u,A+="  "+I.validate(a)+" ",a.baseId=b,A+=" "+d+" = "+d+" || "+m+"; if (!"+d+") { ",Z+="}";I.compositeRule=a.compositeRule=r,A+=" "+Z+" if (!"+d+") {   var err =   ",!1!==I.createErrors?(A+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: {} ",!1!==I.opts.messages&&(A+=" , message: 'should match some schema in anyOf' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ",A+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!I.compositeRule&&c&&(I.async?A+=" throw new ValidationError(vErrors); ":A+=" validate.errors = vErrors; return false; "),A+=" } else {  errors = "+s+"; if (vErrors !== null) { if ("+s+") vErrors.length = "+s+"; else vErrors = null; } ",I.opts.allErrors&&(A+=" } ")}else c&&(A+=" if (true) { ");return A},$comment:function(I,g,C){var A=" ",i=I.schema[g],e=I.errSchemaPath+"/"+g;I.opts.allErrors;var l=I.util.toQuotedString(i);return!0===I.opts.$comment?A+=" console.log("+l+");":"function"==typeof I.opts.$comment&&(A+=" self._opts.$comment("+l+", "+I.util.toQuotedString(e)+", validate.root.schema);"),A},const:function(I,g,C){var A=" ",i=I.level,e=I.dataLevel,l=I.schema[g],o=I.schemaPath+I.util.getProperty(g),t=I.errSchemaPath+"/"+g,c=!I.opts.allErrors,n="data"+(e||""),d="valid"+i,s=I.opts.$data&&l&&l.$data;s&&(A+=" var schema"+i+" = "+I.util.getData(l.$data,e,I.dataPathArr)+"; "),s||(A+=" var schema"+i+" = validate.schema"+o+";"),A+="var "+d+" = equal("+n+", schema"+i+"); if (!"+d+") {   ";var a=a||[];a.push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'const' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { allowedValue: schema"+i+" } ",!1!==I.opts.messages&&(A+=" , message: 'should be equal to constant' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ";var Z=A;return A=a.pop(),!I.compositeRule&&c?I.async?A+=" throw new ValidationError(["+Z+"]); ":A+=" validate.errors = ["+Z+"]; return false; ":A+=" var err = "+Z+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",A+=" }",c&&(A+=" else { "),A},contains:function(I,g,C){var A=" ",i=I.level,e=I.dataLevel,l=I.schema[g],o=I.schemaPath+I.util.getProperty(g),t=I.errSchemaPath+"/"+g,c=!I.opts.allErrors,n="data"+(e||""),d="valid"+i,s="errs__"+i,a=I.util.copy(I);a.level++;var Z="valid"+a.level,m="i"+i,b=a.dataLevel=I.dataLevel+1,r="data"+b,h=I.baseId,G=I.opts.strictKeywords?"object"==typeof l&&Object.keys(l).length>0||!1===l:I.util.schemaHasRules(l,I.RULES.all);if(A+="var "+s+" = errors;var "+d+";",G){var u=I.compositeRule;I.compositeRule=a.compositeRule=!0,a.schema=l,a.schemaPath=o,a.errSchemaPath=t,A+=" var "+Z+" = false; for (var "+m+" = 0; "+m+" < "+n+".length; "+m+"++) { ",a.errorPath=I.util.getPathExpr(I.errorPath,m,I.opts.jsonPointers,!0);var y=n+"["+m+"]";a.dataPathArr[b]=m;var B=I.validate(a);a.baseId=h,I.util.varOccurences(B,r)<2?A+=" "+I.util.varReplace(B,r,y)+" ":A+=" var "+r+" = "+y+"; "+B+" ",A+=" if ("+Z+") break; }  ",I.compositeRule=a.compositeRule=u,A+="  if (!"+Z+") {"}else A+=" if ("+n+".length == 0) {";var V=V||[];V.push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: {} ",!1!==I.opts.messages&&(A+=" , message: 'should contain a valid item' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ";var p=A;return A=V.pop(),!I.compositeRule&&c?I.async?A+=" throw new ValidationError(["+p+"]); ":A+=" validate.errors = ["+p+"]; return false; ":A+=" var err = "+p+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",A+=" } else { ",G&&(A+="  errors = "+s+"; if (vErrors !== null) { if ("+s+") vErrors.length = "+s+"; else vErrors = null; } "),I.opts.allErrors&&(A+=" } "),A},dependencies:function(I,g,C){var A=" ",i=I.level,e=I.dataLevel,l=I.schema[g],o=I.schemaPath+I.util.getProperty(g),t=I.errSchemaPath+"/"+g,c=!I.opts.allErrors,n="data"+(e||""),d="errs__"+i,s=I.util.copy(I),a="";s.level++;var Z="valid"+s.level,m={},b={},r=I.opts.ownProperties;for(y in l)if("__proto__"!=y){var h=l[y],G=Array.isArray(h)?b:m;G[y]=h}A+="var "+d+" = errors;";var u=I.errorPath;for(var y in A+="var missing"+i+";",b)if((G=b[y]).length){if(A+=" if ( "+n+I.util.getProperty(y)+" !== undefined ",r&&(A+=" && Object.prototype.hasOwnProperty.call("+n+", '"+I.util.escapeQuotes(y)+"') "),c){A+=" && ( ";var B=G;if(B)for(var V=-1,p=B.length-1;V<p;){f=B[V+=1],V&&(A+=" || "),A+=" ( ( "+(S=n+(J=I.util.getProperty(f)))+" === undefined ",r&&(A+=" || ! Object.prototype.hasOwnProperty.call("+n+", '"+I.util.escapeQuotes(f)+"') "),A+=") && (missing"+i+" = "+I.util.toQuotedString(I.opts.jsonPointers?f:J)+") ) "}A+=")) {  ";var X="missing"+i,W="' + "+X+" + '";I.opts._errorDataPathProperty&&(I.errorPath=I.opts.jsonPointers?I.util.getPathExpr(u,X,!0):u+" + "+X);var H=H||[];H.push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { property: '"+I.util.escapeQuotes(y)+"', missingProperty: '"+W+"', depsCount: "+G.length+", deps: '"+I.util.escapeQuotes(1==G.length?G[0]:G.join(", "))+"' } ",!1!==I.opts.messages&&(A+=" , message: 'should have ",1==G.length?A+="property "+I.util.escapeQuotes(G[0]):A+="properties "+I.util.escapeQuotes(G.join(", ")),A+=" when property "+I.util.escapeQuotes(y)+" is present' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ";var Y=A;A=H.pop(),!I.compositeRule&&c?I.async?A+=" throw new ValidationError(["+Y+"]); ":A+=" validate.errors = ["+Y+"]; return false; ":A+=" var err = "+Y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{A+=" ) { ";var R=G;if(R)for(var f,K=-1,w=R.length-1;K<w;){f=R[K+=1];var J=I.util.getProperty(f),S=(W=I.util.escapeQuotes(f),n+J);I.opts._errorDataPathProperty&&(I.errorPath=I.util.getPath(u,f,I.opts.jsonPointers)),A+=" if ( "+S+" === undefined ",r&&(A+=" || ! Object.prototype.hasOwnProperty.call("+n+", '"+I.util.escapeQuotes(f)+"') "),A+=") {  var err =   ",!1!==I.createErrors?(A+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { property: '"+I.util.escapeQuotes(y)+"', missingProperty: '"+W+"', depsCount: "+G.length+", deps: '"+I.util.escapeQuotes(1==G.length?G[0]:G.join(", "))+"' } ",!1!==I.opts.messages&&(A+=" , message: 'should have ",1==G.length?A+="property "+I.util.escapeQuotes(G[0]):A+="properties "+I.util.escapeQuotes(G.join(", ")),A+=" when property "+I.util.escapeQuotes(y)+" is present' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ",A+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}A+=" }   ",c&&(a+="}",A+=" else { ")}I.errorPath=u;var F=s.baseId;for(var y in m){h=m[y];(I.opts.strictKeywords?"object"==typeof h&&Object.keys(h).length>0||!1===h:I.util.schemaHasRules(h,I.RULES.all))&&(A+=" "+Z+" = true; if ( "+n+I.util.getProperty(y)+" !== undefined ",r&&(A+=" && Object.prototype.hasOwnProperty.call("+n+", '"+I.util.escapeQuotes(y)+"') "),A+=") { ",s.schema=h,s.schemaPath=o+I.util.getProperty(y),s.errSchemaPath=t+"/"+I.util.escapeFragment(y),A+="  "+I.validate(s)+" ",s.baseId=F,A+=" }  ",c&&(A+=" if ("+Z+") { ",a+="}"))}return c&&(A+="   "+a+" if ("+d+" == errors) {"),A},enum:function(I,g,C){var A=" ",i=I.level,e=I.dataLevel,l=I.schema[g],o=I.schemaPath+I.util.getProperty(g),t=I.errSchemaPath+"/"+g,c=!I.opts.allErrors,n="data"+(e||""),d="valid"+i,s=I.opts.$data&&l&&l.$data;s&&(A+=" var schema"+i+" = "+I.util.getData(l.$data,e,I.dataPathArr)+"; ");var a="i"+i,Z="schema"+i;s||(A+=" var "+Z+" = validate.schema"+o+";"),A+="var "+d+";",s&&(A+=" if (schema"+i+" === undefined) "+d+" = true; else if (!Array.isArray(schema"+i+")) "+d+" = false; else {"),A+=d+" = false;for (var "+a+"=0; "+a+"<"+Z+".length; "+a+"++) if (equal("+n+", "+Z+"["+a+"])) { "+d+" = true; break; }",s&&(A+="  }  "),A+=" if (!"+d+") {   ";var m=m||[];m.push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { allowedValues: schema"+i+" } ",!1!==I.opts.messages&&(A+=" , message: 'should be equal to one of the allowed values' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ";var b=A;return A=m.pop(),!I.compositeRule&&c?I.async?A+=" throw new ValidationError(["+b+"]); ":A+=" validate.errors = ["+b+"]; return false; ":A+=" var err = "+b+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",A+=" }",c&&(A+=" else { "),A},format:function(I,g,C){var A=" ",i=I.level,e=I.dataLevel,l=I.schema[g],o=I.schemaPath+I.util.getProperty(g),t=I.errSchemaPath+"/"+g,c=!I.opts.allErrors,n="data"+(e||"");if(!1===I.opts.format)return c&&(A+=" if (true) { "),A;var d,s=I.opts.$data&&l&&l.$data;s?(A+=" var schema"+i+" = "+I.util.getData(l.$data,e,I.dataPathArr)+"; ",d="schema"+i):d=l;var a=I.opts.unknownFormats,Z=Array.isArray(a);if(s){A+=" var "+(m="format"+i)+" = formats["+d+"]; var "+(b="isObject"+i)+" = typeof "+m+" == 'object' && !("+m+" instanceof RegExp) && "+m+".validate; var "+(r="formatType"+i)+" = "+b+" && "+m+".type || 'string'; if ("+b+") { ",I.async&&(A+=" var async"+i+" = "+m+".async; "),A+=" "+m+" = "+m+".validate; } if (  ",s&&(A+=" ("+d+" !== undefined && typeof "+d+" != 'string') || "),A+=" (","ignore"!=a&&(A+=" ("+d+" && !"+m+" ",Z&&(A+=" && self._opts.unknownFormats.indexOf("+d+") == -1 "),A+=") || "),A+=" ("+m+" && "+r+" == '"+C+"' && !(typeof "+m+" == 'function' ? ",I.async?A+=" (async"+i+" ? await "+m+"("+n+") : "+m+"("+n+")) ":A+=" "+m+"("+n+") ",A+=" : "+m+".test("+n+"))))) {"}else{var m;if(!(m=I.formats[l])){if("ignore"==a)return I.logger.warn('unknown format "'+l+'" ignored in schema at path "'+I.errSchemaPath+'"'),c&&(A+=" if (true) { "),A;if(Z&&a.indexOf(l)>=0)return c&&(A+=" if (true) { "),A;throw new Error('unknown format "'+l+'" is used in schema at path "'+I.errSchemaPath+'"')}var b,r=(b="object"==typeof m&&!(m instanceof RegExp)&&m.validate)&&m.type||"string";if(b){var h=!0===m.async;m=m.validate}if(r!=C)return c&&(A+=" if (true) { "),A;if(h){if(!I.async)throw new Error("async format in sync schema");A+=" if (!(await "+(G="formats"+I.util.getProperty(l)+".validate")+"("+n+"))) { "}else{A+=" if (! ";var G="formats"+I.util.getProperty(l);b&&(G+=".validate"),A+="function"==typeof m?" "+G+"("+n+") ":" "+G+".test("+n+") ",A+=") { "}}var u=u||[];u.push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'format' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { format:  ",A+=s?""+d:""+I.util.toQuotedString(l),A+="  } ",!1!==I.opts.messages&&(A+=" , message: 'should match format \"",A+=s?"' + "+d+" + '":""+I.util.escapeQuotes(l),A+="\"' "),I.opts.verbose&&(A+=" , schema:  ",A+=s?"validate.schema"+o:""+I.util.toQuotedString(l),A+="         , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ";var y=A;return A=u.pop(),!I.compositeRule&&c?I.async?A+=" throw new ValidationError(["+y+"]); ":A+=" validate.errors = ["+y+"]; return false; ":A+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",A+=" } ",c&&(A+=" else { "),A},if:function(I,g,C){var A=" ",i=I.level,e=I.dataLevel,l=I.schema[g],o=I.schemaPath+I.util.getProperty(g),t=I.errSchemaPath+"/"+g,c=!I.opts.allErrors,n="data"+(e||""),d="valid"+i,s="errs__"+i,a=I.util.copy(I);a.level++;var Z="valid"+a.level,m=I.schema.then,b=I.schema.else,r=void 0!==m&&(I.opts.strictKeywords?"object"==typeof m&&Object.keys(m).length>0||!1===m:I.util.schemaHasRules(m,I.RULES.all)),h=void 0!==b&&(I.opts.strictKeywords?"object"==typeof b&&Object.keys(b).length>0||!1===b:I.util.schemaHasRules(b,I.RULES.all)),G=a.baseId;if(r||h){var u;a.createErrors=!1,a.schema=l,a.schemaPath=o,a.errSchemaPath=t,A+=" var "+s+" = errors; var "+d+" = true;  ";var y=I.compositeRule;I.compositeRule=a.compositeRule=!0,A+="  "+I.validate(a)+" ",a.baseId=G,a.createErrors=!0,A+="  errors = "+s+"; if (vErrors !== null) { if ("+s+") vErrors.length = "+s+"; else vErrors = null; }  ",I.compositeRule=a.compositeRule=y,r?(A+=" if ("+Z+") {  ",a.schema=I.schema.then,a.schemaPath=I.schemaPath+".then",a.errSchemaPath=I.errSchemaPath+"/then",A+="  "+I.validate(a)+" ",a.baseId=G,A+=" "+d+" = "+Z+"; ",r&&h?A+=" var "+(u="ifClause"+i)+" = 'then'; ":u="'then'",A+=" } ",h&&(A+=" else { ")):A+=" if (!"+Z+") { ",h&&(a.schema=I.schema.else,a.schemaPath=I.schemaPath+".else",a.errSchemaPath=I.errSchemaPath+"/else",A+="  "+I.validate(a)+" ",a.baseId=G,A+=" "+d+" = "+Z+"; ",r&&h?A+=" var "+(u="ifClause"+i)+" = 'else'; ":u="'else'",A+=" } "),A+=" if (!"+d+") {   var err =   ",!1!==I.createErrors?(A+=" { keyword: 'if' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { failingKeyword: "+u+" } ",!1!==I.opts.messages&&(A+=" , message: 'should match \"' + "+u+" + '\" schema' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ",A+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!I.compositeRule&&c&&(I.async?A+=" throw new ValidationError(vErrors); ":A+=" validate.errors = vErrors; return false; "),A+=" }   ",c&&(A+=" else { ")}else c&&(A+=" if (true) { ");return A},items:function(I,g,C){var A=" ",i=I.level,e=I.dataLevel,l=I.schema[g],o=I.schemaPath+I.util.getProperty(g),t=I.errSchemaPath+"/"+g,c=!I.opts.allErrors,n="data"+(e||""),d="valid"+i,s="errs__"+i,a=I.util.copy(I),Z="";a.level++;var m="valid"+a.level,b="i"+i,r=a.dataLevel=I.dataLevel+1,h="data"+r,G=I.baseId;if(A+="var "+s+" = errors;var "+d+";",Array.isArray(l)){var u=I.schema.additionalItems;if(!1===u){A+=" "+d+" = "+n+".length <= "+l.length+"; ";var y=t;t=I.errSchemaPath+"/additionalItems",A+="  if (!"+d+") {   ";var B=B||[];B.push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { limit: "+l.length+" } ",!1!==I.opts.messages&&(A+=" , message: 'should NOT have more than "+l.length+" items' "),I.opts.verbose&&(A+=" , schema: false , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ";var V=A;A=B.pop(),!I.compositeRule&&c?I.async?A+=" throw new ValidationError(["+V+"]); ":A+=" validate.errors = ["+V+"]; return false; ":A+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",A+=" } ",t=y,c&&(Z+="}",A+=" else { ")}var p=l;if(p)for(var X,W=-1,H=p.length-1;W<H;)if(X=p[W+=1],I.opts.strictKeywords?"object"==typeof X&&Object.keys(X).length>0||!1===X:I.util.schemaHasRules(X,I.RULES.all)){A+=" "+m+" = true; if ("+n+".length > "+W+") { ";var Y=n+"["+W+"]";a.schema=X,a.schemaPath=o+"["+W+"]",a.errSchemaPath=t+"/"+W,a.errorPath=I.util.getPathExpr(I.errorPath,W,I.opts.jsonPointers,!0),a.dataPathArr[r]=W;var R=I.validate(a);a.baseId=G,I.util.varOccurences(R,h)<2?A+=" "+I.util.varReplace(R,h,Y)+" ":A+=" var "+h+" = "+Y+"; "+R+" ",A+=" }  ",c&&(A+=" if ("+m+") { ",Z+="}")}if("object"==typeof u&&(I.opts.strictKeywords?"object"==typeof u&&Object.keys(u).length>0||!1===u:I.util.schemaHasRules(u,I.RULES.all))){a.schema=u,a.schemaPath=I.schemaPath+".additionalItems",a.errSchemaPath=I.errSchemaPath+"/additionalItems",A+=" "+m+" = true; if ("+n+".length > "+l.length+") {  for (var "+b+" = "+l.length+"; "+b+" < "+n+".length; "+b+"++) { ",a.errorPath=I.util.getPathExpr(I.errorPath,b,I.opts.jsonPointers,!0);Y=n+"["+b+"]";a.dataPathArr[r]=b;R=I.validate(a);a.baseId=G,I.util.varOccurences(R,h)<2?A+=" "+I.util.varReplace(R,h,Y)+" ":A+=" var "+h+" = "+Y+"; "+R+" ",c&&(A+=" if (!"+m+") break; "),A+=" } }  ",c&&(A+=" if ("+m+") { ",Z+="}")}}else if(I.opts.strictKeywords?"object"==typeof l&&Object.keys(l).length>0||!1===l:I.util.schemaHasRules(l,I.RULES.all)){a.schema=l,a.schemaPath=o,a.errSchemaPath=t,A+="  for (var "+b+" = 0; "+b+" < "+n+".length; "+b+"++) { ",a.errorPath=I.util.getPathExpr(I.errorPath,b,I.opts.jsonPointers,!0);Y=n+"["+b+"]";a.dataPathArr[r]=b;R=I.validate(a);a.baseId=G,I.util.varOccurences(R,h)<2?A+=" "+I.util.varReplace(R,h,Y)+" ":A+=" var "+h+" = "+Y+"; "+R+" ",c&&(A+=" if (!"+m+") break; "),A+=" }"}return c&&(A+=" "+Z+" if ("+s+" == errors) {"),A},maximum:ma,minimum:ma,maxItems:ba,minItems:ba,maxLength:ra,minLength:ra,maxProperties:ha,minProperties:ha,multipleOf:function(I,g,C){var A,i=" ",e=I.level,l=I.dataLevel,o=I.schema[g],t=I.schemaPath+I.util.getProperty(g),c=I.errSchemaPath+"/"+g,n=!I.opts.allErrors,d="data"+(l||""),s=I.opts.$data&&o&&o.$data;if(s?(i+=" var schema"+e+" = "+I.util.getData(o.$data,l,I.dataPathArr)+"; ",A="schema"+e):A=o,!s&&"number"!=typeof o)throw new Error(g+" must be number");i+="var division"+e+";if (",s&&(i+=" "+A+" !== undefined && ( typeof "+A+" != 'number' || "),i+=" (division"+e+" = "+d+" / "+A+", ",I.opts.multipleOfPrecision?i+=" Math.abs(Math.round(division"+e+") - division"+e+") > 1e-"+I.opts.multipleOfPrecision+" ":i+=" division"+e+" !== parseInt(division"+e+") ",i+=" ) ",s&&(i+="  )  "),i+=" ) {   ";var a=a||[];a.push(i),i="",!1!==I.createErrors?(i+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(c)+" , params: { multipleOf: "+A+" } ",!1!==I.opts.messages&&(i+=" , message: 'should be multiple of ",i+=s?"' + "+A:A+"'"),I.opts.verbose&&(i+=" , schema:  ",i+=s?"validate.schema"+t:""+o,i+="         , parentSchema: validate.schema"+I.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var Z=i;return i=a.pop(),!I.compositeRule&&n?I.async?i+=" throw new ValidationError(["+Z+"]); ":i+=" validate.errors = ["+Z+"]; return false; ":i+=" var err = "+Z+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",n&&(i+=" else { "),i},not:function(I,g,C){var A=" ",i=I.level,e=I.dataLevel,l=I.schema[g],o=I.schemaPath+I.util.getProperty(g),t=I.errSchemaPath+"/"+g,c=!I.opts.allErrors,n="data"+(e||""),d="errs__"+i,s=I.util.copy(I);s.level++;var a="valid"+s.level;if(I.opts.strictKeywords?"object"==typeof l&&Object.keys(l).length>0||!1===l:I.util.schemaHasRules(l,I.RULES.all)){s.schema=l,s.schemaPath=o,s.errSchemaPath=t,A+=" var "+d+" = errors;  ";var Z,m=I.compositeRule;I.compositeRule=s.compositeRule=!0,s.createErrors=!1,s.opts.allErrors&&(Z=s.opts.allErrors,s.opts.allErrors=!1),A+=" "+I.validate(s)+" ",s.createErrors=!0,Z&&(s.opts.allErrors=Z),I.compositeRule=s.compositeRule=m,A+=" if ("+a+") {   ";var b=b||[];b.push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'not' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: {} ",!1!==I.opts.messages&&(A+=" , message: 'should NOT be valid' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ";var r=A;A=b.pop(),!I.compositeRule&&c?I.async?A+=" throw new ValidationError(["+r+"]); ":A+=" validate.errors = ["+r+"]; return false; ":A+=" var err = "+r+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",A+=" } else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } ",I.opts.allErrors&&(A+=" } ")}else A+="  var err =   ",!1!==I.createErrors?(A+=" { keyword: 'not' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: {} ",!1!==I.opts.messages&&(A+=" , message: 'should NOT be valid' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ",A+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c&&(A+=" if (false) { ");return A},oneOf:function(I,g,C){var A=" ",i=I.level,e=I.dataLevel,l=I.schema[g],o=I.schemaPath+I.util.getProperty(g),t=I.errSchemaPath+"/"+g,c=!I.opts.allErrors,n="data"+(e||""),d="valid"+i,s="errs__"+i,a=I.util.copy(I),Z="";a.level++;var m="valid"+a.level,b=a.baseId,r="prevValid"+i,h="passingSchemas"+i;A+="var "+s+" = errors , "+r+" = false , "+d+" = false , "+h+" = null; ";var G=I.compositeRule;I.compositeRule=a.compositeRule=!0;var u=l;if(u)for(var y,B=-1,V=u.length-1;B<V;)y=u[B+=1],(I.opts.strictKeywords?"object"==typeof y&&Object.keys(y).length>0||!1===y:I.util.schemaHasRules(y,I.RULES.all))?(a.schema=y,a.schemaPath=o+"["+B+"]",a.errSchemaPath=t+"/"+B,A+="  "+I.validate(a)+" ",a.baseId=b):A+=" var "+m+" = true; ",B&&(A+=" if ("+m+" && "+r+") { "+d+" = false; "+h+" = ["+h+", "+B+"]; } else { ",Z+="}"),A+=" if ("+m+") { "+d+" = "+r+" = true; "+h+" = "+B+"; }";return I.compositeRule=a.compositeRule=G,A+=Z+"if (!"+d+") {   var err =   ",!1!==I.createErrors?(A+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { passingSchemas: "+h+" } ",!1!==I.opts.messages&&(A+=" , message: 'should match exactly one schema in oneOf' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ",A+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!I.compositeRule&&c&&(I.async?A+=" throw new ValidationError(vErrors); ":A+=" validate.errors = vErrors; return false; "),A+="} else {  errors = "+s+"; if (vErrors !== null) { if ("+s+") vErrors.length = "+s+"; else vErrors = null; }",I.opts.allErrors&&(A+=" } "),A},pattern:function(I,g,C){var A,i=" ",e=I.level,l=I.dataLevel,o=I.schema[g],t=I.schemaPath+I.util.getProperty(g),c=I.errSchemaPath+"/"+g,n=!I.opts.allErrors,d="data"+(l||""),s=I.opts.$data&&o&&o.$data;s?(i+=" var schema"+e+" = "+I.util.getData(o.$data,l,I.dataPathArr)+"; ",A="schema"+e):A=o,i+="if ( ",s&&(i+=" ("+A+" !== undefined && typeof "+A+" != 'string') || "),i+=" !"+(s?"(new RegExp("+A+"))":I.usePattern(o))+".test("+d+") ) {   ";var a=a||[];a.push(i),i="",!1!==I.createErrors?(i+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(c)+" , params: { pattern:  ",i+=s?""+A:""+I.util.toQuotedString(o),i+="  } ",!1!==I.opts.messages&&(i+=" , message: 'should match pattern \"",i+=s?"' + "+A+" + '":""+I.util.escapeQuotes(o),i+="\"' "),I.opts.verbose&&(i+=" , schema:  ",i+=s?"validate.schema"+t:""+I.util.toQuotedString(o),i+="         , parentSchema: validate.schema"+I.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var Z=i;return i=a.pop(),!I.compositeRule&&n?I.async?i+=" throw new ValidationError(["+Z+"]); ":i+=" validate.errors = ["+Z+"]; return false; ":i+=" var err = "+Z+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",n&&(i+=" else { "),i},properties:function(I,g,C){var A=" ",i=I.level,e=I.dataLevel,l=I.schema[g],o=I.schemaPath+I.util.getProperty(g),t=I.errSchemaPath+"/"+g,c=!I.opts.allErrors,n="data"+(e||""),d="errs__"+i,s=I.util.copy(I),a="";s.level++;var Z="valid"+s.level,m="key"+i,b="idx"+i,r=s.dataLevel=I.dataLevel+1,h="data"+r,G="dataProperties"+i,u=Object.keys(l||{}).filter(J),y=I.schema.patternProperties||{},B=Object.keys(y).filter(J),V=I.schema.additionalProperties,p=u.length||B.length,X=!1===V,W="object"==typeof V&&Object.keys(V).length,H=I.opts.removeAdditional,Y=X||W||H,R=I.opts.ownProperties,f=I.baseId,K=I.schema.required;if(K&&(!I.opts.$data||!K.$data)&&K.length<I.opts.loopRequired)var w=I.util.toHash(K);function J(I){return"__proto__"!==I}if(A+="var "+d+" = errors;var "+Z+" = true;",R&&(A+=" var "+G+" = undefined;"),Y){if(A+=R?" "+G+" = "+G+" || Object.keys("+n+"); for (var "+b+"=0; "+b+"<"+G+".length; "+b+"++) { var "+m+" = "+G+"["+b+"]; ":" for (var "+m+" in "+n+") { ",p){if(A+=" var isAdditional"+i+" = !(false ",u.length)if(u.length>8)A+=" || validate.schema"+o+".hasOwnProperty("+m+") ";else{var S=u;if(S)for(var F=-1,N=S.length-1;F<N;)L=S[F+=1],A+=" || "+m+" == "+I.util.toQuotedString(L)+" "}if(B.length){var v=B;if(v)for(var k=-1,D=v.length-1;k<D;)eI=v[k+=1],A+=" || "+I.usePattern(eI)+".test("+m+") "}A+=" ); if (isAdditional"+i+") { "}if("all"==H)A+=" delete "+n+"["+m+"]; ";else{var z=I.errorPath,M="' + "+m+" + '";if(I.opts._errorDataPathProperty&&(I.errorPath=I.util.getPathExpr(I.errorPath,m,I.opts.jsonPointers)),X)if(H)A+=" delete "+n+"["+m+"]; ";else{A+=" "+Z+" = false; ";var U=t;t=I.errSchemaPath+"/additionalProperties",(CI=CI||[]).push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { additionalProperty: '"+M+"' } ",!1!==I.opts.messages&&(A+=" , message: '",I.opts._errorDataPathProperty?A+="is an invalid additional property":A+="should NOT have additional properties",A+="' "),I.opts.verbose&&(A+=" , schema: false , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ";var x=A;A=CI.pop(),!I.compositeRule&&c?I.async?A+=" throw new ValidationError(["+x+"]); ":A+=" validate.errors = ["+x+"]; return false; ":A+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t=U,c&&(A+=" break; ")}else if(W)if("failing"==H){A+=" var "+d+" = errors;  ";var T=I.compositeRule;I.compositeRule=s.compositeRule=!0,s.schema=V,s.schemaPath=I.schemaPath+".additionalProperties",s.errSchemaPath=I.errSchemaPath+"/additionalProperties",s.errorPath=I.opts._errorDataPathProperty?I.errorPath:I.util.getPathExpr(I.errorPath,m,I.opts.jsonPointers);var Q=n+"["+m+"]";s.dataPathArr[r]=m;var P=I.validate(s);s.baseId=f,I.util.varOccurences(P,h)<2?A+=" "+I.util.varReplace(P,h,Q)+" ":A+=" var "+h+" = "+Q+"; "+P+" ",A+=" if (!"+Z+") { errors = "+d+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+n+"["+m+"]; }  ",I.compositeRule=s.compositeRule=T}else{s.schema=V,s.schemaPath=I.schemaPath+".additionalProperties",s.errSchemaPath=I.errSchemaPath+"/additionalProperties",s.errorPath=I.opts._errorDataPathProperty?I.errorPath:I.util.getPathExpr(I.errorPath,m,I.opts.jsonPointers);Q=n+"["+m+"]";s.dataPathArr[r]=m;P=I.validate(s);s.baseId=f,I.util.varOccurences(P,h)<2?A+=" "+I.util.varReplace(P,h,Q)+" ":A+=" var "+h+" = "+Q+"; "+P+" ",c&&(A+=" if (!"+Z+") break; ")}I.errorPath=z}p&&(A+=" } "),A+=" }  ",c&&(A+=" if ("+Z+") { ",a+="}")}var O=I.opts.useDefaults&&!I.compositeRule;if(u.length){var j=u;if(j)for(var L,E=-1,_=j.length-1;E<_;){var $=l[L=j[E+=1]];if(I.opts.strictKeywords?"object"==typeof $&&Object.keys($).length>0||!1===$:I.util.schemaHasRules($,I.RULES.all)){var q=I.util.getProperty(L),II=(Q=n+q,O&&void 0!==$.default);s.schema=$,s.schemaPath=o+q,s.errSchemaPath=t+"/"+I.util.escapeFragment(L),s.errorPath=I.util.getPath(I.errorPath,L,I.opts.jsonPointers),s.dataPathArr[r]=I.util.toQuotedString(L);P=I.validate(s);if(s.baseId=f,I.util.varOccurences(P,h)<2){P=I.util.varReplace(P,h,Q);var gI=Q}else{gI=h;A+=" var "+h+" = "+Q+"; "}if(II)A+=" "+P+" ";else{if(w&&w[L]){A+=" if ( "+gI+" === undefined ",R&&(A+=" || ! Object.prototype.hasOwnProperty.call("+n+", '"+I.util.escapeQuotes(L)+"') "),A+=") { "+Z+" = false; ";z=I.errorPath,U=t;var CI,AI=I.util.escapeQuotes(L);I.opts._errorDataPathProperty&&(I.errorPath=I.util.getPath(z,L,I.opts.jsonPointers)),t=I.errSchemaPath+"/required",(CI=CI||[]).push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'required' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { missingProperty: '"+AI+"' } ",!1!==I.opts.messages&&(A+=" , message: '",I.opts._errorDataPathProperty?A+="is a required property":A+="should have required property \\'"+AI+"\\'",A+="' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ";x=A;A=CI.pop(),!I.compositeRule&&c?I.async?A+=" throw new ValidationError(["+x+"]); ":A+=" validate.errors = ["+x+"]; return false; ":A+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",t=U,I.errorPath=z,A+=" } else { "}else c?(A+=" if ( "+gI+" === undefined ",R&&(A+=" || ! Object.prototype.hasOwnProperty.call("+n+", '"+I.util.escapeQuotes(L)+"') "),A+=") { "+Z+" = true; } else { "):(A+=" if ("+gI+" !== undefined ",R&&(A+=" &&   Object.prototype.hasOwnProperty.call("+n+", '"+I.util.escapeQuotes(L)+"') "),A+=" ) { ");A+=" "+P+" } "}}c&&(A+=" if ("+Z+") { ",a+="}")}}if(B.length){var iI=B;if(iI)for(var eI,lI=-1,oI=iI.length-1;lI<oI;){$=y[eI=iI[lI+=1]];if(I.opts.strictKeywords?"object"==typeof $&&Object.keys($).length>0||!1===$:I.util.schemaHasRules($,I.RULES.all)){s.schema=$,s.schemaPath=I.schemaPath+".patternProperties"+I.util.getProperty(eI),s.errSchemaPath=I.errSchemaPath+"/patternProperties/"+I.util.escapeFragment(eI),A+=R?" "+G+" = "+G+" || Object.keys("+n+"); for (var "+b+"=0; "+b+"<"+G+".length; "+b+"++) { var "+m+" = "+G+"["+b+"]; ":" for (var "+m+" in "+n+") { ",A+=" if ("+I.usePattern(eI)+".test("+m+")) { ",s.errorPath=I.util.getPathExpr(I.errorPath,m,I.opts.jsonPointers);Q=n+"["+m+"]";s.dataPathArr[r]=m;P=I.validate(s);s.baseId=f,I.util.varOccurences(P,h)<2?A+=" "+I.util.varReplace(P,h,Q)+" ":A+=" var "+h+" = "+Q+"; "+P+" ",c&&(A+=" if (!"+Z+") break; "),A+=" } ",c&&(A+=" else "+Z+" = true; "),A+=" }  ",c&&(A+=" if ("+Z+") { ",a+="}")}}}return c&&(A+=" "+a+" if ("+d+" == errors) {"),A},propertyNames:function(I,g,C){var A=" ",i=I.level,e=I.dataLevel,l=I.schema[g],o=I.schemaPath+I.util.getProperty(g),t=I.errSchemaPath+"/"+g,c=!I.opts.allErrors,n="data"+(e||""),d="errs__"+i,s=I.util.copy(I);s.level++;var a="valid"+s.level;if(A+="var "+d+" = errors;",I.opts.strictKeywords?"object"==typeof l&&Object.keys(l).length>0||!1===l:I.util.schemaHasRules(l,I.RULES.all)){s.schema=l,s.schemaPath=o,s.errSchemaPath=t;var Z="key"+i,m="idx"+i,b="i"+i,r="' + "+Z+" + '",h="data"+(s.dataLevel=I.dataLevel+1),G="dataProperties"+i,u=I.opts.ownProperties,y=I.baseId;u&&(A+=" var "+G+" = undefined; "),A+=u?" "+G+" = "+G+" || Object.keys("+n+"); for (var "+m+"=0; "+m+"<"+G+".length; "+m+"++) { var "+Z+" = "+G+"["+m+"]; ":" for (var "+Z+" in "+n+") { ",A+=" var startErrs"+i+" = errors; ";var B=Z,V=I.compositeRule;I.compositeRule=s.compositeRule=!0;var p=I.validate(s);s.baseId=y,I.util.varOccurences(p,h)<2?A+=" "+I.util.varReplace(p,h,B)+" ":A+=" var "+h+" = "+B+"; "+p+" ",I.compositeRule=s.compositeRule=V,A+=" if (!"+a+") { for (var "+b+"=startErrs"+i+"; "+b+"<errors; "+b+"++) { vErrors["+b+"].propertyName = "+Z+"; }   var err =   ",!1!==I.createErrors?(A+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { propertyName: '"+r+"' } ",!1!==I.opts.messages&&(A+=" , message: 'property name \\'"+r+"\\' is invalid' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ",A+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!I.compositeRule&&c&&(I.async?A+=" throw new ValidationError(vErrors); ":A+=" validate.errors = vErrors; return false; "),c&&(A+=" break; "),A+=" } }"}return c&&(A+="  if ("+d+" == errors) {"),A},required:function(I,g,C){var A=" ",i=I.level,e=I.dataLevel,l=I.schema[g],o=I.schemaPath+I.util.getProperty(g),t=I.errSchemaPath+"/"+g,c=!I.opts.allErrors,n="data"+(e||""),d="valid"+i,s=I.opts.$data&&l&&l.$data;s&&(A+=" var schema"+i+" = "+I.util.getData(l.$data,e,I.dataPathArr)+"; ");var a="schema"+i;if(!s)if(l.length<I.opts.loopRequired&&I.schema.properties&&Object.keys(I.schema.properties).length){var Z=[],m=l;if(m)for(var b,r=-1,h=m.length-1;r<h;){b=m[r+=1];var G=I.schema.properties[b];G&&(I.opts.strictKeywords?"object"==typeof G&&Object.keys(G).length>0||!1===G:I.util.schemaHasRules(G,I.RULES.all))||(Z[Z.length]=b)}}else Z=l;if(s||Z.length){var u=I.errorPath,y=s||Z.length>=I.opts.loopRequired,B=I.opts.ownProperties;if(c)if(A+=" var missing"+i+"; ",y){s||(A+=" var "+a+" = validate.schema"+o+"; ");var V="' + "+(R="schema"+i+"["+(W="i"+i)+"]")+" + '";I.opts._errorDataPathProperty&&(I.errorPath=I.util.getPathExpr(u,R,I.opts.jsonPointers)),A+=" var "+d+" = true; ",s&&(A+=" if (schema"+i+" === undefined) "+d+" = true; else if (!Array.isArray(schema"+i+")) "+d+" = false; else {"),A+=" for (var "+W+" = 0; "+W+" < "+a+".length; "+W+"++) { "+d+" = "+n+"["+a+"["+W+"]] !== undefined ",B&&(A+=" &&   Object.prototype.hasOwnProperty.call("+n+", "+a+"["+W+"]) "),A+="; if (!"+d+") break; } ",s&&(A+="  }  "),A+="  if (!"+d+") {   ",(Y=Y||[]).push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'required' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { missingProperty: '"+V+"' } ",!1!==I.opts.messages&&(A+=" , message: '",I.opts._errorDataPathProperty?A+="is a required property":A+="should have required property \\'"+V+"\\'",A+="' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ";var p=A;A=Y.pop(),!I.compositeRule&&c?I.async?A+=" throw new ValidationError(["+p+"]); ":A+=" validate.errors = ["+p+"]; return false; ":A+=" var err = "+p+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",A+=" } else { "}else{A+=" if ( ";var X=Z;if(X)for(var W=-1,H=X.length-1;W<H;){K=X[W+=1],W&&(A+=" || "),A+=" ( ( "+(F=n+(S=I.util.getProperty(K)))+" === undefined ",B&&(A+=" || ! Object.prototype.hasOwnProperty.call("+n+", '"+I.util.escapeQuotes(K)+"') "),A+=") && (missing"+i+" = "+I.util.toQuotedString(I.opts.jsonPointers?K:S)+") ) "}A+=") {  ";var Y;V="' + "+(R="missing"+i)+" + '";I.opts._errorDataPathProperty&&(I.errorPath=I.opts.jsonPointers?I.util.getPathExpr(u,R,!0):u+" + "+R),(Y=Y||[]).push(A),A="",!1!==I.createErrors?(A+=" { keyword: 'required' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { missingProperty: '"+V+"' } ",!1!==I.opts.messages&&(A+=" , message: '",I.opts._errorDataPathProperty?A+="is a required property":A+="should have required property \\'"+V+"\\'",A+="' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ";p=A;A=Y.pop(),!I.compositeRule&&c?I.async?A+=" throw new ValidationError(["+p+"]); ":A+=" validate.errors = ["+p+"]; return false; ":A+=" var err = "+p+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",A+=" } else { "}else if(y){s||(A+=" var "+a+" = validate.schema"+o+"; ");var R;V="' + "+(R="schema"+i+"["+(W="i"+i)+"]")+" + '";I.opts._errorDataPathProperty&&(I.errorPath=I.util.getPathExpr(u,R,I.opts.jsonPointers)),s&&(A+=" if ("+a+" && !Array.isArray("+a+")) {  var err =   ",!1!==I.createErrors?(A+=" { keyword: 'required' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { missingProperty: '"+V+"' } ",!1!==I.opts.messages&&(A+=" , message: '",I.opts._errorDataPathProperty?A+="is a required property":A+="should have required property \\'"+V+"\\'",A+="' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ",A+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+a+" !== undefined) { "),A+=" for (var "+W+" = 0; "+W+" < "+a+".length; "+W+"++) { if ("+n+"["+a+"["+W+"]] === undefined ",B&&(A+=" || ! Object.prototype.hasOwnProperty.call("+n+", "+a+"["+W+"]) "),A+=") {  var err =   ",!1!==I.createErrors?(A+=" { keyword: 'required' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { missingProperty: '"+V+"' } ",!1!==I.opts.messages&&(A+=" , message: '",I.opts._errorDataPathProperty?A+="is a required property":A+="should have required property \\'"+V+"\\'",A+="' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ",A+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",s&&(A+="  }  ")}else{var f=Z;if(f)for(var K,w=-1,J=f.length-1;w<J;){K=f[w+=1];var S=I.util.getProperty(K),F=(V=I.util.escapeQuotes(K),n+S);I.opts._errorDataPathProperty&&(I.errorPath=I.util.getPath(u,K,I.opts.jsonPointers)),A+=" if ( "+F+" === undefined ",B&&(A+=" || ! Object.prototype.hasOwnProperty.call("+n+", '"+I.util.escapeQuotes(K)+"') "),A+=") {  var err =   ",!1!==I.createErrors?(A+=" { keyword: 'required' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(t)+" , params: { missingProperty: '"+V+"' } ",!1!==I.opts.messages&&(A+=" , message: '",I.opts._errorDataPathProperty?A+="is a required property":A+="should have required property \\'"+V+"\\'",A+="' "),I.opts.verbose&&(A+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+n+" "),A+=" } "):A+=" {} ",A+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}I.errorPath=u}else c&&(A+=" if (true) {");return A},uniqueItems:function(I,g,C){var A,i=" ",e=I.level,l=I.dataLevel,o=I.schema[g],t=I.schemaPath+I.util.getProperty(g),c=I.errSchemaPath+"/"+g,n=!I.opts.allErrors,d="data"+(l||""),s="valid"+e,a=I.opts.$data&&o&&o.$data;if(a?(i+=" var schema"+e+" = "+I.util.getData(o.$data,l,I.dataPathArr)+"; ",A="schema"+e):A=o,(o||a)&&!1!==I.opts.uniqueItems){a&&(i+=" var "+s+"; if ("+A+" === false || "+A+" === undefined) "+s+" = true; else if (typeof "+A+" != 'boolean') "+s+" = false; else { "),i+=" var i = "+d+".length , "+s+" = true , j; if (i > 1) { ";var Z=I.schema.items&&I.schema.items.type,m=Array.isArray(Z);if(!Z||"object"==Z||"array"==Z||m&&(Z.indexOf("object")>=0||Z.indexOf("array")>=0))i+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+d+"[i], "+d+"[j])) { "+s+" = false; break outer; } } } ";else{i+=" var itemIndices = {}, item; for (;i--;) { var item = "+d+"[i]; ";var b="checkDataType"+(m?"s":"");i+=" if ("+I.util[b](Z,"item",I.opts.strictNumbers,!0)+") continue; ",m&&(i+=" if (typeof item == 'string') item = '\"' + item; "),i+=" if (typeof itemIndices[item] == 'number') { "+s+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}i+=" } ",a&&(i+="  }  "),i+=" if (!"+s+") {   ";var r=r||[];r.push(i),i="",!1!==I.createErrors?(i+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(c)+" , params: { i: i, j: j } ",!1!==I.opts.messages&&(i+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),I.opts.verbose&&(i+=" , schema:  ",i+=a?"validate.schema"+t:""+o,i+="         , parentSchema: validate.schema"+I.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var h=i;i=r.pop(),!I.compositeRule&&n?I.async?i+=" throw new ValidationError(["+h+"]); ":i+=" validate.errors = ["+h+"]; return false; ":i+=" var err = "+h+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",n&&(i+=" else { ")}else n&&(i+=" if (true) { ");return i},validate:Rs},ua=Dd.toHash,ya=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"],Ba=Xs.MissingRef,Va=function I(g,C,A){var i=this;if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");"function"==typeof C&&(A=C,C=void 0);var e=l(g).then((function(){var I=i._addSchema(g,void 0,C);return I.validate||o(I)}));A&&e.then((function(I){A(null,I)}),A);return e;function l(g){var C=g.$schema;return C&&!i.getSchema(C)?I.call(i,{$ref:C},!0):Promise.resolve()}function o(I){try{return i._compile(I)}catch(im){if(im instanceof Ba)return function(g){var A=g.missingSchema;if(c(A))throw new Error("Schema "+A+" is loaded but "+g.missingRef+" cannot be resolved");var e=i._loadingSchemas[A];e||(e=i._loadingSchemas[A]=i._opts.loadSchema(A)).then(t,t);return e.then((function(I){if(!c(A))return l(I).then((function(){c(A)||i.addSchema(I,A,void 0,C)}))})).then((function(){return o(I)}));function t(){delete i._loadingSchemas[A]}function c(I){return i._refs[I]||i._schemas[I]}}(im);throw im}}};var pa={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0},Xa=pa,Wa={$id:"https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:Xa.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:Xa.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}},Ha=/^[a-z_$][a-z0-9_$-]*$/i,Ya=function(I,g,C){var A,i,e=" ",l=I.level,o=I.dataLevel,t=I.schema[g],c=I.schemaPath+I.util.getProperty(g),n=I.errSchemaPath+"/"+g,d=!I.opts.allErrors,s="data"+(o||""),a="valid"+l,Z="errs__"+l,m=I.opts.$data&&t&&t.$data;m?(e+=" var schema"+l+" = "+I.util.getData(t.$data,o,I.dataPathArr)+"; ",i="schema"+l):i=t;var b,r,h,G,u,y=this,B="definition"+l,V=y.definition,p="";if(m&&V.$data){u="keywordValidate"+l;var X=V.validateSchema;e+=" var "+B+" = RULES.custom['"+g+"'].definition; var "+u+" = "+B+".validate;"}else{if(!(G=I.useCustomRule(y,t,I.schema,I)))return;i="validate.schema"+c,u=G.code,b=V.compile,r=V.inline,h=V.macro}var W=u+".errors",H="i"+l,Y="ruleErr"+l,R=V.async;if(R&&!I.async)throw new Error("async keyword in sync schema");if(r||h||(e+=W+" = null;"),e+="var "+Z+" = errors;var "+a+";",m&&V.$data&&(p+="}",e+=" if ("+i+" === undefined) { "+a+" = true; } else { ",X&&(p+="}",e+=" "+a+" = "+B+".validateSchema("+i+"); if ("+a+") { ")),r)V.statements?e+=" "+G.validate+" ":e+=" "+a+" = "+G.validate+"; ";else if(h){var f=I.util.copy(I);p="";f.level++;var K="valid"+f.level;f.schema=G.validate,f.schemaPath="";var w=I.compositeRule;I.compositeRule=f.compositeRule=!0;var J=I.validate(f).replace(/validate\.schema/g,u);I.compositeRule=f.compositeRule=w,e+=" "+J}else{(v=v||[]).push(e),e="",e+="  "+u+".call( ",I.opts.passContext?e+="this":e+="self",b||!1===V.schema?e+=" , "+s+" ":e+=" , "+i+" , "+s+" , validate.schema"+I.schemaPath+" ",e+=" , (dataPath || '')",'""'!=I.errorPath&&(e+=" + "+I.errorPath);var S=o?"data"+(o-1||""):"parentData",F=o?I.dataPathArr[o]:"parentDataProperty",N=e+=" , "+S+" , "+F+" , rootData )  ";e=v.pop(),!1===V.errors?(e+=" "+a+" = ",R&&(e+="await "),e+=N+"; "):e+=R?" var "+(W="customErrors"+l)+" = null; try { "+a+" = await "+N+"; } catch (e) { "+a+" = false; if (e instanceof ValidationError) "+W+" = e.errors; else throw e; } ":" "+W+" = null; "+a+" = "+N+"; "}if(V.modifying&&(e+=" if ("+S+") "+s+" = "+S+"["+F+"];"),e+=""+p,V.valid)d&&(e+=" if (true) { ");else{var v;e+=" if ( ",void 0===V.valid?(e+=" !",e+=h?""+K:""+a):e+=" "+!V.valid+" ",e+=") { ",A=y.keyword,(v=v||[]).push(e),e="",(v=v||[]).push(e),e="",!1!==I.createErrors?(e+=" { keyword: '"+(A||"custom")+"' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(n)+" , params: { keyword: '"+y.keyword+"' } ",!1!==I.opts.messages&&(e+=" , message: 'should pass \""+y.keyword+"\" keyword validation' "),I.opts.verbose&&(e+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+s+" "),e+=" } "):e+=" {} ";var k=e;e=v.pop(),!I.compositeRule&&d?I.async?e+=" throw new ValidationError(["+k+"]); ":e+=" validate.errors = ["+k+"]; return false; ":e+=" var err = "+k+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var D=e;e=v.pop(),r?V.errors?"full"!=V.errors&&(e+="  for (var "+H+"="+Z+"; "+H+"<errors; "+H+"++) { var "+Y+" = vErrors["+H+"]; if ("+Y+".dataPath === undefined) "+Y+".dataPath = (dataPath || '') + "+I.errorPath+"; if ("+Y+".schemaPath === undefined) { "+Y+'.schemaPath = "'+n+'"; } ',I.opts.verbose&&(e+=" "+Y+".schema = "+i+"; "+Y+".data = "+s+"; "),e+=" } "):!1===V.errors?e+=" "+D+" ":(e+=" if ("+Z+" == errors) { "+D+" } else {  for (var "+H+"="+Z+"; "+H+"<errors; "+H+"++) { var "+Y+" = vErrors["+H+"]; if ("+Y+".dataPath === undefined) "+Y+".dataPath = (dataPath || '') + "+I.errorPath+"; if ("+Y+".schemaPath === undefined) { "+Y+'.schemaPath = "'+n+'"; } ',I.opts.verbose&&(e+=" "+Y+".schema = "+i+"; "+Y+".data = "+s+"; "),e+=" } } "):h?(e+="   var err =   ",!1!==I.createErrors?(e+=" { keyword: '"+(A||"custom")+"' , dataPath: (dataPath || '') + "+I.errorPath+" , schemaPath: "+I.util.toQuotedString(n)+" , params: { keyword: '"+y.keyword+"' } ",!1!==I.opts.messages&&(e+=" , message: 'should pass \""+y.keyword+"\" keyword validation' "),I.opts.verbose&&(e+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+I.schemaPath+" , data: "+s+" "),e+=" } "):e+=" {} ",e+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!I.compositeRule&&d&&(I.async?e+=" throw new ValidationError(vErrors); ":e+=" validate.errors = vErrors; return false; ")):!1===V.errors?e+=" "+D+" ":(e+=" if (Array.isArray("+W+")) { if (vErrors === null) vErrors = "+W+"; else vErrors = vErrors.concat("+W+"); errors = vErrors.length;  for (var "+H+"="+Z+"; "+H+"<errors; "+H+"++) { var "+Y+" = vErrors["+H+"]; if ("+Y+".dataPath === undefined) "+Y+".dataPath = (dataPath || '') + "+I.errorPath+";  "+Y+'.schemaPath = "'+n+'";  ',I.opts.verbose&&(e+=" "+Y+".schema = "+i+"; "+Y+".data = "+s+"; "),e+=" } } else { "+D+" } "),e+=" } ",d&&(e+=" else { ")}return e},Ra=Wa,fa={add:function(I,g){var C=this.RULES;if(C.keywords[I])throw new Error("Keyword "+I+" is already defined");if(!Ha.test(I))throw new Error("Keyword "+I+" is not a valid identifier");if(g){this.validateKeyword(g,!0);var A=g.type;if(Array.isArray(A))for(var i=0;i<A.length;i++)l(I,A[i],g);else l(I,A,g);var e=g.metaSchema;e&&(g.$data&&this._opts.$data&&(e={anyOf:[e,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]}),g.validateSchema=this.compile(e,!0))}function l(I,g,A){for(var i,e=0;e<C.length;e++){var l=C[e];if(l.type==g){i=l;break}}i||(i={type:g,rules:[]},C.push(i));var o={keyword:I,definition:A,custom:!0,code:Ya,implements:A.implements};i.rules.push(o),C.custom[I]=o}return C.keywords[I]=C.all[I]=!0,this},get:function(I){var g=this.RULES.custom[I];return g?g.definition:this.RULES.keywords[I]||!1},remove:function(I){var g=this.RULES;delete g.keywords[I],delete g.all[I],delete g.custom[I];for(var C=0;C<g.length;C++)for(var A=g[C].rules,i=0;i<A.length;i++)if(A[i].keyword==I){A.splice(i,1);break}return this},validate:function I(g,C){I.errors=null;var A=this._validateKeyword=this._validateKeyword||this.compile(Ra,!0);if(A(g))return!0;if(I.errors=A.errors,C)throw new Error("custom keyword definition is invalid: "+this.errorsText(A.errors));return!1}};var Ka={$schema:"http://json-schema.org/draft-07/schema#",$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON Schema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1},wa=ks,Ja=cs,Sa=Os.exports,Fa=Is,Na=Ys,va=oa,ka=function(){var I=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],g=["type","$comment"];return I.all=ua(g),I.types=ua(["number","integer","string","array","object","boolean","null"]),I.forEach((function(C){C.rules=C.rules.map((function(C){var A;if("object"==typeof C){var i=Object.keys(C)[0];A=C[i],C=i,A.forEach((function(C){g.push(C),I.all[C]=!0}))}return g.push(C),I.all[C]={keyword:C,code:Ga[C],implements:A}})),I.all.$comment={keyword:"$comment",code:Ga.$comment},C.type&&(I.types[C.type]=C)})),I.keywords=ua(g.concat(["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"])),I.custom={},I},Da=function(I,g){for(var C=0;C<g.length;C++){I=JSON.parse(JSON.stringify(I));var A,i=g[C].split("/"),e=I;for(A=1;A<i.length;A++)e=e[i[A]];for(A=0;A<ya.length;A++){var l=ya[A],o=e[l];o&&(e[l]={anyOf:[o,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]})}}return I},za=Dd,Ma=Oa;Oa.prototype.validate=function(I,g){var C;if("string"==typeof I){if(!(C=this.getSchema(I)))throw new Error('no schema with key or ref "'+I+'"')}else{var A=this._addSchema(I);C=A.validate||this._compile(A)}var i=C(g);!0!==C.$async&&(this.errors=C.errors);return i},Oa.prototype.compile=function(I,g){var C=this._addSchema(I,void 0,g);return C.validate||this._compile(C)},Oa.prototype.addSchema=function(I,g,C,A){if(Array.isArray(I)){for(var i=0;i<I.length;i++)this.addSchema(I[i],void 0,C,A);return this}var e=this._getId(I);if(void 0!==e&&"string"!=typeof e)throw new Error("schema id must be string");return qa(this,g=Ja.normalizeId(g||e)),this._schemas[g]=this._addSchema(I,C,A,!0),this},Oa.prototype.addMetaSchema=function(I,g,C){return this.addSchema(I,g,C,!0),this},Oa.prototype.validateSchema=function(I,g){var C=I.$schema;if(void 0!==C&&"string"!=typeof C)throw new Error("$schema must be a string");if(!(C=C||this._opts.defaultMeta||function(I){var g=I._opts.meta;return I._opts.defaultMeta="object"==typeof g?I._getId(g)||g:I.getSchema(Ta)?Ta:void 0,I._opts.defaultMeta}(this)))return this.logger.warn("meta-schema not available"),this.errors=null,!0;var A=this.validate(C,I);if(!A&&g){var i="schema is invalid: "+this.errorsText();if("log"!=this._opts.validateSchema)throw new Error(i);this.logger.error(i)}return A},Oa.prototype.getSchema=function(I){var g=ja(this,I);switch(typeof g){case"object":return g.validate||this._compile(g);case"string":return this.getSchema(g);case"undefined":return function(I,g){var C=Ja.schema.call(I,{schema:{}},g);if(C){var A=C.schema,i=C.root,e=C.baseId,l=wa.call(I,A,i,void 0,e);return I._fragments[g]=new Fa({ref:g,fragment:!0,schema:A,root:i,baseId:e,validate:l}),l}}(this,I)}},Oa.prototype.removeSchema=function(I){if(I instanceof RegExp)return La(this,this._schemas,I),La(this,this._refs,I),this;switch(typeof I){case"undefined":return La(this,this._schemas),La(this,this._refs),this._cache.clear(),this;case"string":var g=ja(this,I);return g&&this._cache.del(g.cacheKey),delete this._schemas[I],delete this._refs[I],this;case"object":var C=this._opts.serialize,A=C?C(I):I;this._cache.del(A);var i=this._getId(I);i&&(i=Ja.normalizeId(i),delete this._schemas[i],delete this._refs[i])}return this},Oa.prototype.addFormat=function(I,g){"string"==typeof g&&(g=new RegExp(g));return this._formats[I]=g,this},Oa.prototype.errorsText=function(I,g){if(!(I=I||this.errors))return"No errors";for(var C=void 0===(g=g||{}).separator?", ":g.separator,A=void 0===g.dataVar?"data":g.dataVar,i="",e=0;e<I.length;e++){var l=I[e];l&&(i+=A+l.dataPath+" "+l.message+C)}return i.slice(0,-C.length)},Oa.prototype._addSchema=function(I,g,C,A){if("object"!=typeof I&&"boolean"!=typeof I)throw new Error("schema should be object or boolean");var i=this._opts.serialize,e=i?i(I):I,l=this._cache.get(e);if(l)return l;A=A||!1!==this._opts.addUsedSchema;var o=Ja.normalizeId(this._getId(I));o&&A&&qa(this,o);var t,c=!1!==this._opts.validateSchema&&!g;c&&!(t=o&&o==Ja.normalizeId(I.$schema))&&this.validateSchema(I,!0);var n=Ja.ids.call(this,I),d=new Fa({id:o,schema:I,localRefs:n,cacheKey:e,meta:C});"#"!=o[0]&&A&&(this._refs[o]=d);this._cache.put(e,d),c&&t&&this.validateSchema(I,!0);return d},Oa.prototype._compile=function(I,g){if(I.compiling)return I.validate=i,i.schema=I.schema,i.errors=null,i.root=g||i,!0===I.schema.$async&&(i.$async=!0),i;var C,A;I.compiling=!0,I.meta&&(C=this._opts,this._opts=this._metaOpts);try{A=wa.call(this,I.schema,g,I.localRefs)}catch(im){throw delete I.validate,im}finally{I.compiling=!1,I.meta&&(this._opts=C)}return I.validate=A,I.refs=A.refs,I.refVal=A.refVal,I.root=A.root,A;function i(){var g=I.validate,C=g.apply(this,arguments);return i.errors=g.errors,C}},Oa.prototype.compileAsync=Va;var Ua=fa;Oa.prototype.addKeyword=Ua.add,Oa.prototype.getKeyword=Ua.get,Oa.prototype.removeKeyword=Ua.remove,Oa.prototype.validateKeyword=Ua.validate;var xa=Xs;Oa.ValidationError=xa.Validation,Oa.MissingRefError=xa.MissingRef,Oa.$dataMetaSchema=Da;var Ta="http://json-schema.org/draft-07/schema",Qa=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],Pa=["/properties"];function Oa(I){if(!(this instanceof Oa))return new Oa(I);I=this._opts=za.copy(I)||{},function(I){var g=I._opts.logger;if(!1===g)I.logger={log:IZ,warn:IZ,error:IZ};else{if(void 0===g&&(g=console),!("object"==typeof g&&g.log&&g.warn&&g.error))throw new Error("logger must implement log, warn and error methods");I.logger=g}}(this),this._schemas={},this._refs={},this._fragments={},this._formats=va(I.format),this._cache=I.cache||new Sa,this._loadingSchemas={},this._compilations=[],this.RULES=ka(),this._getId=function(I){switch(I.schemaId){case"auto":return $a;case"id":return Ea;default:return _a}}(I),I.loopRequired=I.loopRequired||1/0,"property"==I.errorDataPath&&(I._errorDataPathProperty=!0),void 0===I.serialize&&(I.serialize=Na),this._metaOpts=function(I){for(var g=za.copy(I._opts),C=0;C<Qa.length;C++)delete g[Qa[C]];return g}(this),I.formats&&function(I){for(var g in I._opts.formats){var C=I._opts.formats[g];I.addFormat(g,C)}}(this),I.keywords&&function(I){for(var g in I._opts.keywords){var C=I._opts.keywords[g];I.addKeyword(g,C)}}(this),function(I){var g;I._opts.$data&&(g=Ka,I.addMetaSchema(g,g.$id,!0));if(!1===I._opts.meta)return;var C=pa;I._opts.$data&&(C=Da(C,Pa));I.addMetaSchema(C,Ta,!0),I._refs["http://json-schema.org/schema"]=Ta}(this),"object"==typeof I.meta&&this.addMetaSchema(I.meta),I.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),function(I){var g=I._opts.schemas;if(!g)return;if(Array.isArray(g))I.addSchema(g);else for(var C in g)I.addSchema(g[C],C)}(this)}function ja(I,g){return g=Ja.normalizeId(g),I._schemas[g]||I._refs[g]||I._fragments[g]}function La(I,g,C){for(var A in g){var i=g[A];i.meta||C&&!C.test(A)||(I._cache.del(i.cacheKey),delete g[A])}}function Ea(I){return I.$id&&this.logger.warn("schema $id ignored",I.$id),I.id}function _a(I){return I.id&&this.logger.warn("schema id ignored",I.id),I.$id}function $a(I){if(I.$id&&I.id&&I.$id!=I.id)throw new Error("schema $id is different from id");return I.$id||I.id}function qa(I,g){if(I._schemas[g]||I._refs[g])throw new Error('schema with key or id "'+g+'" already exists')}function IZ(){}function gZ(I){return CZ(cI,I)}function CZ(I,g){var C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=new Ma({extendRefs:!0}).compile(I),i=A(g),e="",l="";return A.errors&&(l=JSON.stringify(A.errors,null,2),C||console.warn(l),e="\u26a0\ufe0f Some properties are incorrectly used."),{state:i?"success":"warn",message:e,details:l}}function AZ(I){var g=!0,C=[];return HI(I).forEach((function(I){iZ(I)||"brush"===I.mark||"rule"===I.mark||(C.push("genomic type is not encoded to either a x- or y- axis"),g=!1);var A=I.color;"line"===I.mark&&DI(A)&&"quantitative"===A.type&&(C.push("`line` mark cannot be used with `quantitative` value"),g=!1)})),{valid:g,errorMessages:C}}function iZ(I){var g=void 0;return["x","y","xe","ye","x1","y1","x1e","y1e"].reverse().forEach((function(C){var A=I[C];DI(A)&&"genomic"===A.type&&(g=A)})),g}function eZ(I){var g=void 0;return["x","xe","y","ye","x1","y1","x1e","y1e"].reverse().forEach((function(C){var A=I[C];DI(A)&&"genomic"===A.type&&(g=C)})),g}var lZ={$ref:"#/definitions/HiGlassSpec",$schema:"http://json-schema.org/draft-07/schema#",definitions:{Assembly:{enum:["hg38","hg19","hg18","hg17","hg16","mm10","mm9","unknown"],type:"string"},CombinedTrack:{additionalProperties:!1,properties:{contents:{items:{$ref:"#/definitions/Track"},type:"array"},height:{type:"number"},options:{},position:{type:"string"},type:{const:"combined",type:"string"},uid:{type:"string"},width:{type:"number"}},required:["type","contents"],type:"object"},Data:{additionalProperties:!1,properties:{assembly:{$ref:"#/definitions/Assembly"},children:{items:{},type:"array"},filter:{items:{$ref:"#/definitions/FilterTransform"},type:"array"},tiles:{},tilesetInfo:{},type:{type:"string"},url:{type:"string"}},type:"object"},EnumTrack:{additionalProperties:!1,properties:{chromInfoPath:{type:"string"},data:{$ref:"#/definitions/Data"},fromViewUid:{type:["null","string"]},height:{type:"number"},options:{},server:{type:"string"},tilesetUid:{type:"string"},type:{$ref:"#/definitions/EnumTrackType"},uid:{type:"string"},width:{type:"number"},x:{type:"number"},y:{type:"number"}},required:["type"],type:"object"},EnumTrackType:{enum:["heatmap","2d-annotations","2d-chromosome-annotations","2d-chromosome-grid","2d-chromosome-labels","2d-rectangle-domains","2d-tiles","arrowhead-domains","bedlike","cross-rule","dummy","horizontal-1d-annotations","horizontal-1d-heatmap","horizontal-1d-tiles","horizontal-1d-value-interval","horizontal-2d-rectangle-domains","horizontal-bar","horizontal-chromosome-grid","horizontal-chromosome-labels","horizontal-divergent-bar","horizontal-gene-annotations","horizontal-heatmap","horizontal-line","horizontal-multivec","horizontal-point","horizontal-rule","horizontal-vector-heatmap","image-tiles","left-axis","left-stacked-interval","mapbox-tiles","osm-2d-tile-ids","osm-tiles","raster-tiles","simple-svg","square-markers","top-axis","top-stacked-interval","vertical-1d-annotations","vertical-1d-heatmap","vertical-1d-tiles","vertical-1d-value-interval","vertical-2d-rectangle-domains","vertical-bar","vertical-bedlike","vertical-chromosome-grid","vertical-chromosome-labels","vertical-gene-annotations","vertical-heatmap","vertical-line","vertical-multivec","vertical-point","vertical-rule","vertical-vector-heatmap","viewport-projection-center","viewport-projection-horizontal","viewport-projection-vertical","gosling-track","gosling-2d-track","axis-track","text"],type:"string"},FilterTransform:{anyOf:[{$ref:"#/definitions/OneOfFilter"},{$ref:"#/definitions/RangeFilter"},{$ref:"#/definitions/IncludeFilter"}]},GenericLocks:{additionalProperties:!1,properties:{locksByViewUid:{$ref:"#/definitions/LocksByViewUid"},locksDict:{}},required:["locksByViewUid","locksDict"],type:"object"},GenomePositionSearchBox:{additionalProperties:!1,properties:{autocompleteId:{type:"string"},autocompleteServer:{type:"string"},chromInfoId:{type:"string"},chromInfoServer:{type:"string"},visible:{type:"boolean"}},required:["chromInfoId","chromInfoServer"],type:"object"},HeatmapTrack:{additionalProperties:!1,properties:{data:{$ref:"#/definitions/Data"},height:{type:"number"},options:{},position:{type:"string"},server:{type:"string"},tilesetUid:{type:"string"},type:{const:"heatmap",type:"string"},uid:{type:"string"},width:{type:"number"}},required:["type"],type:"object"},HiGlassSpec:{additionalProperties:!1,properties:{chromInfoPath:{type:"string"},compactLayout:{type:"boolean"},editable:{type:"boolean"},exportViewUrl:{type:"string"},locationLocks:{$ref:"#/definitions/GenericLocks"},trackSourceServers:{items:{type:"string"},type:"array"},tracksEditable:{type:"boolean"},valueScaleLocks:{$ref:"#/definitions/ValueScaleLocks"},viewEditable:{type:"boolean"},views:{items:{$ref:"#/definitions/View"},type:"array"},zoomFixed:{type:"boolean"},zoomLocks:{$ref:"#/definitions/GenericLocks"}},required:["views","zoomLocks","locationLocks"],type:"object"},IncludeFilter:{additionalProperties:!1,properties:{field:{description:"A filter is applied based on the values of the specified data field",type:"string"},include:{description:"Check whether the value includes a substring.",type:"string"},not:{description:'when `{"not": true}`, apply a NOT logical operation to the filter.\n\n__Default:__ `false`',type:"boolean"},type:{const:"filter",type:"string"}},required:["field","include","type"],type:"object"},IndependentViewportProjectionTrack:{additionalProperties:!1,properties:{fromViewUid:{type:"null"},options:{},projectionXDomain:{items:{type:"number"},type:"array"},projectionYDomain:{items:{type:"number"},type:"array"},transforms:{items:{},type:"array"},type:{enum:["viewport-projection-horizontal","viewport-projection-vertical","viewport-projection-center"],type:"string"},uid:{type:"string"},width:{type:"number"},x:{type:"number"},y:{type:"number"}},required:["type"],type:"object"},Layout:{additionalProperties:!1,properties:{h:{type:"number"},w:{type:"number"},x:{type:"number"},y:{type:"number"}},required:["h","w","x","y"],type:"object"},LocksByViewUid:{additionalProperties:{type:"string"},type:"object"},OneOfFilter:{additionalProperties:!1,properties:{field:{description:"A filter is applied based on the values of the specified data field",type:"string"},not:{description:'when `{"not": true}`, apply a NOT logical operation to the filter.\n\n__Default:__ `false`',type:"boolean"},oneOf:{anyOf:[{items:{type:"string"},type:"array"},{items:{type:"number"},type:"array"}],description:"Check whether the value is an element in the provided list."},type:{const:"filter",type:"string"}},required:["field","oneOf","type"],type:"object"},Overlay:{additionalProperties:!1,properties:{chromInfoPath:{type:"string"},includes:{items:{},type:"array"},options:{$ref:"#/definitions/OverlayOptions"},type:{type:"string"},uid:{type:"string"}},type:"object"},OverlayOptions:{additionalProperties:!1,properties:{extent:{items:{},type:"array"},fill:{type:"string"},fillOpacity:{type:"number"},minWidth:{type:"number"},outline:{type:"string"},outlineOpacity:{type:"number"},outlinePos:{anyOf:[{items:{},type:"array"},{type:"string"}]},outlineWidth:{type:"number"},stroke:{type:"string"},strokeOpacity:{type:"number"},strokePos:{anyOf:[{items:{},type:"array"},{type:"string"}]},strokeWidth:{type:"number"}},type:"object"},RangeFilter:{additionalProperties:!1,properties:{field:{description:"A filter is applied based on the values of the specified data field",type:"string"},inRange:{description:"Check whether the value is in a number range.",items:{type:"number"},type:"array"},not:{description:'when `{"not": true}`, apply a NOT logical operation to the filter.\n\n__Default:__ `false`',type:"boolean"},type:{const:"filter",type:"string"}},required:["field","inRange","type"],type:"object"},Track:{anyOf:[{$ref:"#/definitions/HeatmapTrack"},{$ref:"#/definitions/CombinedTrack"},{$ref:"#/definitions/IndependentViewportProjectionTrack"},{$ref:"#/definitions/EnumTrack"}]},Tracks:{additionalProperties:!1,properties:{bottom:{items:{$ref:"#/definitions/Track"},type:"array"},center:{items:{$ref:"#/definitions/Track"},type:"array"},gallery:{items:{$ref:"#/definitions/Track"},type:"array"},left:{items:{$ref:"#/definitions/Track"},type:"array"},right:{items:{$ref:"#/definitions/Track"},type:"array"},top:{items:{$ref:"#/definitions/Track"},type:"array"},whole:{items:{$ref:"#/definitions/Track"},type:"array"}},required:["top","left","center","right","bottom","gallery","whole"],type:"object"},ValueScaleLocks:{additionalProperties:!1,properties:{locksByViewUid:{$ref:"#/definitions/LocksByViewUid"},locksDict:{}},required:["locksByViewUid"],type:"object"},View:{additionalProperties:!1,properties:{autocompleteSource:{type:"string"},chromInfoPath:{type:"string"},genomePositionSearchBox:{$ref:"#/definitions/GenomePositionSearchBox"},genomePositionSearchBoxVisible:{type:"boolean"},initialXDomain:{items:{type:"number"},type:"array"},initialYDomain:{items:{type:"number"},type:"array"},layout:{$ref:"#/definitions/Layout"},overlays:{items:{$ref:"#/definitions/Overlay"},type:"array"},selectionView:{type:"boolean"},tracks:{$ref:"#/definitions/Tracks"},uid:{type:"string"},zoomFixed:{type:"boolean"},zoomLimits:{items:[{type:["number","null"]},{type:["number","null"]}],maxItems:2,minItems:2,type:"array"}},required:["tracks","layout"],type:"object"}}};function oZ(I,g){if("chromosome"in I&&(I.chromosome.includes("chr")&&(I.chromosome=I.chromosome.replace("chr","")),Object.keys(Qg().interval).find((function(g){return g==="chr".concat(I.chromosome)}))||(I.chromosome="1")),function(I){return"chromosome"in I&&!("interval"in I)}(I))return[Qg(g).interval["chr".concat(I.chromosome)][0]+1,Qg(g).interval["chr".concat(I.chromosome)][1]];if(function(I){return!("chromosome"in I)&&"interval"in I}(I))return I.interval;if(function(I){return"chromosome"in I&&"interval"in I}(I)){var C=Qg(g).interval["chr".concat(I.chromosome)][0],A=Object(r.a)(I.interval,2);return[C+A[0],C+A[1]]}}function tZ(I,g){var C={},A=VI;I.forEach((function(I){A.forEach((function(g){var A=I.spec()[g];if(DI(A)&&void 0!==A.domain){var i=A.domain,e=A.type;if("quantitative"===e){var l=Array.from(i);C[g]?(C[g][0]>l[0]&&(C[g][0]=l[0]),C[g][1]<l[1]&&(C[g][1]=l[1])):C[g]=l}else if("nominal"===e){var o=Array.from(i);C[g]?C[g]=Array.from(new Set([].concat(Object(b.a)(C[g]),Object(b.a)(o)))):C[g]=o}}}))})),I.forEach((function(I){A.forEach((function(A){var i=I.spec()[A];DI(i)&&"genomic"===i.type||(I.setChannelDomain(A,C[A],g),I.generateScales())})),I.updateChannelValue()}))}var cZ={compactLayout:!1,trackSourceServers:["https://server.gosling-lang.org/api/v1/"],views:[{genomePositionSearchBoxVisible:!1,genomePositionSearchBox:{autocompleteServer:"https://higlass.io/api/v1",autocompleteId:"P0PLbQMwTYGy-5uPIQid7A",chromInfoServer:"https://higlass.io/api/v1",chromInfoId:"hg38"},layout:{x:0,y:0,w:6.4,h:600},tracks:{top:[],left:[{type:"combined",width:130,height:600,contents:[{type:"gosling-track",server:"https://server.gosling-lang.org/api/v1/",tilesetUid:"cistrome-multivec",width:130,height:600,options:{showMousePosition:!0,mousePositionColor:"#000000",fontSize:24,labelPosition:"none",labelShowResolution:!1,labelColor:"black",labelBackgroundColor:"white",labelTextOpacity:1,labelLeftMargin:1,labelTopMargin:1,labelRightMargin:0,labelBottomMargin:0,backgroundColor:"transparent",spec:{spacing:10,orientation:"vertical",assembly:"hg38",layout:"linear",static:!1,xDomain:{interval:[0,1e9]},centerRadius:.3,xOffset:0,yOffset:0,style:{outlineWidth:.5},data:{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=cistrome-multivec",type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"],binSize:4},mark:"rect",x:{field:"start",type:"genomic",axis:"left",domain:{interval:[0,1e9]},linkingId:"7f94b74e-25ec-4e67-8c75-3dc0f1b0d6bd"},xe:{field:"end",type:"genomic"},row:{field:"sample",type:"nominal",legend:!0},color:{field:"peak",type:"quantitative",legend:!0},tooltip:[{field:"start",type:"genomic",alt:"Start Position"},{field:"end",type:"genomic",alt:"End Position"},{field:"peak",type:"quantitative",alt:"Value",format:".2"},{field:"sample",type:"nominal",alt:"Sample"}],width:160,height:600,overlayOnPreviousTrack:!1},theme:{base:"light",root:{background:"white",titleColor:"black",titleBackgroundColor:"transparent",titleFontSize:18,titleFontFamily:"Arial",titleAlign:"left",titleFontWeight:"bold",subtitleColor:"gray",subtitleBackgroundColor:"transparent",subtitleFontSize:16,subtitleFontFamily:"Arial",subtitleFontWeight:"normal",subtitleAlign:"left",mousePositionColor:"#000000"},track:{background:"transparent",alternatingBackground:"transparent",titleColor:"black",titleBackground:"white",titleFontSize:24,titleAlign:"left",outline:"black",outlineWidth:1},legend:{position:"top",background:"white",backgroundOpacity:.7,labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",backgroundStroke:"#DBDBDB",tickColor:"black"},axis:{tickColor:"black",labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",baselineColor:"black",gridColor:"#E3E3E3",gridStrokeWidth:1,gridStrokeType:"solid",gridStrokeDash:[4,4]},markCommon:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},point:{color:"#E79F00",size:3,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},rect:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},triangle:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},area:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},line:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},bar:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},rule:{color:"#E79F00",size:1,stroke:"black",strokeWidth:1,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},link:{color:"#E79F00",size:1,stroke:"black",strokeWidth:1,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},text:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6],textAnchor:"middle",textFontWeight:"normal"},brush:{color:"gray",size:1,stroke:"black",strokeWidth:1,opacity:.3,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]}}}}]},{uid:"15483511-f6fb-11eb-914b-976b6ecda162",type:"axis-track",chromInfoPath:"https://s3.amazonaws.com/gosling-lang.org/data/hg38.chrom.sizes",options:{layout:"linear",outerRadius:null,width:160,height:600,theme:{base:"light",root:{background:"white",titleColor:"black",titleBackgroundColor:"transparent",titleFontSize:18,titleFontFamily:"Arial",titleAlign:"left",titleFontWeight:"bold",subtitleColor:"gray",subtitleBackgroundColor:"transparent",subtitleFontSize:16,subtitleFontFamily:"Arial",subtitleFontWeight:"normal",subtitleAlign:"left",mousePositionColor:"#000000"},track:{background:"transparent",alternatingBackground:"transparent",titleColor:"black",titleBackground:"white",titleFontSize:24,titleAlign:"left",outline:"black",outlineWidth:1},legend:{position:"top",background:"white",backgroundOpacity:.7,labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",backgroundStroke:"#DBDBDB",tickColor:"black"},axis:{tickColor:"black",labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",baselineColor:"black",gridColor:"#E3E3E3",gridStrokeWidth:1,gridStrokeType:"solid",gridStrokeDash:[4,4]},markCommon:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},point:{color:"#E79F00",size:3,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},rect:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},triangle:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},area:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},line:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},bar:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},rule:{color:"#E79F00",size:1,stroke:"black",strokeWidth:1,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},link:{color:"#E79F00",size:1,stroke:"black",strokeWidth:1,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},text:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6],textAnchor:"middle",textFontWeight:"normal"},brush:{color:"gray",size:1,stroke:"black",strokeWidth:1,opacity:.3,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]}},assembly:"hg38",stroke:"transparent",color:"black",fontSize:12,fontFamily:"Arial",fontWeight:"normal",tickColor:"black",tickFormat:"plain",tickPositions:"even",reverseOrientation:!1},width:30}],center:[],right:[],bottom:[],gallery:[],whole:[]},initialXDomain:[0,1e9],initialYDomain:[0,1e9],zoomFixed:!1,zoomLimits:[1,null],uid:"15483510-f6fb-11eb-914b-976b6ecda162",chromInfoPath:"https://s3.amazonaws.com/gosling-lang.org/data/hg38.chrom.sizes"},{genomePositionSearchBoxVisible:!1,genomePositionSearchBox:{autocompleteServer:"https://higlass.io/api/v1",autocompleteId:"P0PLbQMwTYGy-5uPIQid7A",chromInfoServer:"https://higlass.io/api/v1",chromInfoId:"hg38"},layout:{x:6.8,y:0,w:5.2,h:600},tracks:{top:[],left:[{type:"combined",width:130,height:600,contents:[{type:"gosling-track",server:"https://server.gosling-lang.org/api/v1/",tilesetUid:"cistrome-multivec",width:130,height:600,options:{showMousePosition:!0,mousePositionColor:"#000000",fontSize:24,labelPosition:"none",labelShowResolution:!1,labelColor:"black",labelBackgroundColor:"white",labelTextOpacity:1,labelLeftMargin:1,labelTopMargin:1,labelRightMargin:0,labelBottomMargin:0,backgroundColor:"transparent",spec:{spacing:10,orientation:"vertical",assembly:"hg38",layout:"linear",static:!1,xDomain:{interval:[0,1e9]},centerRadius:.3,xOffset:0,yOffset:0,style:{outlineWidth:.5},data:{url:"https://server.gosling-lang.org/api/v1/tileset_info/?d=cistrome-multivec",type:"multivec",row:"sample",column:"position",value:"peak",categories:["sample 1","sample 2","sample 3","sample 4"],binSize:4},mark:"rect",x:{field:"start",type:"genomic",domain:{interval:[0,1e9]},linkingId:"7f94b74e-25ec-4e67-8c75-3dc0f1b0d6bd"},xe:{field:"end",type:"genomic"},row:{field:"sample",type:"nominal",legend:!0},color:{field:"peak",type:"quantitative",legend:!0},tooltip:[{field:"start",type:"genomic",alt:"Start Position"},{field:"end",type:"genomic",alt:"End Position"},{field:"peak",type:"quantitative",alt:"Value",format:".2"},{field:"sample",type:"nominal",alt:"Sample"}],width:130,height:600},theme:{base:"light",root:{background:"white",titleColor:"black",titleBackgroundColor:"transparent",titleFontSize:18,titleFontFamily:"Arial",titleAlign:"left",titleFontWeight:"bold",subtitleColor:"gray",subtitleBackgroundColor:"transparent",subtitleFontSize:16,subtitleFontFamily:"Arial",subtitleFontWeight:"normal",subtitleAlign:"left",mousePositionColor:"#000000"},track:{background:"transparent",alternatingBackground:"transparent",titleColor:"black",titleBackground:"white",titleFontSize:24,titleAlign:"left",outline:"black",outlineWidth:1},legend:{position:"top",background:"white",backgroundOpacity:.7,labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",backgroundStroke:"#DBDBDB",tickColor:"black"},axis:{tickColor:"black",labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",baselineColor:"black",gridColor:"#E3E3E3",gridStrokeWidth:1,gridStrokeType:"solid",gridStrokeDash:[4,4]},markCommon:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},point:{color:"#E79F00",size:3,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},rect:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},triangle:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},area:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},line:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},bar:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},rule:{color:"#E79F00",size:1,stroke:"black",strokeWidth:1,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},link:{color:"#E79F00",size:1,stroke:"black",strokeWidth:1,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]},text:{color:"#E79F00",size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6],textAnchor:"middle",textFontWeight:"normal"},brush:{color:"gray",size:1,stroke:"black",strokeWidth:1,opacity:.3,nominalColorRange:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],quantitativeSizeRange:[2,6]}}}}]}],center:[],right:[],bottom:[],gallery:[],whole:[]},initialXDomain:[0,1e9],initialYDomain:[0,1e9],zoomFixed:!1,zoomLimits:[1,null],uid:"154b1b40-f6fb-11eb-914b-976b6ecda162"}],zoomLocks:{locksByViewUid:{},locksDict:{}},locationLocks:{locksByViewUid:{},locksDict:{}},editable:!1,chromInfoPath:"https://s3.amazonaws.com/gosling-lang.org/data/hg38.chrom.sizes"};function nZ(I,g,C){return[].concat(Object(b.a)(I.slice(0,g)),[C],Object(b.a)(I.slice(g)))}function dZ(I){for(var g=[],C=0;C<I.length;C+=2)g.push([I[C],I[C+1]]);return g}var sZ=30,aZ=function(){function I(){Object(t.a)(this,I),this.assembly="hg38",this.hg={compactLayout:!1,trackSourceServers:[],views:[],zoomLocks:{locksByViewUid:{},locksDict:{}},locationLocks:{locksByViewUid:{},locksDict:{}}},this.setEditable(!1)}return Object(c.a)(I,[{key:"spec",value:function(){return this.hg}},{key:"setViewOrientation",value:function(I){return this.orientation=I,this}},{key:"addDefaultView",value:function(I,g){return this.hg.views.push(JSON.parse(JSON.stringify(Object(m.a)(Object(m.a)({},function(I){return{genomePositionSearchBoxVisible:!1,genomePositionSearchBox:{autocompleteServer:"https://higlass.io/api/v1",autocompleteId:"P0PLbQMwTYGy-5uPIQid7A",chromInfoServer:"https://higlass.io/api/v1",chromInfoId:null!=I?I:"hg38"},layout:{w:12,h:12,x:0,y:0},tracks:{top:[],left:[],center:[],right:[],bottom:[],gallery:[],whole:[]},initialXDomain:[0,Qg(I).total],initialYDomain:[0,Qg(I).total],zoomFixed:!1}}(g)),{},{uid:I})))),this}},{key:"setAssembly",value:function(I){return this.assembly=I,this.setChromInfoPath(Qg(this.assembly).path),this}},{key:"getAssembly",value:function(){return this.assembly}},{key:"setTextTrack",value:function(I,g,C){var A,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"black",e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"normal",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"left",t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"transparent",c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"Arial";return this.getLastView()&&(null==(A=this.getLastView().tracks.top)||A.push({type:"text",width:I,height:g,options:{backgroundColor:t,textColor:i,fontSize:e,fontWeight:l,fontFamily:c,offsetY:0,align:o,text:C}})),this}},{key:"addBrush",value:function(I,g,C,A,i){var e,l,o,t,c,n;if(A)return null==(n=this.getView(g))||n.tracks.whole.push({type:"circular"===I?"brush-track":"viewport-projection-horizontal",uid:sg(),fromViewUid:A,options:{projectionFillColor:null!=(e=null==i?void 0:i.color)?e:C.brush.color,projectionStrokeColor:null!=(l=null==i?void 0:i.stroke)?l:C.brush.stroke,projectionFillOpacity:null!=(o=null==i?void 0:i.opacity)?o:C.brush.opacity,projectionStrokeOpacity:null!=(t=null==i?void 0:i.opacity)?t:C.brush.opacity,strokeWidth:null!=(c=null==i?void 0:i.strokeWidth)?c:C.brush.strokeWidth,startAngle:null==i?void 0:i.startAngle,endAngle:null==i?void 0:i.endAngle,innerRadius:null==i?void 0:i.innerRadius,outerRadius:null==i?void 0:i.outerRadius}}),this}},{key:"getLastView",value:function(){return this.hg.views[this.hg.views.length-1]}},{key:"getMainTrackPosition",value:function(){return"vertical"===this.orientation?"left":"center"}},{key:"getLastVisView",value:function(){var I=this,g=this.hg.views.filter((function(g){var C,A;return"combined"===(null==(A=null==(C=g.tracks[I.getMainTrackPosition()])?void 0:C[0])?void 0:A.type)}));return g[g.length-1]}},{key:"getView",value:function(I){return this.hg.views.find((function(g){return g.uid===I}))}},{key:"validateSpec",value:function(){var I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return"success"===CZ(lZ,this.spec(),I).state}},{key:"setDomain",value:function(I,g){return I&&(this.getLastView().initialXDomain=oZ(I,this.getAssembly())),g&&(this.getLastView().initialYDomain=oZ(g,this.getAssembly())),this}},{key:"adjustDomain",value:function(){var I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"horizontal",g=arguments.length>1?arguments[1]:void 0,C=arguments.length>2?arguments[2]:void 0;if("vertical"!==I)return this;var A=this.getLastView().initialXDomain;if(!A)return this;var i=Object(r.a)(A,2),e=i[0],l=i[1],o=l-e,t=(e+l)/2;return this.getLastView().initialXDomain=[t-o/g/2/C*g,t+o/g/2/C*g],this}},{key:"setZoomFixed",value:function(I){return this.getLastView().zoomFixed=I,this}},{key:"setZoomLimits",value:function(I){return this.getLastView().zoomLimits=I,this}},{key:"setLayout",value:function(I){return this.getLastView().layout=I,this}},{key:"setEditable",value:function(I){return this.hg.editable=I,this}},{key:"setChromInfoPath",value:function(I){return this.getLastView()&&(this.getLastView().chromInfoPath=I),this.hg.chromInfoPath=I,this}},{key:"addTrackSourceServers",value:function(I){var g,C;return I&&-1===(null==(g=this.hg.trackSourceServers)?void 0:g.indexOf(I))&&(null==(C=this.hg.trackSourceServers)||C.push(I)),this}},{key:"setMainTrack",value:function(I){var g;return this.getLastView()?(this.getLastView().tracks[this.getMainTrackPosition()]=[{type:"combined",uid:"".concat(null!=(g=I.uid)?g:sg(),"-").concat(this.getMainTrackPosition(),"-combined"),width:I.width-1,height:I.height,contents:[I]}],this):this}},{key:"addTrackToCombined",value:function(I){var g;return this.getLastVisView()?(null==(g=this.getLastVisView().tracks[this.getMainTrackPosition()][0])||g.contents.push(I),this):this}},{key:"setAxisTrack",value:function(I){var g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"regular",C=arguments.length>2?arguments[2]:void 0;if(!this.hg.views)return this;var A="left"===I||"right"===I?"width":"height",i={type:"axis-track",chromInfoPath:this.hg.chromInfoPath,options:Object(m.a)(Object(m.a)({},C),{},{assembly:this.getAssembly(),stroke:"transparent",color:C.theme.axis.labelColor,fontSize:C.theme.axis.labelFontSize,fontFamily:C.theme.axis.labelFontFamily,fontWeight:C.theme.axis.labelFontWeight,tickColor:C.theme.axis.tickColor,tickFormat:"narrower"===g?"si":"plain",tickPositions:"regular"===g?"even":"ends",reverseOrientation:"bottom"===I||"right"===I})};if("circular"===C.layout)this.addTrackToCombined(Object(m.a)(Object(m.a)({},i),{},{options:Object(m.a)(Object(m.a)({},i.options),{},{layout:"circular"})}));else{var e=Object(m.a)(Object(m.a)({},i),{},Object(o.a)({},A,sZ));if("left"===I){if(0!==this.getLastView().tracks.left.filter((function(I){return"axis-track"===I.type})).length)return this;this.getLastView().tracks.left=nZ(this.getLastView().tracks.left,0,e)}else if("right"===I){if(0!==this.getLastView().tracks.right.filter((function(I){return"axis-track"===I.type})).length)return this;this.getLastView().tracks.right.push(e)}else{if(0!==this.getLastView().tracks[I].filter((function(I){return"axis-track"===I.type})).length)return this;this.getLastView().tracks[I].push(e)}}return this}},{key:"setExampleHiglassViewConfig",value:function(){this.hg=cZ}}]),I}();function ZZ(I,g,C,A){var i=A&&0!==A?A:void 0,e=0;switch(g){case"less-than":case"LT":case"lt":e=C>I?i?(C-I)/i:1:0;break;case"less-than-or-equal-to":case"LTET":case"ltet":e=C>=I?i?(C-I)/i:1:0;break;case"greater-than":case"GT":case"gt":e=C<I?i?(I-C)/i:1:0;break;case"greater-than-or-equal-to":case"GTET":case"gtet":e=C<=I?i?(I-C)/i:1:0}return Math.max(Math.min(1,e),0)}var mZ={NOMINAL_COLOR:["#E79F00","#029F73","#0072B2","#CB7AA7","#D45E00","#57B4E9","#EFE441"],NOMINAL_COLOR_EXTENDED:["#d60000","#018700","#b500ff","#05acc6","#97ff00","#ffa52f","#ff8ec8","#79525e","#00fdcf","#afa5ff","#93ac83","#9a6900","#366962","#d3008c","#fdf490","#c86e66","#9ee2ff","#00c846","#a877ac","#b8ba01","#f4bfb1","#ff28fd","#f2cdff","#009e7c","#ff6200","#56642a","#953f1f","#90318e","#ff3464","#a0e491","#8c9ab1","#829026","#ae083f","#77c6ba","#bc9157","#e48eff","#72b8ff","#c6a5c1","#ff9070","#d3c37c","#bceddb","#6b8567","#916e56","#f9ff00","#bac1df","#ac567c","#ffcd03","#ff49b1","#c15603","#5d8c90","#c144bc","#00753f","#ba6efd","#00d493","#00ff75","#49a150","#cc9790","#00ebed","#db7e01","#f77589","#b89500","#c84248","#00cff9","#755726","#85d401","#ebffd4","#a77b87","#db72c8","#cae256","#8abf5d","#a1216b","#855b89","#89bacf","#ffbad6","#b6cfaa","#97414d","#67aa00","#fde1b1","#ff3628","#80793d","#d6e8ff","#a795c6","#7ea59a","#d182a3","#54823b","#e6a872","#9cffff","#da5480","#05b3aa","#ffaaf6","#d1afef","#da015d","#ac1a13","#60b385","#d442fd","#acaa59","#fb9ca7","#b3723b","#f26952","#aed1d4","#9affc3","#dbb333","#eb01c3","#9900c4","#cfff9e","#a55949","#3b6d01","#008579","#959167","#89dbb3","#6d7400","#aa5dca","#07ef00","#804f3d","#d88052","#ffc862","#b8009e","#99acdd","#904f00","#8c4470","#4f6e52","#ff8734","#c68ecd","#d4e29e","#b1826d","#9cfb75","#56dd77","#f90087","#a1cdff","#13cad1","#118e54","#d154a5","#00dfc3","#a3832f","#77975b","#baaa80","#70a3af","#d6fbff","#e8013a","#d84621","#ff82ed","#b63862","#b6cd72","#97626b","#897490","#00a316","#00f4a1","#bf90f2","#89e4d8","#a34d95","#6e5d00","#8cc68e","#95aa2a","#c672dd","#b33b01","#d69a36","#dfacb6","#009aa0","#599000","#97bca8","#ac8ca8","#dad4ff","#547c72","#00ba69","#ffc38e","#b800d4","#dfcf5b","#629a7b","#bfedbc","#c1bdfd","#80d3dd","#e2857e","#f9eb4d","#bf6d82","#caff4f","#ef72aa","#ed67ff","#9946ae","#6d6942","#e25660","#dd662d","#9cdb5d","#e29ccf","#b87500","#c6002d","#dfbcda","#59b5df","#ff59da","#38c1a1","#9e698c","#acaac8","#95622f","#b55662","#2b7e60","#b1e400","#eda590","#95fde2","#ff548e","#bd6ea1","#aa3b36","#d8cf00","#aa80cd","#a08052","#e100e8","#c35b3d","#b53a85","#8c7700","#dbbc95","#529e93","#afbc82","#91b5b6","#a75423","#ffd4ef","#79ae6b","#5db54b","#80fb9a","#48ffef","#979548","#9387a7","#31d400","#6ee956","#b6d4eb","#705470","#f2db8a","#aad4c1","#7ecdf2","#89ba00","#64b6ba","#ffb500","#c38285","#caaa5e","#647748","#59e2ff","#df4dcd","#e9ff79","#bc66b8","#c395a5","#64c674","#d19570","#70cf4f","#aa6e66","#9c60a5","#00b800","#e299b3","#bc006b","#b3e8ef","#cdbfe4","#77a342","#856277","#568e5b","#9eafc4","#e82fa0","#247c2a","#826723","#bfbc4d","#ddd3a5"],QUANTITATIVE_COLOR:"viridis",SIZE:3,SIZE_RANGE:[2,6]};function bZ(){var I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light";if("string"===typeof I)return iI.b(I)?iI.a(I):"dark"===I||"light"===I?GZ[I]:GZ.light;var g=JSON.parse(JSON.stringify(GZ.light));return iI.b(I.base)?g=iI.a(I.base):"light"!==I.base&&"dark"!==I.base||(g=JSON.parse(JSON.stringify(GZ[I.base]))),Object.keys(g).forEach((function(C){I[C]&&"base"!==C&&(g[C]=Object.assign(JSON.parse(JSON.stringify(g[C])),JSON.parse(JSON.stringify(I[C]))))})),g}var rZ={color:mZ.NOMINAL_COLOR[0],size:1,stroke:"black",strokeWidth:0,opacity:1,nominalColorRange:mZ.NOMINAL_COLOR,quantitativeSizeRange:[2,6]},hZ=Object(m.a)(Object(m.a)({},rZ),{},{stroke:"white"}),GZ={light:{base:"light",root:{background:"white",titleColor:"black",titleBackgroundColor:"transparent",titleFontSize:18,titleFontFamily:"Arial",titleAlign:"left",titleFontWeight:"bold",subtitleColor:"gray",subtitleBackgroundColor:"transparent",subtitleFontSize:16,subtitleFontFamily:"Arial",subtitleFontWeight:"normal",subtitleAlign:"left",showMousePosition:!0,mousePositionColor:"#000000"},track:{background:"transparent",alternatingBackground:"transparent",titleColor:"black",titleBackground:"white",titleFontSize:24,titleAlign:"left",outline:"black",outlineWidth:1},legend:{position:"top",background:"white",backgroundOpacity:.7,labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",backgroundStroke:"#DBDBDB",tickColor:"black"},axis:{tickColor:"black",labelColor:"black",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",baselineColor:"black",gridColor:"#E3E3E3",gridStrokeWidth:1,gridStrokeType:"solid",gridStrokeDash:[4,4]},markCommon:Object(m.a)({},rZ),point:Object(m.a)(Object(m.a)({},rZ),{},{size:3}),rect:Object(m.a)({},rZ),triangle:Object(m.a)({},rZ),area:Object(m.a)({},rZ),line:Object(m.a)({},rZ),bar:Object(m.a)({},rZ),rule:Object(m.a)(Object(m.a)({},rZ),{},{strokeWidth:1}),link:Object(m.a)(Object(m.a)({},rZ),{},{strokeWidth:1}),text:Object(m.a)(Object(m.a)({},rZ),{},{textAnchor:"middle",textFontWeight:"normal"}),brush:Object(m.a)(Object(m.a)({},rZ),{},{color:"gray",opacity:.3,stroke:"black",strokeWidth:1})},dark:{base:"dark",root:{background:"black",titleColor:"white",titleBackgroundColor:"transparent",titleFontSize:18,titleFontFamily:"Arial",titleAlign:"middle",titleFontWeight:"bold",subtitleColor:"lightgray",subtitleBackgroundColor:"transparent",subtitleFontSize:16,subtitleFontFamily:"Arial",subtitleAlign:"middle",subtitleFontWeight:"normal",showMousePosition:!0,mousePositionColor:"#FFFFFF"},track:{background:"transparent",alternatingBackground:"transparent",titleColor:"white",titleBackground:"black",titleFontSize:18,titleAlign:"left",outline:"white",outlineWidth:1},legend:{position:"right",background:"black",backgroundOpacity:.7,labelColor:"white",labelFontSize:12,labelFontWeight:"normal",labelFontFamily:"Arial",backgroundStroke:"#DBDBDB",tickColor:"white"},axis:{tickColor:"white",labelColor:"white",labelFontSize:10,labelFontWeight:"normal",labelFontFamily:"Arial",baselineColor:"white",gridColor:"gray",gridStrokeWidth:1,gridStrokeType:"solid",gridStrokeDash:[4,4]},markCommon:Object(m.a)({},hZ),point:Object(m.a)(Object(m.a)({},hZ),{},{size:3}),rect:Object(m.a)({},hZ),triangle:Object(m.a)({},hZ),area:Object(m.a)({},hZ),line:Object(m.a)({},hZ),bar:Object(m.a)({},hZ),rule:Object(m.a)(Object(m.a)({},hZ),{},{strokeWidth:1}),link:Object(m.a)(Object(m.a)({},hZ),{},{strokeWidth:1}),text:Object(m.a)(Object(m.a)({},hZ),{},{textAnchor:"middle",textFontWeight:"normal"}),brush:Object(m.a)(Object(m.a)({},hZ),{},{color:"lightgray",opacity:.3,stroke:"white",strokeWidth:1})}},uZ=function(I,g){var C=Object(r.a)(I,2),A=C[0],i=C[1];return A<=g&&g<=i},yZ=function(){function I(){Object(t.a)(this,I),this.data=[]}return Object(c.a)(I,[{key:"size",value:function(){return this.data.length}},{key:"addPolygonBasedEvent",value:function(I,g){this.data.push({uid:sg(),type:"polygon",value:I,polygon:g})}},{key:"addPointBasedEvent",value:function(I,g){this.data.push({uid:sg(),type:"point",value:I,polygon:g})}},{key:"addLineBasedEvent",value:function(I,g){this.data.push({uid:sg(),type:"line",value:I,polygon:g})}},{key:"clear",value:function(){this.data=[]}},{key:"find",value:function(I,g){var C=this,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Array.from(this.data);return A&&i.reverse(),i.find((function(A){return C.isMouseWithin(A,I,g)}))}},{key:"findAll",value:function(I,g){var C=this,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Array.from(this.data);return A&&i.reverse(),i.filter((function(A){return C.isMouseWithin(A,I,g)}))}},{key:"getSiblings",value:function(I,g){var C=this,A=[],i=Array.from(new Set(I.map((function(I){return I.uid}))));return I.forEach((function(I){var e=I.value[g];e&&A.push.apply(A,Object(b.a)(C.data.filter((function(I){return I.value[g]===e&&-1===i.indexOf(I.uid)}))))})),A}},{key:"isMouseWithin",value:function(I,g,C){switch(I.type){case"point":return function(I,g){var C=Object(r.a)(I,2),A=C[0],i=C[1],e=Object(r.a)(g,2),l=e[0],o=e[1],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;return Math.sqrt(Math.pow(A-l,2)+Math.pow(i-o,2))<t}([g,C],I.polygon);case"line":return function(I,g){for(var C,A,i,e,l=Object(r.a)(I,2),o=l[0],t=l[1],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,n=!1,d=0;d<g.length-2;d+=2){C=g[d],A=g[d+1];var s=[(i=g[d+2])-C,(e=g[d+3])-A],a=[o-i,t-e],Z=[o-C,t-A],m=s[0]*a[0]+s[1]*a[1],b=s[0]*Z[0]+s[1]*Z[1];(m>0?Math.sqrt(Math.pow(t-e,2)+Math.pow(o-i,2)):b<0?Math.sqrt(Math.pow(t-A,2)+Math.pow(o-C,2)):Math.abs(s[0]*Z[1]-s[1]*Z[0])/Math.sqrt(Math.pow(s[0],2)+Math.pow(s[1],2)))<c&&(n=!0)}return n}([g,C],I.polygon);default:return function(I,g){for(var C,A,i,e,l=Object(r.a)(I,2),o=l[0],t=l[1],c=!1,n=0,d=g.length-2;n<g.length;n+=2)C=g[n],A=g[n+1],i=g[d],A>t!==(e=g[d+1])>t&&o<(i-C)*(t-A)/(e-A)+C&&(c=!c),d=n;return c}([g,C],I.polygon)}}},{key:"findAllWithinRange",value:function(I,g){var C=this,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Array.from(this.data);return A&&i.reverse(),i.filter((function(A){return C.isWithinRange(A,I,g)}))}},{key:"isWithinRange",value:function(I,g,C){return"point"===I.type?function(I,g){var C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;return uZ(I,g-C)&&uZ(I,g+C)}([g,C],I.polygon[0],I.polygon[2]):(A=[g,C],I.polygon.filter((function(I,g){return g%2===0})).every((function(I){return uZ(A,I)})));var A}}]),I}(),BZ=function(){function I(g,C,A){Object(t.a)(this,I),this.id=Ag(),this.theme=null!=A?A:bZ(),this.dataOriginal=JSON.parse(JSON.stringify(C)),this.dataAggregated=JSON.parse(JSON.stringify(C)),this.specOriginal=JSON.parse(JSON.stringify(g)),this.specComplete=JSON.parse(JSON.stringify(g)),this.channelScales={},this.mouseEventModel=new yZ;var i=this.validateSpec();i.valid?(this.generateCompleteSpec(this.specComplete),this.flipRanges(this.specComplete),this.generateScales(),this.dataAggregated=cC(this.spec(),this.dataAggregated)):console.warn("Gosling specification is not valid!",i.errorMessages)}return Object(c.a)(I,[{key:"getId",value:function(){return this.id}},{key:"getRenderingId",value:function(){var I;return null!=(I=this.spec()._renderingId)?I:this.getId()}},{key:"originalSpec",value:function(){return this.specOriginal}},{key:"spec",value:function(){return this.specComplete}},{key:"data",value:function(){return this.dataAggregated}},{key:"getMouseEventModel",value:function(){return this.mouseEventModel}},{key:"generateCompleteSpec",value:function(I){if(I.width&&I.height){if("vertical"===I.orientation){var g=I.width;I.width=I.height,I.height=g}var C=this.getGenomicChannelKey(),A=!1;"x"===C&&(A=DI(I.x)&&void 0!==I.x.axis&&"none"!==I.x.axis),"y"===C&&(A=DI(I.y)&&void 0!==I.y.axis&&"none"!==I.y.axis),"circular"!==I.layout?DI(I.x)&&void 0!==I.x.axis&&"none"!==I.x.axis&&(I.height-=sZ):"x"===C&&A&&DI(I.x)&&"top"===I.x.axis?I.outerRadius=I.outerRadius-sZ:"x"===C&&A&&DI(I.x)&&"bottom"===I.x.axis&&(I.innerRadius=I.innerRadius+sZ),VI.forEach((function(g){var C=I[g];DI(C)&&!("zeroBaseline"in C)&&"quantitative"===C.type&&(C.zeroBaseline=!0)})),this.addScaleMaterials(I)}else console.warn("Size of track is not determined yet.")}},{key:"flipRanges",value:function(I){DI(I.y)&&I.y.flip&&Array.isArray(I.y.range)&&(I.y.range=I.y.range.reverse())}},{key:"getGenomicChannelKey",value:function(){return eZ(this.spec())}},{key:"getGenomicChannel",value:function(){return iZ(this.spec())}},{key:"setChannelDomain",value:function(I,g,C){var A=this.originalSpec()[I];if(C||!DI(A)||void 0===A.domain){var i=this.specComplete[I];DI(i)&&(i.domain=g)}}},{key:"setChannelRange",value:function(I,g){var C=this.specComplete[I];DI(C)&&(C.range=g)}},{key:"updateChannelValue",value:function(){if(void 0===this.originalSpec().y){var I=this.spec().y,g=this.getChannelDomainArray("row");I&&vI(I)&&g&&"withinLink"!==this.spec().mark&&(I.value=this.spec().height/g.length/2)}}},{key:"encodedValue",value:function(I,g){var C;if("text"===I&&void 0!==g)return"".concat(+g?~~g:g);var A=this.spec()[I],i=DI(A)?A.type:vI(A)?"constant":void 0;if(i){if("constant"===i)return this.channelScales[I]();if(void 0!==g&&"function"===typeof this.channelScales[I])switch(I){case"x":case"y":case"x1":case"y1":case"xe":case"ye":case"x1e":if("quantitative"===i||"genomic"===i)return this.channelScales[I](g);if("nominal"===i)return this.channelScales[I](g);break;case"stroke":case"color":if("quantitative"===i){var e=this.channelScales[I].copy(),l=e.domain(),o=l[1]-l[0],t=Array.from(null!=(C=A.scaleOffset)?C:[0,1]);return e.domain([l[0]+o*t.sort()[0],l[0]+o*t.sort()[1]])(g)}if("nominal"===i)return this.channelScales[I](g);break;case"size":if("quantitative"===i)return this.channelScales[I](g);if("nominal"===i)return this.channelScales[I](g);break;case"row":if("nominal"===i)return this.channelScales[I](g);break;case"strokeWidth":case"opacity":if("quantitative"===i)return this.channelScales[I](g);break;default:return void console.warn("".concat(I," is not supported for encoding values, so returning a undefined value"))}}}},{key:"trackVisibility",value:function(I){var g=this.spec();if(!g.visibility||0===g.visibility.length||0===g.visibility.filter((function(I){return"track"===I.target})).length)return!0;var C=!0;return g.visibility.filter((function(I){return"track"===I.target})).forEach((function(A){var i,e=A.operation,l=A.measure,o=A.threshold;void 0!==(i="zoomLevel"===l?I[l]:g[l])&&(C=C&&1===ZZ(i,e,o))})),C}},{key:"markVisibility",value:function(I,g){var C=this,A=this.spec();if(!A.visibility||0===A.visibility.length||0===A.visibility.filter((function(I){return"mark"===I.target})).length)return 1;var i=1;return A.visibility.filter((function(I){return"mark"===I.target})).forEach((function(e){var l=e.operation,o=e.threshold,t=e.conditionPadding,c=e.transitionPadding,n=e.measure,d=null!=t?t:0,s=1;if("text"===A.mark&&"|xe-x|"===o&&"width"===n){var a=C.encodedPIXIProperty("xe",I),Z=C.encodedPIXIProperty("x",I);void 0!==a&&(null==g?void 0:g.width)&&(s=ZZ(g.width+d,l,Math.abs(a-Z),c))}else"width"===n&&"number"===typeof o&&(null==g?void 0:g.width)?s=ZZ(g.width+d,l,o,c):"zoomLevel"===n&&"number"===typeof o&&(null==g?void 0:g.zoomLevel)&&(s=ZZ(g.zoomLevel,l,o,c));i>s&&(i=s)})),i}},{key:"visualPropertyByChannel",value:function(I,g){var C=void 0!==g?UI(g,this.spec()[I]):void 0;return this.encodedValue(I,C)}},{key:"encodedPIXIProperty",value:function(I,g,C){var A=this.spec().mark;if(["text","color","row","stroke","opacity","strokeWidth","x","y","xe","x1","x1e","ye","size"].includes(I))return this.visualPropertyByChannel(I,g);switch(A){case"bar":return function(I,g,C,A){var i=I.visualPropertyByChannel("x",C),e=I.visualPropertyByChannel("xe",C),l=I.visualPropertyByChannel("size",C);switch(g){case"width":return null!=l?l:e?e-i:null==A?void 0:A.tileUnitWidth;case"x-start":if(!(null==A?void 0:A.markWidth))return;return e?(i+e-(null==A?void 0:A.markWidth))/2:i-(null==A?void 0:A.markWidth)/2;default:return}}(this,I,g,C);case"point":case"text":return function(I,g,C){var A=I.visualPropertyByChannel("xe",C),i=I.visualPropertyByChannel("x",C),e=I.visualPropertyByChannel("size",C);switch(g){case"x-center":return A?(A+i)/2:i;case"y-center":var l=I.visualPropertyByChannel("ye",C),o=I.visualPropertyByChannel("y",C);return l?(l+o)/2:o;case"p-size":return A&&I.spec().stretch?(A-i)/2:e;default:return}}(this,I,g);case"rect":return function(I,g,C,A){var i;switch(g){case"width":var e=I.visualPropertyByChannel("xe",C)?I.visualPropertyByChannel("xe",C)-I.visualPropertyByChannel("x",C):null==A?void 0:A.markWidth;return 0===e?.1:e;case"height":return null!=(i=I.visualPropertyByChannel("size",C))?i:null==A?void 0:A.markHeight;default:return}}(this,I,g,C);default:return}}},{key:"addScaleMaterials",value:function(I){var g=this,C=this.data(),A=this.getGenomicChannel();A&&A.field?"undefined"!==typeof I.width&&"undefined"!==typeof I.height?(VI.forEach((function(i){var e,l,o,t,c=I[i];if(function(I,g){var C=I[g];return MI(I)&&("x"===g||"y"===g)&&DI(C)&&"quantitative"===C.type}(I,i)&&DI(c)){var n=Object(u.a)(C,(function(I){return I[A.field]})),d=Object(b.a)(n.keys());if(!c.domain){var s="zeroBaseline"in c&&c.zeroBaseline?0:Object(B.a)(d.map((function(I){return Object(p.a)(n.get(I).map((function(I){return c.field?I[c.field]:void 0})))}))),a=Object(y.a)(d.map((function(I){return Object(p.a)(n.get(I).map((function(I){return c.field?I[c.field]:void 0})))})));c.domain=[s,a]}if(!c.range){var Z=I.row,m=DI(Z)?Z.field:void 0,r=null!=(e=g.getChannelDomainArray("row"))?e:m?Array.from(new Set(C.map((function(I){return I[m]})))):[1],h=I.height/r.length;switch(i){case"x":c.range=[0,I.width];break;case"y":c.range=[0,h]}}}else{var G=I.row,V=DI(G)?G.field:void 0,X=null!=(l=g.getChannelDomainArray("row"))?l:V?Array.from(new Set(C.map((function(I){return I[V]})))):[1],W=I.height/X.length;if(c)if(!DI(c)||"quantitative"!==c.type&&"genomic"!==c.type){if(DI(c)&&"nominal"===c.type&&(void 0===c.domain&&(c.domain=Array.from(new Set(C.map((function(I){return I[c.field]}))))),!c.range)){var H,Y=2;switch(i){case"x":case"xe":H=[0,I.width];break;case"y":case"ye":H=[W,0];break;case"color":case"stroke":H=g.theme.markCommon.nominalColorRange;break;case"row":H=[0,I.height];break;case"size":H=c.domain.map((function(){return Y++}))}H&&(c.range=H)}}else{if(void 0===c.domain){var R="zeroBaseline"in c&&c.zeroBaseline?0:null!=(o=Object(B.a)(C.map((function(I){return+I[c.field]}))))?o:0,f=null!=(t=Object(y.a)(C.map((function(I){return+I[c.field]}))))?t:0;c.domain=[R,f]}else"genomic"!==c.type||zI(c.domain)||(c.domain=oZ(c.domain));if("color"!==i&&"stroke"!==i||"quantitative"!==c.type||c.scaleOffset||(c.scaleOffset=[0,1]),!c.range){var K;switch(i){case"x":case"xe":case"x1":case"x1e":K=[0,I.width];break;case"y":case"ye":K=[0,W];break;case"color":case"stroke":K=mZ.QUANTITATIVE_COLOR;break;case"size":K=g.theme.markCommon.quantitativeSizeRange;break;case"strokeWidth":K=[1,3];break;case"opacity":K=[0,1]}K&&(c.range=K)}}else{var w;switch(i){case"x":w=I.width/2;break;case"y":w="withinLink"===I.mark?W:W/2;break;case"size":w="line"===I.mark?g.theme.line.size:"bar"===I.mark||"rect"===I.mark||"triangleRight"===I.mark||"triangleLeft"===I.mark||"triangleBottom"===I.mark||I.stretch&&"point"===I.mark&&DI(I.x)&&DI(I.xe)?void 0:"text"===I.mark?12:g.theme.point.size;break;case"color":w=g.theme.markCommon.color;break;case"row":w=0;break;case"stroke":w="text"===I.mark?g.theme.text.stroke:g.theme.markCommon.stroke;break;case"strokeWidth":w="rule"===I.mark?g.theme.rule.strokeWidth:"withinLink"===I.mark||"betweenLink"===I.mark?g.theme.link.strokeWidth:"text"===I.mark?g.theme.text.strokeWidth:g.theme.markCommon.strokeWidth;break;case"opacity":w=g.theme.markCommon.opacity;break;case"text":w=""}"undefined"!==typeof w&&(I[i]={value:w})}}})),[["x","xe"],["y","ye"]].forEach((function(g){var C=Object(r.a)(g,2),A=C[0],i=C[1],e=I[A],l=I[i];if(DI(e)&&DI(l)&&e.type===l.type&&e.domain&&l.domain&&Array.isArray(e.domain)&&Array.isArray(l.domain))if("genomic"===e.type||"quantitative"===e.type){var o=Object(B.a)([e.domain[0],l.domain[0]]),t=Object(y.a)([e.domain[1],l.domain[1]]);e.domain=l.domain=[o,t]}else if("nominal"===e.type){var c=Array.from(new Set([].concat(Object(b.a)(e.domain),Object(b.a)(l.domain))));e.range=l.range=c}}))):console.warn("Track size is not determined yet"):console.warn("Genomic field is not provided in the specification")}},{key:"generateScales",value:function(){var I=this,g=this.spec();VI.forEach((function(C){var A=g[C];if(vI(A))I.channelScales[C]=function(){return A.value};else if(DI(A)){if("text"===C)return;var i=A.domain,e=A.range;if(void 0===i||void 0===e)return;if("quantitative"===A.type||"genomic"===A.type)switch(C){case"x":case"x1":case"xe":case"x1e":case"y":case"ye":case"size":case"opacity":case"strokeWidth":I.channelScales[C]=Object(W.a)().domain(i).range(e);break;case"color":case"stroke":var l=F.a;Object.keys(fI).includes(e)&&(l=fI[e]),I.channelScales[C]=Object(H.a)(l).domain(i)}else if("nominal"===A.type)switch(C){case"x":case"xe":case"y":case"ye":case"row":I.channelScales[C]=Object(Y.a)().domain(i).range(e);break;case"size":I.channelScales[C]=Object(R.a)().domain(i).range(e);break;case"color":case"stroke":I.channelScales[C]=Object(R.a)(e).domain(i)}}}))}},{key:"getChannelScale",value:function(I){return this.channelScales[I]}},{key:"setChannelScale",value:function(I,g){this.channelScales[I]=g}},{key:"addDataRows",value:function(I){this.dataAggregated=[].concat(Object(b.a)(this.dataAggregated),Object(b.a)(I))}},{key:"isShowYAxis",value:function(){var I=this.spec(),g=this.getChannelDomainArray("y"),C=this.getChannelRangeArray("y");return DI(I.y)&&"none"!==I.y.axis&&"quantitative"===I.y.type&&!!g&&!!C}},{key:"getChannelDomainArray",value:function(I){var g=this.spec()[I];return DI(g)&&zI(g.domain)?g.domain:void 0}},{key:"getChannelRangeArray",value:function(I){var g,C=this.spec()[I];return DI(C)&&(g=C.range,Object(K.a)(g))?C.range:void 0}},{key:"validateSpec",value:function(){return AZ(this.originalSpec())}}]),I}();function VZ(I,g){var C,A,i,e,l,t,c,n,d,s,a,Z=[];if(kI(I.data)){if("vector"===I.data.type||"bigwig"===I.data.type){if(!I.data.column||!I.data.value)return void console.warn("Proper data configuration is not provided. Please specify the name of data fields.");if(!g.dense)return;var h=null!=(C=I.data.binSize)?C:1,G=g.dense,u=g.tileSize,y=g.tileWidth/g.tileSize,B=I.data.value,V=I.data.column,p=null!=(A=I.data.start)?A:"start",X=null!=(i=I.data.end)?i:"end",W="".concat(B,"_min"),H="".concat(B,"_max"),Y=null!=(e=I.data.aggregation)?e:"mean",R=0,f=Number.MAX_SAFE_INTEGER,K=Number.MIN_SAFE_INTEGER,w=Number.MIN_SAFE_INTEGER,J=Number.MAX_SAFE_INTEGER;Array.from(Array(u).keys()).forEach((function(I,C){if(1===h){var A,i=G[C]/("mean"===Y?y:1);Z.push((A={},Object(o.a)(A,B,i),Object(o.a)(A,V,g.tileX+(C+.5)*y),Object(o.a)(A,p,g.tileX+C*y),Object(o.a)(A,X,g.tileX+(C+1)*y),Object(o.a)(A,W,i),Object(o.a)(A,H,i),A))}else if(C%h===0)R=f=K=G[C],w=C,J=C+h;else if(C%h===h-1){var e;Z.push((e={},Object(o.a)(e,B,R/h/("mean"===Y?y:1)),Object(o.a)(e,V,g.tileX+(w+h/2)*y),Object(o.a)(e,p,g.tileX+w*y),Object(o.a)(e,X,g.tileX+J*y),Object(o.a)(e,W,f),Object(o.a)(e,H,K),e))}else if(C===u-1){var l,t=u%h,c=w+t;Z.push((l={},Object(o.a)(l,B,R/t/("mean"===Y?y:1)),Object(o.a)(l,V,g.tileX+(w+t/2)*y),Object(o.a)(l,p,g.tileX+w*y),Object(o.a)(l,X,g.tileX+c*y),Object(o.a)(l,W,f),Object(o.a)(l,H,K),l))}else R+=G[C],f>G[C]&&(f=G[C]),K<G[C]&&(K=G[C])}))}else if("multivec"===I.data.type){if(!I.data.row||!I.data.column||!I.data.value)return void console.warn("Proper data configuration is not provided. Please specify the name of data fields.");if(!g.dense||void 0===g.shape)return;var S=null!=(l=I.data.binSize)?l:1,F=g.shape[0],N=null!=(t=I.data.categories)?t:Object(b.a)(Array(F).keys()),v=g.dense,k=g.shape[1],D=g.tileWidth/g.tileSize,z=I.data.row,M=I.data.value,U=I.data.column,x=null!=(c=I.data.start)?c:"start",T=null!=(n=I.data.end)?n:"end",Q="".concat(M,"_min"),P="".concat(M,"_max"),O=null!=(d=I.data.aggregation)?d:"mean";N.forEach((function(I,C){var A=0,i=Number.MIN_SAFE_INTEGER,e=Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER;Array.from(Array(k).keys()).forEach((function(c,n){if(1===S){var d,s=v[k*C+n]/("mean"===O?D:1);Z.push((d={},Object(o.a)(d,z,I),Object(o.a)(d,M,s),Object(o.a)(d,U,g.tileX+(n+.5)*D),Object(o.a)(d,x,g.tileX+n*D),Object(o.a)(d,T,g.tileX+(n+1)*D),Object(o.a)(d,Q,s),Object(o.a)(d,P,s),d))}else if(n%S===0)A=l=t=v[k*C+n],i=n,e=n+S;else if(n%S===S-1){var a;Z.push((a={},Object(o.a)(a,z,I),Object(o.a)(a,M,"mean"===O?A/S/D:A),Object(o.a)(a,U,g.tileX+(i+S/2)*D),Object(o.a)(a,x,g.tileX+i*D),Object(o.a)(a,T,g.tileX+e*D),Object(o.a)(a,Q,l),Object(o.a)(a,P,t),a))}else if(n===k-1){var m,b=k%S,r=i+b;Z.push((m={},Object(o.a)(m,z,I),Object(o.a)(m,M,"mean"===O?A/b/D:A),Object(o.a)(m,U,g.tileX+(i+b/2)*D),Object(o.a)(m,x,g.tileX+i*D),Object(o.a)(m,T,g.tileX+r*D),Object(o.a)(m,Q,l),Object(o.a)(m,P,t),m))}else{var h=v[k*C+n];A+=h,l>h&&(l=h),t<h&&(t=h)}}))}))}else if("matrix"===I.data.type){if(!g.dense||"undefined"===typeof g.tileY||"undefined"===typeof g.tileHeight)return;for(var j=Math.sqrt(g.dense.length),L=g.tileX,E=g.tileY,_=g.tileWidth,$=g.tileHeight,q=g.dense,II=_/j,gI=$/j,CI=null!=(s=I.data.column)?s:"x",AI=null!=(a=I.data.row)?a:"y",iI=0;iI<q.length/16;iI++){for(var eI,lI=Math.sqrt(16),oI=iI*lI%j,tI=Math.floor(iI*lI/j)*lI,cI=NaN,nI=0;nI<lI;nI++)for(var dI=0;dI<lI;dI++){var sI=q[(tI+dI)*j+(oI+nI)];isNaN(+sI)||(isNaN(cI)&&(cI=0),cI+=sI)}if(!isNaN(cI)){var aI=L+oI*II,ZI=L+(oI+lI)*II,mI=E+tI*gI,bI=E+(tI+lI)*gI,rI=(aI+ZI)/2,hI=(mI+bI)/2;Z.push((eI={value:cI},Object(o.a)(eI,CI,rI),Object(o.a)(eI,"".concat(CI,"s"),aI),Object(o.a)(eI,"".concat(CI,"e"),ZI),Object(o.a)(eI,AI,hI),Object(o.a)(eI,"".concat(AI,"s"),mI),Object(o.a)(eI,"".concat(AI,"e"),bI),eI))}}}else if("beddb"===I.data.type){if(!g.raw)return;var GI=I.data,uI=GI.genomicFields,yI=GI.exonIntervalFields,BI=GI.valueFields;g.raw.forEach((function(I,g){var C=I.chrOffset,A=I.fields,i={};if(i["gosling-data-row-uid"]="".concat(g),uI.forEach((function(I){i[I.name]=+A[I.index]+C})),null==BI||BI.forEach((function(I){i[I.name]="quantitative"===I.type?+A[I.index]:A[I.index]})),Z.push(Object(m.a)(Object(m.a)({},i),{},{type:"gene"})),yI){var e=Object(r.a)(yI,2),l=e[0],t=e[1],c=A[l.index].split(","),n=A[t.index].split(",");c.forEach((function(I,g){var A,e=n[g];if(Z.push(Object(m.a)(Object(m.a)({},i),{},(A={},Object(o.a)(A,l.name,+I+C),Object(o.a)(A,t.name,+e+C),Object(o.a)(A,"type","exon"),A))),g+1<c.length){var d,s=c[g+1];Z.push(Object(m.a)(Object(m.a)({},i),{},(d={},Object(o.a)(d,l.name,+e+C),Object(o.a)(d,t.name,+s+C),Object(o.a)(d,"type","intron"),d)))}}))}}))}return Z}console.warn("No data is specified")}function pZ(I,g){PubSub.publish(I,g)}function XZ(I,g){PubSub.subscribe(I,g)}function WZ(I){PubSub.unsubscribe(I)}var HZ="KGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgY29tbW9uanNHbG9iYWwgPSB0eXBlb2YgZ2xvYmFsVGhpcyAhPT0gInVuZGVmaW5lZCIgPyBnbG9iYWxUaGlzIDogdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB0eXBlb2YgZ2xvYmFsICE9PSAidW5kZWZpbmVkIiA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIiA/IHNlbGYgOiB7fTsKICBmdW5jdGlvbiBnZXREZWZhdWx0RXhwb3J0RnJvbUNqcyh4KSB7CiAgICByZXR1cm4geCAmJiB4Ll9fZXNNb2R1bGUgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICJkZWZhdWx0IikgPyB4WyJkZWZhdWx0Il0gOiB4OwogIH0KICBmdW5jdGlvbiBnZXRBdWdtZW50ZWROYW1lc3BhY2UobikgewogICAgaWYgKG4uX19lc01vZHVsZSkKICAgICAgcmV0dXJuIG47CiAgICB2YXIgYSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgT2JqZWN0LmtleXMobikuZm9yRWFjaChmdW5jdGlvbihrKSB7CiAgICAgIHZhciBkID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihuLCBrKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGEsIGssIGQuZ2V0ID8gZCA6IHsKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gbltrXTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgICByZXR1cm4gYTsKICB9CiAgdmFyIHdvcmtlciA9IHt9OwogIHZhciBpc09ic2VydmFibGUgPSAodmFsdWUpID0+IHsKICAgIGlmICghdmFsdWUpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHR5cGVvZiBTeW1ib2wub2JzZXJ2YWJsZSA9PT0gInN5bWJvbCIgJiYgdHlwZW9mIHZhbHVlW1N5bWJvbC5vYnNlcnZhYmxlXSA9PT0gImZ1bmN0aW9uIikgewogICAgICByZXR1cm4gdmFsdWUgPT09IHZhbHVlW1N5bWJvbC5vYnNlcnZhYmxlXSgpOwogICAgfQogICAgaWYgKHR5cGVvZiB2YWx1ZVsiQEBvYnNlcnZhYmxlIl0gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgcmV0dXJuIHZhbHVlID09PSB2YWx1ZVsiQEBvYnNlcnZhYmxlIl0oKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9OwogIHZhciBjb21tb24kMSA9IHt9OwogIHZhciBzZXJpYWxpemVycyA9IHt9OwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzZXJpYWxpemVycywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogIHNlcmlhbGl6ZXJzLkRlZmF1bHRTZXJpYWxpemVyID0gc2VyaWFsaXplcnMuZXh0ZW5kU2VyaWFsaXplciA9IHZvaWQgMDsKICBmdW5jdGlvbiBleHRlbmRTZXJpYWxpemVyKGV4dGVuZCwgaW1wbGVtZW50YXRpb24pIHsKICAgIGNvbnN0IGZhbGxiYWNrRGVzZXJpYWxpemVyID0gZXh0ZW5kLmRlc2VyaWFsaXplLmJpbmQoZXh0ZW5kKTsKICAgIGNvbnN0IGZhbGxiYWNrU2VyaWFsaXplciA9IGV4dGVuZC5zZXJpYWxpemUuYmluZChleHRlbmQpOwogICAgcmV0dXJuIHsKICAgICAgZGVzZXJpYWxpemUobWVzc2FnZSkgewogICAgICAgIHJldHVybiBpbXBsZW1lbnRhdGlvbi5kZXNlcmlhbGl6ZShtZXNzYWdlLCBmYWxsYmFja0Rlc2VyaWFsaXplcik7CiAgICAgIH0sCiAgICAgIHNlcmlhbGl6ZShpbnB1dCkgewogICAgICAgIHJldHVybiBpbXBsZW1lbnRhdGlvbi5zZXJpYWxpemUoaW5wdXQsIGZhbGxiYWNrU2VyaWFsaXplcik7CiAgICAgIH0KICAgIH07CiAgfQogIHNlcmlhbGl6ZXJzLmV4dGVuZFNlcmlhbGl6ZXIgPSBleHRlbmRTZXJpYWxpemVyOwogIGNvbnN0IERlZmF1bHRFcnJvclNlcmlhbGl6ZXIgPSB7CiAgICBkZXNlcmlhbGl6ZShtZXNzYWdlKSB7CiAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKEVycm9yKG1lc3NhZ2UubWVzc2FnZSksIHsKICAgICAgICBuYW1lOiBtZXNzYWdlLm5hbWUsCiAgICAgICAgc3RhY2s6IG1lc3NhZ2Uuc3RhY2sKICAgICAgfSk7CiAgICB9LAogICAgc2VyaWFsaXplKGVycm9yKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgX19lcnJvcl9tYXJrZXI6ICIkJGVycm9yIiwKICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLAogICAgICAgIG5hbWU6IGVycm9yLm5hbWUsCiAgICAgICAgc3RhY2s6IGVycm9yLnN0YWNrCiAgICAgIH07CiAgICB9CiAgfTsKICBjb25zdCBpc1NlcmlhbGl6ZWRFcnJvciA9ICh0aGluZykgPT4gdGhpbmcgJiYgdHlwZW9mIHRoaW5nID09PSAib2JqZWN0IiAmJiAiX19lcnJvcl9tYXJrZXIiIGluIHRoaW5nICYmIHRoaW5nLl9fZXJyb3JfbWFya2VyID09PSAiJCRlcnJvciI7CiAgc2VyaWFsaXplcnMuRGVmYXVsdFNlcmlhbGl6ZXIgPSB7CiAgICBkZXNlcmlhbGl6ZShtZXNzYWdlKSB7CiAgICAgIGlmIChpc1NlcmlhbGl6ZWRFcnJvcihtZXNzYWdlKSkgewogICAgICAgIHJldHVybiBEZWZhdWx0RXJyb3JTZXJpYWxpemVyLmRlc2VyaWFsaXplKG1lc3NhZ2UpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBtZXNzYWdlOwogICAgICB9CiAgICB9LAogICAgc2VyaWFsaXplKGlucHV0KSB7CiAgICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgcmV0dXJuIERlZmF1bHRFcnJvclNlcmlhbGl6ZXIuc2VyaWFsaXplKGlucHV0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gaW5wdXQ7CiAgICAgIH0KICAgIH0KICB9OwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb21tb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogIGNvbW1vbiQxLnNlcmlhbGl6ZSA9IGNvbW1vbiQxLmRlc2VyaWFsaXplID0gY29tbW9uJDEucmVnaXN0ZXJTZXJpYWxpemVyID0gdm9pZCAwOwogIGNvbnN0IHNlcmlhbGl6ZXJzXzEgPSBzZXJpYWxpemVyczsKICBsZXQgcmVnaXN0ZXJlZFNlcmlhbGl6ZXIgPSBzZXJpYWxpemVyc18xLkRlZmF1bHRTZXJpYWxpemVyOwogIGZ1bmN0aW9uIHJlZ2lzdGVyU2VyaWFsaXplcihzZXJpYWxpemVyKSB7CiAgICByZWdpc3RlcmVkU2VyaWFsaXplciA9IHNlcmlhbGl6ZXJzXzEuZXh0ZW5kU2VyaWFsaXplcihyZWdpc3RlcmVkU2VyaWFsaXplciwgc2VyaWFsaXplcik7CiAgfQogIGNvbW1vbiQxLnJlZ2lzdGVyU2VyaWFsaXplciA9IHJlZ2lzdGVyU2VyaWFsaXplcjsKICBmdW5jdGlvbiBkZXNlcmlhbGl6ZShtZXNzYWdlKSB7CiAgICByZXR1cm4gcmVnaXN0ZXJlZFNlcmlhbGl6ZXIuZGVzZXJpYWxpemUobWVzc2FnZSk7CiAgfQogIGNvbW1vbiQxLmRlc2VyaWFsaXplID0gZGVzZXJpYWxpemU7CiAgZnVuY3Rpb24gc2VyaWFsaXplKGlucHV0KSB7CiAgICByZXR1cm4gcmVnaXN0ZXJlZFNlcmlhbGl6ZXIuc2VyaWFsaXplKGlucHV0KTsKICB9CiAgY29tbW9uJDEuc2VyaWFsaXplID0gc2VyaWFsaXplOwogIHZhciB0cmFuc2ZlcmFibGUgPSB7fTsKICB2YXIgc3ltYm9scyA9IHt9OwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzeW1ib2xzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgc3ltYm9scy4kd29ya2VyID0gc3ltYm9scy4kdHJhbnNmZXJhYmxlID0gc3ltYm9scy4kdGVybWluYXRlID0gc3ltYm9scy4kZXZlbnRzID0gc3ltYm9scy4kZXJyb3JzID0gdm9pZCAwOwogIHN5bWJvbHMuJGVycm9ycyA9IFN5bWJvbCgidGhyZWFkLmVycm9ycyIpOwogIHN5bWJvbHMuJGV2ZW50cyA9IFN5bWJvbCgidGhyZWFkLmV2ZW50cyIpOwogIHN5bWJvbHMuJHRlcm1pbmF0ZSA9IFN5bWJvbCgidGhyZWFkLnRlcm1pbmF0ZSIpOwogIHN5bWJvbHMuJHRyYW5zZmVyYWJsZSA9IFN5bWJvbCgidGhyZWFkLnRyYW5zZmVyYWJsZSIpOwogIHN5bWJvbHMuJHdvcmtlciA9IFN5bWJvbCgidGhyZWFkLndvcmtlciIpOwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0cmFuc2ZlcmFibGUsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICB0cmFuc2ZlcmFibGUuVHJhbnNmZXIgPSB0cmFuc2ZlcmFibGUuaXNUcmFuc2ZlckRlc2NyaXB0b3IgPSB2b2lkIDA7CiAgY29uc3Qgc3ltYm9sc18xID0gc3ltYm9sczsKICBmdW5jdGlvbiBpc1RyYW5zZmVyYWJsZSh0aGluZykgewogICAgaWYgKCF0aGluZyB8fCB0eXBlb2YgdGhpbmcgIT09ICJvYmplY3QiKQogICAgICByZXR1cm4gZmFsc2U7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZnVuY3Rpb24gaXNUcmFuc2ZlckRlc2NyaXB0b3IodGhpbmcpIHsKICAgIHJldHVybiB0aGluZyAmJiB0eXBlb2YgdGhpbmcgPT09ICJvYmplY3QiICYmIHRoaW5nW3N5bWJvbHNfMS4kdHJhbnNmZXJhYmxlXTsKICB9CiAgdHJhbnNmZXJhYmxlLmlzVHJhbnNmZXJEZXNjcmlwdG9yID0gaXNUcmFuc2ZlckRlc2NyaXB0b3I7CiAgZnVuY3Rpb24gVHJhbnNmZXIkMShwYXlsb2FkLCB0cmFuc2ZlcmFibGVzKSB7CiAgICBpZiAoIXRyYW5zZmVyYWJsZXMpIHsKICAgICAgaWYgKCFpc1RyYW5zZmVyYWJsZShwYXlsb2FkKSkKICAgICAgICB0aHJvdyBFcnJvcigpOwogICAgICB0cmFuc2ZlcmFibGVzID0gW3BheWxvYWRdOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgW3N5bWJvbHNfMS4kdHJhbnNmZXJhYmxlXTogdHJ1ZSwKICAgICAgc2VuZDogcGF5bG9hZCwKICAgICAgdHJhbnNmZXJhYmxlcwogICAgfTsKICB9CiAgdHJhbnNmZXJhYmxlLlRyYW5zZmVyID0gVHJhbnNmZXIkMTsKICB2YXIgbWVzc2FnZXMkMSA9IHt9OwogIChmdW5jdGlvbihleHBvcnRzKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgZXhwb3J0cy5Xb3JrZXJNZXNzYWdlVHlwZSA9IGV4cG9ydHMuTWFzdGVyTWVzc2FnZVR5cGUgPSB2b2lkIDA7CiAgICAoZnVuY3Rpb24oTWFzdGVyTWVzc2FnZVR5cGUpIHsKICAgICAgTWFzdGVyTWVzc2FnZVR5cGVbImNhbmNlbCJdID0gImNhbmNlbCI7CiAgICAgIE1hc3Rlck1lc3NhZ2VUeXBlWyJydW4iXSA9ICJydW4iOwogICAgfSkoZXhwb3J0cy5NYXN0ZXJNZXNzYWdlVHlwZSB8fCAoZXhwb3J0cy5NYXN0ZXJNZXNzYWdlVHlwZSA9IHt9KSk7CiAgICAoZnVuY3Rpb24oV29ya2VyTWVzc2FnZVR5cGUpIHsKICAgICAgV29ya2VyTWVzc2FnZVR5cGVbImVycm9yIl0gPSAiZXJyb3IiOwogICAgICBXb3JrZXJNZXNzYWdlVHlwZVsiaW5pdCJdID0gImluaXQiOwogICAgICBXb3JrZXJNZXNzYWdlVHlwZVsicmVzdWx0Il0gPSAicmVzdWx0IjsKICAgICAgV29ya2VyTWVzc2FnZVR5cGVbInJ1bm5pbmciXSA9ICJydW5uaW5nIjsKICAgICAgV29ya2VyTWVzc2FnZVR5cGVbInVuY2F1Z2h0RXJyb3IiXSA9ICJ1bmNhdWdodEVycm9yIjsKICAgIH0pKGV4cG9ydHMuV29ya2VyTWVzc2FnZVR5cGUgfHwgKGV4cG9ydHMuV29ya2VyTWVzc2FnZVR5cGUgPSB7fSkpOwogIH0pKG1lc3NhZ2VzJDEpOwogIHZhciBpbXBsZW1lbnRhdGlvbl9icm93c2VyID0ge307CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGltcGxlbWVudGF0aW9uX2Jyb3dzZXIsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICBjb25zdCBpc1dvcmtlclJ1bnRpbWUgPSBmdW5jdGlvbiBpc1dvcmtlclJ1bnRpbWUyKCkgewogICAgY29uc3QgaXNXaW5kb3dDb250ZXh0ID0gdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiBXaW5kb3cgIT09ICJ1bmRlZmluZWQiICYmIHNlbGYgaW5zdGFuY2VvZiBXaW5kb3c7CiAgICByZXR1cm4gdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiICYmIHNlbGYucG9zdE1lc3NhZ2UgJiYgIWlzV2luZG93Q29udGV4dCA/IHRydWUgOiBmYWxzZTsKICB9OwogIGNvbnN0IHBvc3RNZXNzYWdlVG9NYXN0ZXIgPSBmdW5jdGlvbiBwb3N0TWVzc2FnZVRvTWFzdGVyMihkYXRhMiwgdHJhbnNmZXJMaXN0KSB7CiAgICBzZWxmLnBvc3RNZXNzYWdlKGRhdGEyLCB0cmFuc2Zlckxpc3QpOwogIH07CiAgY29uc3Qgc3Vic2NyaWJlVG9NYXN0ZXJNZXNzYWdlcyA9IGZ1bmN0aW9uIHN1YnNjcmliZVRvTWFzdGVyTWVzc2FnZXMyKG9uTWVzc2FnZSkgewogICAgY29uc3QgbWVzc2FnZUhhbmRsZXIgPSAobWVzc2FnZUV2ZW50KSA9PiB7CiAgICAgIG9uTWVzc2FnZShtZXNzYWdlRXZlbnQuZGF0YSk7CiAgICB9OwogICAgY29uc3QgdW5zdWJzY3JpYmUgPSAoKSA9PiB7CiAgICAgIHNlbGYucmVtb3ZlRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIG1lc3NhZ2VIYW5kbGVyKTsKICAgIH07CiAgICBzZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBtZXNzYWdlSGFuZGxlcik7CiAgICByZXR1cm4gdW5zdWJzY3JpYmU7CiAgfTsKICBpbXBsZW1lbnRhdGlvbl9icm93c2VyLmRlZmF1bHQgPSB7CiAgICBpc1dvcmtlclJ1bnRpbWUsCiAgICBwb3N0TWVzc2FnZVRvTWFzdGVyLAogICAgc3Vic2NyaWJlVG9NYXN0ZXJNZXNzYWdlcwogIH07CiAgKGZ1bmN0aW9uKGV4cG9ydHMpIHsKICAgIHZhciBfX2F3YWl0ZXIgPSBjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2F3YWl0ZXIgfHwgZnVuY3Rpb24odGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7CiAgICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24ocmVzb2x2ZSkgewogICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RlcChnZW5lcmF0b3JbInRocm93Il0odmFsdWUpKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgewogICAgICAgICAgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7CiAgICAgICAgfQogICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTsKICAgICAgfSk7CiAgICB9OwogICAgdmFyIF9faW1wb3J0RGVmYXVsdCA9IGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9faW1wb3J0RGVmYXVsdCB8fCBmdW5jdGlvbihtb2QpIHsKICAgICAgcmV0dXJuIG1vZCAmJiBtb2QuX19lc01vZHVsZSA/IG1vZCA6IHsgImRlZmF1bHQiOiBtb2QgfTsKICAgIH07CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgZXhwb3J0cy5leHBvc2UgPSBleHBvcnRzLmlzV29ya2VyUnVudGltZSA9IGV4cG9ydHMuVHJhbnNmZXIgPSBleHBvcnRzLnJlZ2lzdGVyU2VyaWFsaXplciA9IHZvaWQgMDsKICAgIGNvbnN0IGlzX29ic2VydmFibGVfMSA9IF9faW1wb3J0RGVmYXVsdChpc09ic2VydmFibGUpOwogICAgY29uc3QgY29tbW9uXzEgPSBjb21tb24kMTsKICAgIGNvbnN0IHRyYW5zZmVyYWJsZV8xID0gdHJhbnNmZXJhYmxlOwogICAgY29uc3QgbWVzc2FnZXNfMSA9IG1lc3NhZ2VzJDE7CiAgICBjb25zdCBpbXBsZW1lbnRhdGlvbl8xID0gX19pbXBvcnREZWZhdWx0KGltcGxlbWVudGF0aW9uX2Jyb3dzZXIpOwogICAgdmFyIGNvbW1vbl8yID0gY29tbW9uJDE7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgInJlZ2lzdGVyU2VyaWFsaXplciIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGNvbW1vbl8yLnJlZ2lzdGVyU2VyaWFsaXplcjsKICAgIH0gfSk7CiAgICB2YXIgdHJhbnNmZXJhYmxlXzIgPSB0cmFuc2ZlcmFibGU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIlRyYW5zZmVyIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdHJhbnNmZXJhYmxlXzIuVHJhbnNmZXI7CiAgICB9IH0pOwogICAgZXhwb3J0cy5pc1dvcmtlclJ1bnRpbWUgPSBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQuaXNXb3JrZXJSdW50aW1lOwogICAgbGV0IGV4cG9zZUNhbGxlZCA9IGZhbHNlOwogICAgY29uc3QgYWN0aXZlU3Vic2NyaXB0aW9ucyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgICBjb25zdCBpc01hc3RlckpvYkNhbmNlbE1lc3NhZ2UgPSAodGhpbmcpID0+IHRoaW5nICYmIHRoaW5nLnR5cGUgPT09IG1lc3NhZ2VzXzEuTWFzdGVyTWVzc2FnZVR5cGUuY2FuY2VsOwogICAgY29uc3QgaXNNYXN0ZXJKb2JSdW5NZXNzYWdlID0gKHRoaW5nKSA9PiB0aGluZyAmJiB0aGluZy50eXBlID09PSBtZXNzYWdlc18xLk1hc3Rlck1lc3NhZ2VUeXBlLnJ1bjsKICAgIGNvbnN0IGlzT2JzZXJ2YWJsZSQxID0gKHRoaW5nKSA9PiBpc19vYnNlcnZhYmxlXzEuZGVmYXVsdCh0aGluZykgfHwgaXNaZW5PYnNlcnZhYmxlKHRoaW5nKTsKICAgIGZ1bmN0aW9uIGlzWmVuT2JzZXJ2YWJsZSh0aGluZykgewogICAgICByZXR1cm4gdGhpbmcgJiYgdHlwZW9mIHRoaW5nID09PSAib2JqZWN0IiAmJiB0eXBlb2YgdGhpbmcuc3Vic2NyaWJlID09PSAiZnVuY3Rpb24iOwogICAgfQogICAgZnVuY3Rpb24gZGVjb25zdHJ1Y3RUcmFuc2Zlcih0aGluZykgewogICAgICByZXR1cm4gdHJhbnNmZXJhYmxlXzEuaXNUcmFuc2ZlckRlc2NyaXB0b3IodGhpbmcpID8geyBwYXlsb2FkOiB0aGluZy5zZW5kLCB0cmFuc2ZlcmFibGVzOiB0aGluZy50cmFuc2ZlcmFibGVzIH0gOiB7IHBheWxvYWQ6IHRoaW5nLCB0cmFuc2ZlcmFibGVzOiB2b2lkIDAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIHBvc3RGdW5jdGlvbkluaXRNZXNzYWdlKCkgewogICAgICBjb25zdCBpbml0TWVzc2FnZSA9IHsKICAgICAgICB0eXBlOiBtZXNzYWdlc18xLldvcmtlck1lc3NhZ2VUeXBlLmluaXQsCiAgICAgICAgZXhwb3NlZDogewogICAgICAgICAgdHlwZTogImZ1bmN0aW9uIgogICAgICAgIH0KICAgICAgfTsKICAgICAgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LnBvc3RNZXNzYWdlVG9NYXN0ZXIoaW5pdE1lc3NhZ2UpOwogICAgfQogICAgZnVuY3Rpb24gcG9zdE1vZHVsZUluaXRNZXNzYWdlKG1ldGhvZE5hbWVzKSB7CiAgICAgIGNvbnN0IGluaXRNZXNzYWdlID0gewogICAgICAgIHR5cGU6IG1lc3NhZ2VzXzEuV29ya2VyTWVzc2FnZVR5cGUuaW5pdCwKICAgICAgICBleHBvc2VkOiB7CiAgICAgICAgICB0eXBlOiAibW9kdWxlIiwKICAgICAgICAgIG1ldGhvZHM6IG1ldGhvZE5hbWVzCiAgICAgICAgfQogICAgICB9OwogICAgICBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQucG9zdE1lc3NhZ2VUb01hc3Rlcihpbml0TWVzc2FnZSk7CiAgICB9CiAgICBmdW5jdGlvbiBwb3N0Sm9iRXJyb3JNZXNzYWdlKHVpZDIsIHJhd0Vycm9yKSB7CiAgICAgIGNvbnN0IHsgcGF5bG9hZDogZXJyb3IsIHRyYW5zZmVyYWJsZXMgfSA9IGRlY29uc3RydWN0VHJhbnNmZXIocmF3RXJyb3IpOwogICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSB7CiAgICAgICAgdHlwZTogbWVzc2FnZXNfMS5Xb3JrZXJNZXNzYWdlVHlwZS5lcnJvciwKICAgICAgICB1aWQ6IHVpZDIsCiAgICAgICAgZXJyb3I6IGNvbW1vbl8xLnNlcmlhbGl6ZShlcnJvcikKICAgICAgfTsKICAgICAgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LnBvc3RNZXNzYWdlVG9NYXN0ZXIoZXJyb3JNZXNzYWdlLCB0cmFuc2ZlcmFibGVzKTsKICAgIH0KICAgIGZ1bmN0aW9uIHBvc3RKb2JSZXN1bHRNZXNzYWdlKHVpZDIsIGNvbXBsZXRlZCwgcmVzdWx0VmFsdWUpIHsKICAgICAgY29uc3QgeyBwYXlsb2FkLCB0cmFuc2ZlcmFibGVzIH0gPSBkZWNvbnN0cnVjdFRyYW5zZmVyKHJlc3VsdFZhbHVlKTsKICAgICAgY29uc3QgcmVzdWx0TWVzc2FnZSA9IHsKICAgICAgICB0eXBlOiBtZXNzYWdlc18xLldvcmtlck1lc3NhZ2VUeXBlLnJlc3VsdCwKICAgICAgICB1aWQ6IHVpZDIsCiAgICAgICAgY29tcGxldGU6IGNvbXBsZXRlZCA/IHRydWUgOiB2b2lkIDAsCiAgICAgICAgcGF5bG9hZAogICAgICB9OwogICAgICBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQucG9zdE1lc3NhZ2VUb01hc3RlcihyZXN1bHRNZXNzYWdlLCB0cmFuc2ZlcmFibGVzKTsKICAgIH0KICAgIGZ1bmN0aW9uIHBvc3RKb2JTdGFydE1lc3NhZ2UodWlkMiwgcmVzdWx0VHlwZSkgewogICAgICBjb25zdCBzdGFydE1lc3NhZ2UgPSB7CiAgICAgICAgdHlwZTogbWVzc2FnZXNfMS5Xb3JrZXJNZXNzYWdlVHlwZS5ydW5uaW5nLAogICAgICAgIHVpZDogdWlkMiwKICAgICAgICByZXN1bHRUeXBlCiAgICAgIH07CiAgICAgIGltcGxlbWVudGF0aW9uXzEuZGVmYXVsdC5wb3N0TWVzc2FnZVRvTWFzdGVyKHN0YXJ0TWVzc2FnZSk7CiAgICB9CiAgICBmdW5jdGlvbiBwb3N0VW5jYXVnaHRFcnJvck1lc3NhZ2UoZXJyb3IpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSB7CiAgICAgICAgICB0eXBlOiBtZXNzYWdlc18xLldvcmtlck1lc3NhZ2VUeXBlLnVuY2F1Z2h0RXJyb3IsCiAgICAgICAgICBlcnJvcjogY29tbW9uXzEuc2VyaWFsaXplKGVycm9yKQogICAgICAgIH07CiAgICAgICAgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LnBvc3RNZXNzYWdlVG9NYXN0ZXIoZXJyb3JNZXNzYWdlKTsKICAgICAgfSBjYXRjaCAoc3ViRXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJOb3QgcmVwb3J0aW5nIHVuY2F1Z2h0IGVycm9yIGJhY2sgdG8gbWFzdGVyIHRocmVhZCBhcyBpdCBvY2N1cmVkIHdoaWxlIHJlcG9ydGluZyBhbiB1bmNhdWdodCBlcnJvciBhbHJlYWR5LlxuTGF0ZXN0IGVycm9yOiIsIHN1YkVycm9yLCAiXG5PcmlnaW5hbCBlcnJvcjoiLCBlcnJvcik7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIHJ1bkZ1bmN0aW9uKGpvYlVJRCwgZm4sIGFyZ3MpIHsKICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsKICAgICAgICBsZXQgc3luY1Jlc3VsdDsKICAgICAgICB0cnkgewogICAgICAgICAgc3luY1Jlc3VsdCA9IGZuKC4uLmFyZ3MpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICByZXR1cm4gcG9zdEpvYkVycm9yTWVzc2FnZShqb2JVSUQsIGVycm9yKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgcmVzdWx0VHlwZSA9IGlzT2JzZXJ2YWJsZSQxKHN5bmNSZXN1bHQpID8gIm9ic2VydmFibGUiIDogInByb21pc2UiOwogICAgICAgIHBvc3RKb2JTdGFydE1lc3NhZ2Uoam9iVUlELCByZXN1bHRUeXBlKTsKICAgICAgICBpZiAoaXNPYnNlcnZhYmxlJDEoc3luY1Jlc3VsdCkpIHsKICAgICAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHN5bmNSZXN1bHQuc3Vic2NyaWJlKCh2YWx1ZSkgPT4gcG9zdEpvYlJlc3VsdE1lc3NhZ2Uoam9iVUlELCBmYWxzZSwgY29tbW9uXzEuc2VyaWFsaXplKHZhbHVlKSksIChlcnJvcikgPT4gewogICAgICAgICAgICBwb3N0Sm9iRXJyb3JNZXNzYWdlKGpvYlVJRCwgY29tbW9uXzEuc2VyaWFsaXplKGVycm9yKSk7CiAgICAgICAgICAgIGFjdGl2ZVN1YnNjcmlwdGlvbnMuZGVsZXRlKGpvYlVJRCk7CiAgICAgICAgICB9LCAoKSA9PiB7CiAgICAgICAgICAgIHBvc3RKb2JSZXN1bHRNZXNzYWdlKGpvYlVJRCwgdHJ1ZSk7CiAgICAgICAgICAgIGFjdGl2ZVN1YnNjcmlwdGlvbnMuZGVsZXRlKGpvYlVJRCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGFjdGl2ZVN1YnNjcmlwdGlvbnMuc2V0KGpvYlVJRCwgc3Vic2NyaXB0aW9uKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0geWllbGQgc3luY1Jlc3VsdDsKICAgICAgICAgICAgcG9zdEpvYlJlc3VsdE1lc3NhZ2Uoam9iVUlELCB0cnVlLCBjb21tb25fMS5zZXJpYWxpemUocmVzdWx0KSk7CiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBwb3N0Sm9iRXJyb3JNZXNzYWdlKGpvYlVJRCwgY29tbW9uXzEuc2VyaWFsaXplKGVycm9yKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIGV4cG9zZTIoZXhwb3NlZCkgewogICAgICBpZiAoIWltcGxlbWVudGF0aW9uXzEuZGVmYXVsdC5pc1dvcmtlclJ1bnRpbWUoKSkgewogICAgICAgIHRocm93IEVycm9yKCJleHBvc2UoKSBjYWxsZWQgaW4gdGhlIG1hc3RlciB0aHJlYWQuIik7CiAgICAgIH0KICAgICAgaWYgKGV4cG9zZUNhbGxlZCkgewogICAgICAgIHRocm93IEVycm9yKCJleHBvc2UoKSBjYWxsZWQgbW9yZSB0aGFuIG9uY2UuIFRoaXMgaXMgbm90IHBvc3NpYmxlLiBQYXNzIGFuIG9iamVjdCB0byBleHBvc2UoKSBpZiB5b3Ugd2FudCB0byBleHBvc2UgbXVsdGlwbGUgZnVuY3Rpb25zLiIpOwogICAgICB9CiAgICAgIGV4cG9zZUNhbGxlZCA9IHRydWU7CiAgICAgIGlmICh0eXBlb2YgZXhwb3NlZCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIGltcGxlbWVudGF0aW9uXzEuZGVmYXVsdC5zdWJzY3JpYmVUb01hc3Rlck1lc3NhZ2VzKChtZXNzYWdlRGF0YSkgPT4gewogICAgICAgICAgaWYgKGlzTWFzdGVySm9iUnVuTWVzc2FnZShtZXNzYWdlRGF0YSkgJiYgIW1lc3NhZ2VEYXRhLm1ldGhvZCkgewogICAgICAgICAgICBydW5GdW5jdGlvbihtZXNzYWdlRGF0YS51aWQsIGV4cG9zZWQsIG1lc3NhZ2VEYXRhLmFyZ3MubWFwKGNvbW1vbl8xLmRlc2VyaWFsaXplKSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcG9zdEZ1bmN0aW9uSW5pdE1lc3NhZ2UoKTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZXhwb3NlZCA9PT0gIm9iamVjdCIgJiYgZXhwb3NlZCkgewogICAgICAgIGltcGxlbWVudGF0aW9uXzEuZGVmYXVsdC5zdWJzY3JpYmVUb01hc3Rlck1lc3NhZ2VzKChtZXNzYWdlRGF0YSkgPT4gewogICAgICAgICAgaWYgKGlzTWFzdGVySm9iUnVuTWVzc2FnZShtZXNzYWdlRGF0YSkgJiYgbWVzc2FnZURhdGEubWV0aG9kKSB7CiAgICAgICAgICAgIHJ1bkZ1bmN0aW9uKG1lc3NhZ2VEYXRhLnVpZCwgZXhwb3NlZFttZXNzYWdlRGF0YS5tZXRob2RdLCBtZXNzYWdlRGF0YS5hcmdzLm1hcChjb21tb25fMS5kZXNlcmlhbGl6ZSkpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IG1ldGhvZE5hbWVzID0gT2JqZWN0LmtleXMoZXhwb3NlZCkuZmlsdGVyKChrZXkpID0+IHR5cGVvZiBleHBvc2VkW2tleV0gPT09ICJmdW5jdGlvbiIpOwogICAgICAgIHBvc3RNb2R1bGVJbml0TWVzc2FnZShtZXRob2ROYW1lcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgRXJyb3IoYEludmFsaWQgYXJndW1lbnQgcGFzc2VkIHRvIGV4cG9zZSgpLiBFeHBlY3RlZCBhIGZ1bmN0aW9uIG9yIGFuIG9iamVjdCwgZ290OiAke2V4cG9zZWR9YCk7CiAgICAgIH0KICAgICAgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LnN1YnNjcmliZVRvTWFzdGVyTWVzc2FnZXMoKG1lc3NhZ2VEYXRhKSA9PiB7CiAgICAgICAgaWYgKGlzTWFzdGVySm9iQ2FuY2VsTWVzc2FnZShtZXNzYWdlRGF0YSkpIHsKICAgICAgICAgIGNvbnN0IGpvYlVJRCA9IG1lc3NhZ2VEYXRhLnVpZDsKICAgICAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGFjdGl2ZVN1YnNjcmlwdGlvbnMuZ2V0KGpvYlVJRCk7CiAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9uKSB7CiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOwogICAgICAgICAgICBhY3RpdmVTdWJzY3JpcHRpb25zLmRlbGV0ZShqb2JVSUQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICBleHBvcnRzLmV4cG9zZSA9IGV4cG9zZTI7CiAgICBpZiAodHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiBzZWxmLmFkZEV2ZW50TGlzdGVuZXIgPT09ICJmdW5jdGlvbiIgJiYgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LmlzV29ya2VyUnVudGltZSgpKSB7CiAgICAgIHNlbGYuYWRkRXZlbnRMaXN0ZW5lcigiZXJyb3IiLCAoZXZlbnQpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHBvc3RVbmNhdWdodEVycm9yTWVzc2FnZShldmVudC5lcnJvciB8fCBldmVudCksIDI1MCk7CiAgICAgIH0pOwogICAgICBzZWxmLmFkZEV2ZW50TGlzdGVuZXIoInVuaGFuZGxlZHJlamVjdGlvbiIsIChldmVudCkgPT4gewogICAgICAgIGNvbnN0IGVycm9yID0gZXZlbnQucmVhc29uOwogICAgICAgIGlmIChlcnJvciAmJiB0eXBlb2YgZXJyb3IubWVzc2FnZSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcG9zdFVuY2F1Z2h0RXJyb3JNZXNzYWdlKGVycm9yKSwgMjUwKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgaWYgKHR5cGVvZiBwcm9jZXNzICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YgcHJvY2Vzcy5vbiA9PT0gImZ1bmN0aW9uIiAmJiBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQuaXNXb3JrZXJSdW50aW1lKCkpIHsKICAgICAgcHJvY2Vzcy5vbigidW5jYXVnaHRFeGNlcHRpb24iLCAoZXJyb3IpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHBvc3RVbmNhdWdodEVycm9yTWVzc2FnZShlcnJvciksIDI1MCk7CiAgICAgIH0pOwogICAgICBwcm9jZXNzLm9uKCJ1bmhhbmRsZWRSZWplY3Rpb24iLCAoZXJyb3IpID0+IHsKICAgICAgICBpZiAoZXJyb3IgJiYgdHlwZW9mIGVycm9yLm1lc3NhZ2UgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHBvc3RVbmNhdWdodEVycm9yTWVzc2FnZShlcnJvciksIDI1MCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9KSh3b3JrZXIpOwogIHZhciBXb3JrZXJDb250ZXh0ID0gLyogQF9fUFVSRV9fICovIGdldERlZmF1bHRFeHBvcnRGcm9tQ2pzKHdvcmtlcik7CiAgY29uc3QgZXhwb3NlID0gV29ya2VyQ29udGV4dC5leHBvc2U7CiAgV29ya2VyQ29udGV4dC5yZWdpc3RlclNlcmlhbGl6ZXI7CiAgY29uc3QgVHJhbnNmZXIgPSBXb3JrZXJDb250ZXh0LlRyYW5zZmVyOwogIHZhciBkaXN0JDMgPSB7fTsKICB2YXIgaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDEgPSB7IGV4cG9ydHM6IHt9IH07CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIob2JqKSB7CiAgICAgIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICAgICAgImRlZmF1bHQiOiBvYmoKICAgICAgfTsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDI7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKGludGVyb3BSZXF1aXJlRGVmYXVsdCQxKTsKICB2YXIgZGVmaW5lUHJvcGVydHkkYyA9IHsgZXhwb3J0czoge30gfTsKICB2YXIgY2hlY2sgPSBmdW5jdGlvbihpdCkgewogICAgcmV0dXJuIGl0ICYmIGl0Lk1hdGggPT0gTWF0aCAmJiBpdDsKICB9OwogIHZhciBnbG9iYWwkbyA9IGNoZWNrKHR5cGVvZiBnbG9iYWxUaGlzID09ICJvYmplY3QiICYmIGdsb2JhbFRoaXMpIHx8IGNoZWNrKHR5cGVvZiB3aW5kb3cgPT0gIm9iamVjdCIgJiYgd2luZG93KSB8fCBjaGVjayh0eXBlb2Ygc2VsZiA9PSAib2JqZWN0IiAmJiBzZWxmKSB8fCBjaGVjayh0eXBlb2YgY29tbW9uanNHbG9iYWwgPT0gIm9iamVjdCIgJiYgY29tbW9uanNHbG9iYWwpIHx8IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXM7CiAgfSgpIHx8IEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCk7CiAgdmFyIGlzQ2FsbGFibGUkbCA9IGZ1bmN0aW9uKGFyZ3VtZW50KSB7CiAgICByZXR1cm4gdHlwZW9mIGFyZ3VtZW50ID09PSAiZnVuY3Rpb24iOwogIH07CiAgdmFyIG9iamVjdEdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IHt9OwogIHZhciBmYWlscyRuID0gZnVuY3Rpb24oZXhlYzIpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiAhIWV4ZWMyKCk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9OwogIHZhciBmYWlscyRtID0gZmFpbHMkbjsKICB2YXIgZGVzY3JpcHRvcnMgPSAhZmFpbHMkbShmdW5jdGlvbigpIHsKICAgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sIDEsIHsgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIDc7CiAgICB9IH0pWzFdICE9IDc7CiAgfSk7CiAgdmFyIG9iamVjdFByb3BlcnR5SXNFbnVtZXJhYmxlID0ge307CiAgdmFyICRwcm9wZXJ0eUlzRW51bWVyYWJsZSQxID0ge30ucHJvcGVydHlJc0VudW1lcmFibGU7CiAgdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvciQ4ID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKICB2YXIgTkFTSE9STl9CVUcgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkOCAmJiAhJHByb3BlcnR5SXNFbnVtZXJhYmxlJDEuY2FsbCh7IDE6IDIgfSwgMSk7CiAgb2JqZWN0UHJvcGVydHlJc0VudW1lcmFibGUuZiA9IE5BU0hPUk5fQlVHID8gZnVuY3Rpb24gcHJvcGVydHlJc0VudW1lcmFibGUoVikgewogICAgdmFyIGRlc2NyaXB0b3IgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkOCh0aGlzLCBWKTsKICAgIHJldHVybiAhIWRlc2NyaXB0b3IgJiYgZGVzY3JpcHRvci5lbnVtZXJhYmxlOwogIH0gOiAkcHJvcGVydHlJc0VudW1lcmFibGUkMTsKICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDYgPSBmdW5jdGlvbihiaXRtYXAsIHZhbHVlKSB7CiAgICByZXR1cm4gewogICAgICBlbnVtZXJhYmxlOiAhKGJpdG1hcCAmIDEpLAogICAgICBjb25maWd1cmFibGU6ICEoYml0bWFwICYgMiksCiAgICAgIHdyaXRhYmxlOiAhKGJpdG1hcCAmIDQpLAogICAgICB2YWx1ZQogICAgfTsKICB9OwogIHZhciB0b1N0cmluZyRjID0ge30udG9TdHJpbmc7CiAgdmFyIGNsYXNzb2ZSYXckMSA9IGZ1bmN0aW9uKGl0KSB7CiAgICByZXR1cm4gdG9TdHJpbmckYy5jYWxsKGl0KS5zbGljZSg4LCAtMSk7CiAgfTsKICB2YXIgZmFpbHMkbCA9IGZhaWxzJG47CiAgdmFyIGNsYXNzb2YkYSA9IGNsYXNzb2ZSYXckMTsKICB2YXIgc3BsaXQgPSAiIi5zcGxpdDsKICB2YXIgaW5kZXhlZE9iamVjdCA9IGZhaWxzJGwoZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gIU9iamVjdCgieiIpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApOwogIH0pID8gZnVuY3Rpb24oaXQpIHsKICAgIHJldHVybiBjbGFzc29mJGEoaXQpID09ICJTdHJpbmciID8gc3BsaXQuY2FsbChpdCwgIiIpIDogT2JqZWN0KGl0KTsKICB9IDogT2JqZWN0OwogIHZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDUgPSBmdW5jdGlvbihpdCkgewogICAgaWYgKGl0ID09IHZvaWQgMCkKICAgICAgdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBjYWxsIG1ldGhvZCBvbiAiICsgaXQpOwogICAgcmV0dXJuIGl0OwogIH07CiAgdmFyIEluZGV4ZWRPYmplY3QkMyA9IGluZGV4ZWRPYmplY3Q7CiAgdmFyIHJlcXVpcmVPYmplY3RDb2VyY2libGUkNCA9IHJlcXVpcmVPYmplY3RDb2VyY2libGUkNTsKICB2YXIgdG9JbmRleGVkT2JqZWN0JDkgPSBmdW5jdGlvbihpdCkgewogICAgcmV0dXJuIEluZGV4ZWRPYmplY3QkMyhyZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDQoaXQpKTsKICB9OwogIHZhciBpc0NhbGxhYmxlJGsgPSBpc0NhbGxhYmxlJGw7CiAgdmFyIGlzT2JqZWN0JGkgPSBmdW5jdGlvbihpdCkgewogICAgcmV0dXJuIHR5cGVvZiBpdCA9PT0gIm9iamVjdCIgPyBpdCAhPT0gbnVsbCA6IGlzQ2FsbGFibGUkayhpdCk7CiAgfTsKICB2YXIgcGF0aCRuID0ge307CiAgdmFyIHBhdGgkbSA9IHBhdGgkbjsKICB2YXIgZ2xvYmFsJG4gPSBnbG9iYWwkbzsKICB2YXIgaXNDYWxsYWJsZSRqID0gaXNDYWxsYWJsZSRsOwogIHZhciBhRnVuY3Rpb24gPSBmdW5jdGlvbih2YXJpYWJsZSkgewogICAgcmV0dXJuIGlzQ2FsbGFibGUkaih2YXJpYWJsZSkgPyB2YXJpYWJsZSA6IHZvaWQgMDsKICB9OwogIHZhciBnZXRCdWlsdEluJGIgPSBmdW5jdGlvbihuYW1lc3BhY2UsIG1ldGhvZCkgewogICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPCAyID8gYUZ1bmN0aW9uKHBhdGgkbVtuYW1lc3BhY2VdKSB8fCBhRnVuY3Rpb24oZ2xvYmFsJG5bbmFtZXNwYWNlXSkgOiBwYXRoJG1bbmFtZXNwYWNlXSAmJiBwYXRoJG1bbmFtZXNwYWNlXVttZXRob2RdIHx8IGdsb2JhbCRuW25hbWVzcGFjZV0gJiYgZ2xvYmFsJG5bbmFtZXNwYWNlXVttZXRob2RdOwogIH07CiAgdmFyIGdldEJ1aWx0SW4kYSA9IGdldEJ1aWx0SW4kYjsKICB2YXIgZW5naW5lVXNlckFnZW50ID0gZ2V0QnVpbHRJbiRhKCJuYXZpZ2F0b3IiLCAidXNlckFnZW50IikgfHwgIiI7CiAgdmFyIGdsb2JhbCRtID0gZ2xvYmFsJG87CiAgdmFyIHVzZXJBZ2VudCQ2ID0gZW5naW5lVXNlckFnZW50OwogIHZhciBwcm9jZXNzJDQgPSBnbG9iYWwkbS5wcm9jZXNzOwogIHZhciBEZW5vID0gZ2xvYmFsJG0uRGVubzsKICB2YXIgdmVyc2lvbnMgPSBwcm9jZXNzJDQgJiYgcHJvY2VzcyQ0LnZlcnNpb25zIHx8IERlbm8gJiYgRGVuby52ZXJzaW9uOwogIHZhciB2OCA9IHZlcnNpb25zICYmIHZlcnNpb25zLnY4OwogIHZhciBtYXRjaCwgdmVyc2lvbjsKICBpZiAodjgpIHsKICAgIG1hdGNoID0gdjguc3BsaXQoIi4iKTsKICAgIHZlcnNpb24gPSBtYXRjaFswXSA8IDQgPyAxIDogbWF0Y2hbMF0gKyBtYXRjaFsxXTsKICB9IGVsc2UgaWYgKHVzZXJBZ2VudCQ2KSB7CiAgICBtYXRjaCA9IHVzZXJBZ2VudCQ2Lm1hdGNoKC9FZGdlXC8oXGQrKS8pOwogICAgaWYgKCFtYXRjaCB8fCBtYXRjaFsxXSA+PSA3NCkgewogICAgICBtYXRjaCA9IHVzZXJBZ2VudCQ2Lm1hdGNoKC9DaHJvbWVcLyhcZCspLyk7CiAgICAgIGlmIChtYXRjaCkKICAgICAgICB2ZXJzaW9uID0gbWF0Y2hbMV07CiAgICB9CiAgfQogIHZhciBlbmdpbmVWOFZlcnNpb24gPSB2ZXJzaW9uICYmICt2ZXJzaW9uOwogIHZhciBWOF9WRVJTSU9OJDMgPSBlbmdpbmVWOFZlcnNpb247CiAgdmFyIGZhaWxzJGsgPSBmYWlscyRuOwogIHZhciBuYXRpdmVTeW1ib2wgPSAhIU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgJiYgIWZhaWxzJGsoZnVuY3Rpb24oKSB7CiAgICB2YXIgc3ltYm9sMiA9IFN5bWJvbCgpOwogICAgcmV0dXJuICFTdHJpbmcoc3ltYm9sMikgfHwgIShPYmplY3Qoc3ltYm9sMikgaW5zdGFuY2VvZiBTeW1ib2wpIHx8ICFTeW1ib2wuc2hhbSAmJiBWOF9WRVJTSU9OJDMgJiYgVjhfVkVSU0lPTiQzIDwgNDE7CiAgfSk7CiAgdmFyIE5BVElWRV9TWU1CT0wkMiA9IG5hdGl2ZVN5bWJvbDsKICB2YXIgdXNlU3ltYm9sQXNVaWQgPSBOQVRJVkVfU1lNQk9MJDIgJiYgIVN5bWJvbC5zaGFtICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT0gInN5bWJvbCI7CiAgdmFyIGlzQ2FsbGFibGUkaSA9IGlzQ2FsbGFibGUkbDsKICB2YXIgZ2V0QnVpbHRJbiQ5ID0gZ2V0QnVpbHRJbiRiOwogIHZhciBVU0VfU1lNQk9MX0FTX1VJRCQxID0gdXNlU3ltYm9sQXNVaWQ7CiAgdmFyIGlzU3ltYm9sJDMgPSBVU0VfU1lNQk9MX0FTX1VJRCQxID8gZnVuY3Rpb24oaXQpIHsKICAgIHJldHVybiB0eXBlb2YgaXQgPT0gInN5bWJvbCI7CiAgfSA6IGZ1bmN0aW9uKGl0KSB7CiAgICB2YXIgJFN5bWJvbDIgPSBnZXRCdWlsdEluJDkoIlN5bWJvbCIpOwogICAgcmV0dXJuIGlzQ2FsbGFibGUkaSgkU3ltYm9sMikgJiYgT2JqZWN0KGl0KSBpbnN0YW5jZW9mICRTeW1ib2wyOwogIH07CiAgdmFyIHRyeVRvU3RyaW5nJDIgPSBmdW5jdGlvbihhcmd1bWVudCkgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIFN0cmluZyhhcmd1bWVudCk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICByZXR1cm4gIk9iamVjdCI7CiAgICB9CiAgfTsKICB2YXIgaXNDYWxsYWJsZSRoID0gaXNDYWxsYWJsZSRsOwogIHZhciB0cnlUb1N0cmluZyQxID0gdHJ5VG9TdHJpbmckMjsKICB2YXIgYUNhbGxhYmxlJGMgPSBmdW5jdGlvbihhcmd1bWVudCkgewogICAgaWYgKGlzQ2FsbGFibGUkaChhcmd1bWVudCkpCiAgICAgIHJldHVybiBhcmd1bWVudDsKICAgIHRocm93IFR5cGVFcnJvcih0cnlUb1N0cmluZyQxKGFyZ3VtZW50KSArICIgaXMgbm90IGEgZnVuY3Rpb24iKTsKICB9OwogIHZhciBhQ2FsbGFibGUkYiA9IGFDYWxsYWJsZSRjOwogIHZhciBnZXRNZXRob2QkMyA9IGZ1bmN0aW9uKFYsIFApIHsKICAgIHZhciBmdW5jID0gVltQXTsKICAgIHJldHVybiBmdW5jID09IG51bGwgPyB2b2lkIDAgOiBhQ2FsbGFibGUkYihmdW5jKTsKICB9OwogIHZhciBpc0NhbGxhYmxlJGcgPSBpc0NhbGxhYmxlJGw7CiAgdmFyIGlzT2JqZWN0JGggPSBpc09iamVjdCRpOwogIHZhciBvcmRpbmFyeVRvUHJpbWl0aXZlJDEgPSBmdW5jdGlvbihpbnB1dCwgcHJlZikgewogICAgdmFyIGZuLCB2YWw7CiAgICBpZiAocHJlZiA9PT0gInN0cmluZyIgJiYgaXNDYWxsYWJsZSRnKGZuID0gaW5wdXQudG9TdHJpbmcpICYmICFpc09iamVjdCRoKHZhbCA9IGZuLmNhbGwoaW5wdXQpKSkKICAgICAgcmV0dXJuIHZhbDsKICAgIGlmIChpc0NhbGxhYmxlJGcoZm4gPSBpbnB1dC52YWx1ZU9mKSAmJiAhaXNPYmplY3QkaCh2YWwgPSBmbi5jYWxsKGlucHV0KSkpCiAgICAgIHJldHVybiB2YWw7CiAgICBpZiAocHJlZiAhPT0gInN0cmluZyIgJiYgaXNDYWxsYWJsZSRnKGZuID0gaW5wdXQudG9TdHJpbmcpICYmICFpc09iamVjdCRoKHZhbCA9IGZuLmNhbGwoaW5wdXQpKSkKICAgICAgcmV0dXJuIHZhbDsKICAgIHRocm93IFR5cGVFcnJvcigiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIik7CiAgfTsKICB2YXIgc2hhcmVkJDQgPSB7IGV4cG9ydHM6IHt9IH07CiAgdmFyIGlzUHVyZSA9IHRydWU7CiAgdmFyIGdsb2JhbCRsID0gZ2xvYmFsJG87CiAgdmFyIHNldEdsb2JhbCQxID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgdHJ5IHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGdsb2JhbCRsLCBrZXksIHsgdmFsdWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBnbG9iYWwkbFtrZXldID0gdmFsdWU7CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfTsKICB2YXIgZ2xvYmFsJGsgPSBnbG9iYWwkbzsKICB2YXIgc2V0R2xvYmFsID0gc2V0R2xvYmFsJDE7CiAgdmFyIFNIQVJFRCA9ICJfX2NvcmUtanNfc2hhcmVkX18iOwogIHZhciBzdG9yZSQzID0gZ2xvYmFsJGtbU0hBUkVEXSB8fCBzZXRHbG9iYWwoU0hBUkVELCB7fSk7CiAgdmFyIHNoYXJlZFN0b3JlID0gc3RvcmUkMzsKICB2YXIgc3RvcmUkMiA9IHNoYXJlZFN0b3JlOwogIChzaGFyZWQkNC5leHBvcnRzID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgcmV0dXJuIHN0b3JlJDJba2V5XSB8fCAoc3RvcmUkMltrZXldID0gdmFsdWUgIT09IHZvaWQgMCA/IHZhbHVlIDoge30pOwogIH0pKCJ2ZXJzaW9ucyIsIFtdKS5wdXNoKHsKICAgIHZlcnNpb246ICIzLjE4LjAiLAogICAgbW9kZTogInB1cmUiLAogICAgY29weXJpZ2h0OiAiXHhBOSAyMDIxIERlbmlzIFB1c2hrYXJldiAoemxvaXJvY2sucnUpIgogIH0pOwogIHZhciByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDMgPSByZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDU7CiAgdmFyIHRvT2JqZWN0JGIgPSBmdW5jdGlvbihhcmd1bWVudCkgewogICAgcmV0dXJuIE9iamVjdChyZXF1aXJlT2JqZWN0Q29lcmNpYmxlJDMoYXJndW1lbnQpKTsKICB9OwogIHZhciB0b09iamVjdCRhID0gdG9PYmplY3QkYjsKICB2YXIgaGFzT3duUHJvcGVydHkgPSB7fS5oYXNPd25Qcm9wZXJ0eTsKICB2YXIgaGFzJGMgPSBPYmplY3QuaGFzT3duIHx8IGZ1bmN0aW9uIGhhc093bihpdCwga2V5KSB7CiAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbCh0b09iamVjdCRhKGl0KSwga2V5KTsKICB9OwogIHZhciBpZCQyID0gMDsKICB2YXIgcG9zdGZpeCA9IE1hdGgucmFuZG9tKCk7CiAgdmFyIHVpZCQ0ID0gZnVuY3Rpb24oa2V5KSB7CiAgICByZXR1cm4gIlN5bWJvbCgiICsgU3RyaW5nKGtleSA9PT0gdm9pZCAwID8gIiIgOiBrZXkpICsgIilfIiArICgrK2lkJDIgKyBwb3N0Zml4KS50b1N0cmluZygzNik7CiAgfTsKICB2YXIgZ2xvYmFsJGogPSBnbG9iYWwkbzsKICB2YXIgc2hhcmVkJDMgPSBzaGFyZWQkNC5leHBvcnRzOwogIHZhciBoYXMkYiA9IGhhcyRjOwogIHZhciB1aWQkMyA9IHVpZCQ0OwogIHZhciBOQVRJVkVfU1lNQk9MJDEgPSBuYXRpdmVTeW1ib2w7CiAgdmFyIFVTRV9TWU1CT0xfQVNfVUlEID0gdXNlU3ltYm9sQXNVaWQ7CiAgdmFyIFdlbGxLbm93blN5bWJvbHNTdG9yZSQxID0gc2hhcmVkJDMoIndrcyIpOwogIHZhciBTeW1ib2wkMiA9IGdsb2JhbCRqLlN5bWJvbDsKICB2YXIgY3JlYXRlV2VsbEtub3duU3ltYm9sID0gVVNFX1NZTUJPTF9BU19VSUQgPyBTeW1ib2wkMiA6IFN5bWJvbCQyICYmIFN5bWJvbCQyLndpdGhvdXRTZXR0ZXIgfHwgdWlkJDM7CiAgdmFyIHdlbGxLbm93blN5bWJvbCRsID0gZnVuY3Rpb24obmFtZSkgewogICAgaWYgKCFoYXMkYihXZWxsS25vd25TeW1ib2xzU3RvcmUkMSwgbmFtZSkgfHwgIShOQVRJVkVfU1lNQk9MJDEgfHwgdHlwZW9mIFdlbGxLbm93blN5bWJvbHNTdG9yZSQxW25hbWVdID09ICJzdHJpbmciKSkgewogICAgICBpZiAoTkFUSVZFX1NZTUJPTCQxICYmIGhhcyRiKFN5bWJvbCQyLCBuYW1lKSkgewogICAgICAgIFdlbGxLbm93blN5bWJvbHNTdG9yZSQxW25hbWVdID0gU3ltYm9sJDJbbmFtZV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgV2VsbEtub3duU3ltYm9sc1N0b3JlJDFbbmFtZV0gPSBjcmVhdGVXZWxsS25vd25TeW1ib2woIlN5bWJvbC4iICsgbmFtZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBXZWxsS25vd25TeW1ib2xzU3RvcmUkMVtuYW1lXTsKICB9OwogIHZhciBpc09iamVjdCRnID0gaXNPYmplY3QkaTsKICB2YXIgaXNTeW1ib2wkMiA9IGlzU3ltYm9sJDM7CiAgdmFyIGdldE1ldGhvZCQyID0gZ2V0TWV0aG9kJDM7CiAgdmFyIG9yZGluYXJ5VG9QcmltaXRpdmUgPSBvcmRpbmFyeVRvUHJpbWl0aXZlJDE7CiAgdmFyIHdlbGxLbm93blN5bWJvbCRrID0gd2VsbEtub3duU3ltYm9sJGw7CiAgdmFyIFRPX1BSSU1JVElWRSQxID0gd2VsbEtub3duU3ltYm9sJGsoInRvUHJpbWl0aXZlIik7CiAgdmFyIHRvUHJpbWl0aXZlJDEgPSBmdW5jdGlvbihpbnB1dCwgcHJlZikgewogICAgaWYgKCFpc09iamVjdCRnKGlucHV0KSB8fCBpc1N5bWJvbCQyKGlucHV0KSkKICAgICAgcmV0dXJuIGlucHV0OwogICAgdmFyIGV4b3RpY1RvUHJpbSA9IGdldE1ldGhvZCQyKGlucHV0LCBUT19QUklNSVRJVkUkMSk7CiAgICB2YXIgcmVzdWx0OwogICAgaWYgKGV4b3RpY1RvUHJpbSkgewogICAgICBpZiAocHJlZiA9PT0gdm9pZCAwKQogICAgICAgIHByZWYgPSAiZGVmYXVsdCI7CiAgICAgIHJlc3VsdCA9IGV4b3RpY1RvUHJpbS5jYWxsKGlucHV0LCBwcmVmKTsKICAgICAgaWYgKCFpc09iamVjdCRnKHJlc3VsdCkgfHwgaXNTeW1ib2wkMihyZXN1bHQpKQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIHRocm93IFR5cGVFcnJvcigiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIik7CiAgICB9CiAgICBpZiAocHJlZiA9PT0gdm9pZCAwKQogICAgICBwcmVmID0gIm51bWJlciI7CiAgICByZXR1cm4gb3JkaW5hcnlUb1ByaW1pdGl2ZShpbnB1dCwgcHJlZik7CiAgfTsKICB2YXIgdG9QcmltaXRpdmUgPSB0b1ByaW1pdGl2ZSQxOwogIHZhciBpc1N5bWJvbCQxID0gaXNTeW1ib2wkMzsKICB2YXIgdG9Qcm9wZXJ0eUtleSQ0ID0gZnVuY3Rpb24oYXJndW1lbnQpIHsKICAgIHZhciBrZXkgPSB0b1ByaW1pdGl2ZShhcmd1bWVudCwgInN0cmluZyIpOwogICAgcmV0dXJuIGlzU3ltYm9sJDEoa2V5KSA/IGtleSA6IFN0cmluZyhrZXkpOwogIH07CiAgdmFyIGdsb2JhbCRpID0gZ2xvYmFsJG87CiAgdmFyIGlzT2JqZWN0JGYgPSBpc09iamVjdCRpOwogIHZhciBkb2N1bWVudCQzID0gZ2xvYmFsJGkuZG9jdW1lbnQ7CiAgdmFyIEVYSVNUUyQxID0gaXNPYmplY3QkZihkb2N1bWVudCQzKSAmJiBpc09iamVjdCRmKGRvY3VtZW50JDMuY3JlYXRlRWxlbWVudCk7CiAgdmFyIGRvY3VtZW50Q3JlYXRlRWxlbWVudCQxID0gZnVuY3Rpb24oaXQpIHsKICAgIHJldHVybiBFWElTVFMkMSA/IGRvY3VtZW50JDMuY3JlYXRlRWxlbWVudChpdCkgOiB7fTsKICB9OwogIHZhciBERVNDUklQVE9SUyRlID0gZGVzY3JpcHRvcnM7CiAgdmFyIGZhaWxzJGogPSBmYWlscyRuOwogIHZhciBjcmVhdGVFbGVtZW50JDEgPSBkb2N1bWVudENyZWF0ZUVsZW1lbnQkMTsKICB2YXIgaWU4RG9tRGVmaW5lID0gIURFU0NSSVBUT1JTJGUgJiYgIWZhaWxzJGooZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGNyZWF0ZUVsZW1lbnQkMSgiZGl2IiksICJhIiwgewogICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiA3OwogICAgICB9CiAgICB9KS5hICE9IDc7CiAgfSk7CiAgdmFyIERFU0NSSVBUT1JTJGQgPSBkZXNjcmlwdG9yczsKICB2YXIgcHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUkMiA9IG9iamVjdFByb3BlcnR5SXNFbnVtZXJhYmxlOwogIHZhciBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkNSA9IGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciQ2OwogIHZhciB0b0luZGV4ZWRPYmplY3QkOCA9IHRvSW5kZXhlZE9iamVjdCQ5OwogIHZhciB0b1Byb3BlcnR5S2V5JDMgPSB0b1Byb3BlcnR5S2V5JDQ7CiAgdmFyIGhhcyRhID0gaGFzJGM7CiAgdmFyIElFOF9ET01fREVGSU5FJDEgPSBpZThEb21EZWZpbmU7CiAgdmFyICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMSA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgb2JqZWN0R2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLmYgPSBERVNDUklQVE9SUyRkID8gJGdldE93blByb3BlcnR5RGVzY3JpcHRvciQxIDogZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yMihPLCBQKSB7CiAgICBPID0gdG9JbmRleGVkT2JqZWN0JDgoTyk7CiAgICBQID0gdG9Qcm9wZXJ0eUtleSQzKFApOwogICAgaWYgKElFOF9ET01fREVGSU5FJDEpCiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMShPLCBQKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgfQogICAgaWYgKGhhcyRhKE8sIFApKQogICAgICByZXR1cm4gY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDUoIXByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlJDIuZi5jYWxsKE8sIFApLCBPW1BdKTsKICB9OwogIHZhciBmYWlscyRpID0gZmFpbHMkbjsKICB2YXIgaXNDYWxsYWJsZSRmID0gaXNDYWxsYWJsZSRsOwogIHZhciByZXBsYWNlbWVudCA9IC8jfFwucHJvdG90eXBlXC4vOwogIHZhciBpc0ZvcmNlZCQyID0gZnVuY3Rpb24oZmVhdHVyZSwgZGV0ZWN0aW9uKSB7CiAgICB2YXIgdmFsdWUgPSBkYXRhW25vcm1hbGl6ZShmZWF0dXJlKV07CiAgICByZXR1cm4gdmFsdWUgPT0gUE9MWUZJTEwgPyB0cnVlIDogdmFsdWUgPT0gTkFUSVZFID8gZmFsc2UgOiBpc0NhbGxhYmxlJGYoZGV0ZWN0aW9uKSA/IGZhaWxzJGkoZGV0ZWN0aW9uKSA6ICEhZGV0ZWN0aW9uOwogIH07CiAgdmFyIG5vcm1hbGl6ZSA9IGlzRm9yY2VkJDIubm9ybWFsaXplID0gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICByZXR1cm4gU3RyaW5nKHN0cmluZykucmVwbGFjZShyZXBsYWNlbWVudCwgIi4iKS50b0xvd2VyQ2FzZSgpOwogIH07CiAgdmFyIGRhdGEgPSBpc0ZvcmNlZCQyLmRhdGEgPSB7fTsKICB2YXIgTkFUSVZFID0gaXNGb3JjZWQkMi5OQVRJVkUgPSAiTiI7CiAgdmFyIFBPTFlGSUxMID0gaXNGb3JjZWQkMi5QT0xZRklMTCA9ICJQIjsKICB2YXIgaXNGb3JjZWRfMSA9IGlzRm9yY2VkJDI7CiAgdmFyIGFDYWxsYWJsZSRhID0gYUNhbGxhYmxlJGM7CiAgdmFyIGZ1bmN0aW9uQmluZENvbnRleHQgPSBmdW5jdGlvbihmbiwgdGhhdCwgbGVuZ3RoKSB7CiAgICBhQ2FsbGFibGUkYShmbik7CiAgICBpZiAodGhhdCA9PT0gdm9pZCAwKQogICAgICByZXR1cm4gZm47CiAgICBzd2l0Y2ggKGxlbmd0aCkgewogICAgICBjYXNlIDA6CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCk7CiAgICAgICAgfTsKICAgICAgY2FzZSAxOgogICAgICAgIHJldHVybiBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gZm4uY2FsbCh0aGF0LCBhKTsKICAgICAgICB9OwogICAgICBjYXNlIDI6CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBmbi5jYWxsKHRoYXQsIGEsIGIpOwogICAgICAgIH07CiAgICAgIGNhc2UgMzoKICAgICAgICByZXR1cm4gZnVuY3Rpb24oYSwgYiwgYzIpIHsKICAgICAgICAgIHJldHVybiBmbi5jYWxsKHRoYXQsIGEsIGIsIGMyKTsKICAgICAgICB9OwogICAgfQogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZm4uYXBwbHkodGhhdCwgYXJndW1lbnRzKTsKICAgIH07CiAgfTsKICB2YXIgb2JqZWN0RGVmaW5lUHJvcGVydHkgPSB7fTsKICB2YXIgaXNPYmplY3QkZSA9IGlzT2JqZWN0JGk7CiAgdmFyIGFuT2JqZWN0JGkgPSBmdW5jdGlvbihhcmd1bWVudCkgewogICAgaWYgKGlzT2JqZWN0JGUoYXJndW1lbnQpKQogICAgICByZXR1cm4gYXJndW1lbnQ7CiAgICB0aHJvdyBUeXBlRXJyb3IoU3RyaW5nKGFyZ3VtZW50KSArICIgaXMgbm90IGFuIG9iamVjdCIpOwogIH07CiAgdmFyIERFU0NSSVBUT1JTJGMgPSBkZXNjcmlwdG9yczsKICB2YXIgSUU4X0RPTV9ERUZJTkUgPSBpZThEb21EZWZpbmU7CiAgdmFyIGFuT2JqZWN0JGggPSBhbk9iamVjdCRpOwogIHZhciB0b1Byb3BlcnR5S2V5JDIgPSB0b1Byb3BlcnR5S2V5JDQ7CiAgdmFyICRkZWZpbmVQcm9wZXJ0eSQxID0gT2JqZWN0LmRlZmluZVByb3BlcnR5OwogIG9iamVjdERlZmluZVByb3BlcnR5LmYgPSBERVNDUklQVE9SUyRjID8gJGRlZmluZVByb3BlcnR5JDEgOiBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eTIoTywgUCwgQXR0cmlidXRlcykgewogICAgYW5PYmplY3QkaChPKTsKICAgIFAgPSB0b1Byb3BlcnR5S2V5JDIoUCk7CiAgICBhbk9iamVjdCRoKEF0dHJpYnV0ZXMpOwogICAgaWYgKElFOF9ET01fREVGSU5FKQogICAgICB0cnkgewogICAgICAgIHJldHVybiAkZGVmaW5lUHJvcGVydHkkMShPLCBQLCBBdHRyaWJ1dGVzKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgfQogICAgaWYgKCJnZXQiIGluIEF0dHJpYnV0ZXMgfHwgInNldCIgaW4gQXR0cmlidXRlcykKICAgICAgdGhyb3cgVHlwZUVycm9yKCJBY2Nlc3NvcnMgbm90IHN1cHBvcnRlZCIpOwogICAgaWYgKCJ2YWx1ZSIgaW4gQXR0cmlidXRlcykKICAgICAgT1tQXSA9IEF0dHJpYnV0ZXMudmFsdWU7CiAgICByZXR1cm4gTzsKICB9OwogIHZhciBERVNDUklQVE9SUyRiID0gZGVzY3JpcHRvcnM7CiAgdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlJDQgPSBvYmplY3REZWZpbmVQcm9wZXJ0eTsKICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDQgPSBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkNjsKICB2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDcgPSBERVNDUklQVE9SUyRiID8gZnVuY3Rpb24ob2JqZWN0LCBrZXksIHZhbHVlKSB7CiAgICByZXR1cm4gZGVmaW5lUHJvcGVydHlNb2R1bGUkNC5mKG9iamVjdCwga2V5LCBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkNCgxLCB2YWx1ZSkpOwogIH0gOiBmdW5jdGlvbihvYmplY3QsIGtleSwgdmFsdWUpIHsKICAgIG9iamVjdFtrZXldID0gdmFsdWU7CiAgICByZXR1cm4gb2JqZWN0OwogIH07CiAgdmFyIGdsb2JhbCRoID0gZ2xvYmFsJG87CiAgdmFyIGlzQ2FsbGFibGUkZSA9IGlzQ2FsbGFibGUkbDsKICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJDcgPSBvYmplY3RHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IuZjsKICB2YXIgaXNGb3JjZWQkMSA9IGlzRm9yY2VkXzE7CiAgdmFyIHBhdGgkbCA9IHBhdGgkbjsKICB2YXIgYmluZCRjID0gZnVuY3Rpb25CaW5kQ29udGV4dDsKICB2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDYgPSBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNzsKICB2YXIgaGFzJDkgPSBoYXMkYzsKICB2YXIgd3JhcENvbnN0cnVjdG9yID0gZnVuY3Rpb24oTmF0aXZlQ29uc3RydWN0b3IpIHsKICAgIHZhciBXcmFwcGVyID0gZnVuY3Rpb24oYSwgYiwgYzIpIHsKICAgICAgaWYgKHRoaXMgaW5zdGFuY2VvZiBOYXRpdmVDb25zdHJ1Y3RvcikgewogICAgICAgIHN3aXRjaCAoYXJndW1lbnRzLmxlbmd0aCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICByZXR1cm4gbmV3IE5hdGl2ZUNvbnN0cnVjdG9yKCk7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBuZXcgTmF0aXZlQ29uc3RydWN0b3IoYSk7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBuZXcgTmF0aXZlQ29uc3RydWN0b3IoYSwgYik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgTmF0aXZlQ29uc3RydWN0b3IoYSwgYiwgYzIpOwogICAgICB9CiAgICAgIHJldHVybiBOYXRpdmVDb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICAgIFdyYXBwZXIucHJvdG90eXBlID0gTmF0aXZlQ29uc3RydWN0b3IucHJvdG90eXBlOwogICAgcmV0dXJuIFdyYXBwZXI7CiAgfTsKICB2YXIgX2V4cG9ydCA9IGZ1bmN0aW9uKG9wdGlvbnMsIHNvdXJjZSkgewogICAgdmFyIFRBUkdFVCA9IG9wdGlvbnMudGFyZ2V0OwogICAgdmFyIEdMT0JBTCA9IG9wdGlvbnMuZ2xvYmFsOwogICAgdmFyIFNUQVRJQyA9IG9wdGlvbnMuc3RhdDsKICAgIHZhciBQUk9UTyA9IG9wdGlvbnMucHJvdG87CiAgICB2YXIgbmF0aXZlU291cmNlID0gR0xPQkFMID8gZ2xvYmFsJGggOiBTVEFUSUMgPyBnbG9iYWwkaFtUQVJHRVRdIDogKGdsb2JhbCRoW1RBUkdFVF0gfHwge30pLnByb3RvdHlwZTsKICAgIHZhciB0YXJnZXQgPSBHTE9CQUwgPyBwYXRoJGwgOiBwYXRoJGxbVEFSR0VUXSB8fCBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNihwYXRoJGwsIFRBUkdFVCwge30pW1RBUkdFVF07CiAgICB2YXIgdGFyZ2V0UHJvdG90eXBlID0gdGFyZ2V0LnByb3RvdHlwZTsKICAgIHZhciBGT1JDRUQyLCBVU0VfTkFUSVZFLCBWSVJUVUFMX1BST1RPVFlQRTsKICAgIHZhciBrZXksIHNvdXJjZVByb3BlcnR5LCB0YXJnZXRQcm9wZXJ0eSwgbmF0aXZlUHJvcGVydHksIHJlc3VsdFByb3BlcnR5LCBkZXNjcmlwdG9yOwogICAgZm9yIChrZXkgaW4gc291cmNlKSB7CiAgICAgIEZPUkNFRDIgPSBpc0ZvcmNlZCQxKEdMT0JBTCA/IGtleSA6IFRBUkdFVCArIChTVEFUSUMgPyAiLiIgOiAiIyIpICsga2V5LCBvcHRpb25zLmZvcmNlZCk7CiAgICAgIFVTRV9OQVRJVkUgPSAhRk9SQ0VEMiAmJiBuYXRpdmVTb3VyY2UgJiYgaGFzJDkobmF0aXZlU291cmNlLCBrZXkpOwogICAgICB0YXJnZXRQcm9wZXJ0eSA9IHRhcmdldFtrZXldOwogICAgICBpZiAoVVNFX05BVElWRSkKICAgICAgICBpZiAob3B0aW9ucy5ub1RhcmdldEdldCkgewogICAgICAgICAgZGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvciQ3KG5hdGl2ZVNvdXJjZSwga2V5KTsKICAgICAgICAgIG5hdGl2ZVByb3BlcnR5ID0gZGVzY3JpcHRvciAmJiBkZXNjcmlwdG9yLnZhbHVlOwogICAgICAgIH0gZWxzZQogICAgICAgICAgbmF0aXZlUHJvcGVydHkgPSBuYXRpdmVTb3VyY2Vba2V5XTsKICAgICAgc291cmNlUHJvcGVydHkgPSBVU0VfTkFUSVZFICYmIG5hdGl2ZVByb3BlcnR5ID8gbmF0aXZlUHJvcGVydHkgOiBzb3VyY2Vba2V5XTsKICAgICAgaWYgKFVTRV9OQVRJVkUgJiYgdHlwZW9mIHRhcmdldFByb3BlcnR5ID09PSB0eXBlb2Ygc291cmNlUHJvcGVydHkpCiAgICAgICAgY29udGludWU7CiAgICAgIGlmIChvcHRpb25zLmJpbmQgJiYgVVNFX05BVElWRSkKICAgICAgICByZXN1bHRQcm9wZXJ0eSA9IGJpbmQkYyhzb3VyY2VQcm9wZXJ0eSwgZ2xvYmFsJGgpOwogICAgICBlbHNlIGlmIChvcHRpb25zLndyYXAgJiYgVVNFX05BVElWRSkKICAgICAgICByZXN1bHRQcm9wZXJ0eSA9IHdyYXBDb25zdHJ1Y3Rvcihzb3VyY2VQcm9wZXJ0eSk7CiAgICAgIGVsc2UgaWYgKFBST1RPICYmIGlzQ2FsbGFibGUkZShzb3VyY2VQcm9wZXJ0eSkpCiAgICAgICAgcmVzdWx0UHJvcGVydHkgPSBiaW5kJGMoRnVuY3Rpb24uY2FsbCwgc291cmNlUHJvcGVydHkpOwogICAgICBlbHNlCiAgICAgICAgcmVzdWx0UHJvcGVydHkgPSBzb3VyY2VQcm9wZXJ0eTsKICAgICAgaWYgKG9wdGlvbnMuc2hhbSB8fCBzb3VyY2VQcm9wZXJ0eSAmJiBzb3VyY2VQcm9wZXJ0eS5zaGFtIHx8IHRhcmdldFByb3BlcnR5ICYmIHRhcmdldFByb3BlcnR5LnNoYW0pIHsKICAgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNihyZXN1bHRQcm9wZXJ0eSwgInNoYW0iLCB0cnVlKTsKICAgICAgfQogICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNih0YXJnZXQsIGtleSwgcmVzdWx0UHJvcGVydHkpOwogICAgICBpZiAoUFJPVE8pIHsKICAgICAgICBWSVJUVUFMX1BST1RPVFlQRSA9IFRBUkdFVCArICJQcm90b3R5cGUiOwogICAgICAgIGlmICghaGFzJDkocGF0aCRsLCBWSVJUVUFMX1BST1RPVFlQRSkpIHsKICAgICAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ2KHBhdGgkbCwgVklSVFVBTF9QUk9UT1RZUEUsIHt9KTsKICAgICAgICB9CiAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDYocGF0aCRsW1ZJUlRVQUxfUFJPVE9UWVBFXSwga2V5LCBzb3VyY2VQcm9wZXJ0eSk7CiAgICAgICAgaWYgKG9wdGlvbnMucmVhbCAmJiB0YXJnZXRQcm90b3R5cGUgJiYgIXRhcmdldFByb3RvdHlwZVtrZXldKSB7CiAgICAgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNih0YXJnZXRQcm90b3R5cGUsIGtleSwgc291cmNlUHJvcGVydHkpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CiAgdmFyICQkRiA9IF9leHBvcnQ7CiAgdmFyIERFU0NSSVBUT1JTJGEgPSBkZXNjcmlwdG9yczsKICB2YXIgb2JqZWN0RGVmaW5lUHJvcGVydHlNb2RpbGUgPSBvYmplY3REZWZpbmVQcm9wZXJ0eTsKICAkJEYoeyB0YXJnZXQ6ICJPYmplY3QiLCBzdGF0OiB0cnVlLCBmb3JjZWQ6ICFERVNDUklQVE9SUyRhLCBzaGFtOiAhREVTQ1JJUFRPUlMkYSB9LCB7CiAgICBkZWZpbmVQcm9wZXJ0eTogb2JqZWN0RGVmaW5lUHJvcGVydHlNb2RpbGUuZgogIH0pOwogIHZhciBwYXRoJGsgPSBwYXRoJG47CiAgdmFyIE9iamVjdCQ0ID0gcGF0aCRrLk9iamVjdDsKICB2YXIgZGVmaW5lUHJvcGVydHkkYiA9IGRlZmluZVByb3BlcnR5JGMuZXhwb3J0cyA9IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5MihpdCwga2V5LCBkZXNjKSB7CiAgICByZXR1cm4gT2JqZWN0JDQuZGVmaW5lUHJvcGVydHkoaXQsIGtleSwgZGVzYyk7CiAgfTsKICBpZiAoT2JqZWN0JDQuZGVmaW5lUHJvcGVydHkuc2hhbSkKICAgIGRlZmluZVByb3BlcnR5JGIuc2hhbSA9IHRydWU7CiAgdmFyIHBhcmVudCRRID0gZGVmaW5lUHJvcGVydHkkYy5leHBvcnRzOwogIHZhciBkZWZpbmVQcm9wZXJ0eSRhID0gcGFyZW50JFE7CiAgdmFyIGRlZmluZVByb3BlcnR5JDkgPSBkZWZpbmVQcm9wZXJ0eSRhOwogIHZhciBiYWkgPSB7fTsKICB2YXIgaXRlcmF0b3JzID0ge307CiAgdmFyIGlzQ2FsbGFibGUkZCA9IGlzQ2FsbGFibGUkbDsKICB2YXIgc3RvcmUkMSA9IHNoYXJlZFN0b3JlOwogIHZhciBmdW5jdGlvblRvU3RyaW5nID0gRnVuY3Rpb24udG9TdHJpbmc7CiAgaWYgKCFpc0NhbGxhYmxlJGQoc3RvcmUkMS5pbnNwZWN0U291cmNlKSkgewogICAgc3RvcmUkMS5pbnNwZWN0U291cmNlID0gZnVuY3Rpb24oaXQpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uVG9TdHJpbmcuY2FsbChpdCk7CiAgICB9OwogIH0KICB2YXIgaW5zcGVjdFNvdXJjZSQzID0gc3RvcmUkMS5pbnNwZWN0U291cmNlOwogIHZhciBnbG9iYWwkZyA9IGdsb2JhbCRvOwogIHZhciBpc0NhbGxhYmxlJGMgPSBpc0NhbGxhYmxlJGw7CiAgdmFyIGluc3BlY3RTb3VyY2UkMiA9IGluc3BlY3RTb3VyY2UkMzsKICB2YXIgV2Vha01hcCQxID0gZ2xvYmFsJGcuV2Vha01hcDsKICB2YXIgbmF0aXZlV2Vha01hcCA9IGlzQ2FsbGFibGUkYyhXZWFrTWFwJDEpICYmIC9uYXRpdmUgY29kZS8udGVzdChpbnNwZWN0U291cmNlJDIoV2Vha01hcCQxKSk7CiAgdmFyIHNoYXJlZCQyID0gc2hhcmVkJDQuZXhwb3J0czsKICB2YXIgdWlkJDIgPSB1aWQkNDsKICB2YXIga2V5cyQ1ID0gc2hhcmVkJDIoImtleXMiKTsKICB2YXIgc2hhcmVkS2V5JDQgPSBmdW5jdGlvbihrZXkpIHsKICAgIHJldHVybiBrZXlzJDVba2V5XSB8fCAoa2V5cyQ1W2tleV0gPSB1aWQkMihrZXkpKTsKICB9OwogIHZhciBoaWRkZW5LZXlzJDYgPSB7fTsKICB2YXIgTkFUSVZFX1dFQUtfTUFQJDEgPSBuYXRpdmVXZWFrTWFwOwogIHZhciBnbG9iYWwkZiA9IGdsb2JhbCRvOwogIHZhciBpc09iamVjdCRkID0gaXNPYmplY3QkaTsKICB2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDUgPSBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNzsKICB2YXIgb2JqZWN0SGFzID0gaGFzJGM7CiAgdmFyIHNoYXJlZCQxID0gc2hhcmVkU3RvcmU7CiAgdmFyIHNoYXJlZEtleSQzID0gc2hhcmVkS2V5JDQ7CiAgdmFyIGhpZGRlbktleXMkNSA9IGhpZGRlbktleXMkNjsKICB2YXIgT0JKRUNUX0FMUkVBRFlfSU5JVElBTElaRUQgPSAiT2JqZWN0IGFscmVhZHkgaW5pdGlhbGl6ZWQiOwogIHZhciBXZWFrTWFwID0gZ2xvYmFsJGYuV2Vha01hcDsKICB2YXIgc2V0JDEsIGdldCwgaGFzJDg7CiAgdmFyIGVuZm9yY2UgPSBmdW5jdGlvbihpdCkgewogICAgcmV0dXJuIGhhcyQ4KGl0KSA/IGdldChpdCkgOiBzZXQkMShpdCwge30pOwogIH07CiAgdmFyIGdldHRlckZvciA9IGZ1bmN0aW9uKFRZUEUyKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oaXQpIHsKICAgICAgdmFyIHN0YXRlOwogICAgICBpZiAoIWlzT2JqZWN0JGQoaXQpIHx8IChzdGF0ZSA9IGdldChpdCkpLnR5cGUgIT09IFRZUEUyKSB7CiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCJJbmNvbXBhdGlibGUgcmVjZWl2ZXIsICIgKyBUWVBFMiArICIgcmVxdWlyZWQiKTsKICAgICAgfQogICAgICByZXR1cm4gc3RhdGU7CiAgICB9OwogIH07CiAgaWYgKE5BVElWRV9XRUFLX01BUCQxIHx8IHNoYXJlZCQxLnN0YXRlKSB7CiAgICB2YXIgc3RvcmUgPSBzaGFyZWQkMS5zdGF0ZSB8fCAoc2hhcmVkJDEuc3RhdGUgPSBuZXcgV2Vha01hcCgpKTsKICAgIHZhciB3bWdldCA9IHN0b3JlLmdldDsKICAgIHZhciB3bWhhcyA9IHN0b3JlLmhhczsKICAgIHZhciB3bXNldCA9IHN0b3JlLnNldDsKICAgIHNldCQxID0gZnVuY3Rpb24oaXQsIG1ldGFkYXRhKSB7CiAgICAgIGlmICh3bWhhcy5jYWxsKHN0b3JlLCBpdCkpCiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihPQkpFQ1RfQUxSRUFEWV9JTklUSUFMSVpFRCk7CiAgICAgIG1ldGFkYXRhLmZhY2FkZSA9IGl0OwogICAgICB3bXNldC5jYWxsKHN0b3JlLCBpdCwgbWV0YWRhdGEpOwogICAgICByZXR1cm4gbWV0YWRhdGE7CiAgICB9OwogICAgZ2V0ID0gZnVuY3Rpb24oaXQpIHsKICAgICAgcmV0dXJuIHdtZ2V0LmNhbGwoc3RvcmUsIGl0KSB8fCB7fTsKICAgIH07CiAgICBoYXMkOCA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgIHJldHVybiB3bWhhcy5jYWxsKHN0b3JlLCBpdCk7CiAgICB9OwogIH0gZWxzZSB7CiAgICB2YXIgU1RBVEUgPSBzaGFyZWRLZXkkMygic3RhdGUiKTsKICAgIGhpZGRlbktleXMkNVtTVEFURV0gPSB0cnVlOwogICAgc2V0JDEgPSBmdW5jdGlvbihpdCwgbWV0YWRhdGEpIHsKICAgICAgaWYgKG9iamVjdEhhcyhpdCwgU1RBVEUpKQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoT0JKRUNUX0FMUkVBRFlfSU5JVElBTElaRUQpOwogICAgICBtZXRhZGF0YS5mYWNhZGUgPSBpdDsKICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDUoaXQsIFNUQVRFLCBtZXRhZGF0YSk7CiAgICAgIHJldHVybiBtZXRhZGF0YTsKICAgIH07CiAgICBnZXQgPSBmdW5jdGlvbihpdCkgewogICAgICByZXR1cm4gb2JqZWN0SGFzKGl0LCBTVEFURSkgPyBpdFtTVEFURV0gOiB7fTsKICAgIH07CiAgICBoYXMkOCA9IGZ1bmN0aW9uKGl0KSB7CiAgICAgIHJldHVybiBvYmplY3RIYXMoaXQsIFNUQVRFKTsKICAgIH07CiAgfQogIHZhciBpbnRlcm5hbFN0YXRlID0gewogICAgc2V0OiBzZXQkMSwKICAgIGdldCwKICAgIGhhczogaGFzJDgsCiAgICBlbmZvcmNlLAogICAgZ2V0dGVyRm9yCiAgfTsKICB2YXIgREVTQ1JJUFRPUlMkOSA9IGRlc2NyaXB0b3JzOwogIHZhciBoYXMkNyA9IGhhcyRjOwogIHZhciBGdW5jdGlvblByb3RvdHlwZSQxID0gRnVuY3Rpb24ucHJvdG90eXBlOwogIHZhciBnZXREZXNjcmlwdG9yID0gREVTQ1JJUFRPUlMkOSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwogIHZhciBFWElTVFMgPSBoYXMkNyhGdW5jdGlvblByb3RvdHlwZSQxLCAibmFtZSIpOwogIHZhciBQUk9QRVIgPSBFWElTVFMgJiYgZnVuY3Rpb24gc29tZXRoaW5nKCkgewogIH0ubmFtZSA9PT0gInNvbWV0aGluZyI7CiAgdmFyIENPTkZJR1VSQUJMRSA9IEVYSVNUUyAmJiAoIURFU0NSSVBUT1JTJDkgfHwgREVTQ1JJUFRPUlMkOSAmJiBnZXREZXNjcmlwdG9yKEZ1bmN0aW9uUHJvdG90eXBlJDEsICJuYW1lIikuY29uZmlndXJhYmxlKTsKICB2YXIgZnVuY3Rpb25OYW1lID0gewogICAgRVhJU1RTLAogICAgUFJPUEVSLAogICAgQ09ORklHVVJBQkxFCiAgfTsKICB2YXIgY2VpbCA9IE1hdGguY2VpbDsKICB2YXIgZmxvb3IkMSA9IE1hdGguZmxvb3I7CiAgdmFyIHRvSW50ZWdlciQzID0gZnVuY3Rpb24oYXJndW1lbnQpIHsKICAgIHJldHVybiBpc05hTihhcmd1bWVudCA9ICthcmd1bWVudCkgPyAwIDogKGFyZ3VtZW50ID4gMCA/IGZsb29yJDEgOiBjZWlsKShhcmd1bWVudCk7CiAgfTsKICB2YXIgdG9JbnRlZ2VyJDIgPSB0b0ludGVnZXIkMzsKICB2YXIgbWluJDIgPSBNYXRoLm1pbjsKICB2YXIgdG9MZW5ndGgkOSA9IGZ1bmN0aW9uKGFyZ3VtZW50KSB7CiAgICByZXR1cm4gYXJndW1lbnQgPiAwID8gbWluJDIodG9JbnRlZ2VyJDIoYXJndW1lbnQpLCA5MDA3MTk5MjU0NzQwOTkxKSA6IDA7CiAgfTsKICB2YXIgdG9JbnRlZ2VyJDEgPSB0b0ludGVnZXIkMzsKICB2YXIgbWF4JDEgPSBNYXRoLm1heDsKICB2YXIgbWluJDEgPSBNYXRoLm1pbjsKICB2YXIgdG9BYnNvbHV0ZUluZGV4JDIgPSBmdW5jdGlvbihpbmRleCwgbGVuZ3RoKSB7CiAgICB2YXIgaW50ZWdlciA9IHRvSW50ZWdlciQxKGluZGV4KTsKICAgIHJldHVybiBpbnRlZ2VyIDwgMCA/IG1heCQxKGludGVnZXIgKyBsZW5ndGgsIDApIDogbWluJDEoaW50ZWdlciwgbGVuZ3RoKTsKICB9OwogIHZhciB0b0luZGV4ZWRPYmplY3QkNyA9IHRvSW5kZXhlZE9iamVjdCQ5OwogIHZhciB0b0xlbmd0aCQ4ID0gdG9MZW5ndGgkOTsKICB2YXIgdG9BYnNvbHV0ZUluZGV4JDEgPSB0b0Fic29sdXRlSW5kZXgkMjsKICB2YXIgY3JlYXRlTWV0aG9kJDQgPSBmdW5jdGlvbihJU19JTkNMVURFUykgewogICAgcmV0dXJuIGZ1bmN0aW9uKCR0aGlzLCBlbCwgZnJvbUluZGV4KSB7CiAgICAgIHZhciBPID0gdG9JbmRleGVkT2JqZWN0JDcoJHRoaXMpOwogICAgICB2YXIgbGVuZ3RoID0gdG9MZW5ndGgkOChPLmxlbmd0aCk7CiAgICAgIHZhciBpbmRleCA9IHRvQWJzb2x1dGVJbmRleCQxKGZyb21JbmRleCwgbGVuZ3RoKTsKICAgICAgdmFyIHZhbHVlOwogICAgICBpZiAoSVNfSU5DTFVERVMgJiYgZWwgIT0gZWwpCiAgICAgICAgd2hpbGUgKGxlbmd0aCA+IGluZGV4KSB7CiAgICAgICAgICB2YWx1ZSA9IE9baW5kZXgrK107CiAgICAgICAgICBpZiAodmFsdWUgIT0gdmFsdWUpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgZWxzZQogICAgICAgIGZvciAoOyBsZW5ndGggPiBpbmRleDsgaW5kZXgrKykgewogICAgICAgICAgaWYgKChJU19JTkNMVURFUyB8fCBpbmRleCBpbiBPKSAmJiBPW2luZGV4XSA9PT0gZWwpCiAgICAgICAgICAgIHJldHVybiBJU19JTkNMVURFUyB8fCBpbmRleCB8fCAwOwogICAgICAgIH0KICAgICAgcmV0dXJuICFJU19JTkNMVURFUyAmJiAtMTsKICAgIH07CiAgfTsKICB2YXIgYXJyYXlJbmNsdWRlcyA9IHsKICAgIGluY2x1ZGVzOiBjcmVhdGVNZXRob2QkNCh0cnVlKSwKICAgIGluZGV4T2Y6IGNyZWF0ZU1ldGhvZCQ0KGZhbHNlKQogIH07CiAgdmFyIGhhcyQ2ID0gaGFzJGM7CiAgdmFyIHRvSW5kZXhlZE9iamVjdCQ2ID0gdG9JbmRleGVkT2JqZWN0JDk7CiAgdmFyIGluZGV4T2YkNSA9IGFycmF5SW5jbHVkZXMuaW5kZXhPZjsKICB2YXIgaGlkZGVuS2V5cyQ0ID0gaGlkZGVuS2V5cyQ2OwogIHZhciBvYmplY3RLZXlzSW50ZXJuYWwgPSBmdW5jdGlvbihvYmplY3QsIG5hbWVzKSB7CiAgICB2YXIgTyA9IHRvSW5kZXhlZE9iamVjdCQ2KG9iamVjdCk7CiAgICB2YXIgaTIgPSAwOwogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgdmFyIGtleTsKICAgIGZvciAoa2V5IGluIE8pCiAgICAgICFoYXMkNihoaWRkZW5LZXlzJDQsIGtleSkgJiYgaGFzJDYoTywga2V5KSAmJiByZXN1bHQucHVzaChrZXkpOwogICAgd2hpbGUgKG5hbWVzLmxlbmd0aCA+IGkyKQogICAgICBpZiAoaGFzJDYoTywga2V5ID0gbmFtZXNbaTIrK10pKSB7CiAgICAgICAgfmluZGV4T2YkNShyZXN1bHQsIGtleSkgfHwgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwogIHZhciBlbnVtQnVnS2V5cyQzID0gWwogICAgImNvbnN0cnVjdG9yIiwKICAgICJoYXNPd25Qcm9wZXJ0eSIsCiAgICAiaXNQcm90b3R5cGVPZiIsCiAgICAicHJvcGVydHlJc0VudW1lcmFibGUiLAogICAgInRvTG9jYWxlU3RyaW5nIiwKICAgICJ0b1N0cmluZyIsCiAgICAidmFsdWVPZiIKICBdOwogIHZhciBpbnRlcm5hbE9iamVjdEtleXMkMSA9IG9iamVjdEtleXNJbnRlcm5hbDsKICB2YXIgZW51bUJ1Z0tleXMkMiA9IGVudW1CdWdLZXlzJDM7CiAgdmFyIG9iamVjdEtleXMkMyA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uIGtleXMyKE8pIHsKICAgIHJldHVybiBpbnRlcm5hbE9iamVjdEtleXMkMShPLCBlbnVtQnVnS2V5cyQyKTsKICB9OwogIHZhciBERVNDUklQVE9SUyQ4ID0gZGVzY3JpcHRvcnM7CiAgdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlJDMgPSBvYmplY3REZWZpbmVQcm9wZXJ0eTsKICB2YXIgYW5PYmplY3QkZyA9IGFuT2JqZWN0JGk7CiAgdmFyIG9iamVjdEtleXMkMiA9IG9iamVjdEtleXMkMzsKICB2YXIgb2JqZWN0RGVmaW5lUHJvcGVydGllcyA9IERFU0NSSVBUT1JTJDggPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyA6IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXMyKE8sIFByb3BlcnRpZXMpIHsKICAgIGFuT2JqZWN0JGcoTyk7CiAgICB2YXIga2V5czIgPSBvYmplY3RLZXlzJDIoUHJvcGVydGllcyk7CiAgICB2YXIgbGVuZ3RoID0ga2V5czIubGVuZ3RoOwogICAgdmFyIGluZGV4ID0gMDsKICAgIHZhciBrZXk7CiAgICB3aGlsZSAobGVuZ3RoID4gaW5kZXgpCiAgICAgIGRlZmluZVByb3BlcnR5TW9kdWxlJDMuZihPLCBrZXkgPSBrZXlzMltpbmRleCsrXSwgUHJvcGVydGllc1trZXldKTsKICAgIHJldHVybiBPOwogIH07CiAgdmFyIGdldEJ1aWx0SW4kOCA9IGdldEJ1aWx0SW4kYjsKICB2YXIgaHRtbCQyID0gZ2V0QnVpbHRJbiQ4KCJkb2N1bWVudCIsICJkb2N1bWVudEVsZW1lbnQiKTsKICB2YXIgYW5PYmplY3QkZiA9IGFuT2JqZWN0JGk7CiAgdmFyIGRlZmluZVByb3BlcnRpZXMkNSA9IG9iamVjdERlZmluZVByb3BlcnRpZXM7CiAgdmFyIGVudW1CdWdLZXlzJDEgPSBlbnVtQnVnS2V5cyQzOwogIHZhciBoaWRkZW5LZXlzJDMgPSBoaWRkZW5LZXlzJDY7CiAgdmFyIGh0bWwkMSA9IGh0bWwkMjsKICB2YXIgZG9jdW1lbnRDcmVhdGVFbGVtZW50ID0gZG9jdW1lbnRDcmVhdGVFbGVtZW50JDE7CiAgdmFyIHNoYXJlZEtleSQyID0gc2hhcmVkS2V5JDQ7CiAgdmFyIEdUID0gIj4iOwogIHZhciBMVCA9ICI8IjsKICB2YXIgUFJPVE9UWVBFJDEgPSAicHJvdG90eXBlIjsKICB2YXIgU0NSSVBUID0gInNjcmlwdCI7CiAgdmFyIElFX1BST1RPJDEgPSBzaGFyZWRLZXkkMigiSUVfUFJPVE8iKTsKICB2YXIgRW1wdHlDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uKCkgewogIH07CiAgdmFyIHNjcmlwdFRhZyA9IGZ1bmN0aW9uKGNvbnRlbnQpIHsKICAgIHJldHVybiBMVCArIFNDUklQVCArIEdUICsgY29udGVudCArIExUICsgIi8iICsgU0NSSVBUICsgR1Q7CiAgfTsKICB2YXIgTnVsbFByb3RvT2JqZWN0VmlhQWN0aXZlWCA9IGZ1bmN0aW9uKGFjdGl2ZVhEb2N1bWVudDIpIHsKICAgIGFjdGl2ZVhEb2N1bWVudDIud3JpdGUoc2NyaXB0VGFnKCIiKSk7CiAgICBhY3RpdmVYRG9jdW1lbnQyLmNsb3NlKCk7CiAgICB2YXIgdGVtcCA9IGFjdGl2ZVhEb2N1bWVudDIucGFyZW50V2luZG93Lk9iamVjdDsKICAgIGFjdGl2ZVhEb2N1bWVudDIgPSBudWxsOwogICAgcmV0dXJuIHRlbXA7CiAgfTsKICB2YXIgTnVsbFByb3RvT2JqZWN0VmlhSUZyYW1lID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgaWZyYW1lID0gZG9jdW1lbnRDcmVhdGVFbGVtZW50KCJpZnJhbWUiKTsKICAgIHZhciBKUyA9ICJqYXZhIiArIFNDUklQVCArICI6IjsKICAgIHZhciBpZnJhbWVEb2N1bWVudDsKICAgIGlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgaHRtbCQxLmFwcGVuZENoaWxkKGlmcmFtZSk7CiAgICBpZnJhbWUuc3JjID0gU3RyaW5nKEpTKTsKICAgIGlmcmFtZURvY3VtZW50ID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7CiAgICBpZnJhbWVEb2N1bWVudC5vcGVuKCk7CiAgICBpZnJhbWVEb2N1bWVudC53cml0ZShzY3JpcHRUYWcoImRvY3VtZW50LkY9T2JqZWN0IikpOwogICAgaWZyYW1lRG9jdW1lbnQuY2xvc2UoKTsKICAgIHJldHVybiBpZnJhbWVEb2N1bWVudC5GOwogIH07CiAgdmFyIGFjdGl2ZVhEb2N1bWVudDsKICB2YXIgTnVsbFByb3RvT2JqZWN0ID0gZnVuY3Rpb24oKSB7CiAgICB0cnkgewogICAgICBhY3RpdmVYRG9jdW1lbnQgPSBuZXcgQWN0aXZlWE9iamVjdCgiaHRtbGZpbGUiKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICB9CiAgICBOdWxsUHJvdG9PYmplY3QgPSB0eXBlb2YgZG9jdW1lbnQgIT0gInVuZGVmaW5lZCIgPyBkb2N1bWVudC5kb21haW4gJiYgYWN0aXZlWERvY3VtZW50ID8gTnVsbFByb3RvT2JqZWN0VmlhQWN0aXZlWChhY3RpdmVYRG9jdW1lbnQpIDogTnVsbFByb3RvT2JqZWN0VmlhSUZyYW1lKCkgOiBOdWxsUHJvdG9PYmplY3RWaWFBY3RpdmVYKGFjdGl2ZVhEb2N1bWVudCk7CiAgICB2YXIgbGVuZ3RoID0gZW51bUJ1Z0tleXMkMS5sZW5ndGg7CiAgICB3aGlsZSAobGVuZ3RoLS0pCiAgICAgIGRlbGV0ZSBOdWxsUHJvdG9PYmplY3RbUFJPVE9UWVBFJDFdW2VudW1CdWdLZXlzJDFbbGVuZ3RoXV07CiAgICByZXR1cm4gTnVsbFByb3RvT2JqZWN0KCk7CiAgfTsKICBoaWRkZW5LZXlzJDNbSUVfUFJPVE8kMV0gPSB0cnVlOwogIHZhciBvYmplY3RDcmVhdGUgPSBPYmplY3QuY3JlYXRlIHx8IGZ1bmN0aW9uIGNyZWF0ZTIoTywgUHJvcGVydGllcykgewogICAgdmFyIHJlc3VsdDsKICAgIGlmIChPICE9PSBudWxsKSB7CiAgICAgIEVtcHR5Q29uc3RydWN0b3JbUFJPVE9UWVBFJDFdID0gYW5PYmplY3QkZihPKTsKICAgICAgcmVzdWx0ID0gbmV3IEVtcHR5Q29uc3RydWN0b3IoKTsKICAgICAgRW1wdHlDb25zdHJ1Y3RvcltQUk9UT1RZUEUkMV0gPSBudWxsOwogICAgICByZXN1bHRbSUVfUFJPVE8kMV0gPSBPOwogICAgfSBlbHNlCiAgICAgIHJlc3VsdCA9IE51bGxQcm90b09iamVjdCgpOwogICAgcmV0dXJuIFByb3BlcnRpZXMgPT09IHZvaWQgMCA/IHJlc3VsdCA6IGRlZmluZVByb3BlcnRpZXMkNShyZXN1bHQsIFByb3BlcnRpZXMpOwogIH07CiAgdmFyIGZhaWxzJGggPSBmYWlscyRuOwogIHZhciBjb3JyZWN0UHJvdG90eXBlR2V0dGVyID0gIWZhaWxzJGgoZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBGKCkgewogICAgfQogICAgRi5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBudWxsOwogICAgcmV0dXJuIE9iamVjdC5nZXRQcm90b3R5cGVPZihuZXcgRigpKSAhPT0gRi5wcm90b3R5cGU7CiAgfSk7CiAgdmFyIGhhcyQ1ID0gaGFzJGM7CiAgdmFyIGlzQ2FsbGFibGUkYiA9IGlzQ2FsbGFibGUkbDsKICB2YXIgdG9PYmplY3QkOSA9IHRvT2JqZWN0JGI7CiAgdmFyIHNoYXJlZEtleSQxID0gc2hhcmVkS2V5JDQ7CiAgdmFyIENPUlJFQ1RfUFJPVE9UWVBFX0dFVFRFUiQxID0gY29ycmVjdFByb3RvdHlwZUdldHRlcjsKICB2YXIgSUVfUFJPVE8gPSBzaGFyZWRLZXkkMSgiSUVfUFJPVE8iKTsKICB2YXIgT2JqZWN0UHJvdG90eXBlJDEgPSBPYmplY3QucHJvdG90eXBlOwogIHZhciBvYmplY3RHZXRQcm90b3R5cGVPZiA9IENPUlJFQ1RfUFJPVE9UWVBFX0dFVFRFUiQxID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24oTykgewogICAgdmFyIG9iamVjdCA9IHRvT2JqZWN0JDkoTyk7CiAgICBpZiAoaGFzJDUob2JqZWN0LCBJRV9QUk9UTykpCiAgICAgIHJldHVybiBvYmplY3RbSUVfUFJPVE9dOwogICAgdmFyIGNvbnN0cnVjdG9yID0gb2JqZWN0LmNvbnN0cnVjdG9yOwogICAgaWYgKGlzQ2FsbGFibGUkYihjb25zdHJ1Y3RvcikgJiYgb2JqZWN0IGluc3RhbmNlb2YgY29uc3RydWN0b3IpIHsKICAgICAgcmV0dXJuIGNvbnN0cnVjdG9yLnByb3RvdHlwZTsKICAgIH0KICAgIHJldHVybiBvYmplY3QgaW5zdGFuY2VvZiBPYmplY3QgPyBPYmplY3RQcm90b3R5cGUkMSA6IG51bGw7CiAgfTsKICB2YXIgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDQgPSBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNzsKICB2YXIgcmVkZWZpbmUkNCA9IGZ1bmN0aW9uKHRhcmdldCwga2V5LCB2YWx1ZSwgb3B0aW9ucykgewogICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lbnVtZXJhYmxlKQogICAgICB0YXJnZXRba2V5XSA9IHZhbHVlOwogICAgZWxzZQogICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNCh0YXJnZXQsIGtleSwgdmFsdWUpOwogIH07CiAgdmFyIGZhaWxzJGcgPSBmYWlscyRuOwogIHZhciBpc0NhbGxhYmxlJGEgPSBpc0NhbGxhYmxlJGw7CiAgdmFyIGNyZWF0ZSQ4ID0gb2JqZWN0Q3JlYXRlOwogIHZhciBnZXRQcm90b3R5cGVPZiQ3ID0gb2JqZWN0R2V0UHJvdG90eXBlT2Y7CiAgdmFyIHJlZGVmaW5lJDMgPSByZWRlZmluZSQ0OwogIHZhciB3ZWxsS25vd25TeW1ib2wkaiA9IHdlbGxLbm93blN5bWJvbCRsOwogIHZhciBJVEVSQVRPUiQ1ID0gd2VsbEtub3duU3ltYm9sJGooIml0ZXJhdG9yIik7CiAgdmFyIEJVR0dZX1NBRkFSSV9JVEVSQVRPUlMkMSA9IGZhbHNlOwogIHZhciBJdGVyYXRvclByb3RvdHlwZSQxLCBQcm90b3R5cGVPZkFycmF5SXRlcmF0b3JQcm90b3R5cGUsIGFycmF5SXRlcmF0b3I7CiAgaWYgKFtdLmtleXMpIHsKICAgIGFycmF5SXRlcmF0b3IgPSBbXS5rZXlzKCk7CiAgICBpZiAoISgibmV4dCIgaW4gYXJyYXlJdGVyYXRvcikpCiAgICAgIEJVR0dZX1NBRkFSSV9JVEVSQVRPUlMkMSA9IHRydWU7CiAgICBlbHNlIHsKICAgICAgUHJvdG90eXBlT2ZBcnJheUl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG90eXBlT2YkNyhnZXRQcm90b3R5cGVPZiQ3KGFycmF5SXRlcmF0b3IpKTsKICAgICAgaWYgKFByb3RvdHlwZU9mQXJyYXlJdGVyYXRvclByb3RvdHlwZSAhPT0gT2JqZWN0LnByb3RvdHlwZSkKICAgICAgICBJdGVyYXRvclByb3RvdHlwZSQxID0gUHJvdG90eXBlT2ZBcnJheUl0ZXJhdG9yUHJvdG90eXBlOwogICAgfQogIH0KICB2YXIgTkVXX0lURVJBVE9SX1BST1RPVFlQRSA9IEl0ZXJhdG9yUHJvdG90eXBlJDEgPT0gdm9pZCAwIHx8IGZhaWxzJGcoZnVuY3Rpb24oKSB7CiAgICB2YXIgdGVzdDIgPSB7fTsKICAgIHJldHVybiBJdGVyYXRvclByb3RvdHlwZSQxW0lURVJBVE9SJDVdLmNhbGwodGVzdDIpICE9PSB0ZXN0MjsKICB9KTsKICBpZiAoTkVXX0lURVJBVE9SX1BST1RPVFlQRSkKICAgIEl0ZXJhdG9yUHJvdG90eXBlJDEgPSB7fTsKICBlbHNlCiAgICBJdGVyYXRvclByb3RvdHlwZSQxID0gY3JlYXRlJDgoSXRlcmF0b3JQcm90b3R5cGUkMSk7CiAgaWYgKCFpc0NhbGxhYmxlJGEoSXRlcmF0b3JQcm90b3R5cGUkMVtJVEVSQVRPUiQ1XSkpIHsKICAgIHJlZGVmaW5lJDMoSXRlcmF0b3JQcm90b3R5cGUkMSwgSVRFUkFUT1IkNSwgZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSk7CiAgfQogIHZhciBpdGVyYXRvcnNDb3JlID0gewogICAgSXRlcmF0b3JQcm90b3R5cGU6IEl0ZXJhdG9yUHJvdG90eXBlJDEsCiAgICBCVUdHWV9TQUZBUklfSVRFUkFUT1JTOiBCVUdHWV9TQUZBUklfSVRFUkFUT1JTJDEKICB9OwogIHZhciB3ZWxsS25vd25TeW1ib2wkaSA9IHdlbGxLbm93blN5bWJvbCRsOwogIHZhciBUT19TVFJJTkdfVEFHJDMgPSB3ZWxsS25vd25TeW1ib2wkaSgidG9TdHJpbmdUYWciKTsKICB2YXIgdGVzdCQxID0ge307CiAgdGVzdCQxW1RPX1NUUklOR19UQUckM10gPSAieiI7CiAgdmFyIHRvU3RyaW5nVGFnU3VwcG9ydCA9IFN0cmluZyh0ZXN0JDEpID09PSAiW29iamVjdCB6XSI7CiAgdmFyIFRPX1NUUklOR19UQUdfU1VQUE9SVCQyID0gdG9TdHJpbmdUYWdTdXBwb3J0OwogIHZhciBpc0NhbGxhYmxlJDkgPSBpc0NhbGxhYmxlJGw7CiAgdmFyIGNsYXNzb2ZSYXcgPSBjbGFzc29mUmF3JDE7CiAgdmFyIHdlbGxLbm93blN5bWJvbCRoID0gd2VsbEtub3duU3ltYm9sJGw7CiAgdmFyIFRPX1NUUklOR19UQUckMiA9IHdlbGxLbm93blN5bWJvbCRoKCJ0b1N0cmluZ1RhZyIpOwogIHZhciBDT1JSRUNUX0FSR1VNRU5UUyA9IGNsYXNzb2ZSYXcoZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gYXJndW1lbnRzOwogIH0oKSkgPT0gIkFyZ3VtZW50cyI7CiAgdmFyIHRyeUdldCA9IGZ1bmN0aW9uKGl0LCBrZXkpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiBpdFtrZXldOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIH0KICB9OwogIHZhciBjbGFzc29mJDkgPSBUT19TVFJJTkdfVEFHX1NVUFBPUlQkMiA/IGNsYXNzb2ZSYXcgOiBmdW5jdGlvbihpdCkgewogICAgdmFyIE8sIHRhZywgcmVzdWx0OwogICAgcmV0dXJuIGl0ID09PSB2b2lkIDAgPyAiVW5kZWZpbmVkIiA6IGl0ID09PSBudWxsID8gIk51bGwiIDogdHlwZW9mICh0YWcgPSB0cnlHZXQoTyA9IE9iamVjdChpdCksIFRPX1NUUklOR19UQUckMikpID09ICJzdHJpbmciID8gdGFnIDogQ09SUkVDVF9BUkdVTUVOVFMgPyBjbGFzc29mUmF3KE8pIDogKHJlc3VsdCA9IGNsYXNzb2ZSYXcoTykpID09ICJPYmplY3QiICYmIGlzQ2FsbGFibGUkOShPLmNhbGxlZSkgPyAiQXJndW1lbnRzIiA6IHJlc3VsdDsKICB9OwogIHZhciBUT19TVFJJTkdfVEFHX1NVUFBPUlQkMSA9IHRvU3RyaW5nVGFnU3VwcG9ydDsKICB2YXIgY2xhc3NvZiQ4ID0gY2xhc3NvZiQ5OwogIHZhciBvYmplY3RUb1N0cmluZyA9IFRPX1NUUklOR19UQUdfU1VQUE9SVCQxID8ge30udG9TdHJpbmcgOiBmdW5jdGlvbiB0b1N0cmluZzIoKSB7CiAgICByZXR1cm4gIltvYmplY3QgIiArIGNsYXNzb2YkOCh0aGlzKSArICJdIjsKICB9OwogIHZhciBUT19TVFJJTkdfVEFHX1NVUFBPUlQgPSB0b1N0cmluZ1RhZ1N1cHBvcnQ7CiAgdmFyIGRlZmluZVByb3BlcnR5JDggPSBvYmplY3REZWZpbmVQcm9wZXJ0eS5mOwogIHZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkMyA9IGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ3OwogIHZhciBoYXMkNCA9IGhhcyRjOwogIHZhciB0b1N0cmluZyRiID0gb2JqZWN0VG9TdHJpbmc7CiAgdmFyIHdlbGxLbm93blN5bWJvbCRnID0gd2VsbEtub3duU3ltYm9sJGw7CiAgdmFyIFRPX1NUUklOR19UQUckMSA9IHdlbGxLbm93blN5bWJvbCRnKCJ0b1N0cmluZ1RhZyIpOwogIHZhciBzZXRUb1N0cmluZ1RhZyQ2ID0gZnVuY3Rpb24oaXQsIFRBRywgU1RBVElDLCBTRVRfTUVUSE9EKSB7CiAgICBpZiAoaXQpIHsKICAgICAgdmFyIHRhcmdldCA9IFNUQVRJQyA/IGl0IDogaXQucHJvdG90eXBlOwogICAgICBpZiAoIWhhcyQ0KHRhcmdldCwgVE9fU1RSSU5HX1RBRyQxKSkgewogICAgICAgIGRlZmluZVByb3BlcnR5JDgodGFyZ2V0LCBUT19TVFJJTkdfVEFHJDEsIHsgY29uZmlndXJhYmxlOiB0cnVlLCB2YWx1ZTogVEFHIH0pOwogICAgICB9CiAgICAgIGlmIChTRVRfTUVUSE9EICYmICFUT19TVFJJTkdfVEFHX1NVUFBPUlQpIHsKICAgICAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkMyh0YXJnZXQsICJ0b1N0cmluZyIsIHRvU3RyaW5nJGIpOwogICAgICB9CiAgICB9CiAgfTsKICB2YXIgSXRlcmF0b3JQcm90b3R5cGUgPSBpdGVyYXRvcnNDb3JlLkl0ZXJhdG9yUHJvdG90eXBlOwogIHZhciBjcmVhdGUkNyA9IG9iamVjdENyZWF0ZTsKICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDMgPSBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkNjsKICB2YXIgc2V0VG9TdHJpbmdUYWckNSA9IHNldFRvU3RyaW5nVGFnJDY7CiAgdmFyIEl0ZXJhdG9ycyQ1ID0gaXRlcmF0b3JzOwogIHZhciByZXR1cm5UaGlzJDEgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzOwogIH07CiAgdmFyIGNyZWF0ZUl0ZXJhdG9yQ29uc3RydWN0b3IkMSA9IGZ1bmN0aW9uKEl0ZXJhdG9yQ29uc3RydWN0b3IsIE5BTUUyLCBuZXh0KSB7CiAgICB2YXIgVE9fU1RSSU5HX1RBRzIgPSBOQU1FMiArICIgSXRlcmF0b3IiOwogICAgSXRlcmF0b3JDb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSBjcmVhdGUkNyhJdGVyYXRvclByb3RvdHlwZSwgeyBuZXh0OiBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkMygxLCBuZXh0KSB9KTsKICAgIHNldFRvU3RyaW5nVGFnJDUoSXRlcmF0b3JDb25zdHJ1Y3RvciwgVE9fU1RSSU5HX1RBRzIsIGZhbHNlLCB0cnVlKTsKICAgIEl0ZXJhdG9ycyQ1W1RPX1NUUklOR19UQUcyXSA9IHJldHVyblRoaXMkMTsKICAgIHJldHVybiBJdGVyYXRvckNvbnN0cnVjdG9yOwogIH07CiAgdmFyIGlzQ2FsbGFibGUkOCA9IGlzQ2FsbGFibGUkbDsKICB2YXIgYVBvc3NpYmxlUHJvdG90eXBlJDEgPSBmdW5jdGlvbihhcmd1bWVudCkgewogICAgaWYgKHR5cGVvZiBhcmd1bWVudCA9PT0gIm9iamVjdCIgfHwgaXNDYWxsYWJsZSQ4KGFyZ3VtZW50KSkKICAgICAgcmV0dXJuIGFyZ3VtZW50OwogICAgdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBzZXQgIiArIFN0cmluZyhhcmd1bWVudCkgKyAiIGFzIGEgcHJvdG90eXBlIik7CiAgfTsKICB2YXIgYW5PYmplY3QkZSA9IGFuT2JqZWN0JGk7CiAgdmFyIGFQb3NzaWJsZVByb3RvdHlwZSA9IGFQb3NzaWJsZVByb3RvdHlwZSQxOwogIHZhciBvYmplY3RTZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoIl9fcHJvdG9fXyIgaW4ge30gPyBmdW5jdGlvbigpIHsKICAgIHZhciBDT1JSRUNUX1NFVFRFUiA9IGZhbHNlOwogICAgdmFyIHRlc3QyID0ge307CiAgICB2YXIgc2V0dGVyOwogICAgdHJ5IHsKICAgICAgc2V0dGVyID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPYmplY3QucHJvdG90eXBlLCAiX19wcm90b19fIikuc2V0OwogICAgICBzZXR0ZXIuY2FsbCh0ZXN0MiwgW10pOwogICAgICBDT1JSRUNUX1NFVFRFUiA9IHRlc3QyIGluc3RhbmNlb2YgQXJyYXk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgfQogICAgcmV0dXJuIGZ1bmN0aW9uIHNldFByb3RvdHlwZU9mMihPLCBwcm90bykgewogICAgICBhbk9iamVjdCRlKE8pOwogICAgICBhUG9zc2libGVQcm90b3R5cGUocHJvdG8pOwogICAgICBpZiAoQ09SUkVDVF9TRVRURVIpCiAgICAgICAgc2V0dGVyLmNhbGwoTywgcHJvdG8pOwogICAgICBlbHNlCiAgICAgICAgTy5fX3Byb3RvX18gPSBwcm90bzsKICAgICAgcmV0dXJuIE87CiAgICB9OwogIH0oKSA6IHZvaWQgMCk7CiAgdmFyICQkRSA9IF9leHBvcnQ7CiAgdmFyIEZ1bmN0aW9uTmFtZSA9IGZ1bmN0aW9uTmFtZTsKICB2YXIgY3JlYXRlSXRlcmF0b3JDb25zdHJ1Y3RvciA9IGNyZWF0ZUl0ZXJhdG9yQ29uc3RydWN0b3IkMTsKICB2YXIgZ2V0UHJvdG90eXBlT2YkNiA9IG9iamVjdEdldFByb3RvdHlwZU9mOwogIHZhciBzZXRUb1N0cmluZ1RhZyQ0ID0gc2V0VG9TdHJpbmdUYWckNjsKICB2YXIgcmVkZWZpbmUkMiA9IHJlZGVmaW5lJDQ7CiAgdmFyIHdlbGxLbm93blN5bWJvbCRmID0gd2VsbEtub3duU3ltYm9sJGw7CiAgdmFyIEl0ZXJhdG9ycyQ0ID0gaXRlcmF0b3JzOwogIHZhciBJdGVyYXRvcnNDb3JlID0gaXRlcmF0b3JzQ29yZTsKICB2YXIgUFJPUEVSX0ZVTkNUSU9OX05BTUUgPSBGdW5jdGlvbk5hbWUuUFJPUEVSOwogIHZhciBCVUdHWV9TQUZBUklfSVRFUkFUT1JTID0gSXRlcmF0b3JzQ29yZS5CVUdHWV9TQUZBUklfSVRFUkFUT1JTOwogIHZhciBJVEVSQVRPUiQ0ID0gd2VsbEtub3duU3ltYm9sJGYoIml0ZXJhdG9yIik7CiAgdmFyIEtFWVMgPSAia2V5cyI7CiAgdmFyIFZBTFVFUyA9ICJ2YWx1ZXMiOwogIHZhciBFTlRSSUVTID0gImVudHJpZXMiOwogIHZhciByZXR1cm5UaGlzID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpczsKICB9OwogIHZhciBkZWZpbmVJdGVyYXRvciQyID0gZnVuY3Rpb24oSXRlcmFibGUsIE5BTUUyLCBJdGVyYXRvckNvbnN0cnVjdG9yLCBuZXh0LCBERUZBVUxULCBJU19TRVQsIEZPUkNFRDIpIHsKICAgIGNyZWF0ZUl0ZXJhdG9yQ29uc3RydWN0b3IoSXRlcmF0b3JDb25zdHJ1Y3RvciwgTkFNRTIsIG5leHQpOwogICAgdmFyIGdldEl0ZXJhdGlvbk1ldGhvZCA9IGZ1bmN0aW9uKEtJTkQpIHsKICAgICAgaWYgKEtJTkQgPT09IERFRkFVTFQgJiYgZGVmYXVsdEl0ZXJhdG9yKQogICAgICAgIHJldHVybiBkZWZhdWx0SXRlcmF0b3I7CiAgICAgIGlmICghQlVHR1lfU0FGQVJJX0lURVJBVE9SUyAmJiBLSU5EIGluIEl0ZXJhYmxlUHJvdG90eXBlKQogICAgICAgIHJldHVybiBJdGVyYWJsZVByb3RvdHlwZVtLSU5EXTsKICAgICAgc3dpdGNoIChLSU5EKSB7CiAgICAgICAgY2FzZSBLRVlTOgogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGtleXMyKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IEl0ZXJhdG9yQ29uc3RydWN0b3IodGhpcywgS0lORCk7CiAgICAgICAgICB9OwogICAgICAgIGNhc2UgVkFMVUVTOgogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIHZhbHVlcygpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBJdGVyYXRvckNvbnN0cnVjdG9yKHRoaXMsIEtJTkQpOwogICAgICAgICAgfTsKICAgICAgICBjYXNlIEVOVFJJRVM6CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gZW50cmllczIoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSXRlcmF0b3JDb25zdHJ1Y3Rvcih0aGlzLCBLSU5EKTsKICAgICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgSXRlcmF0b3JDb25zdHJ1Y3Rvcih0aGlzKTsKICAgICAgfTsKICAgIH07CiAgICB2YXIgVE9fU1RSSU5HX1RBRzIgPSBOQU1FMiArICIgSXRlcmF0b3IiOwogICAgdmFyIElOQ09SUkVDVF9WQUxVRVNfTkFNRSA9IGZhbHNlOwogICAgdmFyIEl0ZXJhYmxlUHJvdG90eXBlID0gSXRlcmFibGUucHJvdG90eXBlOwogICAgdmFyIG5hdGl2ZUl0ZXJhdG9yID0gSXRlcmFibGVQcm90b3R5cGVbSVRFUkFUT1IkNF0gfHwgSXRlcmFibGVQcm90b3R5cGVbIkBAaXRlcmF0b3IiXSB8fCBERUZBVUxUICYmIEl0ZXJhYmxlUHJvdG90eXBlW0RFRkFVTFRdOwogICAgdmFyIGRlZmF1bHRJdGVyYXRvciA9ICFCVUdHWV9TQUZBUklfSVRFUkFUT1JTICYmIG5hdGl2ZUl0ZXJhdG9yIHx8IGdldEl0ZXJhdGlvbk1ldGhvZChERUZBVUxUKTsKICAgIHZhciBhbnlOYXRpdmVJdGVyYXRvciA9IE5BTUUyID09ICJBcnJheSIgPyBJdGVyYWJsZVByb3RvdHlwZS5lbnRyaWVzIHx8IG5hdGl2ZUl0ZXJhdG9yIDogbmF0aXZlSXRlcmF0b3I7CiAgICB2YXIgQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlLCBtZXRob2RzLCBLRVk7CiAgICBpZiAoYW55TmF0aXZlSXRlcmF0b3IpIHsKICAgICAgQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG90eXBlT2YkNihhbnlOYXRpdmVJdGVyYXRvci5jYWxsKG5ldyBJdGVyYWJsZSgpKSk7CiAgICAgIGlmIChDdXJyZW50SXRlcmF0b3JQcm90b3R5cGUgIT09IE9iamVjdC5wcm90b3R5cGUgJiYgQ3VycmVudEl0ZXJhdG9yUHJvdG90eXBlLm5leHQpIHsKICAgICAgICBzZXRUb1N0cmluZ1RhZyQ0KEN1cnJlbnRJdGVyYXRvclByb3RvdHlwZSwgVE9fU1RSSU5HX1RBRzIsIHRydWUsIHRydWUpOwogICAgICAgIEl0ZXJhdG9ycyQ0W1RPX1NUUklOR19UQUcyXSA9IHJldHVyblRoaXM7CiAgICAgIH0KICAgIH0KICAgIGlmIChQUk9QRVJfRlVOQ1RJT05fTkFNRSAmJiBERUZBVUxUID09IFZBTFVFUyAmJiBuYXRpdmVJdGVyYXRvciAmJiBuYXRpdmVJdGVyYXRvci5uYW1lICE9PSBWQUxVRVMpIHsKICAgICAgewogICAgICAgIElOQ09SUkVDVF9WQUxVRVNfTkFNRSA9IHRydWU7CiAgICAgICAgZGVmYXVsdEl0ZXJhdG9yID0gZnVuY3Rpb24gdmFsdWVzKCkgewogICAgICAgICAgcmV0dXJuIG5hdGl2ZUl0ZXJhdG9yLmNhbGwodGhpcyk7CiAgICAgICAgfTsKICAgICAgfQogICAgfQogICAgaWYgKERFRkFVTFQpIHsKICAgICAgbWV0aG9kcyA9IHsKICAgICAgICB2YWx1ZXM6IGdldEl0ZXJhdGlvbk1ldGhvZChWQUxVRVMpLAogICAgICAgIGtleXM6IElTX1NFVCA/IGRlZmF1bHRJdGVyYXRvciA6IGdldEl0ZXJhdGlvbk1ldGhvZChLRVlTKSwKICAgICAgICBlbnRyaWVzOiBnZXRJdGVyYXRpb25NZXRob2QoRU5UUklFUykKICAgICAgfTsKICAgICAgaWYgKEZPUkNFRDIpCiAgICAgICAgZm9yIChLRVkgaW4gbWV0aG9kcykgewogICAgICAgICAgaWYgKEJVR0dZX1NBRkFSSV9JVEVSQVRPUlMgfHwgSU5DT1JSRUNUX1ZBTFVFU19OQU1FIHx8ICEoS0VZIGluIEl0ZXJhYmxlUHJvdG90eXBlKSkgewogICAgICAgICAgICByZWRlZmluZSQyKEl0ZXJhYmxlUHJvdG90eXBlLCBLRVksIG1ldGhvZHNbS0VZXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICBlbHNlCiAgICAgICAgJCRFKHsgdGFyZ2V0OiBOQU1FMiwgcHJvdG86IHRydWUsIGZvcmNlZDogQlVHR1lfU0FGQVJJX0lURVJBVE9SUyB8fCBJTkNPUlJFQ1RfVkFMVUVTX05BTUUgfSwgbWV0aG9kcyk7CiAgICB9CiAgICBpZiAoRk9SQ0VEMiAmJiBJdGVyYWJsZVByb3RvdHlwZVtJVEVSQVRPUiQ0XSAhPT0gZGVmYXVsdEl0ZXJhdG9yKSB7CiAgICAgIHJlZGVmaW5lJDIoSXRlcmFibGVQcm90b3R5cGUsIElURVJBVE9SJDQsIGRlZmF1bHRJdGVyYXRvciwgeyBuYW1lOiBERUZBVUxUIH0pOwogICAgfQogICAgSXRlcmF0b3JzJDRbTkFNRTJdID0gZGVmYXVsdEl0ZXJhdG9yOwogICAgcmV0dXJuIG1ldGhvZHM7CiAgfTsKICB2YXIgdG9JbmRleGVkT2JqZWN0JDUgPSB0b0luZGV4ZWRPYmplY3QkOTsKICB2YXIgSXRlcmF0b3JzJDMgPSBpdGVyYXRvcnM7CiAgdmFyIEludGVybmFsU3RhdGVNb2R1bGUkNSA9IGludGVybmFsU3RhdGU7CiAgdmFyIGRlZmluZUl0ZXJhdG9yJDEgPSBkZWZpbmVJdGVyYXRvciQyOwogIHZhciBBUlJBWV9JVEVSQVRPUiA9ICJBcnJheSBJdGVyYXRvciI7CiAgdmFyIHNldEludGVybmFsU3RhdGUkNSA9IEludGVybmFsU3RhdGVNb2R1bGUkNS5zZXQ7CiAgdmFyIGdldEludGVybmFsU3RhdGUkMyA9IEludGVybmFsU3RhdGVNb2R1bGUkNS5nZXR0ZXJGb3IoQVJSQVlfSVRFUkFUT1IpOwogIGRlZmluZUl0ZXJhdG9yJDEoQXJyYXksICJBcnJheSIsIGZ1bmN0aW9uKGl0ZXJhdGVkLCBraW5kKSB7CiAgICBzZXRJbnRlcm5hbFN0YXRlJDUodGhpcywgewogICAgICB0eXBlOiBBUlJBWV9JVEVSQVRPUiwKICAgICAgdGFyZ2V0OiB0b0luZGV4ZWRPYmplY3QkNShpdGVyYXRlZCksCiAgICAgIGluZGV4OiAwLAogICAgICBraW5kCiAgICB9KTsKICB9LCBmdW5jdGlvbigpIHsKICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUkMyh0aGlzKTsKICAgIHZhciB0YXJnZXQgPSBzdGF0ZS50YXJnZXQ7CiAgICB2YXIga2luZCA9IHN0YXRlLmtpbmQ7CiAgICB2YXIgaW5kZXggPSBzdGF0ZS5pbmRleCsrOwogICAgaWYgKCF0YXJnZXQgfHwgaW5kZXggPj0gdGFyZ2V0Lmxlbmd0aCkgewogICAgICBzdGF0ZS50YXJnZXQgPSB2b2lkIDA7CiAgICAgIHJldHVybiB7IHZhbHVlOiB2b2lkIDAsIGRvbmU6IHRydWUgfTsKICAgIH0KICAgIGlmIChraW5kID09ICJrZXlzIikKICAgICAgcmV0dXJuIHsgdmFsdWU6IGluZGV4LCBkb25lOiBmYWxzZSB9OwogICAgaWYgKGtpbmQgPT0gInZhbHVlcyIpCiAgICAgIHJldHVybiB7IHZhbHVlOiB0YXJnZXRbaW5kZXhdLCBkb25lOiBmYWxzZSB9OwogICAgcmV0dXJuIHsgdmFsdWU6IFtpbmRleCwgdGFyZ2V0W2luZGV4XV0sIGRvbmU6IGZhbHNlIH07CiAgfSwgInZhbHVlcyIpOwogIEl0ZXJhdG9ycyQzLkFyZ3VtZW50cyA9IEl0ZXJhdG9ycyQzLkFycmF5OwogIHZhciBjbGFzc29mJDcgPSBjbGFzc29mJDk7CiAgdmFyIHRvU3RyaW5nJGEgPSBmdW5jdGlvbihhcmd1bWVudCkgewogICAgaWYgKGNsYXNzb2YkNyhhcmd1bWVudCkgPT09ICJTeW1ib2wiKQogICAgICB0aHJvdyBUeXBlRXJyb3IoIkNhbm5vdCBjb252ZXJ0IGEgU3ltYm9sIHZhbHVlIHRvIGEgc3RyaW5nIik7CiAgICByZXR1cm4gU3RyaW5nKGFyZ3VtZW50KTsKICB9OwogIHZhciB0b0ludGVnZXIgPSB0b0ludGVnZXIkMzsKICB2YXIgdG9TdHJpbmckOSA9IHRvU3RyaW5nJGE7CiAgdmFyIHJlcXVpcmVPYmplY3RDb2VyY2libGUkMiA9IHJlcXVpcmVPYmplY3RDb2VyY2libGUkNTsKICB2YXIgY3JlYXRlTWV0aG9kJDMgPSBmdW5jdGlvbihDT05WRVJUX1RPX1NUUklORykgewogICAgcmV0dXJuIGZ1bmN0aW9uKCR0aGlzLCBwb3MpIHsKICAgICAgdmFyIFMgPSB0b1N0cmluZyQ5KHJlcXVpcmVPYmplY3RDb2VyY2libGUkMigkdGhpcykpOwogICAgICB2YXIgcG9zaXRpb24gPSB0b0ludGVnZXIocG9zKTsKICAgICAgdmFyIHNpemUgPSBTLmxlbmd0aDsKICAgICAgdmFyIGZpcnN0LCBzZWNvbmQ7CiAgICAgIGlmIChwb3NpdGlvbiA8IDAgfHwgcG9zaXRpb24gPj0gc2l6ZSkKICAgICAgICByZXR1cm4gQ09OVkVSVF9UT19TVFJJTkcgPyAiIiA6IHZvaWQgMDsKICAgICAgZmlyc3QgPSBTLmNoYXJDb2RlQXQocG9zaXRpb24pOwogICAgICByZXR1cm4gZmlyc3QgPCA1NTI5NiB8fCBmaXJzdCA+IDU2MzE5IHx8IHBvc2l0aW9uICsgMSA9PT0gc2l6ZSB8fCAoc2Vjb25kID0gUy5jaGFyQ29kZUF0KHBvc2l0aW9uICsgMSkpIDwgNTYzMjAgfHwgc2Vjb25kID4gNTczNDMgPyBDT05WRVJUX1RPX1NUUklORyA/IFMuY2hhckF0KHBvc2l0aW9uKSA6IGZpcnN0IDogQ09OVkVSVF9UT19TVFJJTkcgPyBTLnNsaWNlKHBvc2l0aW9uLCBwb3NpdGlvbiArIDIpIDogKGZpcnN0IC0gNTUyOTYgPDwgMTApICsgKHNlY29uZCAtIDU2MzIwKSArIDY1NTM2OwogICAgfTsKICB9OwogIHZhciBzdHJpbmdNdWx0aWJ5dGUgPSB7CiAgICBjb2RlQXQ6IGNyZWF0ZU1ldGhvZCQzKGZhbHNlKSwKICAgIGNoYXJBdDogY3JlYXRlTWV0aG9kJDModHJ1ZSkKICB9OwogIHZhciBjaGFyQXQgPSBzdHJpbmdNdWx0aWJ5dGUuY2hhckF0OwogIHZhciB0b1N0cmluZyQ4ID0gdG9TdHJpbmckYTsKICB2YXIgSW50ZXJuYWxTdGF0ZU1vZHVsZSQ0ID0gaW50ZXJuYWxTdGF0ZTsKICB2YXIgZGVmaW5lSXRlcmF0b3IgPSBkZWZpbmVJdGVyYXRvciQyOwogIHZhciBTVFJJTkdfSVRFUkFUT1IgPSAiU3RyaW5nIEl0ZXJhdG9yIjsKICB2YXIgc2V0SW50ZXJuYWxTdGF0ZSQ0ID0gSW50ZXJuYWxTdGF0ZU1vZHVsZSQ0LnNldDsKICB2YXIgZ2V0SW50ZXJuYWxTdGF0ZSQyID0gSW50ZXJuYWxTdGF0ZU1vZHVsZSQ0LmdldHRlckZvcihTVFJJTkdfSVRFUkFUT1IpOwogIGRlZmluZUl0ZXJhdG9yKFN0cmluZywgIlN0cmluZyIsIGZ1bmN0aW9uKGl0ZXJhdGVkKSB7CiAgICBzZXRJbnRlcm5hbFN0YXRlJDQodGhpcywgewogICAgICB0eXBlOiBTVFJJTkdfSVRFUkFUT1IsCiAgICAgIHN0cmluZzogdG9TdHJpbmckOChpdGVyYXRlZCksCiAgICAgIGluZGV4OiAwCiAgICB9KTsKICB9LCBmdW5jdGlvbiBuZXh0KCkgewogICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxTdGF0ZSQyKHRoaXMpOwogICAgdmFyIHN0cmluZyA9IHN0YXRlLnN0cmluZzsKICAgIHZhciBpbmRleCA9IHN0YXRlLmluZGV4OwogICAgdmFyIHBvaW50OwogICAgaWYgKGluZGV4ID49IHN0cmluZy5sZW5ndGgpCiAgICAgIHJldHVybiB7IHZhbHVlOiB2b2lkIDAsIGRvbmU6IHRydWUgfTsKICAgIHBvaW50ID0gY2hhckF0KHN0cmluZywgaW5kZXgpOwogICAgc3RhdGUuaW5kZXggKz0gcG9pbnQubGVuZ3RoOwogICAgcmV0dXJuIHsgdmFsdWU6IHBvaW50LCBkb25lOiBmYWxzZSB9OwogIH0pOwogIHZhciBjbGFzc29mJDYgPSBjbGFzc29mJDk7CiAgdmFyIGdldE1ldGhvZCQxID0gZ2V0TWV0aG9kJDM7CiAgdmFyIEl0ZXJhdG9ycyQyID0gaXRlcmF0b3JzOwogIHZhciB3ZWxsS25vd25TeW1ib2wkZSA9IHdlbGxLbm93blN5bWJvbCRsOwogIHZhciBJVEVSQVRPUiQzID0gd2VsbEtub3duU3ltYm9sJGUoIml0ZXJhdG9yIik7CiAgdmFyIGdldEl0ZXJhdG9yTWV0aG9kJDcgPSBmdW5jdGlvbihpdCkgewogICAgaWYgKGl0ICE9IHZvaWQgMCkKICAgICAgcmV0dXJuIGdldE1ldGhvZCQxKGl0LCBJVEVSQVRPUiQzKSB8fCBnZXRNZXRob2QkMShpdCwgIkBAaXRlcmF0b3IiKSB8fCBJdGVyYXRvcnMkMltjbGFzc29mJDYoaXQpXTsKICB9OwogIHZhciBhQ2FsbGFibGUkOSA9IGFDYWxsYWJsZSRjOwogIHZhciBhbk9iamVjdCRkID0gYW5PYmplY3QkaTsKICB2YXIgZ2V0SXRlcmF0b3JNZXRob2QkNiA9IGdldEl0ZXJhdG9yTWV0aG9kJDc7CiAgdmFyIGdldEl0ZXJhdG9yJDYgPSBmdW5jdGlvbihhcmd1bWVudCwgdXNpbmdJdGVyYXRvcikgewogICAgdmFyIGl0ZXJhdG9yTWV0aG9kID0gYXJndW1lbnRzLmxlbmd0aCA8IDIgPyBnZXRJdGVyYXRvck1ldGhvZCQ2KGFyZ3VtZW50KSA6IHVzaW5nSXRlcmF0b3I7CiAgICBpZiAoYUNhbGxhYmxlJDkoaXRlcmF0b3JNZXRob2QpKQogICAgICByZXR1cm4gYW5PYmplY3QkZChpdGVyYXRvck1ldGhvZC5jYWxsKGFyZ3VtZW50KSk7CiAgICB0aHJvdyBUeXBlRXJyb3IoU3RyaW5nKGFyZ3VtZW50KSArICIgaXMgbm90IGl0ZXJhYmxlIik7CiAgfTsKICB2YXIgZ2V0SXRlcmF0b3IkNSA9IGdldEl0ZXJhdG9yJDY7CiAgdmFyIGdldEl0ZXJhdG9yXzEgPSBnZXRJdGVyYXRvciQ1OwogIHZhciBkb21JdGVyYWJsZXMgPSB7CiAgICBDU1NSdWxlTGlzdDogMCwKICAgIENTU1N0eWxlRGVjbGFyYXRpb246IDAsCiAgICBDU1NWYWx1ZUxpc3Q6IDAsCiAgICBDbGllbnRSZWN0TGlzdDogMCwKICAgIERPTVJlY3RMaXN0OiAwLAogICAgRE9NU3RyaW5nTGlzdDogMCwKICAgIERPTVRva2VuTGlzdDogMSwKICAgIERhdGFUcmFuc2Zlckl0ZW1MaXN0OiAwLAogICAgRmlsZUxpc3Q6IDAsCiAgICBIVE1MQWxsQ29sbGVjdGlvbjogMCwKICAgIEhUTUxDb2xsZWN0aW9uOiAwLAogICAgSFRNTEZvcm1FbGVtZW50OiAwLAogICAgSFRNTFNlbGVjdEVsZW1lbnQ6IDAsCiAgICBNZWRpYUxpc3Q6IDAsCiAgICBNaW1lVHlwZUFycmF5OiAwLAogICAgTmFtZWROb2RlTWFwOiAwLAogICAgTm9kZUxpc3Q6IDEsCiAgICBQYWludFJlcXVlc3RMaXN0OiAwLAogICAgUGx1Z2luOiAwLAogICAgUGx1Z2luQXJyYXk6IDAsCiAgICBTVkdMZW5ndGhMaXN0OiAwLAogICAgU1ZHTnVtYmVyTGlzdDogMCwKICAgIFNWR1BhdGhTZWdMaXN0OiAwLAogICAgU1ZHUG9pbnRMaXN0OiAwLAogICAgU1ZHU3RyaW5nTGlzdDogMCwKICAgIFNWR1RyYW5zZm9ybUxpc3Q6IDAsCiAgICBTb3VyY2VCdWZmZXJMaXN0OiAwLAogICAgU3R5bGVTaGVldExpc3Q6IDAsCiAgICBUZXh0VHJhY2tDdWVMaXN0OiAwLAogICAgVGV4dFRyYWNrTGlzdDogMCwKICAgIFRvdWNoTGlzdDogMAogIH07CiAgdmFyIERPTUl0ZXJhYmxlcyQxID0gZG9tSXRlcmFibGVzOwogIHZhciBnbG9iYWwkZSA9IGdsb2JhbCRvOwogIHZhciBjbGFzc29mJDUgPSBjbGFzc29mJDk7CiAgdmFyIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQyID0gY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDc7CiAgdmFyIEl0ZXJhdG9ycyQxID0gaXRlcmF0b3JzOwogIHZhciB3ZWxsS25vd25TeW1ib2wkZCA9IHdlbGxLbm93blN5bWJvbCRsOwogIHZhciBUT19TVFJJTkdfVEFHID0gd2VsbEtub3duU3ltYm9sJGQoInRvU3RyaW5nVGFnIik7CiAgZm9yICh2YXIgQ09MTEVDVElPTl9OQU1FIGluIERPTUl0ZXJhYmxlcyQxKSB7CiAgICB2YXIgQ29sbGVjdGlvbiA9IGdsb2JhbCRlW0NPTExFQ1RJT05fTkFNRV07CiAgICB2YXIgQ29sbGVjdGlvblByb3RvdHlwZSA9IENvbGxlY3Rpb24gJiYgQ29sbGVjdGlvbi5wcm90b3R5cGU7CiAgICBpZiAoQ29sbGVjdGlvblByb3RvdHlwZSAmJiBjbGFzc29mJDUoQ29sbGVjdGlvblByb3RvdHlwZSkgIT09IFRPX1NUUklOR19UQUcpIHsKICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5JDIoQ29sbGVjdGlvblByb3RvdHlwZSwgVE9fU1RSSU5HX1RBRywgQ09MTEVDVElPTl9OQU1FKTsKICAgIH0KICAgIEl0ZXJhdG9ycyQxW0NPTExFQ1RJT05fTkFNRV0gPSBJdGVyYXRvcnMkMS5BcnJheTsKICB9CiAgdmFyIHBhcmVudCRQID0gZ2V0SXRlcmF0b3JfMTsKICB2YXIgZ2V0SXRlcmF0b3IkNCA9IHBhcmVudCRQOwogIHZhciBwYXJlbnQkTyA9IGdldEl0ZXJhdG9yJDQ7CiAgdmFyIGdldEl0ZXJhdG9yJDMgPSBwYXJlbnQkTzsKICB2YXIgZ2V0SXRlcmF0b3IkMiA9IGdldEl0ZXJhdG9yJDM7CiAgdmFyIGNsYXNzb2YkNCA9IGNsYXNzb2ZSYXckMTsKICB2YXIgaXNBcnJheSRhID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiBpc0FycmF5Mihhcmd1bWVudCkgewogICAgcmV0dXJuIGNsYXNzb2YkNChhcmd1bWVudCkgPT0gIkFycmF5IjsKICB9OwogIHZhciAkJEQgPSBfZXhwb3J0OwogIHZhciBpc0FycmF5JDkgPSBpc0FycmF5JGE7CiAgJCREKHsgdGFyZ2V0OiAiQXJyYXkiLCBzdGF0OiB0cnVlIH0sIHsKICAgIGlzQXJyYXk6IGlzQXJyYXkkOQogIH0pOwogIHZhciBwYXRoJGogPSBwYXRoJG47CiAgdmFyIGlzQXJyYXkkOCA9IHBhdGgkai5BcnJheS5pc0FycmF5OwogIHZhciBwYXJlbnQkTiA9IGlzQXJyYXkkODsKICB2YXIgaXNBcnJheSQ3ID0gcGFyZW50JE47CiAgdmFyIGlzQXJyYXkkNiA9IGlzQXJyYXkkNzsKICB2YXIgZ2V0SXRlcmF0b3JNZXRob2QkNSA9IGdldEl0ZXJhdG9yTWV0aG9kJDc7CiAgdmFyIGdldEl0ZXJhdG9yTWV0aG9kXzEgPSBnZXRJdGVyYXRvck1ldGhvZCQ1OwogIHZhciBwYXJlbnQkTSA9IGdldEl0ZXJhdG9yTWV0aG9kXzE7CiAgdmFyIGdldEl0ZXJhdG9yTWV0aG9kJDQgPSBwYXJlbnQkTTsKICB2YXIgcGFyZW50JEwgPSBnZXRJdGVyYXRvck1ldGhvZCQ0OwogIHZhciBnZXRJdGVyYXRvck1ldGhvZCQzID0gcGFyZW50JEw7CiAgdmFyIGdldEl0ZXJhdG9yTWV0aG9kJDIgPSBnZXRJdGVyYXRvck1ldGhvZCQzOwogIHZhciB0b1Byb3BlcnR5S2V5JDEgPSB0b1Byb3BlcnR5S2V5JDQ7CiAgdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlJDIgPSBvYmplY3REZWZpbmVQcm9wZXJ0eTsKICB2YXIgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDIgPSBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkNjsKICB2YXIgY3JlYXRlUHJvcGVydHkkNCA9IGZ1bmN0aW9uKG9iamVjdCwga2V5LCB2YWx1ZSkgewogICAgdmFyIHByb3BlcnR5S2V5ID0gdG9Qcm9wZXJ0eUtleSQxKGtleSk7CiAgICBpZiAocHJvcGVydHlLZXkgaW4gb2JqZWN0KQogICAgICBkZWZpbmVQcm9wZXJ0eU1vZHVsZSQyLmYob2JqZWN0LCBwcm9wZXJ0eUtleSwgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDIoMCwgdmFsdWUpKTsKICAgIGVsc2UKICAgICAgb2JqZWN0W3Byb3BlcnR5S2V5XSA9IHZhbHVlOwogIH07CiAgdmFyIGZhaWxzJGYgPSBmYWlscyRuOwogIHZhciBpc0NhbGxhYmxlJDcgPSBpc0NhbGxhYmxlJGw7CiAgdmFyIGNsYXNzb2YkMyA9IGNsYXNzb2YkOTsKICB2YXIgZ2V0QnVpbHRJbiQ3ID0gZ2V0QnVpbHRJbiRiOwogIHZhciBpbnNwZWN0U291cmNlJDEgPSBpbnNwZWN0U291cmNlJDM7CiAgdmFyIGVtcHR5ID0gW107CiAgdmFyIGNvbnN0cnVjdCQ0ID0gZ2V0QnVpbHRJbiQ3KCJSZWZsZWN0IiwgImNvbnN0cnVjdCIpOwogIHZhciBjb25zdHJ1Y3RvclJlZ0V4cCA9IC9eXHMqKD86Y2xhc3N8ZnVuY3Rpb24pXGIvOwogIHZhciBleGVjID0gY29uc3RydWN0b3JSZWdFeHAuZXhlYzsKICB2YXIgSU5DT1JSRUNUX1RPX1NUUklORyA9ICFjb25zdHJ1Y3RvclJlZ0V4cC5leGVjKGZ1bmN0aW9uKCkgewogIH0pOwogIHZhciBpc0NvbnN0cnVjdG9yTW9kZXJuID0gZnVuY3Rpb24oYXJndW1lbnQpIHsKICAgIGlmICghaXNDYWxsYWJsZSQ3KGFyZ3VtZW50KSkKICAgICAgcmV0dXJuIGZhbHNlOwogICAgdHJ5IHsKICAgICAgY29uc3RydWN0JDQoT2JqZWN0LCBlbXB0eSwgYXJndW1lbnQpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9OwogIHZhciBpc0NvbnN0cnVjdG9yTGVnYWN5ID0gZnVuY3Rpb24oYXJndW1lbnQpIHsKICAgIGlmICghaXNDYWxsYWJsZSQ3KGFyZ3VtZW50KSkKICAgICAgcmV0dXJuIGZhbHNlOwogICAgc3dpdGNoIChjbGFzc29mJDMoYXJndW1lbnQpKSB7CiAgICAgIGNhc2UgIkFzeW5jRnVuY3Rpb24iOgogICAgICBjYXNlICJHZW5lcmF0b3JGdW5jdGlvbiI6CiAgICAgIGNhc2UgIkFzeW5jR2VuZXJhdG9yRnVuY3Rpb24iOgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiBJTkNPUlJFQ1RfVE9fU1RSSU5HIHx8ICEhZXhlYy5jYWxsKGNvbnN0cnVjdG9yUmVnRXhwLCBpbnNwZWN0U291cmNlJDEoYXJndW1lbnQpKTsKICB9OwogIHZhciBpc0NvbnN0cnVjdG9yJDQgPSAhY29uc3RydWN0JDQgfHwgZmFpbHMkZihmdW5jdGlvbigpIHsKICAgIHZhciBjYWxsZWQyOwogICAgcmV0dXJuIGlzQ29uc3RydWN0b3JNb2Rlcm4oaXNDb25zdHJ1Y3Rvck1vZGVybi5jYWxsKSB8fCAhaXNDb25zdHJ1Y3Rvck1vZGVybihPYmplY3QpIHx8ICFpc0NvbnN0cnVjdG9yTW9kZXJuKGZ1bmN0aW9uKCkgewogICAgICBjYWxsZWQyID0gdHJ1ZTsKICAgIH0pIHx8IGNhbGxlZDI7CiAgfSkgPyBpc0NvbnN0cnVjdG9yTGVnYWN5IDogaXNDb25zdHJ1Y3Rvck1vZGVybjsKICB2YXIgaXNBcnJheSQ1ID0gaXNBcnJheSRhOwogIHZhciBpc0NvbnN0cnVjdG9yJDMgPSBpc0NvbnN0cnVjdG9yJDQ7CiAgdmFyIGlzT2JqZWN0JGMgPSBpc09iamVjdCRpOwogIHZhciB3ZWxsS25vd25TeW1ib2wkYyA9IHdlbGxLbm93blN5bWJvbCRsOwogIHZhciBTUEVDSUVTJDUgPSB3ZWxsS25vd25TeW1ib2wkYygic3BlY2llcyIpOwogIHZhciBhcnJheVNwZWNpZXNDb25zdHJ1Y3RvciQxID0gZnVuY3Rpb24ob3JpZ2luYWxBcnJheSkgewogICAgdmFyIEM7CiAgICBpZiAoaXNBcnJheSQ1KG9yaWdpbmFsQXJyYXkpKSB7CiAgICAgIEMgPSBvcmlnaW5hbEFycmF5LmNvbnN0cnVjdG9yOwogICAgICBpZiAoaXNDb25zdHJ1Y3RvciQzKEMpICYmIChDID09PSBBcnJheSB8fCBpc0FycmF5JDUoQy5wcm90b3R5cGUpKSkKICAgICAgICBDID0gdm9pZCAwOwogICAgICBlbHNlIGlmIChpc09iamVjdCRjKEMpKSB7CiAgICAgICAgQyA9IENbU1BFQ0lFUyQ1XTsKICAgICAgICBpZiAoQyA9PT0gbnVsbCkKICAgICAgICAgIEMgPSB2b2lkIDA7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBDID09PSB2b2lkIDAgPyBBcnJheSA6IEM7CiAgfTsKICB2YXIgYXJyYXlTcGVjaWVzQ29uc3RydWN0b3IgPSBhcnJheVNwZWNpZXNDb25zdHJ1Y3RvciQxOwogIHZhciBhcnJheVNwZWNpZXNDcmVhdGUkMiA9IGZ1bmN0aW9uKG9yaWdpbmFsQXJyYXksIGxlbmd0aCkgewogICAgcmV0dXJuIG5ldyAoYXJyYXlTcGVjaWVzQ29uc3RydWN0b3Iob3JpZ2luYWxBcnJheSkpKGxlbmd0aCA9PT0gMCA/IDAgOiBsZW5ndGgpOwogIH07CiAgdmFyIGZhaWxzJGUgPSBmYWlscyRuOwogIHZhciB3ZWxsS25vd25TeW1ib2wkYiA9IHdlbGxLbm93blN5bWJvbCRsOwogIHZhciBWOF9WRVJTSU9OJDIgPSBlbmdpbmVWOFZlcnNpb247CiAgdmFyIFNQRUNJRVMkNCA9IHdlbGxLbm93blN5bWJvbCRiKCJzcGVjaWVzIik7CiAgdmFyIGFycmF5TWV0aG9kSGFzU3BlY2llc1N1cHBvcnQkNCA9IGZ1bmN0aW9uKE1FVEhPRF9OQU1FKSB7CiAgICByZXR1cm4gVjhfVkVSU0lPTiQyID49IDUxIHx8ICFmYWlscyRlKGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJyYXkgPSBbXTsKICAgICAgdmFyIGNvbnN0cnVjdG9yID0gYXJyYXkuY29uc3RydWN0b3IgPSB7fTsKICAgICAgY29uc3RydWN0b3JbU1BFQ0lFUyQ0XSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB7IGZvbzogMSB9OwogICAgICB9OwogICAgICByZXR1cm4gYXJyYXlbTUVUSE9EX05BTUVdKEJvb2xlYW4pLmZvbyAhPT0gMTsKICAgIH0pOwogIH07CiAgdmFyICQkQyA9IF9leHBvcnQ7CiAgdmFyIGZhaWxzJGQgPSBmYWlscyRuOwogIHZhciBpc0FycmF5JDQgPSBpc0FycmF5JGE7CiAgdmFyIGlzT2JqZWN0JGIgPSBpc09iamVjdCRpOwogIHZhciB0b09iamVjdCQ4ID0gdG9PYmplY3QkYjsKICB2YXIgdG9MZW5ndGgkNyA9IHRvTGVuZ3RoJDk7CiAgdmFyIGNyZWF0ZVByb3BlcnR5JDMgPSBjcmVhdGVQcm9wZXJ0eSQ0OwogIHZhciBhcnJheVNwZWNpZXNDcmVhdGUkMSA9IGFycmF5U3BlY2llc0NyZWF0ZSQyOwogIHZhciBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0JDMgPSBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0JDQ7CiAgdmFyIHdlbGxLbm93blN5bWJvbCRhID0gd2VsbEtub3duU3ltYm9sJGw7CiAgdmFyIFY4X1ZFUlNJT04kMSA9IGVuZ2luZVY4VmVyc2lvbjsKICB2YXIgSVNfQ09OQ0FUX1NQUkVBREFCTEUgPSB3ZWxsS25vd25TeW1ib2wkYSgiaXNDb25jYXRTcHJlYWRhYmxlIik7CiAgdmFyIE1BWF9TQUZFX0lOVEVHRVIgPSA5MDA3MTk5MjU0NzQwOTkxOwogIHZhciBNQVhJTVVNX0FMTE9XRURfSU5ERVhfRVhDRUVERUQgPSAiTWF4aW11bSBhbGxvd2VkIGluZGV4IGV4Y2VlZGVkIjsKICB2YXIgSVNfQ09OQ0FUX1NQUkVBREFCTEVfU1VQUE9SVCA9IFY4X1ZFUlNJT04kMSA+PSA1MSB8fCAhZmFpbHMkZChmdW5jdGlvbigpIHsKICAgIHZhciBhcnJheSA9IFtdOwogICAgYXJyYXlbSVNfQ09OQ0FUX1NQUkVBREFCTEVdID0gZmFsc2U7CiAgICByZXR1cm4gYXJyYXkuY29uY2F0KClbMF0gIT09IGFycmF5OwogIH0pOwogIHZhciBTUEVDSUVTX1NVUFBPUlQgPSBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0JDMoImNvbmNhdCIpOwogIHZhciBpc0NvbmNhdFNwcmVhZGFibGUgPSBmdW5jdGlvbihPKSB7CiAgICBpZiAoIWlzT2JqZWN0JGIoTykpCiAgICAgIHJldHVybiBmYWxzZTsKICAgIHZhciBzcHJlYWRhYmxlID0gT1tJU19DT05DQVRfU1BSRUFEQUJMRV07CiAgICByZXR1cm4gc3ByZWFkYWJsZSAhPT0gdm9pZCAwID8gISFzcHJlYWRhYmxlIDogaXNBcnJheSQ0KE8pOwogIH07CiAgdmFyIEZPUkNFRCQ1ID0gIUlTX0NPTkNBVF9TUFJFQURBQkxFX1NVUFBPUlQgfHwgIVNQRUNJRVNfU1VQUE9SVDsKICAkJEMoeyB0YXJnZXQ6ICJBcnJheSIsIHByb3RvOiB0cnVlLCBmb3JjZWQ6IEZPUkNFRCQ1IH0sIHsKICAgIGNvbmNhdDogZnVuY3Rpb24gY29uY2F0MihhcmcpIHsKICAgICAgdmFyIE8gPSB0b09iamVjdCQ4KHRoaXMpOwogICAgICB2YXIgQSA9IGFycmF5U3BlY2llc0NyZWF0ZSQxKE8sIDApOwogICAgICB2YXIgbiA9IDA7CiAgICAgIHZhciBpMiwgaywgbGVuZ3RoLCBsZW4yLCBFOwogICAgICBmb3IgKGkyID0gLTEsIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkyIDwgbGVuZ3RoOyBpMisrKSB7CiAgICAgICAgRSA9IGkyID09PSAtMSA/IE8gOiBhcmd1bWVudHNbaTJdOwogICAgICAgIGlmIChpc0NvbmNhdFNwcmVhZGFibGUoRSkpIHsKICAgICAgICAgIGxlbjIgPSB0b0xlbmd0aCQ3KEUubGVuZ3RoKTsKICAgICAgICAgIGlmIChuICsgbGVuMiA+IE1BWF9TQUZFX0lOVEVHRVIpCiAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihNQVhJTVVNX0FMTE9XRURfSU5ERVhfRVhDRUVERUQpOwogICAgICAgICAgZm9yIChrID0gMDsgayA8IGxlbjI7IGsrKywgbisrKQogICAgICAgICAgICBpZiAoayBpbiBFKQogICAgICAgICAgICAgIGNyZWF0ZVByb3BlcnR5JDMoQSwgbiwgRVtrXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuID49IE1BWF9TQUZFX0lOVEVHRVIpCiAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihNQVhJTVVNX0FMTE9XRURfSU5ERVhfRVhDRUVERUQpOwogICAgICAgICAgY3JlYXRlUHJvcGVydHkkMyhBLCBuKyssIEUpOwogICAgICAgIH0KICAgICAgfQogICAgICBBLmxlbmd0aCA9IG47CiAgICAgIHJldHVybiBBOwogICAgfQogIH0pOwogIHZhciBvYmplY3RHZXRPd25Qcm9wZXJ0eU5hbWVzID0ge307CiAgdmFyIGludGVybmFsT2JqZWN0S2V5cyA9IG9iamVjdEtleXNJbnRlcm5hbDsKICB2YXIgZW51bUJ1Z0tleXMgPSBlbnVtQnVnS2V5cyQzOwogIHZhciBoaWRkZW5LZXlzJDIgPSBlbnVtQnVnS2V5cy5jb25jYXQoImxlbmd0aCIsICJwcm90b3R5cGUiKTsKICBvYmplY3RHZXRPd25Qcm9wZXJ0eU5hbWVzLmYgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyB8fCBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eU5hbWVzKE8pIHsKICAgIHJldHVybiBpbnRlcm5hbE9iamVjdEtleXMoTywgaGlkZGVuS2V5cyQyKTsKICB9OwogIHZhciBvYmplY3RHZXRPd25Qcm9wZXJ0eU5hbWVzRXh0ZXJuYWwgPSB7fTsKICB2YXIgdG9JbmRleGVkT2JqZWN0JDQgPSB0b0luZGV4ZWRPYmplY3QkOTsKICB2YXIgJGdldE93blByb3BlcnR5TmFtZXMkMSA9IG9iamVjdEdldE93blByb3BlcnR5TmFtZXMuZjsKICB2YXIgdG9TdHJpbmckNyA9IHt9LnRvU3RyaW5nOwogIHZhciB3aW5kb3dOYW1lcyA9IHR5cGVvZiB3aW5kb3cgPT0gIm9iamVjdCIgJiYgd2luZG93ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzID8gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMod2luZG93KSA6IFtdOwogIHZhciBnZXRXaW5kb3dOYW1lcyA9IGZ1bmN0aW9uKGl0KSB7CiAgICB0cnkgewogICAgICByZXR1cm4gJGdldE93blByb3BlcnR5TmFtZXMkMShpdCk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICByZXR1cm4gd2luZG93TmFtZXMuc2xpY2UoKTsKICAgIH0KICB9OwogIG9iamVjdEdldE93blByb3BlcnR5TmFtZXNFeHRlcm5hbC5mID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhpdCkgewogICAgcmV0dXJuIHdpbmRvd05hbWVzICYmIHRvU3RyaW5nJDcuY2FsbChpdCkgPT0gIltvYmplY3QgV2luZG93XSIgPyBnZXRXaW5kb3dOYW1lcyhpdCkgOiAkZ2V0T3duUHJvcGVydHlOYW1lcyQxKHRvSW5kZXhlZE9iamVjdCQ0KGl0KSk7CiAgfTsKICB2YXIgb2JqZWN0R2V0T3duUHJvcGVydHlTeW1ib2xzID0ge307CiAgb2JqZWN0R2V0T3duUHJvcGVydHlTeW1ib2xzLmYgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzOwogIHZhciB3ZWxsS25vd25TeW1ib2xXcmFwcGVkID0ge307CiAgdmFyIHdlbGxLbm93blN5bWJvbCQ5ID0gd2VsbEtub3duU3ltYm9sJGw7CiAgd2VsbEtub3duU3ltYm9sV3JhcHBlZC5mID0gd2VsbEtub3duU3ltYm9sJDk7CiAgdmFyIHBhdGgkaSA9IHBhdGgkbjsKICB2YXIgaGFzJDMgPSBoYXMkYzsKICB2YXIgd3JhcHBlZFdlbGxLbm93blN5bWJvbE1vZHVsZSQxID0gd2VsbEtub3duU3ltYm9sV3JhcHBlZDsKICB2YXIgZGVmaW5lUHJvcGVydHkkNyA9IG9iamVjdERlZmluZVByb3BlcnR5LmY7CiAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCRsID0gZnVuY3Rpb24oTkFNRTIpIHsKICAgIHZhciBTeW1ib2wyID0gcGF0aCRpLlN5bWJvbCB8fCAocGF0aCRpLlN5bWJvbCA9IHt9KTsKICAgIGlmICghaGFzJDMoU3ltYm9sMiwgTkFNRTIpKQogICAgICBkZWZpbmVQcm9wZXJ0eSQ3KFN5bWJvbDIsIE5BTUUyLCB7CiAgICAgICAgdmFsdWU6IHdyYXBwZWRXZWxsS25vd25TeW1ib2xNb2R1bGUkMS5mKE5BTUUyKQogICAgICB9KTsKICB9OwogIHZhciBiaW5kJGIgPSBmdW5jdGlvbkJpbmRDb250ZXh0OwogIHZhciBJbmRleGVkT2JqZWN0JDIgPSBpbmRleGVkT2JqZWN0OwogIHZhciB0b09iamVjdCQ3ID0gdG9PYmplY3QkYjsKICB2YXIgdG9MZW5ndGgkNiA9IHRvTGVuZ3RoJDk7CiAgdmFyIGFycmF5U3BlY2llc0NyZWF0ZSA9IGFycmF5U3BlY2llc0NyZWF0ZSQyOwogIHZhciBwdXNoID0gW10ucHVzaDsKICB2YXIgY3JlYXRlTWV0aG9kJDIgPSBmdW5jdGlvbihUWVBFMikgewogICAgdmFyIElTX01BUCA9IFRZUEUyID09IDE7CiAgICB2YXIgSVNfRklMVEVSID0gVFlQRTIgPT0gMjsKICAgIHZhciBJU19TT01FID0gVFlQRTIgPT0gMzsKICAgIHZhciBJU19FVkVSWSA9IFRZUEUyID09IDQ7CiAgICB2YXIgSVNfRklORF9JTkRFWCA9IFRZUEUyID09IDY7CiAgICB2YXIgSVNfRklMVEVSX1JFSkVDVCA9IFRZUEUyID09IDc7CiAgICB2YXIgTk9fSE9MRVMgPSBUWVBFMiA9PSA1IHx8IElTX0ZJTkRfSU5ERVg7CiAgICByZXR1cm4gZnVuY3Rpb24oJHRoaXMsIGNhbGxiYWNrZm4sIHRoYXQsIHNwZWNpZmljQ3JlYXRlKSB7CiAgICAgIHZhciBPID0gdG9PYmplY3QkNygkdGhpcyk7CiAgICAgIHZhciBzZWxmMiA9IEluZGV4ZWRPYmplY3QkMihPKTsKICAgICAgdmFyIGJvdW5kRnVuY3Rpb24gPSBiaW5kJGIoY2FsbGJhY2tmbiwgdGhhdCwgMyk7CiAgICAgIHZhciBsZW5ndGggPSB0b0xlbmd0aCQ2KHNlbGYyLmxlbmd0aCk7CiAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgIHZhciBjcmVhdGUyID0gc3BlY2lmaWNDcmVhdGUgfHwgYXJyYXlTcGVjaWVzQ3JlYXRlOwogICAgICB2YXIgdGFyZ2V0ID0gSVNfTUFQID8gY3JlYXRlMigkdGhpcywgbGVuZ3RoKSA6IElTX0ZJTFRFUiB8fCBJU19GSUxURVJfUkVKRUNUID8gY3JlYXRlMigkdGhpcywgMCkgOiB2b2lkIDA7CiAgICAgIHZhciB2YWx1ZSwgcmVzdWx0OwogICAgICBmb3IgKDsgbGVuZ3RoID4gaW5kZXg7IGluZGV4KyspCiAgICAgICAgaWYgKE5PX0hPTEVTIHx8IGluZGV4IGluIHNlbGYyKSB7CiAgICAgICAgICB2YWx1ZSA9IHNlbGYyW2luZGV4XTsKICAgICAgICAgIHJlc3VsdCA9IGJvdW5kRnVuY3Rpb24odmFsdWUsIGluZGV4LCBPKTsKICAgICAgICAgIGlmIChUWVBFMikgewogICAgICAgICAgICBpZiAoSVNfTUFQKQogICAgICAgICAgICAgIHRhcmdldFtpbmRleF0gPSByZXN1bHQ7CiAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdCkKICAgICAgICAgICAgICBzd2l0Y2ggKFRZUEUyKSB7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgIHJldHVybiBpbmRleDsKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgcHVzaC5jYWxsKHRhcmdldCwgdmFsdWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgIHN3aXRjaCAoVFlQRTIpIHsKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICBwdXNoLmNhbGwodGFyZ2V0LCB2YWx1ZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgcmV0dXJuIElTX0ZJTkRfSU5ERVggPyAtMSA6IElTX1NPTUUgfHwgSVNfRVZFUlkgPyBJU19FVkVSWSA6IHRhcmdldDsKICAgIH07CiAgfTsKICB2YXIgYXJyYXlJdGVyYXRpb24gPSB7CiAgICBmb3JFYWNoOiBjcmVhdGVNZXRob2QkMigwKSwKICAgIG1hcDogY3JlYXRlTWV0aG9kJDIoMSksCiAgICBmaWx0ZXI6IGNyZWF0ZU1ldGhvZCQyKDIpLAogICAgc29tZTogY3JlYXRlTWV0aG9kJDIoMyksCiAgICBldmVyeTogY3JlYXRlTWV0aG9kJDIoNCksCiAgICBmaW5kOiBjcmVhdGVNZXRob2QkMig1KSwKICAgIGZpbmRJbmRleDogY3JlYXRlTWV0aG9kJDIoNiksCiAgICBmaWx0ZXJSZWplY3Q6IGNyZWF0ZU1ldGhvZCQyKDcpCiAgfTsKICB2YXIgJCRCID0gX2V4cG9ydDsKICB2YXIgZ2xvYmFsJGQgPSBnbG9iYWwkbzsKICB2YXIgZ2V0QnVpbHRJbiQ2ID0gZ2V0QnVpbHRJbiRiOwogIHZhciBERVNDUklQVE9SUyQ3ID0gZGVzY3JpcHRvcnM7CiAgdmFyIE5BVElWRV9TWU1CT0wgPSBuYXRpdmVTeW1ib2w7CiAgdmFyIGZhaWxzJGMgPSBmYWlscyRuOwogIHZhciBoYXMkMiA9IGhhcyRjOwogIHZhciBpc0FycmF5JDMgPSBpc0FycmF5JGE7CiAgdmFyIGlzQ2FsbGFibGUkNiA9IGlzQ2FsbGFibGUkbDsKICB2YXIgaXNPYmplY3QkYSA9IGlzT2JqZWN0JGk7CiAgdmFyIGlzU3ltYm9sID0gaXNTeW1ib2wkMzsKICB2YXIgYW5PYmplY3QkYyA9IGFuT2JqZWN0JGk7CiAgdmFyIHRvT2JqZWN0JDYgPSB0b09iamVjdCRiOwogIHZhciB0b0luZGV4ZWRPYmplY3QkMyA9IHRvSW5kZXhlZE9iamVjdCQ5OwogIHZhciB0b1Byb3BlcnR5S2V5ID0gdG9Qcm9wZXJ0eUtleSQ0OwogIHZhciAkdG9TdHJpbmcgPSB0b1N0cmluZyRhOwogIHZhciBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkMSA9IGNyZWF0ZVByb3BlcnR5RGVzY3JpcHRvciQ2OwogIHZhciBuYXRpdmVPYmplY3RDcmVhdGUgPSBvYmplY3RDcmVhdGU7CiAgdmFyIG9iamVjdEtleXMkMSA9IG9iamVjdEtleXMkMzsKICB2YXIgZ2V0T3duUHJvcGVydHlOYW1lc01vZHVsZSQyID0gb2JqZWN0R2V0T3duUHJvcGVydHlOYW1lczsKICB2YXIgZ2V0T3duUHJvcGVydHlOYW1lc0V4dGVybmFsID0gb2JqZWN0R2V0T3duUHJvcGVydHlOYW1lc0V4dGVybmFsOwogIHZhciBnZXRPd25Qcm9wZXJ0eVN5bWJvbHNNb2R1bGUkMiA9IG9iamVjdEdldE93blByb3BlcnR5U3ltYm9sczsKICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yTW9kdWxlJDEgPSBvYmplY3RHZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgdmFyIGRlZmluZVByb3BlcnR5TW9kdWxlJDEgPSBvYmplY3REZWZpbmVQcm9wZXJ0eTsKICB2YXIgcHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUkMSA9IG9iamVjdFByb3BlcnR5SXNFbnVtZXJhYmxlOwogIHZhciByZWRlZmluZSQxID0gcmVkZWZpbmUkNDsKICB2YXIgc2hhcmVkID0gc2hhcmVkJDQuZXhwb3J0czsKICB2YXIgc2hhcmVkS2V5ID0gc2hhcmVkS2V5JDQ7CiAgdmFyIGhpZGRlbktleXMkMSA9IGhpZGRlbktleXMkNjsKICB2YXIgdWlkJDEgPSB1aWQkNDsKICB2YXIgd2VsbEtub3duU3ltYm9sJDggPSB3ZWxsS25vd25TeW1ib2wkbDsKICB2YXIgd3JhcHBlZFdlbGxLbm93blN5bWJvbE1vZHVsZSA9IHdlbGxLbm93blN5bWJvbFdyYXBwZWQ7CiAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCRrID0gZGVmaW5lV2VsbEtub3duU3ltYm9sJGw7CiAgdmFyIHNldFRvU3RyaW5nVGFnJDMgPSBzZXRUb1N0cmluZ1RhZyQ2OwogIHZhciBJbnRlcm5hbFN0YXRlTW9kdWxlJDMgPSBpbnRlcm5hbFN0YXRlOwogIHZhciAkZm9yRWFjaCQxID0gYXJyYXlJdGVyYXRpb24uZm9yRWFjaDsKICB2YXIgSElEREVOID0gc2hhcmVkS2V5KCJoaWRkZW4iKTsKICB2YXIgU1lNQk9MID0gIlN5bWJvbCI7CiAgdmFyIFBST1RPVFlQRSA9ICJwcm90b3R5cGUiOwogIHZhciBUT19QUklNSVRJVkUgPSB3ZWxsS25vd25TeW1ib2wkOCgidG9QcmltaXRpdmUiKTsKICB2YXIgc2V0SW50ZXJuYWxTdGF0ZSQzID0gSW50ZXJuYWxTdGF0ZU1vZHVsZSQzLnNldDsKICB2YXIgZ2V0SW50ZXJuYWxTdGF0ZSQxID0gSW50ZXJuYWxTdGF0ZU1vZHVsZSQzLmdldHRlckZvcihTWU1CT0wpOwogIHZhciBPYmplY3RQcm90b3R5cGUgPSBPYmplY3RbUFJPVE9UWVBFXTsKICB2YXIgJFN5bWJvbCA9IGdsb2JhbCRkLlN5bWJvbDsKICB2YXIgJHN0cmluZ2lmeSA9IGdldEJ1aWx0SW4kNigiSlNPTiIsICJzdHJpbmdpZnkiKTsKICB2YXIgbmF0aXZlR2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJDEgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JNb2R1bGUkMS5mOwogIHZhciBuYXRpdmVEZWZpbmVQcm9wZXJ0eSA9IGRlZmluZVByb3BlcnR5TW9kdWxlJDEuZjsKICB2YXIgbmF0aXZlR2V0T3duUHJvcGVydHlOYW1lcyA9IGdldE93blByb3BlcnR5TmFtZXNFeHRlcm5hbC5mOwogIHZhciBuYXRpdmVQcm9wZXJ0eUlzRW51bWVyYWJsZSA9IHByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlJDEuZjsKICB2YXIgQWxsU3ltYm9scyA9IHNoYXJlZCgic3ltYm9scyIpOwogIHZhciBPYmplY3RQcm90b3R5cGVTeW1ib2xzID0gc2hhcmVkKCJvcC1zeW1ib2xzIik7CiAgdmFyIFN0cmluZ1RvU3ltYm9sUmVnaXN0cnkgPSBzaGFyZWQoInN0cmluZy10by1zeW1ib2wtcmVnaXN0cnkiKTsKICB2YXIgU3ltYm9sVG9TdHJpbmdSZWdpc3RyeSA9IHNoYXJlZCgic3ltYm9sLXRvLXN0cmluZy1yZWdpc3RyeSIpOwogIHZhciBXZWxsS25vd25TeW1ib2xzU3RvcmUgPSBzaGFyZWQoIndrcyIpOwogIHZhciBRT2JqZWN0ID0gZ2xvYmFsJGQuUU9iamVjdDsKICB2YXIgVVNFX1NFVFRFUiA9ICFRT2JqZWN0IHx8ICFRT2JqZWN0W1BST1RPVFlQRV0gfHwgIVFPYmplY3RbUFJPVE9UWVBFXS5maW5kQ2hpbGQ7CiAgdmFyIHNldFN5bWJvbERlc2NyaXB0b3IgPSBERVNDUklQVE9SUyQ3ICYmIGZhaWxzJGMoZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gbmF0aXZlT2JqZWN0Q3JlYXRlKG5hdGl2ZURlZmluZVByb3BlcnR5KHt9LCAiYSIsIHsKICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmF0aXZlRGVmaW5lUHJvcGVydHkodGhpcywgImEiLCB7IHZhbHVlOiA3IH0pLmE7CiAgICAgIH0KICAgIH0pKS5hICE9IDc7CiAgfSkgPyBmdW5jdGlvbihPLCBQLCBBdHRyaWJ1dGVzKSB7CiAgICB2YXIgT2JqZWN0UHJvdG90eXBlRGVzY3JpcHRvciA9IG5hdGl2ZUdldE93blByb3BlcnR5RGVzY3JpcHRvciQxKE9iamVjdFByb3RvdHlwZSwgUCk7CiAgICBpZiAoT2JqZWN0UHJvdG90eXBlRGVzY3JpcHRvcikKICAgICAgZGVsZXRlIE9iamVjdFByb3RvdHlwZVtQXTsKICAgIG5hdGl2ZURlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpOwogICAgaWYgKE9iamVjdFByb3RvdHlwZURlc2NyaXB0b3IgJiYgTyAhPT0gT2JqZWN0UHJvdG90eXBlKSB7CiAgICAgIG5hdGl2ZURlZmluZVByb3BlcnR5KE9iamVjdFByb3RvdHlwZSwgUCwgT2JqZWN0UHJvdG90eXBlRGVzY3JpcHRvcik7CiAgICB9CiAgfSA6IG5hdGl2ZURlZmluZVByb3BlcnR5OwogIHZhciB3cmFwJDEgPSBmdW5jdGlvbih0YWcsIGRlc2NyaXB0aW9uKSB7CiAgICB2YXIgc3ltYm9sMiA9IEFsbFN5bWJvbHNbdGFnXSA9IG5hdGl2ZU9iamVjdENyZWF0ZSgkU3ltYm9sW1BST1RPVFlQRV0pOwogICAgc2V0SW50ZXJuYWxTdGF0ZSQzKHN5bWJvbDIsIHsKICAgICAgdHlwZTogU1lNQk9MLAogICAgICB0YWcsCiAgICAgIGRlc2NyaXB0aW9uCiAgICB9KTsKICAgIGlmICghREVTQ1JJUFRPUlMkNykKICAgICAgc3ltYm9sMi5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uOwogICAgcmV0dXJuIHN5bWJvbDI7CiAgfTsKICB2YXIgJGRlZmluZVByb3BlcnR5ID0gZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkyKE8sIFAsIEF0dHJpYnV0ZXMpIHsKICAgIGlmIChPID09PSBPYmplY3RQcm90b3R5cGUpCiAgICAgICRkZWZpbmVQcm9wZXJ0eShPYmplY3RQcm90b3R5cGVTeW1ib2xzLCBQLCBBdHRyaWJ1dGVzKTsKICAgIGFuT2JqZWN0JGMoTyk7CiAgICB2YXIga2V5ID0gdG9Qcm9wZXJ0eUtleShQKTsKICAgIGFuT2JqZWN0JGMoQXR0cmlidXRlcyk7CiAgICBpZiAoaGFzJDIoQWxsU3ltYm9scywga2V5KSkgewogICAgICBpZiAoIUF0dHJpYnV0ZXMuZW51bWVyYWJsZSkgewogICAgICAgIGlmICghaGFzJDIoTywgSElEREVOKSkKICAgICAgICAgIG5hdGl2ZURlZmluZVByb3BlcnR5KE8sIEhJRERFTiwgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDEoMSwge30pKTsKICAgICAgICBPW0hJRERFTl1ba2V5XSA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGhhcyQyKE8sIEhJRERFTikgJiYgT1tISURERU5dW2tleV0pCiAgICAgICAgICBPW0hJRERFTl1ba2V5XSA9IGZhbHNlOwogICAgICAgIEF0dHJpYnV0ZXMgPSBuYXRpdmVPYmplY3RDcmVhdGUoQXR0cmlidXRlcywgeyBlbnVtZXJhYmxlOiBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkMSgwLCBmYWxzZSkgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHNldFN5bWJvbERlc2NyaXB0b3IoTywga2V5LCBBdHRyaWJ1dGVzKTsKICAgIH0KICAgIHJldHVybiBuYXRpdmVEZWZpbmVQcm9wZXJ0eShPLCBrZXksIEF0dHJpYnV0ZXMpOwogIH07CiAgdmFyICRkZWZpbmVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllczIoTywgUHJvcGVydGllcykgewogICAgYW5PYmplY3QkYyhPKTsKICAgIHZhciBwcm9wZXJ0aWVzID0gdG9JbmRleGVkT2JqZWN0JDMoUHJvcGVydGllcyk7CiAgICB2YXIga2V5czIgPSBvYmplY3RLZXlzJDEocHJvcGVydGllcykuY29uY2F0KCRnZXRPd25Qcm9wZXJ0eVN5bWJvbHMocHJvcGVydGllcykpOwogICAgJGZvckVhY2gkMShrZXlzMiwgZnVuY3Rpb24oa2V5KSB7CiAgICAgIGlmICghREVTQ1JJUFRPUlMkNyB8fCAkcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChwcm9wZXJ0aWVzLCBrZXkpKQogICAgICAgICRkZWZpbmVQcm9wZXJ0eShPLCBrZXksIHByb3BlcnRpZXNba2V5XSk7CiAgICB9KTsKICAgIHJldHVybiBPOwogIH07CiAgdmFyICRjcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUyKE8sIFByb3BlcnRpZXMpIHsKICAgIHJldHVybiBQcm9wZXJ0aWVzID09PSB2b2lkIDAgPyBuYXRpdmVPYmplY3RDcmVhdGUoTykgOiAkZGVmaW5lUHJvcGVydGllcyhuYXRpdmVPYmplY3RDcmVhdGUoTyksIFByb3BlcnRpZXMpOwogIH07CiAgdmFyICRwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IGZ1bmN0aW9uIHByb3BlcnR5SXNFbnVtZXJhYmxlKFYpIHsKICAgIHZhciBQID0gdG9Qcm9wZXJ0eUtleShWKTsKICAgIHZhciBlbnVtZXJhYmxlID0gbmF0aXZlUHJvcGVydHlJc0VudW1lcmFibGUuY2FsbCh0aGlzLCBQKTsKICAgIGlmICh0aGlzID09PSBPYmplY3RQcm90b3R5cGUgJiYgaGFzJDIoQWxsU3ltYm9scywgUCkgJiYgIWhhcyQyKE9iamVjdFByb3RvdHlwZVN5bWJvbHMsIFApKQogICAgICByZXR1cm4gZmFsc2U7CiAgICByZXR1cm4gZW51bWVyYWJsZSB8fCAhaGFzJDIodGhpcywgUCkgfHwgIWhhcyQyKEFsbFN5bWJvbHMsIFApIHx8IGhhcyQyKHRoaXMsIEhJRERFTikgJiYgdGhpc1tISURERU5dW1BdID8gZW51bWVyYWJsZSA6IHRydWU7CiAgfTsKICB2YXIgJGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjIoTywgUCkgewogICAgdmFyIGl0ID0gdG9JbmRleGVkT2JqZWN0JDMoTyk7CiAgICB2YXIga2V5ID0gdG9Qcm9wZXJ0eUtleShQKTsKICAgIGlmIChpdCA9PT0gT2JqZWN0UHJvdG90eXBlICYmIGhhcyQyKEFsbFN5bWJvbHMsIGtleSkgJiYgIWhhcyQyKE9iamVjdFByb3RvdHlwZVN5bWJvbHMsIGtleSkpCiAgICAgIHJldHVybjsKICAgIHZhciBkZXNjcmlwdG9yID0gbmF0aXZlR2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJDEoaXQsIGtleSk7CiAgICBpZiAoZGVzY3JpcHRvciAmJiBoYXMkMihBbGxTeW1ib2xzLCBrZXkpICYmICEoaGFzJDIoaXQsIEhJRERFTikgJiYgaXRbSElEREVOXVtrZXldKSkgewogICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSB0cnVlOwogICAgfQogICAgcmV0dXJuIGRlc2NyaXB0b3I7CiAgfTsKICB2YXIgJGdldE93blByb3BlcnR5TmFtZXMgPSBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eU5hbWVzKE8pIHsKICAgIHZhciBuYW1lcyA9IG5hdGl2ZUdldE93blByb3BlcnR5TmFtZXModG9JbmRleGVkT2JqZWN0JDMoTykpOwogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgJGZvckVhY2gkMShuYW1lcywgZnVuY3Rpb24oa2V5KSB7CiAgICAgIGlmICghaGFzJDIoQWxsU3ltYm9scywga2V5KSAmJiAhaGFzJDIoaGlkZGVuS2V5cyQxLCBrZXkpKQogICAgICAgIHJlc3VsdC5wdXNoKGtleSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKICB2YXIgJGdldE93blByb3BlcnR5U3ltYm9scyA9IGZ1bmN0aW9uIGdldE93blByb3BlcnR5U3ltYm9sczIoTykgewogICAgdmFyIElTX09CSkVDVF9QUk9UT1RZUEUgPSBPID09PSBPYmplY3RQcm90b3R5cGU7CiAgICB2YXIgbmFtZXMgPSBuYXRpdmVHZXRPd25Qcm9wZXJ0eU5hbWVzKElTX09CSkVDVF9QUk9UT1RZUEUgPyBPYmplY3RQcm90b3R5cGVTeW1ib2xzIDogdG9JbmRleGVkT2JqZWN0JDMoTykpOwogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgJGZvckVhY2gkMShuYW1lcywgZnVuY3Rpb24oa2V5KSB7CiAgICAgIGlmIChoYXMkMihBbGxTeW1ib2xzLCBrZXkpICYmICghSVNfT0JKRUNUX1BST1RPVFlQRSB8fCBoYXMkMihPYmplY3RQcm90b3R5cGUsIGtleSkpKSB7CiAgICAgICAgcmVzdWx0LnB1c2goQWxsU3ltYm9sc1trZXldKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CiAgaWYgKCFOQVRJVkVfU1lNQk9MKSB7CiAgICAkU3ltYm9sID0gZnVuY3Rpb24gU3ltYm9sMigpIHsKICAgICAgaWYgKHRoaXMgaW5zdGFuY2VvZiAkU3ltYm9sKQogICAgICAgIHRocm93IFR5cGVFcnJvcigiU3ltYm9sIGlzIG5vdCBhIGNvbnN0cnVjdG9yIik7CiAgICAgIHZhciBkZXNjcmlwdGlvbiA9ICFhcmd1bWVudHMubGVuZ3RoIHx8IGFyZ3VtZW50c1swXSA9PT0gdm9pZCAwID8gdm9pZCAwIDogJHRvU3RyaW5nKGFyZ3VtZW50c1swXSk7CiAgICAgIHZhciB0YWcgPSB1aWQkMShkZXNjcmlwdGlvbik7CiAgICAgIHZhciBzZXR0ZXIgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGlmICh0aGlzID09PSBPYmplY3RQcm90b3R5cGUpCiAgICAgICAgICBzZXR0ZXIuY2FsbChPYmplY3RQcm90b3R5cGVTeW1ib2xzLCB2YWx1ZSk7CiAgICAgICAgaWYgKGhhcyQyKHRoaXMsIEhJRERFTikgJiYgaGFzJDIodGhpc1tISURERU5dLCB0YWcpKQogICAgICAgICAgdGhpc1tISURERU5dW3RhZ10gPSBmYWxzZTsKICAgICAgICBzZXRTeW1ib2xEZXNjcmlwdG9yKHRoaXMsIHRhZywgY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yJDEoMSwgdmFsdWUpKTsKICAgICAgfTsKICAgICAgaWYgKERFU0NSSVBUT1JTJDcgJiYgVVNFX1NFVFRFUikKICAgICAgICBzZXRTeW1ib2xEZXNjcmlwdG9yKE9iamVjdFByb3RvdHlwZSwgdGFnLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgc2V0OiBzZXR0ZXIgfSk7CiAgICAgIHJldHVybiB3cmFwJDEodGFnLCBkZXNjcmlwdGlvbik7CiAgICB9OwogICAgcmVkZWZpbmUkMSgkU3ltYm9sW1BST1RPVFlQRV0sICJ0b1N0cmluZyIsIGZ1bmN0aW9uIHRvU3RyaW5nMigpIHsKICAgICAgcmV0dXJuIGdldEludGVybmFsU3RhdGUkMSh0aGlzKS50YWc7CiAgICB9KTsKICAgIHJlZGVmaW5lJDEoJFN5bWJvbCwgIndpdGhvdXRTZXR0ZXIiLCBmdW5jdGlvbihkZXNjcmlwdGlvbikgewogICAgICByZXR1cm4gd3JhcCQxKHVpZCQxKGRlc2NyaXB0aW9uKSwgZGVzY3JpcHRpb24pOwogICAgfSk7CiAgICBwcm9wZXJ0eUlzRW51bWVyYWJsZU1vZHVsZSQxLmYgPSAkcHJvcGVydHlJc0VudW1lcmFibGU7CiAgICBkZWZpbmVQcm9wZXJ0eU1vZHVsZSQxLmYgPSAkZGVmaW5lUHJvcGVydHk7CiAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JNb2R1bGUkMS5mID0gJGdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKICAgIGdldE93blByb3BlcnR5TmFtZXNNb2R1bGUkMi5mID0gZ2V0T3duUHJvcGVydHlOYW1lc0V4dGVybmFsLmYgPSAkZ2V0T3duUHJvcGVydHlOYW1lczsKICAgIGdldE93blByb3BlcnR5U3ltYm9sc01vZHVsZSQyLmYgPSAkZ2V0T3duUHJvcGVydHlTeW1ib2xzOwogICAgd3JhcHBlZFdlbGxLbm93blN5bWJvbE1vZHVsZS5mID0gZnVuY3Rpb24obmFtZSkgewogICAgICByZXR1cm4gd3JhcCQxKHdlbGxLbm93blN5bWJvbCQ4KG5hbWUpLCBuYW1lKTsKICAgIH07CiAgICBpZiAoREVTQ1JJUFRPUlMkNykgewogICAgICBuYXRpdmVEZWZpbmVQcm9wZXJ0eSgkU3ltYm9sW1BST1RPVFlQRV0sICJkZXNjcmlwdGlvbiIsIHsKICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBkZXNjcmlwdGlvbigpIHsKICAgICAgICAgIHJldHVybiBnZXRJbnRlcm5hbFN0YXRlJDEodGhpcykuZGVzY3JpcHRpb247CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9CiAgJCRCKHsgZ2xvYmFsOiB0cnVlLCB3cmFwOiB0cnVlLCBmb3JjZWQ6ICFOQVRJVkVfU1lNQk9MLCBzaGFtOiAhTkFUSVZFX1NZTUJPTCB9LCB7CiAgICBTeW1ib2w6ICRTeW1ib2wKICB9KTsKICAkZm9yRWFjaCQxKG9iamVjdEtleXMkMShXZWxsS25vd25TeW1ib2xzU3RvcmUpLCBmdW5jdGlvbihuYW1lKSB7CiAgICBkZWZpbmVXZWxsS25vd25TeW1ib2wkayhuYW1lKTsKICB9KTsKICAkJEIoeyB0YXJnZXQ6IFNZTUJPTCwgc3RhdDogdHJ1ZSwgZm9yY2VkOiAhTkFUSVZFX1NZTUJPTCB9LCB7CiAgICAiZm9yIjogZnVuY3Rpb24oa2V5KSB7CiAgICAgIHZhciBzdHJpbmcgPSAkdG9TdHJpbmcoa2V5KTsKICAgICAgaWYgKGhhcyQyKFN0cmluZ1RvU3ltYm9sUmVnaXN0cnksIHN0cmluZykpCiAgICAgICAgcmV0dXJuIFN0cmluZ1RvU3ltYm9sUmVnaXN0cnlbc3RyaW5nXTsKICAgICAgdmFyIHN5bWJvbDIgPSAkU3ltYm9sKHN0cmluZyk7CiAgICAgIFN0cmluZ1RvU3ltYm9sUmVnaXN0cnlbc3RyaW5nXSA9IHN5bWJvbDI7CiAgICAgIFN5bWJvbFRvU3RyaW5nUmVnaXN0cnlbc3ltYm9sMl0gPSBzdHJpbmc7CiAgICAgIHJldHVybiBzeW1ib2wyOwogICAgfSwKICAgIGtleUZvcjogZnVuY3Rpb24ga2V5Rm9yKHN5bSkgewogICAgICBpZiAoIWlzU3ltYm9sKHN5bSkpCiAgICAgICAgdGhyb3cgVHlwZUVycm9yKHN5bSArICIgaXMgbm90IGEgc3ltYm9sIik7CiAgICAgIGlmIChoYXMkMihTeW1ib2xUb1N0cmluZ1JlZ2lzdHJ5LCBzeW0pKQogICAgICAgIHJldHVybiBTeW1ib2xUb1N0cmluZ1JlZ2lzdHJ5W3N5bV07CiAgICB9LAogICAgdXNlU2V0dGVyOiBmdW5jdGlvbigpIHsKICAgICAgVVNFX1NFVFRFUiA9IHRydWU7CiAgICB9LAogICAgdXNlU2ltcGxlOiBmdW5jdGlvbigpIHsKICAgICAgVVNFX1NFVFRFUiA9IGZhbHNlOwogICAgfQogIH0pOwogICQkQih7IHRhcmdldDogIk9iamVjdCIsIHN0YXQ6IHRydWUsIGZvcmNlZDogIU5BVElWRV9TWU1CT0wsIHNoYW06ICFERVNDUklQVE9SUyQ3IH0sIHsKICAgIGNyZWF0ZTogJGNyZWF0ZSwKICAgIGRlZmluZVByb3BlcnR5OiAkZGVmaW5lUHJvcGVydHksCiAgICBkZWZpbmVQcm9wZXJ0aWVzOiAkZGVmaW5lUHJvcGVydGllcywKICAgIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjogJGdldE93blByb3BlcnR5RGVzY3JpcHRvcgogIH0pOwogICQkQih7IHRhcmdldDogIk9iamVjdCIsIHN0YXQ6IHRydWUsIGZvcmNlZDogIU5BVElWRV9TWU1CT0wgfSwgewogICAgZ2V0T3duUHJvcGVydHlOYW1lczogJGdldE93blByb3BlcnR5TmFtZXMsCiAgICBnZXRPd25Qcm9wZXJ0eVN5bWJvbHM6ICRnZXRPd25Qcm9wZXJ0eVN5bWJvbHMKICB9KTsKICAkJEIoeyB0YXJnZXQ6ICJPYmplY3QiLCBzdGF0OiB0cnVlLCBmb3JjZWQ6IGZhaWxzJGMoZnVuY3Rpb24oKSB7CiAgICBnZXRPd25Qcm9wZXJ0eVN5bWJvbHNNb2R1bGUkMi5mKDEpOwogIH0pIH0sIHsKICAgIGdldE93blByb3BlcnR5U3ltYm9sczogZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlTeW1ib2xzMihpdCkgewogICAgICByZXR1cm4gZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlJDIuZih0b09iamVjdCQ2KGl0KSk7CiAgICB9CiAgfSk7CiAgaWYgKCRzdHJpbmdpZnkpIHsKICAgIHZhciBGT1JDRURfSlNPTl9TVFJJTkdJRlkgPSAhTkFUSVZFX1NZTUJPTCB8fCBmYWlscyRjKGZ1bmN0aW9uKCkgewogICAgICB2YXIgc3ltYm9sMiA9ICRTeW1ib2woKTsKICAgICAgcmV0dXJuICRzdHJpbmdpZnkoW3N5bWJvbDJdKSAhPSAiW251bGxdIiB8fCAkc3RyaW5naWZ5KHsgYTogc3ltYm9sMiB9KSAhPSAie30iIHx8ICRzdHJpbmdpZnkoT2JqZWN0KHN5bWJvbDIpKSAhPSAie30iOwogICAgfSk7CiAgICAkJEIoeyB0YXJnZXQ6ICJKU09OIiwgc3RhdDogdHJ1ZSwgZm9yY2VkOiBGT1JDRURfSlNPTl9TVFJJTkdJRlkgfSwgewogICAgICBzdHJpbmdpZnk6IGZ1bmN0aW9uIHN0cmluZ2lmeShpdCwgcmVwbGFjZXIsIHNwYWNlKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBbaXRdOwogICAgICAgIHZhciBpbmRleCA9IDE7CiAgICAgICAgdmFyICRyZXBsYWNlcjsKICAgICAgICB3aGlsZSAoYXJndW1lbnRzLmxlbmd0aCA+IGluZGV4KQogICAgICAgICAgYXJncy5wdXNoKGFyZ3VtZW50c1tpbmRleCsrXSk7CiAgICAgICAgJHJlcGxhY2VyID0gcmVwbGFjZXI7CiAgICAgICAgaWYgKCFpc09iamVjdCRhKHJlcGxhY2VyKSAmJiBpdCA9PT0gdm9pZCAwIHx8IGlzU3ltYm9sKGl0KSkKICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoIWlzQXJyYXkkMyhyZXBsYWNlcikpCiAgICAgICAgICByZXBsYWNlciA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKGlzQ2FsbGFibGUkNigkcmVwbGFjZXIpKQogICAgICAgICAgICAgIHZhbHVlID0gJHJlcGxhY2VyLmNhbGwodGhpcywga2V5LCB2YWx1ZSk7CiAgICAgICAgICAgIGlmICghaXNTeW1ib2wodmFsdWUpKQogICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgIH07CiAgICAgICAgYXJnc1sxXSA9IHJlcGxhY2VyOwogICAgICAgIHJldHVybiAkc3RyaW5naWZ5LmFwcGx5KG51bGwsIGFyZ3MpOwogICAgICB9CiAgICB9KTsKICB9CiAgaWYgKCEkU3ltYm9sW1BST1RPVFlQRV1bVE9fUFJJTUlUSVZFXSkgewogICAgdmFyIHZhbHVlT2YgPSAkU3ltYm9sW1BST1RPVFlQRV0udmFsdWVPZjsKICAgIHJlZGVmaW5lJDEoJFN5bWJvbFtQUk9UT1RZUEVdLCBUT19QUklNSVRJVkUsIGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdmFsdWVPZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfSk7CiAgfQogIHNldFRvU3RyaW5nVGFnJDMoJFN5bWJvbCwgU1lNQk9MKTsKICBoaWRkZW5LZXlzJDFbSElEREVOXSA9IHRydWU7CiAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCRqID0gZGVmaW5lV2VsbEtub3duU3ltYm9sJGw7CiAgZGVmaW5lV2VsbEtub3duU3ltYm9sJGooImFzeW5jSXRlcmF0b3IiKTsKICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sJGkgPSBkZWZpbmVXZWxsS25vd25TeW1ib2wkbDsKICBkZWZpbmVXZWxsS25vd25TeW1ib2wkaSgiaGFzSW5zdGFuY2UiKTsKICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sJGggPSBkZWZpbmVXZWxsS25vd25TeW1ib2wkbDsKICBkZWZpbmVXZWxsS25vd25TeW1ib2wkaCgiaXNDb25jYXRTcHJlYWRhYmxlIik7CiAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCRnID0gZGVmaW5lV2VsbEtub3duU3ltYm9sJGw7CiAgZGVmaW5lV2VsbEtub3duU3ltYm9sJGcoIml0ZXJhdG9yIik7CiAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCRmID0gZGVmaW5lV2VsbEtub3duU3ltYm9sJGw7CiAgZGVmaW5lV2VsbEtub3duU3ltYm9sJGYoIm1hdGNoIik7CiAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCRlID0gZGVmaW5lV2VsbEtub3duU3ltYm9sJGw7CiAgZGVmaW5lV2VsbEtub3duU3ltYm9sJGUoIm1hdGNoQWxsIik7CiAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCRkID0gZGVmaW5lV2VsbEtub3duU3ltYm9sJGw7CiAgZGVmaW5lV2VsbEtub3duU3ltYm9sJGQoInJlcGxhY2UiKTsKICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sJGMgPSBkZWZpbmVXZWxsS25vd25TeW1ib2wkbDsKICBkZWZpbmVXZWxsS25vd25TeW1ib2wkYygic2VhcmNoIik7CiAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCRiID0gZGVmaW5lV2VsbEtub3duU3ltYm9sJGw7CiAgZGVmaW5lV2VsbEtub3duU3ltYm9sJGIoInNwZWNpZXMiKTsKICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sJGEgPSBkZWZpbmVXZWxsS25vd25TeW1ib2wkbDsKICBkZWZpbmVXZWxsS25vd25TeW1ib2wkYSgic3BsaXQiKTsKICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sJDkgPSBkZWZpbmVXZWxsS25vd25TeW1ib2wkbDsKICBkZWZpbmVXZWxsS25vd25TeW1ib2wkOSgidG9QcmltaXRpdmUiKTsKICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sJDggPSBkZWZpbmVXZWxsS25vd25TeW1ib2wkbDsKICBkZWZpbmVXZWxsS25vd25TeW1ib2wkOCgidG9TdHJpbmdUYWciKTsKICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sJDcgPSBkZWZpbmVXZWxsS25vd25TeW1ib2wkbDsKICBkZWZpbmVXZWxsS25vd25TeW1ib2wkNygidW5zY29wYWJsZXMiKTsKICB2YXIgZ2xvYmFsJGMgPSBnbG9iYWwkbzsKICB2YXIgc2V0VG9TdHJpbmdUYWckMiA9IHNldFRvU3RyaW5nVGFnJDY7CiAgc2V0VG9TdHJpbmdUYWckMihnbG9iYWwkYy5KU09OLCAiSlNPTiIsIHRydWUpOwogIHZhciBwYXRoJGggPSBwYXRoJG47CiAgdmFyIHN5bWJvbCQ0ID0gcGF0aCRoLlN5bWJvbDsKICB2YXIgcGFyZW50JEsgPSBzeW1ib2wkNDsKICB2YXIgc3ltYm9sJDMgPSBwYXJlbnQkSzsKICB2YXIgc3ltYm9sJDIgPSBzeW1ib2wkMzsKICB2YXIgYW5PYmplY3QkYiA9IGFuT2JqZWN0JGk7CiAgdmFyIGdldE1ldGhvZCA9IGdldE1ldGhvZCQzOwogIHZhciBpdGVyYXRvckNsb3NlJDIgPSBmdW5jdGlvbihpdGVyYXRvcjIsIGtpbmQsIHZhbHVlKSB7CiAgICB2YXIgaW5uZXJSZXN1bHQsIGlubmVyRXJyb3I7CiAgICBhbk9iamVjdCRiKGl0ZXJhdG9yMik7CiAgICB0cnkgewogICAgICBpbm5lclJlc3VsdCA9IGdldE1ldGhvZChpdGVyYXRvcjIsICJyZXR1cm4iKTsKICAgICAgaWYgKCFpbm5lclJlc3VsdCkgewogICAgICAgIGlmIChraW5kID09PSAidGhyb3ciKQogICAgICAgICAgdGhyb3cgdmFsdWU7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9CiAgICAgIGlubmVyUmVzdWx0ID0gaW5uZXJSZXN1bHQuY2FsbChpdGVyYXRvcjIpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgaW5uZXJFcnJvciA9IHRydWU7CiAgICAgIGlubmVyUmVzdWx0ID0gZXJyb3I7CiAgICB9CiAgICBpZiAoa2luZCA9PT0gInRocm93IikKICAgICAgdGhyb3cgdmFsdWU7CiAgICBpZiAoaW5uZXJFcnJvcikKICAgICAgdGhyb3cgaW5uZXJSZXN1bHQ7CiAgICBhbk9iamVjdCRiKGlubmVyUmVzdWx0KTsKICAgIHJldHVybiB2YWx1ZTsKICB9OwogIHZhciBhbk9iamVjdCRhID0gYW5PYmplY3QkaTsKICB2YXIgaXRlcmF0b3JDbG9zZSQxID0gaXRlcmF0b3JDbG9zZSQyOwogIHZhciBjYWxsV2l0aFNhZmVJdGVyYXRpb25DbG9zaW5nJDEgPSBmdW5jdGlvbihpdGVyYXRvcjIsIGZuLCB2YWx1ZSwgRU5UUklFUzIpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiBFTlRSSUVTMiA/IGZuKGFuT2JqZWN0JGEodmFsdWUpWzBdLCB2YWx1ZVsxXSkgOiBmbih2YWx1ZSk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBpdGVyYXRvckNsb3NlJDEoaXRlcmF0b3IyLCAidGhyb3ciLCBlcnJvcik7CiAgICB9CiAgfTsKICB2YXIgd2VsbEtub3duU3ltYm9sJDcgPSB3ZWxsS25vd25TeW1ib2wkbDsKICB2YXIgSXRlcmF0b3JzID0gaXRlcmF0b3JzOwogIHZhciBJVEVSQVRPUiQyID0gd2VsbEtub3duU3ltYm9sJDcoIml0ZXJhdG9yIik7CiAgdmFyIEFycmF5UHJvdG90eXBlJDggPSBBcnJheS5wcm90b3R5cGU7CiAgdmFyIGlzQXJyYXlJdGVyYXRvck1ldGhvZCQyID0gZnVuY3Rpb24oaXQpIHsKICAgIHJldHVybiBpdCAhPT0gdm9pZCAwICYmIChJdGVyYXRvcnMuQXJyYXkgPT09IGl0IHx8IEFycmF5UHJvdG90eXBlJDhbSVRFUkFUT1IkMl0gPT09IGl0KTsKICB9OwogIHZhciBiaW5kJGEgPSBmdW5jdGlvbkJpbmRDb250ZXh0OwogIHZhciB0b09iamVjdCQ1ID0gdG9PYmplY3QkYjsKICB2YXIgY2FsbFdpdGhTYWZlSXRlcmF0aW9uQ2xvc2luZyA9IGNhbGxXaXRoU2FmZUl0ZXJhdGlvbkNsb3NpbmckMTsKICB2YXIgaXNBcnJheUl0ZXJhdG9yTWV0aG9kJDEgPSBpc0FycmF5SXRlcmF0b3JNZXRob2QkMjsKICB2YXIgaXNDb25zdHJ1Y3RvciQyID0gaXNDb25zdHJ1Y3RvciQ0OwogIHZhciB0b0xlbmd0aCQ1ID0gdG9MZW5ndGgkOTsKICB2YXIgY3JlYXRlUHJvcGVydHkkMiA9IGNyZWF0ZVByb3BlcnR5JDQ7CiAgdmFyIGdldEl0ZXJhdG9yJDEgPSBnZXRJdGVyYXRvciQ2OwogIHZhciBnZXRJdGVyYXRvck1ldGhvZCQxID0gZ2V0SXRlcmF0b3JNZXRob2QkNzsKICB2YXIgYXJyYXlGcm9tID0gZnVuY3Rpb24gZnJvbTIoYXJyYXlMaWtlKSB7CiAgICB2YXIgTyA9IHRvT2JqZWN0JDUoYXJyYXlMaWtlKTsKICAgIHZhciBJU19DT05TVFJVQ1RPUiA9IGlzQ29uc3RydWN0b3IkMih0aGlzKTsKICAgIHZhciBhcmd1bWVudHNMZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwogICAgdmFyIG1hcGZuID0gYXJndW1lbnRzTGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHZvaWQgMDsKICAgIHZhciBtYXBwaW5nID0gbWFwZm4gIT09IHZvaWQgMDsKICAgIGlmIChtYXBwaW5nKQogICAgICBtYXBmbiA9IGJpbmQkYShtYXBmbiwgYXJndW1lbnRzTGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHZvaWQgMCwgMik7CiAgICB2YXIgaXRlcmF0b3JNZXRob2QgPSBnZXRJdGVyYXRvck1ldGhvZCQxKE8pOwogICAgdmFyIGluZGV4ID0gMDsKICAgIHZhciBsZW5ndGgsIHJlc3VsdCwgc3RlcCwgaXRlcmF0b3IyLCBuZXh0LCB2YWx1ZTsKICAgIGlmIChpdGVyYXRvck1ldGhvZCAmJiAhKHRoaXMgPT0gQXJyYXkgJiYgaXNBcnJheUl0ZXJhdG9yTWV0aG9kJDEoaXRlcmF0b3JNZXRob2QpKSkgewogICAgICBpdGVyYXRvcjIgPSBnZXRJdGVyYXRvciQxKE8sIGl0ZXJhdG9yTWV0aG9kKTsKICAgICAgbmV4dCA9IGl0ZXJhdG9yMi5uZXh0OwogICAgICByZXN1bHQgPSBJU19DT05TVFJVQ1RPUiA/IG5ldyB0aGlzKCkgOiBbXTsKICAgICAgZm9yICg7ICEoc3RlcCA9IG5leHQuY2FsbChpdGVyYXRvcjIpKS5kb25lOyBpbmRleCsrKSB7CiAgICAgICAgdmFsdWUgPSBtYXBwaW5nID8gY2FsbFdpdGhTYWZlSXRlcmF0aW9uQ2xvc2luZyhpdGVyYXRvcjIsIG1hcGZuLCBbc3RlcC52YWx1ZSwgaW5kZXhdLCB0cnVlKSA6IHN0ZXAudmFsdWU7CiAgICAgICAgY3JlYXRlUHJvcGVydHkkMihyZXN1bHQsIGluZGV4LCB2YWx1ZSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGxlbmd0aCA9IHRvTGVuZ3RoJDUoTy5sZW5ndGgpOwogICAgICByZXN1bHQgPSBJU19DT05TVFJVQ1RPUiA/IG5ldyB0aGlzKGxlbmd0aCkgOiBBcnJheShsZW5ndGgpOwogICAgICBmb3IgKDsgbGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIHsKICAgICAgICB2YWx1ZSA9IG1hcHBpbmcgPyBtYXBmbihPW2luZGV4XSwgaW5kZXgpIDogT1tpbmRleF07CiAgICAgICAgY3JlYXRlUHJvcGVydHkkMihyZXN1bHQsIGluZGV4LCB2YWx1ZSk7CiAgICAgIH0KICAgIH0KICAgIHJlc3VsdC5sZW5ndGggPSBpbmRleDsKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKICB2YXIgd2VsbEtub3duU3ltYm9sJDYgPSB3ZWxsS25vd25TeW1ib2wkbDsKICB2YXIgSVRFUkFUT1IkMSA9IHdlbGxLbm93blN5bWJvbCQ2KCJpdGVyYXRvciIpOwogIHZhciBTQUZFX0NMT1NJTkcgPSBmYWxzZTsKICB0cnkgewogICAgdmFyIGNhbGxlZCA9IDA7CiAgICB2YXIgaXRlcmF0b3JXaXRoUmV0dXJuID0gewogICAgICBuZXh0OiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4geyBkb25lOiAhIWNhbGxlZCsrIH07CiAgICAgIH0sCiAgICAgICJyZXR1cm4iOiBmdW5jdGlvbigpIHsKICAgICAgICBTQUZFX0NMT1NJTkcgPSB0cnVlOwogICAgICB9CiAgICB9OwogICAgaXRlcmF0b3JXaXRoUmV0dXJuW0lURVJBVE9SJDFdID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIEFycmF5LmZyb20oaXRlcmF0b3JXaXRoUmV0dXJuLCBmdW5jdGlvbigpIHsKICAgICAgdGhyb3cgMjsKICAgIH0pOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgfQogIHZhciBjaGVja0NvcnJlY3RuZXNzT2ZJdGVyYXRpb24kMiA9IGZ1bmN0aW9uKGV4ZWMyLCBTS0lQX0NMT1NJTkcpIHsKICAgIGlmICghU0tJUF9DTE9TSU5HICYmICFTQUZFX0NMT1NJTkcpCiAgICAgIHJldHVybiBmYWxzZTsKICAgIHZhciBJVEVSQVRJT05fU1VQUE9SVCA9IGZhbHNlOwogICAgdHJ5IHsKICAgICAgdmFyIG9iamVjdCA9IHt9OwogICAgICBvYmplY3RbSVRFUkFUT1IkMV0gPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgbmV4dDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB7IGRvbmU6IElURVJBVElPTl9TVVBQT1JUID0gdHJ1ZSB9OwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH07CiAgICAgIGV4ZWMyKG9iamVjdCk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgfQogICAgcmV0dXJuIElURVJBVElPTl9TVVBQT1JUOwogIH07CiAgdmFyICQkQSA9IF9leHBvcnQ7CiAgdmFyIGZyb20kNiA9IGFycmF5RnJvbTsKICB2YXIgY2hlY2tDb3JyZWN0bmVzc09mSXRlcmF0aW9uJDEgPSBjaGVja0NvcnJlY3RuZXNzT2ZJdGVyYXRpb24kMjsKICB2YXIgSU5DT1JSRUNUX0lURVJBVElPTiQxID0gIWNoZWNrQ29ycmVjdG5lc3NPZkl0ZXJhdGlvbiQxKGZ1bmN0aW9uKGl0ZXJhYmxlKSB7CiAgICBBcnJheS5mcm9tKGl0ZXJhYmxlKTsKICB9KTsKICAkJEEoeyB0YXJnZXQ6ICJBcnJheSIsIHN0YXQ6IHRydWUsIGZvcmNlZDogSU5DT1JSRUNUX0lURVJBVElPTiQxIH0sIHsKICAgIGZyb206IGZyb20kNgogIH0pOwogIHZhciBwYXRoJGcgPSBwYXRoJG47CiAgdmFyIGZyb20kNSA9IHBhdGgkZy5BcnJheS5mcm9tOwogIHZhciBwYXJlbnQkSiA9IGZyb20kNTsKICB2YXIgZnJvbSQ0ID0gcGFyZW50JEo7CiAgdmFyIGZyb20kMyA9IGZyb20kNDsKICB2YXIgZGVmaW5lUHJvcGVydGllcyQ0ID0geyBleHBvcnRzOiB7fSB9OwogIHZhciAkJHogPSBfZXhwb3J0OwogIHZhciBERVNDUklQVE9SUyQ2ID0gZGVzY3JpcHRvcnM7CiAgdmFyIGRlZmluZVByb3BlcnRpZXMkMyA9IG9iamVjdERlZmluZVByb3BlcnRpZXM7CiAgJCR6KHsgdGFyZ2V0OiAiT2JqZWN0Iiwgc3RhdDogdHJ1ZSwgZm9yY2VkOiAhREVTQ1JJUFRPUlMkNiwgc2hhbTogIURFU0NSSVBUT1JTJDYgfSwgewogICAgZGVmaW5lUHJvcGVydGllczogZGVmaW5lUHJvcGVydGllcyQzCiAgfSk7CiAgdmFyIHBhdGgkZiA9IHBhdGgkbjsKICB2YXIgT2JqZWN0JDMgPSBwYXRoJGYuT2JqZWN0OwogIHZhciBkZWZpbmVQcm9wZXJ0aWVzJDIgPSBkZWZpbmVQcm9wZXJ0aWVzJDQuZXhwb3J0cyA9IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXMyKFQsIEQpIHsKICAgIHJldHVybiBPYmplY3QkMy5kZWZpbmVQcm9wZXJ0aWVzKFQsIEQpOwogIH07CiAgaWYgKE9iamVjdCQzLmRlZmluZVByb3BlcnRpZXMuc2hhbSkKICAgIGRlZmluZVByb3BlcnRpZXMkMi5zaGFtID0gdHJ1ZTsKICB2YXIgcGFyZW50JEkgPSBkZWZpbmVQcm9wZXJ0aWVzJDQuZXhwb3J0czsKICB2YXIgZGVmaW5lUHJvcGVydGllcyQxID0gcGFyZW50JEk7CiAgdmFyIGRlZmluZVByb3BlcnRpZXMgPSBkZWZpbmVQcm9wZXJ0aWVzJDE7CiAgdmFyIGdldEJ1aWx0SW4kNSA9IGdldEJ1aWx0SW4kYjsKICB2YXIgZ2V0T3duUHJvcGVydHlOYW1lc01vZHVsZSQxID0gb2JqZWN0R2V0T3duUHJvcGVydHlOYW1lczsKICB2YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzTW9kdWxlJDEgPSBvYmplY3RHZXRPd25Qcm9wZXJ0eVN5bWJvbHM7CiAgdmFyIGFuT2JqZWN0JDkgPSBhbk9iamVjdCRpOwogIHZhciBvd25LZXlzJDIgPSBnZXRCdWlsdEluJDUoIlJlZmxlY3QiLCAib3duS2V5cyIpIHx8IGZ1bmN0aW9uIG93bktleXMyKGl0KSB7CiAgICB2YXIga2V5czIgPSBnZXRPd25Qcm9wZXJ0eU5hbWVzTW9kdWxlJDEuZihhbk9iamVjdCQ5KGl0KSk7CiAgICB2YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzMiA9IGdldE93blByb3BlcnR5U3ltYm9sc01vZHVsZSQxLmY7CiAgICByZXR1cm4gZ2V0T3duUHJvcGVydHlTeW1ib2xzMiA/IGtleXMyLmNvbmNhdChnZXRPd25Qcm9wZXJ0eVN5bWJvbHMyKGl0KSkgOiBrZXlzMjsKICB9OwogIHZhciAkJHkgPSBfZXhwb3J0OwogIHZhciBERVNDUklQVE9SUyQ1ID0gZGVzY3JpcHRvcnM7CiAgdmFyIG93bktleXMkMSA9IG93bktleXMkMjsKICB2YXIgdG9JbmRleGVkT2JqZWN0JDIgPSB0b0luZGV4ZWRPYmplY3QkOTsKICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yTW9kdWxlID0gb2JqZWN0R2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwogIHZhciBjcmVhdGVQcm9wZXJ0eSQxID0gY3JlYXRlUHJvcGVydHkkNDsKICAkJHkoeyB0YXJnZXQ6ICJPYmplY3QiLCBzdGF0OiB0cnVlLCBzaGFtOiAhREVTQ1JJUFRPUlMkNSB9LCB7CiAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzMihvYmplY3QpIHsKICAgICAgdmFyIE8gPSB0b0luZGV4ZWRPYmplY3QkMihvYmplY3QpOwogICAgICB2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yMiA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvck1vZHVsZS5mOwogICAgICB2YXIga2V5czIgPSBvd25LZXlzJDEoTyk7CiAgICAgIHZhciByZXN1bHQgPSB7fTsKICAgICAgdmFyIGluZGV4ID0gMDsKICAgICAgdmFyIGtleSwgZGVzY3JpcHRvcjsKICAgICAgd2hpbGUgKGtleXMyLmxlbmd0aCA+IGluZGV4KSB7CiAgICAgICAgZGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcjIoTywga2V5ID0ga2V5czJbaW5kZXgrK10pOwogICAgICAgIGlmIChkZXNjcmlwdG9yICE9PSB2b2lkIDApCiAgICAgICAgICBjcmVhdGVQcm9wZXJ0eSQxKHJlc3VsdCwga2V5LCBkZXNjcmlwdG9yKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH0pOwogIHZhciBwYXRoJGUgPSBwYXRoJG47CiAgdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnMkMiA9IHBhdGgkZS5PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczsKICB2YXIgcGFyZW50JEggPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzJDI7CiAgdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnMkMSA9IHBhcmVudCRIOwogIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyQxOwogIHZhciBmYWlscyRiID0gZmFpbHMkbjsKICB2YXIgYXJyYXlNZXRob2RJc1N0cmljdCQ0ID0gZnVuY3Rpb24oTUVUSE9EX05BTUUsIGFyZ3VtZW50KSB7CiAgICB2YXIgbWV0aG9kID0gW11bTUVUSE9EX05BTUVdOwogICAgcmV0dXJuICEhbWV0aG9kICYmIGZhaWxzJGIoZnVuY3Rpb24oKSB7CiAgICAgIG1ldGhvZC5jYWxsKG51bGwsIGFyZ3VtZW50IHx8IGZ1bmN0aW9uKCkgewogICAgICAgIHRocm93IDE7CiAgICAgIH0sIDEpOwogICAgfSk7CiAgfTsKICB2YXIgJGZvckVhY2ggPSBhcnJheUl0ZXJhdGlvbi5mb3JFYWNoOwogIHZhciBhcnJheU1ldGhvZElzU3RyaWN0JDMgPSBhcnJheU1ldGhvZElzU3RyaWN0JDQ7CiAgdmFyIFNUUklDVF9NRVRIT0QkMyA9IGFycmF5TWV0aG9kSXNTdHJpY3QkMygiZm9yRWFjaCIpOwogIHZhciBhcnJheUZvckVhY2ggPSAhU1RSSUNUX01FVEhPRCQzID8gZnVuY3Rpb24gZm9yRWFjaDIoY2FsbGJhY2tmbikgewogICAgcmV0dXJuICRmb3JFYWNoKHRoaXMsIGNhbGxiYWNrZm4sIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdm9pZCAwKTsKICB9IDogW10uZm9yRWFjaDsKICB2YXIgJCR4ID0gX2V4cG9ydDsKICB2YXIgZm9yRWFjaCQ1ID0gYXJyYXlGb3JFYWNoOwogICQkeCh7IHRhcmdldDogIkFycmF5IiwgcHJvdG86IHRydWUsIGZvcmNlZDogW10uZm9yRWFjaCAhPSBmb3JFYWNoJDUgfSwgewogICAgZm9yRWFjaDogZm9yRWFjaCQ1CiAgfSk7CiAgdmFyIHBhdGgkZCA9IHBhdGgkbjsKICB2YXIgZW50cnlWaXJ0dWFsJGEgPSBmdW5jdGlvbihDT05TVFJVQ1RPUikgewogICAgcmV0dXJuIHBhdGgkZFtDT05TVFJVQ1RPUiArICJQcm90b3R5cGUiXTsKICB9OwogIHZhciBlbnRyeVZpcnR1YWwkOSA9IGVudHJ5VmlydHVhbCRhOwogIHZhciBmb3JFYWNoJDQgPSBlbnRyeVZpcnR1YWwkOSgiQXJyYXkiKS5mb3JFYWNoOwogIHZhciBwYXJlbnQkRyA9IGZvckVhY2gkNDsKICB2YXIgZm9yRWFjaCQzID0gcGFyZW50JEc7CiAgdmFyIGZvckVhY2gkMiA9IGZvckVhY2gkMzsKICB2YXIgY2xhc3NvZiQyID0gY2xhc3NvZiQ5OwogIHZhciBBcnJheVByb3RvdHlwZSQ3ID0gQXJyYXkucHJvdG90eXBlOwogIHZhciBET01JdGVyYWJsZXMgPSB7CiAgICBET01Ub2tlbkxpc3Q6IHRydWUsCiAgICBOb2RlTGlzdDogdHJ1ZQogIH07CiAgdmFyIGZvckVhY2hfMSA9IGZ1bmN0aW9uKGl0KSB7CiAgICB2YXIgb3duID0gaXQuZm9yRWFjaDsKICAgIHJldHVybiBpdCA9PT0gQXJyYXlQcm90b3R5cGUkNyB8fCBpdCBpbnN0YW5jZW9mIEFycmF5ICYmIG93biA9PT0gQXJyYXlQcm90b3R5cGUkNy5mb3JFYWNoIHx8IERPTUl0ZXJhYmxlcy5oYXNPd25Qcm9wZXJ0eShjbGFzc29mJDIoaXQpKSA/IGZvckVhY2gkMiA6IG93bjsKICB9OwogIHZhciBmb3JFYWNoJDEgPSBmb3JFYWNoXzE7CiAgdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvciQ2ID0geyBleHBvcnRzOiB7fSB9OwogIHZhciAkJHcgPSBfZXhwb3J0OwogIHZhciBmYWlscyRhID0gZmFpbHMkbjsKICB2YXIgdG9JbmRleGVkT2JqZWN0JDEgPSB0b0luZGV4ZWRPYmplY3QkOTsKICB2YXIgbmF0aXZlR2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gb2JqZWN0R2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLmY7CiAgdmFyIERFU0NSSVBUT1JTJDQgPSBkZXNjcmlwdG9yczsKICB2YXIgRkFJTFNfT05fUFJJTUlUSVZFUyQyID0gZmFpbHMkYShmdW5jdGlvbigpIHsKICAgIG5hdGl2ZUdldE93blByb3BlcnR5RGVzY3JpcHRvcigxKTsKICB9KTsKICB2YXIgRk9SQ0VEJDQgPSAhREVTQ1JJUFRPUlMkNCB8fCBGQUlMU19PTl9QUklNSVRJVkVTJDI7CiAgJCR3KHsgdGFyZ2V0OiAiT2JqZWN0Iiwgc3RhdDogdHJ1ZSwgZm9yY2VkOiBGT1JDRUQkNCwgc2hhbTogIURFU0NSSVBUT1JTJDQgfSwgewogICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IyKGl0LCBrZXkpIHsKICAgICAgcmV0dXJuIG5hdGl2ZUdldE93blByb3BlcnR5RGVzY3JpcHRvcih0b0luZGV4ZWRPYmplY3QkMShpdCksIGtleSk7CiAgICB9CiAgfSk7CiAgdmFyIHBhdGgkYyA9IHBhdGgkbjsKICB2YXIgT2JqZWN0JDIgPSBwYXRoJGMuT2JqZWN0OwogIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkNSA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvciQ2LmV4cG9ydHMgPSBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IyKGl0LCBrZXkpIHsKICAgIHJldHVybiBPYmplY3QkMi5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoaXQsIGtleSk7CiAgfTsKICBpZiAoT2JqZWN0JDIuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLnNoYW0pCiAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkNS5zaGFtID0gdHJ1ZTsKICB2YXIgcGFyZW50JEYgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkNi5leHBvcnRzOwogIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkNCA9IHBhcmVudCRGOwogIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMyA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvciQ0OwogIHZhciAkJHYgPSBfZXhwb3J0OwogIHZhciAkZmlsdGVyID0gYXJyYXlJdGVyYXRpb24uZmlsdGVyOwogIHZhciBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0JDIgPSBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0JDQ7CiAgdmFyIEhBU19TUEVDSUVTX1NVUFBPUlQkMiA9IGFycmF5TWV0aG9kSGFzU3BlY2llc1N1cHBvcnQkMigiZmlsdGVyIik7CiAgJCR2KHsgdGFyZ2V0OiAiQXJyYXkiLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiAhSEFTX1NQRUNJRVNfU1VQUE9SVCQyIH0sIHsKICAgIGZpbHRlcjogZnVuY3Rpb24gZmlsdGVyMihjYWxsYmFja2ZuKSB7CiAgICAgIHJldHVybiAkZmlsdGVyKHRoaXMsIGNhbGxiYWNrZm4sIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdm9pZCAwKTsKICAgIH0KICB9KTsKICB2YXIgZW50cnlWaXJ0dWFsJDggPSBlbnRyeVZpcnR1YWwkYTsKICB2YXIgZmlsdGVyJDMgPSBlbnRyeVZpcnR1YWwkOCgiQXJyYXkiKS5maWx0ZXI7CiAgdmFyIGZpbHRlciQyID0gZmlsdGVyJDM7CiAgdmFyIEFycmF5UHJvdG90eXBlJDYgPSBBcnJheS5wcm90b3R5cGU7CiAgdmFyIGZpbHRlcl8xID0gZnVuY3Rpb24oaXQpIHsKICAgIHZhciBvd24gPSBpdC5maWx0ZXI7CiAgICByZXR1cm4gaXQgPT09IEFycmF5UHJvdG90eXBlJDYgfHwgaXQgaW5zdGFuY2VvZiBBcnJheSAmJiBvd24gPT09IEFycmF5UHJvdG90eXBlJDYuZmlsdGVyID8gZmlsdGVyJDIgOiBvd247CiAgfTsKICB2YXIgcGFyZW50JEUgPSBmaWx0ZXJfMTsKICB2YXIgZmlsdGVyJDEgPSBwYXJlbnQkRTsKICB2YXIgZmlsdGVyID0gZmlsdGVyJDE7CiAgdmFyIHBhdGgkYiA9IHBhdGgkbjsKICB2YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzJDQgPSBwYXRoJGIuT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sczsKICB2YXIgcGFyZW50JEQgPSBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMkNDsKICB2YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzJDMgPSBwYXJlbnQkRDsKICB2YXIgZ2V0T3duUHJvcGVydHlTeW1ib2xzJDIgPSBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMkMzsKICB2YXIgJCR1ID0gX2V4cG9ydDsKICB2YXIgdG9PYmplY3QkNCA9IHRvT2JqZWN0JGI7CiAgdmFyIG5hdGl2ZUtleXMgPSBvYmplY3RLZXlzJDM7CiAgdmFyIGZhaWxzJDkgPSBmYWlscyRuOwogIHZhciBGQUlMU19PTl9QUklNSVRJVkVTJDEgPSBmYWlscyQ5KGZ1bmN0aW9uKCkgewogICAgbmF0aXZlS2V5cygxKTsKICB9KTsKICAkJHUoeyB0YXJnZXQ6ICJPYmplY3QiLCBzdGF0OiB0cnVlLCBmb3JjZWQ6IEZBSUxTX09OX1BSSU1JVElWRVMkMSB9LCB7CiAgICBrZXlzOiBmdW5jdGlvbiBrZXlzMihpdCkgewogICAgICByZXR1cm4gbmF0aXZlS2V5cyh0b09iamVjdCQ0KGl0KSk7CiAgICB9CiAgfSk7CiAgdmFyIHBhdGgkYSA9IHBhdGgkbjsKICB2YXIga2V5cyQ0ID0gcGF0aCRhLk9iamVjdC5rZXlzOwogIHZhciBwYXJlbnQkQyA9IGtleXMkNDsKICB2YXIga2V5cyQzID0gcGFyZW50JEM7CiAgdmFyIGtleXMkMiA9IGtleXMkMzsKICB2YXIgaXNDb25zdHJ1Y3RvciQxID0gaXNDb25zdHJ1Y3RvciQ0OwogIHZhciB0cnlUb1N0cmluZyA9IHRyeVRvU3RyaW5nJDI7CiAgdmFyIGFDb25zdHJ1Y3RvciQzID0gZnVuY3Rpb24oYXJndW1lbnQpIHsKICAgIGlmIChpc0NvbnN0cnVjdG9yJDEoYXJndW1lbnQpKQogICAgICByZXR1cm4gYXJndW1lbnQ7CiAgICB0aHJvdyBUeXBlRXJyb3IodHJ5VG9TdHJpbmcoYXJndW1lbnQpICsgIiBpcyBub3QgYSBjb25zdHJ1Y3RvciIpOwogIH07CiAgdmFyIGFDYWxsYWJsZSQ4ID0gYUNhbGxhYmxlJGM7CiAgdmFyIGlzT2JqZWN0JDkgPSBpc09iamVjdCRpOwogIHZhciBzbGljZSQ3ID0gW10uc2xpY2U7CiAgdmFyIGZhY3RvcmllcyA9IHt9OwogIHZhciBjb25zdHJ1Y3QkMyA9IGZ1bmN0aW9uKEMsIGFyZ3NMZW5ndGgsIGFyZ3MpIHsKICAgIGlmICghKGFyZ3NMZW5ndGggaW4gZmFjdG9yaWVzKSkgewogICAgICBmb3IgKHZhciBsaXN0ID0gW10sIGkyID0gMDsgaTIgPCBhcmdzTGVuZ3RoOyBpMisrKQogICAgICAgIGxpc3RbaTJdID0gImFbIiArIGkyICsgIl0iOwogICAgICBmYWN0b3JpZXNbYXJnc0xlbmd0aF0gPSBGdW5jdGlvbigiQyxhIiwgInJldHVybiBuZXcgQygiICsgbGlzdC5qb2luKCIsIikgKyAiKSIpOwogICAgfQogICAgcmV0dXJuIGZhY3Rvcmllc1thcmdzTGVuZ3RoXShDLCBhcmdzKTsKICB9OwogIHZhciBmdW5jdGlvbkJpbmQgPSBGdW5jdGlvbi5iaW5kIHx8IGZ1bmN0aW9uIGJpbmQyKHRoYXQpIHsKICAgIHZhciBmbiA9IGFDYWxsYWJsZSQ4KHRoaXMpOwogICAgdmFyIHBhcnRBcmdzID0gc2xpY2UkNy5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICB2YXIgYm91bmRGdW5jdGlvbiA9IGZ1bmN0aW9uIGJvdW5kKCkgewogICAgICB2YXIgYXJncyA9IHBhcnRBcmdzLmNvbmNhdChzbGljZSQ3LmNhbGwoYXJndW1lbnRzKSk7CiAgICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgYm91bmRGdW5jdGlvbiA/IGNvbnN0cnVjdCQzKGZuLCBhcmdzLmxlbmd0aCwgYXJncykgOiBmbi5hcHBseSh0aGF0LCBhcmdzKTsKICAgIH07CiAgICBpZiAoaXNPYmplY3QkOShmbi5wcm90b3R5cGUpKQogICAgICBib3VuZEZ1bmN0aW9uLnByb3RvdHlwZSA9IGZuLnByb3RvdHlwZTsKICAgIHJldHVybiBib3VuZEZ1bmN0aW9uOwogIH07CiAgdmFyICQkdCA9IF9leHBvcnQ7CiAgdmFyIGdldEJ1aWx0SW4kNCA9IGdldEJ1aWx0SW4kYjsKICB2YXIgYUNvbnN0cnVjdG9yJDIgPSBhQ29uc3RydWN0b3IkMzsKICB2YXIgYW5PYmplY3QkOCA9IGFuT2JqZWN0JGk7CiAgdmFyIGlzT2JqZWN0JDggPSBpc09iamVjdCRpOwogIHZhciBjcmVhdGUkNiA9IG9iamVjdENyZWF0ZTsKICB2YXIgYmluZCQ5ID0gZnVuY3Rpb25CaW5kOwogIHZhciBmYWlscyQ4ID0gZmFpbHMkbjsKICB2YXIgbmF0aXZlQ29uc3RydWN0ID0gZ2V0QnVpbHRJbiQ0KCJSZWZsZWN0IiwgImNvbnN0cnVjdCIpOwogIHZhciBORVdfVEFSR0VUX0JVRyA9IGZhaWxzJDgoZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBGKCkgewogICAgfQogICAgcmV0dXJuICEobmF0aXZlQ29uc3RydWN0KGZ1bmN0aW9uKCkgewogICAgfSwgW10sIEYpIGluc3RhbmNlb2YgRik7CiAgfSk7CiAgdmFyIEFSR1NfQlVHID0gIWZhaWxzJDgoZnVuY3Rpb24oKSB7CiAgICBuYXRpdmVDb25zdHJ1Y3QoZnVuY3Rpb24oKSB7CiAgICB9KTsKICB9KTsKICB2YXIgRk9SQ0VEJDMgPSBORVdfVEFSR0VUX0JVRyB8fCBBUkdTX0JVRzsKICAkJHQoeyB0YXJnZXQ6ICJSZWZsZWN0Iiwgc3RhdDogdHJ1ZSwgZm9yY2VkOiBGT1JDRUQkMywgc2hhbTogRk9SQ0VEJDMgfSwgewogICAgY29uc3RydWN0OiBmdW5jdGlvbiBjb25zdHJ1Y3QyKFRhcmdldCwgYXJncykgewogICAgICBhQ29uc3RydWN0b3IkMihUYXJnZXQpOwogICAgICBhbk9iamVjdCQ4KGFyZ3MpOwogICAgICB2YXIgbmV3VGFyZ2V0ID0gYXJndW1lbnRzLmxlbmd0aCA8IDMgPyBUYXJnZXQgOiBhQ29uc3RydWN0b3IkMihhcmd1bWVudHNbMl0pOwogICAgICBpZiAoQVJHU19CVUcgJiYgIU5FV19UQVJHRVRfQlVHKQogICAgICAgIHJldHVybiBuYXRpdmVDb25zdHJ1Y3QoVGFyZ2V0LCBhcmdzLCBuZXdUYXJnZXQpOwogICAgICBpZiAoVGFyZ2V0ID09IG5ld1RhcmdldCkgewogICAgICAgIHN3aXRjaCAoYXJncy5sZW5ndGgpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgcmV0dXJuIG5ldyBUYXJnZXQoKTsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgcmV0dXJuIG5ldyBUYXJnZXQoYXJnc1swXSk7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBuZXcgVGFyZ2V0KGFyZ3NbMF0sIGFyZ3NbMV0pOwogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICByZXR1cm4gbmV3IFRhcmdldChhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKTsKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgcmV0dXJuIG5ldyBUYXJnZXQoYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSwgYXJnc1szXSk7CiAgICAgICAgfQogICAgICAgIHZhciAkYXJncyA9IFtudWxsXTsKICAgICAgICAkYXJncy5wdXNoLmFwcGx5KCRhcmdzLCBhcmdzKTsKICAgICAgICByZXR1cm4gbmV3IChiaW5kJDkuYXBwbHkoVGFyZ2V0LCAkYXJncykpKCk7CiAgICAgIH0KICAgICAgdmFyIHByb3RvID0gbmV3VGFyZ2V0LnByb3RvdHlwZTsKICAgICAgdmFyIGluc3RhbmNlID0gY3JlYXRlJDYoaXNPYmplY3QkOChwcm90bykgPyBwcm90byA6IE9iamVjdC5wcm90b3R5cGUpOwogICAgICB2YXIgcmVzdWx0ID0gRnVuY3Rpb24uYXBwbHkuY2FsbChUYXJnZXQsIGluc3RhbmNlLCBhcmdzKTsKICAgICAgcmV0dXJuIGlzT2JqZWN0JDgocmVzdWx0KSA/IHJlc3VsdCA6IGluc3RhbmNlOwogICAgfQogIH0pOwogIHZhciBwYXRoJDkgPSBwYXRoJG47CiAgdmFyIGNvbnN0cnVjdCQyID0gcGF0aCQ5LlJlZmxlY3QuY29uc3RydWN0OwogIHZhciBwYXJlbnQkQiA9IGNvbnN0cnVjdCQyOwogIHZhciBjb25zdHJ1Y3QkMSA9IHBhcmVudCRCOwogIHZhciBjb25zdHJ1Y3QgPSBjb25zdHJ1Y3QkMTsKICB2YXIgc2xpY2VkVG9BcnJheSQxID0geyBleHBvcnRzOiB7fSB9OwogIHZhciBhcnJheVdpdGhIb2xlcyQxID0geyBleHBvcnRzOiB7fSB9OwogIHZhciBwYXJlbnQkQSA9IGlzQXJyYXkkNzsKICB2YXIgaXNBcnJheSQyID0gcGFyZW50JEE7CiAgdmFyIGlzQXJyYXkkMSA9IGlzQXJyYXkkMjsKICAoZnVuY3Rpb24obW9kdWxlKSB7CiAgICB2YXIgX0FycmF5JGlzQXJyYXkgPSBpc0FycmF5JDE7CiAgICBmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7CiAgICAgIGlmIChfQXJyYXkkaXNBcnJheShhcnIpKQogICAgICAgIHJldHVybiBhcnI7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF9hcnJheVdpdGhIb2xlczsKICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSkoYXJyYXlXaXRoSG9sZXMkMSk7CiAgdmFyIGl0ZXJhYmxlVG9BcnJheUxpbWl0JDEgPSB7IGV4cG9ydHM6IHt9IH07CiAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCQ2ID0gZGVmaW5lV2VsbEtub3duU3ltYm9sJGw7CiAgZGVmaW5lV2VsbEtub3duU3ltYm9sJDYoImFzeW5jRGlzcG9zZSIpOwogIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wkNSA9IGRlZmluZVdlbGxLbm93blN5bWJvbCRsOwogIGRlZmluZVdlbGxLbm93blN5bWJvbCQ1KCJkaXNwb3NlIik7CiAgdmFyIGRlZmluZVdlbGxLbm93blN5bWJvbCQ0ID0gZGVmaW5lV2VsbEtub3duU3ltYm9sJGw7CiAgZGVmaW5lV2VsbEtub3duU3ltYm9sJDQoIm1hdGNoZXIiKTsKICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sJDMgPSBkZWZpbmVXZWxsS25vd25TeW1ib2wkbDsKICBkZWZpbmVXZWxsS25vd25TeW1ib2wkMygibWV0YWRhdGEiKTsKICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sJDIgPSBkZWZpbmVXZWxsS25vd25TeW1ib2wkbDsKICBkZWZpbmVXZWxsS25vd25TeW1ib2wkMigib2JzZXJ2YWJsZSIpOwogIHZhciBkZWZpbmVXZWxsS25vd25TeW1ib2wkMSA9IGRlZmluZVdlbGxLbm93blN5bWJvbCRsOwogIGRlZmluZVdlbGxLbm93blN5bWJvbCQxKCJwYXR0ZXJuTWF0Y2giKTsKICB2YXIgZGVmaW5lV2VsbEtub3duU3ltYm9sID0gZGVmaW5lV2VsbEtub3duU3ltYm9sJGw7CiAgZGVmaW5lV2VsbEtub3duU3ltYm9sKCJyZXBsYWNlQWxsIik7CiAgdmFyIHBhcmVudCR6ID0gc3ltYm9sJDM7CiAgdmFyIHN5bWJvbCQxID0gcGFyZW50JHo7CiAgdmFyIHN5bWJvbCA9IHN5bWJvbCQxOwogIChmdW5jdGlvbihtb2R1bGUpIHsKICAgIHZhciBfU3ltYm9sID0gc3ltYm9sOwogICAgdmFyIF9nZXRJdGVyYXRvck1ldGhvZCA9IGdldEl0ZXJhdG9yTWV0aG9kJDI7CiAgICBmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpMikgewogICAgICB2YXIgX2kgPSBhcnIgPT0gbnVsbCA/IG51bGwgOiB0eXBlb2YgX1N5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgX2dldEl0ZXJhdG9yTWV0aG9kKGFycikgfHwgYXJyWyJAQGl0ZXJhdG9yIl07CiAgICAgIGlmIChfaSA9PSBudWxsKQogICAgICAgIHJldHVybjsKICAgICAgdmFyIF9hcnIgPSBbXTsKICAgICAgdmFyIF9uID0gdHJ1ZTsKICAgICAgdmFyIF9kID0gZmFsc2U7CiAgICAgIHZhciBfcywgX2U7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaSA9IF9pLmNhbGwoYXJyKTsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgewogICAgICAgICAgX2Fyci5wdXNoKF9zLnZhbHVlKTsKICAgICAgICAgIGlmIChpMiAmJiBfYXJyLmxlbmd0aCA9PT0gaTIpCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyMikgewogICAgICAgIF9kID0gdHJ1ZTsKICAgICAgICBfZSA9IGVycjI7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpCiAgICAgICAgICAgIF9pWyJyZXR1cm4iXSgpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBpZiAoX2QpCiAgICAgICAgICAgIHRocm93IF9lOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gX2FycjsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gX2l0ZXJhYmxlVG9BcnJheUxpbWl0OwogICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShpdGVyYWJsZVRvQXJyYXlMaW1pdCQxKTsKICB2YXIgdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkkMSA9IHsgZXhwb3J0czoge30gfTsKICB2YXIgJCRzID0gX2V4cG9ydDsKICB2YXIgaXNBcnJheSA9IGlzQXJyYXkkYTsKICB2YXIgaXNDb25zdHJ1Y3RvciA9IGlzQ29uc3RydWN0b3IkNDsKICB2YXIgaXNPYmplY3QkNyA9IGlzT2JqZWN0JGk7CiAgdmFyIHRvQWJzb2x1dGVJbmRleCA9IHRvQWJzb2x1dGVJbmRleCQyOwogIHZhciB0b0xlbmd0aCQ0ID0gdG9MZW5ndGgkOTsKICB2YXIgdG9JbmRleGVkT2JqZWN0ID0gdG9JbmRleGVkT2JqZWN0JDk7CiAgdmFyIGNyZWF0ZVByb3BlcnR5ID0gY3JlYXRlUHJvcGVydHkkNDsKICB2YXIgd2VsbEtub3duU3ltYm9sJDUgPSB3ZWxsS25vd25TeW1ib2wkbDsKICB2YXIgYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCQxID0gYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCQ0OwogIHZhciBIQVNfU1BFQ0lFU19TVVBQT1JUJDEgPSBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0JDEoInNsaWNlIik7CiAgdmFyIFNQRUNJRVMkMyA9IHdlbGxLbm93blN5bWJvbCQ1KCJzcGVjaWVzIik7CiAgdmFyIG5hdGl2ZVNsaWNlID0gW10uc2xpY2U7CiAgdmFyIG1heCA9IE1hdGgubWF4OwogICQkcyh7IHRhcmdldDogIkFycmF5IiwgcHJvdG86IHRydWUsIGZvcmNlZDogIUhBU19TUEVDSUVTX1NVUFBPUlQkMSB9LCB7CiAgICBzbGljZTogZnVuY3Rpb24gc2xpY2UyKHN0YXJ0LCBlbmQpIHsKICAgICAgdmFyIE8gPSB0b0luZGV4ZWRPYmplY3QodGhpcyk7CiAgICAgIHZhciBsZW5ndGggPSB0b0xlbmd0aCQ0KE8ubGVuZ3RoKTsKICAgICAgdmFyIGsgPSB0b0Fic29sdXRlSW5kZXgoc3RhcnQsIGxlbmd0aCk7CiAgICAgIHZhciBmaW4gPSB0b0Fic29sdXRlSW5kZXgoZW5kID09PSB2b2lkIDAgPyBsZW5ndGggOiBlbmQsIGxlbmd0aCk7CiAgICAgIHZhciBDb25zdHJ1Y3RvciwgcmVzdWx0LCBuOwogICAgICBpZiAoaXNBcnJheShPKSkgewogICAgICAgIENvbnN0cnVjdG9yID0gTy5jb25zdHJ1Y3RvcjsKICAgICAgICBpZiAoaXNDb25zdHJ1Y3RvcihDb25zdHJ1Y3RvcikgJiYgKENvbnN0cnVjdG9yID09PSBBcnJheSB8fCBpc0FycmF5KENvbnN0cnVjdG9yLnByb3RvdHlwZSkpKSB7CiAgICAgICAgICBDb25zdHJ1Y3RvciA9IHZvaWQgMDsKICAgICAgICB9IGVsc2UgaWYgKGlzT2JqZWN0JDcoQ29uc3RydWN0b3IpKSB7CiAgICAgICAgICBDb25zdHJ1Y3RvciA9IENvbnN0cnVjdG9yW1NQRUNJRVMkM107CiAgICAgICAgICBpZiAoQ29uc3RydWN0b3IgPT09IG51bGwpCiAgICAgICAgICAgIENvbnN0cnVjdG9yID0gdm9pZCAwOwogICAgICAgIH0KICAgICAgICBpZiAoQ29uc3RydWN0b3IgPT09IEFycmF5IHx8IENvbnN0cnVjdG9yID09PSB2b2lkIDApIHsKICAgICAgICAgIHJldHVybiBuYXRpdmVTbGljZS5jYWxsKE8sIGssIGZpbik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJlc3VsdCA9IG5ldyAoQ29uc3RydWN0b3IgPT09IHZvaWQgMCA/IEFycmF5IDogQ29uc3RydWN0b3IpKG1heChmaW4gLSBrLCAwKSk7CiAgICAgIGZvciAobiA9IDA7IGsgPCBmaW47IGsrKywgbisrKQogICAgICAgIGlmIChrIGluIE8pCiAgICAgICAgICBjcmVhdGVQcm9wZXJ0eShyZXN1bHQsIG4sIE9ba10pOwogICAgICByZXN1bHQubGVuZ3RoID0gbjsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9KTsKICB2YXIgZW50cnlWaXJ0dWFsJDcgPSBlbnRyeVZpcnR1YWwkYTsKICB2YXIgc2xpY2UkNiA9IGVudHJ5VmlydHVhbCQ3KCJBcnJheSIpLnNsaWNlOwogIHZhciBzbGljZSQ1ID0gc2xpY2UkNjsKICB2YXIgQXJyYXlQcm90b3R5cGUkNSA9IEFycmF5LnByb3RvdHlwZTsKICB2YXIgc2xpY2VfMSA9IGZ1bmN0aW9uKGl0KSB7CiAgICB2YXIgb3duID0gaXQuc2xpY2U7CiAgICByZXR1cm4gaXQgPT09IEFycmF5UHJvdG90eXBlJDUgfHwgaXQgaW5zdGFuY2VvZiBBcnJheSAmJiBvd24gPT09IEFycmF5UHJvdG90eXBlJDUuc2xpY2UgPyBzbGljZSQ1IDogb3duOwogIH07CiAgdmFyIHBhcmVudCR5ID0gc2xpY2VfMTsKICB2YXIgc2xpY2UkNCA9IHBhcmVudCR5OwogIHZhciBwYXJlbnQkeCA9IHNsaWNlJDQ7CiAgdmFyIHNsaWNlJDMgPSBwYXJlbnQkeDsKICB2YXIgc2xpY2UkMiA9IHNsaWNlJDM7CiAgdmFyIHBhcmVudCR3ID0gZnJvbSQ0OwogIHZhciBmcm9tJDIgPSBwYXJlbnQkdzsKICB2YXIgZnJvbSQxID0gZnJvbSQyOwogIHZhciBhcnJheUxpa2VUb0FycmF5JDEgPSB7IGV4cG9ydHM6IHt9IH07CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4yKSB7CiAgICAgIGlmIChsZW4yID09IG51bGwgfHwgbGVuMiA+IGFyci5sZW5ndGgpCiAgICAgICAgbGVuMiA9IGFyci5sZW5ndGg7CiAgICAgIGZvciAodmFyIGkyID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4yKTsgaTIgPCBsZW4yOyBpMisrKSB7CiAgICAgICAgYXJyMltpMl0gPSBhcnJbaTJdOwogICAgICB9CiAgICAgIHJldHVybiBhcnIyOwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBfYXJyYXlMaWtlVG9BcnJheTsKICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSkoYXJyYXlMaWtlVG9BcnJheSQxKTsKICAoZnVuY3Rpb24obW9kdWxlKSB7CiAgICB2YXIgX3NsaWNlSW5zdGFuY2VQcm9wZXJ0eSA9IHNsaWNlJDI7CiAgICB2YXIgX0FycmF5JGZyb20gPSBmcm9tJDE7CiAgICB2YXIgYXJyYXlMaWtlVG9BcnJheTIgPSBhcnJheUxpa2VUb0FycmF5JDEuZXhwb3J0czsKICAgIGZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHsKICAgICAgdmFyIF9jb250ZXh0OwogICAgICBpZiAoIW8pCiAgICAgICAgcmV0dXJuOwogICAgICBpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKQogICAgICAgIHJldHVybiBhcnJheUxpa2VUb0FycmF5MihvLCBtaW5MZW4pOwogICAgICB2YXIgbiA9IF9zbGljZUluc3RhbmNlUHJvcGVydHkoX2NvbnRleHQgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykpLmNhbGwoX2NvbnRleHQsIDgsIC0xKTsKICAgICAgaWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpCiAgICAgICAgbiA9IG8uY29uc3RydWN0b3IubmFtZTsKICAgICAgaWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKQogICAgICAgIHJldHVybiBfQXJyYXkkZnJvbShvKTsKICAgICAgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKQogICAgICAgIHJldHVybiBhcnJheUxpa2VUb0FycmF5MihvLCBtaW5MZW4pOwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXk7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5JDEpOwogIHZhciBub25JdGVyYWJsZVJlc3QkMSA9IHsgZXhwb3J0czoge30gfTsKICAoZnVuY3Rpb24obW9kdWxlKSB7CiAgICBmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBfbm9uSXRlcmFibGVSZXN0OwogICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShub25JdGVyYWJsZVJlc3QkMSk7CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgdmFyIGFycmF5V2l0aEhvbGVzMiA9IGFycmF5V2l0aEhvbGVzJDEuZXhwb3J0czsKICAgIHZhciBpdGVyYWJsZVRvQXJyYXlMaW1pdDIgPSBpdGVyYWJsZVRvQXJyYXlMaW1pdCQxLmV4cG9ydHM7CiAgICB2YXIgdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkyID0gdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkkMS5leHBvcnRzOwogICAgdmFyIG5vbkl0ZXJhYmxlUmVzdDIgPSBub25JdGVyYWJsZVJlc3QkMS5leHBvcnRzOwogICAgZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpMikgewogICAgICByZXR1cm4gYXJyYXlXaXRoSG9sZXMyKGFycikgfHwgaXRlcmFibGVUb0FycmF5TGltaXQyKGFyciwgaTIpIHx8IHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5MihhcnIsIGkyKSB8fCBub25JdGVyYWJsZVJlc3QyKCk7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF9zbGljZWRUb0FycmF5OwogICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShzbGljZWRUb0FycmF5JDEpOwogIHZhciBkZWZpbmVQcm9wZXJ0eSQ2ID0geyBleHBvcnRzOiB7fSB9OwogIHZhciBwYXJlbnQkdiA9IGRlZmluZVByb3BlcnR5JGE7CiAgdmFyIGRlZmluZVByb3BlcnR5JDUgPSBwYXJlbnQkdjsKICB2YXIgZGVmaW5lUHJvcGVydHkkNCA9IGRlZmluZVByb3BlcnR5JDU7CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgdmFyIF9PYmplY3QkZGVmaW5lUHJvcGVydHkgPSBkZWZpbmVQcm9wZXJ0eSQ0OwogICAgZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogICAgICBpZiAoa2V5IGluIG9iaikgewogICAgICAgIF9PYmplY3QkZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgICAgIHZhbHVlLAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb2JqW2tleV0gPSB2YWx1ZTsKICAgICAgfQogICAgICByZXR1cm4gb2JqOwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBfZGVmaW5lUHJvcGVydHk7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKGRlZmluZVByb3BlcnR5JDYpOwogIHZhciAkJHIgPSBfZXhwb3J0OwogIHZhciAkbWFwID0gYXJyYXlJdGVyYXRpb24ubWFwOwogIHZhciBhcnJheU1ldGhvZEhhc1NwZWNpZXNTdXBwb3J0ID0gYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCQ0OwogIHZhciBIQVNfU1BFQ0lFU19TVVBQT1JUID0gYXJyYXlNZXRob2RIYXNTcGVjaWVzU3VwcG9ydCgibWFwIik7CiAgJCRyKHsgdGFyZ2V0OiAiQXJyYXkiLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiAhSEFTX1NQRUNJRVNfU1VQUE9SVCB9LCB7CiAgICBtYXA6IGZ1bmN0aW9uIG1hcDIoY2FsbGJhY2tmbikgewogICAgICByZXR1cm4gJG1hcCh0aGlzLCBjYWxsYmFja2ZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHZvaWQgMCk7CiAgICB9CiAgfSk7CiAgdmFyIGVudHJ5VmlydHVhbCQ2ID0gZW50cnlWaXJ0dWFsJGE7CiAgdmFyIG1hcCQzID0gZW50cnlWaXJ0dWFsJDYoIkFycmF5IikubWFwOwogIHZhciBtYXAkMiA9IG1hcCQzOwogIHZhciBBcnJheVByb3RvdHlwZSQ0ID0gQXJyYXkucHJvdG90eXBlOwogIHZhciBtYXBfMSA9IGZ1bmN0aW9uKGl0KSB7CiAgICB2YXIgb3duID0gaXQubWFwOwogICAgcmV0dXJuIGl0ID09PSBBcnJheVByb3RvdHlwZSQ0IHx8IGl0IGluc3RhbmNlb2YgQXJyYXkgJiYgb3duID09PSBBcnJheVByb3RvdHlwZSQ0Lm1hcCA/IG1hcCQyIDogb3duOwogIH07CiAgdmFyIHBhcmVudCR1ID0gbWFwXzE7CiAgdmFyIG1hcCQxID0gcGFyZW50JHU7CiAgdmFyIG1hcCA9IG1hcCQxOwogIHZhciBydW50aW1lID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUpIHsKICAgIHZhciBydW50aW1lMiA9IGZ1bmN0aW9uKGV4cG9ydHMpIHsKICAgICAgdmFyIE9wID0gT2JqZWN0LnByb3RvdHlwZTsKICAgICAgdmFyIGhhc093biA9IE9wLmhhc093blByb3BlcnR5OwogICAgICB2YXIgdW5kZWZpbmVkJDE7CiAgICAgIHZhciAkU3ltYm9sMiA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgPyBTeW1ib2wgOiB7fTsKICAgICAgdmFyIGl0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbDIuaXRlcmF0b3IgfHwgIkBAaXRlcmF0b3IiOwogICAgICB2YXIgYXN5bmNJdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wyLmFzeW5jSXRlcmF0b3IgfHwgIkBAYXN5bmNJdGVyYXRvciI7CiAgICAgIHZhciB0b1N0cmluZ1RhZ1N5bWJvbCA9ICRTeW1ib2wyLnRvU3RyaW5nVGFnIHx8ICJAQHRvU3RyaW5nVGFnIjsKICAgICAgZnVuY3Rpb24gZGVmaW5lKG9iaiwga2V5LCB2YWx1ZSkgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICAgICAgdmFsdWUsCiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgd3JpdGFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gb2JqW2tleV07CiAgICAgIH0KICAgICAgdHJ5IHsKICAgICAgICBkZWZpbmUoe30sICIiKTsKICAgICAgfSBjYXRjaCAoZXJyMikgewogICAgICAgIGRlZmluZSA9IGZ1bmN0aW9uKG9iaiwga2V5LCB2YWx1ZSkgewogICAgICAgICAgcmV0dXJuIG9ialtrZXldID0gdmFsdWU7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiB3cmFwMihpbm5lckZuLCBvdXRlckZuLCBzZWxmMiwgdHJ5TG9jc0xpc3QpIHsKICAgICAgICB2YXIgcHJvdG9HZW5lcmF0b3IgPSBvdXRlckZuICYmIG91dGVyRm4ucHJvdG90eXBlIGluc3RhbmNlb2YgR2VuZXJhdG9yID8gb3V0ZXJGbiA6IEdlbmVyYXRvcjsKICAgICAgICB2YXIgZ2VuZXJhdG9yID0gT2JqZWN0LmNyZWF0ZShwcm90b0dlbmVyYXRvci5wcm90b3R5cGUpOwogICAgICAgIHZhciBjb250ZXh0ID0gbmV3IENvbnRleHQodHJ5TG9jc0xpc3QgfHwgW10pOwogICAgICAgIGdlbmVyYXRvci5faW52b2tlID0gbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmMiwgY29udGV4dCk7CiAgICAgICAgcmV0dXJuIGdlbmVyYXRvcjsKICAgICAgfQogICAgICBleHBvcnRzLndyYXAgPSB3cmFwMjsKICAgICAgZnVuY3Rpb24gdHJ5Q2F0Y2goZm4sIG9iaiwgYXJnKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiB7IHR5cGU6ICJub3JtYWwiLCBhcmc6IGZuLmNhbGwob2JqLCBhcmcpIH07CiAgICAgICAgfSBjYXRjaCAoZXJyMikgewogICAgICAgICAgcmV0dXJuIHsgdHlwZTogInRocm93IiwgYXJnOiBlcnIyIH07CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciBHZW5TdGF0ZVN1c3BlbmRlZFN0YXJ0ID0gInN1c3BlbmRlZFN0YXJ0IjsKICAgICAgdmFyIEdlblN0YXRlU3VzcGVuZGVkWWllbGQgPSAic3VzcGVuZGVkWWllbGQiOwogICAgICB2YXIgR2VuU3RhdGVFeGVjdXRpbmcgPSAiZXhlY3V0aW5nIjsKICAgICAgdmFyIEdlblN0YXRlQ29tcGxldGVkID0gImNvbXBsZXRlZCI7CiAgICAgIHZhciBDb250aW51ZVNlbnRpbmVsID0ge307CiAgICAgIGZ1bmN0aW9uIEdlbmVyYXRvcigpIHsKICAgICAgfQogICAgICBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHsKICAgICAgfQogICAgICBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSgpIHsKICAgICAgfQogICAgICB2YXIgSXRlcmF0b3JQcm90b3R5cGUyID0ge307CiAgICAgIGRlZmluZShJdGVyYXRvclByb3RvdHlwZTIsIGl0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSk7CiAgICAgIHZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZjsKICAgICAgdmFyIE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG8gJiYgZ2V0UHJvdG8oZ2V0UHJvdG8odmFsdWVzKFtdKSkpOwogICAgICBpZiAoTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgJiYgTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgIT09IE9wICYmIGhhc093bi5jYWxsKE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlLCBpdGVyYXRvclN5bWJvbCkpIHsKICAgICAgICBJdGVyYXRvclByb3RvdHlwZTIgPSBOYXRpdmVJdGVyYXRvclByb3RvdHlwZTsKICAgICAgfQogICAgICB2YXIgR3AgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUgPSBHZW5lcmF0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShJdGVyYXRvclByb3RvdHlwZTIpOwogICAgICBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZTsKICAgICAgZGVmaW5lKEdwLCAiY29uc3RydWN0b3IiLCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSk7CiAgICAgIGRlZmluZShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgImNvbnN0cnVjdG9yIiwgR2VuZXJhdG9yRnVuY3Rpb24pOwogICAgICBHZW5lcmF0b3JGdW5jdGlvbi5kaXNwbGF5TmFtZSA9IGRlZmluZShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgdG9TdHJpbmdUYWdTeW1ib2wsICJHZW5lcmF0b3JGdW5jdGlvbiIpOwogICAgICBmdW5jdGlvbiBkZWZpbmVJdGVyYXRvck1ldGhvZHMocHJvdG90eXBlKSB7CiAgICAgICAgWyJuZXh0IiwgInRocm93IiwgInJldHVybiJdLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7CiAgICAgICAgICBkZWZpbmUocHJvdG90eXBlLCBtZXRob2QsIGZ1bmN0aW9uKGFyZykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgYXJnKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uKGdlbkZ1bikgewogICAgICAgIHZhciBjdG9yID0gdHlwZW9mIGdlbkZ1biA9PT0gImZ1bmN0aW9uIiAmJiBnZW5GdW4uY29uc3RydWN0b3I7CiAgICAgICAgcmV0dXJuIGN0b3IgPyBjdG9yID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAoY3Rvci5kaXNwbGF5TmFtZSB8fCBjdG9yLm5hbWUpID09PSAiR2VuZXJhdG9yRnVuY3Rpb24iIDogZmFsc2U7CiAgICAgIH07CiAgICAgIGV4cG9ydHMubWFyayA9IGZ1bmN0aW9uKGdlbkZ1bikgewogICAgICAgIGlmIChPYmplY3Quc2V0UHJvdG90eXBlT2YpIHsKICAgICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihnZW5GdW4sIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZ2VuRnVuLl9fcHJvdG9fXyA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlOwogICAgICAgICAgZGVmaW5lKGdlbkZ1biwgdG9TdHJpbmdUYWdTeW1ib2wsICJHZW5lcmF0b3JGdW5jdGlvbiIpOwogICAgICAgIH0KICAgICAgICBnZW5GdW4ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShHcCk7CiAgICAgICAgcmV0dXJuIGdlbkZ1bjsKICAgICAgfTsKICAgICAgZXhwb3J0cy5hd3JhcCA9IGZ1bmN0aW9uKGFyZykgewogICAgICAgIHJldHVybiB7IF9fYXdhaXQ6IGFyZyB9OwogICAgICB9OwogICAgICBmdW5jdGlvbiBBc3luY0l0ZXJhdG9yKGdlbmVyYXRvciwgUHJvbWlzZUltcGwpIHsKICAgICAgICBmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgdmFyIHJlY29yZDIgPSB0cnlDYXRjaChnZW5lcmF0b3JbbWV0aG9kXSwgZ2VuZXJhdG9yLCBhcmcpOwogICAgICAgICAgaWYgKHJlY29yZDIudHlwZSA9PT0gInRocm93IikgewogICAgICAgICAgICByZWplY3QocmVjb3JkMi5hcmcpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHJlY29yZDIuYXJnOwogICAgICAgICAgICB2YXIgdmFsdWUgPSByZXN1bHQudmFsdWU7CiAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiICYmIGhhc093bi5jYWxsKHZhbHVlLCAiX19hd2FpdCIpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUuX19hd2FpdCkudGhlbihmdW5jdGlvbih2YWx1ZTIpIHsKICAgICAgICAgICAgICAgIGludm9rZSgibmV4dCIsIHZhbHVlMiwgcmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgICAgICB9LCBmdW5jdGlvbihlcnIyKSB7CiAgICAgICAgICAgICAgICBpbnZva2UoInRocm93IiwgZXJyMiwgcmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gUHJvbWlzZUltcGwucmVzb2x2ZSh2YWx1ZSkudGhlbihmdW5jdGlvbih1bndyYXBwZWQpIHsKICAgICAgICAgICAgICByZXN1bHQudmFsdWUgPSB1bndyYXBwZWQ7CiAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpOwogICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikgewogICAgICAgICAgICAgIHJldHVybiBpbnZva2UoInRocm93IiwgZXJyb3IsIHJlc29sdmUsIHJlamVjdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgcHJldmlvdXNQcm9taXNlOwogICAgICAgIGZ1bmN0aW9uIGVucXVldWUobWV0aG9kLCBhcmcpIHsKICAgICAgICAgIGZ1bmN0aW9uIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2VJbXBsKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgIGludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcHJldmlvdXNQcm9taXNlID0gcHJldmlvdXNQcm9taXNlID8gcHJldmlvdXNQcm9taXNlLnRoZW4oY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcsIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKSA6IGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2ludm9rZSA9IGVucXVldWU7CiAgICAgIH0KICAgICAgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlKTsKICAgICAgZGVmaW5lKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlLCBhc3luY0l0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSk7CiAgICAgIGV4cG9ydHMuQXN5bmNJdGVyYXRvciA9IEFzeW5jSXRlcmF0b3I7CiAgICAgIGV4cG9ydHMuYXN5bmMgPSBmdW5jdGlvbihpbm5lckZuLCBvdXRlckZuLCBzZWxmMiwgdHJ5TG9jc0xpc3QsIFByb21pc2VJbXBsKSB7CiAgICAgICAgaWYgKFByb21pc2VJbXBsID09PSB2b2lkIDApCiAgICAgICAgICBQcm9taXNlSW1wbCA9IFByb21pc2U7CiAgICAgICAgdmFyIGl0ZXIgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwMihpbm5lckZuLCBvdXRlckZuLCBzZWxmMiwgdHJ5TG9jc0xpc3QpLCBQcm9taXNlSW1wbCk7CiAgICAgICAgcmV0dXJuIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbihvdXRlckZuKSA/IGl0ZXIgOiBpdGVyLm5leHQoKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgcmV0dXJuIHJlc3VsdC5kb25lID8gcmVzdWx0LnZhbHVlIDogaXRlci5uZXh0KCk7CiAgICAgICAgfSk7CiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZjIsIGNvbnRleHQpIHsKICAgICAgICB2YXIgc3RhdGUgPSBHZW5TdGF0ZVN1c3BlbmRlZFN0YXJ0OwogICAgICAgIHJldHVybiBmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcpIHsKICAgICAgICAgIGlmIChzdGF0ZSA9PT0gR2VuU3RhdGVFeGVjdXRpbmcpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nIik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlQ29tcGxldGVkKSB7CiAgICAgICAgICAgIGlmIChtZXRob2QgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICB0aHJvdyBhcmc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGRvbmVSZXN1bHQoKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gbWV0aG9kOwogICAgICAgICAgY29udGV4dC5hcmcgPSBhcmc7CiAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICB2YXIgZGVsZWdhdGUgPSBjb250ZXh0LmRlbGVnYXRlOwogICAgICAgICAgICBpZiAoZGVsZWdhdGUpIHsKICAgICAgICAgICAgICB2YXIgZGVsZWdhdGVSZXN1bHQgPSBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTsKICAgICAgICAgICAgICBpZiAoZGVsZWdhdGVSZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChkZWxlZ2F0ZVJlc3VsdCA9PT0gQ29udGludWVTZW50aW5lbCkKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICByZXR1cm4gZGVsZWdhdGVSZXN1bHQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjb250ZXh0Lm1ldGhvZCA9PT0gIm5leHQiKSB7CiAgICAgICAgICAgICAgY29udGV4dC5zZW50ID0gY29udGV4dC5fc2VudCA9IGNvbnRleHQuYXJnOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRleHQubWV0aG9kID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgaWYgKHN0YXRlID09PSBHZW5TdGF0ZVN1c3BlbmRlZFN0YXJ0KSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IEdlblN0YXRlQ29tcGxldGVkOwogICAgICAgICAgICAgICAgdGhyb3cgY29udGV4dC5hcmc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnRleHQuZGlzcGF0Y2hFeGNlcHRpb24oY29udGV4dC5hcmcpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRleHQubWV0aG9kID09PSAicmV0dXJuIikgewogICAgICAgICAgICAgIGNvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBjb250ZXh0LmFyZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUV4ZWN1dGluZzsKICAgICAgICAgICAgdmFyIHJlY29yZDIgPSB0cnlDYXRjaChpbm5lckZuLCBzZWxmMiwgY29udGV4dCk7CiAgICAgICAgICAgIGlmIChyZWNvcmQyLnR5cGUgPT09ICJub3JtYWwiKSB7CiAgICAgICAgICAgICAgc3RhdGUgPSBjb250ZXh0LmRvbmUgPyBHZW5TdGF0ZUNvbXBsZXRlZCA6IEdlblN0YXRlU3VzcGVuZGVkWWllbGQ7CiAgICAgICAgICAgICAgaWYgKHJlY29yZDIuYXJnID09PSBDb250aW51ZVNlbnRpbmVsKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHZhbHVlOiByZWNvcmQyLmFyZywKICAgICAgICAgICAgICAgIGRvbmU6IGNvbnRleHQuZG9uZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVjb3JkMi50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUNvbXBsZXRlZDsKICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7CiAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSByZWNvcmQyLmFyZzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCkgewogICAgICAgIHZhciBtZXRob2QgPSBkZWxlZ2F0ZS5pdGVyYXRvcltjb250ZXh0Lm1ldGhvZF07CiAgICAgICAgaWYgKG1ldGhvZCA9PT0gdW5kZWZpbmVkJDEpIHsKICAgICAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsOwogICAgICAgICAgaWYgKGNvbnRleHQubWV0aG9kID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgIGlmIChkZWxlZ2F0ZS5pdGVyYXRvclsicmV0dXJuIl0pIHsKICAgICAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJyZXR1cm4iOwogICAgICAgICAgICAgIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkJDE7CiAgICAgICAgICAgICAgbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCk7CiAgICAgICAgICAgICAgaWYgKGNvbnRleHQubWV0aG9kID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAidGhyb3ciOwogICAgICAgICAgICBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJ3Rocm93JyBtZXRob2QiKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgIH0KICAgICAgICB2YXIgcmVjb3JkMiA9IHRyeUNhdGNoKG1ldGhvZCwgZGVsZWdhdGUuaXRlcmF0b3IsIGNvbnRleHQuYXJnKTsKICAgICAgICBpZiAocmVjb3JkMi50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyI7CiAgICAgICAgICBjb250ZXh0LmFyZyA9IHJlY29yZDIuYXJnOwogICAgICAgICAgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7CiAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICB9CiAgICAgICAgdmFyIGluZm8gPSByZWNvcmQyLmFyZzsKICAgICAgICBpZiAoIWluZm8pIHsKICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gInRocm93IjsKICAgICAgICAgIGNvbnRleHQuYXJnID0gbmV3IFR5cGVFcnJvcigiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3QiKTsKICAgICAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsOwogICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgfQogICAgICAgIGlmIChpbmZvLmRvbmUpIHsKICAgICAgICAgIGNvbnRleHRbZGVsZWdhdGUucmVzdWx0TmFtZV0gPSBpbmZvLnZhbHVlOwogICAgICAgICAgY29udGV4dC5uZXh0ID0gZGVsZWdhdGUubmV4dExvYzsKICAgICAgICAgIGlmIChjb250ZXh0Lm1ldGhvZCAhPT0gInJldHVybiIpIHsKICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAibmV4dCI7CiAgICAgICAgICAgIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkJDE7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBpbmZvOwogICAgICAgIH0KICAgICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDsKICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgfQogICAgICBkZWZpbmVJdGVyYXRvck1ldGhvZHMoR3ApOwogICAgICBkZWZpbmUoR3AsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yIik7CiAgICAgIGRlZmluZShHcCwgaXRlcmF0b3JTeW1ib2wsIGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9KTsKICAgICAgZGVmaW5lKEdwLCAidG9TdHJpbmciLCBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gIltvYmplY3QgR2VuZXJhdG9yXSI7CiAgICAgIH0pOwogICAgICBmdW5jdGlvbiBwdXNoVHJ5RW50cnkobG9jcykgewogICAgICAgIHZhciBlbnRyeSA9IHsgdHJ5TG9jOiBsb2NzWzBdIH07CiAgICAgICAgaWYgKDEgaW4gbG9jcykgewogICAgICAgICAgZW50cnkuY2F0Y2hMb2MgPSBsb2NzWzFdOwogICAgICAgIH0KICAgICAgICBpZiAoMiBpbiBsb2NzKSB7CiAgICAgICAgICBlbnRyeS5maW5hbGx5TG9jID0gbG9jc1syXTsKICAgICAgICAgIGVudHJ5LmFmdGVyTG9jID0gbG9jc1szXTsKICAgICAgICB9CiAgICAgICAgdGhpcy50cnlFbnRyaWVzLnB1c2goZW50cnkpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkoZW50cnkpIHsKICAgICAgICB2YXIgcmVjb3JkMiA9IGVudHJ5LmNvbXBsZXRpb24gfHwge307CiAgICAgICAgcmVjb3JkMi50eXBlID0gIm5vcm1hbCI7CiAgICAgICAgZGVsZXRlIHJlY29yZDIuYXJnOwogICAgICAgIGVudHJ5LmNvbXBsZXRpb24gPSByZWNvcmQyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIENvbnRleHQodHJ5TG9jc0xpc3QpIHsKICAgICAgICB0aGlzLnRyeUVudHJpZXMgPSBbeyB0cnlMb2M6ICJyb290IiB9XTsKICAgICAgICB0cnlMb2NzTGlzdC5mb3JFYWNoKHB1c2hUcnlFbnRyeSwgdGhpcyk7CiAgICAgICAgdGhpcy5yZXNldCh0cnVlKTsKICAgICAgfQogICAgICBleHBvcnRzLmtleXMgPSBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgICB2YXIga2V5czIgPSBbXTsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7CiAgICAgICAgICBrZXlzMi5wdXNoKGtleSk7CiAgICAgICAgfQogICAgICAgIGtleXMyLnJldmVyc2UoKTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICAgIHdoaWxlIChrZXlzMi5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGtleTIgPSBrZXlzMi5wb3AoKTsKICAgICAgICAgICAgaWYgKGtleTIgaW4gb2JqZWN0KSB7CiAgICAgICAgICAgICAgbmV4dC52YWx1ZSA9IGtleTI7CiAgICAgICAgICAgICAgbmV4dC5kb25lID0gZmFsc2U7CiAgICAgICAgICAgICAgcmV0dXJuIG5leHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIG5leHQuZG9uZSA9IHRydWU7CiAgICAgICAgICByZXR1cm4gbmV4dDsKICAgICAgICB9OwogICAgICB9OwogICAgICBmdW5jdGlvbiB2YWx1ZXMoaXRlcmFibGUpIHsKICAgICAgICBpZiAoaXRlcmFibGUpIHsKICAgICAgICAgIHZhciBpdGVyYXRvck1ldGhvZCA9IGl0ZXJhYmxlW2l0ZXJhdG9yU3ltYm9sXTsKICAgICAgICAgIGlmIChpdGVyYXRvck1ldGhvZCkgewogICAgICAgICAgICByZXR1cm4gaXRlcmF0b3JNZXRob2QuY2FsbChpdGVyYWJsZSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodHlwZW9mIGl0ZXJhYmxlLm5leHQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZXJhYmxlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFpc05hTihpdGVyYWJsZS5sZW5ndGgpKSB7CiAgICAgICAgICAgIHZhciBpMiA9IC0xLCBuZXh0ID0gZnVuY3Rpb24gbmV4dDIoKSB7CiAgICAgICAgICAgICAgd2hpbGUgKCsraTIgPCBpdGVyYWJsZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlmIChoYXNPd24uY2FsbChpdGVyYWJsZSwgaTIpKSB7CiAgICAgICAgICAgICAgICAgIG5leHQyLnZhbHVlID0gaXRlcmFibGVbaTJdOwogICAgICAgICAgICAgICAgICBuZXh0Mi5kb25lID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHJldHVybiBuZXh0MjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbmV4dDIudmFsdWUgPSB1bmRlZmluZWQkMTsKICAgICAgICAgICAgICBuZXh0Mi5kb25lID0gdHJ1ZTsKICAgICAgICAgICAgICByZXR1cm4gbmV4dDI7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBuZXh0Lm5leHQgPSBuZXh0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4geyBuZXh0OiBkb25lUmVzdWx0IH07CiAgICAgIH0KICAgICAgZXhwb3J0cy52YWx1ZXMgPSB2YWx1ZXM7CiAgICAgIGZ1bmN0aW9uIGRvbmVSZXN1bHQoKSB7CiAgICAgICAgcmV0dXJuIHsgdmFsdWU6IHVuZGVmaW5lZCQxLCBkb25lOiB0cnVlIH07CiAgICAgIH0KICAgICAgQ29udGV4dC5wcm90b3R5cGUgPSB7CiAgICAgICAgY29uc3RydWN0b3I6IENvbnRleHQsCiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKHNraXBUZW1wUmVzZXQpIHsKICAgICAgICAgIHRoaXMucHJldiA9IDA7CiAgICAgICAgICB0aGlzLm5leHQgPSAwOwogICAgICAgICAgdGhpcy5zZW50ID0gdGhpcy5fc2VudCA9IHVuZGVmaW5lZCQxOwogICAgICAgICAgdGhpcy5kb25lID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmRlbGVnYXRlID0gbnVsbDsKICAgICAgICAgIHRoaXMubWV0aG9kID0gIm5leHQiOwogICAgICAgICAgdGhpcy5hcmcgPSB1bmRlZmluZWQkMTsKICAgICAgICAgIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpOwogICAgICAgICAgaWYgKCFza2lwVGVtcFJlc2V0KSB7CiAgICAgICAgICAgIGZvciAodmFyIG5hbWUgaW4gdGhpcykgewogICAgICAgICAgICAgIGlmIChuYW1lLmNoYXJBdCgwKSA9PT0gInQiICYmIGhhc093bi5jYWxsKHRoaXMsIG5hbWUpICYmICFpc05hTigrbmFtZS5zbGljZSgxKSkpIHsKICAgICAgICAgICAgICAgIHRoaXNbbmFtZV0gPSB1bmRlZmluZWQkMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIHN0b3A6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhpcy5kb25lID0gdHJ1ZTsKICAgICAgICAgIHZhciByb290RW50cnkgPSB0aGlzLnRyeUVudHJpZXNbMF07CiAgICAgICAgICB2YXIgcm9vdFJlY29yZCA9IHJvb3RFbnRyeS5jb21wbGV0aW9uOwogICAgICAgICAgaWYgKHJvb3RSZWNvcmQudHlwZSA9PT0gInRocm93IikgewogICAgICAgICAgICB0aHJvdyByb290UmVjb3JkLmFyZzsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzLnJ2YWw7CiAgICAgICAgfSwKICAgICAgICBkaXNwYXRjaEV4Y2VwdGlvbjogZnVuY3Rpb24oZXhjZXB0aW9uKSB7CiAgICAgICAgICBpZiAodGhpcy5kb25lKSB7CiAgICAgICAgICAgIHRocm93IGV4Y2VwdGlvbjsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBjb250ZXh0ID0gdGhpczsKICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZShsb2MsIGNhdWdodCkgewogICAgICAgICAgICByZWNvcmQyLnR5cGUgPSAidGhyb3ciOwogICAgICAgICAgICByZWNvcmQyLmFyZyA9IGV4Y2VwdGlvbjsKICAgICAgICAgICAgY29udGV4dC5uZXh0ID0gbG9jOwogICAgICAgICAgICBpZiAoY2F1Z2h0KSB7CiAgICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAibmV4dCI7CiAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSB1bmRlZmluZWQkMTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gISFjYXVnaHQ7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKHZhciBpMiA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpMiA+PSAwOyAtLWkyKSB7CiAgICAgICAgICAgIHZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpMl07CiAgICAgICAgICAgIHZhciByZWNvcmQyID0gZW50cnkuY29tcGxldGlvbjsKICAgICAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA9PT0gInJvb3QiKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZSgiZW5kIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYpIHsKICAgICAgICAgICAgICB2YXIgaGFzQ2F0Y2ggPSBoYXNPd24uY2FsbChlbnRyeSwgImNhdGNoTG9jIik7CiAgICAgICAgICAgICAgdmFyIGhhc0ZpbmFsbHkgPSBoYXNPd24uY2FsbChlbnRyeSwgImZpbmFsbHlMb2MiKTsKICAgICAgICAgICAgICBpZiAoaGFzQ2F0Y2ggJiYgaGFzRmluYWxseSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsIHRydWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNDYXRjaCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsIHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzRmluYWxseSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYWJydXB0OiBmdW5jdGlvbih0eXBlLCBhcmcpIHsKICAgICAgICAgIGZvciAodmFyIGkyID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkyID49IDA7IC0taTIpIHsKICAgICAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2kyXTsKICAgICAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYgJiYgaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIikgJiYgdGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgewogICAgICAgICAgICAgIHZhciBmaW5hbGx5RW50cnkgPSBlbnRyeTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGZpbmFsbHlFbnRyeSAmJiAodHlwZSA9PT0gImJyZWFrIiB8fCB0eXBlID09PSAiY29udGludWUiKSAmJiBmaW5hbGx5RW50cnkudHJ5TG9jIDw9IGFyZyAmJiBhcmcgPD0gZmluYWxseUVudHJ5LmZpbmFsbHlMb2MpIHsKICAgICAgICAgICAgZmluYWxseUVudHJ5ID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHZhciByZWNvcmQyID0gZmluYWxseUVudHJ5ID8gZmluYWxseUVudHJ5LmNvbXBsZXRpb24gOiB7fTsKICAgICAgICAgIHJlY29yZDIudHlwZSA9IHR5cGU7CiAgICAgICAgICByZWNvcmQyLmFyZyA9IGFyZzsKICAgICAgICAgIGlmIChmaW5hbGx5RW50cnkpIHsKICAgICAgICAgICAgdGhpcy5tZXRob2QgPSAibmV4dCI7CiAgICAgICAgICAgIHRoaXMubmV4dCA9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jOwogICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBsZXRlKHJlY29yZDIpOwogICAgICAgIH0sCiAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKHJlY29yZDIsIGFmdGVyTG9jKSB7CiAgICAgICAgICBpZiAocmVjb3JkMi50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgIHRocm93IHJlY29yZDIuYXJnOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHJlY29yZDIudHlwZSA9PT0gImJyZWFrIiB8fCByZWNvcmQyLnR5cGUgPT09ICJjb250aW51ZSIpIHsKICAgICAgICAgICAgdGhpcy5uZXh0ID0gcmVjb3JkMi5hcmc7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlY29yZDIudHlwZSA9PT0gInJldHVybiIpIHsKICAgICAgICAgICAgdGhpcy5ydmFsID0gdGhpcy5hcmcgPSByZWNvcmQyLmFyZzsKICAgICAgICAgICAgdGhpcy5tZXRob2QgPSAicmV0dXJuIjsKICAgICAgICAgICAgdGhpcy5uZXh0ID0gImVuZCI7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlY29yZDIudHlwZSA9PT0gIm5vcm1hbCIgJiYgYWZ0ZXJMb2MpIHsKICAgICAgICAgICAgdGhpcy5uZXh0ID0gYWZ0ZXJMb2M7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICB9LAogICAgICAgIGZpbmlzaDogZnVuY3Rpb24oZmluYWxseUxvYykgewogICAgICAgICAgZm9yICh2YXIgaTIgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaTIgPj0gMDsgLS1pMikgewogICAgICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaTJdOwogICAgICAgICAgICBpZiAoZW50cnkuZmluYWxseUxvYyA9PT0gZmluYWxseUxvYykgewogICAgICAgICAgICAgIHRoaXMuY29tcGxldGUoZW50cnkuY29tcGxldGlvbiwgZW50cnkuYWZ0ZXJMb2MpOwogICAgICAgICAgICAgIHJlc2V0VHJ5RW50cnkoZW50cnkpOwogICAgICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAiY2F0Y2giOiBmdW5jdGlvbih0cnlMb2MpIHsKICAgICAgICAgIGZvciAodmFyIGkyID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkyID49IDA7IC0taTIpIHsKICAgICAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2kyXTsKICAgICAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA9PT0gdHJ5TG9jKSB7CiAgICAgICAgICAgICAgdmFyIHJlY29yZDIgPSBlbnRyeS5jb21wbGV0aW9uOwogICAgICAgICAgICAgIGlmIChyZWNvcmQyLnR5cGUgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICAgIHZhciB0aHJvd24gPSByZWNvcmQyLmFyZzsKICAgICAgICAgICAgICAgIHJlc2V0VHJ5RW50cnkoZW50cnkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gdGhyb3duOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdCIpOwogICAgICAgIH0sCiAgICAgICAgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24oaXRlcmFibGUsIHJlc3VsdE5hbWUsIG5leHRMb2MpIHsKICAgICAgICAgIHRoaXMuZGVsZWdhdGUgPSB7CiAgICAgICAgICAgIGl0ZXJhdG9yOiB2YWx1ZXMoaXRlcmFibGUpLAogICAgICAgICAgICByZXN1bHROYW1lLAogICAgICAgICAgICBuZXh0TG9jCiAgICAgICAgICB9OwogICAgICAgICAgaWYgKHRoaXMubWV0aG9kID09PSAibmV4dCIpIHsKICAgICAgICAgICAgdGhpcy5hcmcgPSB1bmRlZmluZWQkMTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmV0dXJuIGV4cG9ydHM7CiAgICB9KG1vZHVsZS5leHBvcnRzKTsKICAgIHRyeSB7CiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZSA9IHJ1bnRpbWUyOwogICAgfSBjYXRjaCAoYWNjaWRlbnRhbFN0cmljdE1vZGUpIHsKICAgICAgaWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAib2JqZWN0IikgewogICAgICAgIGdsb2JhbFRoaXMucmVnZW5lcmF0b3JSdW50aW1lID0gcnVudGltZTI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgRnVuY3Rpb24oInIiLCAicmVnZW5lcmF0b3JSdW50aW1lID0gciIpKHJ1bnRpbWUyKTsKICAgICAgfQogICAgfQogIH0pKHJ1bnRpbWUpOwogIHZhciByZWdlbmVyYXRvciQxID0gcnVudGltZS5leHBvcnRzOwogIHZhciBhc3luY1RvR2VuZXJhdG9yJDEgPSB7IGV4cG9ydHM6IHt9IH07CiAgdmFyIGFuT2JqZWN0JDcgPSBhbk9iamVjdCRpOwogIHZhciBpc0FycmF5SXRlcmF0b3JNZXRob2QgPSBpc0FycmF5SXRlcmF0b3JNZXRob2QkMjsKICB2YXIgdG9MZW5ndGgkMyA9IHRvTGVuZ3RoJDk7CiAgdmFyIGJpbmQkOCA9IGZ1bmN0aW9uQmluZENvbnRleHQ7CiAgdmFyIGdldEl0ZXJhdG9yID0gZ2V0SXRlcmF0b3IkNjsKICB2YXIgZ2V0SXRlcmF0b3JNZXRob2QgPSBnZXRJdGVyYXRvck1ldGhvZCQ3OwogIHZhciBpdGVyYXRvckNsb3NlID0gaXRlcmF0b3JDbG9zZSQyOwogIHZhciBSZXN1bHQgPSBmdW5jdGlvbihzdG9wcGVkLCByZXN1bHQpIHsKICAgIHRoaXMuc3RvcHBlZCA9IHN0b3BwZWQ7CiAgICB0aGlzLnJlc3VsdCA9IHJlc3VsdDsKICB9OwogIHZhciBpdGVyYXRlJDcgPSBmdW5jdGlvbihpdGVyYWJsZSwgdW5ib3VuZEZ1bmN0aW9uLCBvcHRpb25zKSB7CiAgICB2YXIgdGhhdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy50aGF0OwogICAgdmFyIEFTX0VOVFJJRVMgPSAhIShvcHRpb25zICYmIG9wdGlvbnMuQVNfRU5UUklFUyk7CiAgICB2YXIgSVNfSVRFUkFUT1IgPSAhIShvcHRpb25zICYmIG9wdGlvbnMuSVNfSVRFUkFUT1IpOwogICAgdmFyIElOVEVSUlVQVEVEID0gISEob3B0aW9ucyAmJiBvcHRpb25zLklOVEVSUlVQVEVEKTsKICAgIHZhciBmbiA9IGJpbmQkOCh1bmJvdW5kRnVuY3Rpb24sIHRoYXQsIDEgKyBBU19FTlRSSUVTICsgSU5URVJSVVBURUQpOwogICAgdmFyIGl0ZXJhdG9yMiwgaXRlckZuLCBpbmRleCwgbGVuZ3RoLCByZXN1bHQsIG5leHQsIHN0ZXA7CiAgICB2YXIgc3RvcCA9IGZ1bmN0aW9uKGNvbmRpdGlvbikgewogICAgICBpZiAoaXRlcmF0b3IyKQogICAgICAgIGl0ZXJhdG9yQ2xvc2UoaXRlcmF0b3IyLCAibm9ybWFsIiwgY29uZGl0aW9uKTsKICAgICAgcmV0dXJuIG5ldyBSZXN1bHQodHJ1ZSwgY29uZGl0aW9uKTsKICAgIH07CiAgICB2YXIgY2FsbEZuID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgaWYgKEFTX0VOVFJJRVMpIHsKICAgICAgICBhbk9iamVjdCQ3KHZhbHVlKTsKICAgICAgICByZXR1cm4gSU5URVJSVVBURUQgPyBmbih2YWx1ZVswXSwgdmFsdWVbMV0sIHN0b3ApIDogZm4odmFsdWVbMF0sIHZhbHVlWzFdKTsKICAgICAgfQogICAgICByZXR1cm4gSU5URVJSVVBURUQgPyBmbih2YWx1ZSwgc3RvcCkgOiBmbih2YWx1ZSk7CiAgICB9OwogICAgaWYgKElTX0lURVJBVE9SKSB7CiAgICAgIGl0ZXJhdG9yMiA9IGl0ZXJhYmxlOwogICAgfSBlbHNlIHsKICAgICAgaXRlckZuID0gZ2V0SXRlcmF0b3JNZXRob2QoaXRlcmFibGUpOwogICAgICBpZiAoIWl0ZXJGbikKICAgICAgICB0aHJvdyBUeXBlRXJyb3IoU3RyaW5nKGl0ZXJhYmxlKSArICIgaXMgbm90IGl0ZXJhYmxlIik7CiAgICAgIGlmIChpc0FycmF5SXRlcmF0b3JNZXRob2QoaXRlckZuKSkgewogICAgICAgIGZvciAoaW5kZXggPSAwLCBsZW5ndGggPSB0b0xlbmd0aCQzKGl0ZXJhYmxlLmxlbmd0aCk7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKSB7CiAgICAgICAgICByZXN1bHQgPSBjYWxsRm4oaXRlcmFibGVbaW5kZXhdKTsKICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0IGluc3RhbmNlb2YgUmVzdWx0KQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFJlc3VsdChmYWxzZSk7CiAgICAgIH0KICAgICAgaXRlcmF0b3IyID0gZ2V0SXRlcmF0b3IoaXRlcmFibGUsIGl0ZXJGbik7CiAgICB9CiAgICBuZXh0ID0gaXRlcmF0b3IyLm5leHQ7CiAgICB3aGlsZSAoIShzdGVwID0gbmV4dC5jYWxsKGl0ZXJhdG9yMikpLmRvbmUpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXN1bHQgPSBjYWxsRm4oc3RlcC52YWx1ZSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgaXRlcmF0b3JDbG9zZShpdGVyYXRvcjIsICJ0aHJvdyIsIGVycm9yKTsKICAgICAgfQogICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PSAib2JqZWN0IiAmJiByZXN1bHQgJiYgcmVzdWx0IGluc3RhbmNlb2YgUmVzdWx0KQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICByZXR1cm4gbmV3IFJlc3VsdChmYWxzZSk7CiAgfTsKICB2YXIgJCRxID0gX2V4cG9ydDsKICB2YXIgZ2V0UHJvdG90eXBlT2YkNSA9IG9iamVjdEdldFByb3RvdHlwZU9mOwogIHZhciBzZXRQcm90b3R5cGVPZiQ2ID0gb2JqZWN0U2V0UHJvdG90eXBlT2Y7CiAgdmFyIGNyZWF0ZSQ1ID0gb2JqZWN0Q3JlYXRlOwogIHZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkMSA9IGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQ3OwogIHZhciBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IgPSBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IkNjsKICB2YXIgaXRlcmF0ZSQ2ID0gaXRlcmF0ZSQ3OwogIHZhciB0b1N0cmluZyQ2ID0gdG9TdHJpbmckYTsKICB2YXIgJEFnZ3JlZ2F0ZUVycm9yID0gZnVuY3Rpb24gQWdncmVnYXRlRXJyb3IoZXJyb3JzLCBtZXNzYWdlKSB7CiAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICBpZiAoISh0aGF0IGluc3RhbmNlb2YgJEFnZ3JlZ2F0ZUVycm9yKSkKICAgICAgcmV0dXJuIG5ldyAkQWdncmVnYXRlRXJyb3IoZXJyb3JzLCBtZXNzYWdlKTsKICAgIGlmIChzZXRQcm90b3R5cGVPZiQ2KSB7CiAgICAgIHRoYXQgPSBzZXRQcm90b3R5cGVPZiQ2KG5ldyBFcnJvcih2b2lkIDApLCBnZXRQcm90b3R5cGVPZiQ1KHRoYXQpKTsKICAgIH0KICAgIGlmIChtZXNzYWdlICE9PSB2b2lkIDApCiAgICAgIGNyZWF0ZU5vbkVudW1lcmFibGVQcm9wZXJ0eSQxKHRoYXQsICJtZXNzYWdlIiwgdG9TdHJpbmckNihtZXNzYWdlKSk7CiAgICB2YXIgZXJyb3JzQXJyYXkgPSBbXTsKICAgIGl0ZXJhdGUkNihlcnJvcnMsIGVycm9yc0FycmF5LnB1c2gsIHsgdGhhdDogZXJyb3JzQXJyYXkgfSk7CiAgICBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkMSh0aGF0LCAiZXJyb3JzIiwgZXJyb3JzQXJyYXkpOwogICAgcmV0dXJuIHRoYXQ7CiAgfTsKICAkQWdncmVnYXRlRXJyb3IucHJvdG90eXBlID0gY3JlYXRlJDUoRXJyb3IucHJvdG90eXBlLCB7CiAgICBjb25zdHJ1Y3RvcjogY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yKDUsICRBZ2dyZWdhdGVFcnJvciksCiAgICBtZXNzYWdlOiBjcmVhdGVQcm9wZXJ0eURlc2NyaXB0b3IoNSwgIiIpLAogICAgbmFtZTogY3JlYXRlUHJvcGVydHlEZXNjcmlwdG9yKDUsICJBZ2dyZWdhdGVFcnJvciIpCiAgfSk7CiAgJCRxKHsgZ2xvYmFsOiB0cnVlIH0sIHsKICAgIEFnZ3JlZ2F0ZUVycm9yOiAkQWdncmVnYXRlRXJyb3IKICB9KTsKICB2YXIgZ2xvYmFsJGIgPSBnbG9iYWwkbzsKICB2YXIgbmF0aXZlUHJvbWlzZUNvbnN0cnVjdG9yID0gZ2xvYmFsJGIuUHJvbWlzZTsKICB2YXIgcmVkZWZpbmUgPSByZWRlZmluZSQ0OwogIHZhciByZWRlZmluZUFsbCQzID0gZnVuY3Rpb24odGFyZ2V0LCBzcmMsIG9wdGlvbnMpIHsKICAgIGZvciAodmFyIGtleSBpbiBzcmMpIHsKICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51bnNhZmUgJiYgdGFyZ2V0W2tleV0pCiAgICAgICAgdGFyZ2V0W2tleV0gPSBzcmNba2V5XTsKICAgICAgZWxzZQogICAgICAgIHJlZGVmaW5lKHRhcmdldCwga2V5LCBzcmNba2V5XSwgb3B0aW9ucyk7CiAgICB9CiAgICByZXR1cm4gdGFyZ2V0OwogIH07CiAgdmFyIGdldEJ1aWx0SW4kMyA9IGdldEJ1aWx0SW4kYjsKICB2YXIgZGVmaW5lUHJvcGVydHlNb2R1bGUgPSBvYmplY3REZWZpbmVQcm9wZXJ0eTsKICB2YXIgd2VsbEtub3duU3ltYm9sJDQgPSB3ZWxsS25vd25TeW1ib2wkbDsKICB2YXIgREVTQ1JJUFRPUlMkMyA9IGRlc2NyaXB0b3JzOwogIHZhciBTUEVDSUVTJDIgPSB3ZWxsS25vd25TeW1ib2wkNCgic3BlY2llcyIpOwogIHZhciBzZXRTcGVjaWVzJDEgPSBmdW5jdGlvbihDT05TVFJVQ1RPUl9OQU1FKSB7CiAgICB2YXIgQ29uc3RydWN0b3IgPSBnZXRCdWlsdEluJDMoQ09OU1RSVUNUT1JfTkFNRSk7CiAgICB2YXIgZGVmaW5lUHJvcGVydHkyID0gZGVmaW5lUHJvcGVydHlNb2R1bGUuZjsKICAgIGlmIChERVNDUklQVE9SUyQzICYmIENvbnN0cnVjdG9yICYmICFDb25zdHJ1Y3RvcltTUEVDSUVTJDJdKSB7CiAgICAgIGRlZmluZVByb3BlcnR5MihDb25zdHJ1Y3RvciwgU1BFQ0lFUyQyLCB7CiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH07CiAgdmFyIGFuSW5zdGFuY2UkMyA9IGZ1bmN0aW9uKGl0LCBDb25zdHJ1Y3RvciwgbmFtZSkgewogICAgaWYgKGl0IGluc3RhbmNlb2YgQ29uc3RydWN0b3IpCiAgICAgIHJldHVybiBpdDsKICAgIHRocm93IFR5cGVFcnJvcigiSW5jb3JyZWN0ICIgKyAobmFtZSA/IG5hbWUgKyAiICIgOiAiIikgKyAiaW52b2NhdGlvbiIpOwogIH07CiAgdmFyIGFuT2JqZWN0JDYgPSBhbk9iamVjdCRpOwogIHZhciBhQ29uc3RydWN0b3IkMSA9IGFDb25zdHJ1Y3RvciQzOwogIHZhciB3ZWxsS25vd25TeW1ib2wkMyA9IHdlbGxLbm93blN5bWJvbCRsOwogIHZhciBTUEVDSUVTJDEgPSB3ZWxsS25vd25TeW1ib2wkMygic3BlY2llcyIpOwogIHZhciBzcGVjaWVzQ29uc3RydWN0b3IkMiA9IGZ1bmN0aW9uKE8sIGRlZmF1bHRDb25zdHJ1Y3RvcikgewogICAgdmFyIEMgPSBhbk9iamVjdCQ2KE8pLmNvbnN0cnVjdG9yOwogICAgdmFyIFM7CiAgICByZXR1cm4gQyA9PT0gdm9pZCAwIHx8IChTID0gYW5PYmplY3QkNihDKVtTUEVDSUVTJDFdKSA9PSB2b2lkIDAgPyBkZWZhdWx0Q29uc3RydWN0b3IgOiBhQ29uc3RydWN0b3IkMShTKTsKICB9OwogIHZhciB1c2VyQWdlbnQkNSA9IGVuZ2luZVVzZXJBZ2VudDsKICB2YXIgZW5naW5lSXNJb3MgPSAvKD86aXBhZHxpcGhvbmV8aXBvZCkuKmFwcGxld2Via2l0L2kudGVzdCh1c2VyQWdlbnQkNSk7CiAgdmFyIGNsYXNzb2YkMSA9IGNsYXNzb2ZSYXckMTsKICB2YXIgZ2xvYmFsJGEgPSBnbG9iYWwkbzsKICB2YXIgZW5naW5lSXNOb2RlID0gY2xhc3NvZiQxKGdsb2JhbCRhLnByb2Nlc3MpID09ICJwcm9jZXNzIjsKICB2YXIgZ2xvYmFsJDkgPSBnbG9iYWwkbzsKICB2YXIgaXNDYWxsYWJsZSQ1ID0gaXNDYWxsYWJsZSRsOwogIHZhciBmYWlscyQ3ID0gZmFpbHMkbjsKICB2YXIgYmluZCQ3ID0gZnVuY3Rpb25CaW5kQ29udGV4dDsKICB2YXIgaHRtbCA9IGh0bWwkMjsKICB2YXIgY3JlYXRlRWxlbWVudCA9IGRvY3VtZW50Q3JlYXRlRWxlbWVudCQxOwogIHZhciBJU19JT1MkMSA9IGVuZ2luZUlzSW9zOwogIHZhciBJU19OT0RFJDMgPSBlbmdpbmVJc05vZGU7CiAgdmFyIHNldCA9IGdsb2JhbCQ5LnNldEltbWVkaWF0ZTsKICB2YXIgY2xlYXIgPSBnbG9iYWwkOS5jbGVhckltbWVkaWF0ZTsKICB2YXIgcHJvY2VzcyQzID0gZ2xvYmFsJDkucHJvY2VzczsKICB2YXIgTWVzc2FnZUNoYW5uZWwgPSBnbG9iYWwkOS5NZXNzYWdlQ2hhbm5lbDsKICB2YXIgRGlzcGF0Y2ggPSBnbG9iYWwkOS5EaXNwYXRjaDsKICB2YXIgY291bnRlciA9IDA7CiAgdmFyIHF1ZXVlID0ge307CiAgdmFyIE9OUkVBRFlTVEFURUNIQU5HRSA9ICJvbnJlYWR5c3RhdGVjaGFuZ2UiOwogIHZhciBsb2NhdGlvbiwgZGVmZXIsIGNoYW5uZWwsIHBvcnQ7CiAgdHJ5IHsKICAgIGxvY2F0aW9uID0gZ2xvYmFsJDkubG9jYXRpb247CiAgfSBjYXRjaCAoZXJyb3IpIHsKICB9CiAgdmFyIHJ1biA9IGZ1bmN0aW9uKGlkMikgewogICAgaWYgKHF1ZXVlLmhhc093blByb3BlcnR5KGlkMikpIHsKICAgICAgdmFyIGZuID0gcXVldWVbaWQyXTsKICAgICAgZGVsZXRlIHF1ZXVlW2lkMl07CiAgICAgIGZuKCk7CiAgICB9CiAgfTsKICB2YXIgcnVubmVyID0gZnVuY3Rpb24oaWQyKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHJ1bihpZDIpOwogICAgfTsKICB9OwogIHZhciBsaXN0ZW5lciA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBydW4oZXZlbnQuZGF0YSk7CiAgfTsKICB2YXIgcG9zdCA9IGZ1bmN0aW9uKGlkMikgewogICAgZ2xvYmFsJDkucG9zdE1lc3NhZ2UoU3RyaW5nKGlkMiksIGxvY2F0aW9uLnByb3RvY29sICsgIi8vIiArIGxvY2F0aW9uLmhvc3QpOwogIH07CiAgaWYgKCFzZXQgfHwgIWNsZWFyKSB7CiAgICBzZXQgPSBmdW5jdGlvbiBzZXRJbW1lZGlhdGUoZm4pIHsKICAgICAgdmFyIGFyZ3MgPSBbXTsKICAgICAgdmFyIGFyZ3VtZW50c0xlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICAgIHZhciBpMiA9IDE7CiAgICAgIHdoaWxlIChhcmd1bWVudHNMZW5ndGggPiBpMikKICAgICAgICBhcmdzLnB1c2goYXJndW1lbnRzW2kyKytdKTsKICAgICAgcXVldWVbKytjb3VudGVyXSA9IGZ1bmN0aW9uKCkgewogICAgICAgIChpc0NhbGxhYmxlJDUoZm4pID8gZm4gOiBGdW5jdGlvbihmbikpLmFwcGx5KHZvaWQgMCwgYXJncyk7CiAgICAgIH07CiAgICAgIGRlZmVyKGNvdW50ZXIpOwogICAgICByZXR1cm4gY291bnRlcjsKICAgIH07CiAgICBjbGVhciA9IGZ1bmN0aW9uIGNsZWFySW1tZWRpYXRlKGlkMikgewogICAgICBkZWxldGUgcXVldWVbaWQyXTsKICAgIH07CiAgICBpZiAoSVNfTk9ERSQzKSB7CiAgICAgIGRlZmVyID0gZnVuY3Rpb24oaWQyKSB7CiAgICAgICAgcHJvY2VzcyQzLm5leHRUaWNrKHJ1bm5lcihpZDIpKTsKICAgICAgfTsKICAgIH0gZWxzZSBpZiAoRGlzcGF0Y2ggJiYgRGlzcGF0Y2gubm93KSB7CiAgICAgIGRlZmVyID0gZnVuY3Rpb24oaWQyKSB7CiAgICAgICAgRGlzcGF0Y2gubm93KHJ1bm5lcihpZDIpKTsKICAgICAgfTsKICAgIH0gZWxzZSBpZiAoTWVzc2FnZUNoYW5uZWwgJiYgIUlTX0lPUyQxKSB7CiAgICAgIGNoYW5uZWwgPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTsKICAgICAgcG9ydCA9IGNoYW5uZWwucG9ydDI7CiAgICAgIGNoYW5uZWwucG9ydDEub25tZXNzYWdlID0gbGlzdGVuZXI7CiAgICAgIGRlZmVyID0gYmluZCQ3KHBvcnQucG9zdE1lc3NhZ2UsIHBvcnQsIDEpOwogICAgfSBlbHNlIGlmIChnbG9iYWwkOS5hZGRFdmVudExpc3RlbmVyICYmIGlzQ2FsbGFibGUkNShnbG9iYWwkOS5wb3N0TWVzc2FnZSkgJiYgIWdsb2JhbCQ5LmltcG9ydFNjcmlwdHMgJiYgbG9jYXRpb24gJiYgbG9jYXRpb24ucHJvdG9jb2wgIT09ICJmaWxlOiIgJiYgIWZhaWxzJDcocG9zdCkpIHsKICAgICAgZGVmZXIgPSBwb3N0OwogICAgICBnbG9iYWwkOS5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgbGlzdGVuZXIsIGZhbHNlKTsKICAgIH0gZWxzZSBpZiAoT05SRUFEWVNUQVRFQ0hBTkdFIGluIGNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpKSB7CiAgICAgIGRlZmVyID0gZnVuY3Rpb24oaWQyKSB7CiAgICAgICAgaHRtbC5hcHBlbmRDaGlsZChjcmVhdGVFbGVtZW50KCJzY3JpcHQiKSlbT05SRUFEWVNUQVRFQ0hBTkdFXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgaHRtbC5yZW1vdmVDaGlsZCh0aGlzKTsKICAgICAgICAgIHJ1bihpZDIpOwogICAgICAgIH07CiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICBkZWZlciA9IGZ1bmN0aW9uKGlkMikgewogICAgICAgIHNldFRpbWVvdXQocnVubmVyKGlkMiksIDApOwogICAgICB9OwogICAgfQogIH0KICB2YXIgdGFzayQxID0gewogICAgc2V0LAogICAgY2xlYXIKICB9OwogIHZhciB1c2VyQWdlbnQkNCA9IGVuZ2luZVVzZXJBZ2VudDsKICB2YXIgZ2xvYmFsJDggPSBnbG9iYWwkbzsKICB2YXIgZW5naW5lSXNJb3NQZWJibGUgPSAvaXBhZHxpcGhvbmV8aXBvZC9pLnRlc3QodXNlckFnZW50JDQpICYmIGdsb2JhbCQ4LlBlYmJsZSAhPT0gdm9pZCAwOwogIHZhciB1c2VyQWdlbnQkMyA9IGVuZ2luZVVzZXJBZ2VudDsKICB2YXIgZW5naW5lSXNXZWJvc1dlYmtpdCA9IC93ZWIwcyg/IS4qY2hyb21lKS9pLnRlc3QodXNlckFnZW50JDMpOwogIHZhciBnbG9iYWwkNyA9IGdsb2JhbCRvOwogIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMiA9IG9iamVjdEdldE93blByb3BlcnR5RGVzY3JpcHRvci5mOwogIHZhciBtYWNyb3Rhc2sgPSB0YXNrJDEuc2V0OwogIHZhciBJU19JT1MgPSBlbmdpbmVJc0lvczsKICB2YXIgSVNfSU9TX1BFQkJMRSA9IGVuZ2luZUlzSW9zUGViYmxlOwogIHZhciBJU19XRUJPU19XRUJLSVQgPSBlbmdpbmVJc1dlYm9zV2Via2l0OwogIHZhciBJU19OT0RFJDIgPSBlbmdpbmVJc05vZGU7CiAgdmFyIE11dGF0aW9uT2JzZXJ2ZXIgPSBnbG9iYWwkNy5NdXRhdGlvbk9ic2VydmVyIHx8IGdsb2JhbCQ3LldlYktpdE11dGF0aW9uT2JzZXJ2ZXI7CiAgdmFyIGRvY3VtZW50JDIgPSBnbG9iYWwkNy5kb2N1bWVudDsKICB2YXIgcHJvY2VzcyQyID0gZ2xvYmFsJDcucHJvY2VzczsKICB2YXIgUHJvbWlzZSQxID0gZ2xvYmFsJDcuUHJvbWlzZTsKICB2YXIgcXVldWVNaWNyb3Rhc2tEZXNjcmlwdG9yID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yJDIoZ2xvYmFsJDcsICJxdWV1ZU1pY3JvdGFzayIpOwogIHZhciBxdWV1ZU1pY3JvdGFzayA9IHF1ZXVlTWljcm90YXNrRGVzY3JpcHRvciAmJiBxdWV1ZU1pY3JvdGFza0Rlc2NyaXB0b3IudmFsdWU7CiAgdmFyIGZsdXNoLCBoZWFkLCBsYXN0LCBub3RpZnkkMSwgdG9nZ2xlLCBub2RlLCBwcm9taXNlJDUsIHRoZW47CiAgaWYgKCFxdWV1ZU1pY3JvdGFzaykgewogICAgZmx1c2ggPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHBhcmVudDIsIGZuOwogICAgICBpZiAoSVNfTk9ERSQyICYmIChwYXJlbnQyID0gcHJvY2VzcyQyLmRvbWFpbikpCiAgICAgICAgcGFyZW50Mi5leGl0KCk7CiAgICAgIHdoaWxlIChoZWFkKSB7CiAgICAgICAgZm4gPSBoZWFkLmZuOwogICAgICAgIGhlYWQgPSBoZWFkLm5leHQ7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZuKCk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGlmIChoZWFkKQogICAgICAgICAgICBub3RpZnkkMSgpOwogICAgICAgICAgZWxzZQogICAgICAgICAgICBsYXN0ID0gdm9pZCAwOwogICAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxhc3QgPSB2b2lkIDA7CiAgICAgIGlmIChwYXJlbnQyKQogICAgICAgIHBhcmVudDIuZW50ZXIoKTsKICAgIH07CiAgICBpZiAoIUlTX0lPUyAmJiAhSVNfTk9ERSQyICYmICFJU19XRUJPU19XRUJLSVQgJiYgTXV0YXRpb25PYnNlcnZlciAmJiBkb2N1bWVudCQyKSB7CiAgICAgIHRvZ2dsZSA9IHRydWU7CiAgICAgIG5vZGUgPSBkb2N1bWVudCQyLmNyZWF0ZVRleHROb2RlKCIiKTsKICAgICAgbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZmx1c2gpLm9ic2VydmUobm9kZSwgeyBjaGFyYWN0ZXJEYXRhOiB0cnVlIH0pOwogICAgICBub3RpZnkkMSA9IGZ1bmN0aW9uKCkgewogICAgICAgIG5vZGUuZGF0YSA9IHRvZ2dsZSA9ICF0b2dnbGU7CiAgICAgIH07CiAgICB9IGVsc2UgaWYgKCFJU19JT1NfUEVCQkxFICYmIFByb21pc2UkMSAmJiBQcm9taXNlJDEucmVzb2x2ZSkgewogICAgICBwcm9taXNlJDUgPSBQcm9taXNlJDEucmVzb2x2ZSh2b2lkIDApOwogICAgICBwcm9taXNlJDUuY29uc3RydWN0b3IgPSBQcm9taXNlJDE7CiAgICAgIHRoZW4gPSBwcm9taXNlJDUudGhlbjsKICAgICAgbm90aWZ5JDEgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGVuLmNhbGwocHJvbWlzZSQ1LCBmbHVzaCk7CiAgICAgIH07CiAgICB9IGVsc2UgaWYgKElTX05PREUkMikgewogICAgICBub3RpZnkkMSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHByb2Nlc3MkMi5uZXh0VGljayhmbHVzaCk7CiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICBub3RpZnkkMSA9IGZ1bmN0aW9uKCkgewogICAgICAgIG1hY3JvdGFzay5jYWxsKGdsb2JhbCQ3LCBmbHVzaCk7CiAgICAgIH07CiAgICB9CiAgfQogIHZhciBtaWNyb3Rhc2skMSA9IHF1ZXVlTWljcm90YXNrIHx8IGZ1bmN0aW9uKGZuKSB7CiAgICB2YXIgdGFzazIgPSB7IGZuLCBuZXh0OiB2b2lkIDAgfTsKICAgIGlmIChsYXN0KQogICAgICBsYXN0Lm5leHQgPSB0YXNrMjsKICAgIGlmICghaGVhZCkgewogICAgICBoZWFkID0gdGFzazI7CiAgICAgIG5vdGlmeSQxKCk7CiAgICB9CiAgICBsYXN0ID0gdGFzazI7CiAgfTsKICB2YXIgbmV3UHJvbWlzZUNhcGFiaWxpdHkkMiA9IHt9OwogIHZhciBhQ2FsbGFibGUkNyA9IGFDYWxsYWJsZSRjOwogIHZhciBQcm9taXNlQ2FwYWJpbGl0eSA9IGZ1bmN0aW9uKEMpIHsKICAgIHZhciByZXNvbHZlLCByZWplY3Q7CiAgICB0aGlzLnByb21pc2UgPSBuZXcgQyhmdW5jdGlvbigkJHJlc29sdmUsICQkcmVqZWN0KSB7CiAgICAgIGlmIChyZXNvbHZlICE9PSB2b2lkIDAgfHwgcmVqZWN0ICE9PSB2b2lkIDApCiAgICAgICAgdGhyb3cgVHlwZUVycm9yKCJCYWQgUHJvbWlzZSBjb25zdHJ1Y3RvciIpOwogICAgICByZXNvbHZlID0gJCRyZXNvbHZlOwogICAgICByZWplY3QgPSAkJHJlamVjdDsKICAgIH0pOwogICAgdGhpcy5yZXNvbHZlID0gYUNhbGxhYmxlJDcocmVzb2x2ZSk7CiAgICB0aGlzLnJlamVjdCA9IGFDYWxsYWJsZSQ3KHJlamVjdCk7CiAgfTsKICBuZXdQcm9taXNlQ2FwYWJpbGl0eSQyLmYgPSBmdW5jdGlvbihDKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2VDYXBhYmlsaXR5KEMpOwogIH07CiAgdmFyIGFuT2JqZWN0JDUgPSBhbk9iamVjdCRpOwogIHZhciBpc09iamVjdCQ2ID0gaXNPYmplY3QkaTsKICB2YXIgbmV3UHJvbWlzZUNhcGFiaWxpdHkkMSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5JDI7CiAgdmFyIHByb21pc2VSZXNvbHZlJDIgPSBmdW5jdGlvbihDLCB4KSB7CiAgICBhbk9iamVjdCQ1KEMpOwogICAgaWYgKGlzT2JqZWN0JDYoeCkgJiYgeC5jb25zdHJ1Y3RvciA9PT0gQykKICAgICAgcmV0dXJuIHg7CiAgICB2YXIgcHJvbWlzZUNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eSQxLmYoQyk7CiAgICB2YXIgcmVzb2x2ZSA9IHByb21pc2VDYXBhYmlsaXR5LnJlc29sdmU7CiAgICByZXNvbHZlKHgpOwogICAgcmV0dXJuIHByb21pc2VDYXBhYmlsaXR5LnByb21pc2U7CiAgfTsKICB2YXIgZ2xvYmFsJDYgPSBnbG9iYWwkbzsKICB2YXIgaG9zdFJlcG9ydEVycm9ycyQxID0gZnVuY3Rpb24oYSwgYikgewogICAgdmFyIGNvbnNvbGUyID0gZ2xvYmFsJDYuY29uc29sZTsKICAgIGlmIChjb25zb2xlMiAmJiBjb25zb2xlMi5lcnJvcikgewogICAgICBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gY29uc29sZTIuZXJyb3IoYSkgOiBjb25zb2xlMi5lcnJvcihhLCBiKTsKICAgIH0KICB9OwogIHZhciBwZXJmb3JtJDQgPSBmdW5jdGlvbihleGVjMikgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIHsgZXJyb3I6IGZhbHNlLCB2YWx1ZTogZXhlYzIoKSB9OwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgcmV0dXJuIHsgZXJyb3I6IHRydWUsIHZhbHVlOiBlcnJvciB9OwogICAgfQogIH07CiAgdmFyIGVuZ2luZUlzQnJvd3NlciA9IHR5cGVvZiB3aW5kb3cgPT0gIm9iamVjdCI7CiAgdmFyICQkcCA9IF9leHBvcnQ7CiAgdmFyIElTX1BVUkUkMyA9IGlzUHVyZTsKICB2YXIgZ2xvYmFsJDUgPSBnbG9iYWwkbzsKICB2YXIgZ2V0QnVpbHRJbiQyID0gZ2V0QnVpbHRJbiRiOwogIHZhciBOYXRpdmVQcm9taXNlJDEgPSBuYXRpdmVQcm9taXNlQ29uc3RydWN0b3I7CiAgdmFyIHJlZGVmaW5lQWxsJDIgPSByZWRlZmluZUFsbCQzOwogIHZhciBzZXRUb1N0cmluZ1RhZyQxID0gc2V0VG9TdHJpbmdUYWckNjsKICB2YXIgc2V0U3BlY2llcyA9IHNldFNwZWNpZXMkMTsKICB2YXIgYUNhbGxhYmxlJDYgPSBhQ2FsbGFibGUkYzsKICB2YXIgaXNDYWxsYWJsZSQ0ID0gaXNDYWxsYWJsZSRsOwogIHZhciBpc09iamVjdCQ1ID0gaXNPYmplY3QkaTsKICB2YXIgYW5JbnN0YW5jZSQyID0gYW5JbnN0YW5jZSQzOwogIHZhciBpbnNwZWN0U291cmNlID0gaW5zcGVjdFNvdXJjZSQzOwogIHZhciBpdGVyYXRlJDUgPSBpdGVyYXRlJDc7CiAgdmFyIGNoZWNrQ29ycmVjdG5lc3NPZkl0ZXJhdGlvbiA9IGNoZWNrQ29ycmVjdG5lc3NPZkl0ZXJhdGlvbiQyOwogIHZhciBzcGVjaWVzQ29uc3RydWN0b3IkMSA9IHNwZWNpZXNDb25zdHJ1Y3RvciQyOwogIHZhciB0YXNrID0gdGFzayQxLnNldDsKICB2YXIgbWljcm90YXNrID0gbWljcm90YXNrJDE7CiAgdmFyIHByb21pc2VSZXNvbHZlJDEgPSBwcm9taXNlUmVzb2x2ZSQyOwogIHZhciBob3N0UmVwb3J0RXJyb3JzID0gaG9zdFJlcG9ydEVycm9ycyQxOwogIHZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eU1vZHVsZSQzID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkkMjsKICB2YXIgcGVyZm9ybSQzID0gcGVyZm9ybSQ0OwogIHZhciBJbnRlcm5hbFN0YXRlTW9kdWxlJDIgPSBpbnRlcm5hbFN0YXRlOwogIHZhciBpc0ZvcmNlZCA9IGlzRm9yY2VkXzE7CiAgdmFyIHdlbGxLbm93blN5bWJvbCQyID0gd2VsbEtub3duU3ltYm9sJGw7CiAgdmFyIElTX0JST1dTRVIgPSBlbmdpbmVJc0Jyb3dzZXI7CiAgdmFyIElTX05PREUkMSA9IGVuZ2luZUlzTm9kZTsKICB2YXIgVjhfVkVSU0lPTiA9IGVuZ2luZVY4VmVyc2lvbjsKICB2YXIgU1BFQ0lFUyA9IHdlbGxLbm93blN5bWJvbCQyKCJzcGVjaWVzIik7CiAgdmFyIFBST01JU0UgPSAiUHJvbWlzZSI7CiAgdmFyIGdldEludGVybmFsU3RhdGUgPSBJbnRlcm5hbFN0YXRlTW9kdWxlJDIuZ2V0OwogIHZhciBzZXRJbnRlcm5hbFN0YXRlJDIgPSBJbnRlcm5hbFN0YXRlTW9kdWxlJDIuc2V0OwogIHZhciBnZXRJbnRlcm5hbFByb21pc2VTdGF0ZSA9IEludGVybmFsU3RhdGVNb2R1bGUkMi5nZXR0ZXJGb3IoUFJPTUlTRSk7CiAgdmFyIE5hdGl2ZVByb21pc2VQcm90b3R5cGUgPSBOYXRpdmVQcm9taXNlJDEgJiYgTmF0aXZlUHJvbWlzZSQxLnByb3RvdHlwZTsKICB2YXIgUHJvbWlzZUNvbnN0cnVjdG9yID0gTmF0aXZlUHJvbWlzZSQxOwogIHZhciBQcm9taXNlQ29uc3RydWN0b3JQcm90b3R5cGUgPSBOYXRpdmVQcm9taXNlUHJvdG90eXBlOwogIHZhciBUeXBlRXJyb3IkMSA9IGdsb2JhbCQ1LlR5cGVFcnJvcjsKICB2YXIgZG9jdW1lbnQkMSA9IGdsb2JhbCQ1LmRvY3VtZW50OwogIHZhciBwcm9jZXNzJDEgPSBnbG9iYWwkNS5wcm9jZXNzOwogIHZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5TW9kdWxlJDMuZjsKICB2YXIgbmV3R2VuZXJpY1Byb21pc2VDYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHk7CiAgdmFyIERJU1BBVENIX0VWRU5UID0gISEoZG9jdW1lbnQkMSAmJiBkb2N1bWVudCQxLmNyZWF0ZUV2ZW50ICYmIGdsb2JhbCQ1LmRpc3BhdGNoRXZlbnQpOwogIHZhciBOQVRJVkVfUkVKRUNUSU9OX0VWRU5UID0gaXNDYWxsYWJsZSQ0KGdsb2JhbCQ1LlByb21pc2VSZWplY3Rpb25FdmVudCk7CiAgdmFyIFVOSEFORExFRF9SRUpFQ1RJT04gPSAidW5oYW5kbGVkcmVqZWN0aW9uIjsKICB2YXIgUkVKRUNUSU9OX0hBTkRMRUQgPSAicmVqZWN0aW9uaGFuZGxlZCI7CiAgdmFyIFBFTkRJTkcgPSAwOwogIHZhciBGVUxGSUxMRUQgPSAxOwogIHZhciBSRUpFQ1RFRCA9IDI7CiAgdmFyIEhBTkRMRUQgPSAxOwogIHZhciBVTkhBTkRMRUQgPSAyOwogIHZhciBTVUJDTEFTU0lORyA9IGZhbHNlOwogIHZhciBJbnRlcm5hbCwgT3duUHJvbWlzZUNhcGFiaWxpdHksIFByb21pc2VXcmFwcGVyOwogIHZhciBGT1JDRUQkMiA9IGlzRm9yY2VkKFBST01JU0UsIGZ1bmN0aW9uKCkgewogICAgdmFyIFBST01JU0VfQ09OU1RSVUNUT1JfU09VUkNFID0gaW5zcGVjdFNvdXJjZShQcm9taXNlQ29uc3RydWN0b3IpOwogICAgdmFyIEdMT0JBTF9DT1JFX0pTX1BST01JU0UgPSBQUk9NSVNFX0NPTlNUUlVDVE9SX1NPVVJDRSAhPT0gU3RyaW5nKFByb21pc2VDb25zdHJ1Y3Rvcik7CiAgICBpZiAoIUdMT0JBTF9DT1JFX0pTX1BST01JU0UgJiYgVjhfVkVSU0lPTiA9PT0gNjYpCiAgICAgIHJldHVybiB0cnVlOwogICAgaWYgKCFQcm9taXNlQ29uc3RydWN0b3JQcm90b3R5cGVbImZpbmFsbHkiXSkKICAgICAgcmV0dXJuIHRydWU7CiAgICBpZiAoVjhfVkVSU0lPTiA+PSA1MSAmJiAvbmF0aXZlIGNvZGUvLnRlc3QoUFJPTUlTRV9DT05TVFJVQ1RPUl9TT1VSQ0UpKQogICAgICByZXR1cm4gZmFsc2U7CiAgICB2YXIgcHJvbWlzZTIgPSBuZXcgUHJvbWlzZUNvbnN0cnVjdG9yKGZ1bmN0aW9uKHJlc29sdmUpIHsKICAgICAgcmVzb2x2ZSgxKTsKICAgIH0pOwogICAgdmFyIEZha2VQcm9taXNlID0gZnVuY3Rpb24oZXhlYzIpIHsKICAgICAgZXhlYzIoZnVuY3Rpb24oKSB7CiAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICB9KTsKICAgIH07CiAgICB2YXIgY29uc3RydWN0b3IgPSBwcm9taXNlMi5jb25zdHJ1Y3RvciA9IHt9OwogICAgY29uc3RydWN0b3JbU1BFQ0lFU10gPSBGYWtlUHJvbWlzZTsKICAgIFNVQkNMQVNTSU5HID0gcHJvbWlzZTIudGhlbihmdW5jdGlvbigpIHsKICAgIH0pIGluc3RhbmNlb2YgRmFrZVByb21pc2U7CiAgICBpZiAoIVNVQkNMQVNTSU5HKQogICAgICByZXR1cm4gdHJ1ZTsKICAgIHJldHVybiAhR0xPQkFMX0NPUkVfSlNfUFJPTUlTRSAmJiBJU19CUk9XU0VSICYmICFOQVRJVkVfUkVKRUNUSU9OX0VWRU5UOwogIH0pOwogIHZhciBJTkNPUlJFQ1RfSVRFUkFUSU9OID0gRk9SQ0VEJDIgfHwgIWNoZWNrQ29ycmVjdG5lc3NPZkl0ZXJhdGlvbihmdW5jdGlvbihpdGVyYWJsZSkgewogICAgUHJvbWlzZUNvbnN0cnVjdG9yLmFsbChpdGVyYWJsZSlbImNhdGNoIl0oZnVuY3Rpb24oKSB7CiAgICB9KTsKICB9KTsKICB2YXIgaXNUaGVuYWJsZSA9IGZ1bmN0aW9uKGl0KSB7CiAgICB2YXIgdGhlbjI7CiAgICByZXR1cm4gaXNPYmplY3QkNShpdCkgJiYgaXNDYWxsYWJsZSQ0KHRoZW4yID0gaXQudGhlbikgPyB0aGVuMiA6IGZhbHNlOwogIH07CiAgdmFyIG5vdGlmeSA9IGZ1bmN0aW9uKHN0YXRlLCBpc1JlamVjdCkgewogICAgaWYgKHN0YXRlLm5vdGlmaWVkKQogICAgICByZXR1cm47CiAgICBzdGF0ZS5ub3RpZmllZCA9IHRydWU7CiAgICB2YXIgY2hhaW4gPSBzdGF0ZS5yZWFjdGlvbnM7CiAgICBtaWNyb3Rhc2soZnVuY3Rpb24oKSB7CiAgICAgIHZhciB2YWx1ZSA9IHN0YXRlLnZhbHVlOwogICAgICB2YXIgb2sgPSBzdGF0ZS5zdGF0ZSA9PSBGVUxGSUxMRUQ7CiAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgIHdoaWxlIChjaGFpbi5sZW5ndGggPiBpbmRleCkgewogICAgICAgIHZhciByZWFjdGlvbiA9IGNoYWluW2luZGV4KytdOwogICAgICAgIHZhciBoYW5kbGVyID0gb2sgPyByZWFjdGlvbi5vayA6IHJlYWN0aW9uLmZhaWw7CiAgICAgICAgdmFyIHJlc29sdmUgPSByZWFjdGlvbi5yZXNvbHZlOwogICAgICAgIHZhciByZWplY3QgPSByZWFjdGlvbi5yZWplY3Q7CiAgICAgICAgdmFyIGRvbWFpbiA9IHJlYWN0aW9uLmRvbWFpbjsKICAgICAgICB2YXIgcmVzdWx0LCB0aGVuMiwgZXhpdGVkOwogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoaGFuZGxlcikgewogICAgICAgICAgICBpZiAoIW9rKSB7CiAgICAgICAgICAgICAgaWYgKHN0YXRlLnJlamVjdGlvbiA9PT0gVU5IQU5ETEVEKQogICAgICAgICAgICAgICAgb25IYW5kbGVVbmhhbmRsZWQoc3RhdGUpOwogICAgICAgICAgICAgIHN0YXRlLnJlamVjdGlvbiA9IEhBTkRMRUQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhhbmRsZXIgPT09IHRydWUpCiAgICAgICAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGlmIChkb21haW4pCiAgICAgICAgICAgICAgICBkb21haW4uZW50ZXIoKTsKICAgICAgICAgICAgICByZXN1bHQgPSBoYW5kbGVyKHZhbHVlKTsKICAgICAgICAgICAgICBpZiAoZG9tYWluKSB7CiAgICAgICAgICAgICAgICBkb21haW4uZXhpdCgpOwogICAgICAgICAgICAgICAgZXhpdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gcmVhY3Rpb24ucHJvbWlzZSkgewogICAgICAgICAgICAgIHJlamVjdChUeXBlRXJyb3IkMSgiUHJvbWlzZS1jaGFpbiBjeWNsZSIpKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGVuMiA9IGlzVGhlbmFibGUocmVzdWx0KSkgewogICAgICAgICAgICAgIHRoZW4yLmNhbGwocmVzdWx0LCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgcmVqZWN0KHZhbHVlKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgaWYgKGRvbWFpbiAmJiAhZXhpdGVkKQogICAgICAgICAgICBkb21haW4uZXhpdCgpOwogICAgICAgICAgcmVqZWN0KGVycm9yKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgc3RhdGUucmVhY3Rpb25zID0gW107CiAgICAgIHN0YXRlLm5vdGlmaWVkID0gZmFsc2U7CiAgICAgIGlmIChpc1JlamVjdCAmJiAhc3RhdGUucmVqZWN0aW9uKQogICAgICAgIG9uVW5oYW5kbGVkKHN0YXRlKTsKICAgIH0pOwogIH07CiAgdmFyIGRpc3BhdGNoRXZlbnQgPSBmdW5jdGlvbihuYW1lLCBwcm9taXNlMiwgcmVhc29uKSB7CiAgICB2YXIgZXZlbnQsIGhhbmRsZXI7CiAgICBpZiAoRElTUEFUQ0hfRVZFTlQpIHsKICAgICAgZXZlbnQgPSBkb2N1bWVudCQxLmNyZWF0ZUV2ZW50KCJFdmVudCIpOwogICAgICBldmVudC5wcm9taXNlID0gcHJvbWlzZTI7CiAgICAgIGV2ZW50LnJlYXNvbiA9IHJlYXNvbjsKICAgICAgZXZlbnQuaW5pdEV2ZW50KG5hbWUsIGZhbHNlLCB0cnVlKTsKICAgICAgZ2xvYmFsJDUuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICB9IGVsc2UKICAgICAgZXZlbnQgPSB7IHByb21pc2U6IHByb21pc2UyLCByZWFzb24gfTsKICAgIGlmICghTkFUSVZFX1JFSkVDVElPTl9FVkVOVCAmJiAoaGFuZGxlciA9IGdsb2JhbCQ1WyJvbiIgKyBuYW1lXSkpCiAgICAgIGhhbmRsZXIoZXZlbnQpOwogICAgZWxzZSBpZiAobmFtZSA9PT0gVU5IQU5ETEVEX1JFSkVDVElPTikKICAgICAgaG9zdFJlcG9ydEVycm9ycygiVW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uIiwgcmVhc29uKTsKICB9OwogIHZhciBvblVuaGFuZGxlZCA9IGZ1bmN0aW9uKHN0YXRlKSB7CiAgICB0YXNrLmNhbGwoZ2xvYmFsJDUsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgcHJvbWlzZTIgPSBzdGF0ZS5mYWNhZGU7CiAgICAgIHZhciB2YWx1ZSA9IHN0YXRlLnZhbHVlOwogICAgICB2YXIgSVNfVU5IQU5ETEVEID0gaXNVbmhhbmRsZWQoc3RhdGUpOwogICAgICB2YXIgcmVzdWx0OwogICAgICBpZiAoSVNfVU5IQU5ETEVEKSB7CiAgICAgICAgcmVzdWx0ID0gcGVyZm9ybSQzKGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKElTX05PREUkMSkgewogICAgICAgICAgICBwcm9jZXNzJDEuZW1pdCgidW5oYW5kbGVkUmVqZWN0aW9uIiwgdmFsdWUsIHByb21pc2UyKTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBkaXNwYXRjaEV2ZW50KFVOSEFORExFRF9SRUpFQ1RJT04sIHByb21pc2UyLCB2YWx1ZSk7CiAgICAgICAgfSk7CiAgICAgICAgc3RhdGUucmVqZWN0aW9uID0gSVNfTk9ERSQxIHx8IGlzVW5oYW5kbGVkKHN0YXRlKSA/IFVOSEFORExFRCA6IEhBTkRMRUQ7CiAgICAgICAgaWYgKHJlc3VsdC5lcnJvcikKICAgICAgICAgIHRocm93IHJlc3VsdC52YWx1ZTsKICAgICAgfQogICAgfSk7CiAgfTsKICB2YXIgaXNVbmhhbmRsZWQgPSBmdW5jdGlvbihzdGF0ZSkgewogICAgcmV0dXJuIHN0YXRlLnJlamVjdGlvbiAhPT0gSEFORExFRCAmJiAhc3RhdGUucGFyZW50OwogIH07CiAgdmFyIG9uSGFuZGxlVW5oYW5kbGVkID0gZnVuY3Rpb24oc3RhdGUpIHsKICAgIHRhc2suY2FsbChnbG9iYWwkNSwgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBwcm9taXNlMiA9IHN0YXRlLmZhY2FkZTsKICAgICAgaWYgKElTX05PREUkMSkgewogICAgICAgIHByb2Nlc3MkMS5lbWl0KCJyZWplY3Rpb25IYW5kbGVkIiwgcHJvbWlzZTIpOwogICAgICB9IGVsc2UKICAgICAgICBkaXNwYXRjaEV2ZW50KFJFSkVDVElPTl9IQU5ETEVELCBwcm9taXNlMiwgc3RhdGUudmFsdWUpOwogICAgfSk7CiAgfTsKICB2YXIgYmluZCQ2ID0gZnVuY3Rpb24oZm4sIHN0YXRlLCB1bndyYXApIHsKICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSkgewogICAgICBmbihzdGF0ZSwgdmFsdWUsIHVud3JhcCk7CiAgICB9OwogIH07CiAgdmFyIGludGVybmFsUmVqZWN0ID0gZnVuY3Rpb24oc3RhdGUsIHZhbHVlLCB1bndyYXApIHsKICAgIGlmIChzdGF0ZS5kb25lKQogICAgICByZXR1cm47CiAgICBzdGF0ZS5kb25lID0gdHJ1ZTsKICAgIGlmICh1bndyYXApCiAgICAgIHN0YXRlID0gdW53cmFwOwogICAgc3RhdGUudmFsdWUgPSB2YWx1ZTsKICAgIHN0YXRlLnN0YXRlID0gUkVKRUNURUQ7CiAgICBub3RpZnkoc3RhdGUsIHRydWUpOwogIH07CiAgdmFyIGludGVybmFsUmVzb2x2ZSA9IGZ1bmN0aW9uKHN0YXRlLCB2YWx1ZSwgdW53cmFwKSB7CiAgICBpZiAoc3RhdGUuZG9uZSkKICAgICAgcmV0dXJuOwogICAgc3RhdGUuZG9uZSA9IHRydWU7CiAgICBpZiAodW53cmFwKQogICAgICBzdGF0ZSA9IHVud3JhcDsKICAgIHRyeSB7CiAgICAgIGlmIChzdGF0ZS5mYWNhZGUgPT09IHZhbHVlKQogICAgICAgIHRocm93IFR5cGVFcnJvciQxKCJQcm9taXNlIGNhbid0IGJlIHJlc29sdmVkIGl0c2VsZiIpOwogICAgICB2YXIgdGhlbjIgPSBpc1RoZW5hYmxlKHZhbHVlKTsKICAgICAgaWYgKHRoZW4yKSB7CiAgICAgICAgbWljcm90YXNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHdyYXBwZXIyID0geyBkb25lOiBmYWxzZSB9OwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdGhlbjIuY2FsbCh2YWx1ZSwgYmluZCQ2KGludGVybmFsUmVzb2x2ZSwgd3JhcHBlcjIsIHN0YXRlKSwgYmluZCQ2KGludGVybmFsUmVqZWN0LCB3cmFwcGVyMiwgc3RhdGUpKTsKICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGludGVybmFsUmVqZWN0KHdyYXBwZXIyLCBlcnJvciwgc3RhdGUpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHN0YXRlLnZhbHVlID0gdmFsdWU7CiAgICAgICAgc3RhdGUuc3RhdGUgPSBGVUxGSUxMRUQ7CiAgICAgICAgbm90aWZ5KHN0YXRlLCBmYWxzZSk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIGludGVybmFsUmVqZWN0KHsgZG9uZTogZmFsc2UgfSwgZXJyb3IsIHN0YXRlKTsKICAgIH0KICB9OwogIGlmIChGT1JDRUQkMikgewogICAgUHJvbWlzZUNvbnN0cnVjdG9yID0gZnVuY3Rpb24gUHJvbWlzZTIoZXhlY3V0b3IpIHsKICAgICAgYW5JbnN0YW5jZSQyKHRoaXMsIFByb21pc2VDb25zdHJ1Y3RvciwgUFJPTUlTRSk7CiAgICAgIGFDYWxsYWJsZSQ2KGV4ZWN1dG9yKTsKICAgICAgSW50ZXJuYWwuY2FsbCh0aGlzKTsKICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxTdGF0ZSh0aGlzKTsKICAgICAgdHJ5IHsKICAgICAgICBleGVjdXRvcihiaW5kJDYoaW50ZXJuYWxSZXNvbHZlLCBzdGF0ZSksIGJpbmQkNihpbnRlcm5hbFJlamVjdCwgc3RhdGUpKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBpbnRlcm5hbFJlamVjdChzdGF0ZSwgZXJyb3IpOwogICAgICB9CiAgICB9OwogICAgUHJvbWlzZUNvbnN0cnVjdG9yUHJvdG90eXBlID0gUHJvbWlzZUNvbnN0cnVjdG9yLnByb3RvdHlwZTsKICAgIEludGVybmFsID0gZnVuY3Rpb24gUHJvbWlzZTIoZXhlY3V0b3IpIHsKICAgICAgc2V0SW50ZXJuYWxTdGF0ZSQyKHRoaXMsIHsKICAgICAgICB0eXBlOiBQUk9NSVNFLAogICAgICAgIGRvbmU6IGZhbHNlLAogICAgICAgIG5vdGlmaWVkOiBmYWxzZSwKICAgICAgICBwYXJlbnQ6IGZhbHNlLAogICAgICAgIHJlYWN0aW9uczogW10sCiAgICAgICAgcmVqZWN0aW9uOiBmYWxzZSwKICAgICAgICBzdGF0ZTogUEVORElORywKICAgICAgICB2YWx1ZTogdm9pZCAwCiAgICAgIH0pOwogICAgfTsKICAgIEludGVybmFsLnByb3RvdHlwZSA9IHJlZGVmaW5lQWxsJDIoUHJvbWlzZUNvbnN0cnVjdG9yUHJvdG90eXBlLCB7CiAgICAgIHRoZW46IGZ1bmN0aW9uIHRoZW4yKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKSB7CiAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxQcm9taXNlU3RhdGUodGhpcyk7CiAgICAgICAgdmFyIHJlYWN0aW9uID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkoc3BlY2llc0NvbnN0cnVjdG9yJDEodGhpcywgUHJvbWlzZUNvbnN0cnVjdG9yKSk7CiAgICAgICAgcmVhY3Rpb24ub2sgPSBpc0NhbGxhYmxlJDQob25GdWxmaWxsZWQpID8gb25GdWxmaWxsZWQgOiB0cnVlOwogICAgICAgIHJlYWN0aW9uLmZhaWwgPSBpc0NhbGxhYmxlJDQob25SZWplY3RlZCkgJiYgb25SZWplY3RlZDsKICAgICAgICByZWFjdGlvbi5kb21haW4gPSBJU19OT0RFJDEgPyBwcm9jZXNzJDEuZG9tYWluIDogdm9pZCAwOwogICAgICAgIHN0YXRlLnBhcmVudCA9IHRydWU7CiAgICAgICAgc3RhdGUucmVhY3Rpb25zLnB1c2gocmVhY3Rpb24pOwogICAgICAgIGlmIChzdGF0ZS5zdGF0ZSAhPSBQRU5ESU5HKQogICAgICAgICAgbm90aWZ5KHN0YXRlLCBmYWxzZSk7CiAgICAgICAgcmV0dXJuIHJlYWN0aW9uLnByb21pc2U7CiAgICAgIH0sCiAgICAgICJjYXRjaCI6IGZ1bmN0aW9uKG9uUmVqZWN0ZWQpIHsKICAgICAgICByZXR1cm4gdGhpcy50aGVuKHZvaWQgMCwgb25SZWplY3RlZCk7CiAgICAgIH0KICAgIH0pOwogICAgT3duUHJvbWlzZUNhcGFiaWxpdHkgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHByb21pc2UyID0gbmV3IEludGVybmFsKCk7CiAgICAgIHZhciBzdGF0ZSA9IGdldEludGVybmFsU3RhdGUocHJvbWlzZTIpOwogICAgICB0aGlzLnByb21pc2UgPSBwcm9taXNlMjsKICAgICAgdGhpcy5yZXNvbHZlID0gYmluZCQ2KGludGVybmFsUmVzb2x2ZSwgc3RhdGUpOwogICAgICB0aGlzLnJlamVjdCA9IGJpbmQkNihpbnRlcm5hbFJlamVjdCwgc3RhdGUpOwogICAgfTsKICAgIG5ld1Byb21pc2VDYXBhYmlsaXR5TW9kdWxlJDMuZiA9IG5ld1Byb21pc2VDYXBhYmlsaXR5ID0gZnVuY3Rpb24oQykgewogICAgICByZXR1cm4gQyA9PT0gUHJvbWlzZUNvbnN0cnVjdG9yIHx8IEMgPT09IFByb21pc2VXcmFwcGVyID8gbmV3IE93blByb21pc2VDYXBhYmlsaXR5KEMpIDogbmV3R2VuZXJpY1Byb21pc2VDYXBhYmlsaXR5KEMpOwogICAgfTsKICB9CiAgJCRwKHsgZ2xvYmFsOiB0cnVlLCB3cmFwOiB0cnVlLCBmb3JjZWQ6IEZPUkNFRCQyIH0sIHsKICAgIFByb21pc2U6IFByb21pc2VDb25zdHJ1Y3RvcgogIH0pOwogIHNldFRvU3RyaW5nVGFnJDEoUHJvbWlzZUNvbnN0cnVjdG9yLCBQUk9NSVNFLCBmYWxzZSwgdHJ1ZSk7CiAgc2V0U3BlY2llcyhQUk9NSVNFKTsKICBQcm9taXNlV3JhcHBlciA9IGdldEJ1aWx0SW4kMihQUk9NSVNFKTsKICAkJHAoeyB0YXJnZXQ6IFBST01JU0UsIHN0YXQ6IHRydWUsIGZvcmNlZDogRk9SQ0VEJDIgfSwgewogICAgcmVqZWN0OiBmdW5jdGlvbiByZWplY3QocikgewogICAgICB2YXIgY2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5KHRoaXMpOwogICAgICBjYXBhYmlsaXR5LnJlamVjdC5jYWxsKHZvaWQgMCwgcik7CiAgICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgICB9CiAgfSk7CiAgJCRwKHsgdGFyZ2V0OiBQUk9NSVNFLCBzdGF0OiB0cnVlLCBmb3JjZWQ6IElTX1BVUkUkMyB9LCB7CiAgICByZXNvbHZlOiBmdW5jdGlvbiByZXNvbHZlKHgpIHsKICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlJDEodGhpcyA9PT0gUHJvbWlzZVdyYXBwZXIgPyBQcm9taXNlQ29uc3RydWN0b3IgOiB0aGlzLCB4KTsKICAgIH0KICB9KTsKICAkJHAoeyB0YXJnZXQ6IFBST01JU0UsIHN0YXQ6IHRydWUsIGZvcmNlZDogSU5DT1JSRUNUX0lURVJBVElPTiB9LCB7CiAgICBhbGw6IGZ1bmN0aW9uIGFsbChpdGVyYWJsZSkgewogICAgICB2YXIgQyA9IHRoaXM7CiAgICAgIHZhciBjYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkoQyk7CiAgICAgIHZhciByZXNvbHZlID0gY2FwYWJpbGl0eS5yZXNvbHZlOwogICAgICB2YXIgcmVqZWN0ID0gY2FwYWJpbGl0eS5yZWplY3Q7CiAgICAgIHZhciByZXN1bHQgPSBwZXJmb3JtJDMoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyICRwcm9taXNlUmVzb2x2ZSA9IGFDYWxsYWJsZSQ2KEMucmVzb2x2ZSk7CiAgICAgICAgdmFyIHZhbHVlcyA9IFtdOwogICAgICAgIHZhciBjb3VudGVyMiA9IDA7CiAgICAgICAgdmFyIHJlbWFpbmluZyA9IDE7CiAgICAgICAgaXRlcmF0ZSQ1KGl0ZXJhYmxlLCBmdW5jdGlvbihwcm9taXNlMikgewogICAgICAgICAgdmFyIGluZGV4ID0gY291bnRlcjIrKzsKICAgICAgICAgIHZhciBhbHJlYWR5Q2FsbGVkID0gZmFsc2U7CiAgICAgICAgICB2YWx1ZXMucHVzaCh2b2lkIDApOwogICAgICAgICAgcmVtYWluaW5nKys7CiAgICAgICAgICAkcHJvbWlzZVJlc29sdmUuY2FsbChDLCBwcm9taXNlMikudGhlbihmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICBpZiAoYWxyZWFkeUNhbGxlZCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGFscmVhZHlDYWxsZWQgPSB0cnVlOwogICAgICAgICAgICB2YWx1ZXNbaW5kZXhdID0gdmFsdWU7CiAgICAgICAgICAgIC0tcmVtYWluaW5nIHx8IHJlc29sdmUodmFsdWVzKTsKICAgICAgICAgIH0sIHJlamVjdCk7CiAgICAgICAgfSk7CiAgICAgICAgLS1yZW1haW5pbmcgfHwgcmVzb2x2ZSh2YWx1ZXMpOwogICAgICB9KTsKICAgICAgaWYgKHJlc3VsdC5lcnJvcikKICAgICAgICByZWplY3QocmVzdWx0LnZhbHVlKTsKICAgICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICAgIH0sCiAgICByYWNlOiBmdW5jdGlvbiByYWNlKGl0ZXJhYmxlKSB7CiAgICAgIHZhciBDID0gdGhpczsKICAgICAgdmFyIGNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eShDKTsKICAgICAgdmFyIHJlamVjdCA9IGNhcGFiaWxpdHkucmVqZWN0OwogICAgICB2YXIgcmVzdWx0ID0gcGVyZm9ybSQzKGZ1bmN0aW9uKCkgewogICAgICAgIHZhciAkcHJvbWlzZVJlc29sdmUgPSBhQ2FsbGFibGUkNihDLnJlc29sdmUpOwogICAgICAgIGl0ZXJhdGUkNShpdGVyYWJsZSwgZnVuY3Rpb24ocHJvbWlzZTIpIHsKICAgICAgICAgICRwcm9taXNlUmVzb2x2ZS5jYWxsKEMsIHByb21pc2UyKS50aGVuKGNhcGFiaWxpdHkucmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIGlmIChyZXN1bHQuZXJyb3IpCiAgICAgICAgcmVqZWN0KHJlc3VsdC52YWx1ZSk7CiAgICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgICB9CiAgfSk7CiAgdmFyICQkbyA9IF9leHBvcnQ7CiAgdmFyIGFDYWxsYWJsZSQ1ID0gYUNhbGxhYmxlJGM7CiAgdmFyIG5ld1Byb21pc2VDYXBhYmlsaXR5TW9kdWxlJDIgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eSQyOwogIHZhciBwZXJmb3JtJDIgPSBwZXJmb3JtJDQ7CiAgdmFyIGl0ZXJhdGUkNCA9IGl0ZXJhdGUkNzsKICAkJG8oeyB0YXJnZXQ6ICJQcm9taXNlIiwgc3RhdDogdHJ1ZSB9LCB7CiAgICBhbGxTZXR0bGVkOiBmdW5jdGlvbiBhbGxTZXR0bGVkKGl0ZXJhYmxlKSB7CiAgICAgIHZhciBDID0gdGhpczsKICAgICAgdmFyIGNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eU1vZHVsZSQyLmYoQyk7CiAgICAgIHZhciByZXNvbHZlID0gY2FwYWJpbGl0eS5yZXNvbHZlOwogICAgICB2YXIgcmVqZWN0ID0gY2FwYWJpbGl0eS5yZWplY3Q7CiAgICAgIHZhciByZXN1bHQgPSBwZXJmb3JtJDIoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHByb21pc2VSZXNvbHZlMiA9IGFDYWxsYWJsZSQ1KEMucmVzb2x2ZSk7CiAgICAgICAgdmFyIHZhbHVlcyA9IFtdOwogICAgICAgIHZhciBjb3VudGVyMiA9IDA7CiAgICAgICAgdmFyIHJlbWFpbmluZyA9IDE7CiAgICAgICAgaXRlcmF0ZSQ0KGl0ZXJhYmxlLCBmdW5jdGlvbihwcm9taXNlMikgewogICAgICAgICAgdmFyIGluZGV4ID0gY291bnRlcjIrKzsKICAgICAgICAgIHZhciBhbHJlYWR5Q2FsbGVkID0gZmFsc2U7CiAgICAgICAgICB2YWx1ZXMucHVzaCh2b2lkIDApOwogICAgICAgICAgcmVtYWluaW5nKys7CiAgICAgICAgICBwcm9taXNlUmVzb2x2ZTIuY2FsbChDLCBwcm9taXNlMikudGhlbihmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICBpZiAoYWxyZWFkeUNhbGxlZCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGFscmVhZHlDYWxsZWQgPSB0cnVlOwogICAgICAgICAgICB2YWx1ZXNbaW5kZXhdID0geyBzdGF0dXM6ICJmdWxmaWxsZWQiLCB2YWx1ZSB9OwogICAgICAgICAgICAtLXJlbWFpbmluZyB8fCByZXNvbHZlKHZhbHVlcyk7CiAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikgewogICAgICAgICAgICBpZiAoYWxyZWFkeUNhbGxlZCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGFscmVhZHlDYWxsZWQgPSB0cnVlOwogICAgICAgICAgICB2YWx1ZXNbaW5kZXhdID0geyBzdGF0dXM6ICJyZWplY3RlZCIsIHJlYXNvbjogZXJyb3IgfTsKICAgICAgICAgICAgLS1yZW1haW5pbmcgfHwgcmVzb2x2ZSh2YWx1ZXMpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgLS1yZW1haW5pbmcgfHwgcmVzb2x2ZSh2YWx1ZXMpOwogICAgICB9KTsKICAgICAgaWYgKHJlc3VsdC5lcnJvcikKICAgICAgICByZWplY3QocmVzdWx0LnZhbHVlKTsKICAgICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICAgIH0KICB9KTsKICB2YXIgJCRuID0gX2V4cG9ydDsKICB2YXIgYUNhbGxhYmxlJDQgPSBhQ2FsbGFibGUkYzsKICB2YXIgZ2V0QnVpbHRJbiQxID0gZ2V0QnVpbHRJbiRiOwogIHZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eU1vZHVsZSQxID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkkMjsKICB2YXIgcGVyZm9ybSQxID0gcGVyZm9ybSQ0OwogIHZhciBpdGVyYXRlJDMgPSBpdGVyYXRlJDc7CiAgdmFyIFBST01JU0VfQU5ZX0VSUk9SID0gIk5vIG9uZSBwcm9taXNlIHJlc29sdmVkIjsKICAkJG4oeyB0YXJnZXQ6ICJQcm9taXNlIiwgc3RhdDogdHJ1ZSB9LCB7CiAgICBhbnk6IGZ1bmN0aW9uIGFueShpdGVyYWJsZSkgewogICAgICB2YXIgQyA9IHRoaXM7CiAgICAgIHZhciBjYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUkMS5mKEMpOwogICAgICB2YXIgcmVzb2x2ZSA9IGNhcGFiaWxpdHkucmVzb2x2ZTsKICAgICAgdmFyIHJlamVjdCA9IGNhcGFiaWxpdHkucmVqZWN0OwogICAgICB2YXIgcmVzdWx0ID0gcGVyZm9ybSQxKGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBwcm9taXNlUmVzb2x2ZTIgPSBhQ2FsbGFibGUkNChDLnJlc29sdmUpOwogICAgICAgIHZhciBlcnJvcnMgPSBbXTsKICAgICAgICB2YXIgY291bnRlcjIgPSAwOwogICAgICAgIHZhciByZW1haW5pbmcgPSAxOwogICAgICAgIHZhciBhbHJlYWR5UmVzb2x2ZWQgPSBmYWxzZTsKICAgICAgICBpdGVyYXRlJDMoaXRlcmFibGUsIGZ1bmN0aW9uKHByb21pc2UyKSB7CiAgICAgICAgICB2YXIgaW5kZXggPSBjb3VudGVyMisrOwogICAgICAgICAgdmFyIGFscmVhZHlSZWplY3RlZCA9IGZhbHNlOwogICAgICAgICAgZXJyb3JzLnB1c2godm9pZCAwKTsKICAgICAgICAgIHJlbWFpbmluZysrOwogICAgICAgICAgcHJvbWlzZVJlc29sdmUyLmNhbGwoQywgcHJvbWlzZTIpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgaWYgKGFscmVhZHlSZWplY3RlZCB8fCBhbHJlYWR5UmVzb2x2ZWQpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBhbHJlYWR5UmVzb2x2ZWQgPSB0cnVlOwogICAgICAgICAgICByZXNvbHZlKHZhbHVlKTsKICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgICAgICAgIGlmIChhbHJlYWR5UmVqZWN0ZWQgfHwgYWxyZWFkeVJlc29sdmVkKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgYWxyZWFkeVJlamVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgZXJyb3JzW2luZGV4XSA9IGVycm9yOwogICAgICAgICAgICAtLXJlbWFpbmluZyB8fCByZWplY3QobmV3IChnZXRCdWlsdEluJDEoIkFnZ3JlZ2F0ZUVycm9yIikpKGVycm9ycywgUFJPTUlTRV9BTllfRVJST1IpKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIC0tcmVtYWluaW5nIHx8IHJlamVjdChuZXcgKGdldEJ1aWx0SW4kMSgiQWdncmVnYXRlRXJyb3IiKSkoZXJyb3JzLCBQUk9NSVNFX0FOWV9FUlJPUikpOwogICAgICB9KTsKICAgICAgaWYgKHJlc3VsdC5lcnJvcikKICAgICAgICByZWplY3QocmVzdWx0LnZhbHVlKTsKICAgICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICAgIH0KICB9KTsKICB2YXIgJCRtID0gX2V4cG9ydDsKICB2YXIgTmF0aXZlUHJvbWlzZSA9IG5hdGl2ZVByb21pc2VDb25zdHJ1Y3RvcjsKICB2YXIgZmFpbHMkNiA9IGZhaWxzJG47CiAgdmFyIGdldEJ1aWx0SW4gPSBnZXRCdWlsdEluJGI7CiAgdmFyIGlzQ2FsbGFibGUkMyA9IGlzQ2FsbGFibGUkbDsKICB2YXIgc3BlY2llc0NvbnN0cnVjdG9yID0gc3BlY2llc0NvbnN0cnVjdG9yJDI7CiAgdmFyIHByb21pc2VSZXNvbHZlID0gcHJvbWlzZVJlc29sdmUkMjsKICB2YXIgTk9OX0dFTkVSSUMgPSAhIU5hdGl2ZVByb21pc2UgJiYgZmFpbHMkNihmdW5jdGlvbigpIHsKICAgIE5hdGl2ZVByb21pc2UucHJvdG90eXBlWyJmaW5hbGx5Il0uY2FsbCh7IHRoZW46IGZ1bmN0aW9uKCkgewogICAgfSB9LCBmdW5jdGlvbigpIHsKICAgIH0pOwogIH0pOwogICQkbSh7IHRhcmdldDogIlByb21pc2UiLCBwcm90bzogdHJ1ZSwgcmVhbDogdHJ1ZSwgZm9yY2VkOiBOT05fR0VORVJJQyB9LCB7CiAgICAiZmluYWxseSI6IGZ1bmN0aW9uKG9uRmluYWxseSkgewogICAgICB2YXIgQyA9IHNwZWNpZXNDb25zdHJ1Y3Rvcih0aGlzLCBnZXRCdWlsdEluKCJQcm9taXNlIikpOwogICAgICB2YXIgaXNGdW5jdGlvbiA9IGlzQ2FsbGFibGUkMyhvbkZpbmFsbHkpOwogICAgICByZXR1cm4gdGhpcy50aGVuKGlzRnVuY3Rpb24gPyBmdW5jdGlvbih4KSB7CiAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlKEMsIG9uRmluYWxseSgpKS50aGVuKGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHg7CiAgICAgICAgfSk7CiAgICAgIH0gOiBvbkZpbmFsbHksIGlzRnVuY3Rpb24gPyBmdW5jdGlvbihlKSB7CiAgICAgICAgcmV0dXJuIHByb21pc2VSZXNvbHZlKEMsIG9uRmluYWxseSgpKS50aGVuKGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9KTsKICAgICAgfSA6IG9uRmluYWxseSk7CiAgICB9CiAgfSk7CiAgdmFyIHBhdGgkOCA9IHBhdGgkbjsKICB2YXIgcHJvbWlzZSQ0ID0gcGF0aCQ4LlByb21pc2U7CiAgdmFyIHBhcmVudCR0ID0gcHJvbWlzZSQ0OwogIHZhciBwcm9taXNlJDMgPSBwYXJlbnQkdDsKICB2YXIgJCRsID0gX2V4cG9ydDsKICB2YXIgbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eSQyOwogIHZhciBwZXJmb3JtID0gcGVyZm9ybSQ0OwogICQkbCh7IHRhcmdldDogIlByb21pc2UiLCBzdGF0OiB0cnVlIH0sIHsKICAgICJ0cnkiOiBmdW5jdGlvbihjYWxsYmFja2ZuKSB7CiAgICAgIHZhciBwcm9taXNlQ2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5TW9kdWxlLmYodGhpcyk7CiAgICAgIHZhciByZXN1bHQgPSBwZXJmb3JtKGNhbGxiYWNrZm4pOwogICAgICAocmVzdWx0LmVycm9yID8gcHJvbWlzZUNhcGFiaWxpdHkucmVqZWN0IDogcHJvbWlzZUNhcGFiaWxpdHkucmVzb2x2ZSkocmVzdWx0LnZhbHVlKTsKICAgICAgcmV0dXJuIHByb21pc2VDYXBhYmlsaXR5LnByb21pc2U7CiAgICB9CiAgfSk7CiAgdmFyIHBhcmVudCRzID0gcHJvbWlzZSQzOwogIHZhciBwcm9taXNlJDIgPSBwYXJlbnQkczsKICB2YXIgcHJvbWlzZSQxID0gcHJvbWlzZSQyOwogIChmdW5jdGlvbihtb2R1bGUpIHsKICAgIHZhciBfUHJvbWlzZSA9IHByb21pc2UkMTsKICAgIGZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7CiAgICAgICAgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoaW5mby5kb25lKSB7CiAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX1Byb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBzZWxmMiA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIG5ldyBfUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIHZhciBnZW4gPSBmbi5hcHBseShzZWxmMiwgYXJncyk7CiAgICAgICAgICBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgewogICAgICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gX3Rocm93KGVycjIpIHsKICAgICAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIyKTsKICAgICAgICAgIH0KICAgICAgICAgIF9uZXh0KHZvaWQgMCk7CiAgICAgICAgfSk7CiAgICAgIH07CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF9hc3luY1RvR2VuZXJhdG9yOwogICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShhc3luY1RvR2VuZXJhdG9yJDEpOwogIHZhciBzbGljZSQxID0gc2xpY2UkNDsKICB2YXIgY2xhc3NDYWxsQ2hlY2skMSA9IHsgZXhwb3J0czoge30gfTsKICAoZnVuY3Rpb24obW9kdWxlKSB7CiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2szKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogICAgICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgICB9CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF9jbGFzc0NhbGxDaGVjazM7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKGNsYXNzQ2FsbENoZWNrJDEpOwogIHZhciBjcmVhdGVDbGFzcyQxID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUpIHsKICAgIHZhciBfT2JqZWN0JGRlZmluZVByb3BlcnR5ID0gZGVmaW5lUHJvcGVydHkkNDsKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzMih0YXJnZXQsIHByb3BzKSB7CiAgICAgIGZvciAodmFyIGkyID0gMDsgaTIgPCBwcm9wcy5sZW5ndGg7IGkyKyspIHsKICAgICAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2kyXTsKICAgICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpCiAgICAgICAgICBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgICAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogICAgICBpZiAocHJvdG9Qcm9wcykKICAgICAgICBfZGVmaW5lUHJvcGVydGllczIoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICAgICAgaWYgKHN0YXRpY1Byb3BzKQogICAgICAgIF9kZWZpbmVQcm9wZXJ0aWVzMihDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogICAgICByZXR1cm4gQ29uc3RydWN0b3I7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF9jcmVhdGVDbGFzczM7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKGNyZWF0ZUNsYXNzJDEpOwogIHZhciBpbmhlcml0cyA9IHsgZXhwb3J0czoge30gfTsKICB2YXIgJCRrID0gX2V4cG9ydDsKICB2YXIgREVTQ1JJUFRPUlMkMiA9IGRlc2NyaXB0b3JzOwogIHZhciBjcmVhdGUkNCA9IG9iamVjdENyZWF0ZTsKICAkJGsoeyB0YXJnZXQ6ICJPYmplY3QiLCBzdGF0OiB0cnVlLCBzaGFtOiAhREVTQ1JJUFRPUlMkMiB9LCB7CiAgICBjcmVhdGU6IGNyZWF0ZSQ0CiAgfSk7CiAgdmFyIHBhdGgkNyA9IHBhdGgkbjsKICB2YXIgT2JqZWN0JDEgPSBwYXRoJDcuT2JqZWN0OwogIHZhciBjcmVhdGUkMyA9IGZ1bmN0aW9uIGNyZWF0ZTIoUCwgRCkgewogICAgcmV0dXJuIE9iamVjdCQxLmNyZWF0ZShQLCBEKTsKICB9OwogIHZhciBwYXJlbnQkciA9IGNyZWF0ZSQzOwogIHZhciBjcmVhdGUkMiA9IHBhcmVudCRyOwogIHZhciBwYXJlbnQkcSA9IGNyZWF0ZSQyOwogIHZhciBjcmVhdGUkMSA9IHBhcmVudCRxOwogIHZhciBjcmVhdGUgPSBjcmVhdGUkMTsKICB2YXIgc2V0UHJvdG90eXBlT2YkNSA9IHsgZXhwb3J0czoge30gfTsKICB2YXIgJCRqID0gX2V4cG9ydDsKICB2YXIgc2V0UHJvdG90eXBlT2YkNCA9IG9iamVjdFNldFByb3RvdHlwZU9mOwogICQkaih7IHRhcmdldDogIk9iamVjdCIsIHN0YXQ6IHRydWUgfSwgewogICAgc2V0UHJvdG90eXBlT2Y6IHNldFByb3RvdHlwZU9mJDQKICB9KTsKICB2YXIgcGF0aCQ2ID0gcGF0aCRuOwogIHZhciBzZXRQcm90b3R5cGVPZiQzID0gcGF0aCQ2Lk9iamVjdC5zZXRQcm90b3R5cGVPZjsKICB2YXIgcGFyZW50JHAgPSBzZXRQcm90b3R5cGVPZiQzOwogIHZhciBzZXRQcm90b3R5cGVPZiQyID0gcGFyZW50JHA7CiAgdmFyIHBhcmVudCRvID0gc2V0UHJvdG90eXBlT2YkMjsKICB2YXIgc2V0UHJvdG90eXBlT2YkMSA9IHBhcmVudCRvOwogIHZhciBzZXRQcm90b3R5cGVPZiA9IHNldFByb3RvdHlwZU9mJDE7CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgdmFyIF9PYmplY3Qkc2V0UHJvdG90eXBlT2YgPSBzZXRQcm90b3R5cGVPZjsKICAgIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZjIobywgcCkgewogICAgICBtb2R1bGUuZXhwb3J0cyA9IF9zZXRQcm90b3R5cGVPZjIgPSBfT2JqZWN0JHNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZjMobzIsIHAyKSB7CiAgICAgICAgbzIuX19wcm90b19fID0gcDI7CiAgICAgICAgcmV0dXJuIG8yOwogICAgICB9OwogICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgICByZXR1cm4gX3NldFByb3RvdHlwZU9mMihvLCBwKTsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gX3NldFByb3RvdHlwZU9mMjsKICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSkoc2V0UHJvdG90eXBlT2YkNSk7CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgdmFyIF9PYmplY3QkY3JlYXRlID0gY3JlYXRlOwogICAgdmFyIHNldFByb3RvdHlwZU9mMiA9IHNldFByb3RvdHlwZU9mJDUuZXhwb3J0czsKICAgIGZ1bmN0aW9uIF9pbmhlcml0czIoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICAgICAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOwogICAgICB9CiAgICAgIHN1YkNsYXNzLnByb3RvdHlwZSA9IF9PYmplY3QkY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsKICAgICAgICBjb25zdHJ1Y3RvcjogewogICAgICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICB9CiAgICAgIH0pOwogICAgICBpZiAoc3VwZXJDbGFzcykKICAgICAgICBzZXRQcm90b3R5cGVPZjIoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBfaW5oZXJpdHMyOwogICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShpbmhlcml0cyk7CiAgdmFyIHBvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4gPSB7IGV4cG9ydHM6IHt9IH07CiAgdmFyIF90eXBlb2YkMSA9IHsgZXhwb3J0czoge30gfTsKICB2YXIgV3JhcHBlZFdlbGxLbm93blN5bWJvbE1vZHVsZSQxID0gd2VsbEtub3duU3ltYm9sV3JhcHBlZDsKICB2YXIgaXRlcmF0b3IkMyA9IFdyYXBwZWRXZWxsS25vd25TeW1ib2xNb2R1bGUkMS5mKCJpdGVyYXRvciIpOwogIHZhciBwYXJlbnQkbiA9IGl0ZXJhdG9yJDM7CiAgdmFyIGl0ZXJhdG9yJDIgPSBwYXJlbnQkbjsKICB2YXIgcGFyZW50JG0gPSBpdGVyYXRvciQyOwogIHZhciBpdGVyYXRvciQxID0gcGFyZW50JG07CiAgdmFyIGl0ZXJhdG9yID0gaXRlcmF0b3IkMTsKICAoZnVuY3Rpb24obW9kdWxlKSB7CiAgICB2YXIgX1N5bWJvbCA9IHN5bWJvbDsKICAgIHZhciBfU3ltYm9sJGl0ZXJhdG9yID0gaXRlcmF0b3I7CiAgICBmdW5jdGlvbiBfdHlwZW9mMyhvYmopIHsKICAgICAgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsKICAgICAgaWYgKHR5cGVvZiBfU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBfU3ltYm9sJGl0ZXJhdG9yID09PSAic3ltYm9sIikgewogICAgICAgIG1vZHVsZS5leHBvcnRzID0gX3R5cGVvZjMgPSBmdW5jdGlvbiBfdHlwZW9mNChvYmoyKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIG9iajI7CiAgICAgICAgfTsKICAgICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIG1vZHVsZS5leHBvcnRzID0gX3R5cGVvZjMgPSBmdW5jdGlvbiBfdHlwZW9mNChvYmoyKSB7CiAgICAgICAgICByZXR1cm4gb2JqMiAmJiB0eXBlb2YgX1N5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmoyLmNvbnN0cnVjdG9yID09PSBfU3ltYm9sICYmIG9iajIgIT09IF9TeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqMjsKICAgICAgICB9OwogICAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIF90eXBlb2YzKG9iaik7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF90eXBlb2YzOwogICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShfdHlwZW9mJDEpOwogIHZhciBhc3NlcnRUaGlzSW5pdGlhbGl6ZWQgPSB7IGV4cG9ydHM6IHt9IH07CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZDIoc2VsZjIpIHsKICAgICAgaWYgKHNlbGYyID09PSB2b2lkIDApIHsKICAgICAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOwogICAgICB9CiAgICAgIHJldHVybiBzZWxmMjsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gX2Fzc2VydFRoaXNJbml0aWFsaXplZDI7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKGFzc2VydFRoaXNJbml0aWFsaXplZCk7CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgdmFyIF90eXBlb2YzID0gX3R5cGVvZiQxLmV4cG9ydHNbImRlZmF1bHQiXTsKICAgIHZhciBhc3NlcnRUaGlzSW5pdGlhbGl6ZWQkMSA9IGFzc2VydFRoaXNJbml0aWFsaXplZC5leHBvcnRzOwogICAgZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4yKHNlbGYyLCBjYWxsKSB7CiAgICAgIGlmIChjYWxsICYmIChfdHlwZW9mMyhjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7CiAgICAgICAgcmV0dXJuIGNhbGw7CiAgICAgIH0gZWxzZSBpZiAoY2FsbCAhPT0gdm9pZCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiRGVyaXZlZCBjb25zdHJ1Y3RvcnMgbWF5IG9ubHkgcmV0dXJuIG9iamVjdCBvciB1bmRlZmluZWQiKTsKICAgICAgfQogICAgICByZXR1cm4gYXNzZXJ0VGhpc0luaXRpYWxpemVkJDEoc2VsZjIpOwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybjI7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKHBvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4pOwogIHZhciBnZXRQcm90b3R5cGVPZiQ0ID0geyBleHBvcnRzOiB7fSB9OwogIHZhciAkJGkgPSBfZXhwb3J0OwogIHZhciBmYWlscyQ1ID0gZmFpbHMkbjsKICB2YXIgdG9PYmplY3QkMyA9IHRvT2JqZWN0JGI7CiAgdmFyIG5hdGl2ZUdldFByb3RvdHlwZU9mID0gb2JqZWN0R2V0UHJvdG90eXBlT2Y7CiAgdmFyIENPUlJFQ1RfUFJPVE9UWVBFX0dFVFRFUiA9IGNvcnJlY3RQcm90b3R5cGVHZXR0ZXI7CiAgdmFyIEZBSUxTX09OX1BSSU1JVElWRVMgPSBmYWlscyQ1KGZ1bmN0aW9uKCkgewogICAgbmF0aXZlR2V0UHJvdG90eXBlT2YoMSk7CiAgfSk7CiAgJCRpKHsgdGFyZ2V0OiAiT2JqZWN0Iiwgc3RhdDogdHJ1ZSwgZm9yY2VkOiBGQUlMU19PTl9QUklNSVRJVkVTLCBzaGFtOiAhQ09SUkVDVF9QUk9UT1RZUEVfR0VUVEVSIH0sIHsKICAgIGdldFByb3RvdHlwZU9mOiBmdW5jdGlvbiBnZXRQcm90b3R5cGVPZjIoaXQpIHsKICAgICAgcmV0dXJuIG5hdGl2ZUdldFByb3RvdHlwZU9mKHRvT2JqZWN0JDMoaXQpKTsKICAgIH0KICB9KTsKICB2YXIgcGF0aCQ1ID0gcGF0aCRuOwogIHZhciBnZXRQcm90b3R5cGVPZiQzID0gcGF0aCQ1Lk9iamVjdC5nZXRQcm90b3R5cGVPZjsKICB2YXIgcGFyZW50JGwgPSBnZXRQcm90b3R5cGVPZiQzOwogIHZhciBnZXRQcm90b3R5cGVPZiQyID0gcGFyZW50JGw7CiAgdmFyIHBhcmVudCRrID0gZ2V0UHJvdG90eXBlT2YkMjsKICB2YXIgZ2V0UHJvdG90eXBlT2YkMSA9IHBhcmVudCRrOwogIHZhciBnZXRQcm90b3R5cGVPZiA9IGdldFByb3RvdHlwZU9mJDE7CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgdmFyIF9PYmplY3Qkc2V0UHJvdG90eXBlT2YgPSBzZXRQcm90b3R5cGVPZjsKICAgIHZhciBfT2JqZWN0JGdldFByb3RvdHlwZU9mID0gZ2V0UHJvdG90eXBlT2Y7CiAgICBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YyKG8pIHsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfZ2V0UHJvdG90eXBlT2YyID0gX09iamVjdCRzZXRQcm90b3R5cGVPZiA/IF9PYmplY3QkZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YzKG8yKSB7CiAgICAgICAgcmV0dXJuIG8yLl9fcHJvdG9fXyB8fCBfT2JqZWN0JGdldFByb3RvdHlwZU9mKG8yKTsKICAgICAgfTsKICAgICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICAgICAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZjIobyk7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF9nZXRQcm90b3R5cGVPZjI7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKGdldFByb3RvdHlwZU9mJDQpOwogIHZhciBsb25nID0gTG9uZyQxOwogIHZhciB3YXNtID0gbnVsbDsKICB0cnkgewogICAgd2FzbSA9IG5ldyBXZWJBc3NlbWJseS5JbnN0YW5jZShuZXcgV2ViQXNzZW1ibHkuTW9kdWxlKG5ldyBVaW50OEFycmF5KFsKICAgICAgMCwKICAgICAgOTcsCiAgICAgIDExNSwKICAgICAgMTA5LAogICAgICAxLAogICAgICAwLAogICAgICAwLAogICAgICAwLAogICAgICAxLAogICAgICAxMywKICAgICAgMiwKICAgICAgOTYsCiAgICAgIDAsCiAgICAgIDEsCiAgICAgIDEyNywKICAgICAgOTYsCiAgICAgIDQsCiAgICAgIDEyNywKICAgICAgMTI3LAogICAgICAxMjcsCiAgICAgIDEyNywKICAgICAgMSwKICAgICAgMTI3LAogICAgICAzLAogICAgICA3LAogICAgICA2LAogICAgICAwLAogICAgICAxLAogICAgICAxLAogICAgICAxLAogICAgICAxLAogICAgICAxLAogICAgICA2LAogICAgICA2LAogICAgICAxLAogICAgICAxMjcsCiAgICAgIDEsCiAgICAgIDY1LAogICAgICAwLAogICAgICAxMSwKICAgICAgNywKICAgICAgNTAsCiAgICAgIDYsCiAgICAgIDMsCiAgICAgIDEwOSwKICAgICAgMTE3LAogICAgICAxMDgsCiAgICAgIDAsCiAgICAgIDEsCiAgICAgIDUsCiAgICAgIDEwMCwKICAgICAgMTA1LAogICAgICAxMTgsCiAgICAgIDk1LAogICAgICAxMTUsCiAgICAgIDAsCiAgICAgIDIsCiAgICAgIDUsCiAgICAgIDEwMCwKICAgICAgMTA1LAogICAgICAxMTgsCiAgICAgIDk1LAogICAgICAxMTcsCiAgICAgIDAsCiAgICAgIDMsCiAgICAgIDUsCiAgICAgIDExNCwKICAgICAgMTAxLAogICAgICAxMDksCiAgICAgIDk1LAogICAgICAxMTUsCiAgICAgIDAsCiAgICAgIDQsCiAgICAgIDUsCiAgICAgIDExNCwKICAgICAgMTAxLAogICAgICAxMDksCiAgICAgIDk1LAogICAgICAxMTcsCiAgICAgIDAsCiAgICAgIDUsCiAgICAgIDgsCiAgICAgIDEwMywKICAgICAgMTAxLAogICAgICAxMTYsCiAgICAgIDk1LAogICAgICAxMDQsCiAgICAgIDEwNSwKICAgICAgMTAzLAogICAgICAxMDQsCiAgICAgIDAsCiAgICAgIDAsCiAgICAgIDEwLAogICAgICAxOTEsCiAgICAgIDEsCiAgICAgIDYsCiAgICAgIDQsCiAgICAgIDAsCiAgICAgIDM1LAogICAgICAwLAogICAgICAxMSwKICAgICAgMzYsCiAgICAgIDEsCiAgICAgIDEsCiAgICAgIDEyNiwKICAgICAgMzIsCiAgICAgIDAsCiAgICAgIDE3MywKICAgICAgMzIsCiAgICAgIDEsCiAgICAgIDE3MywKICAgICAgNjYsCiAgICAgIDMyLAogICAgICAxMzQsCiAgICAgIDEzMiwKICAgICAgMzIsCiAgICAgIDIsCiAgICAgIDE3MywKICAgICAgMzIsCiAgICAgIDMsCiAgICAgIDE3MywKICAgICAgNjYsCiAgICAgIDMyLAogICAgICAxMzQsCiAgICAgIDEzMiwKICAgICAgMTI2LAogICAgICAzNCwKICAgICAgNCwKICAgICAgNjYsCiAgICAgIDMyLAogICAgICAxMzUsCiAgICAgIDE2NywKICAgICAgMzYsCiAgICAgIDAsCiAgICAgIDMyLAogICAgICA0LAogICAgICAxNjcsCiAgICAgIDExLAogICAgICAzNiwKICAgICAgMSwKICAgICAgMSwKICAgICAgMTI2LAogICAgICAzMiwKICAgICAgMCwKICAgICAgMTczLAogICAgICAzMiwKICAgICAgMSwKICAgICAgMTczLAogICAgICA2NiwKICAgICAgMzIsCiAgICAgIDEzNCwKICAgICAgMTMyLAogICAgICAzMiwKICAgICAgMiwKICAgICAgMTczLAogICAgICAzMiwKICAgICAgMywKICAgICAgMTczLAogICAgICA2NiwKICAgICAgMzIsCiAgICAgIDEzNCwKICAgICAgMTMyLAogICAgICAxMjcsCiAgICAgIDM0LAogICAgICA0LAogICAgICA2NiwKICAgICAgMzIsCiAgICAgIDEzNSwKICAgICAgMTY3LAogICAgICAzNiwKICAgICAgMCwKICAgICAgMzIsCiAgICAgIDQsCiAgICAgIDE2NywKICAgICAgMTEsCiAgICAgIDM2LAogICAgICAxLAogICAgICAxLAogICAgICAxMjYsCiAgICAgIDMyLAogICAgICAwLAogICAgICAxNzMsCiAgICAgIDMyLAogICAgICAxLAogICAgICAxNzMsCiAgICAgIDY2LAogICAgICAzMiwKICAgICAgMTM0LAogICAgICAxMzIsCiAgICAgIDMyLAogICAgICAyLAogICAgICAxNzMsCiAgICAgIDMyLAogICAgICAzLAogICAgICAxNzMsCiAgICAgIDY2LAogICAgICAzMiwKICAgICAgMTM0LAogICAgICAxMzIsCiAgICAgIDEyOCwKICAgICAgMzQsCiAgICAgIDQsCiAgICAgIDY2LAogICAgICAzMiwKICAgICAgMTM1LAogICAgICAxNjcsCiAgICAgIDM2LAogICAgICAwLAogICAgICAzMiwKICAgICAgNCwKICAgICAgMTY3LAogICAgICAxMSwKICAgICAgMzYsCiAgICAgIDEsCiAgICAgIDEsCiAgICAgIDEyNiwKICAgICAgMzIsCiAgICAgIDAsCiAgICAgIDE3MywKICAgICAgMzIsCiAgICAgIDEsCiAgICAgIDE3MywKICAgICAgNjYsCiAgICAgIDMyLAogICAgICAxMzQsCiAgICAgIDEzMiwKICAgICAgMzIsCiAgICAgIDIsCiAgICAgIDE3MywKICAgICAgMzIsCiAgICAgIDMsCiAgICAgIDE3MywKICAgICAgNjYsCiAgICAgIDMyLAogICAgICAxMzQsCiAgICAgIDEzMiwKICAgICAgMTI5LAogICAgICAzNCwKICAgICAgNCwKICAgICAgNjYsCiAgICAgIDMyLAogICAgICAxMzUsCiAgICAgIDE2NywKICAgICAgMzYsCiAgICAgIDAsCiAgICAgIDMyLAogICAgICA0LAogICAgICAxNjcsCiAgICAgIDExLAogICAgICAzNiwKICAgICAgMSwKICAgICAgMSwKICAgICAgMTI2LAogICAgICAzMiwKICAgICAgMCwKICAgICAgMTczLAogICAgICAzMiwKICAgICAgMSwKICAgICAgMTczLAogICAgICA2NiwKICAgICAgMzIsCiAgICAgIDEzNCwKICAgICAgMTMyLAogICAgICAzMiwKICAgICAgMiwKICAgICAgMTczLAogICAgICAzMiwKICAgICAgMywKICAgICAgMTczLAogICAgICA2NiwKICAgICAgMzIsCiAgICAgIDEzNCwKICAgICAgMTMyLAogICAgICAxMzAsCiAgICAgIDM0LAogICAgICA0LAogICAgICA2NiwKICAgICAgMzIsCiAgICAgIDEzNSwKICAgICAgMTY3LAogICAgICAzNiwKICAgICAgMCwKICAgICAgMzIsCiAgICAgIDQsCiAgICAgIDE2NywKICAgICAgMTEKICAgIF0pKSwge30pLmV4cG9ydHM7CiAgfSBjYXRjaCAoZSkgewogIH0KICBmdW5jdGlvbiBMb25nJDEobG93LCBoaWdoLCB1bnNpZ25lZCkgewogICAgdGhpcy5sb3cgPSBsb3cgfCAwOwogICAgdGhpcy5oaWdoID0gaGlnaCB8IDA7CiAgICB0aGlzLnVuc2lnbmVkID0gISF1bnNpZ25lZDsKICB9CiAgTG9uZyQxLnByb3RvdHlwZS5fX2lzTG9uZ19fOwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShMb25nJDEucHJvdG90eXBlLCAiX19pc0xvbmdfXyIsIHsgdmFsdWU6IHRydWUgfSk7CiAgZnVuY3Rpb24gaXNMb25nKG9iaikgewogICAgcmV0dXJuIChvYmogJiYgb2JqWyJfX2lzTG9uZ19fIl0pID09PSB0cnVlOwogIH0KICBMb25nJDEuaXNMb25nID0gaXNMb25nOwogIHZhciBJTlRfQ0FDSEUgPSB7fTsKICB2YXIgVUlOVF9DQUNIRSA9IHt9OwogIGZ1bmN0aW9uIGZyb21JbnQodmFsdWUsIHVuc2lnbmVkKSB7CiAgICB2YXIgb2JqLCBjYWNoZWRPYmosIGNhY2hlOwogICAgaWYgKHVuc2lnbmVkKSB7CiAgICAgIHZhbHVlID4+Pj0gMDsKICAgICAgaWYgKGNhY2hlID0gMCA8PSB2YWx1ZSAmJiB2YWx1ZSA8IDI1NikgewogICAgICAgIGNhY2hlZE9iaiA9IFVJTlRfQ0FDSEVbdmFsdWVdOwogICAgICAgIGlmIChjYWNoZWRPYmopCiAgICAgICAgICByZXR1cm4gY2FjaGVkT2JqOwogICAgICB9CiAgICAgIG9iaiA9IGZyb21CaXRzKHZhbHVlLCAodmFsdWUgfCAwKSA8IDAgPyAtMSA6IDAsIHRydWUpOwogICAgICBpZiAoY2FjaGUpCiAgICAgICAgVUlOVF9DQUNIRVt2YWx1ZV0gPSBvYmo7CiAgICAgIHJldHVybiBvYmo7CiAgICB9IGVsc2UgewogICAgICB2YWx1ZSB8PSAwOwogICAgICBpZiAoY2FjaGUgPSAtMTI4IDw9IHZhbHVlICYmIHZhbHVlIDwgMTI4KSB7CiAgICAgICAgY2FjaGVkT2JqID0gSU5UX0NBQ0hFW3ZhbHVlXTsKICAgICAgICBpZiAoY2FjaGVkT2JqKQogICAgICAgICAgcmV0dXJuIGNhY2hlZE9iajsKICAgICAgfQogICAgICBvYmogPSBmcm9tQml0cyh2YWx1ZSwgdmFsdWUgPCAwID8gLTEgOiAwLCBmYWxzZSk7CiAgICAgIGlmIChjYWNoZSkKICAgICAgICBJTlRfQ0FDSEVbdmFsdWVdID0gb2JqOwogICAgICByZXR1cm4gb2JqOwogICAgfQogIH0KICBMb25nJDEuZnJvbUludCA9IGZyb21JbnQ7CiAgZnVuY3Rpb24gZnJvbU51bWJlcih2YWx1ZSwgdW5zaWduZWQpIHsKICAgIGlmIChpc05hTih2YWx1ZSkpCiAgICAgIHJldHVybiB1bnNpZ25lZCA/IFVaRVJPIDogWkVSTzsKICAgIGlmICh1bnNpZ25lZCkgewogICAgICBpZiAodmFsdWUgPCAwKQogICAgICAgIHJldHVybiBVWkVSTzsKICAgICAgaWYgKHZhbHVlID49IFRXT19QV1JfNjRfREJMKQogICAgICAgIHJldHVybiBNQVhfVU5TSUdORURfVkFMVUU7CiAgICB9IGVsc2UgewogICAgICBpZiAodmFsdWUgPD0gLVRXT19QV1JfNjNfREJMKQogICAgICAgIHJldHVybiBNSU5fVkFMVUU7CiAgICAgIGlmICh2YWx1ZSArIDEgPj0gVFdPX1BXUl82M19EQkwpCiAgICAgICAgcmV0dXJuIE1BWF9WQUxVRTsKICAgIH0KICAgIGlmICh2YWx1ZSA8IDApCiAgICAgIHJldHVybiBmcm9tTnVtYmVyKC12YWx1ZSwgdW5zaWduZWQpLm5lZygpOwogICAgcmV0dXJuIGZyb21CaXRzKHZhbHVlICUgVFdPX1BXUl8zMl9EQkwgfCAwLCB2YWx1ZSAvIFRXT19QV1JfMzJfREJMIHwgMCwgdW5zaWduZWQpOwogIH0KICBMb25nJDEuZnJvbU51bWJlciA9IGZyb21OdW1iZXI7CiAgZnVuY3Rpb24gZnJvbUJpdHMobG93Qml0cywgaGlnaEJpdHMsIHVuc2lnbmVkKSB7CiAgICByZXR1cm4gbmV3IExvbmckMShsb3dCaXRzLCBoaWdoQml0cywgdW5zaWduZWQpOwogIH0KICBMb25nJDEuZnJvbUJpdHMgPSBmcm9tQml0czsKICB2YXIgcG93X2RibCA9IE1hdGgucG93OwogIGZ1bmN0aW9uIGZyb21TdHJpbmcoc3RyLCB1bnNpZ25lZCwgcmFkaXgpIHsKICAgIGlmIChzdHIubGVuZ3RoID09PSAwKQogICAgICB0aHJvdyBFcnJvcigiZW1wdHkgc3RyaW5nIik7CiAgICBpZiAoc3RyID09PSAiTmFOIiB8fCBzdHIgPT09ICJJbmZpbml0eSIgfHwgc3RyID09PSAiK0luZmluaXR5IiB8fCBzdHIgPT09ICItSW5maW5pdHkiKQogICAgICByZXR1cm4gWkVSTzsKICAgIGlmICh0eXBlb2YgdW5zaWduZWQgPT09ICJudW1iZXIiKSB7CiAgICAgIHJhZGl4ID0gdW5zaWduZWQsIHVuc2lnbmVkID0gZmFsc2U7CiAgICB9IGVsc2UgewogICAgICB1bnNpZ25lZCA9ICEhdW5zaWduZWQ7CiAgICB9CiAgICByYWRpeCA9IHJhZGl4IHx8IDEwOwogICAgaWYgKHJhZGl4IDwgMiB8fCAzNiA8IHJhZGl4KQogICAgICB0aHJvdyBSYW5nZUVycm9yKCJyYWRpeCIpOwogICAgdmFyIHA7CiAgICBpZiAoKHAgPSBzdHIuaW5kZXhPZigiLSIpKSA+IDApCiAgICAgIHRocm93IEVycm9yKCJpbnRlcmlvciBoeXBoZW4iKTsKICAgIGVsc2UgaWYgKHAgPT09IDApIHsKICAgICAgcmV0dXJuIGZyb21TdHJpbmcoc3RyLnN1YnN0cmluZygxKSwgdW5zaWduZWQsIHJhZGl4KS5uZWcoKTsKICAgIH0KICAgIHZhciByYWRpeFRvUG93ZXIgPSBmcm9tTnVtYmVyKHBvd19kYmwocmFkaXgsIDgpKTsKICAgIHZhciByZXN1bHQgPSBaRVJPOwogICAgZm9yICh2YXIgaTIgPSAwOyBpMiA8IHN0ci5sZW5ndGg7IGkyICs9IDgpIHsKICAgICAgdmFyIHNpemUgPSBNYXRoLm1pbig4LCBzdHIubGVuZ3RoIC0gaTIpLCB2YWx1ZSA9IHBhcnNlSW50KHN0ci5zdWJzdHJpbmcoaTIsIGkyICsgc2l6ZSksIHJhZGl4KTsKICAgICAgaWYgKHNpemUgPCA4KSB7CiAgICAgICAgdmFyIHBvd2VyID0gZnJvbU51bWJlcihwb3dfZGJsKHJhZGl4LCBzaXplKSk7CiAgICAgICAgcmVzdWx0ID0gcmVzdWx0Lm11bChwb3dlcikuYWRkKGZyb21OdW1iZXIodmFsdWUpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXN1bHQgPSByZXN1bHQubXVsKHJhZGl4VG9Qb3dlcik7CiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmFkZChmcm9tTnVtYmVyKHZhbHVlKSk7CiAgICAgIH0KICAgIH0KICAgIHJlc3VsdC51bnNpZ25lZCA9IHVuc2lnbmVkOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgTG9uZyQxLmZyb21TdHJpbmcgPSBmcm9tU3RyaW5nOwogIGZ1bmN0aW9uIGZyb21WYWx1ZSh2YWwsIHVuc2lnbmVkKSB7CiAgICBpZiAodHlwZW9mIHZhbCA9PT0gIm51bWJlciIpCiAgICAgIHJldHVybiBmcm9tTnVtYmVyKHZhbCwgdW5zaWduZWQpOwogICAgaWYgKHR5cGVvZiB2YWwgPT09ICJzdHJpbmciKQogICAgICByZXR1cm4gZnJvbVN0cmluZyh2YWwsIHVuc2lnbmVkKTsKICAgIHJldHVybiBmcm9tQml0cyh2YWwubG93LCB2YWwuaGlnaCwgdHlwZW9mIHVuc2lnbmVkID09PSAiYm9vbGVhbiIgPyB1bnNpZ25lZCA6IHZhbC51bnNpZ25lZCk7CiAgfQogIExvbmckMS5mcm9tVmFsdWUgPSBmcm9tVmFsdWU7CiAgdmFyIFRXT19QV1JfMTZfREJMID0gMSA8PCAxNjsKICB2YXIgVFdPX1BXUl8yNF9EQkwgPSAxIDw8IDI0OwogIHZhciBUV09fUFdSXzMyX0RCTCA9IFRXT19QV1JfMTZfREJMICogVFdPX1BXUl8xNl9EQkw7CiAgdmFyIFRXT19QV1JfNjRfREJMID0gVFdPX1BXUl8zMl9EQkwgKiBUV09fUFdSXzMyX0RCTDsKICB2YXIgVFdPX1BXUl82M19EQkwgPSBUV09fUFdSXzY0X0RCTCAvIDI7CiAgdmFyIFRXT19QV1JfMjQgPSBmcm9tSW50KFRXT19QV1JfMjRfREJMKTsKICB2YXIgWkVSTyA9IGZyb21JbnQoMCk7CiAgTG9uZyQxLlpFUk8gPSBaRVJPOwogIHZhciBVWkVSTyA9IGZyb21JbnQoMCwgdHJ1ZSk7CiAgTG9uZyQxLlVaRVJPID0gVVpFUk87CiAgdmFyIE9ORSA9IGZyb21JbnQoMSk7CiAgTG9uZyQxLk9ORSA9IE9ORTsKICB2YXIgVU9ORSA9IGZyb21JbnQoMSwgdHJ1ZSk7CiAgTG9uZyQxLlVPTkUgPSBVT05FOwogIHZhciBORUdfT05FID0gZnJvbUludCgtMSk7CiAgTG9uZyQxLk5FR19PTkUgPSBORUdfT05FOwogIHZhciBNQVhfVkFMVUUgPSBmcm9tQml0cyg0Mjk0OTY3Mjk1IHwgMCwgMjE0NzQ4MzY0NyB8IDAsIGZhbHNlKTsKICBMb25nJDEuTUFYX1ZBTFVFID0gTUFYX1ZBTFVFOwogIHZhciBNQVhfVU5TSUdORURfVkFMVUUgPSBmcm9tQml0cyg0Mjk0OTY3Mjk1IHwgMCwgNDI5NDk2NzI5NSB8IDAsIHRydWUpOwogIExvbmckMS5NQVhfVU5TSUdORURfVkFMVUUgPSBNQVhfVU5TSUdORURfVkFMVUU7CiAgdmFyIE1JTl9WQUxVRSA9IGZyb21CaXRzKDAsIDIxNDc0ODM2NDggfCAwLCBmYWxzZSk7CiAgTG9uZyQxLk1JTl9WQUxVRSA9IE1JTl9WQUxVRTsKICB2YXIgTG9uZ1Byb3RvdHlwZSA9IExvbmckMS5wcm90b3R5cGU7CiAgTG9uZ1Byb3RvdHlwZS50b0ludCA9IGZ1bmN0aW9uIHRvSW50KCkgewogICAgcmV0dXJuIHRoaXMudW5zaWduZWQgPyB0aGlzLmxvdyA+Pj4gMCA6IHRoaXMubG93OwogIH07CiAgTG9uZ1Byb3RvdHlwZS50b051bWJlciA9IGZ1bmN0aW9uIHRvTnVtYmVyKCkgewogICAgaWYgKHRoaXMudW5zaWduZWQpCiAgICAgIHJldHVybiAodGhpcy5oaWdoID4+PiAwKSAqIFRXT19QV1JfMzJfREJMICsgKHRoaXMubG93ID4+PiAwKTsKICAgIHJldHVybiB0aGlzLmhpZ2ggKiBUV09fUFdSXzMyX0RCTCArICh0aGlzLmxvdyA+Pj4gMCk7CiAgfTsKICBMb25nUHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcyKHJhZGl4KSB7CiAgICByYWRpeCA9IHJhZGl4IHx8IDEwOwogICAgaWYgKHJhZGl4IDwgMiB8fCAzNiA8IHJhZGl4KQogICAgICB0aHJvdyBSYW5nZUVycm9yKCJyYWRpeCIpOwogICAgaWYgKHRoaXMuaXNaZXJvKCkpCiAgICAgIHJldHVybiAiMCI7CiAgICBpZiAodGhpcy5pc05lZ2F0aXZlKCkpIHsKICAgICAgaWYgKHRoaXMuZXEoTUlOX1ZBTFVFKSkgewogICAgICAgIHZhciByYWRpeExvbmcgPSBmcm9tTnVtYmVyKHJhZGl4KSwgZGl2ID0gdGhpcy5kaXYocmFkaXhMb25nKSwgcmVtMSA9IGRpdi5tdWwocmFkaXhMb25nKS5zdWIodGhpcyk7CiAgICAgICAgcmV0dXJuIGRpdi50b1N0cmluZyhyYWRpeCkgKyByZW0xLnRvSW50KCkudG9TdHJpbmcocmFkaXgpOwogICAgICB9IGVsc2UKICAgICAgICByZXR1cm4gIi0iICsgdGhpcy5uZWcoKS50b1N0cmluZyhyYWRpeCk7CiAgICB9CiAgICB2YXIgcmFkaXhUb1Bvd2VyID0gZnJvbU51bWJlcihwb3dfZGJsKHJhZGl4LCA2KSwgdGhpcy51bnNpZ25lZCksIHJlbSA9IHRoaXM7CiAgICB2YXIgcmVzdWx0ID0gIiI7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICB2YXIgcmVtRGl2ID0gcmVtLmRpdihyYWRpeFRvUG93ZXIpLCBpbnR2YWwgPSByZW0uc3ViKHJlbURpdi5tdWwocmFkaXhUb1Bvd2VyKSkudG9JbnQoKSA+Pj4gMCwgZGlnaXRzID0gaW50dmFsLnRvU3RyaW5nKHJhZGl4KTsKICAgICAgcmVtID0gcmVtRGl2OwogICAgICBpZiAocmVtLmlzWmVybygpKQogICAgICAgIHJldHVybiBkaWdpdHMgKyByZXN1bHQ7CiAgICAgIGVsc2UgewogICAgICAgIHdoaWxlIChkaWdpdHMubGVuZ3RoIDwgNikKICAgICAgICAgIGRpZ2l0cyA9ICIwIiArIGRpZ2l0czsKICAgICAgICByZXN1bHQgPSAiIiArIGRpZ2l0cyArIHJlc3VsdDsKICAgICAgfQogICAgfQogIH07CiAgTG9uZ1Byb3RvdHlwZS5nZXRIaWdoQml0cyA9IGZ1bmN0aW9uIGdldEhpZ2hCaXRzKCkgewogICAgcmV0dXJuIHRoaXMuaGlnaDsKICB9OwogIExvbmdQcm90b3R5cGUuZ2V0SGlnaEJpdHNVbnNpZ25lZCA9IGZ1bmN0aW9uIGdldEhpZ2hCaXRzVW5zaWduZWQoKSB7CiAgICByZXR1cm4gdGhpcy5oaWdoID4+PiAwOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5nZXRMb3dCaXRzID0gZnVuY3Rpb24gZ2V0TG93Qml0cygpIHsKICAgIHJldHVybiB0aGlzLmxvdzsKICB9OwogIExvbmdQcm90b3R5cGUuZ2V0TG93Qml0c1Vuc2lnbmVkID0gZnVuY3Rpb24gZ2V0TG93Qml0c1Vuc2lnbmVkKCkgewogICAgcmV0dXJuIHRoaXMubG93ID4+PiAwOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5nZXROdW1CaXRzQWJzID0gZnVuY3Rpb24gZ2V0TnVtQml0c0FicygpIHsKICAgIGlmICh0aGlzLmlzTmVnYXRpdmUoKSkKICAgICAgcmV0dXJuIHRoaXMuZXEoTUlOX1ZBTFVFKSA/IDY0IDogdGhpcy5uZWcoKS5nZXROdW1CaXRzQWJzKCk7CiAgICB2YXIgdmFsID0gdGhpcy5oaWdoICE9IDAgPyB0aGlzLmhpZ2ggOiB0aGlzLmxvdzsKICAgIGZvciAodmFyIGJpdCA9IDMxOyBiaXQgPiAwOyBiaXQtLSkKICAgICAgaWYgKCh2YWwgJiAxIDw8IGJpdCkgIT0gMCkKICAgICAgICBicmVhazsKICAgIHJldHVybiB0aGlzLmhpZ2ggIT0gMCA/IGJpdCArIDMzIDogYml0ICsgMTsKICB9OwogIExvbmdQcm90b3R5cGUuaXNaZXJvID0gZnVuY3Rpb24gaXNaZXJvKCkgewogICAgcmV0dXJuIHRoaXMuaGlnaCA9PT0gMCAmJiB0aGlzLmxvdyA9PT0gMDsKICB9OwogIExvbmdQcm90b3R5cGUuZXF6ID0gTG9uZ1Byb3RvdHlwZS5pc1plcm87CiAgTG9uZ1Byb3RvdHlwZS5pc05lZ2F0aXZlID0gZnVuY3Rpb24gaXNOZWdhdGl2ZSgpIHsKICAgIHJldHVybiAhdGhpcy51bnNpZ25lZCAmJiB0aGlzLmhpZ2ggPCAwOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5pc1Bvc2l0aXZlID0gZnVuY3Rpb24gaXNQb3NpdGl2ZSgpIHsKICAgIHJldHVybiB0aGlzLnVuc2lnbmVkIHx8IHRoaXMuaGlnaCA+PSAwOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5pc09kZCA9IGZ1bmN0aW9uIGlzT2RkKCkgewogICAgcmV0dXJuICh0aGlzLmxvdyAmIDEpID09PSAxOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5pc0V2ZW4gPSBmdW5jdGlvbiBpc0V2ZW4oKSB7CiAgICByZXR1cm4gKHRoaXMubG93ICYgMSkgPT09IDA7CiAgfTsKICBMb25nUHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIGVxdWFscyhvdGhlcikgewogICAgaWYgKCFpc0xvbmcob3RoZXIpKQogICAgICBvdGhlciA9IGZyb21WYWx1ZShvdGhlcik7CiAgICBpZiAodGhpcy51bnNpZ25lZCAhPT0gb3RoZXIudW5zaWduZWQgJiYgdGhpcy5oaWdoID4+PiAzMSA9PT0gMSAmJiBvdGhlci5oaWdoID4+PiAzMSA9PT0gMSkKICAgICAgcmV0dXJuIGZhbHNlOwogICAgcmV0dXJuIHRoaXMuaGlnaCA9PT0gb3RoZXIuaGlnaCAmJiB0aGlzLmxvdyA9PT0gb3RoZXIubG93OwogIH07CiAgTG9uZ1Byb3RvdHlwZS5lcSA9IExvbmdQcm90b3R5cGUuZXF1YWxzOwogIExvbmdQcm90b3R5cGUubm90RXF1YWxzID0gZnVuY3Rpb24gbm90RXF1YWxzKG90aGVyKSB7CiAgICByZXR1cm4gIXRoaXMuZXEob3RoZXIpOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5uZXEgPSBMb25nUHJvdG90eXBlLm5vdEVxdWFsczsKICBMb25nUHJvdG90eXBlLm5lID0gTG9uZ1Byb3RvdHlwZS5ub3RFcXVhbHM7CiAgTG9uZ1Byb3RvdHlwZS5sZXNzVGhhbiA9IGZ1bmN0aW9uIGxlc3NUaGFuKG90aGVyKSB7CiAgICByZXR1cm4gdGhpcy5jb21wKG90aGVyKSA8IDA7CiAgfTsKICBMb25nUHJvdG90eXBlLmx0ID0gTG9uZ1Byb3RvdHlwZS5sZXNzVGhhbjsKICBMb25nUHJvdG90eXBlLmxlc3NUaGFuT3JFcXVhbCA9IGZ1bmN0aW9uIGxlc3NUaGFuT3JFcXVhbChvdGhlcikgewogICAgcmV0dXJuIHRoaXMuY29tcChvdGhlcikgPD0gMDsKICB9OwogIExvbmdQcm90b3R5cGUubHRlID0gTG9uZ1Byb3RvdHlwZS5sZXNzVGhhbk9yRXF1YWw7CiAgTG9uZ1Byb3RvdHlwZS5sZSA9IExvbmdQcm90b3R5cGUubGVzc1RoYW5PckVxdWFsOwogIExvbmdQcm90b3R5cGUuZ3JlYXRlclRoYW4gPSBmdW5jdGlvbiBncmVhdGVyVGhhbihvdGhlcikgewogICAgcmV0dXJuIHRoaXMuY29tcChvdGhlcikgPiAwOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5ndCA9IExvbmdQcm90b3R5cGUuZ3JlYXRlclRoYW47CiAgTG9uZ1Byb3RvdHlwZS5ncmVhdGVyVGhhbk9yRXF1YWwgPSBmdW5jdGlvbiBncmVhdGVyVGhhbk9yRXF1YWwob3RoZXIpIHsKICAgIHJldHVybiB0aGlzLmNvbXAob3RoZXIpID49IDA7CiAgfTsKICBMb25nUHJvdG90eXBlLmd0ZSA9IExvbmdQcm90b3R5cGUuZ3JlYXRlclRoYW5PckVxdWFsOwogIExvbmdQcm90b3R5cGUuZ2UgPSBMb25nUHJvdG90eXBlLmdyZWF0ZXJUaGFuT3JFcXVhbDsKICBMb25nUHJvdG90eXBlLmNvbXBhcmUgPSBmdW5jdGlvbiBjb21wYXJlKG90aGVyKSB7CiAgICBpZiAoIWlzTG9uZyhvdGhlcikpCiAgICAgIG90aGVyID0gZnJvbVZhbHVlKG90aGVyKTsKICAgIGlmICh0aGlzLmVxKG90aGVyKSkKICAgICAgcmV0dXJuIDA7CiAgICB2YXIgdGhpc05lZyA9IHRoaXMuaXNOZWdhdGl2ZSgpLCBvdGhlck5lZyA9IG90aGVyLmlzTmVnYXRpdmUoKTsKICAgIGlmICh0aGlzTmVnICYmICFvdGhlck5lZykKICAgICAgcmV0dXJuIC0xOwogICAgaWYgKCF0aGlzTmVnICYmIG90aGVyTmVnKQogICAgICByZXR1cm4gMTsKICAgIGlmICghdGhpcy51bnNpZ25lZCkKICAgICAgcmV0dXJuIHRoaXMuc3ViKG90aGVyKS5pc05lZ2F0aXZlKCkgPyAtMSA6IDE7CiAgICByZXR1cm4gb3RoZXIuaGlnaCA+Pj4gMCA+IHRoaXMuaGlnaCA+Pj4gMCB8fCBvdGhlci5oaWdoID09PSB0aGlzLmhpZ2ggJiYgb3RoZXIubG93ID4+PiAwID4gdGhpcy5sb3cgPj4+IDAgPyAtMSA6IDE7CiAgfTsKICBMb25nUHJvdG90eXBlLmNvbXAgPSBMb25nUHJvdG90eXBlLmNvbXBhcmU7CiAgTG9uZ1Byb3RvdHlwZS5uZWdhdGUgPSBmdW5jdGlvbiBuZWdhdGUoKSB7CiAgICBpZiAoIXRoaXMudW5zaWduZWQgJiYgdGhpcy5lcShNSU5fVkFMVUUpKQogICAgICByZXR1cm4gTUlOX1ZBTFVFOwogICAgcmV0dXJuIHRoaXMubm90KCkuYWRkKE9ORSk7CiAgfTsKICBMb25nUHJvdG90eXBlLm5lZyA9IExvbmdQcm90b3R5cGUubmVnYXRlOwogIExvbmdQcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gYWRkKGFkZGVuZCkgewogICAgaWYgKCFpc0xvbmcoYWRkZW5kKSkKICAgICAgYWRkZW5kID0gZnJvbVZhbHVlKGFkZGVuZCk7CiAgICB2YXIgYTQ4ID0gdGhpcy5oaWdoID4+PiAxNjsKICAgIHZhciBhMzIgPSB0aGlzLmhpZ2ggJiA2NTUzNTsKICAgIHZhciBhMTYgPSB0aGlzLmxvdyA+Pj4gMTY7CiAgICB2YXIgYTAwID0gdGhpcy5sb3cgJiA2NTUzNTsKICAgIHZhciBiNDggPSBhZGRlbmQuaGlnaCA+Pj4gMTY7CiAgICB2YXIgYjMyID0gYWRkZW5kLmhpZ2ggJiA2NTUzNTsKICAgIHZhciBiMTYgPSBhZGRlbmQubG93ID4+PiAxNjsKICAgIHZhciBiMDAgPSBhZGRlbmQubG93ICYgNjU1MzU7CiAgICB2YXIgYzQ4ID0gMCwgYzMyID0gMCwgYzE2ID0gMCwgYzAwID0gMDsKICAgIGMwMCArPSBhMDAgKyBiMDA7CiAgICBjMTYgKz0gYzAwID4+PiAxNjsKICAgIGMwMCAmPSA2NTUzNTsKICAgIGMxNiArPSBhMTYgKyBiMTY7CiAgICBjMzIgKz0gYzE2ID4+PiAxNjsKICAgIGMxNiAmPSA2NTUzNTsKICAgIGMzMiArPSBhMzIgKyBiMzI7CiAgICBjNDggKz0gYzMyID4+PiAxNjsKICAgIGMzMiAmPSA2NTUzNTsKICAgIGM0OCArPSBhNDggKyBiNDg7CiAgICBjNDggJj0gNjU1MzU7CiAgICByZXR1cm4gZnJvbUJpdHMoYzE2IDw8IDE2IHwgYzAwLCBjNDggPDwgMTYgfCBjMzIsIHRoaXMudW5zaWduZWQpOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5zdWJ0cmFjdCA9IGZ1bmN0aW9uIHN1YnRyYWN0KHN1YnRyYWhlbmQpIHsKICAgIGlmICghaXNMb25nKHN1YnRyYWhlbmQpKQogICAgICBzdWJ0cmFoZW5kID0gZnJvbVZhbHVlKHN1YnRyYWhlbmQpOwogICAgcmV0dXJuIHRoaXMuYWRkKHN1YnRyYWhlbmQubmVnKCkpOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5zdWIgPSBMb25nUHJvdG90eXBlLnN1YnRyYWN0OwogIExvbmdQcm90b3R5cGUubXVsdGlwbHkgPSBmdW5jdGlvbiBtdWx0aXBseShtdWx0aXBsaWVyKSB7CiAgICBpZiAodGhpcy5pc1plcm8oKSkKICAgICAgcmV0dXJuIFpFUk87CiAgICBpZiAoIWlzTG9uZyhtdWx0aXBsaWVyKSkKICAgICAgbXVsdGlwbGllciA9IGZyb21WYWx1ZShtdWx0aXBsaWVyKTsKICAgIGlmICh3YXNtKSB7CiAgICAgIHZhciBsb3cgPSB3YXNtLm11bCh0aGlzLmxvdywgdGhpcy5oaWdoLCBtdWx0aXBsaWVyLmxvdywgbXVsdGlwbGllci5oaWdoKTsKICAgICAgcmV0dXJuIGZyb21CaXRzKGxvdywgd2FzbS5nZXRfaGlnaCgpLCB0aGlzLnVuc2lnbmVkKTsKICAgIH0KICAgIGlmIChtdWx0aXBsaWVyLmlzWmVybygpKQogICAgICByZXR1cm4gWkVSTzsKICAgIGlmICh0aGlzLmVxKE1JTl9WQUxVRSkpCiAgICAgIHJldHVybiBtdWx0aXBsaWVyLmlzT2RkKCkgPyBNSU5fVkFMVUUgOiBaRVJPOwogICAgaWYgKG11bHRpcGxpZXIuZXEoTUlOX1ZBTFVFKSkKICAgICAgcmV0dXJuIHRoaXMuaXNPZGQoKSA/IE1JTl9WQUxVRSA6IFpFUk87CiAgICBpZiAodGhpcy5pc05lZ2F0aXZlKCkpIHsKICAgICAgaWYgKG11bHRpcGxpZXIuaXNOZWdhdGl2ZSgpKQogICAgICAgIHJldHVybiB0aGlzLm5lZygpLm11bChtdWx0aXBsaWVyLm5lZygpKTsKICAgICAgZWxzZQogICAgICAgIHJldHVybiB0aGlzLm5lZygpLm11bChtdWx0aXBsaWVyKS5uZWcoKTsKICAgIH0gZWxzZSBpZiAobXVsdGlwbGllci5pc05lZ2F0aXZlKCkpCiAgICAgIHJldHVybiB0aGlzLm11bChtdWx0aXBsaWVyLm5lZygpKS5uZWcoKTsKICAgIGlmICh0aGlzLmx0KFRXT19QV1JfMjQpICYmIG11bHRpcGxpZXIubHQoVFdPX1BXUl8yNCkpCiAgICAgIHJldHVybiBmcm9tTnVtYmVyKHRoaXMudG9OdW1iZXIoKSAqIG11bHRpcGxpZXIudG9OdW1iZXIoKSwgdGhpcy51bnNpZ25lZCk7CiAgICB2YXIgYTQ4ID0gdGhpcy5oaWdoID4+PiAxNjsKICAgIHZhciBhMzIgPSB0aGlzLmhpZ2ggJiA2NTUzNTsKICAgIHZhciBhMTYgPSB0aGlzLmxvdyA+Pj4gMTY7CiAgICB2YXIgYTAwID0gdGhpcy5sb3cgJiA2NTUzNTsKICAgIHZhciBiNDggPSBtdWx0aXBsaWVyLmhpZ2ggPj4+IDE2OwogICAgdmFyIGIzMiA9IG11bHRpcGxpZXIuaGlnaCAmIDY1NTM1OwogICAgdmFyIGIxNiA9IG11bHRpcGxpZXIubG93ID4+PiAxNjsKICAgIHZhciBiMDAgPSBtdWx0aXBsaWVyLmxvdyAmIDY1NTM1OwogICAgdmFyIGM0OCA9IDAsIGMzMiA9IDAsIGMxNiA9IDAsIGMwMCA9IDA7CiAgICBjMDAgKz0gYTAwICogYjAwOwogICAgYzE2ICs9IGMwMCA+Pj4gMTY7CiAgICBjMDAgJj0gNjU1MzU7CiAgICBjMTYgKz0gYTE2ICogYjAwOwogICAgYzMyICs9IGMxNiA+Pj4gMTY7CiAgICBjMTYgJj0gNjU1MzU7CiAgICBjMTYgKz0gYTAwICogYjE2OwogICAgYzMyICs9IGMxNiA+Pj4gMTY7CiAgICBjMTYgJj0gNjU1MzU7CiAgICBjMzIgKz0gYTMyICogYjAwOwogICAgYzQ4ICs9IGMzMiA+Pj4gMTY7CiAgICBjMzIgJj0gNjU1MzU7CiAgICBjMzIgKz0gYTE2ICogYjE2OwogICAgYzQ4ICs9IGMzMiA+Pj4gMTY7CiAgICBjMzIgJj0gNjU1MzU7CiAgICBjMzIgKz0gYTAwICogYjMyOwogICAgYzQ4ICs9IGMzMiA+Pj4gMTY7CiAgICBjMzIgJj0gNjU1MzU7CiAgICBjNDggKz0gYTQ4ICogYjAwICsgYTMyICogYjE2ICsgYTE2ICogYjMyICsgYTAwICogYjQ4OwogICAgYzQ4ICY9IDY1NTM1OwogICAgcmV0dXJuIGZyb21CaXRzKGMxNiA8PCAxNiB8IGMwMCwgYzQ4IDw8IDE2IHwgYzMyLCB0aGlzLnVuc2lnbmVkKTsKICB9OwogIExvbmdQcm90b3R5cGUubXVsID0gTG9uZ1Byb3RvdHlwZS5tdWx0aXBseTsKICBMb25nUHJvdG90eXBlLmRpdmlkZSA9IGZ1bmN0aW9uIGRpdmlkZShkaXZpc29yKSB7CiAgICBpZiAoIWlzTG9uZyhkaXZpc29yKSkKICAgICAgZGl2aXNvciA9IGZyb21WYWx1ZShkaXZpc29yKTsKICAgIGlmIChkaXZpc29yLmlzWmVybygpKQogICAgICB0aHJvdyBFcnJvcigiZGl2aXNpb24gYnkgemVybyIpOwogICAgaWYgKHdhc20pIHsKICAgICAgaWYgKCF0aGlzLnVuc2lnbmVkICYmIHRoaXMuaGlnaCA9PT0gLTIxNDc0ODM2NDggJiYgZGl2aXNvci5sb3cgPT09IC0xICYmIGRpdmlzb3IuaGlnaCA9PT0gLTEpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICB2YXIgbG93ID0gKHRoaXMudW5zaWduZWQgPyB3YXNtLmRpdl91IDogd2FzbS5kaXZfcykodGhpcy5sb3csIHRoaXMuaGlnaCwgZGl2aXNvci5sb3csIGRpdmlzb3IuaGlnaCk7CiAgICAgIHJldHVybiBmcm9tQml0cyhsb3csIHdhc20uZ2V0X2hpZ2goKSwgdGhpcy51bnNpZ25lZCk7CiAgICB9CiAgICBpZiAodGhpcy5pc1plcm8oKSkKICAgICAgcmV0dXJuIHRoaXMudW5zaWduZWQgPyBVWkVSTyA6IFpFUk87CiAgICB2YXIgYXBwcm94LCByZW0sIHJlczsKICAgIGlmICghdGhpcy51bnNpZ25lZCkgewogICAgICBpZiAodGhpcy5lcShNSU5fVkFMVUUpKSB7CiAgICAgICAgaWYgKGRpdmlzb3IuZXEoT05FKSB8fCBkaXZpc29yLmVxKE5FR19PTkUpKQogICAgICAgICAgcmV0dXJuIE1JTl9WQUxVRTsKICAgICAgICBlbHNlIGlmIChkaXZpc29yLmVxKE1JTl9WQUxVRSkpCiAgICAgICAgICByZXR1cm4gT05FOwogICAgICAgIGVsc2UgewogICAgICAgICAgdmFyIGhhbGZUaGlzID0gdGhpcy5zaHIoMSk7CiAgICAgICAgICBhcHByb3ggPSBoYWxmVGhpcy5kaXYoZGl2aXNvcikuc2hsKDEpOwogICAgICAgICAgaWYgKGFwcHJveC5lcShaRVJPKSkgewogICAgICAgICAgICByZXR1cm4gZGl2aXNvci5pc05lZ2F0aXZlKCkgPyBPTkUgOiBORUdfT05FOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVtID0gdGhpcy5zdWIoZGl2aXNvci5tdWwoYXBwcm94KSk7CiAgICAgICAgICAgIHJlcyA9IGFwcHJveC5hZGQocmVtLmRpdihkaXZpc29yKSk7CiAgICAgICAgICAgIHJldHVybiByZXM7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGRpdmlzb3IuZXEoTUlOX1ZBTFVFKSkKICAgICAgICByZXR1cm4gdGhpcy51bnNpZ25lZCA/IFVaRVJPIDogWkVSTzsKICAgICAgaWYgKHRoaXMuaXNOZWdhdGl2ZSgpKSB7CiAgICAgICAgaWYgKGRpdmlzb3IuaXNOZWdhdGl2ZSgpKQogICAgICAgICAgcmV0dXJuIHRoaXMubmVnKCkuZGl2KGRpdmlzb3IubmVnKCkpOwogICAgICAgIHJldHVybiB0aGlzLm5lZygpLmRpdihkaXZpc29yKS5uZWcoKTsKICAgICAgfSBlbHNlIGlmIChkaXZpc29yLmlzTmVnYXRpdmUoKSkKICAgICAgICByZXR1cm4gdGhpcy5kaXYoZGl2aXNvci5uZWcoKSkubmVnKCk7CiAgICAgIHJlcyA9IFpFUk87CiAgICB9IGVsc2UgewogICAgICBpZiAoIWRpdmlzb3IudW5zaWduZWQpCiAgICAgICAgZGl2aXNvciA9IGRpdmlzb3IudG9VbnNpZ25lZCgpOwogICAgICBpZiAoZGl2aXNvci5ndCh0aGlzKSkKICAgICAgICByZXR1cm4gVVpFUk87CiAgICAgIGlmIChkaXZpc29yLmd0KHRoaXMuc2hydSgxKSkpCiAgICAgICAgcmV0dXJuIFVPTkU7CiAgICAgIHJlcyA9IFVaRVJPOwogICAgfQogICAgcmVtID0gdGhpczsKICAgIHdoaWxlIChyZW0uZ3RlKGRpdmlzb3IpKSB7CiAgICAgIGFwcHJveCA9IE1hdGgubWF4KDEsIE1hdGguZmxvb3IocmVtLnRvTnVtYmVyKCkgLyBkaXZpc29yLnRvTnVtYmVyKCkpKTsKICAgICAgdmFyIGxvZzIgPSBNYXRoLmNlaWwoTWF0aC5sb2coYXBwcm94KSAvIE1hdGguTE4yKSwgZGVsdGEgPSBsb2cyIDw9IDQ4ID8gMSA6IHBvd19kYmwoMiwgbG9nMiAtIDQ4KSwgYXBwcm94UmVzID0gZnJvbU51bWJlcihhcHByb3gpLCBhcHByb3hSZW0gPSBhcHByb3hSZXMubXVsKGRpdmlzb3IpOwogICAgICB3aGlsZSAoYXBwcm94UmVtLmlzTmVnYXRpdmUoKSB8fCBhcHByb3hSZW0uZ3QocmVtKSkgewogICAgICAgIGFwcHJveCAtPSBkZWx0YTsKICAgICAgICBhcHByb3hSZXMgPSBmcm9tTnVtYmVyKGFwcHJveCwgdGhpcy51bnNpZ25lZCk7CiAgICAgICAgYXBwcm94UmVtID0gYXBwcm94UmVzLm11bChkaXZpc29yKTsKICAgICAgfQogICAgICBpZiAoYXBwcm94UmVzLmlzWmVybygpKQogICAgICAgIGFwcHJveFJlcyA9IE9ORTsKICAgICAgcmVzID0gcmVzLmFkZChhcHByb3hSZXMpOwogICAgICByZW0gPSByZW0uc3ViKGFwcHJveFJlbSk7CiAgICB9CiAgICByZXR1cm4gcmVzOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5kaXYgPSBMb25nUHJvdG90eXBlLmRpdmlkZTsKICBMb25nUHJvdG90eXBlLm1vZHVsbyA9IGZ1bmN0aW9uIG1vZHVsbyhkaXZpc29yKSB7CiAgICBpZiAoIWlzTG9uZyhkaXZpc29yKSkKICAgICAgZGl2aXNvciA9IGZyb21WYWx1ZShkaXZpc29yKTsKICAgIGlmICh3YXNtKSB7CiAgICAgIHZhciBsb3cgPSAodGhpcy51bnNpZ25lZCA/IHdhc20ucmVtX3UgOiB3YXNtLnJlbV9zKSh0aGlzLmxvdywgdGhpcy5oaWdoLCBkaXZpc29yLmxvdywgZGl2aXNvci5oaWdoKTsKICAgICAgcmV0dXJuIGZyb21CaXRzKGxvdywgd2FzbS5nZXRfaGlnaCgpLCB0aGlzLnVuc2lnbmVkKTsKICAgIH0KICAgIHJldHVybiB0aGlzLnN1Yih0aGlzLmRpdihkaXZpc29yKS5tdWwoZGl2aXNvcikpOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5tb2QgPSBMb25nUHJvdG90eXBlLm1vZHVsbzsKICBMb25nUHJvdG90eXBlLnJlbSA9IExvbmdQcm90b3R5cGUubW9kdWxvOwogIExvbmdQcm90b3R5cGUubm90ID0gZnVuY3Rpb24gbm90KCkgewogICAgcmV0dXJuIGZyb21CaXRzKH50aGlzLmxvdywgfnRoaXMuaGlnaCwgdGhpcy51bnNpZ25lZCk7CiAgfTsKICBMb25nUHJvdG90eXBlLmFuZCA9IGZ1bmN0aW9uIGFuZChvdGhlcikgewogICAgaWYgKCFpc0xvbmcob3RoZXIpKQogICAgICBvdGhlciA9IGZyb21WYWx1ZShvdGhlcik7CiAgICByZXR1cm4gZnJvbUJpdHModGhpcy5sb3cgJiBvdGhlci5sb3csIHRoaXMuaGlnaCAmIG90aGVyLmhpZ2gsIHRoaXMudW5zaWduZWQpOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5vciA9IGZ1bmN0aW9uIG9yKG90aGVyKSB7CiAgICBpZiAoIWlzTG9uZyhvdGhlcikpCiAgICAgIG90aGVyID0gZnJvbVZhbHVlKG90aGVyKTsKICAgIHJldHVybiBmcm9tQml0cyh0aGlzLmxvdyB8IG90aGVyLmxvdywgdGhpcy5oaWdoIHwgb3RoZXIuaGlnaCwgdGhpcy51bnNpZ25lZCk7CiAgfTsKICBMb25nUHJvdG90eXBlLnhvciA9IGZ1bmN0aW9uIHhvcihvdGhlcikgewogICAgaWYgKCFpc0xvbmcob3RoZXIpKQogICAgICBvdGhlciA9IGZyb21WYWx1ZShvdGhlcik7CiAgICByZXR1cm4gZnJvbUJpdHModGhpcy5sb3cgXiBvdGhlci5sb3csIHRoaXMuaGlnaCBeIG90aGVyLmhpZ2gsIHRoaXMudW5zaWduZWQpOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5zaGlmdExlZnQgPSBmdW5jdGlvbiBzaGlmdExlZnQobnVtQml0cykgewogICAgaWYgKGlzTG9uZyhudW1CaXRzKSkKICAgICAgbnVtQml0cyA9IG51bUJpdHMudG9JbnQoKTsKICAgIGlmICgobnVtQml0cyAmPSA2MykgPT09IDApCiAgICAgIHJldHVybiB0aGlzOwogICAgZWxzZSBpZiAobnVtQml0cyA8IDMyKQogICAgICByZXR1cm4gZnJvbUJpdHModGhpcy5sb3cgPDwgbnVtQml0cywgdGhpcy5oaWdoIDw8IG51bUJpdHMgfCB0aGlzLmxvdyA+Pj4gMzIgLSBudW1CaXRzLCB0aGlzLnVuc2lnbmVkKTsKICAgIGVsc2UKICAgICAgcmV0dXJuIGZyb21CaXRzKDAsIHRoaXMubG93IDw8IG51bUJpdHMgLSAzMiwgdGhpcy51bnNpZ25lZCk7CiAgfTsKICBMb25nUHJvdG90eXBlLnNobCA9IExvbmdQcm90b3R5cGUuc2hpZnRMZWZ0OwogIExvbmdQcm90b3R5cGUuc2hpZnRSaWdodCA9IGZ1bmN0aW9uIHNoaWZ0UmlnaHQobnVtQml0cykgewogICAgaWYgKGlzTG9uZyhudW1CaXRzKSkKICAgICAgbnVtQml0cyA9IG51bUJpdHMudG9JbnQoKTsKICAgIGlmICgobnVtQml0cyAmPSA2MykgPT09IDApCiAgICAgIHJldHVybiB0aGlzOwogICAgZWxzZSBpZiAobnVtQml0cyA8IDMyKQogICAgICByZXR1cm4gZnJvbUJpdHModGhpcy5sb3cgPj4+IG51bUJpdHMgfCB0aGlzLmhpZ2ggPDwgMzIgLSBudW1CaXRzLCB0aGlzLmhpZ2ggPj4gbnVtQml0cywgdGhpcy51bnNpZ25lZCk7CiAgICBlbHNlCiAgICAgIHJldHVybiBmcm9tQml0cyh0aGlzLmhpZ2ggPj4gbnVtQml0cyAtIDMyLCB0aGlzLmhpZ2ggPj0gMCA/IDAgOiAtMSwgdGhpcy51bnNpZ25lZCk7CiAgfTsKICBMb25nUHJvdG90eXBlLnNociA9IExvbmdQcm90b3R5cGUuc2hpZnRSaWdodDsKICBMb25nUHJvdG90eXBlLnNoaWZ0UmlnaHRVbnNpZ25lZCA9IGZ1bmN0aW9uIHNoaWZ0UmlnaHRVbnNpZ25lZChudW1CaXRzKSB7CiAgICBpZiAoaXNMb25nKG51bUJpdHMpKQogICAgICBudW1CaXRzID0gbnVtQml0cy50b0ludCgpOwogICAgbnVtQml0cyAmPSA2MzsKICAgIGlmIChudW1CaXRzID09PSAwKQogICAgICByZXR1cm4gdGhpczsKICAgIGVsc2UgewogICAgICB2YXIgaGlnaCA9IHRoaXMuaGlnaDsKICAgICAgaWYgKG51bUJpdHMgPCAzMikgewogICAgICAgIHZhciBsb3cgPSB0aGlzLmxvdzsKICAgICAgICByZXR1cm4gZnJvbUJpdHMobG93ID4+PiBudW1CaXRzIHwgaGlnaCA8PCAzMiAtIG51bUJpdHMsIGhpZ2ggPj4+IG51bUJpdHMsIHRoaXMudW5zaWduZWQpOwogICAgICB9IGVsc2UgaWYgKG51bUJpdHMgPT09IDMyKQogICAgICAgIHJldHVybiBmcm9tQml0cyhoaWdoLCAwLCB0aGlzLnVuc2lnbmVkKTsKICAgICAgZWxzZQogICAgICAgIHJldHVybiBmcm9tQml0cyhoaWdoID4+PiBudW1CaXRzIC0gMzIsIDAsIHRoaXMudW5zaWduZWQpOwogICAgfQogIH07CiAgTG9uZ1Byb3RvdHlwZS5zaHJ1ID0gTG9uZ1Byb3RvdHlwZS5zaGlmdFJpZ2h0VW5zaWduZWQ7CiAgTG9uZ1Byb3RvdHlwZS5zaHJfdSA9IExvbmdQcm90b3R5cGUuc2hpZnRSaWdodFVuc2lnbmVkOwogIExvbmdQcm90b3R5cGUudG9TaWduZWQgPSBmdW5jdGlvbiB0b1NpZ25lZCgpIHsKICAgIGlmICghdGhpcy51bnNpZ25lZCkKICAgICAgcmV0dXJuIHRoaXM7CiAgICByZXR1cm4gZnJvbUJpdHModGhpcy5sb3csIHRoaXMuaGlnaCwgZmFsc2UpOwogIH07CiAgTG9uZ1Byb3RvdHlwZS50b1Vuc2lnbmVkID0gZnVuY3Rpb24gdG9VbnNpZ25lZCgpIHsKICAgIGlmICh0aGlzLnVuc2lnbmVkKQogICAgICByZXR1cm4gdGhpczsKICAgIHJldHVybiBmcm9tQml0cyh0aGlzLmxvdywgdGhpcy5oaWdoLCB0cnVlKTsKICB9OwogIExvbmdQcm90b3R5cGUudG9CeXRlcyA9IGZ1bmN0aW9uIHRvQnl0ZXMobGUpIHsKICAgIHJldHVybiBsZSA/IHRoaXMudG9CeXRlc0xFKCkgOiB0aGlzLnRvQnl0ZXNCRSgpOwogIH07CiAgTG9uZ1Byb3RvdHlwZS50b0J5dGVzTEUgPSBmdW5jdGlvbiB0b0J5dGVzTEUoKSB7CiAgICB2YXIgaGkgPSB0aGlzLmhpZ2gsIGxvID0gdGhpcy5sb3c7CiAgICByZXR1cm4gWwogICAgICBsbyAmIDI1NSwKICAgICAgbG8gPj4+IDggJiAyNTUsCiAgICAgIGxvID4+PiAxNiAmIDI1NSwKICAgICAgbG8gPj4+IDI0LAogICAgICBoaSAmIDI1NSwKICAgICAgaGkgPj4+IDggJiAyNTUsCiAgICAgIGhpID4+PiAxNiAmIDI1NSwKICAgICAgaGkgPj4+IDI0CiAgICBdOwogIH07CiAgTG9uZ1Byb3RvdHlwZS50b0J5dGVzQkUgPSBmdW5jdGlvbiB0b0J5dGVzQkUoKSB7CiAgICB2YXIgaGkgPSB0aGlzLmhpZ2gsIGxvID0gdGhpcy5sb3c7CiAgICByZXR1cm4gWwogICAgICBoaSA+Pj4gMjQsCiAgICAgIGhpID4+PiAxNiAmIDI1NSwKICAgICAgaGkgPj4+IDggJiAyNTUsCiAgICAgIGhpICYgMjU1LAogICAgICBsbyA+Pj4gMjQsCiAgICAgIGxvID4+PiAxNiAmIDI1NSwKICAgICAgbG8gPj4+IDggJiAyNTUsCiAgICAgIGxvICYgMjU1CiAgICBdOwogIH07CiAgTG9uZyQxLmZyb21CeXRlcyA9IGZ1bmN0aW9uIGZyb21CeXRlcyhieXRlcywgdW5zaWduZWQsIGxlKSB7CiAgICByZXR1cm4gbGUgPyBMb25nJDEuZnJvbUJ5dGVzTEUoYnl0ZXMsIHVuc2lnbmVkKSA6IExvbmckMS5mcm9tQnl0ZXNCRShieXRlcywgdW5zaWduZWQpOwogIH07CiAgTG9uZyQxLmZyb21CeXRlc0xFID0gZnVuY3Rpb24gZnJvbUJ5dGVzTEUoYnl0ZXMsIHVuc2lnbmVkKSB7CiAgICByZXR1cm4gbmV3IExvbmckMShieXRlc1swXSB8IGJ5dGVzWzFdIDw8IDggfCBieXRlc1syXSA8PCAxNiB8IGJ5dGVzWzNdIDw8IDI0LCBieXRlc1s0XSB8IGJ5dGVzWzVdIDw8IDggfCBieXRlc1s2XSA8PCAxNiB8IGJ5dGVzWzddIDw8IDI0LCB1bnNpZ25lZCk7CiAgfTsKICBMb25nJDEuZnJvbUJ5dGVzQkUgPSBmdW5jdGlvbiBmcm9tQnl0ZXNCRShieXRlcywgdW5zaWduZWQpIHsKICAgIHJldHVybiBuZXcgTG9uZyQxKGJ5dGVzWzRdIDw8IDI0IHwgYnl0ZXNbNV0gPDwgMTYgfCBieXRlc1s2XSA8PCA4IHwgYnl0ZXNbN10sIGJ5dGVzWzBdIDw8IDI0IHwgYnl0ZXNbMV0gPDwgMTYgfCBieXRlc1syXSA8PCA4IHwgYnl0ZXNbM10sIHVuc2lnbmVkKTsKICB9OwogIHZhciB2aXJ0dWFsT2Zmc2V0ID0ge307CiAgdmFyIGVudHJ5VmlydHVhbCQ1ID0gZW50cnlWaXJ0dWFsJGE7CiAgdmFyIGNvbmNhdCQzID0gZW50cnlWaXJ0dWFsJDUoIkFycmF5IikuY29uY2F0OwogIHZhciBjb25jYXQkMiA9IGNvbmNhdCQzOwogIHZhciBBcnJheVByb3RvdHlwZSQzID0gQXJyYXkucHJvdG90eXBlOwogIHZhciBjb25jYXRfMSA9IGZ1bmN0aW9uKGl0KSB7CiAgICB2YXIgb3duID0gaXQuY29uY2F0OwogICAgcmV0dXJuIGl0ID09PSBBcnJheVByb3RvdHlwZSQzIHx8IGl0IGluc3RhbmNlb2YgQXJyYXkgJiYgb3duID09PSBBcnJheVByb3RvdHlwZSQzLmNvbmNhdCA/IGNvbmNhdCQyIDogb3duOwogIH07CiAgdmFyIHBhcmVudCRqID0gY29uY2F0XzE7CiAgdmFyIGNvbmNhdCQxID0gcGFyZW50JGo7CiAgdmFyIGNvbmNhdCA9IGNvbmNhdCQxOwogIChmdW5jdGlvbihleHBvcnRzKSB7CiAgICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIgPSBpbnRlcm9wUmVxdWlyZURlZmF1bHQkMS5leHBvcnRzOwogICAgdmFyIF9PYmplY3QkZGVmaW5lUHJvcGVydHkgPSBkZWZpbmVQcm9wZXJ0eSQ5OwogICAgX09iamVjdCRkZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5mcm9tQnl0ZXMgPSBmcm9tQnl0ZXM7CiAgICBleHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7CiAgICB2YXIgX2NvbmNhdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGNvbmNhdCk7CiAgICB2YXIgX2NsYXNzQ2FsbENoZWNrMjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihjbGFzc0NhbGxDaGVjayQxLmV4cG9ydHMpOwogICAgdmFyIF9jcmVhdGVDbGFzczIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoY3JlYXRlQ2xhc3MkMS5leHBvcnRzKTsKICAgIHZhciBfZGVmaW5lUHJvcGVydHkyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGRlZmluZVByb3BlcnR5JDYuZXhwb3J0cyk7CiAgICB2YXIgVmlydHVhbE9mZnNldCA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgICAgZnVuY3Rpb24gVmlydHVhbE9mZnNldDIoYmxvY2tQb3NpdGlvbiwgZGF0YVBvc2l0aW9uKSB7CiAgICAgICAgKDAsIF9jbGFzc0NhbGxDaGVjazIyLmRlZmF1bHQpKHRoaXMsIFZpcnR1YWxPZmZzZXQyKTsKICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5MjIuZGVmYXVsdCkodGhpcywgImJsb2NrUG9zaXRpb24iLCB2b2lkIDApOwogICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyMi5kZWZhdWx0KSh0aGlzLCAiZGF0YVBvc2l0aW9uIiwgdm9pZCAwKTsKICAgICAgICB0aGlzLmJsb2NrUG9zaXRpb24gPSBibG9ja1Bvc2l0aW9uOwogICAgICAgIHRoaXMuZGF0YVBvc2l0aW9uID0gZGF0YVBvc2l0aW9uOwogICAgICB9CiAgICAgICgwLCBfY3JlYXRlQ2xhc3MyMi5kZWZhdWx0KShWaXJ0dWFsT2Zmc2V0MiwgW3sKICAgICAgICBrZXk6ICJ0b1N0cmluZyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRvU3RyaW5nMigpIHsKICAgICAgICAgIHZhciBfY29udGV4dDsKICAgICAgICAgIHJldHVybiAoMCwgX2NvbmNhdC5kZWZhdWx0KShfY29udGV4dCA9ICIiLmNvbmNhdCh0aGlzLmJsb2NrUG9zaXRpb24sICI6IikpLmNhbGwoX2NvbnRleHQsIHRoaXMuZGF0YVBvc2l0aW9uKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjb21wYXJlVG8iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wYXJlVG8oYikgewogICAgICAgICAgcmV0dXJuIHRoaXMuYmxvY2tQb3NpdGlvbiAtIGIuYmxvY2tQb3NpdGlvbiB8fCB0aGlzLmRhdGFQb3NpdGlvbiAtIGIuZGF0YVBvc2l0aW9uOwogICAgICAgIH0KICAgICAgfV0sIFt7CiAgICAgICAga2V5OiAibWluIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gbWluMigpIHsKICAgICAgICAgIHZhciBtaW4zOwogICAgICAgICAgdmFyIGkyID0gMDsKICAgICAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICAgICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldOwogICAgICAgICAgfQogICAgICAgICAgZm9yICg7ICFtaW4zOyBpMiArPSAxKSB7CiAgICAgICAgICAgIG1pbjMgPSBhcmdzW2kyXTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoOyBpMiA8IGFyZ3MubGVuZ3RoOyBpMiArPSAxKSB7CiAgICAgICAgICAgIGlmIChtaW4zLmNvbXBhcmVUbyhhcmdzW2kyXSkgPiAwKSB7CiAgICAgICAgICAgICAgbWluMyA9IGFyZ3NbaTJdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbWluMzsKICAgICAgICB9CiAgICAgIH1dKTsKICAgICAgcmV0dXJuIFZpcnR1YWxPZmZzZXQyOwogICAgfSgpOwogICAgZXhwb3J0cy5kZWZhdWx0ID0gVmlydHVhbE9mZnNldDsKICAgIGZ1bmN0aW9uIGZyb21CeXRlcyhieXRlcykgewogICAgICB2YXIgb2Zmc2V0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMV0gOiAwOwogICAgICB2YXIgYmlnZW5kaWFuID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMl0gOiBmYWxzZTsKICAgICAgaWYgKGJpZ2VuZGlhbikgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiYmlnLWVuZGlhbiB2aXJ0dWFsIGZpbGUgb2Zmc2V0cyBub3QgaW1wbGVtZW50ZWQiKTsKICAgICAgfQogICAgICByZXR1cm4gbmV3IFZpcnR1YWxPZmZzZXQoYnl0ZXNbb2Zmc2V0ICsgN10gKiAxMDk5NTExNjI3Nzc2ICsgYnl0ZXNbb2Zmc2V0ICsgNl0gKiA0Mjk0OTY3Mjk2ICsgYnl0ZXNbb2Zmc2V0ICsgNV0gKiAxNjc3NzIxNiArIGJ5dGVzW29mZnNldCArIDRdICogNjU1MzYgKyBieXRlc1tvZmZzZXQgKyAzXSAqIDI1NiArIGJ5dGVzW29mZnNldCArIDJdLCBieXRlc1tvZmZzZXQgKyAxXSA8PCA4IHwgYnl0ZXNbb2Zmc2V0XSk7CiAgICB9CiAgfSkodmlydHVhbE9mZnNldCk7CiAgdmFyIGNodW5rID0ge307CiAgKGZ1bmN0aW9uKGV4cG9ydHMpIHsKICAgIHZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MiA9IGludGVyb3BSZXF1aXJlRGVmYXVsdCQxLmV4cG9ydHM7CiAgICB2YXIgX09iamVjdCRkZWZpbmVQcm9wZXJ0eSA9IGRlZmluZVByb3BlcnR5JDk7CiAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7CiAgICB2YXIgX2NvbmNhdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGNvbmNhdCk7CiAgICB2YXIgX2NsYXNzQ2FsbENoZWNrMjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihjbGFzc0NhbGxDaGVjayQxLmV4cG9ydHMpOwogICAgdmFyIF9jcmVhdGVDbGFzczIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoY3JlYXRlQ2xhc3MkMS5leHBvcnRzKTsKICAgIHZhciBfZGVmaW5lUHJvcGVydHkyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGRlZmluZVByb3BlcnR5JDYuZXhwb3J0cyk7CiAgICB2YXIgQ2h1bmsgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICAgIGZ1bmN0aW9uIENodW5rMihtaW52LCBtYXh2LCBiaW4pIHsKICAgICAgICB2YXIgZmV0Y2hlZFNpemUgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1szXSA6IHZvaWQgMDsKICAgICAgICAoMCwgX2NsYXNzQ2FsbENoZWNrMjIuZGVmYXVsdCkodGhpcywgQ2h1bmsyKTsKICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5MjIuZGVmYXVsdCkodGhpcywgIm1pbnYiLCB2b2lkIDApOwogICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyMi5kZWZhdWx0KSh0aGlzLCAibWF4diIsIHZvaWQgMCk7CiAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIyLmRlZmF1bHQpKHRoaXMsICJiaW4iLCB2b2lkIDApOwogICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyMi5kZWZhdWx0KSh0aGlzLCAiX2ZldGNoZWRTaXplIiwgdm9pZCAwKTsKICAgICAgICB0aGlzLm1pbnYgPSBtaW52OwogICAgICAgIHRoaXMubWF4diA9IG1heHY7CiAgICAgICAgdGhpcy5iaW4gPSBiaW47CiAgICAgICAgdGhpcy5fZmV0Y2hlZFNpemUgPSBmZXRjaGVkU2l6ZTsKICAgICAgfQogICAgICAoMCwgX2NyZWF0ZUNsYXNzMjIuZGVmYXVsdCkoQ2h1bmsyLCBbewogICAgICAgIGtleTogInRvVW5pcXVlU3RyaW5nIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdG9VbmlxdWVTdHJpbmcoKSB7CiAgICAgICAgICB2YXIgX2NvbnRleHQsIF9jb250ZXh0MiwgX2NvbnRleHQzOwogICAgICAgICAgcmV0dXJuICgwLCBfY29uY2F0LmRlZmF1bHQpKF9jb250ZXh0ID0gKDAsIF9jb25jYXQuZGVmYXVsdCkoX2NvbnRleHQyID0gKDAsIF9jb25jYXQuZGVmYXVsdCkoX2NvbnRleHQzID0gIiIuY29uY2F0KHRoaXMubWludiwgIi4uIikpLmNhbGwoX2NvbnRleHQzLCB0aGlzLm1heHYsICIgKGJpbiAiKSkuY2FsbChfY29udGV4dDIsIHRoaXMuYmluLCAiLCBmZXRjaGVkU2l6ZSAiKSkuY2FsbChfY29udGV4dCwgdGhpcy5mZXRjaGVkU2l6ZSgpLCAiKSIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInRvU3RyaW5nIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdG9TdHJpbmcyKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMudG9VbmlxdWVTdHJpbmcoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJjb21wYXJlVG8iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wYXJlVG8oYikgewogICAgICAgICAgcmV0dXJuIHRoaXMubWludi5jb21wYXJlVG8oYi5taW52KSB8fCB0aGlzLm1heHYuY29tcGFyZVRvKGIubWF4dikgfHwgdGhpcy5iaW4gLSBiLmJpbjsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJmZXRjaGVkU2l6ZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoZWRTaXplKCkgewogICAgICAgICAgaWYgKHRoaXMuX2ZldGNoZWRTaXplICE9PSB2b2lkIDApIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZldGNoZWRTaXplOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRoaXMubWF4di5ibG9ja1Bvc2l0aW9uICsgKDEgPDwgMTYpIC0gdGhpcy5taW52LmJsb2NrUG9zaXRpb247CiAgICAgICAgfQogICAgICB9XSk7CiAgICAgIHJldHVybiBDaHVuazI7CiAgICB9KCk7CiAgICBleHBvcnRzLmRlZmF1bHQgPSBDaHVuazsKICB9KShjaHVuayk7CiAgdmFyIGluZGV4RmlsZSA9IHt9OwogIHZhciBkaXN0JDIgPSB7fTsKICB2YXIgaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUpIHsKICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKG9iaikgewogICAgICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgICAgICJkZWZhdWx0Ijogb2JqCiAgICAgIH07CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyOwogICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShpbnRlcm9wUmVxdWlyZURlZmF1bHQpOwogIHZhciBBYm9ydGFibGVQcm9taXNlQ2FjaGUkMSA9IHt9OwogIHZhciBfdHlwZW9mID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUpIHsKICAgIGZ1bmN0aW9uIF90eXBlb2YzKG9iaikgewogICAgICAiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiOwogICAgICBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgewogICAgICAgIG1vZHVsZS5leHBvcnRzID0gX3R5cGVvZjMgPSBmdW5jdGlvbiBfdHlwZW9mNChvYmoyKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIG9iajI7CiAgICAgICAgfTsKICAgICAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIG1vZHVsZS5leHBvcnRzID0gX3R5cGVvZjMgPSBmdW5jdGlvbiBfdHlwZW9mNChvYmoyKSB7CiAgICAgICAgICByZXR1cm4gb2JqMiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iajIuY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmoyICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqMjsKICAgICAgICB9OwogICAgICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIF90eXBlb2YzKG9iaik7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF90eXBlb2YzOwogICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShfdHlwZW9mKTsKICB2YXIgY2xhc3NDYWxsQ2hlY2sgPSB7IGV4cG9ydHM6IHt9IH07CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrMyhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICAgICAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICAgICAgfQogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBfY2xhc3NDYWxsQ2hlY2szOwogICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShjbGFzc0NhbGxDaGVjayk7CiAgdmFyIGNyZWF0ZUNsYXNzID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUpIHsKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzMih0YXJnZXQsIHByb3BzKSB7CiAgICAgIGZvciAodmFyIGkyID0gMDsgaTIgPCBwcm9wcy5sZW5ndGg7IGkyKyspIHsKICAgICAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2kyXTsKICAgICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpCiAgICAgICAgICBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIF9jcmVhdGVDbGFzczMoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgICAgIGlmIChwcm90b1Byb3BzKQogICAgICAgIF9kZWZpbmVQcm9wZXJ0aWVzMihDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogICAgICBpZiAoc3RhdGljUHJvcHMpCiAgICAgICAgX2RlZmluZVByb3BlcnRpZXMyKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gX2NyZWF0ZUNsYXNzMzsKICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSkoY3JlYXRlQ2xhc3MpOwogIHZhciBkZWZpbmVQcm9wZXJ0eSQzID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUpIHsKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICAgICAgaWYgKGtleSBpbiBvYmopIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgICAgIHZhbHVlLAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb2JqW2tleV0gPSB2YWx1ZTsKICAgICAgfQogICAgICByZXR1cm4gb2JqOwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBfZGVmaW5lUHJvcGVydHk7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKGRlZmluZVByb3BlcnR5JDMpOwogIHZhciBhYm9ydGNvbnRyb2xsZXJQb255ZmlsbCA9IHt9OwogIHZhciBjanNQb255ZmlsbCA9IHt9OwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjanNQb255ZmlsbCwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICAgIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgfQogIH0KICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgICBmb3IgKHZhciBpMiA9IDA7IGkyIDwgcHJvcHMubGVuZ3RoOyBpMisrKSB7CiAgICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaTJdOwogICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikKICAgICAgICBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogICAgfQogIH0KICBmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgICBpZiAocHJvdG9Qcm9wcykKICAgICAgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICAgIGlmIChzdGF0aWNQcm9wcykKICAgICAgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICB9CiAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOwogICAgfQogICAgc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7CiAgICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9CiAgICB9KTsKICAgIGlmIChzdXBlckNsYXNzKQogICAgICBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwogIH0KICBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogICAgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mMihvMikgewogICAgICByZXR1cm4gbzIuX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvMik7CiAgICB9OwogICAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKICB9CiAgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsKICAgIF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YyKG8yLCBwMikgewogICAgICBvMi5fX3Byb3RvX18gPSBwMjsKICAgICAgcmV0dXJuIG8yOwogICAgfTsKICAgIHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7CiAgfQogIGZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7CiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkKICAgICAgcmV0dXJuIGZhbHNlOwogICAgaWYgKFJlZmxlY3QuY29uc3RydWN0LnNoYW0pCiAgICAgIHJldHVybiBmYWxzZTsKICAgIGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpCiAgICAgIHJldHVybiB0cnVlOwogICAgdHJ5IHsKICAgICAgQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sIFtdLCBmdW5jdGlvbigpIHsKICAgICAgfSkpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KICBmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYyKSB7CiAgICBpZiAoc2VsZjIgPT09IHZvaWQgMCkgewogICAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOwogICAgfQogICAgcmV0dXJuIHNlbGYyOwogIH0KICBmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmMiwgY2FsbCkgewogICAgaWYgKGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgICAgcmV0dXJuIGNhbGw7CiAgICB9CiAgICByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmMik7CiAgfQogIGZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7CiAgICB2YXIgaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCA9IF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKTsKICAgIHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsKICAgICAgdmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLCByZXN1bHQ7CiAgICAgIGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7CiAgICAgICAgdmFyIE5ld1RhcmdldCA9IF9nZXRQcm90b3R5cGVPZih0aGlzKS5jb25zdHJ1Y3RvcjsKICAgICAgICByZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOwogICAgICB9IGVsc2UgewogICAgICAgIHJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7CiAgICB9OwogIH0KICBmdW5jdGlvbiBfc3VwZXJQcm9wQmFzZShvYmplY3QsIHByb3BlcnR5KSB7CiAgICB3aGlsZSAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KSkgewogICAgICBvYmplY3QgPSBfZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsKICAgICAgaWYgKG9iamVjdCA9PT0gbnVsbCkKICAgICAgICBicmVhazsKICAgIH0KICAgIHJldHVybiBvYmplY3Q7CiAgfQogIGZ1bmN0aW9uIF9nZXQodGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpIHsKICAgIGlmICh0eXBlb2YgUmVmbGVjdCAhPT0gInVuZGVmaW5lZCIgJiYgUmVmbGVjdC5nZXQpIHsKICAgICAgX2dldCA9IFJlZmxlY3QuZ2V0OwogICAgfSBlbHNlIHsKICAgICAgX2dldCA9IGZ1bmN0aW9uIF9nZXQyKHRhcmdldDIsIHByb3BlcnR5MiwgcmVjZWl2ZXIyKSB7CiAgICAgICAgdmFyIGJhc2UgPSBfc3VwZXJQcm9wQmFzZSh0YXJnZXQyLCBwcm9wZXJ0eTIpOwogICAgICAgIGlmICghYmFzZSkKICAgICAgICAgIHJldHVybjsKICAgICAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYmFzZSwgcHJvcGVydHkyKTsKICAgICAgICBpZiAoZGVzYy5nZXQpIHsKICAgICAgICAgIHJldHVybiBkZXNjLmdldC5jYWxsKHJlY2VpdmVyMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkZXNjLnZhbHVlOwogICAgICB9OwogICAgfQogICAgcmV0dXJuIF9nZXQodGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIgfHwgdGFyZ2V0KTsKICB9CiAgdmFyIEVtaXR0ZXIgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBFbWl0dGVyMigpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEVtaXR0ZXIyKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJsaXN0ZW5lcnMiLCB7CiAgICAgICAgdmFsdWU6IHt9LAogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9KTsKICAgIH0KICAgIF9jcmVhdGVDbGFzcyhFbWl0dGVyMiwgW3sKICAgICAga2V5OiAiYWRkRXZlbnRMaXN0ZW5lciIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyKHR5cGUsIGNhbGxiYWNrLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKCEodHlwZSBpbiB0aGlzLmxpc3RlbmVycykpIHsKICAgICAgICAgIHRoaXMubGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgICAgfQogICAgICAgIHRoaXMubGlzdGVuZXJzW3R5cGVdLnB1c2goewogICAgICAgICAgY2FsbGJhY2ssCiAgICAgICAgICBvcHRpb25zCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAicmVtb3ZlRXZlbnRMaXN0ZW5lciIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKCEodHlwZSBpbiB0aGlzLmxpc3RlbmVycykpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIHN0YWNrID0gdGhpcy5saXN0ZW5lcnNbdHlwZV07CiAgICAgICAgZm9yICh2YXIgaTIgPSAwLCBsID0gc3RhY2subGVuZ3RoOyBpMiA8IGw7IGkyKyspIHsKICAgICAgICAgIGlmIChzdGFja1tpMl0uY2FsbGJhY2sgPT09IGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHN0YWNrLnNwbGljZShpMiwgMSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZGlzcGF0Y2hFdmVudCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNwYXRjaEV2ZW50MihldmVudCkgewogICAgICAgIGlmICghKGV2ZW50LnR5cGUgaW4gdGhpcy5saXN0ZW5lcnMpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciBzdGFjayA9IHRoaXMubGlzdGVuZXJzW2V2ZW50LnR5cGVdOwogICAgICAgIHZhciBzdGFja1RvQ2FsbCA9IHN0YWNrLnNsaWNlKCk7CiAgICAgICAgZm9yICh2YXIgaTIgPSAwLCBsID0gc3RhY2tUb0NhbGwubGVuZ3RoOyBpMiA8IGw7IGkyKyspIHsKICAgICAgICAgIHZhciBsaXN0ZW5lcjIgPSBzdGFja1RvQ2FsbFtpMl07CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBsaXN0ZW5lcjIuY2FsbGJhY2suY2FsbCh0aGlzLCBldmVudCk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobGlzdGVuZXIyLm9wdGlvbnMgJiYgbGlzdGVuZXIyLm9wdGlvbnMub25jZSkgewogICAgICAgICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQudHlwZSwgbGlzdGVuZXIyLmNhbGxiYWNrKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICFldmVudC5kZWZhdWx0UHJldmVudGVkOwogICAgICB9CiAgICB9XSk7CiAgICByZXR1cm4gRW1pdHRlcjI7CiAgfSgpOwogIHZhciBBYm9ydFNpZ25hbCQxID0gLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKF9FbWl0dGVyKSB7CiAgICBfaW5oZXJpdHMoQWJvcnRTaWduYWwyLCBfRW1pdHRlcik7CiAgICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKEFib3J0U2lnbmFsMik7CiAgICBmdW5jdGlvbiBBYm9ydFNpZ25hbDIoKSB7CiAgICAgIHZhciBfdGhpczsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFib3J0U2lnbmFsMik7CiAgICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcyk7CiAgICAgIGlmICghX3RoaXMubGlzdGVuZXJzKSB7CiAgICAgICAgRW1pdHRlci5jYWxsKF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpKTsKICAgICAgfQogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJhYm9ydGVkIiwgewogICAgICAgIHZhbHVlOiBmYWxzZSwKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uYWJvcnQiLCB7CiAgICAgICAgdmFsdWU6IG51bGwsCiAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0pOwogICAgICByZXR1cm4gX3RoaXM7CiAgICB9CiAgICBfY3JlYXRlQ2xhc3MoQWJvcnRTaWduYWwyLCBbewogICAgICBrZXk6ICJ0b1N0cmluZyIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB0b1N0cmluZzIoKSB7CiAgICAgICAgcmV0dXJuICJbb2JqZWN0IEFib3J0U2lnbmFsXSI7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZGlzcGF0Y2hFdmVudCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNwYXRjaEV2ZW50MihldmVudCkgewogICAgICAgIGlmIChldmVudC50eXBlID09PSAiYWJvcnQiKSB7CiAgICAgICAgICB0aGlzLmFib3J0ZWQgPSB0cnVlOwogICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9uYWJvcnQgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgdGhpcy5vbmFib3J0LmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihBYm9ydFNpZ25hbDIucHJvdG90eXBlKSwgImRpc3BhdGNoRXZlbnQiLCB0aGlzKS5jYWxsKHRoaXMsIGV2ZW50KTsKICAgICAgfQogICAgfV0pOwogICAgcmV0dXJuIEFib3J0U2lnbmFsMjsKICB9KEVtaXR0ZXIpOwogIHZhciBBYm9ydENvbnRyb2xsZXIkMSA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIEFib3J0Q29udHJvbGxlcjIoKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBYm9ydENvbnRyb2xsZXIyKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJzaWduYWwiLCB7CiAgICAgICAgdmFsdWU6IG5ldyBBYm9ydFNpZ25hbCQxKCksCiAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0pOwogICAgfQogICAgX2NyZWF0ZUNsYXNzKEFib3J0Q29udHJvbGxlcjIsIFt7CiAgICAgIGtleTogImFib3J0IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFib3J0KCkgewogICAgICAgIHZhciBldmVudDsKICAgICAgICB0cnkgewogICAgICAgICAgZXZlbnQgPSBuZXcgRXZlbnQoImFib3J0Iik7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5jcmVhdGVFdmVudCkgewogICAgICAgICAgICAgIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnRPYmplY3QoKTsKICAgICAgICAgICAgICBldmVudC50eXBlID0gImFib3J0IjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJFdmVudCIpOwogICAgICAgICAgICAgIGV2ZW50LmluaXRFdmVudCgiYWJvcnQiLCBmYWxzZSwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBldmVudCA9IHsKICAgICAgICAgICAgICB0eXBlOiAiYWJvcnQiLAogICAgICAgICAgICAgIGJ1YmJsZXM6IGZhbHNlLAogICAgICAgICAgICAgIGNhbmNlbGFibGU6IGZhbHNlCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuc2lnbmFsLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInRvU3RyaW5nIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRvU3RyaW5nMigpIHsKICAgICAgICByZXR1cm4gIltvYmplY3QgQWJvcnRDb250cm9sbGVyXSI7CiAgICAgIH0KICAgIH1dKTsKICAgIHJldHVybiBBYm9ydENvbnRyb2xsZXIyOwogIH0oKTsKICBpZiAodHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7CiAgICBBYm9ydENvbnRyb2xsZXIkMS5wcm90b3R5cGVbU3ltYm9sLnRvU3RyaW5nVGFnXSA9ICJBYm9ydENvbnRyb2xsZXIiOwogICAgQWJvcnRTaWduYWwkMS5wcm90b3R5cGVbU3ltYm9sLnRvU3RyaW5nVGFnXSA9ICJBYm9ydFNpZ25hbCI7CiAgfQogIGZ1bmN0aW9uIHBvbHlmaWxsTmVlZGVkKHNlbGYyKSB7CiAgICBpZiAoc2VsZjIuX19GT1JDRV9JTlNUQUxMX0FCT1JUQ09OVFJPTExFUl9QT0xZRklMTCkgewogICAgICBjb25zb2xlLmxvZygiX19GT1JDRV9JTlNUQUxMX0FCT1JUQ09OVFJPTExFUl9QT0xZRklMTD10cnVlIGlzIHNldCwgd2lsbCBmb3JjZSBpbnN0YWxsIHBvbHlmaWxsIik7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIHR5cGVvZiBzZWxmMi5SZXF1ZXN0ID09PSAiZnVuY3Rpb24iICYmICFzZWxmMi5SZXF1ZXN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSgic2lnbmFsIikgfHwgIXNlbGYyLkFib3J0Q29udHJvbGxlcjsKICB9CiAgZnVuY3Rpb24gYWJvcnRhYmxlRmV0Y2hEZWNvcmF0b3IocGF0Y2hUYXJnZXRzKSB7CiAgICBpZiAodHlwZW9mIHBhdGNoVGFyZ2V0cyA9PT0gImZ1bmN0aW9uIikgewogICAgICBwYXRjaFRhcmdldHMgPSB7CiAgICAgICAgZmV0Y2g6IHBhdGNoVGFyZ2V0cwogICAgICB9OwogICAgfQogICAgdmFyIF9wYXRjaFRhcmdldHMgPSBwYXRjaFRhcmdldHMsIGZldGNoMiA9IF9wYXRjaFRhcmdldHMuZmV0Y2gsIF9wYXRjaFRhcmdldHMkUmVxdWVzdCA9IF9wYXRjaFRhcmdldHMuUmVxdWVzdCwgTmF0aXZlUmVxdWVzdCA9IF9wYXRjaFRhcmdldHMkUmVxdWVzdCA9PT0gdm9pZCAwID8gZmV0Y2gyLlJlcXVlc3QgOiBfcGF0Y2hUYXJnZXRzJFJlcXVlc3QsIE5hdGl2ZUFib3J0Q29udHJvbGxlciA9IF9wYXRjaFRhcmdldHMuQWJvcnRDb250cm9sbGVyLCBfcGF0Y2hUYXJnZXRzJF9fRk9SQ0UgPSBfcGF0Y2hUYXJnZXRzLl9fRk9SQ0VfSU5TVEFMTF9BQk9SVENPTlRST0xMRVJfUE9MWUZJTEwsIF9fRk9SQ0VfSU5TVEFMTF9BQk9SVENPTlRST0xMRVJfUE9MWUZJTEwgPSBfcGF0Y2hUYXJnZXRzJF9fRk9SQ0UgPT09IHZvaWQgMCA/IGZhbHNlIDogX3BhdGNoVGFyZ2V0cyRfX0ZPUkNFOwogICAgaWYgKCFwb2x5ZmlsbE5lZWRlZCh7CiAgICAgIGZldGNoOiBmZXRjaDIsCiAgICAgIFJlcXVlc3Q6IE5hdGl2ZVJlcXVlc3QsCiAgICAgIEFib3J0Q29udHJvbGxlcjogTmF0aXZlQWJvcnRDb250cm9sbGVyLAogICAgICBfX0ZPUkNFX0lOU1RBTExfQUJPUlRDT05UUk9MTEVSX1BPTFlGSUxMCiAgICB9KSkgewogICAgICByZXR1cm4gewogICAgICAgIGZldGNoOiBmZXRjaDIsCiAgICAgICAgUmVxdWVzdAogICAgICB9OwogICAgfQogICAgdmFyIFJlcXVlc3QgPSBOYXRpdmVSZXF1ZXN0OwogICAgaWYgKFJlcXVlc3QgJiYgIVJlcXVlc3QucHJvdG90eXBlLmhhc093blByb3BlcnR5KCJzaWduYWwiKSB8fCBfX0ZPUkNFX0lOU1RBTExfQUJPUlRDT05UUk9MTEVSX1BPTFlGSUxMKSB7CiAgICAgIFJlcXVlc3QgPSBmdW5jdGlvbiBSZXF1ZXN0MihpbnB1dCwgaW5pdDIpIHsKICAgICAgICB2YXIgc2lnbmFsOwogICAgICAgIGlmIChpbml0MiAmJiBpbml0Mi5zaWduYWwpIHsKICAgICAgICAgIHNpZ25hbCA9IGluaXQyLnNpZ25hbDsKICAgICAgICAgIGRlbGV0ZSBpbml0Mi5zaWduYWw7CiAgICAgICAgfQogICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IE5hdGl2ZVJlcXVlc3QoaW5wdXQsIGluaXQyKTsKICAgICAgICBpZiAoc2lnbmFsKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVxdWVzdCwgInNpZ25hbCIsIHsKICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlLAogICAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSwKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgICB2YWx1ZTogc2lnbmFsCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlcXVlc3Q7CiAgICAgIH07CiAgICAgIFJlcXVlc3QucHJvdG90eXBlID0gTmF0aXZlUmVxdWVzdC5wcm90b3R5cGU7CiAgICB9CiAgICB2YXIgcmVhbEZldGNoID0gZmV0Y2gyOwogICAgdmFyIGFib3J0YWJsZUZldGNoID0gZnVuY3Rpb24gYWJvcnRhYmxlRmV0Y2gyKGlucHV0LCBpbml0MikgewogICAgICB2YXIgc2lnbmFsID0gUmVxdWVzdCAmJiBSZXF1ZXN0LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKGlucHV0KSA/IGlucHV0LnNpZ25hbCA6IGluaXQyID8gaW5pdDIuc2lnbmFsIDogdm9pZCAwOwogICAgICBpZiAoc2lnbmFsKSB7CiAgICAgICAgdmFyIGFib3J0RXJyb3I7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGFib3J0RXJyb3IgPSBuZXcgRE9NRXhjZXB0aW9uKCJBYm9ydGVkIiwgIkFib3J0RXJyb3IiKTsKICAgICAgICB9IGNhdGNoIChlcnIyKSB7CiAgICAgICAgICBhYm9ydEVycm9yID0gbmV3IEVycm9yKCJBYm9ydGVkIik7CiAgICAgICAgICBhYm9ydEVycm9yLm5hbWUgPSAiQWJvcnRFcnJvciI7CiAgICAgICAgfQogICAgICAgIGlmIChzaWduYWwuYWJvcnRlZCkgewogICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGFib3J0RXJyb3IpOwogICAgICAgIH0KICAgICAgICB2YXIgY2FuY2VsbGF0aW9uID0gbmV3IFByb21pc2UoZnVuY3Rpb24oXzIsIHJlamVjdCkgewogICAgICAgICAgc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoImFib3J0IiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiByZWplY3QoYWJvcnRFcnJvcik7CiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIG9uY2U6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIGlmIChpbml0MiAmJiBpbml0Mi5zaWduYWwpIHsKICAgICAgICAgIGRlbGV0ZSBpbml0Mi5zaWduYWw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBQcm9taXNlLnJhY2UoW2NhbmNlbGxhdGlvbiwgcmVhbEZldGNoKGlucHV0LCBpbml0MildKTsKICAgICAgfQogICAgICByZXR1cm4gcmVhbEZldGNoKGlucHV0LCBpbml0Mik7CiAgICB9OwogICAgcmV0dXJuIHsKICAgICAgZmV0Y2g6IGFib3J0YWJsZUZldGNoLAogICAgICBSZXF1ZXN0CiAgICB9OwogIH0KICBjanNQb255ZmlsbC5BYm9ydENvbnRyb2xsZXIgPSBBYm9ydENvbnRyb2xsZXIkMTsKICBjanNQb255ZmlsbC5BYm9ydFNpZ25hbCA9IEFib3J0U2lnbmFsJDE7CiAgY2pzUG9ueWZpbGwuYWJvcnRhYmxlRmV0Y2ggPSBhYm9ydGFibGVGZXRjaERlY29yYXRvcjsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYWJvcnRjb250cm9sbGVyUG9ueWZpbGwsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICBhYm9ydGNvbnRyb2xsZXJQb255ZmlsbC5BYm9ydFNpZ25hbCA9IGFib3J0Y29udHJvbGxlclBvbnlmaWxsLkFib3J0Q29udHJvbGxlciA9IHZvaWQgMDsKICB2YXIgX2Nqc1BvbnlmaWxsID0gY2pzUG9ueWZpbGw7CiAgdmFyIGdldEdsb2JhbCA9IGZ1bmN0aW9uIGdldEdsb2JhbDIoKSB7CiAgICBpZiAodHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIHJldHVybiBzZWxmOwogICAgfQogICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIHJldHVybiB3aW5kb3c7CiAgICB9CiAgICBpZiAodHlwZW9mIGNvbW1vbmpzR2xvYmFsICE9PSAidW5kZWZpbmVkIikgewogICAgICByZXR1cm4gY29tbW9uanNHbG9iYWw7CiAgICB9CiAgICB0aHJvdyBuZXcgRXJyb3IoInVuYWJsZSB0byBsb2NhdGUgZ2xvYmFsIG9iamVjdCIpOwogIH07CiAgdmFyIEFib3J0Q29udHJvbGxlciA9IHR5cGVvZiBnZXRHbG9iYWwoKS5BYm9ydENvbnRyb2xsZXIgPT09ICJ1bmRlZmluZWQiID8gX2Nqc1BvbnlmaWxsLkFib3J0Q29udHJvbGxlciA6IGdldEdsb2JhbCgpLkFib3J0Q29udHJvbGxlcjsKICBhYm9ydGNvbnRyb2xsZXJQb255ZmlsbC5BYm9ydENvbnRyb2xsZXIgPSBBYm9ydENvbnRyb2xsZXI7CiAgdmFyIEFib3J0U2lnbmFsID0gdHlwZW9mIGdldEdsb2JhbCgpLkFib3J0Q29udHJvbGxlciA9PT0gInVuZGVmaW5lZCIgPyBfY2pzUG9ueWZpbGwuQWJvcnRTaWduYWwgOiBnZXRHbG9iYWwoKS5BYm9ydFNpZ25hbDsKICBhYm9ydGNvbnRyb2xsZXJQb255ZmlsbC5BYm9ydFNpZ25hbCA9IEFib3J0U2lnbmFsOwogIHZhciBBZ2dyZWdhdGVBYm9ydENvbnRyb2xsZXIkMSA9IHt9OwogIHZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDkgPSBpbnRlcm9wUmVxdWlyZURlZmF1bHQuZXhwb3J0czsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWdncmVnYXRlQWJvcnRDb250cm9sbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICBBZ2dyZWdhdGVBYm9ydENvbnRyb2xsZXIkMS5kZWZhdWx0ID0gdm9pZCAwOwogIHZhciBfY3JlYXRlQ2xhc3MyJDcgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDkoY3JlYXRlQ2xhc3MuZXhwb3J0cyk7CiAgdmFyIF9kZWZpbmVQcm9wZXJ0eTIkNCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkOShkZWZpbmVQcm9wZXJ0eSQzLmV4cG9ydHMpOwogIHZhciBfY2xhc3NDYWxsQ2hlY2syJDcgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDkoY2xhc3NDYWxsQ2hlY2suZXhwb3J0cyk7CiAgdmFyIF9hYm9ydGNvbnRyb2xsZXJQb255ZmlsbCQxID0gYWJvcnRjb250cm9sbGVyUG9ueWZpbGw7CiAgdmFyIE51bGxTaWduYWwgPSBmdW5jdGlvbiBOdWxsU2lnbmFsMigpIHsKICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syJDcuZGVmYXVsdCkodGhpcywgTnVsbFNpZ25hbDIpOwogIH07CiAgdmFyIEFnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlciA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIEFnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlcjIoKSB7CiAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syJDcuZGVmYXVsdCkodGhpcywgQWdncmVnYXRlQWJvcnRDb250cm9sbGVyMik7CiAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyJDQuZGVmYXVsdCkodGhpcywgInNpZ25hbHMiLCAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpKTsKICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIkNC5kZWZhdWx0KSh0aGlzLCAiYWJvcnRDb250cm9sbGVyIiwgbmV3IF9hYm9ydGNvbnRyb2xsZXJQb255ZmlsbCQxLkFib3J0Q29udHJvbGxlcigpKTsKICAgIH0KICAgICgwLCBfY3JlYXRlQ2xhc3MyJDcuZGVmYXVsdCkoQWdncmVnYXRlQWJvcnRDb250cm9sbGVyMiwgW3sKICAgICAga2V5OiAiYWRkU2lnbmFsIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFkZFNpZ25hbCgpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIHZhciBzaWduYWwgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1swXSA6IG5ldyBOdWxsU2lnbmFsKCk7CiAgICAgICAgaWYgKHRoaXMuc2lnbmFsLmFib3J0ZWQpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiY2Fubm90IGFkZCBhIHNpZ25hbCwgYWxyZWFkeSBhYm9ydGVkISIpOwogICAgICAgIH0KICAgICAgICB0aGlzLnNpZ25hbHMuYWRkKHNpZ25hbCk7CiAgICAgICAgaWYgKHNpZ25hbC5hYm9ydGVkKSB7CiAgICAgICAgICB0aGlzLmhhbmRsZUFib3J0ZWQoc2lnbmFsKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBzaWduYWwuYWRkRXZlbnRMaXN0ZW5lciA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoImFib3J0IiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIF90aGlzLmhhbmRsZUFib3J0ZWQoc2lnbmFsKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwgeyBrZXk6ICJoYW5kbGVBYm9ydGVkIiwgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZUFib3J0ZWQoc2lnbmFsKSB7CiAgICAgIHRoaXMuc2lnbmFscy5kZWxldGUoc2lnbmFsKTsKICAgICAgaWYgKHRoaXMuc2lnbmFscy5zaXplID09PSAwKSB7CiAgICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIuYWJvcnQoKTsKICAgICAgfQogICAgfSB9LCB7IGtleTogImFib3J0IiwgdmFsdWU6IGZ1bmN0aW9uIGFib3J0KCkgewogICAgICB0aGlzLmFib3J0Q29udHJvbGxlci5hYm9ydCgpOwogICAgfSB9LCB7IGtleTogInNpZ25hbCIsIGdldDogZnVuY3Rpb24gZ2V0MigpIHsKICAgICAgcmV0dXJuIHRoaXMuYWJvcnRDb250cm9sbGVyLnNpZ25hbDsKICAgIH0gfV0pOwogICAgcmV0dXJuIEFnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlcjI7CiAgfSgpOwogIEFnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlciQxLmRlZmF1bHQgPSBBZ2dyZWdhdGVBYm9ydENvbnRyb2xsZXI7CiAgdmFyIEFnZ3JlZ2F0ZVN0YXR1c1JlcG9ydGVyJDEgPSB7fTsKICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQ4ID0gaW50ZXJvcFJlcXVpcmVEZWZhdWx0LmV4cG9ydHM7CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFnZ3JlZ2F0ZVN0YXR1c1JlcG9ydGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICBBZ2dyZWdhdGVTdGF0dXNSZXBvcnRlciQxLmRlZmF1bHQgPSB2b2lkIDA7CiAgdmFyIF9jbGFzc0NhbGxDaGVjazIkNiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkOChjbGFzc0NhbGxDaGVjay5leHBvcnRzKTsKICB2YXIgX2NyZWF0ZUNsYXNzMiQ2ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQ4KGNyZWF0ZUNsYXNzLmV4cG9ydHMpOwogIHZhciBfZGVmaW5lUHJvcGVydHkyJDMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDgoZGVmaW5lUHJvcGVydHkkMy5leHBvcnRzKTsKICB2YXIgQWdncmVnYXRlU3RhdHVzUmVwb3J0ZXIgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBBZ2dyZWdhdGVTdGF0dXNSZXBvcnRlcjIoKSB7CiAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syJDYuZGVmYXVsdCkodGhpcywgQWdncmVnYXRlU3RhdHVzUmVwb3J0ZXIyKTsKICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIkMy5kZWZhdWx0KSh0aGlzLCAiY2FsbGJhY2tzIiwgLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKSk7CiAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyJDMuZGVmYXVsdCkodGhpcywgImN1cnJlbnRNZXNzYWdlIiwgdm9pZCAwKTsKICAgIH0KICAgICgwLCBfY3JlYXRlQ2xhc3MyJDYuZGVmYXVsdCkoQWdncmVnYXRlU3RhdHVzUmVwb3J0ZXIyLCBbeyBrZXk6ICJhZGRDYWxsYmFjayIsIHZhbHVlOiBmdW5jdGlvbiBhZGRDYWxsYmFjaygpIHsKICAgICAgdmFyIGNhbGxiYWNrID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMF0gOiBmdW5jdGlvbigpIHsKICAgICAgfTsKICAgICAgdGhpcy5jYWxsYmFja3MuYWRkKGNhbGxiYWNrKTsKICAgICAgY2FsbGJhY2sodGhpcy5jdXJyZW50TWVzc2FnZSk7CiAgICB9IH0sIHsga2V5OiAiY2FsbGJhY2siLCB2YWx1ZTogZnVuY3Rpb24gY2FsbGJhY2sobWVzc2FnZSkgewogICAgICB0aGlzLmN1cnJlbnRNZXNzYWdlID0gbWVzc2FnZTsKICAgICAgdGhpcy5jYWxsYmFja3MuZm9yRWFjaChmdW5jdGlvbihlbHQpIHsKICAgICAgICBlbHQobWVzc2FnZSk7CiAgICAgIH0pOwogICAgfSB9XSk7CiAgICByZXR1cm4gQWdncmVnYXRlU3RhdHVzUmVwb3J0ZXIyOwogIH0oKTsKICBBZ2dyZWdhdGVTdGF0dXNSZXBvcnRlciQxLmRlZmF1bHQgPSBBZ2dyZWdhdGVTdGF0dXNSZXBvcnRlcjsKICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQ3ID0gaW50ZXJvcFJlcXVpcmVEZWZhdWx0LmV4cG9ydHM7CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFib3J0YWJsZVByb21pc2VDYWNoZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgQWJvcnRhYmxlUHJvbWlzZUNhY2hlJDEuZGVmYXVsdCA9IHZvaWQgMDsKICB2YXIgX3R5cGVvZjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDcoX3R5cGVvZi5leHBvcnRzKTsKICB2YXIgX2NsYXNzQ2FsbENoZWNrMiQ1ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQ3KGNsYXNzQ2FsbENoZWNrLmV4cG9ydHMpOwogIHZhciBfY3JlYXRlQ2xhc3MyJDUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDcoY3JlYXRlQ2xhc3MuZXhwb3J0cyk7CiAgdmFyIF9kZWZpbmVQcm9wZXJ0eTIkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkNyhkZWZpbmVQcm9wZXJ0eSQzLmV4cG9ydHMpOwogIHZhciBfYWJvcnRjb250cm9sbGVyUG9ueWZpbGwgPSBhYm9ydGNvbnRyb2xsZXJQb255ZmlsbDsKICB2YXIgX0FnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkNyhBZ2dyZWdhdGVBYm9ydENvbnRyb2xsZXIkMSk7CiAgdmFyIF9BZ2dyZWdhdGVTdGF0dXNSZXBvcnRlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkNyhBZ2dyZWdhdGVTdGF0dXNSZXBvcnRlciQxKTsKICB2YXIgQWJvcnRhYmxlUHJvbWlzZUNhY2hlID0gLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gQWJvcnRhYmxlUHJvbWlzZUNhY2hlMihfcmVmKSB7CiAgICAgIHZhciBmaWxsID0gX3JlZi5maWxsLCBjYWNoZSA9IF9yZWYuY2FjaGU7CiAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syJDUuZGVmYXVsdCkodGhpcywgQWJvcnRhYmxlUHJvbWlzZUNhY2hlMik7CiAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyJDIuZGVmYXVsdCkodGhpcywgImNhY2hlIiwgdm9pZCAwKTsKICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIkMi5kZWZhdWx0KSh0aGlzLCAiZmlsbENhbGxiYWNrIiwgdm9pZCAwKTsKICAgICAgaWYgKHR5cGVvZiBmaWxsICE9PSAiZnVuY3Rpb24iKQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIm11c3QgcGFzcyBhIGZpbGwgZnVuY3Rpb24iKTsKICAgICAgaWYgKCgwLCBfdHlwZW9mMi5kZWZhdWx0KShjYWNoZSkgIT09ICJvYmplY3QiKQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIm11c3QgcGFzcyBhIGNhY2hlIG9iamVjdCIpOwogICAgICBpZiAodHlwZW9mIGNhY2hlLmdldCAhPT0gImZ1bmN0aW9uIiB8fCB0eXBlb2YgY2FjaGUuc2V0ICE9PSAiZnVuY3Rpb24iIHx8IHR5cGVvZiBjYWNoZS5kZWxldGUgIT09ICJmdW5jdGlvbiIpCiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiY2FjaGUgbXVzdCBpbXBsZW1lbnQgZ2V0KGtleSksIHNldChrZXksIHZhbCksIGFuZCBhbmQgZGVsZXRlKGtleSkiKTsKICAgICAgdGhpcy5jYWNoZSA9IGNhY2hlOwogICAgICB0aGlzLmZpbGxDYWxsYmFjayA9IGZpbGw7CiAgICB9CiAgICAoMCwgX2NyZWF0ZUNsYXNzMiQ1LmRlZmF1bHQpKEFib3J0YWJsZVByb21pc2VDYWNoZTIsIFt7IGtleTogImV2aWN0IiwgdmFsdWU6IGZ1bmN0aW9uIGV2aWN0KGtleSwgZW50cnkpIHsKICAgICAgaWYgKHRoaXMuY2FjaGUuZ2V0KGtleSkgPT09IGVudHJ5KQogICAgICAgIHRoaXMuY2FjaGUuZGVsZXRlKGtleSk7CiAgICB9IH0sIHsga2V5OiAiZmlsbCIsIHZhbHVlOiBmdW5jdGlvbiBmaWxsKGtleSwgZGF0YTIsIHNpZ25hbCwgc3RhdHVzQ2FsbGJhY2spIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIGFib3J0ZXIgPSBuZXcgX0FnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlci5kZWZhdWx0KCk7CiAgICAgIHZhciBzdGF0dXNSZXBvcnRlciA9IG5ldyBfQWdncmVnYXRlU3RhdHVzUmVwb3J0ZXIuZGVmYXVsdCgpOwogICAgICBzdGF0dXNSZXBvcnRlci5hZGRDYWxsYmFjayhzdGF0dXNDYWxsYmFjayk7CiAgICAgIHZhciBuZXdFbnRyeSA9IHsKICAgICAgICBhYm9ydGVyLAogICAgICAgIHByb21pc2U6IHRoaXMuZmlsbENhbGxiYWNrKGRhdGEyLCBhYm9ydGVyLnNpZ25hbCwgZnVuY3Rpb24obWVzc2FnZSkgewogICAgICAgICAgc3RhdHVzUmVwb3J0ZXIuY2FsbGJhY2sobWVzc2FnZSk7CiAgICAgICAgfSksCiAgICAgICAgc2V0dGxlZDogZmFsc2UsCiAgICAgICAgc3RhdHVzUmVwb3J0ZXIsCiAgICAgICAgZ2V0IGFib3J0ZWQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5hYm9ydGVyLnNpZ25hbC5hYm9ydGVkOwogICAgICAgIH0KICAgICAgfTsKICAgICAgbmV3RW50cnkuYWJvcnRlci5hZGRTaWduYWwoc2lnbmFsKTsKICAgICAgbmV3RW50cnkuYWJvcnRlci5zaWduYWwuYWRkRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoIW5ld0VudHJ5LnNldHRsZWQpIHsKICAgICAgICAgIF90aGlzLmV2aWN0KGtleSwgbmV3RW50cnkpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIG5ld0VudHJ5LnByb21pc2UudGhlbihmdW5jdGlvbigpIHsKICAgICAgICBuZXdFbnRyeS5zZXR0bGVkID0gdHJ1ZTsKICAgICAgfSwgZnVuY3Rpb24oZXhjZXB0aW9uKSB7CiAgICAgICAgbmV3RW50cnkuc2V0dGxlZCA9IHRydWU7CiAgICAgICAgX3RoaXMuZXZpY3Qoa2V5LCBuZXdFbnRyeSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgIHRocm93IGU7CiAgICAgIH0pOwogICAgICB0aGlzLmNhY2hlLnNldChrZXksIG5ld0VudHJ5KTsKICAgIH0gfSwgewogICAgICBrZXk6ICJoYXMiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gaGFzMihrZXkpIHsKICAgICAgICByZXR1cm4gdGhpcy5jYWNoZS5oYXMoa2V5KTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJnZXQiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0MihrZXksIGRhdGEyLCBzaWduYWwsIHN0YXR1c0NhbGxiYWNrKSB7CiAgICAgICAgaWYgKCFzaWduYWwgJiYgZGF0YTIgaW5zdGFuY2VvZiBfYWJvcnRjb250cm9sbGVyUG9ueWZpbGwuQWJvcnRTaWduYWwpCiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJzZWNvbmQgZ2V0IGFyZ3VtZW50IGFwcGVhcnMgdG8gYmUgYW4gQWJvcnRTaWduYWwsIHBlcmhhcHMgeW91IG1lYW50IHRvIHBhc3MgYG51bGxgIGZvciB0aGUgZmlsbCBkYXRhPyIpOwogICAgICAgIHZhciBjYWNoZUVudHJ5ID0gdGhpcy5jYWNoZS5nZXQoa2V5KTsKICAgICAgICBpZiAoY2FjaGVFbnRyeSkgewogICAgICAgICAgaWYgKGNhY2hlRW50cnkuYWJvcnRlZCAmJiAhY2FjaGVFbnRyeS5zZXR0bGVkKSB7CiAgICAgICAgICAgIHRoaXMuZXZpY3Qoa2V5LCBjYWNoZUVudHJ5KTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KGtleSwgZGF0YTIsIHNpZ25hbCwgc3RhdHVzQ2FsbGJhY2spOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGNhY2hlRW50cnkuc2V0dGxlZCkgewogICAgICAgICAgICByZXR1cm4gY2FjaGVFbnRyeS5wcm9taXNlOwogICAgICAgICAgfQogICAgICAgICAgY2FjaGVFbnRyeS5hYm9ydGVyLmFkZFNpZ25hbChzaWduYWwpOwogICAgICAgICAgY2FjaGVFbnRyeS5zdGF0dXNSZXBvcnRlci5hZGRDYWxsYmFjayhzdGF0dXNDYWxsYmFjayk7CiAgICAgICAgICByZXR1cm4gQWJvcnRhYmxlUHJvbWlzZUNhY2hlMi5jaGVja1NpbmdsZVByb21pc2UoY2FjaGVFbnRyeS5wcm9taXNlLCBzaWduYWwpOwogICAgICAgIH0KICAgICAgICB0aGlzLmZpbGwoa2V5LCBkYXRhMiwgc2lnbmFsLCBzdGF0dXNDYWxsYmFjayk7CiAgICAgICAgcmV0dXJuIEFib3J0YWJsZVByb21pc2VDYWNoZTIuY2hlY2tTaW5nbGVQcm9taXNlKHRoaXMuY2FjaGUuZ2V0KGtleSkucHJvbWlzZSwgc2lnbmFsKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJkZWxldGUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX2RlbGV0ZShrZXkpIHsKICAgICAgICB2YXIgY2FjaGVkRW50cnkgPSB0aGlzLmNhY2hlLmdldChrZXkpOwogICAgICAgIGlmIChjYWNoZWRFbnRyeSkgewogICAgICAgICAgaWYgKCFjYWNoZWRFbnRyeS5zZXR0bGVkKQogICAgICAgICAgICBjYWNoZWRFbnRyeS5hYm9ydGVyLmFib3J0KCk7CiAgICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgeyBrZXk6ICJjbGVhciIsIHZhbHVlOiBmdW5jdGlvbiBjbGVhcjIoKSB7CiAgICAgIHZhciBrZXlJdGVyID0gdGhpcy5jYWNoZS5rZXlzKCk7CiAgICAgIHZhciBkZWxldGVDb3VudCA9IDA7CiAgICAgIGZvciAodmFyIHJlc3VsdCA9IGtleUl0ZXIubmV4dCgpOyAhcmVzdWx0LmRvbmU7IHJlc3VsdCA9IGtleUl0ZXIubmV4dCgpKSB7CiAgICAgICAgdGhpcy5kZWxldGUocmVzdWx0LnZhbHVlKTsKICAgICAgICBkZWxldGVDb3VudCArPSAxOwogICAgICB9CiAgICAgIHJldHVybiBkZWxldGVDb3VudDsKICAgIH0gfV0sIFt7IGtleTogImlzQWJvcnRFeGNlcHRpb24iLCB2YWx1ZTogZnVuY3Rpb24gaXNBYm9ydEV4Y2VwdGlvbihleGNlcHRpb24pIHsKICAgICAgcmV0dXJuIGV4Y2VwdGlvbi5uYW1lID09PSAiQWJvcnRFcnJvciIgfHwgZXhjZXB0aW9uLmNvZGUgPT09ICJFUlJfQUJPUlRFRCIgfHwgZXhjZXB0aW9uLm1lc3NhZ2UgPT09ICJBYm9ydEVycm9yOiBhYm9ydGVkIiB8fCBleGNlcHRpb24ubWVzc2FnZSA9PT0gIkVycm9yOiBhYm9ydGVkIjsKICAgIH0gfSwgeyBrZXk6ICJjaGVja1NpbmdsZVByb21pc2UiLCB2YWx1ZTogZnVuY3Rpb24gY2hlY2tTaW5nbGVQcm9taXNlKHByb21pc2UyLCBzaWduYWwpIHsKICAgICAgZnVuY3Rpb24gY2hlY2tGb3JTaW5nbGVBYm9ydCgpIHsKICAgICAgICBpZiAoc2lnbmFsICYmIHNpZ25hbC5hYm9ydGVkKQogICAgICAgICAgdGhyb3cgT2JqZWN0LmFzc2lnbihuZXcgRXJyb3IoImFib3J0ZWQiKSwgeyBjb2RlOiAiRVJSX0FCT1JURUQiIH0pOwogICAgICB9CiAgICAgIHJldHVybiBwcm9taXNlMi50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgIGNoZWNrRm9yU2luZ2xlQWJvcnQoKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9LCBmdW5jdGlvbihlcnJvcikgewogICAgICAgIGNoZWNrRm9yU2luZ2xlQWJvcnQoKTsKICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgfSk7CiAgICB9IH1dKTsKICAgIHJldHVybiBBYm9ydGFibGVQcm9taXNlQ2FjaGUyOwogIH0oKTsKICBBYm9ydGFibGVQcm9taXNlQ2FjaGUkMS5kZWZhdWx0ID0gQWJvcnRhYmxlUHJvbWlzZUNhY2hlOwogIHZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDYgPSBpbnRlcm9wUmVxdWlyZURlZmF1bHQuZXhwb3J0czsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGlzdCQyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgZGlzdCQyLmRlZmF1bHQgPSB2b2lkIDA7CiAgdmFyIF9BYm9ydGFibGVQcm9taXNlQ2FjaGUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDYoQWJvcnRhYmxlUHJvbWlzZUNhY2hlJDEpOwogIHZhciBfZGVmYXVsdCA9IF9BYm9ydGFibGVQcm9taXNlQ2FjaGUuZGVmYXVsdDsKICBkaXN0JDIuZGVmYXVsdCA9IF9kZWZhdWx0OwogIGNsYXNzIFF1aWNrTFJVJDEgewogICAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7CiAgICAgIGlmICghKG9wdGlvbnMubWF4U2l6ZSAmJiBvcHRpb25zLm1heFNpemUgPiAwKSkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImBtYXhTaXplYCBtdXN0IGJlIGEgbnVtYmVyIGdyZWF0ZXIgdGhhbiAwIik7CiAgICAgIH0KICAgICAgdGhpcy5tYXhTaXplID0gb3B0aW9ucy5tYXhTaXplOwogICAgICB0aGlzLmNhY2hlID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICAgICAgdGhpcy5vbGRDYWNoZSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgICAgIHRoaXMuX3NpemUgPSAwOwogICAgfQogICAgX3NldChrZXksIHZhbHVlKSB7CiAgICAgIHRoaXMuY2FjaGUuc2V0KGtleSwgdmFsdWUpOwogICAgICB0aGlzLl9zaXplKys7CiAgICAgIGlmICh0aGlzLl9zaXplID49IHRoaXMubWF4U2l6ZSkgewogICAgICAgIHRoaXMuX3NpemUgPSAwOwogICAgICAgIHRoaXMub2xkQ2FjaGUgPSB0aGlzLmNhY2hlOwogICAgICAgIHRoaXMuY2FjaGUgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpOwogICAgICB9CiAgICB9CiAgICBnZXQoa2V5KSB7CiAgICAgIGlmICh0aGlzLmNhY2hlLmhhcyhrZXkpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuZ2V0KGtleSk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMub2xkQ2FjaGUuaGFzKGtleSkpIHsKICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMub2xkQ2FjaGUuZ2V0KGtleSk7CiAgICAgICAgdGhpcy5fc2V0KGtleSwgdmFsdWUpOwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfQogICAgfQogICAgc2V0KGtleSwgdmFsdWUpIHsKICAgICAgaWYgKHRoaXMuY2FjaGUuaGFzKGtleSkpIHsKICAgICAgICB0aGlzLmNhY2hlLnNldChrZXksIHZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9zZXQoa2V5LCB2YWx1ZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBoYXMoa2V5KSB7CiAgICAgIHJldHVybiB0aGlzLmNhY2hlLmhhcyhrZXkpIHx8IHRoaXMub2xkQ2FjaGUuaGFzKGtleSk7CiAgICB9CiAgICBwZWVrKGtleSkgewogICAgICBpZiAodGhpcy5jYWNoZS5oYXMoa2V5KSkgewogICAgICAgIHJldHVybiB0aGlzLmNhY2hlLmdldChrZXkpOwogICAgICB9CiAgICAgIGlmICh0aGlzLm9sZENhY2hlLmhhcyhrZXkpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMub2xkQ2FjaGUuZ2V0KGtleSk7CiAgICAgIH0KICAgIH0KICAgIGRlbGV0ZShrZXkpIHsKICAgICAgY29uc3QgZGVsZXRlZCA9IHRoaXMuY2FjaGUuZGVsZXRlKGtleSk7CiAgICAgIGlmIChkZWxldGVkKSB7CiAgICAgICAgdGhpcy5fc2l6ZS0tOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLm9sZENhY2hlLmRlbGV0ZShrZXkpIHx8IGRlbGV0ZWQ7CiAgICB9CiAgICBjbGVhcigpIHsKICAgICAgdGhpcy5jYWNoZS5jbGVhcigpOwogICAgICB0aGlzLm9sZENhY2hlLmNsZWFyKCk7CiAgICAgIHRoaXMuX3NpemUgPSAwOwogICAgfQogICAgKmtleXMoKSB7CiAgICAgIGZvciAoY29uc3QgW2tleV0gb2YgdGhpcykgewogICAgICAgIHlpZWxkIGtleTsKICAgICAgfQogICAgfQogICAgKnZhbHVlcygpIHsKICAgICAgZm9yIChjb25zdCBbLCB2YWx1ZV0gb2YgdGhpcykgewogICAgICAgIHlpZWxkIHZhbHVlOwogICAgICB9CiAgICB9CiAgICAqW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLmNhY2hlKSB7CiAgICAgICAgeWllbGQgaXRlbTsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5vbGRDYWNoZSkgewogICAgICAgIGNvbnN0IFtrZXldID0gaXRlbTsKICAgICAgICBpZiAoIXRoaXMuY2FjaGUuaGFzKGtleSkpIHsKICAgICAgICAgIHlpZWxkIGl0ZW07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBnZXQgc2l6ZSgpIHsKICAgICAgbGV0IG9sZENhY2hlU2l6ZSA9IDA7CiAgICAgIGZvciAoY29uc3Qga2V5IG9mIHRoaXMub2xkQ2FjaGUua2V5cygpKSB7CiAgICAgICAgaWYgKCF0aGlzLmNhY2hlLmhhcyhrZXkpKSB7CiAgICAgICAgICBvbGRDYWNoZVNpemUrKzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3NpemUgKyBvbGRDYWNoZVNpemU7CiAgICB9CiAgfQogIHZhciBxdWlja0xydSA9IFF1aWNrTFJVJDE7CiAgKGZ1bmN0aW9uKGV4cG9ydHMpIHsKICAgIHZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MiA9IGludGVyb3BSZXF1aXJlRGVmYXVsdCQxLmV4cG9ydHM7CiAgICB2YXIgX09iamVjdCRkZWZpbmVQcm9wZXJ0eTIgPSBkZWZpbmVQcm9wZXJ0eSQ5OwogICAgX09iamVjdCRkZWZpbmVQcm9wZXJ0eTIoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDsKICAgIHZhciBfZGVmaW5lUHJvcGVydHkyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGRlZmluZVByb3BlcnR5JDkpOwogICAgdmFyIF9kZWZpbmVQcm9wZXJ0aWVzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGRlZmluZVByb3BlcnRpZXMpOwogICAgdmFyIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyk7CiAgICB2YXIgX2ZvckVhY2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihmb3JFYWNoJDEpOwogICAgdmFyIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMyk7CiAgICB2YXIgX2ZpbHRlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGZpbHRlcik7CiAgICB2YXIgX2dldE93blByb3BlcnR5U3ltYm9scyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGdldE93blByb3BlcnR5U3ltYm9scyQyKTsKICAgIHZhciBfa2V5cyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGtleXMkMik7CiAgICB2YXIgX3JlZ2VuZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHJlZ2VuZXJhdG9yJDEpOwogICAgdmFyIF9hc3luY1RvR2VuZXJhdG9yMjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihhc3luY1RvR2VuZXJhdG9yJDEuZXhwb3J0cyk7CiAgICB2YXIgX2NsYXNzQ2FsbENoZWNrMjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihjbGFzc0NhbGxDaGVjayQxLmV4cG9ydHMpOwogICAgdmFyIF9jcmVhdGVDbGFzczIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoY3JlYXRlQ2xhc3MkMS5leHBvcnRzKTsKICAgIHZhciBfZGVmaW5lUHJvcGVydHkzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZGVmaW5lUHJvcGVydHkkNi5leHBvcnRzKTsKICAgIHZhciBfYWJvcnRhYmxlUHJvbWlzZUNhY2hlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZGlzdCQyKTsKICAgIHZhciBfcXVpY2tMcnUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihxdWlja0xydSk7CiAgICBmdW5jdGlvbiBvd25LZXlzMihvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgICAgIHZhciBrZXlzMiA9ICgwLCBfa2V5cy5kZWZhdWx0KShvYmplY3QpOwogICAgICBpZiAoX2dldE93blByb3BlcnR5U3ltYm9scy5kZWZhdWx0KSB7CiAgICAgICAgdmFyIHN5bWJvbHMyID0gKDAsIF9nZXRPd25Qcm9wZXJ0eVN5bWJvbHMuZGVmYXVsdCkob2JqZWN0KTsKICAgICAgICBpZiAoZW51bWVyYWJsZU9ubHkpCiAgICAgICAgICBzeW1ib2xzMiA9ICgwLCBfZmlsdGVyLmRlZmF1bHQpKHN5bWJvbHMyKS5jYWxsKHN5bWJvbHMyLCBmdW5jdGlvbihzeW0pIHsKICAgICAgICAgICAgcmV0dXJuICgwLCBfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLmRlZmF1bHQpKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgICAgICAgfSk7CiAgICAgICAga2V5czIucHVzaC5hcHBseShrZXlzMiwgc3ltYm9sczIpOwogICAgICB9CiAgICAgIHJldHVybiBrZXlzMjsKICAgIH0KICAgIGZ1bmN0aW9uIF9vYmplY3RTcHJlYWQyKHRhcmdldCkgewogICAgICBmb3IgKHZhciBpMiA9IDE7IGkyIDwgYXJndW1lbnRzLmxlbmd0aDsgaTIrKykgewogICAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaTJdICE9IG51bGwgPyBhcmd1bWVudHNbaTJdIDoge307CiAgICAgICAgaWYgKGkyICUgMikgewogICAgICAgICAgdmFyIF9jb250ZXh0MzsKICAgICAgICAgICgwLCBfZm9yRWFjaC5kZWZhdWx0KShfY29udGV4dDMgPSBvd25LZXlzMihPYmplY3Qoc291cmNlKSwgdHJ1ZSkpLmNhbGwoX2NvbnRleHQzLCBmdW5jdGlvbihrZXkpIHsKICAgICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTMuZGVmYXVsdCkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoX2dldE93blByb3BlcnR5RGVzY3JpcHRvcnMuZGVmYXVsdCkgewogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0aWVzMi5kZWZhdWx0KSh0YXJnZXQsICgwLCBfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycy5kZWZhdWx0KShzb3VyY2UpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIF9jb250ZXh0NDsKICAgICAgICAgICgwLCBfZm9yRWFjaC5kZWZhdWx0KShfY29udGV4dDQgPSBvd25LZXlzMihPYmplY3Qoc291cmNlKSkpLmNhbGwoX2NvbnRleHQ0LCBmdW5jdGlvbihrZXkpIHsKICAgICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIyLmRlZmF1bHQpKHRhcmdldCwga2V5LCAoMCwgX2dldE93blByb3BlcnR5RGVzY3JpcHRvci5kZWZhdWx0KShzb3VyY2UsIGtleSkpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICB2YXIgSW5kZXhGaWxlID0gLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKCkgewogICAgICBmdW5jdGlvbiBJbmRleEZpbGUyKF9yZWYpIHsKICAgICAgICB2YXIgZmlsZWhhbmRsZTIgPSBfcmVmLmZpbGVoYW5kbGUsIF9yZWYkcmVuYW1lUmVmU2VxID0gX3JlZi5yZW5hbWVSZWZTZXEsIHJlbmFtZVJlZlNlcSA9IF9yZWYkcmVuYW1lUmVmU2VxID09PSB2b2lkIDAgPyBmdW5jdGlvbihuKSB7CiAgICAgICAgICByZXR1cm4gbjsKICAgICAgICB9IDogX3JlZiRyZW5hbWVSZWZTZXE7CiAgICAgICAgKDAsIF9jbGFzc0NhbGxDaGVjazIyLmRlZmF1bHQpKHRoaXMsIEluZGV4RmlsZTIpOwogICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkzLmRlZmF1bHQpKHRoaXMsICJmaWxlaGFuZGxlIiwgdm9pZCAwKTsKICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5My5kZWZhdWx0KSh0aGlzLCAicmVuYW1lUmVmU2VxIiwgdm9pZCAwKTsKICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5My5kZWZhdWx0KSh0aGlzLCAiX3BhcnNlQ2FjaGUiLCB2b2lkIDApOwogICAgICAgIHRoaXMuZmlsZWhhbmRsZSA9IGZpbGVoYW5kbGUyOwogICAgICAgIHRoaXMucmVuYW1lUmVmU2VxID0gcmVuYW1lUmVmU2VxOwogICAgICB9CiAgICAgICgwLCBfY3JlYXRlQ2xhc3MyMi5kZWZhdWx0KShJbmRleEZpbGUyLCBbewogICAgICAgIGtleTogIl9maW5kRmlyc3REYXRhIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpbmRGaXJzdERhdGEoZGF0YTIsIHZpcnR1YWxPZmZzZXQyKSB7CiAgICAgICAgICB2YXIgY3VycmVudEZkbCA9IGRhdGEyLmZpcnN0RGF0YUxpbmU7CiAgICAgICAgICBpZiAoY3VycmVudEZkbCkgewogICAgICAgICAgICBkYXRhMi5maXJzdERhdGFMaW5lID0gY3VycmVudEZkbC5jb21wYXJlVG8odmlydHVhbE9mZnNldDIpID4gMCA/IHZpcnR1YWxPZmZzZXQyIDogY3VycmVudEZkbDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRhdGEyLmZpcnN0RGF0YUxpbmUgPSB2aXJ0dWFsT2Zmc2V0MjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJwYXJzZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF9wYXJzZTIgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICAgICAgdmFyIG9wdHMsIF9hcmdzID0gYXJndW1lbnRzOwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgb3B0cyA9IF9hcmdzLmxlbmd0aCA+IDAgJiYgX2FyZ3NbMF0gIT09IHZvaWQgMCA/IF9hcmdzWzBdIDoge307CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9wYXJzZUNhY2hlKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXJzZUNhY2hlID0gbmV3IF9hYm9ydGFibGVQcm9taXNlQ2FjaGUuZGVmYXVsdCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlOiBuZXcgX3F1aWNrTHJ1LmRlZmF1bHQoewogICAgICAgICAgICAgICAgICAgICAgICAgIG1heFNpemU6IDEKICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGw6IGZ1bmN0aW9uIGZpbGwob3B0czIsIHNpZ25hbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5fcGFyc2UoX29iamVjdFNwcmVhZDIoX29iamVjdFNwcmVhZDIoe30sIG9wdHMyKSwge30sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbAogICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHRoaXMuX3BhcnNlQ2FjaGUuZ2V0KCJpbmRleCIsIG9wdHMsIG9wdHMuc2lnbmFsKSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgICAgICB9KSk7CiAgICAgICAgICBmdW5jdGlvbiBwYXJzZSgpIHsKICAgICAgICAgICAgcmV0dXJuIF9wYXJzZTIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBwYXJzZTsKICAgICAgICB9KCkKICAgICAgfSwgewogICAgICAgIGtleTogImhhc1JlZlNlcSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF9oYXNSZWZTZXEgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoc2VxSWQpIHsKICAgICAgICAgICAgdmFyIG9wdHMsIF9hcmdzMiA9IGFyZ3VtZW50czsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBvcHRzID0gX2FyZ3MyLmxlbmd0aCA+IDEgJiYgX2FyZ3MyWzFdICE9PSB2b2lkIDAgPyBfYXJnczJbMV0gOiB7fTsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2Uob3B0cyk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIudDEgPSBzZXFJZDsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDIuc2VudC5pbmRpY2VzW19jb250ZXh0Mi50MV07CiAgICAgICAgICAgICAgICAgICAgaWYgKF9jb250ZXh0Mi50MCkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IHt9OwogICAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsICEhX2NvbnRleHQyLnQwLmJpbkluZGV4KTsKICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gaGFzUmVmU2VxKF94KSB7CiAgICAgICAgICAgIHJldHVybiBfaGFzUmVmU2VxLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaGFzUmVmU2VxOwogICAgICAgIH0oKQogICAgICB9XSk7CiAgICAgIHJldHVybiBJbmRleEZpbGUyOwogICAgfSgpOwogICAgZXhwb3J0cy5kZWZhdWx0ID0gSW5kZXhGaWxlOwogIH0pKGluZGV4RmlsZSk7CiAgdmFyIHV0aWwgPSB7fTsKICB2YXIgZmxvb3IgPSBNYXRoLmZsb29yOwogIHZhciBtZXJnZVNvcnQgPSBmdW5jdGlvbihhcnJheSwgY29tcGFyZWZuKSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgdmFyIG1pZGRsZSA9IGZsb29yKGxlbmd0aCAvIDIpOwogICAgcmV0dXJuIGxlbmd0aCA8IDggPyBpbnNlcnRpb25Tb3J0KGFycmF5LCBjb21wYXJlZm4pIDogbWVyZ2UobWVyZ2VTb3J0KGFycmF5LnNsaWNlKDAsIG1pZGRsZSksIGNvbXBhcmVmbiksIG1lcmdlU29ydChhcnJheS5zbGljZShtaWRkbGUpLCBjb21wYXJlZm4pLCBjb21wYXJlZm4pOwogIH07CiAgdmFyIGluc2VydGlvblNvcnQgPSBmdW5jdGlvbihhcnJheSwgY29tcGFyZWZuKSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgdmFyIGkyID0gMTsKICAgIHZhciBlbGVtZW50LCBqOwogICAgd2hpbGUgKGkyIDwgbGVuZ3RoKSB7CiAgICAgIGogPSBpMjsKICAgICAgZWxlbWVudCA9IGFycmF5W2kyXTsKICAgICAgd2hpbGUgKGogJiYgY29tcGFyZWZuKGFycmF5W2ogLSAxXSwgZWxlbWVudCkgPiAwKSB7CiAgICAgICAgYXJyYXlbal0gPSBhcnJheVstLWpdOwogICAgICB9CiAgICAgIGlmIChqICE9PSBpMisrKQogICAgICAgIGFycmF5W2pdID0gZWxlbWVudDsKICAgIH0KICAgIHJldHVybiBhcnJheTsKICB9OwogIHZhciBtZXJnZSA9IGZ1bmN0aW9uKGxlZnQsIHJpZ2h0LCBjb21wYXJlZm4pIHsKICAgIHZhciBsbGVuZ3RoID0gbGVmdC5sZW5ndGg7CiAgICB2YXIgcmxlbmd0aCA9IHJpZ2h0Lmxlbmd0aDsKICAgIHZhciBsaW5kZXggPSAwOwogICAgdmFyIHJpbmRleCA9IDA7CiAgICB2YXIgcmVzdWx0ID0gW107CiAgICB3aGlsZSAobGluZGV4IDwgbGxlbmd0aCB8fCByaW5kZXggPCBybGVuZ3RoKSB7CiAgICAgIGlmIChsaW5kZXggPCBsbGVuZ3RoICYmIHJpbmRleCA8IHJsZW5ndGgpIHsKICAgICAgICByZXN1bHQucHVzaChjb21wYXJlZm4obGVmdFtsaW5kZXhdLCByaWdodFtyaW5kZXhdKSA8PSAwID8gbGVmdFtsaW5kZXgrK10gOiByaWdodFtyaW5kZXgrK10pOwogICAgICB9IGVsc2UgewogICAgICAgIHJlc3VsdC5wdXNoKGxpbmRleCA8IGxsZW5ndGggPyBsZWZ0W2xpbmRleCsrXSA6IHJpZ2h0W3JpbmRleCsrXSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKICB2YXIgYXJyYXlTb3J0ID0gbWVyZ2VTb3J0OwogIHZhciB1c2VyQWdlbnQkMiA9IGVuZ2luZVVzZXJBZ2VudDsKICB2YXIgZmlyZWZveCA9IHVzZXJBZ2VudCQyLm1hdGNoKC9maXJlZm94XC8oXGQrKS9pKTsKICB2YXIgZW5naW5lRmZWZXJzaW9uID0gISFmaXJlZm94ICYmICtmaXJlZm94WzFdOwogIHZhciBVQSA9IGVuZ2luZVVzZXJBZ2VudDsKICB2YXIgZW5naW5lSXNJZU9yRWRnZSA9IC9NU0lFfFRyaWRlbnQvLnRlc3QoVUEpOwogIHZhciB1c2VyQWdlbnQkMSA9IGVuZ2luZVVzZXJBZ2VudDsKICB2YXIgd2Via2l0ID0gdXNlckFnZW50JDEubWF0Y2goL0FwcGxlV2ViS2l0XC8oXGQrKVwuLyk7CiAgdmFyIGVuZ2luZVdlYmtpdFZlcnNpb24gPSAhIXdlYmtpdCAmJiArd2Via2l0WzFdOwogIHZhciAkJGggPSBfZXhwb3J0OwogIHZhciBhQ2FsbGFibGUkMyA9IGFDYWxsYWJsZSRjOwogIHZhciB0b09iamVjdCQyID0gdG9PYmplY3QkYjsKICB2YXIgdG9MZW5ndGgkMiA9IHRvTGVuZ3RoJDk7CiAgdmFyIHRvU3RyaW5nJDUgPSB0b1N0cmluZyRhOwogIHZhciBmYWlscyQ0ID0gZmFpbHMkbjsKICB2YXIgaW50ZXJuYWxTb3J0ID0gYXJyYXlTb3J0OwogIHZhciBhcnJheU1ldGhvZElzU3RyaWN0JDIgPSBhcnJheU1ldGhvZElzU3RyaWN0JDQ7CiAgdmFyIEZGID0gZW5naW5lRmZWZXJzaW9uOwogIHZhciBJRV9PUl9FREdFID0gZW5naW5lSXNJZU9yRWRnZTsKICB2YXIgVjggPSBlbmdpbmVWOFZlcnNpb247CiAgdmFyIFdFQktJVCA9IGVuZ2luZVdlYmtpdFZlcnNpb247CiAgdmFyIHRlc3QgPSBbXTsKICB2YXIgbmF0aXZlU29ydCA9IHRlc3Quc29ydDsKICB2YXIgRkFJTFNfT05fVU5ERUZJTkVEID0gZmFpbHMkNChmdW5jdGlvbigpIHsKICAgIHRlc3Quc29ydCh2b2lkIDApOwogIH0pOwogIHZhciBGQUlMU19PTl9OVUxMID0gZmFpbHMkNChmdW5jdGlvbigpIHsKICAgIHRlc3Quc29ydChudWxsKTsKICB9KTsKICB2YXIgU1RSSUNUX01FVEhPRCQyID0gYXJyYXlNZXRob2RJc1N0cmljdCQyKCJzb3J0Iik7CiAgdmFyIFNUQUJMRV9TT1JUID0gIWZhaWxzJDQoZnVuY3Rpb24oKSB7CiAgICBpZiAoVjgpCiAgICAgIHJldHVybiBWOCA8IDcwOwogICAgaWYgKEZGICYmIEZGID4gMykKICAgICAgcmV0dXJuOwogICAgaWYgKElFX09SX0VER0UpCiAgICAgIHJldHVybiB0cnVlOwogICAgaWYgKFdFQktJVCkKICAgICAgcmV0dXJuIFdFQktJVCA8IDYwMzsKICAgIHZhciByZXN1bHQgPSAiIjsKICAgIHZhciBjb2RlMiwgY2hyLCB2YWx1ZSwgaW5kZXg7CiAgICBmb3IgKGNvZGUyID0gNjU7IGNvZGUyIDwgNzY7IGNvZGUyKyspIHsKICAgICAgY2hyID0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlMik7CiAgICAgIHN3aXRjaCAoY29kZTIpIHsKICAgICAgICBjYXNlIDY2OgogICAgICAgIGNhc2UgNjk6CiAgICAgICAgY2FzZSA3MDoKICAgICAgICBjYXNlIDcyOgogICAgICAgICAgdmFsdWUgPSAzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA2ODoKICAgICAgICBjYXNlIDcxOgogICAgICAgICAgdmFsdWUgPSA0OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHZhbHVlID0gMjsKICAgICAgfQogICAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCA0NzsgaW5kZXgrKykgewogICAgICAgIHRlc3QucHVzaCh7IGs6IGNociArIGluZGV4LCB2OiB2YWx1ZSB9KTsKICAgICAgfQogICAgfQogICAgdGVzdC5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgcmV0dXJuIGIudiAtIGEudjsKICAgIH0pOwogICAgZm9yIChpbmRleCA9IDA7IGluZGV4IDwgdGVzdC5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgY2hyID0gdGVzdFtpbmRleF0uay5jaGFyQXQoMCk7CiAgICAgIGlmIChyZXN1bHQuY2hhckF0KHJlc3VsdC5sZW5ndGggLSAxKSAhPT0gY2hyKQogICAgICAgIHJlc3VsdCArPSBjaHI7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0ICE9PSAiREdCRUZIQUNJSksiOwogIH0pOwogIHZhciBGT1JDRUQkMSA9IEZBSUxTX09OX1VOREVGSU5FRCB8fCAhRkFJTFNfT05fTlVMTCB8fCAhU1RSSUNUX01FVEhPRCQyIHx8ICFTVEFCTEVfU09SVDsKICB2YXIgZ2V0U29ydENvbXBhcmUgPSBmdW5jdGlvbihjb21wYXJlZm4pIHsKICAgIHJldHVybiBmdW5jdGlvbih4LCB5KSB7CiAgICAgIGlmICh5ID09PSB2b2lkIDApCiAgICAgICAgcmV0dXJuIC0xOwogICAgICBpZiAoeCA9PT0gdm9pZCAwKQogICAgICAgIHJldHVybiAxOwogICAgICBpZiAoY29tcGFyZWZuICE9PSB2b2lkIDApCiAgICAgICAgcmV0dXJuICtjb21wYXJlZm4oeCwgeSkgfHwgMDsKICAgICAgcmV0dXJuIHRvU3RyaW5nJDUoeCkgPiB0b1N0cmluZyQ1KHkpID8gMSA6IC0xOwogICAgfTsKICB9OwogICQkaCh7IHRhcmdldDogIkFycmF5IiwgcHJvdG86IHRydWUsIGZvcmNlZDogRk9SQ0VEJDEgfSwgewogICAgc29ydDogZnVuY3Rpb24gc29ydDIoY29tcGFyZWZuKSB7CiAgICAgIGlmIChjb21wYXJlZm4gIT09IHZvaWQgMCkKICAgICAgICBhQ2FsbGFibGUkMyhjb21wYXJlZm4pOwogICAgICB2YXIgYXJyYXkgPSB0b09iamVjdCQyKHRoaXMpOwogICAgICBpZiAoU1RBQkxFX1NPUlQpCiAgICAgICAgcmV0dXJuIGNvbXBhcmVmbiA9PT0gdm9pZCAwID8gbmF0aXZlU29ydC5jYWxsKGFycmF5KSA6IG5hdGl2ZVNvcnQuY2FsbChhcnJheSwgY29tcGFyZWZuKTsKICAgICAgdmFyIGl0ZW1zID0gW107CiAgICAgIHZhciBhcnJheUxlbmd0aCA9IHRvTGVuZ3RoJDIoYXJyYXkubGVuZ3RoKTsKICAgICAgdmFyIGl0ZW1zTGVuZ3RoLCBpbmRleDsKICAgICAgZm9yIChpbmRleCA9IDA7IGluZGV4IDwgYXJyYXlMZW5ndGg7IGluZGV4KyspIHsKICAgICAgICBpZiAoaW5kZXggaW4gYXJyYXkpCiAgICAgICAgICBpdGVtcy5wdXNoKGFycmF5W2luZGV4XSk7CiAgICAgIH0KICAgICAgaXRlbXMgPSBpbnRlcm5hbFNvcnQoaXRlbXMsIGdldFNvcnRDb21wYXJlKGNvbXBhcmVmbikpOwogICAgICBpdGVtc0xlbmd0aCA9IGl0ZW1zLmxlbmd0aDsKICAgICAgaW5kZXggPSAwOwogICAgICB3aGlsZSAoaW5kZXggPCBpdGVtc0xlbmd0aCkKICAgICAgICBhcnJheVtpbmRleF0gPSBpdGVtc1tpbmRleCsrXTsKICAgICAgd2hpbGUgKGluZGV4IDwgYXJyYXlMZW5ndGgpCiAgICAgICAgZGVsZXRlIGFycmF5W2luZGV4KytdOwogICAgICByZXR1cm4gYXJyYXk7CiAgICB9CiAgfSk7CiAgdmFyIGVudHJ5VmlydHVhbCQ0ID0gZW50cnlWaXJ0dWFsJGE7CiAgdmFyIHNvcnQkMyA9IGVudHJ5VmlydHVhbCQ0KCJBcnJheSIpLnNvcnQ7CiAgdmFyIHNvcnQkMiA9IHNvcnQkMzsKICB2YXIgQXJyYXlQcm90b3R5cGUkMiA9IEFycmF5LnByb3RvdHlwZTsKICB2YXIgc29ydF8xID0gZnVuY3Rpb24oaXQpIHsKICAgIHZhciBvd24gPSBpdC5zb3J0OwogICAgcmV0dXJuIGl0ID09PSBBcnJheVByb3RvdHlwZSQyIHx8IGl0IGluc3RhbmNlb2YgQXJyYXkgJiYgb3duID09PSBBcnJheVByb3RvdHlwZSQyLnNvcnQgPyBzb3J0JDIgOiBvd247CiAgfTsKICB2YXIgcGFyZW50JGkgPSBzb3J0XzE7CiAgdmFyIHNvcnQkMSA9IHBhcmVudCRpOwogIHZhciBzb3J0ID0gc29ydCQxOwogIHZhciAkJGcgPSBfZXhwb3J0OwogICQkZyh7IHRhcmdldDogIk51bWJlciIsIHN0YXQ6IHRydWUgfSwgewogICAgTUlOX1NBRkVfSU5URUdFUjogLTkwMDcxOTkyNTQ3NDA5OTEKICB9KTsKICB2YXIgbWluU2FmZUludGVnZXIkMiA9IC05MDA3MTk5MjU0NzQwOTkxOwogIHZhciBwYXJlbnQkaCA9IG1pblNhZmVJbnRlZ2VyJDI7CiAgdmFyIG1pblNhZmVJbnRlZ2VyJDEgPSBwYXJlbnQkaDsKICB2YXIgbWluU2FmZUludGVnZXIgPSBtaW5TYWZlSW50ZWdlciQxOwogIHZhciAkJGYgPSBfZXhwb3J0OwogICQkZih7IHRhcmdldDogIk51bWJlciIsIHN0YXQ6IHRydWUgfSwgewogICAgTUFYX1NBRkVfSU5URUdFUjogOTAwNzE5OTI1NDc0MDk5MQogIH0pOwogIHZhciBtYXhTYWZlSW50ZWdlciQyID0gOTAwNzE5OTI1NDc0MDk5MTsKICB2YXIgcGFyZW50JGcgPSBtYXhTYWZlSW50ZWdlciQyOwogIHZhciBtYXhTYWZlSW50ZWdlciQxID0gcGFyZW50JGc7CiAgdmFyIG1heFNhZmVJbnRlZ2VyID0gbWF4U2FmZUludGVnZXIkMTsKICB2YXIgJCRlID0gX2V4cG9ydDsKICB2YXIgZ2xvYmFsJDQgPSBnbG9iYWwkbzsKICB2YXIgaXNDYWxsYWJsZSQyID0gaXNDYWxsYWJsZSRsOwogIHZhciB1c2VyQWdlbnQgPSBlbmdpbmVVc2VyQWdlbnQ7CiAgdmFyIHNsaWNlID0gW10uc2xpY2U7CiAgdmFyIE1TSUUgPSAvTVNJRSAuXC4vLnRlc3QodXNlckFnZW50KTsKICB2YXIgd3JhcCA9IGZ1bmN0aW9uKHNjaGVkdWxlcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKGhhbmRsZXIsIHRpbWVvdXQpIHsKICAgICAgdmFyIGJvdW5kQXJncyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyOwogICAgICB2YXIgYXJncyA9IGJvdW5kQXJncyA/IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKSA6IHZvaWQgMDsKICAgICAgcmV0dXJuIHNjaGVkdWxlcihib3VuZEFyZ3MgPyBmdW5jdGlvbigpIHsKICAgICAgICAoaXNDYWxsYWJsZSQyKGhhbmRsZXIpID8gaGFuZGxlciA6IEZ1bmN0aW9uKGhhbmRsZXIpKS5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgfSA6IGhhbmRsZXIsIHRpbWVvdXQpOwogICAgfTsKICB9OwogICQkZSh7IGdsb2JhbDogdHJ1ZSwgYmluZDogdHJ1ZSwgZm9yY2VkOiBNU0lFIH0sIHsKICAgIHNldFRpbWVvdXQ6IHdyYXAoZ2xvYmFsJDQuc2V0VGltZW91dCksCiAgICBzZXRJbnRlcnZhbDogd3JhcChnbG9iYWwkNC5zZXRJbnRlcnZhbCkKICB9KTsKICB2YXIgcGF0aCQ0ID0gcGF0aCRuOwogIHZhciBzZXRUaW1lb3V0JDIgPSBwYXRoJDQuc2V0VGltZW91dDsKICB2YXIgc2V0VGltZW91dCQxID0gc2V0VGltZW91dCQyOwogIHZhciBwcm9taXNlID0gcHJvbWlzZSQzOwogIChmdW5jdGlvbihleHBvcnRzKSB7CiAgICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIgPSBpbnRlcm9wUmVxdWlyZURlZmF1bHQkMS5leHBvcnRzOwogICAgdmFyIF9PYmplY3QkZGVmaW5lUHJvcGVydHkgPSBkZWZpbmVQcm9wZXJ0eSQ5OwogICAgX09iamVjdCRkZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy50aW1lb3V0ID0gdGltZW91dDsKICAgIGV4cG9ydHMubG9uZ1RvTnVtYmVyID0gbG9uZ1RvTnVtYmVyOwogICAgZXhwb3J0cy5jaGVja0Fib3J0U2lnbmFsID0gY2hlY2tBYm9ydFNpZ25hbDsKICAgIGV4cG9ydHMuYWJvcnRCcmVha1BvaW50ID0gYWJvcnRCcmVha1BvaW50OwogICAgZXhwb3J0cy5jYW5NZXJnZUJsb2NrcyA9IGNhbk1lcmdlQmxvY2tzOwogICAgZXhwb3J0cy5tYWtlT3B0cyA9IG1ha2VPcHRzOwogICAgZXhwb3J0cy5vcHRpbWl6ZUNodW5rcyA9IG9wdGltaXplQ2h1bmtzOwogICAgdmFyIF9yZWdlbmVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihyZWdlbmVyYXRvciQxKTsKICAgIHZhciBfZm9yRWFjaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGZvckVhY2gkMSk7CiAgICB2YXIgX3NvcnQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihzb3J0KTsKICAgIHZhciBfYXN5bmNUb0dlbmVyYXRvcjIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoYXN5bmNUb0dlbmVyYXRvciQxLmV4cG9ydHMpOwogICAgdmFyIF9taW5TYWZlSW50ZWdlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKG1pblNhZmVJbnRlZ2VyKTsKICAgIHZhciBfbWF4U2FmZUludGVnZXIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihtYXhTYWZlSW50ZWdlcik7CiAgICB2YXIgX3NldFRpbWVvdXQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoc2V0VGltZW91dCQxKTsKICAgIHZhciBfcHJvbWlzZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHByb21pc2UpOwogICAgZnVuY3Rpb24gdGltZW91dChtcykgewogICAgICByZXR1cm4gbmV3IF9wcm9taXNlLmRlZmF1bHQoZnVuY3Rpb24ocmVzb2x2ZSkgewogICAgICAgIHJldHVybiAoMCwgX3NldFRpbWVvdXQyLmRlZmF1bHQpKHJlc29sdmUsIG1zKTsKICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBsb25nVG9OdW1iZXIobG9uZzIpIHsKICAgICAgaWYgKGxvbmcyLmdyZWF0ZXJUaGFuKF9tYXhTYWZlSW50ZWdlci5kZWZhdWx0KSB8fCBsb25nMi5sZXNzVGhhbihfbWluU2FmZUludGVnZXIuZGVmYXVsdCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludGVnZXIgb3ZlcmZsb3ciKTsKICAgICAgfQogICAgICByZXR1cm4gbG9uZzIudG9OdW1iZXIoKTsKICAgIH0KICAgIGZ1bmN0aW9uIGNoZWNrQWJvcnRTaWduYWwoc2lnbmFsKSB7CiAgICAgIGlmICghc2lnbmFsKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChzaWduYWwuYWJvcnRlZCkgewogICAgICAgIGlmICh0eXBlb2YgRE9NRXhjZXB0aW9uICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbigiYWJvcnRlZCIsICJBYm9ydEVycm9yIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBlID0gbmV3IEVycm9yKCJhYm9ydGVkIik7CiAgICAgICAgICBlLmNvZGUgPSAiRVJSX0FCT1JURUQiOwogICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGFib3J0QnJlYWtQb2ludChfeCkgewogICAgICByZXR1cm4gX2Fib3J0QnJlYWtQb2ludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQogICAgZnVuY3Rpb24gX2Fib3J0QnJlYWtQb2ludCgpIHsKICAgICAgX2Fib3J0QnJlYWtQb2ludCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKHNpZ25hbCkgewogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IyLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIF9wcm9taXNlLmRlZmF1bHQucmVzb2x2ZSgpOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGNoZWNrQWJvcnRTaWduYWwoc2lnbmFsKTsKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgfSkpOwogICAgICByZXR1cm4gX2Fib3J0QnJlYWtQb2ludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQogICAgZnVuY3Rpb24gY2FuTWVyZ2VCbG9ja3MoY2h1bmsxLCBjaHVuazIpIHsKICAgICAgcmV0dXJuIGNodW5rMi5taW52LmJsb2NrUG9zaXRpb24gLSBjaHVuazEubWF4di5ibG9ja1Bvc2l0aW9uIDwgNjVlMyAmJiBjaHVuazIubWF4di5ibG9ja1Bvc2l0aW9uIC0gY2h1bmsxLm1pbnYuYmxvY2tQb3NpdGlvbiA8IDVlNjsKICAgIH0KICAgIGZ1bmN0aW9uIG1ha2VPcHRzKCkgewogICAgICB2YXIgb2JqID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMF0gOiB7fTsKICAgICAgcmV0dXJuICJhYm9ydGVkIiBpbiBvYmogPyB7CiAgICAgICAgc2lnbmFsOiBvYmoKICAgICAgfSA6IG9iajsKICAgIH0KICAgIGZ1bmN0aW9uIG9wdGltaXplQ2h1bmtzKGNodW5rcywgbG93ZXN0KSB7CiAgICAgIHZhciBtZXJnZWRDaHVua3MgPSBbXTsKICAgICAgdmFyIGxhc3RDaHVuayA9IG51bGw7CiAgICAgIGlmIChjaHVua3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGNodW5rczsKICAgICAgfQogICAgICAoMCwgX3NvcnQuZGVmYXVsdCkoY2h1bmtzKS5jYWxsKGNodW5rcywgZnVuY3Rpb24oYzAsIGMxKSB7CiAgICAgICAgdmFyIGRpZiA9IGMwLm1pbnYuYmxvY2tQb3NpdGlvbiAtIGMxLm1pbnYuYmxvY2tQb3NpdGlvbjsKICAgICAgICBpZiAoZGlmICE9PSAwKSB7CiAgICAgICAgICByZXR1cm4gZGlmOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gYzAubWludi5kYXRhUG9zaXRpb24gLSBjMS5taW52LmRhdGFQb3NpdGlvbjsKICAgICAgICB9CiAgICAgIH0pOwogICAgICAoMCwgX2ZvckVhY2guZGVmYXVsdCkoY2h1bmtzKS5jYWxsKGNodW5rcywgZnVuY3Rpb24oY2h1bmsyKSB7CiAgICAgICAgaWYgKCFsb3dlc3QgfHwgY2h1bmsyLm1heHYuY29tcGFyZVRvKGxvd2VzdCkgPiAwKSB7CiAgICAgICAgICBpZiAobGFzdENodW5rID09PSBudWxsKSB7CiAgICAgICAgICAgIG1lcmdlZENodW5rcy5wdXNoKGNodW5rMik7CiAgICAgICAgICAgIGxhc3RDaHVuayA9IGNodW5rMjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChjYW5NZXJnZUJsb2NrcyhsYXN0Q2h1bmssIGNodW5rMikpIHsKICAgICAgICAgICAgICBpZiAoY2h1bmsyLm1heHYuY29tcGFyZVRvKGxhc3RDaHVuay5tYXh2KSA+IDApIHsKICAgICAgICAgICAgICAgIGxhc3RDaHVuay5tYXh2ID0gY2h1bmsyLm1heHY7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1lcmdlZENodW5rcy5wdXNoKGNodW5rMik7CiAgICAgICAgICAgICAgbGFzdENodW5rID0gY2h1bmsyOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIG1lcmdlZENodW5rczsKICAgIH0KICB9KSh1dGlsKTsKICAoZnVuY3Rpb24oZXhwb3J0cykgewogICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyID0gaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDEuZXhwb3J0czsKICAgIHZhciBfT2JqZWN0JGRlZmluZVByb3BlcnR5MiA9IGRlZmluZVByb3BlcnR5JDk7CiAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5MihleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwOwogICAgdmFyIF9nZXRJdGVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihnZXRJdGVyYXRvciQyKTsKICAgIHZhciBfaXNBcnJheSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGlzQXJyYXkkNik7CiAgICB2YXIgX2dldEl0ZXJhdG9yTWV0aG9kMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGdldEl0ZXJhdG9yTWV0aG9kJDIpOwogICAgdmFyIF9zeW1ib2wgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihzeW1ib2wkMik7CiAgICB2YXIgX2Zyb20gPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihmcm9tJDMpOwogICAgdmFyIF9kZWZpbmVQcm9wZXJ0eTIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZGVmaW5lUHJvcGVydHkkOSk7CiAgICB2YXIgX2RlZmluZVByb3BlcnRpZXMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZGVmaW5lUHJvcGVydGllcyk7CiAgICB2YXIgX2dldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKTsKICAgIHZhciBfZm9yRWFjaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGZvckVhY2gkMSk7CiAgICB2YXIgX2dldE93blByb3BlcnR5RGVzY3JpcHRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGdldE93blByb3BlcnR5RGVzY3JpcHRvciQzKTsKICAgIHZhciBfZmlsdGVyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZmlsdGVyKTsKICAgIHZhciBfZ2V0T3duUHJvcGVydHlTeW1ib2xzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZ2V0T3duUHJvcGVydHlTeW1ib2xzJDIpOwogICAgdmFyIF9rZXlzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoa2V5cyQyKTsKICAgIHZhciBfY29uc3RydWN0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoY29uc3RydWN0KTsKICAgIHZhciBfc2xpY2VkVG9BcnJheTIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoc2xpY2VkVG9BcnJheSQxLmV4cG9ydHMpOwogICAgdmFyIF9kZWZpbmVQcm9wZXJ0eTMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihkZWZpbmVQcm9wZXJ0eSQ2LmV4cG9ydHMpOwogICAgdmFyIF9tYXAgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihtYXApOwogICAgdmFyIF9yZWdlbmVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihyZWdlbmVyYXRvciQxKTsKICAgIHZhciBfYXN5bmNUb0dlbmVyYXRvcjIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoYXN5bmNUb0dlbmVyYXRvciQxLmV4cG9ydHMpOwogICAgdmFyIF9zbGljZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHNsaWNlJDEpOwogICAgdmFyIF9jbGFzc0NhbGxDaGVjazIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoY2xhc3NDYWxsQ2hlY2skMS5leHBvcnRzKTsKICAgIHZhciBfY3JlYXRlQ2xhc3MyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGNyZWF0ZUNsYXNzJDEuZXhwb3J0cyk7CiAgICB2YXIgX2luaGVyaXRzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGluaGVyaXRzLmV4cG9ydHMpOwogICAgdmFyIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHBvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4uZXhwb3J0cyk7CiAgICB2YXIgX2dldFByb3RvdHlwZU9mMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGdldFByb3RvdHlwZU9mJDQuZXhwb3J0cyk7CiAgICB2YXIgX2xvbmcgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihsb25nKTsKICAgIHZhciBfdmlydHVhbE9mZnNldCA9IHZpcnR1YWxPZmZzZXQ7CiAgICB2YXIgX2NodW5rID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoY2h1bmspOwogICAgdmFyIF9pbmRleEZpbGUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihpbmRleEZpbGUpOwogICAgdmFyIF91dGlsID0gdXRpbDsKICAgIGZ1bmN0aW9uIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG8sIGFsbG93QXJyYXlMaWtlKSB7CiAgICAgIHZhciBpdDsKICAgICAgaWYgKHR5cGVvZiBfc3ltYm9sLmRlZmF1bHQgPT09ICJ1bmRlZmluZWQiIHx8ICgwLCBfZ2V0SXRlcmF0b3JNZXRob2QyLmRlZmF1bHQpKG8pID09IG51bGwpIHsKICAgICAgICBpZiAoKDAsIF9pc0FycmF5LmRlZmF1bHQpKG8pIHx8IChpdCA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7CiAgICAgICAgICBpZiAoaXQpCiAgICAgICAgICAgIG8gPSBpdDsKICAgICAgICAgIHZhciBpMiA9IDA7CiAgICAgICAgICB2YXIgRiA9IGZ1bmN0aW9uIEYyKCkgewogICAgICAgICAgfTsKICAgICAgICAgIHJldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7CiAgICAgICAgICAgIGlmIChpMiA+PSBvLmxlbmd0aCkKICAgICAgICAgICAgICByZXR1cm4geyBkb25lOiB0cnVlIH07CiAgICAgICAgICAgIHJldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpMisrXSB9OwogICAgICAgICAgfSwgZTogZnVuY3Rpb24gZShfZSkgewogICAgICAgICAgICB0aHJvdyBfZTsKICAgICAgICAgIH0sIGY6IEYgfTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOwogICAgICB9CiAgICAgIHZhciBub3JtYWxDb21wbGV0aW9uID0gdHJ1ZSwgZGlkRXJyID0gZmFsc2UsIGVycjI7CiAgICAgIHJldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7CiAgICAgICAgaXQgPSAoMCwgX2dldEl0ZXJhdG9yMi5kZWZhdWx0KShvKTsKICAgICAgfSwgbjogZnVuY3Rpb24gbigpIHsKICAgICAgICB2YXIgc3RlcCA9IGl0Lm5leHQoKTsKICAgICAgICBub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lOwogICAgICAgIHJldHVybiBzdGVwOwogICAgICB9LCBlOiBmdW5jdGlvbiBlKF9lMikgewogICAgICAgIGRpZEVyciA9IHRydWU7CiAgICAgICAgZXJyMiA9IF9lMjsKICAgICAgfSwgZjogZnVuY3Rpb24gZigpIHsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKCFub3JtYWxDb21wbGV0aW9uICYmIGl0LnJldHVybiAhPSBudWxsKQogICAgICAgICAgICBpdC5yZXR1cm4oKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgaWYgKGRpZEVycikKICAgICAgICAgICAgdGhyb3cgZXJyMjsKICAgICAgICB9CiAgICAgIH0gfTsKICAgIH0KICAgIGZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHsKICAgICAgdmFyIF9jb250ZXh0NzsKICAgICAgaWYgKCFvKQogICAgICAgIHJldHVybjsKICAgICAgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikKICAgICAgICByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsKICAgICAgdmFyIG4gPSAoMCwgX3NsaWNlLmRlZmF1bHQpKF9jb250ZXh0NyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKSkuY2FsbChfY29udGV4dDcsIDgsIC0xKTsKICAgICAgaWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpCiAgICAgICAgbiA9IG8uY29uc3RydWN0b3IubmFtZTsKICAgICAgaWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKQogICAgICAgIHJldHVybiAoMCwgX2Zyb20uZGVmYXVsdCkobyk7CiAgICAgIGlmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkKICAgICAgICByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsKICAgIH0KICAgIGZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuMikgewogICAgICBpZiAobGVuMiA9PSBudWxsIHx8IGxlbjIgPiBhcnIubGVuZ3RoKQogICAgICAgIGxlbjIgPSBhcnIubGVuZ3RoOwogICAgICBmb3IgKHZhciBpMiA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuMik7IGkyIDwgbGVuMjsgaTIrKykgewogICAgICAgIGFycjJbaTJdID0gYXJyW2kyXTsKICAgICAgfQogICAgICByZXR1cm4gYXJyMjsKICAgIH0KICAgIGZ1bmN0aW9uIG93bktleXMyKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICAgICAgdmFyIGtleXMyID0gKDAsIF9rZXlzLmRlZmF1bHQpKG9iamVjdCk7CiAgICAgIGlmIChfZ2V0T3duUHJvcGVydHlTeW1ib2xzLmRlZmF1bHQpIHsKICAgICAgICB2YXIgc3ltYm9sczIgPSAoMCwgX2dldE93blByb3BlcnR5U3ltYm9scy5kZWZhdWx0KShvYmplY3QpOwogICAgICAgIGlmIChlbnVtZXJhYmxlT25seSkKICAgICAgICAgIHN5bWJvbHMyID0gKDAsIF9maWx0ZXIuZGVmYXVsdCkoc3ltYm9sczIpLmNhbGwoc3ltYm9sczIsIGZ1bmN0aW9uKHN5bSkgewogICAgICAgICAgICByZXR1cm4gKDAsIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IuZGVmYXVsdCkob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICAgICAgICB9KTsKICAgICAgICBrZXlzMi5wdXNoLmFwcGx5KGtleXMyLCBzeW1ib2xzMik7CiAgICAgIH0KICAgICAgcmV0dXJuIGtleXMyOwogICAgfQogICAgZnVuY3Rpb24gX29iamVjdFNwcmVhZDIodGFyZ2V0KSB7CiAgICAgIGZvciAodmFyIGkyID0gMTsgaTIgPCBhcmd1bWVudHMubGVuZ3RoOyBpMisrKSB7CiAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpMl0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpMl0gOiB7fTsKICAgICAgICBpZiAoaTIgJSAyKSB7CiAgICAgICAgICB2YXIgX2NvbnRleHQ1OwogICAgICAgICAgKDAsIF9mb3JFYWNoLmRlZmF1bHQpKF9jb250ZXh0NSA9IG93bktleXMyKE9iamVjdChzb3VyY2UpLCB0cnVlKSkuY2FsbChfY29udGV4dDUsIGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5My5kZWZhdWx0KSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycy5kZWZhdWx0KSB7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnRpZXMyLmRlZmF1bHQpKHRhcmdldCwgKDAsIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzLmRlZmF1bHQpKHNvdXJjZSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgX2NvbnRleHQ2OwogICAgICAgICAgKDAsIF9mb3JFYWNoLmRlZmF1bHQpKF9jb250ZXh0NiA9IG93bktleXMyKE9iamVjdChzb3VyY2UpKSkuY2FsbChfY29udGV4dDYsIGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5MjIuZGVmYXVsdCkodGFyZ2V0LCBrZXksICgwLCBfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLmRlZmF1bHQpKHNvdXJjZSwga2V5KSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGZ1bmN0aW9uIF9jcmVhdGVTdXBlcjIoRGVyaXZlZCkgewogICAgICB2YXIgaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCA9IF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QyKCk7CiAgICAgIHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsKICAgICAgICB2YXIgU3VwZXIgPSAoMCwgX2dldFByb3RvdHlwZU9mMi5kZWZhdWx0KShEZXJpdmVkKSwgcmVzdWx0OwogICAgICAgIGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7CiAgICAgICAgICB2YXIgTmV3VGFyZ2V0ID0gKDAsIF9nZXRQcm90b3R5cGVPZjIuZGVmYXVsdCkodGhpcykuY29uc3RydWN0b3I7CiAgICAgICAgICByZXN1bHQgPSAoMCwgX2NvbnN0cnVjdC5kZWZhdWx0KShTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKDAsIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuMi5kZWZhdWx0KSh0aGlzLCByZXN1bHQpOwogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdDIoKSB7CiAgICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIV9jb25zdHJ1Y3QuZGVmYXVsdCkKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIGlmIChfY29uc3RydWN0LmRlZmF1bHQuc2hhbSkKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIHRyeSB7CiAgICAgICAgRGF0ZS5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCgoMCwgX2NvbnN0cnVjdC5kZWZhdWx0KShEYXRlLCBbXSwgZnVuY3Rpb24oKSB7CiAgICAgICAgfSkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICB2YXIgQkFJX01BR0lDID0gMjE1NzgwNTA7CiAgICBmdW5jdGlvbiByb3VuZERvd24obiwgbXVsdGlwbGUpIHsKICAgICAgcmV0dXJuIG4gLSBuICUgbXVsdGlwbGU7CiAgICB9CiAgICBmdW5jdGlvbiByb3VuZFVwKG4sIG11bHRpcGxlKSB7CiAgICAgIHJldHVybiBuIC0gbiAlIG11bHRpcGxlICsgbXVsdGlwbGU7CiAgICB9CiAgICB2YXIgQkFJID0gLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKF9JbmRleEZpbGUpIHsKICAgICAgKDAsIF9pbmhlcml0czIuZGVmYXVsdCkoQkFJMiwgX0luZGV4RmlsZSk7CiAgICAgIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIyKEJBSTIpOwogICAgICBmdW5jdGlvbiBCQUkyKCkgewogICAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syMi5kZWZhdWx0KSh0aGlzLCBCQUkyKTsKICAgICAgICByZXR1cm4gX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgKDAsIF9jcmVhdGVDbGFzczIyLmRlZmF1bHQpKEJBSTIsIFt7CiAgICAgICAga2V5OiAicGFyc2VQc2V1ZG9CaW4iLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBwYXJzZVBzZXVkb0JpbihieXRlcywgb2Zmc2V0KSB7CiAgICAgICAgICB2YXIgbGluZUNvdW50ID0gKDAsIF91dGlsLmxvbmdUb051bWJlcikoX2xvbmcuZGVmYXVsdC5mcm9tQnl0ZXNMRSgoMCwgX3NsaWNlLmRlZmF1bHQpKEFycmF5LnByb3RvdHlwZSkuY2FsbChieXRlcywgb2Zmc2V0ICsgMTYsIG9mZnNldCArIDI0KSwgdHJ1ZSkpOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbGluZUNvdW50CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImxpbmVDb3VudCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF9saW5lQ291bnQgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZShyZWZJZCkgewogICAgICAgICAgICB2YXIgb3B0cywgcHJvbSwgaW5kZXgsIHJldCwgX2FyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IyLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBvcHRzID0gX2FyZ3MubGVuZ3RoID4gMSAmJiBfYXJnc1sxXSAhPT0gdm9pZCAwID8gX2FyZ3NbMV0gOiB7fTsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZShvcHRzKTsKICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgIHByb20gPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgICAgIGluZGV4ID0gcHJvbS5pbmRpY2VzW3JlZklkXTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIC0xKTsKICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgIHJldCA9IGluZGV4LnN0YXRzIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHJldC5saW5lQ291bnQgPT09IHZvaWQgMCA/IC0xIDogcmV0LmxpbmVDb3VudCk7CiAgICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgICAgICB9KSk7CiAgICAgICAgICBmdW5jdGlvbiBsaW5lQ291bnQoX3gpIHsKICAgICAgICAgICAgcmV0dXJuIF9saW5lQ291bnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBsaW5lQ291bnQ7CiAgICAgICAgfSgpCiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfcGFyc2UiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBfcGFyc2UyID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgICAgICB2YXIgb3B0cywgZGF0YTIsIGJ5dGVzLCBkZXB0aCwgYmluTGltaXQsIGN1cnJPZmZzZXQsIGkyLCBiaW5Db3VudCwgc3RhdHMsIGJpbkluZGV4LCBqLCBiaW4sIGNodW5rQ291bnQsIGNodW5rcywgaywgdSwgdiwgbGluZWFyQ291bnQsIGxpbmVhckluZGV4LCBfaywgX2FyZ3MyID0gYXJndW1lbnRzOwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIG9wdHMgPSBfYXJnczIubGVuZ3RoID4gMCAmJiBfYXJnczJbMF0gIT09IHZvaWQgMCA/IF9hcmdzMlswXSA6IHt9OwogICAgICAgICAgICAgICAgICAgIGRhdGEyID0gewogICAgICAgICAgICAgICAgICAgICAgYmFpOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgbWF4QmxvY2tTaXplOiAxIDw8IDE2CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZWhhbmRsZS5yZWFkRmlsZShvcHRzKTsKICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgIGJ5dGVzID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoYnl0ZXMucmVhZFVJbnQzMkxFKDApICE9PSBCQUlfTUFHSUMpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgYSBCQUkgZmlsZSIpOwogICAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgZGF0YTIucmVmQ291bnQgPSBieXRlcy5yZWFkSW50MzJMRSg0KTsKICAgICAgICAgICAgICAgICAgICBkZXB0aCA9IDU7CiAgICAgICAgICAgICAgICAgICAgYmluTGltaXQgPSAoKDEgPDwgKGRlcHRoICsgMSkgKiAzKSAtIDEpIC8gNzsKICAgICAgICAgICAgICAgICAgICBkYXRhMi5pbmRpY2VzID0gbmV3IEFycmF5KGRhdGEyLnJlZkNvdW50KTsKICAgICAgICAgICAgICAgICAgICBjdXJyT2Zmc2V0ID0gODsKICAgICAgICAgICAgICAgICAgICBpMiA9IDA7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoaTIgPCBkYXRhMi5yZWZDb3VudCkpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNTA7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLmFib3J0QnJlYWtQb2ludCkob3B0cy5zaWduYWwpOwogICAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICAgIGJpbkNvdW50ID0gYnl0ZXMucmVhZEludDMyTEUoY3Vyck9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgc3RhdHMgPSB2b2lkIDA7CiAgICAgICAgICAgICAgICAgICAgY3Vyck9mZnNldCArPSA0OwogICAgICAgICAgICAgICAgICAgIGJpbkluZGV4ID0ge307CiAgICAgICAgICAgICAgICAgICAgaiA9IDA7CiAgICAgICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoaiA8IGJpbkNvdW50KSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0MjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBiaW4gPSBieXRlcy5yZWFkVUludDMyTEUoY3Vyck9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgY3Vyck9mZnNldCArPSA0OwogICAgICAgICAgICAgICAgICAgIGlmICghKGJpbiA9PT0gYmluTGltaXQgKyAxKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzMDsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjdXJyT2Zmc2V0ICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgc3RhdHMgPSB0aGlzLnBhcnNlUHNldWRvQmluKGJ5dGVzLCBjdXJyT2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICBjdXJyT2Zmc2V0ICs9IDMyOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoYmluID4gYmluTGltaXQgKyAxKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzNDsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImJhaSBpbmRleCBjb250YWlucyB0b28gbWFueSBiaW5zLCBwbGVhc2UgdXNlIENTSSIpOwogICAgICAgICAgICAgICAgICBjYXNlIDM0OgogICAgICAgICAgICAgICAgICAgIGNodW5rQ291bnQgPSBieXRlcy5yZWFkSW50MzJMRShjdXJyT2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICBjdXJyT2Zmc2V0ICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgY2h1bmtzID0gbmV3IEFycmF5KGNodW5rQ291bnQpOwogICAgICAgICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBjaHVua0NvdW50OyBrICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICAgIHUgPSAoMCwgX3ZpcnR1YWxPZmZzZXQuZnJvbUJ5dGVzKShieXRlcywgY3Vyck9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgICB2ID0gKDAsIF92aXJ0dWFsT2Zmc2V0LmZyb21CeXRlcykoYnl0ZXMsIGN1cnJPZmZzZXQgKyA4KTsKICAgICAgICAgICAgICAgICAgICAgIGN1cnJPZmZzZXQgKz0gMTY7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9maW5kRmlyc3REYXRhKGRhdGEyLCB1KTsKICAgICAgICAgICAgICAgICAgICAgIGNodW5rc1trXSA9IG5ldyBfY2h1bmsuZGVmYXVsdCh1LCB2LCBiaW4pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBiaW5JbmRleFtiaW5dID0gY2h1bmtzOwogICAgICAgICAgICAgICAgICBjYXNlIDM5OgogICAgICAgICAgICAgICAgICAgIGogKz0gMTsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlIDQyOgogICAgICAgICAgICAgICAgICAgIGxpbmVhckNvdW50ID0gYnl0ZXMucmVhZEludDMyTEUoY3Vyck9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgY3Vyck9mZnNldCArPSA0OwogICAgICAgICAgICAgICAgICAgIGxpbmVhckluZGV4ID0gbmV3IEFycmF5KGxpbmVhckNvdW50KTsKICAgICAgICAgICAgICAgICAgICBmb3IgKF9rID0gMDsgX2sgPCBsaW5lYXJDb3VudDsgX2sgKz0gMSkgewogICAgICAgICAgICAgICAgICAgICAgbGluZWFySW5kZXhbX2tdID0gKDAsIF92aXJ0dWFsT2Zmc2V0LmZyb21CeXRlcykoYnl0ZXMsIGN1cnJPZmZzZXQpOwogICAgICAgICAgICAgICAgICAgICAgY3Vyck9mZnNldCArPSA4OwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmluZEZpcnN0RGF0YShkYXRhMiwgbGluZWFySW5kZXhbX2tdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZGF0YTIuaW5kaWNlc1tpMl0gPSB7CiAgICAgICAgICAgICAgICAgICAgICBiaW5JbmRleCwKICAgICAgICAgICAgICAgICAgICAgIGxpbmVhckluZGV4LAogICAgICAgICAgICAgICAgICAgICAgc3RhdHMKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICBjYXNlIDQ3OgogICAgICAgICAgICAgICAgICAgIGkyICs9IDE7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSA1MDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgZGF0YTIpOwogICAgICAgICAgICAgICAgICBjYXNlIDUxOgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gX3BhcnNlKCkgewogICAgICAgICAgICByZXR1cm4gX3BhcnNlMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIF9wYXJzZTsKICAgICAgICB9KCkKICAgICAgfSwgewogICAgICAgIGtleTogImluZGV4Q292IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX2luZGV4Q292ID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKHNlcUlkLCBzdGFydCwgZW5kKSB7CiAgICAgICAgICAgIHZhciBvcHRzLCB2LCByYW5nZSwgaW5kZXhEYXRhLCBzZXFJZHgsIF9zZXFJZHgkbGluZWFySW5kZXgsIGxpbmVhckluZGV4LCBzdGF0cywgZSwgcywgZGVwdGhzLCB0b3RhbFNpemUsIGN1cnJlbnRQb3MsIGkyLCBqLCBfYXJnczMgPSBhcmd1bWVudHM7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IyLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgb3B0cyA9IF9hcmdzMy5sZW5ndGggPiAzICYmIF9hcmdzM1szXSAhPT0gdm9pZCAwID8gX2FyZ3MzWzNdIDoge307CiAgICAgICAgICAgICAgICAgICAgdiA9IDE2Mzg0OwogICAgICAgICAgICAgICAgICAgIHJhbmdlID0gc3RhcnQgIT09IHZvaWQgMDsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2Uob3B0cyk7CiAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICBpbmRleERhdGEgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICAgICAgICBzZXFJZHggPSBpbmRleERhdGEuaW5kaWNlc1tzZXFJZF07CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlcUlkeCkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA5OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBbXSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgICBfc2VxSWR4JGxpbmVhckluZGV4ID0gc2VxSWR4LmxpbmVhckluZGV4LCBsaW5lYXJJbmRleCA9IF9zZXFJZHgkbGluZWFySW5kZXggPT09IHZvaWQgMCA/IFtdIDogX3NlcUlkeCRsaW5lYXJJbmRleCwgc3RhdHMgPSBzZXFJZHguc3RhdHM7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmVhckluZGV4Lmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgW10pOwogICAgICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgICAgIGUgPSBlbmQgIT09IHZvaWQgMCA/IHJvdW5kVXAoZW5kLCB2KSA6IChsaW5lYXJJbmRleC5sZW5ndGggLSAxKSAqIHY7CiAgICAgICAgICAgICAgICAgICAgcyA9IHN0YXJ0ICE9PSB2b2lkIDAgPyByb3VuZERvd24oc3RhcnQsIHYpIDogMDsKICAgICAgICAgICAgICAgICAgICBpZiAocmFuZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgIGRlcHRocyA9IG5ldyBBcnJheSgoZSAtIHMpIC8gdik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGRlcHRocyA9IG5ldyBBcnJheShsaW5lYXJJbmRleC5sZW5ndGggLSAxKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdG90YWxTaXplID0gbGluZWFySW5kZXhbbGluZWFySW5kZXgubGVuZ3RoIC0gMV0uYmxvY2tQb3NpdGlvbjsKICAgICAgICAgICAgICAgICAgICBpZiAoIShlID4gKGxpbmVhckluZGV4Lmxlbmd0aCAtIDEpICogdikpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJxdWVyeSBvdXRzaWRlIG9mIHJhbmdlIG9mIGxpbmVhciBpbmRleCIpOwogICAgICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQb3MgPSBsaW5lYXJJbmRleFtzIC8gdl0uYmxvY2tQb3NpdGlvbjsKICAgICAgICAgICAgICAgICAgICBmb3IgKGkyID0gcyAvIHYsIGogPSAwOyBpMiA8IGUgLyB2OyBpMisrLCBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgIGRlcHRoc1tqXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IGxpbmVhckluZGV4W2kyICsgMV0uYmxvY2tQb3NpdGlvbiAtIGN1cnJlbnRQb3MsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBpMiAqIHYsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogaTIgKiB2ICsgdgogICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQb3MgPSBsaW5lYXJJbmRleFtpMiArIDFdLmJsb2NrUG9zaXRpb247CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCAoMCwgX21hcC5kZWZhdWx0KShkZXB0aHMpLmNhbGwoZGVwdGhzLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZDIoX29iamVjdFNwcmVhZDIoe30sIGQpLCB7fSwgewogICAgICAgICAgICAgICAgICAgICAgICBzY29yZTogZC5zY29yZSAqIHN0YXRzLmxpbmVDb3VudCAvIHRvdGFsU2l6ZQogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gaW5kZXhDb3YoX3gyLCBfeDMsIF94NCkgewogICAgICAgICAgICByZXR1cm4gX2luZGV4Q292LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaW5kZXhDb3Y7CiAgICAgICAgfSgpCiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJyZWcyYmlucyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlZzJiaW5zKGJlZywgZW5kKSB7CiAgICAgICAgICBlbmQgLT0gMTsKICAgICAgICAgIHJldHVybiBbWzAsIDBdLCBbMSArIChiZWcgPj4gMjYpLCAxICsgKGVuZCA+PiAyNildLCBbOSArIChiZWcgPj4gMjMpLCA5ICsgKGVuZCA+PiAyMyldLCBbNzMgKyAoYmVnID4+IDIwKSwgNzMgKyAoZW5kID4+IDIwKV0sIFs1ODUgKyAoYmVnID4+IDE3KSwgNTg1ICsgKGVuZCA+PiAxNyldLCBbNDY4MSArIChiZWcgPj4gMTQpLCA0NjgxICsgKGVuZCA+PiAxNCldXTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJibG9ja3NGb3JSYW5nZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF9ibG9ja3NGb3JSYW5nZSA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlNChyZWZJZCwgbWluMiwgbWF4MikgewogICAgICAgICAgICB2YXIgb3B0cywgaW5kZXhEYXRhLCBiYSwgb3ZlcmxhcHBpbmdCaW5zLCBjaHVua3MsIF9pdGVyYXRvciwgX3N0ZXAsIF9zdGVwJHZhbHVlLCBzdGFydCwgZW5kLCBiaW4sIGJpbkNodW5rcywgYzIsIG5pbnR2LCBsb3dlc3QsIG1pbkxpbiwgbWF4TGluLCBpMiwgdnAsIF9hcmdzNCA9IGFyZ3VtZW50czsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBvcHRzID0gX2FyZ3M0Lmxlbmd0aCA+IDMgJiYgX2FyZ3M0WzNdICE9PSB2b2lkIDAgPyBfYXJnczRbM10gOiB7fTsKICAgICAgICAgICAgICAgICAgICBpZiAobWluMiA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgIG1pbjIgPSAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2Uob3B0cyk7CiAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICBpbmRleERhdGEgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXhEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIFtdKTsKICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgIGJhID0gaW5kZXhEYXRhLmluZGljZXNbcmVmSWRdOwogICAgICAgICAgICAgICAgICAgIGlmIChiYSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMDsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgW10pOwogICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgIG92ZXJsYXBwaW5nQmlucyA9IHRoaXMucmVnMmJpbnMobWluMiwgbWF4Mik7CiAgICAgICAgICAgICAgICAgICAgY2h1bmtzID0gW107CiAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIob3ZlcmxhcHBpbmdCaW5zKTsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTsgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9zdGVwJHZhbHVlID0gKDAsIF9zbGljZWRUb0FycmF5MjIuZGVmYXVsdCkoX3N0ZXAudmFsdWUsIDIpLCBzdGFydCA9IF9zdGVwJHZhbHVlWzBdLCBlbmQgPSBfc3RlcCR2YWx1ZVsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChiaW4gPSBzdGFydDsgYmluIDw9IGVuZDsgYmluKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmEuYmluSW5kZXhbYmluXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluQ2h1bmtzID0gYmEuYmluSW5kZXhbYmluXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYzIgPSAwOyBjMiA8IGJpbkNodW5rcy5sZW5ndGg7ICsrYzIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtzLnB1c2gobmV3IF9jaHVuay5kZWZhdWx0KGJpbkNodW5rc1tjMl0ubWludiwgYmluQ2h1bmtzW2MyXS5tYXh2LCBiaW4pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIyKSB7CiAgICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3IuZShlcnIyKTsKICAgICAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbmludHYgPSBiYS5saW5lYXJJbmRleC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgbG93ZXN0ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBtaW5MaW4gPSBNYXRoLm1pbihtaW4yID4+IDE0LCBuaW50diAtIDEpOwogICAgICAgICAgICAgICAgICAgIG1heExpbiA9IE1hdGgubWluKG1heDIgPj4gMTQsIG5pbnR2IC0gMSk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpMiA9IG1pbkxpbjsgaTIgPD0gbWF4TGluOyArK2kyKSB7CiAgICAgICAgICAgICAgICAgICAgICB2cCA9IGJhLmxpbmVhckluZGV4W2kyXTsKICAgICAgICAgICAgICAgICAgICAgIGlmICh2cCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWxvd2VzdCB8fCB2cC5jb21wYXJlVG8obG93ZXN0KSA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBsb3dlc3QgPSB2cDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgKDAsIF91dGlsLm9wdGltaXplQ2h1bmtzKShjaHVua3MsIGxvd2VzdCkpOwogICAgICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTQsIHRoaXMpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gYmxvY2tzRm9yUmFuZ2UoX3g1LCBfeDYsIF94NykgewogICAgICAgICAgICByZXR1cm4gX2Jsb2Nrc0ZvclJhbmdlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYmxvY2tzRm9yUmFuZ2U7CiAgICAgICAgfSgpCiAgICAgIH1dKTsKICAgICAgcmV0dXJuIEJBSTI7CiAgICB9KF9pbmRleEZpbGUuZGVmYXVsdCk7CiAgICBleHBvcnRzLmRlZmF1bHQgPSBCQUk7CiAgfSkoYmFpKTsKICB2YXIgY3NpID0ge307CiAgdmFyIGludGVyb3BSZXF1aXJlV2lsZGNhcmQgPSB7IGV4cG9ydHM6IHt9IH07CiAgdmFyIGludGVybmFsTWV0YWRhdGEgPSB7IGV4cG9ydHM6IHt9IH07CiAgdmFyIGZhaWxzJDMgPSBmYWlscyRuOwogIHZhciBmcmVlemluZyA9ICFmYWlscyQzKGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIE9iamVjdC5pc0V4dGVuc2libGUoT2JqZWN0LnByZXZlbnRFeHRlbnNpb25zKHt9KSk7CiAgfSk7CiAgdmFyICQkZCA9IF9leHBvcnQ7CiAgdmFyIGhpZGRlbktleXMgPSBoaWRkZW5LZXlzJDY7CiAgdmFyIGlzT2JqZWN0JDQgPSBpc09iamVjdCRpOwogIHZhciBoYXMkMSA9IGhhcyRjOwogIHZhciBkZWZpbmVQcm9wZXJ0eSQyID0gb2JqZWN0RGVmaW5lUHJvcGVydHkuZjsKICB2YXIgZ2V0T3duUHJvcGVydHlOYW1lc01vZHVsZSA9IG9iamVjdEdldE93blByb3BlcnR5TmFtZXM7CiAgdmFyIGdldE93blByb3BlcnR5TmFtZXNFeHRlcm5hbE1vZHVsZSA9IG9iamVjdEdldE93blByb3BlcnR5TmFtZXNFeHRlcm5hbDsKICB2YXIgdWlkID0gdWlkJDQ7CiAgdmFyIEZSRUVaSU5HID0gZnJlZXppbmc7CiAgdmFyIFJFUVVJUkVEID0gZmFsc2U7CiAgdmFyIE1FVEFEQVRBID0gdWlkKCJtZXRhIik7CiAgdmFyIGlkJDEgPSAwOwogIHZhciBpc0V4dGVuc2libGUkMSA9IE9iamVjdC5pc0V4dGVuc2libGUgfHwgZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9OwogIHZhciBzZXRNZXRhZGF0YSA9IGZ1bmN0aW9uKGl0KSB7CiAgICBkZWZpbmVQcm9wZXJ0eSQyKGl0LCBNRVRBREFUQSwgeyB2YWx1ZTogewogICAgICBvYmplY3RJRDogIk8iICsgaWQkMSsrLAogICAgICB3ZWFrRGF0YToge30KICAgIH0gfSk7CiAgfTsKICB2YXIgZmFzdEtleSA9IGZ1bmN0aW9uKGl0LCBjcmVhdGUyKSB7CiAgICBpZiAoIWlzT2JqZWN0JDQoaXQpKQogICAgICByZXR1cm4gdHlwZW9mIGl0ID09ICJzeW1ib2wiID8gaXQgOiAodHlwZW9mIGl0ID09ICJzdHJpbmciID8gIlMiIDogIlAiKSArIGl0OwogICAgaWYgKCFoYXMkMShpdCwgTUVUQURBVEEpKSB7CiAgICAgIGlmICghaXNFeHRlbnNpYmxlJDEoaXQpKQogICAgICAgIHJldHVybiAiRiI7CiAgICAgIGlmICghY3JlYXRlMikKICAgICAgICByZXR1cm4gIkUiOwogICAgICBzZXRNZXRhZGF0YShpdCk7CiAgICB9CiAgICByZXR1cm4gaXRbTUVUQURBVEFdLm9iamVjdElEOwogIH07CiAgdmFyIGdldFdlYWtEYXRhJDEgPSBmdW5jdGlvbihpdCwgY3JlYXRlMikgewogICAgaWYgKCFoYXMkMShpdCwgTUVUQURBVEEpKSB7CiAgICAgIGlmICghaXNFeHRlbnNpYmxlJDEoaXQpKQogICAgICAgIHJldHVybiB0cnVlOwogICAgICBpZiAoIWNyZWF0ZTIpCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICBzZXRNZXRhZGF0YShpdCk7CiAgICB9CiAgICByZXR1cm4gaXRbTUVUQURBVEFdLndlYWtEYXRhOwogIH07CiAgdmFyIG9uRnJlZXplID0gZnVuY3Rpb24oaXQpIHsKICAgIGlmIChGUkVFWklORyAmJiBSRVFVSVJFRCAmJiBpc0V4dGVuc2libGUkMShpdCkgJiYgIWhhcyQxKGl0LCBNRVRBREFUQSkpCiAgICAgIHNldE1ldGFkYXRhKGl0KTsKICAgIHJldHVybiBpdDsKICB9OwogIHZhciBlbmFibGUgPSBmdW5jdGlvbigpIHsKICAgIG1ldGEuZW5hYmxlID0gZnVuY3Rpb24oKSB7CiAgICB9OwogICAgUkVRVUlSRUQgPSB0cnVlOwogICAgdmFyIGdldE93blByb3BlcnR5TmFtZXMgPSBnZXRPd25Qcm9wZXJ0eU5hbWVzTW9kdWxlLmY7CiAgICB2YXIgc3BsaWNlID0gW10uc3BsaWNlOwogICAgdmFyIHRlc3QyID0ge307CiAgICB0ZXN0MltNRVRBREFUQV0gPSAxOwogICAgaWYgKGdldE93blByb3BlcnR5TmFtZXModGVzdDIpLmxlbmd0aCkgewogICAgICBnZXRPd25Qcm9wZXJ0eU5hbWVzTW9kdWxlLmYgPSBmdW5jdGlvbihpdCkgewogICAgICAgIHZhciByZXN1bHQgPSBnZXRPd25Qcm9wZXJ0eU5hbWVzKGl0KTsKICAgICAgICBmb3IgKHZhciBpMiA9IDAsIGxlbmd0aCA9IHJlc3VsdC5sZW5ndGg7IGkyIDwgbGVuZ3RoOyBpMisrKSB7CiAgICAgICAgICBpZiAocmVzdWx0W2kyXSA9PT0gTUVUQURBVEEpIHsKICAgICAgICAgICAgc3BsaWNlLmNhbGwocmVzdWx0LCBpMiwgMSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICAkJGQoeyB0YXJnZXQ6ICJPYmplY3QiLCBzdGF0OiB0cnVlLCBmb3JjZWQ6IHRydWUgfSwgewogICAgICAgIGdldE93blByb3BlcnR5TmFtZXM6IGdldE93blByb3BlcnR5TmFtZXNFeHRlcm5hbE1vZHVsZS5mCiAgICAgIH0pOwogICAgfQogIH07CiAgdmFyIG1ldGEgPSBpbnRlcm5hbE1ldGFkYXRhLmV4cG9ydHMgPSB7CiAgICBlbmFibGUsCiAgICBmYXN0S2V5LAogICAgZ2V0V2Vha0RhdGE6IGdldFdlYWtEYXRhJDEsCiAgICBvbkZyZWV6ZQogIH07CiAgaGlkZGVuS2V5c1tNRVRBREFUQV0gPSB0cnVlOwogIHZhciAkJGMgPSBfZXhwb3J0OwogIHZhciBnbG9iYWwkMyA9IGdsb2JhbCRvOwogIHZhciBJbnRlcm5hbE1ldGFkYXRhTW9kdWxlJDEgPSBpbnRlcm5hbE1ldGFkYXRhLmV4cG9ydHM7CiAgdmFyIGZhaWxzJDIgPSBmYWlscyRuOwogIHZhciBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkgPSBjcmVhdGVOb25FbnVtZXJhYmxlUHJvcGVydHkkNzsKICB2YXIgaXRlcmF0ZSQyID0gaXRlcmF0ZSQ3OwogIHZhciBhbkluc3RhbmNlJDEgPSBhbkluc3RhbmNlJDM7CiAgdmFyIGlzQ2FsbGFibGUkMSA9IGlzQ2FsbGFibGUkbDsKICB2YXIgaXNPYmplY3QkMyA9IGlzT2JqZWN0JGk7CiAgdmFyIHNldFRvU3RyaW5nVGFnID0gc2V0VG9TdHJpbmdUYWckNjsKICB2YXIgZGVmaW5lUHJvcGVydHkkMSA9IG9iamVjdERlZmluZVByb3BlcnR5LmY7CiAgdmFyIGZvckVhY2ggPSBhcnJheUl0ZXJhdGlvbi5mb3JFYWNoOwogIHZhciBERVNDUklQVE9SUyQxID0gZGVzY3JpcHRvcnM7CiAgdmFyIEludGVybmFsU3RhdGVNb2R1bGUkMSA9IGludGVybmFsU3RhdGU7CiAgdmFyIHNldEludGVybmFsU3RhdGUkMSA9IEludGVybmFsU3RhdGVNb2R1bGUkMS5zZXQ7CiAgdmFyIGludGVybmFsU3RhdGVHZXR0ZXJGb3IkMSA9IEludGVybmFsU3RhdGVNb2R1bGUkMS5nZXR0ZXJGb3I7CiAgdmFyIGNvbGxlY3Rpb24kMSA9IGZ1bmN0aW9uKENPTlNUUlVDVE9SX05BTUUsIHdyYXBwZXIyLCBjb21tb24yKSB7CiAgICB2YXIgSVNfTUFQID0gQ09OU1RSVUNUT1JfTkFNRS5pbmRleE9mKCJNYXAiKSAhPT0gLTE7CiAgICB2YXIgSVNfV0VBSyA9IENPTlNUUlVDVE9SX05BTUUuaW5kZXhPZigiV2VhayIpICE9PSAtMTsKICAgIHZhciBBRERFUiA9IElTX01BUCA/ICJzZXQiIDogImFkZCI7CiAgICB2YXIgTmF0aXZlQ29uc3RydWN0b3IgPSBnbG9iYWwkM1tDT05TVFJVQ1RPUl9OQU1FXTsKICAgIHZhciBOYXRpdmVQcm90b3R5cGUgPSBOYXRpdmVDb25zdHJ1Y3RvciAmJiBOYXRpdmVDb25zdHJ1Y3Rvci5wcm90b3R5cGU7CiAgICB2YXIgZXhwb3J0ZWQgPSB7fTsKICAgIHZhciBDb25zdHJ1Y3RvcjsKICAgIGlmICghREVTQ1JJUFRPUlMkMSB8fCAhaXNDYWxsYWJsZSQxKE5hdGl2ZUNvbnN0cnVjdG9yKSB8fCAhKElTX1dFQUsgfHwgTmF0aXZlUHJvdG90eXBlLmZvckVhY2ggJiYgIWZhaWxzJDIoZnVuY3Rpb24oKSB7CiAgICAgIG5ldyBOYXRpdmVDb25zdHJ1Y3RvcigpLmVudHJpZXMoKS5uZXh0KCk7CiAgICB9KSkpIHsKICAgICAgQ29uc3RydWN0b3IgPSBjb21tb24yLmdldENvbnN0cnVjdG9yKHdyYXBwZXIyLCBDT05TVFJVQ1RPUl9OQU1FLCBJU19NQVAsIEFEREVSKTsKICAgICAgSW50ZXJuYWxNZXRhZGF0YU1vZHVsZSQxLmVuYWJsZSgpOwogICAgfSBlbHNlIHsKICAgICAgQ29uc3RydWN0b3IgPSB3cmFwcGVyMihmdW5jdGlvbih0YXJnZXQsIGl0ZXJhYmxlKSB7CiAgICAgICAgc2V0SW50ZXJuYWxTdGF0ZSQxKGFuSW5zdGFuY2UkMSh0YXJnZXQsIENvbnN0cnVjdG9yLCBDT05TVFJVQ1RPUl9OQU1FKSwgewogICAgICAgICAgdHlwZTogQ09OU1RSVUNUT1JfTkFNRSwKICAgICAgICAgIGNvbGxlY3Rpb246IG5ldyBOYXRpdmVDb25zdHJ1Y3RvcigpCiAgICAgICAgfSk7CiAgICAgICAgaWYgKGl0ZXJhYmxlICE9IHZvaWQgMCkKICAgICAgICAgIGl0ZXJhdGUkMihpdGVyYWJsZSwgdGFyZ2V0W0FEREVSXSwgeyB0aGF0OiB0YXJnZXQsIEFTX0VOVFJJRVM6IElTX01BUCB9KTsKICAgICAgfSk7CiAgICAgIHZhciBnZXRJbnRlcm5hbFN0YXRlMiA9IGludGVybmFsU3RhdGVHZXR0ZXJGb3IkMShDT05TVFJVQ1RPUl9OQU1FKTsKICAgICAgZm9yRWFjaChbImFkZCIsICJjbGVhciIsICJkZWxldGUiLCAiZm9yRWFjaCIsICJnZXQiLCAiaGFzIiwgInNldCIsICJrZXlzIiwgInZhbHVlcyIsICJlbnRyaWVzIl0sIGZ1bmN0aW9uKEtFWSkgewogICAgICAgIHZhciBJU19BRERFUiA9IEtFWSA9PSAiYWRkIiB8fCBLRVkgPT0gInNldCI7CiAgICAgICAgaWYgKEtFWSBpbiBOYXRpdmVQcm90b3R5cGUgJiYgIShJU19XRUFLICYmIEtFWSA9PSAiY2xlYXIiKSkgewogICAgICAgICAgY3JlYXRlTm9uRW51bWVyYWJsZVByb3BlcnR5KENvbnN0cnVjdG9yLnByb3RvdHlwZSwgS0VZLCBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgIHZhciBjb2xsZWN0aW9uMiA9IGdldEludGVybmFsU3RhdGUyKHRoaXMpLmNvbGxlY3Rpb247CiAgICAgICAgICAgIGlmICghSVNfQURERVIgJiYgSVNfV0VBSyAmJiAhaXNPYmplY3QkMyhhKSkKICAgICAgICAgICAgICByZXR1cm4gS0VZID09ICJnZXQiID8gdm9pZCAwIDogZmFsc2U7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBjb2xsZWN0aW9uMltLRVldKGEgPT09IDAgPyAwIDogYSwgYik7CiAgICAgICAgICAgIHJldHVybiBJU19BRERFUiA/IHRoaXMgOiByZXN1bHQ7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBJU19XRUFLIHx8IGRlZmluZVByb3BlcnR5JDEoQ29uc3RydWN0b3IucHJvdG90eXBlLCAic2l6ZSIsIHsKICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBnZXRJbnRlcm5hbFN0YXRlMih0aGlzKS5jb2xsZWN0aW9uLnNpemU7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIHNldFRvU3RyaW5nVGFnKENvbnN0cnVjdG9yLCBDT05TVFJVQ1RPUl9OQU1FLCBmYWxzZSwgdHJ1ZSk7CiAgICBleHBvcnRlZFtDT05TVFJVQ1RPUl9OQU1FXSA9IENvbnN0cnVjdG9yOwogICAgJCRjKHsgZ2xvYmFsOiB0cnVlLCBmb3JjZWQ6IHRydWUgfSwgZXhwb3J0ZWQpOwogICAgaWYgKCFJU19XRUFLKQogICAgICBjb21tb24yLnNldFN0cm9uZyhDb25zdHJ1Y3RvciwgQ09OU1RSVUNUT1JfTkFNRSwgSVNfTUFQKTsKICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICB9OwogIHZhciByZWRlZmluZUFsbCQxID0gcmVkZWZpbmVBbGwkMzsKICB2YXIgZ2V0V2Vha0RhdGEgPSBpbnRlcm5hbE1ldGFkYXRhLmV4cG9ydHMuZ2V0V2Vha0RhdGE7CiAgdmFyIGFuT2JqZWN0JDQgPSBhbk9iamVjdCRpOwogIHZhciBpc09iamVjdCQyID0gaXNPYmplY3QkaTsKICB2YXIgYW5JbnN0YW5jZSA9IGFuSW5zdGFuY2UkMzsKICB2YXIgaXRlcmF0ZSQxID0gaXRlcmF0ZSQ3OwogIHZhciBBcnJheUl0ZXJhdGlvbk1vZHVsZSA9IGFycmF5SXRlcmF0aW9uOwogIHZhciAkaGFzID0gaGFzJGM7CiAgdmFyIEludGVybmFsU3RhdGVNb2R1bGUgPSBpbnRlcm5hbFN0YXRlOwogIHZhciBzZXRJbnRlcm5hbFN0YXRlID0gSW50ZXJuYWxTdGF0ZU1vZHVsZS5zZXQ7CiAgdmFyIGludGVybmFsU3RhdGVHZXR0ZXJGb3IgPSBJbnRlcm5hbFN0YXRlTW9kdWxlLmdldHRlckZvcjsKICB2YXIgZmluZCA9IEFycmF5SXRlcmF0aW9uTW9kdWxlLmZpbmQ7CiAgdmFyIGZpbmRJbmRleCA9IEFycmF5SXRlcmF0aW9uTW9kdWxlLmZpbmRJbmRleDsKICB2YXIgaWQgPSAwOwogIHZhciB1bmNhdWdodEZyb3plblN0b3JlID0gZnVuY3Rpb24oc3RvcmUyKSB7CiAgICByZXR1cm4gc3RvcmUyLmZyb3plbiB8fCAoc3RvcmUyLmZyb3plbiA9IG5ldyBVbmNhdWdodEZyb3plblN0b3JlKCkpOwogIH07CiAgdmFyIFVuY2F1Z2h0RnJvemVuU3RvcmUgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMuZW50cmllcyA9IFtdOwogIH07CiAgdmFyIGZpbmRVbmNhdWdodEZyb3plbiA9IGZ1bmN0aW9uKHN0b3JlMiwga2V5KSB7CiAgICByZXR1cm4gZmluZChzdG9yZTIuZW50cmllcywgZnVuY3Rpb24oaXQpIHsKICAgICAgcmV0dXJuIGl0WzBdID09PSBrZXk7CiAgICB9KTsKICB9OwogIFVuY2F1Z2h0RnJvemVuU3RvcmUucHJvdG90eXBlID0gewogICAgZ2V0OiBmdW5jdGlvbihrZXkpIHsKICAgICAgdmFyIGVudHJ5ID0gZmluZFVuY2F1Z2h0RnJvemVuKHRoaXMsIGtleSk7CiAgICAgIGlmIChlbnRyeSkKICAgICAgICByZXR1cm4gZW50cnlbMV07CiAgICB9LAogICAgaGFzOiBmdW5jdGlvbihrZXkpIHsKICAgICAgcmV0dXJuICEhZmluZFVuY2F1Z2h0RnJvemVuKHRoaXMsIGtleSk7CiAgICB9LAogICAgc2V0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7CiAgICAgIHZhciBlbnRyeSA9IGZpbmRVbmNhdWdodEZyb3plbih0aGlzLCBrZXkpOwogICAgICBpZiAoZW50cnkpCiAgICAgICAgZW50cnlbMV0gPSB2YWx1ZTsKICAgICAgZWxzZQogICAgICAgIHRoaXMuZW50cmllcy5wdXNoKFtrZXksIHZhbHVlXSk7CiAgICB9LAogICAgImRlbGV0ZSI6IGZ1bmN0aW9uKGtleSkgewogICAgICB2YXIgaW5kZXggPSBmaW5kSW5kZXgodGhpcy5lbnRyaWVzLCBmdW5jdGlvbihpdCkgewogICAgICAgIHJldHVybiBpdFswXSA9PT0ga2V5OwogICAgICB9KTsKICAgICAgaWYgKH5pbmRleCkKICAgICAgICB0aGlzLmVudHJpZXMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgcmV0dXJuICEhfmluZGV4OwogICAgfQogIH07CiAgdmFyIGNvbGxlY3Rpb25XZWFrJDEgPSB7CiAgICBnZXRDb25zdHJ1Y3RvcjogZnVuY3Rpb24od3JhcHBlcjIsIENPTlNUUlVDVE9SX05BTUUsIElTX01BUCwgQURERVIpIHsKICAgICAgdmFyIEMgPSB3cmFwcGVyMihmdW5jdGlvbih0aGF0LCBpdGVyYWJsZSkgewogICAgICAgIGFuSW5zdGFuY2UodGhhdCwgQywgQ09OU1RSVUNUT1JfTkFNRSk7CiAgICAgICAgc2V0SW50ZXJuYWxTdGF0ZSh0aGF0LCB7CiAgICAgICAgICB0eXBlOiBDT05TVFJVQ1RPUl9OQU1FLAogICAgICAgICAgaWQ6IGlkKyssCiAgICAgICAgICBmcm96ZW46IHZvaWQgMAogICAgICAgIH0pOwogICAgICAgIGlmIChpdGVyYWJsZSAhPSB2b2lkIDApCiAgICAgICAgICBpdGVyYXRlJDEoaXRlcmFibGUsIHRoYXRbQURERVJdLCB7IHRoYXQsIEFTX0VOVFJJRVM6IElTX01BUCB9KTsKICAgICAgfSk7CiAgICAgIHZhciBnZXRJbnRlcm5hbFN0YXRlMiA9IGludGVybmFsU3RhdGVHZXR0ZXJGb3IoQ09OU1RSVUNUT1JfTkFNRSk7CiAgICAgIHZhciBkZWZpbmUgPSBmdW5jdGlvbih0aGF0LCBrZXksIHZhbHVlKSB7CiAgICAgICAgdmFyIHN0YXRlID0gZ2V0SW50ZXJuYWxTdGF0ZTIodGhhdCk7CiAgICAgICAgdmFyIGRhdGEyID0gZ2V0V2Vha0RhdGEoYW5PYmplY3QkNChrZXkpLCB0cnVlKTsKICAgICAgICBpZiAoZGF0YTIgPT09IHRydWUpCiAgICAgICAgICB1bmNhdWdodEZyb3plblN0b3JlKHN0YXRlKS5zZXQoa2V5LCB2YWx1ZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgZGF0YTJbc3RhdGUuaWRdID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRoYXQ7CiAgICAgIH07CiAgICAgIHJlZGVmaW5lQWxsJDEoQy5wcm90b3R5cGUsIHsKICAgICAgICAiZGVsZXRlIjogZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlMih0aGlzKTsKICAgICAgICAgIGlmICghaXNPYmplY3QkMihrZXkpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB2YXIgZGF0YTIgPSBnZXRXZWFrRGF0YShrZXkpOwogICAgICAgICAgaWYgKGRhdGEyID09PSB0cnVlKQogICAgICAgICAgICByZXR1cm4gdW5jYXVnaHRGcm96ZW5TdG9yZShzdGF0ZSlbImRlbGV0ZSJdKGtleSk7CiAgICAgICAgICByZXR1cm4gZGF0YTIgJiYgJGhhcyhkYXRhMiwgc3RhdGUuaWQpICYmIGRlbGV0ZSBkYXRhMltzdGF0ZS5pZF07CiAgICAgICAgfSwKICAgICAgICBoYXM6IGZ1bmN0aW9uIGhhczIoa2V5KSB7CiAgICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlMih0aGlzKTsKICAgICAgICAgIGlmICghaXNPYmplY3QkMihrZXkpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB2YXIgZGF0YTIgPSBnZXRXZWFrRGF0YShrZXkpOwogICAgICAgICAgaWYgKGRhdGEyID09PSB0cnVlKQogICAgICAgICAgICByZXR1cm4gdW5jYXVnaHRGcm96ZW5TdG9yZShzdGF0ZSkuaGFzKGtleSk7CiAgICAgICAgICByZXR1cm4gZGF0YTIgJiYgJGhhcyhkYXRhMiwgc3RhdGUuaWQpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJlZGVmaW5lQWxsJDEoQy5wcm90b3R5cGUsIElTX01BUCA/IHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldDIoa2V5KSB7CiAgICAgICAgICB2YXIgc3RhdGUgPSBnZXRJbnRlcm5hbFN0YXRlMih0aGlzKTsKICAgICAgICAgIGlmIChpc09iamVjdCQyKGtleSkpIHsKICAgICAgICAgICAgdmFyIGRhdGEyID0gZ2V0V2Vha0RhdGEoa2V5KTsKICAgICAgICAgICAgaWYgKGRhdGEyID09PSB0cnVlKQogICAgICAgICAgICAgIHJldHVybiB1bmNhdWdodEZyb3plblN0b3JlKHN0YXRlKS5nZXQoa2V5KTsKICAgICAgICAgICAgcmV0dXJuIGRhdGEyID8gZGF0YTJbc3RhdGUuaWRdIDogdm9pZCAwOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQyKGtleSwgdmFsdWUpIHsKICAgICAgICAgIHJldHVybiBkZWZpbmUodGhpcywga2V5LCB2YWx1ZSk7CiAgICAgICAgfQogICAgICB9IDogewogICAgICAgIGFkZDogZnVuY3Rpb24gYWRkKHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gZGVmaW5lKHRoaXMsIHZhbHVlLCB0cnVlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gQzsKICAgIH0KICB9OwogIHZhciBnbG9iYWwkMiA9IGdsb2JhbCRvOwogIHZhciByZWRlZmluZUFsbCA9IHJlZGVmaW5lQWxsJDM7CiAgdmFyIEludGVybmFsTWV0YWRhdGFNb2R1bGUgPSBpbnRlcm5hbE1ldGFkYXRhLmV4cG9ydHM7CiAgdmFyIGNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uJDE7CiAgdmFyIGNvbGxlY3Rpb25XZWFrID0gY29sbGVjdGlvbldlYWskMTsKICB2YXIgaXNPYmplY3QkMSA9IGlzT2JqZWN0JGk7CiAgdmFyIGVuZm9yY2VJdGVybmFsU3RhdGUgPSBpbnRlcm5hbFN0YXRlLmVuZm9yY2U7CiAgdmFyIE5BVElWRV9XRUFLX01BUCA9IG5hdGl2ZVdlYWtNYXA7CiAgdmFyIElTX0lFMTEgPSAhZ2xvYmFsJDIuQWN0aXZlWE9iamVjdCAmJiAiQWN0aXZlWE9iamVjdCIgaW4gZ2xvYmFsJDI7CiAgdmFyIGlzRXh0ZW5zaWJsZSA9IE9iamVjdC5pc0V4dGVuc2libGU7CiAgdmFyIEludGVybmFsV2Vha01hcDsKICB2YXIgd3JhcHBlciA9IGZ1bmN0aW9uKGluaXQyKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gV2Vha01hcDIoKSB7CiAgICAgIHJldHVybiBpbml0Mih0aGlzLCBhcmd1bWVudHMubGVuZ3RoID8gYXJndW1lbnRzWzBdIDogdm9pZCAwKTsKICAgIH07CiAgfTsKICB2YXIgJFdlYWtNYXAgPSBjb2xsZWN0aW9uKCJXZWFrTWFwIiwgd3JhcHBlciwgY29sbGVjdGlvbldlYWspOwogIGlmIChOQVRJVkVfV0VBS19NQVAgJiYgSVNfSUUxMSkgewogICAgSW50ZXJuYWxXZWFrTWFwID0gY29sbGVjdGlvbldlYWsuZ2V0Q29uc3RydWN0b3Iod3JhcHBlciwgIldlYWtNYXAiLCB0cnVlKTsKICAgIEludGVybmFsTWV0YWRhdGFNb2R1bGUuZW5hYmxlKCk7CiAgICB2YXIgV2Vha01hcFByb3RvdHlwZSA9ICRXZWFrTWFwLnByb3RvdHlwZTsKICAgIHZhciBuYXRpdmVEZWxldGUgPSBXZWFrTWFwUHJvdG90eXBlWyJkZWxldGUiXTsKICAgIHZhciBuYXRpdmVIYXMgPSBXZWFrTWFwUHJvdG90eXBlLmhhczsKICAgIHZhciBuYXRpdmVHZXQgPSBXZWFrTWFwUHJvdG90eXBlLmdldDsKICAgIHZhciBuYXRpdmVTZXQgPSBXZWFrTWFwUHJvdG90eXBlLnNldDsKICAgIHJlZGVmaW5lQWxsKFdlYWtNYXBQcm90b3R5cGUsIHsKICAgICAgImRlbGV0ZSI6IGZ1bmN0aW9uKGtleSkgewogICAgICAgIGlmIChpc09iamVjdCQxKGtleSkgJiYgIWlzRXh0ZW5zaWJsZShrZXkpKSB7CiAgICAgICAgICB2YXIgc3RhdGUgPSBlbmZvcmNlSXRlcm5hbFN0YXRlKHRoaXMpOwogICAgICAgICAgaWYgKCFzdGF0ZS5mcm96ZW4pCiAgICAgICAgICAgIHN0YXRlLmZyb3plbiA9IG5ldyBJbnRlcm5hbFdlYWtNYXAoKTsKICAgICAgICAgIHJldHVybiBuYXRpdmVEZWxldGUuY2FsbCh0aGlzLCBrZXkpIHx8IHN0YXRlLmZyb3plblsiZGVsZXRlIl0oa2V5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5hdGl2ZURlbGV0ZS5jYWxsKHRoaXMsIGtleSk7CiAgICAgIH0sCiAgICAgIGhhczogZnVuY3Rpb24gaGFzMihrZXkpIHsKICAgICAgICBpZiAoaXNPYmplY3QkMShrZXkpICYmICFpc0V4dGVuc2libGUoa2V5KSkgewogICAgICAgICAgdmFyIHN0YXRlID0gZW5mb3JjZUl0ZXJuYWxTdGF0ZSh0aGlzKTsKICAgICAgICAgIGlmICghc3RhdGUuZnJvemVuKQogICAgICAgICAgICBzdGF0ZS5mcm96ZW4gPSBuZXcgSW50ZXJuYWxXZWFrTWFwKCk7CiAgICAgICAgICByZXR1cm4gbmF0aXZlSGFzLmNhbGwodGhpcywga2V5KSB8fCBzdGF0ZS5mcm96ZW4uaGFzKGtleSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuYXRpdmVIYXMuY2FsbCh0aGlzLCBrZXkpOwogICAgICB9LAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldDIoa2V5KSB7CiAgICAgICAgaWYgKGlzT2JqZWN0JDEoa2V5KSAmJiAhaXNFeHRlbnNpYmxlKGtleSkpIHsKICAgICAgICAgIHZhciBzdGF0ZSA9IGVuZm9yY2VJdGVybmFsU3RhdGUodGhpcyk7CiAgICAgICAgICBpZiAoIXN0YXRlLmZyb3plbikKICAgICAgICAgICAgc3RhdGUuZnJvemVuID0gbmV3IEludGVybmFsV2Vha01hcCgpOwogICAgICAgICAgcmV0dXJuIG5hdGl2ZUhhcy5jYWxsKHRoaXMsIGtleSkgPyBuYXRpdmVHZXQuY2FsbCh0aGlzLCBrZXkpIDogc3RhdGUuZnJvemVuLmdldChrZXkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmF0aXZlR2V0LmNhbGwodGhpcywga2V5KTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQyKGtleSwgdmFsdWUpIHsKICAgICAgICBpZiAoaXNPYmplY3QkMShrZXkpICYmICFpc0V4dGVuc2libGUoa2V5KSkgewogICAgICAgICAgdmFyIHN0YXRlID0gZW5mb3JjZUl0ZXJuYWxTdGF0ZSh0aGlzKTsKICAgICAgICAgIGlmICghc3RhdGUuZnJvemVuKQogICAgICAgICAgICBzdGF0ZS5mcm96ZW4gPSBuZXcgSW50ZXJuYWxXZWFrTWFwKCk7CiAgICAgICAgICBuYXRpdmVIYXMuY2FsbCh0aGlzLCBrZXkpID8gbmF0aXZlU2V0LmNhbGwodGhpcywga2V5LCB2YWx1ZSkgOiBzdGF0ZS5mcm96ZW4uc2V0KGtleSwgdmFsdWUpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgbmF0aXZlU2V0LmNhbGwodGhpcywga2V5LCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgIH0pOwogIH0KICB2YXIgcGF0aCQzID0gcGF0aCRuOwogIHZhciB3ZWFrTWFwJDMgPSBwYXRoJDMuV2Vha01hcDsKICB2YXIgcGFyZW50JGYgPSB3ZWFrTWFwJDM7CiAgdmFyIHdlYWtNYXAkMiA9IHBhcmVudCRmOwogIHZhciBhbk9iamVjdCQzID0gYW5PYmplY3QkaTsKICB2YXIgbWFwRW1wbGFjZSA9IGZ1bmN0aW9uIGVtcGxhY2Uoa2V5LCBoYW5kbGVyKSB7CiAgICB2YXIgbWFwMiA9IGFuT2JqZWN0JDModGhpcyk7CiAgICB2YXIgdmFsdWUgPSBtYXAyLmhhcyhrZXkpICYmICJ1cGRhdGUiIGluIGhhbmRsZXIgPyBoYW5kbGVyLnVwZGF0ZShtYXAyLmdldChrZXkpLCBrZXksIG1hcDIpIDogaGFuZGxlci5pbnNlcnQoa2V5LCBtYXAyKTsKICAgIG1hcDIuc2V0KGtleSwgdmFsdWUpOwogICAgcmV0dXJuIHZhbHVlOwogIH07CiAgdmFyICQkYiA9IF9leHBvcnQ7CiAgdmFyIElTX1BVUkUkMiA9IGlzUHVyZTsKICB2YXIgJGVtcGxhY2UgPSBtYXBFbXBsYWNlOwogICQkYih7IHRhcmdldDogIldlYWtNYXAiLCBwcm90bzogdHJ1ZSwgcmVhbDogdHJ1ZSwgZm9yY2VkOiBJU19QVVJFJDIgfSwgewogICAgZW1wbGFjZTogJGVtcGxhY2UKICB9KTsKICB2YXIgYUNhbGxhYmxlJDIgPSBhQ2FsbGFibGUkYzsKICB2YXIgYUNvbnN0cnVjdG9yID0gYUNvbnN0cnVjdG9yJDM7CiAgdmFyIGJpbmQkNSA9IGZ1bmN0aW9uQmluZENvbnRleHQ7CiAgdmFyIGl0ZXJhdGUgPSBpdGVyYXRlJDc7CiAgdmFyIGNvbGxlY3Rpb25Gcm9tID0gZnVuY3Rpb24gZnJvbTIoc291cmNlKSB7CiAgICB2YXIgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsKICAgIHZhciBtYXBGbiA9IGxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB2b2lkIDA7CiAgICB2YXIgbWFwcGluZywgYXJyYXksIG4sIGJvdW5kRnVuY3Rpb247CiAgICBhQ29uc3RydWN0b3IodGhpcyk7CiAgICBtYXBwaW5nID0gbWFwRm4gIT09IHZvaWQgMDsKICAgIGlmIChtYXBwaW5nKQogICAgICBhQ2FsbGFibGUkMihtYXBGbik7CiAgICBpZiAoc291cmNlID09IHZvaWQgMCkKICAgICAgcmV0dXJuIG5ldyB0aGlzKCk7CiAgICBhcnJheSA9IFtdOwogICAgaWYgKG1hcHBpbmcpIHsKICAgICAgbiA9IDA7CiAgICAgIGJvdW5kRnVuY3Rpb24gPSBiaW5kJDUobWFwRm4sIGxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB2b2lkIDAsIDIpOwogICAgICBpdGVyYXRlKHNvdXJjZSwgZnVuY3Rpb24obmV4dEl0ZW0pIHsKICAgICAgICBhcnJheS5wdXNoKGJvdW5kRnVuY3Rpb24obmV4dEl0ZW0sIG4rKykpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGl0ZXJhdGUoc291cmNlLCBhcnJheS5wdXNoLCB7IHRoYXQ6IGFycmF5IH0pOwogICAgfQogICAgcmV0dXJuIG5ldyB0aGlzKGFycmF5KTsKICB9OwogIHZhciAkJGEgPSBfZXhwb3J0OwogIHZhciBmcm9tID0gY29sbGVjdGlvbkZyb207CiAgJCRhKHsgdGFyZ2V0OiAiV2Vha01hcCIsIHN0YXQ6IHRydWUgfSwgewogICAgZnJvbQogIH0pOwogIHZhciBjb2xsZWN0aW9uT2YgPSBmdW5jdGlvbiBvZjIoKSB7CiAgICB2YXIgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsKICAgIHZhciBBID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICB3aGlsZSAobGVuZ3RoLS0pCiAgICAgIEFbbGVuZ3RoXSA9IGFyZ3VtZW50c1tsZW5ndGhdOwogICAgcmV0dXJuIG5ldyB0aGlzKEEpOwogIH07CiAgdmFyICQkOSA9IF9leHBvcnQ7CiAgdmFyIG9mID0gY29sbGVjdGlvbk9mOwogICQkOSh7IHRhcmdldDogIldlYWtNYXAiLCBzdGF0OiB0cnVlIH0sIHsKICAgIG9mCiAgfSk7CiAgdmFyIGFDYWxsYWJsZSQxID0gYUNhbGxhYmxlJGM7CiAgdmFyIGFuT2JqZWN0JDIgPSBhbk9iamVjdCRpOwogIHZhciBjb2xsZWN0aW9uRGVsZXRlQWxsJDEgPSBmdW5jdGlvbigpIHsKICAgIHZhciBjb2xsZWN0aW9uMiA9IGFuT2JqZWN0JDIodGhpcyk7CiAgICB2YXIgcmVtb3ZlciA9IGFDYWxsYWJsZSQxKGNvbGxlY3Rpb24yWyJkZWxldGUiXSk7CiAgICB2YXIgYWxsRGVsZXRlZCA9IHRydWU7CiAgICB2YXIgd2FzRGVsZXRlZDsKICAgIGZvciAodmFyIGsgPSAwLCBsZW4yID0gYXJndW1lbnRzLmxlbmd0aDsgayA8IGxlbjI7IGsrKykgewogICAgICB3YXNEZWxldGVkID0gcmVtb3Zlci5jYWxsKGNvbGxlY3Rpb24yLCBhcmd1bWVudHNba10pOwogICAgICBhbGxEZWxldGVkID0gYWxsRGVsZXRlZCAmJiB3YXNEZWxldGVkOwogICAgfQogICAgcmV0dXJuICEhYWxsRGVsZXRlZDsKICB9OwogIHZhciAkJDggPSBfZXhwb3J0OwogIHZhciBJU19QVVJFJDEgPSBpc1B1cmU7CiAgdmFyIGNvbGxlY3Rpb25EZWxldGVBbGwgPSBjb2xsZWN0aW9uRGVsZXRlQWxsJDE7CiAgJCQ4KHsgdGFyZ2V0OiAiV2Vha01hcCIsIHByb3RvOiB0cnVlLCByZWFsOiB0cnVlLCBmb3JjZWQ6IElTX1BVUkUkMSB9LCB7CiAgICBkZWxldGVBbGw6IGZ1bmN0aW9uIGRlbGV0ZUFsbCgpIHsKICAgICAgcmV0dXJuIGNvbGxlY3Rpb25EZWxldGVBbGwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KICB9KTsKICB2YXIgaXNDYWxsYWJsZSA9IGlzQ2FsbGFibGUkbDsKICB2YXIgYW5PYmplY3QkMSA9IGFuT2JqZWN0JGk7CiAgdmFyIG1hcFVwc2VydCA9IGZ1bmN0aW9uIHVwc2VydChrZXksIHVwZGF0ZUZuKSB7CiAgICB2YXIgbWFwMiA9IGFuT2JqZWN0JDEodGhpcyk7CiAgICB2YXIgaW5zZXJ0Rm4gPSBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50c1syXSA6IHZvaWQgMDsKICAgIHZhciB2YWx1ZTsKICAgIGlmICghaXNDYWxsYWJsZSh1cGRhdGVGbikgJiYgIWlzQ2FsbGFibGUoaW5zZXJ0Rm4pKSB7CiAgICAgIHRocm93IFR5cGVFcnJvcigiQXQgbGVhc3Qgb25lIGNhbGxiYWNrIHJlcXVpcmVkIik7CiAgICB9CiAgICBpZiAobWFwMi5oYXMoa2V5KSkgewogICAgICB2YWx1ZSA9IG1hcDIuZ2V0KGtleSk7CiAgICAgIGlmIChpc0NhbGxhYmxlKHVwZGF0ZUZuKSkgewogICAgICAgIHZhbHVlID0gdXBkYXRlRm4odmFsdWUpOwogICAgICAgIG1hcDIuc2V0KGtleSwgdmFsdWUpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGlzQ2FsbGFibGUoaW5zZXJ0Rm4pKSB7CiAgICAgIHZhbHVlID0gaW5zZXJ0Rm4oKTsKICAgICAgbWFwMi5zZXQoa2V5LCB2YWx1ZSk7CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfTsKICB2YXIgJCQ3ID0gX2V4cG9ydDsKICB2YXIgSVNfUFVSRSA9IGlzUHVyZTsKICB2YXIgJHVwc2VydCA9IG1hcFVwc2VydDsKICAkJDcoeyB0YXJnZXQ6ICJXZWFrTWFwIiwgcHJvdG86IHRydWUsIHJlYWw6IHRydWUsIGZvcmNlZDogSVNfUFVSRSB9LCB7CiAgICB1cHNlcnQ6ICR1cHNlcnQKICB9KTsKICB2YXIgcGFyZW50JGUgPSB3ZWFrTWFwJDI7CiAgdmFyIHdlYWtNYXAkMSA9IHBhcmVudCRlOwogIHZhciB3ZWFrTWFwID0gd2Vha01hcCQxOwogIHZhciBwYXJlbnQkZCA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvciQ0OwogIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMSA9IHBhcmVudCRkOwogIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IkMTsKICAoZnVuY3Rpb24obW9kdWxlKSB7CiAgICB2YXIgX3R5cGVvZjMgPSBfdHlwZW9mJDEuZXhwb3J0c1siZGVmYXVsdCJdOwogICAgdmFyIF9XZWFrTWFwID0gd2Vha01hcDsKICAgIHZhciBfT2JqZWN0JGRlZmluZVByb3BlcnR5ID0gZGVmaW5lUHJvcGVydHkkNDsKICAgIHZhciBfT2JqZWN0JGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKICAgIGZ1bmN0aW9uIF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZShub2RlSW50ZXJvcCkgewogICAgICBpZiAodHlwZW9mIF9XZWFrTWFwICE9PSAiZnVuY3Rpb24iKQogICAgICAgIHJldHVybiBudWxsOwogICAgICB2YXIgY2FjaGVCYWJlbEludGVyb3AgPSBuZXcgX1dlYWtNYXAoKTsKICAgICAgdmFyIGNhY2hlTm9kZUludGVyb3AgPSBuZXcgX1dlYWtNYXAoKTsKICAgICAgcmV0dXJuIChfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUgPSBmdW5jdGlvbiBfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUyKG5vZGVJbnRlcm9wMikgewogICAgICAgIHJldHVybiBub2RlSW50ZXJvcDIgPyBjYWNoZU5vZGVJbnRlcm9wIDogY2FjaGVCYWJlbEludGVyb3A7CiAgICAgIH0pKG5vZGVJbnRlcm9wKTsKICAgIH0KICAgIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaiwgbm9kZUludGVyb3ApIHsKICAgICAgaWYgKCFub2RlSW50ZXJvcCAmJiBvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsKICAgICAgICByZXR1cm4gb2JqOwogICAgICB9CiAgICAgIGlmIChvYmogPT09IG51bGwgfHwgX3R5cGVvZjMob2JqKSAhPT0gIm9iamVjdCIgJiYgdHlwZW9mIG9iaiAhPT0gImZ1bmN0aW9uIikgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAiZGVmYXVsdCI6IG9iagogICAgICAgIH07CiAgICAgIH0KICAgICAgdmFyIGNhY2hlID0gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKG5vZGVJbnRlcm9wKTsKICAgICAgaWYgKGNhY2hlICYmIGNhY2hlLmhhcyhvYmopKSB7CiAgICAgICAgcmV0dXJuIGNhY2hlLmdldChvYmopOwogICAgICB9CiAgICAgIHZhciBuZXdPYmogPSB7fTsKICAgICAgdmFyIGhhc1Byb3BlcnR5RGVzY3JpcHRvciA9IF9PYmplY3QkZGVmaW5lUHJvcGVydHkgJiYgX09iamVjdCRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICBpZiAoa2V5ICE9PSAiZGVmYXVsdCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgewogICAgICAgICAgdmFyIGRlc2MgPSBoYXNQcm9wZXJ0eURlc2NyaXB0b3IgPyBfT2JqZWN0JGdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiBudWxsOwogICAgICAgICAgaWYgKGRlc2MgJiYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSkgewogICAgICAgICAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld09ialtrZXldID0gb2JqW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIG5ld09ialsiZGVmYXVsdCJdID0gb2JqOwogICAgICBpZiAoY2FjaGUpIHsKICAgICAgICBjYWNoZS5zZXQob2JqLCBuZXdPYmopOwogICAgICB9CiAgICAgIHJldHVybiBuZXdPYmo7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkOwogICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShpbnRlcm9wUmVxdWlyZVdpbGRjYXJkKTsKICB2YXIgREVTQ1JJUFRPUlMgPSBkZXNjcmlwdG9yczsKICB2YXIgZmFpbHMkMSA9IGZhaWxzJG47CiAgdmFyIG9iamVjdEtleXMgPSBvYmplY3RLZXlzJDM7CiAgdmFyIGdldE93blByb3BlcnR5U3ltYm9sc01vZHVsZSA9IG9iamVjdEdldE93blByb3BlcnR5U3ltYm9sczsKICB2YXIgcHJvcGVydHlJc0VudW1lcmFibGVNb2R1bGUgPSBvYmplY3RQcm9wZXJ0eUlzRW51bWVyYWJsZTsKICB2YXIgdG9PYmplY3QkMSA9IHRvT2JqZWN0JGI7CiAgdmFyIEluZGV4ZWRPYmplY3QkMSA9IGluZGV4ZWRPYmplY3Q7CiAgdmFyICRhc3NpZ24gPSBPYmplY3QuYXNzaWduOwogIHZhciBkZWZpbmVQcm9wZXJ0eSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKICB2YXIgb2JqZWN0QXNzaWduID0gISRhc3NpZ24gfHwgZmFpbHMkMShmdW5jdGlvbigpIHsKICAgIGlmIChERVNDUklQVE9SUyAmJiAkYXNzaWduKHsgYjogMSB9LCAkYXNzaWduKGRlZmluZVByb3BlcnR5KHt9LCAiYSIsIHsKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBkZWZpbmVQcm9wZXJ0eSh0aGlzLCAiYiIsIHsKICAgICAgICAgIHZhbHVlOiAzLAogICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UKICAgICAgICB9KTsKICAgICAgfQogICAgfSksIHsgYjogMiB9KSkuYiAhPT0gMSkKICAgICAgcmV0dXJuIHRydWU7CiAgICB2YXIgQSA9IHt9OwogICAgdmFyIEIgPSB7fTsKICAgIHZhciBzeW1ib2wyID0gU3ltYm9sKCk7CiAgICB2YXIgYWxwaGFiZXQgPSAiYWJjZGVmZ2hpamtsbW5vcHFyc3QiOwogICAgQVtzeW1ib2wyXSA9IDc7CiAgICBhbHBoYWJldC5zcGxpdCgiIikuZm9yRWFjaChmdW5jdGlvbihjaHIpIHsKICAgICAgQltjaHJdID0gY2hyOwogICAgfSk7CiAgICByZXR1cm4gJGFzc2lnbih7fSwgQSlbc3ltYm9sMl0gIT0gNyB8fCBvYmplY3RLZXlzKCRhc3NpZ24oe30sIEIpKS5qb2luKCIiKSAhPSBhbHBoYWJldDsKICB9KSA/IGZ1bmN0aW9uIGFzc2lnbjIodGFyZ2V0LCBzb3VyY2UpIHsKICAgIHZhciBUID0gdG9PYmplY3QkMSh0YXJnZXQpOwogICAgdmFyIGFyZ3VtZW50c0xlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7CiAgICB2YXIgaW5kZXggPSAxOwogICAgdmFyIGdldE93blByb3BlcnR5U3ltYm9sczIgPSBnZXRPd25Qcm9wZXJ0eVN5bWJvbHNNb2R1bGUuZjsKICAgIHZhciBwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IHByb3BlcnR5SXNFbnVtZXJhYmxlTW9kdWxlLmY7CiAgICB3aGlsZSAoYXJndW1lbnRzTGVuZ3RoID4gaW5kZXgpIHsKICAgICAgdmFyIFMgPSBJbmRleGVkT2JqZWN0JDEoYXJndW1lbnRzW2luZGV4KytdKTsKICAgICAgdmFyIGtleXMyID0gZ2V0T3duUHJvcGVydHlTeW1ib2xzMiA/IG9iamVjdEtleXMoUykuY29uY2F0KGdldE93blByb3BlcnR5U3ltYm9sczIoUykpIDogb2JqZWN0S2V5cyhTKTsKICAgICAgdmFyIGxlbmd0aCA9IGtleXMyLmxlbmd0aDsKICAgICAgdmFyIGogPSAwOwogICAgICB2YXIga2V5OwogICAgICB3aGlsZSAobGVuZ3RoID4gaikgewogICAgICAgIGtleSA9IGtleXMyW2orK107CiAgICAgICAgaWYgKCFERVNDUklQVE9SUyB8fCBwcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKFMsIGtleSkpCiAgICAgICAgICBUW2tleV0gPSBTW2tleV07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBUOwogIH0gOiAkYXNzaWduOwogIHZhciAkJDYgPSBfZXhwb3J0OwogIHZhciBhc3NpZ24kNCA9IG9iamVjdEFzc2lnbjsKICAkJDYoeyB0YXJnZXQ6ICJPYmplY3QiLCBzdGF0OiB0cnVlLCBmb3JjZWQ6IE9iamVjdC5hc3NpZ24gIT09IGFzc2lnbiQ0IH0sIHsKICAgIGFzc2lnbjogYXNzaWduJDQKICB9KTsKICB2YXIgcGF0aCQyID0gcGF0aCRuOwogIHZhciBhc3NpZ24kMyA9IHBhdGgkMi5PYmplY3QuYXNzaWduOwogIHZhciBwYXJlbnQkYyA9IGFzc2lnbiQzOwogIHZhciBhc3NpZ24kMiA9IHBhcmVudCRjOwogIHZhciBhc3NpZ24kMSA9IGFzc2lnbiQyOwogIHZhciBzbGljZWRUb0FycmF5ID0geyBleHBvcnRzOiB7fSB9OwogIHZhciBhcnJheVdpdGhIb2xlcyA9IHsgZXhwb3J0czoge30gfTsKICAoZnVuY3Rpb24obW9kdWxlKSB7CiAgICBmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGFycikpCiAgICAgICAgcmV0dXJuIGFycjsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gX2FycmF5V2l0aEhvbGVzOwogICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShhcnJheVdpdGhIb2xlcyk7CiAgdmFyIGl0ZXJhYmxlVG9BcnJheUxpbWl0ID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUpIHsKICAgIGZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkyKSB7CiAgICAgIHZhciBfaSA9IGFyciA9PSBudWxsID8gbnVsbCA6IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIGFycltTeW1ib2wuaXRlcmF0b3JdIHx8IGFyclsiQEBpdGVyYXRvciJdOwogICAgICBpZiAoX2kgPT0gbnVsbCkKICAgICAgICByZXR1cm47CiAgICAgIHZhciBfYXJyID0gW107CiAgICAgIHZhciBfbiA9IHRydWU7CiAgICAgIHZhciBfZCA9IGZhbHNlOwogICAgICB2YXIgX3MsIF9lOwogICAgICB0cnkgewogICAgICAgIGZvciAoX2kgPSBfaS5jYWxsKGFycik7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsKICAgICAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7CiAgICAgICAgICBpZiAoaTIgJiYgX2Fyci5sZW5ndGggPT09IGkyKQogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycjIpIHsKICAgICAgICBfZCA9IHRydWU7CiAgICAgICAgX2UgPSBlcnIyOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoIV9uICYmIF9pWyJyZXR1cm4iXSAhPSBudWxsKQogICAgICAgICAgICBfaVsicmV0dXJuIl0oKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgaWYgKF9kKQogICAgICAgICAgICB0aHJvdyBfZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIF9hcnI7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF9pdGVyYWJsZVRvQXJyYXlMaW1pdDsKICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSkoaXRlcmFibGVUb0FycmF5TGltaXQpOwogIHZhciB1bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheSA9IHsgZXhwb3J0czoge30gfTsKICB2YXIgYXJyYXlMaWtlVG9BcnJheSA9IHsgZXhwb3J0czoge30gfTsKICAoZnVuY3Rpb24obW9kdWxlKSB7CiAgICBmdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbjIpIHsKICAgICAgaWYgKGxlbjIgPT0gbnVsbCB8fCBsZW4yID4gYXJyLmxlbmd0aCkKICAgICAgICBsZW4yID0gYXJyLmxlbmd0aDsKICAgICAgZm9yICh2YXIgaTIgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbjIpOyBpMiA8IGxlbjI7IGkyKyspIHsKICAgICAgICBhcnIyW2kyXSA9IGFycltpMl07CiAgICAgIH0KICAgICAgcmV0dXJuIGFycjI7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF9hcnJheUxpa2VUb0FycmF5OwogICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShhcnJheUxpa2VUb0FycmF5KTsKICAoZnVuY3Rpb24obW9kdWxlKSB7CiAgICB2YXIgYXJyYXlMaWtlVG9BcnJheSQxMiA9IGFycmF5TGlrZVRvQXJyYXkuZXhwb3J0czsKICAgIGZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHsKICAgICAgaWYgKCFvKQogICAgICAgIHJldHVybjsKICAgICAgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikKICAgICAgICByZXR1cm4gYXJyYXlMaWtlVG9BcnJheSQxMihvLCBtaW5MZW4pOwogICAgICB2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7CiAgICAgIGlmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKQogICAgICAgIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7CiAgICAgIGlmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikKICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShvKTsKICAgICAgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKQogICAgICAgIHJldHVybiBhcnJheUxpa2VUb0FycmF5JDEyKG8sIG1pbkxlbik7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheTsKICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSkodW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkpOwogIHZhciBub25JdGVyYWJsZVJlc3QgPSB7IGV4cG9ydHM6IHt9IH07CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gX25vbkl0ZXJhYmxlUmVzdDsKICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSkobm9uSXRlcmFibGVSZXN0KTsKICAoZnVuY3Rpb24obW9kdWxlKSB7CiAgICB2YXIgYXJyYXlXaXRoSG9sZXMkMTIgPSBhcnJheVdpdGhIb2xlcy5leHBvcnRzOwogICAgdmFyIGl0ZXJhYmxlVG9BcnJheUxpbWl0JDEyID0gaXRlcmFibGVUb0FycmF5TGltaXQuZXhwb3J0czsKICAgIHZhciB1bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheSQxMiA9IHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5LmV4cG9ydHM7CiAgICB2YXIgbm9uSXRlcmFibGVSZXN0JDEyID0gbm9uSXRlcmFibGVSZXN0LmV4cG9ydHM7CiAgICBmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkyKSB7CiAgICAgIHJldHVybiBhcnJheVdpdGhIb2xlcyQxMihhcnIpIHx8IGl0ZXJhYmxlVG9BcnJheUxpbWl0JDEyKGFyciwgaTIpIHx8IHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5JDEyKGFyciwgaTIpIHx8IG5vbkl0ZXJhYmxlUmVzdCQxMigpOwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBfc2xpY2VkVG9BcnJheTsKICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSkoc2xpY2VkVG9BcnJheSk7CiAgdmFyIHJlZ2VuZXJhdG9yID0gcnVudGltZS5leHBvcnRzOwogIHZhciBhc3luY1RvR2VuZXJhdG9yID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUpIHsKICAgIGZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7CiAgICAgICAgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoaW5mby5kb25lKSB7CiAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgewogICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHNlbGYyID0gdGhpcywgYXJncyA9IGFyZ3VtZW50czsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZjIsIGFyZ3MpOwogICAgICAgICAgZnVuY3Rpb24gX25leHQodmFsdWUpIHsKICAgICAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIyKSB7CiAgICAgICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyMik7CiAgICAgICAgICB9CiAgICAgICAgICBfbmV4dCh2b2lkIDApOwogICAgICAgIH0pOwogICAgICB9OwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBfYXN5bmNUb0dlbmVyYXRvcjsKICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSkoYXN5bmNUb0dlbmVyYXRvcik7CiAgdmFyIGNvbW1vbiA9IHt9OwogIChmdW5jdGlvbihleHBvcnRzKSB7CiAgICB2YXIgVFlQRURfT0sgPSB0eXBlb2YgVWludDhBcnJheSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIFVpbnQxNkFycmF5ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YgSW50MzJBcnJheSAhPT0gInVuZGVmaW5lZCI7CiAgICBmdW5jdGlvbiBfaGFzKG9iaiwga2V5KSB7CiAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpOwogICAgfQogICAgZXhwb3J0cy5hc3NpZ24gPSBmdW5jdGlvbihvYmopIHsKICAgICAgdmFyIHNvdXJjZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgICB3aGlsZSAoc291cmNlcy5sZW5ndGgpIHsKICAgICAgICB2YXIgc291cmNlID0gc291cmNlcy5zaGlmdCgpOwogICAgICAgIGlmICghc291cmNlKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBzb3VyY2UgIT09ICJvYmplY3QiKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHNvdXJjZSArICJtdXN0IGJlIG5vbi1vYmplY3QiKTsKICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgcCBpbiBzb3VyY2UpIHsKICAgICAgICAgIGlmIChfaGFzKHNvdXJjZSwgcCkpIHsKICAgICAgICAgICAgb2JqW3BdID0gc291cmNlW3BdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gb2JqOwogICAgfTsKICAgIGV4cG9ydHMuc2hyaW5rQnVmID0gZnVuY3Rpb24oYnVmLCBzaXplKSB7CiAgICAgIGlmIChidWYubGVuZ3RoID09PSBzaXplKSB7CiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgICAgfQogICAgICBpZiAoYnVmLnN1YmFycmF5KSB7CiAgICAgICAgcmV0dXJuIGJ1Zi5zdWJhcnJheSgwLCBzaXplKTsKICAgICAgfQogICAgICBidWYubGVuZ3RoID0gc2l6ZTsKICAgICAgcmV0dXJuIGJ1ZjsKICAgIH07CiAgICB2YXIgZm5UeXBlZCA9IHsKICAgICAgYXJyYXlTZXQ6IGZ1bmN0aW9uKGRlc3QsIHNyYywgc3JjX29mZnMsIGxlbjIsIGRlc3Rfb2ZmcykgewogICAgICAgIGlmIChzcmMuc3ViYXJyYXkgJiYgZGVzdC5zdWJhcnJheSkgewogICAgICAgICAgZGVzdC5zZXQoc3JjLnN1YmFycmF5KHNyY19vZmZzLCBzcmNfb2ZmcyArIGxlbjIpLCBkZXN0X29mZnMpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpMiA9IDA7IGkyIDwgbGVuMjsgaTIrKykgewogICAgICAgICAgZGVzdFtkZXN0X29mZnMgKyBpMl0gPSBzcmNbc3JjX29mZnMgKyBpMl07CiAgICAgICAgfQogICAgICB9LAogICAgICBmbGF0dGVuQ2h1bmtzOiBmdW5jdGlvbihjaHVua3MpIHsKICAgICAgICB2YXIgaTIsIGwsIGxlbjIsIHBvcywgY2h1bmsyLCByZXN1bHQ7CiAgICAgICAgbGVuMiA9IDA7CiAgICAgICAgZm9yIChpMiA9IDAsIGwgPSBjaHVua3MubGVuZ3RoOyBpMiA8IGw7IGkyKyspIHsKICAgICAgICAgIGxlbjIgKz0gY2h1bmtzW2kyXS5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KGxlbjIpOwogICAgICAgIHBvcyA9IDA7CiAgICAgICAgZm9yIChpMiA9IDAsIGwgPSBjaHVua3MubGVuZ3RoOyBpMiA8IGw7IGkyKyspIHsKICAgICAgICAgIGNodW5rMiA9IGNodW5rc1tpMl07CiAgICAgICAgICByZXN1bHQuc2V0KGNodW5rMiwgcG9zKTsKICAgICAgICAgIHBvcyArPSBjaHVuazIubGVuZ3RoOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICB9OwogICAgdmFyIGZuVW50eXBlZCA9IHsKICAgICAgYXJyYXlTZXQ6IGZ1bmN0aW9uKGRlc3QsIHNyYywgc3JjX29mZnMsIGxlbjIsIGRlc3Rfb2ZmcykgewogICAgICAgIGZvciAodmFyIGkyID0gMDsgaTIgPCBsZW4yOyBpMisrKSB7CiAgICAgICAgICBkZXN0W2Rlc3Rfb2ZmcyArIGkyXSA9IHNyY1tzcmNfb2ZmcyArIGkyXTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGZsYXR0ZW5DaHVua3M6IGZ1bmN0aW9uKGNodW5rcykgewogICAgICAgIHJldHVybiBbXS5jb25jYXQuYXBwbHkoW10sIGNodW5rcyk7CiAgICAgIH0KICAgIH07CiAgICBleHBvcnRzLnNldFR5cGVkID0gZnVuY3Rpb24ob24pIHsKICAgICAgaWYgKG9uKSB7CiAgICAgICAgZXhwb3J0cy5CdWY4ID0gVWludDhBcnJheTsKICAgICAgICBleHBvcnRzLkJ1ZjE2ID0gVWludDE2QXJyYXk7CiAgICAgICAgZXhwb3J0cy5CdWYzMiA9IEludDMyQXJyYXk7CiAgICAgICAgZXhwb3J0cy5hc3NpZ24oZXhwb3J0cywgZm5UeXBlZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZXhwb3J0cy5CdWY4ID0gQXJyYXk7CiAgICAgICAgZXhwb3J0cy5CdWYxNiA9IEFycmF5OwogICAgICAgIGV4cG9ydHMuQnVmMzIgPSBBcnJheTsKICAgICAgICBleHBvcnRzLmFzc2lnbihleHBvcnRzLCBmblVudHlwZWQpOwogICAgICB9CiAgICB9OwogICAgZXhwb3J0cy5zZXRUeXBlZChUWVBFRF9PSyk7CiAgfSkoY29tbW9uKTsKICB2YXIgZGVmbGF0ZSQ0ID0ge307CiAgdmFyIGRlZmxhdGUkMyA9IHt9OwogIHZhciB0cmVlcyQxID0ge307CiAgdmFyIHV0aWxzJDYgPSBjb21tb247CiAgdmFyIFpfRklYRUQkMSA9IDQ7CiAgdmFyIFpfQklOQVJZID0gMDsKICB2YXIgWl9URVhUID0gMTsKICB2YXIgWl9VTktOT1dOJDEgPSAyOwogIGZ1bmN0aW9uIHplcm8kMShidWYpIHsKICAgIHZhciBsZW4yID0gYnVmLmxlbmd0aDsKICAgIHdoaWxlICgtLWxlbjIgPj0gMCkgewogICAgICBidWZbbGVuMl0gPSAwOwogICAgfQogIH0KICB2YXIgU1RPUkVEX0JMT0NLID0gMDsKICB2YXIgU1RBVElDX1RSRUVTID0gMTsKICB2YXIgRFlOX1RSRUVTID0gMjsKICB2YXIgTUlOX01BVENIJDEgPSAzOwogIHZhciBNQVhfTUFUQ0gkMSA9IDI1ODsKICB2YXIgTEVOR1RIX0NPREVTJDEgPSAyOTsKICB2YXIgTElURVJBTFMkMSA9IDI1NjsKICB2YXIgTF9DT0RFUyQxID0gTElURVJBTFMkMSArIDEgKyBMRU5HVEhfQ09ERVMkMTsKICB2YXIgRF9DT0RFUyQxID0gMzA7CiAgdmFyIEJMX0NPREVTJDEgPSAxOTsKICB2YXIgSEVBUF9TSVpFJDEgPSAyICogTF9DT0RFUyQxICsgMTsKICB2YXIgTUFYX0JJVFMkMSA9IDE1OwogIHZhciBCdWZfc2l6ZSA9IDE2OwogIHZhciBNQVhfQkxfQklUUyA9IDc7CiAgdmFyIEVORF9CTE9DSyA9IDI1NjsKICB2YXIgUkVQXzNfNiA9IDE2OwogIHZhciBSRVBaXzNfMTAgPSAxNzsKICB2YXIgUkVQWl8xMV8xMzggPSAxODsKICB2YXIgZXh0cmFfbGJpdHMgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMSwgMSwgMSwgMSwgMiwgMiwgMiwgMiwgMywgMywgMywgMywgNCwgNCwgNCwgNCwgNSwgNSwgNSwgNSwgMF07CiAgdmFyIGV4dHJhX2RiaXRzID0gWzAsIDAsIDAsIDAsIDEsIDEsIDIsIDIsIDMsIDMsIDQsIDQsIDUsIDUsIDYsIDYsIDcsIDcsIDgsIDgsIDksIDksIDEwLCAxMCwgMTEsIDExLCAxMiwgMTIsIDEzLCAxM107CiAgdmFyIGV4dHJhX2JsYml0cyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAyLCAzLCA3XTsKICB2YXIgYmxfb3JkZXIgPSBbMTYsIDE3LCAxOCwgMCwgOCwgNywgOSwgNiwgMTAsIDUsIDExLCA0LCAxMiwgMywgMTMsIDIsIDE0LCAxLCAxNV07CiAgdmFyIERJU1RfQ09ERV9MRU4gPSA1MTI7CiAgdmFyIHN0YXRpY19sdHJlZSA9IG5ldyBBcnJheSgoTF9DT0RFUyQxICsgMikgKiAyKTsKICB6ZXJvJDEoc3RhdGljX2x0cmVlKTsKICB2YXIgc3RhdGljX2R0cmVlID0gbmV3IEFycmF5KERfQ09ERVMkMSAqIDIpOwogIHplcm8kMShzdGF0aWNfZHRyZWUpOwogIHZhciBfZGlzdF9jb2RlID0gbmV3IEFycmF5KERJU1RfQ09ERV9MRU4pOwogIHplcm8kMShfZGlzdF9jb2RlKTsKICB2YXIgX2xlbmd0aF9jb2RlID0gbmV3IEFycmF5KE1BWF9NQVRDSCQxIC0gTUlOX01BVENIJDEgKyAxKTsKICB6ZXJvJDEoX2xlbmd0aF9jb2RlKTsKICB2YXIgYmFzZV9sZW5ndGggPSBuZXcgQXJyYXkoTEVOR1RIX0NPREVTJDEpOwogIHplcm8kMShiYXNlX2xlbmd0aCk7CiAgdmFyIGJhc2VfZGlzdCA9IG5ldyBBcnJheShEX0NPREVTJDEpOwogIHplcm8kMShiYXNlX2Rpc3QpOwogIGZ1bmN0aW9uIFN0YXRpY1RyZWVEZXNjKHN0YXRpY190cmVlLCBleHRyYV9iaXRzLCBleHRyYV9iYXNlLCBlbGVtcywgbWF4X2xlbmd0aCkgewogICAgdGhpcy5zdGF0aWNfdHJlZSA9IHN0YXRpY190cmVlOwogICAgdGhpcy5leHRyYV9iaXRzID0gZXh0cmFfYml0czsKICAgIHRoaXMuZXh0cmFfYmFzZSA9IGV4dHJhX2Jhc2U7CiAgICB0aGlzLmVsZW1zID0gZWxlbXM7CiAgICB0aGlzLm1heF9sZW5ndGggPSBtYXhfbGVuZ3RoOwogICAgdGhpcy5oYXNfc3RyZWUgPSBzdGF0aWNfdHJlZSAmJiBzdGF0aWNfdHJlZS5sZW5ndGg7CiAgfQogIHZhciBzdGF0aWNfbF9kZXNjOwogIHZhciBzdGF0aWNfZF9kZXNjOwogIHZhciBzdGF0aWNfYmxfZGVzYzsKICBmdW5jdGlvbiBUcmVlRGVzYyhkeW5fdHJlZSwgc3RhdF9kZXNjKSB7CiAgICB0aGlzLmR5bl90cmVlID0gZHluX3RyZWU7CiAgICB0aGlzLm1heF9jb2RlID0gMDsKICAgIHRoaXMuc3RhdF9kZXNjID0gc3RhdF9kZXNjOwogIH0KICBmdW5jdGlvbiBkX2NvZGUoZGlzdDIpIHsKICAgIHJldHVybiBkaXN0MiA8IDI1NiA/IF9kaXN0X2NvZGVbZGlzdDJdIDogX2Rpc3RfY29kZVsyNTYgKyAoZGlzdDIgPj4+IDcpXTsKICB9CiAgZnVuY3Rpb24gcHV0X3Nob3J0KHMsIHcpIHsKICAgIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gdyAmIDI1NTsKICAgIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gdyA+Pj4gOCAmIDI1NTsKICB9CiAgZnVuY3Rpb24gc2VuZF9iaXRzKHMsIHZhbHVlLCBsZW5ndGgpIHsKICAgIGlmIChzLmJpX3ZhbGlkID4gQnVmX3NpemUgLSBsZW5ndGgpIHsKICAgICAgcy5iaV9idWYgfD0gdmFsdWUgPDwgcy5iaV92YWxpZCAmIDY1NTM1OwogICAgICBwdXRfc2hvcnQocywgcy5iaV9idWYpOwogICAgICBzLmJpX2J1ZiA9IHZhbHVlID4+IEJ1Zl9zaXplIC0gcy5iaV92YWxpZDsKICAgICAgcy5iaV92YWxpZCArPSBsZW5ndGggLSBCdWZfc2l6ZTsKICAgIH0gZWxzZSB7CiAgICAgIHMuYmlfYnVmIHw9IHZhbHVlIDw8IHMuYmlfdmFsaWQgJiA2NTUzNTsKICAgICAgcy5iaV92YWxpZCArPSBsZW5ndGg7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHNlbmRfY29kZShzLCBjMiwgdHJlZSkgewogICAgc2VuZF9iaXRzKHMsIHRyZWVbYzIgKiAyXSwgdHJlZVtjMiAqIDIgKyAxXSk7CiAgfQogIGZ1bmN0aW9uIGJpX3JldmVyc2UoY29kZTIsIGxlbjIpIHsKICAgIHZhciByZXMgPSAwOwogICAgZG8gewogICAgICByZXMgfD0gY29kZTIgJiAxOwogICAgICBjb2RlMiA+Pj49IDE7CiAgICAgIHJlcyA8PD0gMTsKICAgIH0gd2hpbGUgKC0tbGVuMiA+IDApOwogICAgcmV0dXJuIHJlcyA+Pj4gMTsKICB9CiAgZnVuY3Rpb24gYmlfZmx1c2gocykgewogICAgaWYgKHMuYmlfdmFsaWQgPT09IDE2KSB7CiAgICAgIHB1dF9zaG9ydChzLCBzLmJpX2J1Zik7CiAgICAgIHMuYmlfYnVmID0gMDsKICAgICAgcy5iaV92YWxpZCA9IDA7CiAgICB9IGVsc2UgaWYgKHMuYmlfdmFsaWQgPj0gOCkgewogICAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IHMuYmlfYnVmICYgMjU1OwogICAgICBzLmJpX2J1ZiA+Pj0gODsKICAgICAgcy5iaV92YWxpZCAtPSA4OwogICAgfQogIH0KICBmdW5jdGlvbiBnZW5fYml0bGVuKHMsIGRlc2MpIHsKICAgIHZhciB0cmVlID0gZGVzYy5keW5fdHJlZTsKICAgIHZhciBtYXhfY29kZSA9IGRlc2MubWF4X2NvZGU7CiAgICB2YXIgc3RyZWUgPSBkZXNjLnN0YXRfZGVzYy5zdGF0aWNfdHJlZTsKICAgIHZhciBoYXNfc3RyZWUgPSBkZXNjLnN0YXRfZGVzYy5oYXNfc3RyZWU7CiAgICB2YXIgZXh0cmEgPSBkZXNjLnN0YXRfZGVzYy5leHRyYV9iaXRzOwogICAgdmFyIGJhc2UgPSBkZXNjLnN0YXRfZGVzYy5leHRyYV9iYXNlOwogICAgdmFyIG1heF9sZW5ndGggPSBkZXNjLnN0YXRfZGVzYy5tYXhfbGVuZ3RoOwogICAgdmFyIGg7CiAgICB2YXIgbiwgbTsKICAgIHZhciBiaXRzOwogICAgdmFyIHhiaXRzOwogICAgdmFyIGY7CiAgICB2YXIgb3ZlcmZsb3cgPSAwOwogICAgZm9yIChiaXRzID0gMDsgYml0cyA8PSBNQVhfQklUUyQxOyBiaXRzKyspIHsKICAgICAgcy5ibF9jb3VudFtiaXRzXSA9IDA7CiAgICB9CiAgICB0cmVlW3MuaGVhcFtzLmhlYXBfbWF4XSAqIDIgKyAxXSA9IDA7CiAgICBmb3IgKGggPSBzLmhlYXBfbWF4ICsgMTsgaCA8IEhFQVBfU0laRSQxOyBoKyspIHsKICAgICAgbiA9IHMuaGVhcFtoXTsKICAgICAgYml0cyA9IHRyZWVbdHJlZVtuICogMiArIDFdICogMiArIDFdICsgMTsKICAgICAgaWYgKGJpdHMgPiBtYXhfbGVuZ3RoKSB7CiAgICAgICAgYml0cyA9IG1heF9sZW5ndGg7CiAgICAgICAgb3ZlcmZsb3crKzsKICAgICAgfQogICAgICB0cmVlW24gKiAyICsgMV0gPSBiaXRzOwogICAgICBpZiAobiA+IG1heF9jb2RlKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgcy5ibF9jb3VudFtiaXRzXSsrOwogICAgICB4Yml0cyA9IDA7CiAgICAgIGlmIChuID49IGJhc2UpIHsKICAgICAgICB4Yml0cyA9IGV4dHJhW24gLSBiYXNlXTsKICAgICAgfQogICAgICBmID0gdHJlZVtuICogMl07CiAgICAgIHMub3B0X2xlbiArPSBmICogKGJpdHMgKyB4Yml0cyk7CiAgICAgIGlmIChoYXNfc3RyZWUpIHsKICAgICAgICBzLnN0YXRpY19sZW4gKz0gZiAqIChzdHJlZVtuICogMiArIDFdICsgeGJpdHMpOwogICAgICB9CiAgICB9CiAgICBpZiAob3ZlcmZsb3cgPT09IDApIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZG8gewogICAgICBiaXRzID0gbWF4X2xlbmd0aCAtIDE7CiAgICAgIHdoaWxlIChzLmJsX2NvdW50W2JpdHNdID09PSAwKSB7CiAgICAgICAgYml0cy0tOwogICAgICB9CiAgICAgIHMuYmxfY291bnRbYml0c10tLTsKICAgICAgcy5ibF9jb3VudFtiaXRzICsgMV0gKz0gMjsKICAgICAgcy5ibF9jb3VudFttYXhfbGVuZ3RoXS0tOwogICAgICBvdmVyZmxvdyAtPSAyOwogICAgfSB3aGlsZSAob3ZlcmZsb3cgPiAwKTsKICAgIGZvciAoYml0cyA9IG1heF9sZW5ndGg7IGJpdHMgIT09IDA7IGJpdHMtLSkgewogICAgICBuID0gcy5ibF9jb3VudFtiaXRzXTsKICAgICAgd2hpbGUgKG4gIT09IDApIHsKICAgICAgICBtID0gcy5oZWFwWy0taF07CiAgICAgICAgaWYgKG0gPiBtYXhfY29kZSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICh0cmVlW20gKiAyICsgMV0gIT09IGJpdHMpIHsKICAgICAgICAgIHMub3B0X2xlbiArPSAoYml0cyAtIHRyZWVbbSAqIDIgKyAxXSkgKiB0cmVlW20gKiAyXTsKICAgICAgICAgIHRyZWVbbSAqIDIgKyAxXSA9IGJpdHM7CiAgICAgICAgfQogICAgICAgIG4tLTsKICAgICAgfQogICAgfQogIH0KICBmdW5jdGlvbiBnZW5fY29kZXModHJlZSwgbWF4X2NvZGUsIGJsX2NvdW50KSB7CiAgICB2YXIgbmV4dF9jb2RlID0gbmV3IEFycmF5KE1BWF9CSVRTJDEgKyAxKTsKICAgIHZhciBjb2RlMiA9IDA7CiAgICB2YXIgYml0czsKICAgIHZhciBuOwogICAgZm9yIChiaXRzID0gMTsgYml0cyA8PSBNQVhfQklUUyQxOyBiaXRzKyspIHsKICAgICAgbmV4dF9jb2RlW2JpdHNdID0gY29kZTIgPSBjb2RlMiArIGJsX2NvdW50W2JpdHMgLSAxXSA8PCAxOwogICAgfQogICAgZm9yIChuID0gMDsgbiA8PSBtYXhfY29kZTsgbisrKSB7CiAgICAgIHZhciBsZW4yID0gdHJlZVtuICogMiArIDFdOwogICAgICBpZiAobGVuMiA9PT0gMCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRyZWVbbiAqIDJdID0gYmlfcmV2ZXJzZShuZXh0X2NvZGVbbGVuMl0rKywgbGVuMik7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHRyX3N0YXRpY19pbml0KCkgewogICAgdmFyIG47CiAgICB2YXIgYml0czsKICAgIHZhciBsZW5ndGg7CiAgICB2YXIgY29kZTI7CiAgICB2YXIgZGlzdDI7CiAgICB2YXIgYmxfY291bnQgPSBuZXcgQXJyYXkoTUFYX0JJVFMkMSArIDEpOwogICAgbGVuZ3RoID0gMDsKICAgIGZvciAoY29kZTIgPSAwOyBjb2RlMiA8IExFTkdUSF9DT0RFUyQxIC0gMTsgY29kZTIrKykgewogICAgICBiYXNlX2xlbmd0aFtjb2RlMl0gPSBsZW5ndGg7CiAgICAgIGZvciAobiA9IDA7IG4gPCAxIDw8IGV4dHJhX2xiaXRzW2NvZGUyXTsgbisrKSB7CiAgICAgICAgX2xlbmd0aF9jb2RlW2xlbmd0aCsrXSA9IGNvZGUyOwogICAgICB9CiAgICB9CiAgICBfbGVuZ3RoX2NvZGVbbGVuZ3RoIC0gMV0gPSBjb2RlMjsKICAgIGRpc3QyID0gMDsKICAgIGZvciAoY29kZTIgPSAwOyBjb2RlMiA8IDE2OyBjb2RlMisrKSB7CiAgICAgIGJhc2VfZGlzdFtjb2RlMl0gPSBkaXN0MjsKICAgICAgZm9yIChuID0gMDsgbiA8IDEgPDwgZXh0cmFfZGJpdHNbY29kZTJdOyBuKyspIHsKICAgICAgICBfZGlzdF9jb2RlW2Rpc3QyKytdID0gY29kZTI7CiAgICAgIH0KICAgIH0KICAgIGRpc3QyID4+PSA3OwogICAgZm9yICg7IGNvZGUyIDwgRF9DT0RFUyQxOyBjb2RlMisrKSB7CiAgICAgIGJhc2VfZGlzdFtjb2RlMl0gPSBkaXN0MiA8PCA3OwogICAgICBmb3IgKG4gPSAwOyBuIDwgMSA8PCBleHRyYV9kYml0c1tjb2RlMl0gLSA3OyBuKyspIHsKICAgICAgICBfZGlzdF9jb2RlWzI1NiArIGRpc3QyKytdID0gY29kZTI7CiAgICAgIH0KICAgIH0KICAgIGZvciAoYml0cyA9IDA7IGJpdHMgPD0gTUFYX0JJVFMkMTsgYml0cysrKSB7CiAgICAgIGJsX2NvdW50W2JpdHNdID0gMDsKICAgIH0KICAgIG4gPSAwOwogICAgd2hpbGUgKG4gPD0gMTQzKSB7CiAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdID0gODsKICAgICAgbisrOwogICAgICBibF9jb3VudFs4XSsrOwogICAgfQogICAgd2hpbGUgKG4gPD0gMjU1KSB7CiAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdID0gOTsKICAgICAgbisrOwogICAgICBibF9jb3VudFs5XSsrOwogICAgfQogICAgd2hpbGUgKG4gPD0gMjc5KSB7CiAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdID0gNzsKICAgICAgbisrOwogICAgICBibF9jb3VudFs3XSsrOwogICAgfQogICAgd2hpbGUgKG4gPD0gMjg3KSB7CiAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdID0gODsKICAgICAgbisrOwogICAgICBibF9jb3VudFs4XSsrOwogICAgfQogICAgZ2VuX2NvZGVzKHN0YXRpY19sdHJlZSwgTF9DT0RFUyQxICsgMSwgYmxfY291bnQpOwogICAgZm9yIChuID0gMDsgbiA8IERfQ09ERVMkMTsgbisrKSB7CiAgICAgIHN0YXRpY19kdHJlZVtuICogMiArIDFdID0gNTsKICAgICAgc3RhdGljX2R0cmVlW24gKiAyXSA9IGJpX3JldmVyc2UobiwgNSk7CiAgICB9CiAgICBzdGF0aWNfbF9kZXNjID0gbmV3IFN0YXRpY1RyZWVEZXNjKHN0YXRpY19sdHJlZSwgZXh0cmFfbGJpdHMsIExJVEVSQUxTJDEgKyAxLCBMX0NPREVTJDEsIE1BWF9CSVRTJDEpOwogICAgc3RhdGljX2RfZGVzYyA9IG5ldyBTdGF0aWNUcmVlRGVzYyhzdGF0aWNfZHRyZWUsIGV4dHJhX2RiaXRzLCAwLCBEX0NPREVTJDEsIE1BWF9CSVRTJDEpOwogICAgc3RhdGljX2JsX2Rlc2MgPSBuZXcgU3RhdGljVHJlZURlc2MobmV3IEFycmF5KDApLCBleHRyYV9ibGJpdHMsIDAsIEJMX0NPREVTJDEsIE1BWF9CTF9CSVRTKTsKICB9CiAgZnVuY3Rpb24gaW5pdF9ibG9jayhzKSB7CiAgICB2YXIgbjsKICAgIGZvciAobiA9IDA7IG4gPCBMX0NPREVTJDE7IG4rKykgewogICAgICBzLmR5bl9sdHJlZVtuICogMl0gPSAwOwogICAgfQogICAgZm9yIChuID0gMDsgbiA8IERfQ09ERVMkMTsgbisrKSB7CiAgICAgIHMuZHluX2R0cmVlW24gKiAyXSA9IDA7CiAgICB9CiAgICBmb3IgKG4gPSAwOyBuIDwgQkxfQ09ERVMkMTsgbisrKSB7CiAgICAgIHMuYmxfdHJlZVtuICogMl0gPSAwOwogICAgfQogICAgcy5keW5fbHRyZWVbRU5EX0JMT0NLICogMl0gPSAxOwogICAgcy5vcHRfbGVuID0gcy5zdGF0aWNfbGVuID0gMDsKICAgIHMubGFzdF9saXQgPSBzLm1hdGNoZXMgPSAwOwogIH0KICBmdW5jdGlvbiBiaV93aW5kdXAocykgewogICAgaWYgKHMuYmlfdmFsaWQgPiA4KSB7CiAgICAgIHB1dF9zaG9ydChzLCBzLmJpX2J1Zik7CiAgICB9IGVsc2UgaWYgKHMuYmlfdmFsaWQgPiAwKSB7CiAgICAgIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gcy5iaV9idWY7CiAgICB9CiAgICBzLmJpX2J1ZiA9IDA7CiAgICBzLmJpX3ZhbGlkID0gMDsKICB9CiAgZnVuY3Rpb24gY29weV9ibG9jayhzLCBidWYsIGxlbjIsIGhlYWRlcikgewogICAgYmlfd2luZHVwKHMpOwogICAgaWYgKGhlYWRlcikgewogICAgICBwdXRfc2hvcnQocywgbGVuMik7CiAgICAgIHB1dF9zaG9ydChzLCB+bGVuMik7CiAgICB9CiAgICB1dGlscyQ2LmFycmF5U2V0KHMucGVuZGluZ19idWYsIHMud2luZG93LCBidWYsIGxlbjIsIHMucGVuZGluZyk7CiAgICBzLnBlbmRpbmcgKz0gbGVuMjsKICB9CiAgZnVuY3Rpb24gc21hbGxlcih0cmVlLCBuLCBtLCBkZXB0aCkgewogICAgdmFyIF9uMiA9IG4gKiAyOwogICAgdmFyIF9tMiA9IG0gKiAyOwogICAgcmV0dXJuIHRyZWVbX24yXSA8IHRyZWVbX20yXSB8fCB0cmVlW19uMl0gPT09IHRyZWVbX20yXSAmJiBkZXB0aFtuXSA8PSBkZXB0aFttXTsKICB9CiAgZnVuY3Rpb24gcHFkb3duaGVhcChzLCB0cmVlLCBrKSB7CiAgICB2YXIgdiA9IHMuaGVhcFtrXTsKICAgIHZhciBqID0gayA8PCAxOwogICAgd2hpbGUgKGogPD0gcy5oZWFwX2xlbikgewogICAgICBpZiAoaiA8IHMuaGVhcF9sZW4gJiYgc21hbGxlcih0cmVlLCBzLmhlYXBbaiArIDFdLCBzLmhlYXBbal0sIHMuZGVwdGgpKSB7CiAgICAgICAgaisrOwogICAgICB9CiAgICAgIGlmIChzbWFsbGVyKHRyZWUsIHYsIHMuaGVhcFtqXSwgcy5kZXB0aCkpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBzLmhlYXBba10gPSBzLmhlYXBbal07CiAgICAgIGsgPSBqOwogICAgICBqIDw8PSAxOwogICAgfQogICAgcy5oZWFwW2tdID0gdjsKICB9CiAgZnVuY3Rpb24gY29tcHJlc3NfYmxvY2socywgbHRyZWUsIGR0cmVlKSB7CiAgICB2YXIgZGlzdDI7CiAgICB2YXIgbGM7CiAgICB2YXIgbHggPSAwOwogICAgdmFyIGNvZGUyOwogICAgdmFyIGV4dHJhOwogICAgaWYgKHMubGFzdF9saXQgIT09IDApIHsKICAgICAgZG8gewogICAgICAgIGRpc3QyID0gcy5wZW5kaW5nX2J1ZltzLmRfYnVmICsgbHggKiAyXSA8PCA4IHwgcy5wZW5kaW5nX2J1ZltzLmRfYnVmICsgbHggKiAyICsgMV07CiAgICAgICAgbGMgPSBzLnBlbmRpbmdfYnVmW3MubF9idWYgKyBseF07CiAgICAgICAgbHgrKzsKICAgICAgICBpZiAoZGlzdDIgPT09IDApIHsKICAgICAgICAgIHNlbmRfY29kZShzLCBsYywgbHRyZWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb2RlMiA9IF9sZW5ndGhfY29kZVtsY107CiAgICAgICAgICBzZW5kX2NvZGUocywgY29kZTIgKyBMSVRFUkFMUyQxICsgMSwgbHRyZWUpOwogICAgICAgICAgZXh0cmEgPSBleHRyYV9sYml0c1tjb2RlMl07CiAgICAgICAgICBpZiAoZXh0cmEgIT09IDApIHsKICAgICAgICAgICAgbGMgLT0gYmFzZV9sZW5ndGhbY29kZTJdOwogICAgICAgICAgICBzZW5kX2JpdHMocywgbGMsIGV4dHJhKTsKICAgICAgICAgIH0KICAgICAgICAgIGRpc3QyLS07CiAgICAgICAgICBjb2RlMiA9IGRfY29kZShkaXN0Mik7CiAgICAgICAgICBzZW5kX2NvZGUocywgY29kZTIsIGR0cmVlKTsKICAgICAgICAgIGV4dHJhID0gZXh0cmFfZGJpdHNbY29kZTJdOwogICAgICAgICAgaWYgKGV4dHJhICE9PSAwKSB7CiAgICAgICAgICAgIGRpc3QyIC09IGJhc2VfZGlzdFtjb2RlMl07CiAgICAgICAgICAgIHNlbmRfYml0cyhzLCBkaXN0MiwgZXh0cmEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAobHggPCBzLmxhc3RfbGl0KTsKICAgIH0KICAgIHNlbmRfY29kZShzLCBFTkRfQkxPQ0ssIGx0cmVlKTsKICB9CiAgZnVuY3Rpb24gYnVpbGRfdHJlZShzLCBkZXNjKSB7CiAgICB2YXIgdHJlZSA9IGRlc2MuZHluX3RyZWU7CiAgICB2YXIgc3RyZWUgPSBkZXNjLnN0YXRfZGVzYy5zdGF0aWNfdHJlZTsKICAgIHZhciBoYXNfc3RyZWUgPSBkZXNjLnN0YXRfZGVzYy5oYXNfc3RyZWU7CiAgICB2YXIgZWxlbXMgPSBkZXNjLnN0YXRfZGVzYy5lbGVtczsKICAgIHZhciBuLCBtOwogICAgdmFyIG1heF9jb2RlID0gLTE7CiAgICB2YXIgbm9kZTI7CiAgICBzLmhlYXBfbGVuID0gMDsKICAgIHMuaGVhcF9tYXggPSBIRUFQX1NJWkUkMTsKICAgIGZvciAobiA9IDA7IG4gPCBlbGVtczsgbisrKSB7CiAgICAgIGlmICh0cmVlW24gKiAyXSAhPT0gMCkgewogICAgICAgIHMuaGVhcFsrK3MuaGVhcF9sZW5dID0gbWF4X2NvZGUgPSBuOwogICAgICAgIHMuZGVwdGhbbl0gPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIHRyZWVbbiAqIDIgKyAxXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIHdoaWxlIChzLmhlYXBfbGVuIDwgMikgewogICAgICBub2RlMiA9IHMuaGVhcFsrK3MuaGVhcF9sZW5dID0gbWF4X2NvZGUgPCAyID8gKyttYXhfY29kZSA6IDA7CiAgICAgIHRyZWVbbm9kZTIgKiAyXSA9IDE7CiAgICAgIHMuZGVwdGhbbm9kZTJdID0gMDsKICAgICAgcy5vcHRfbGVuLS07CiAgICAgIGlmIChoYXNfc3RyZWUpIHsKICAgICAgICBzLnN0YXRpY19sZW4gLT0gc3RyZWVbbm9kZTIgKiAyICsgMV07CiAgICAgIH0KICAgIH0KICAgIGRlc2MubWF4X2NvZGUgPSBtYXhfY29kZTsKICAgIGZvciAobiA9IHMuaGVhcF9sZW4gPj4gMTsgbiA+PSAxOyBuLS0pIHsKICAgICAgcHFkb3duaGVhcChzLCB0cmVlLCBuKTsKICAgIH0KICAgIG5vZGUyID0gZWxlbXM7CiAgICBkbyB7CiAgICAgIG4gPSBzLmhlYXBbMV07CiAgICAgIHMuaGVhcFsxXSA9IHMuaGVhcFtzLmhlYXBfbGVuLS1dOwogICAgICBwcWRvd25oZWFwKHMsIHRyZWUsIDEpOwogICAgICBtID0gcy5oZWFwWzFdOwogICAgICBzLmhlYXBbLS1zLmhlYXBfbWF4XSA9IG47CiAgICAgIHMuaGVhcFstLXMuaGVhcF9tYXhdID0gbTsKICAgICAgdHJlZVtub2RlMiAqIDJdID0gdHJlZVtuICogMl0gKyB0cmVlW20gKiAyXTsKICAgICAgcy5kZXB0aFtub2RlMl0gPSAocy5kZXB0aFtuXSA+PSBzLmRlcHRoW21dID8gcy5kZXB0aFtuXSA6IHMuZGVwdGhbbV0pICsgMTsKICAgICAgdHJlZVtuICogMiArIDFdID0gdHJlZVttICogMiArIDFdID0gbm9kZTI7CiAgICAgIHMuaGVhcFsxXSA9IG5vZGUyKys7CiAgICAgIHBxZG93bmhlYXAocywgdHJlZSwgMSk7CiAgICB9IHdoaWxlIChzLmhlYXBfbGVuID49IDIpOwogICAgcy5oZWFwWy0tcy5oZWFwX21heF0gPSBzLmhlYXBbMV07CiAgICBnZW5fYml0bGVuKHMsIGRlc2MpOwogICAgZ2VuX2NvZGVzKHRyZWUsIG1heF9jb2RlLCBzLmJsX2NvdW50KTsKICB9CiAgZnVuY3Rpb24gc2Nhbl90cmVlKHMsIHRyZWUsIG1heF9jb2RlKSB7CiAgICB2YXIgbjsKICAgIHZhciBwcmV2bGVuID0gLTE7CiAgICB2YXIgY3VybGVuOwogICAgdmFyIG5leHRsZW4gPSB0cmVlWzAgKiAyICsgMV07CiAgICB2YXIgY291bnQgPSAwOwogICAgdmFyIG1heF9jb3VudCA9IDc7CiAgICB2YXIgbWluX2NvdW50ID0gNDsKICAgIGlmIChuZXh0bGVuID09PSAwKSB7CiAgICAgIG1heF9jb3VudCA9IDEzODsKICAgICAgbWluX2NvdW50ID0gMzsKICAgIH0KICAgIHRyZWVbKG1heF9jb2RlICsgMSkgKiAyICsgMV0gPSA2NTUzNTsKICAgIGZvciAobiA9IDA7IG4gPD0gbWF4X2NvZGU7IG4rKykgewogICAgICBjdXJsZW4gPSBuZXh0bGVuOwogICAgICBuZXh0bGVuID0gdHJlZVsobiArIDEpICogMiArIDFdOwogICAgICBpZiAoKytjb3VudCA8IG1heF9jb3VudCAmJiBjdXJsZW4gPT09IG5leHRsZW4pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIGlmIChjb3VudCA8IG1pbl9jb3VudCkgewogICAgICAgIHMuYmxfdHJlZVtjdXJsZW4gKiAyXSArPSBjb3VudDsKICAgICAgfSBlbHNlIGlmIChjdXJsZW4gIT09IDApIHsKICAgICAgICBpZiAoY3VybGVuICE9PSBwcmV2bGVuKSB7CiAgICAgICAgICBzLmJsX3RyZWVbY3VybGVuICogMl0rKzsKICAgICAgICB9CiAgICAgICAgcy5ibF90cmVlW1JFUF8zXzYgKiAyXSsrOwogICAgICB9IGVsc2UgaWYgKGNvdW50IDw9IDEwKSB7CiAgICAgICAgcy5ibF90cmVlW1JFUFpfM18xMCAqIDJdKys7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcy5ibF90cmVlW1JFUFpfMTFfMTM4ICogMl0rKzsKICAgICAgfQogICAgICBjb3VudCA9IDA7CiAgICAgIHByZXZsZW4gPSBjdXJsZW47CiAgICAgIGlmIChuZXh0bGVuID09PSAwKSB7CiAgICAgICAgbWF4X2NvdW50ID0gMTM4OwogICAgICAgIG1pbl9jb3VudCA9IDM7CiAgICAgIH0gZWxzZSBpZiAoY3VybGVuID09PSBuZXh0bGVuKSB7CiAgICAgICAgbWF4X2NvdW50ID0gNjsKICAgICAgICBtaW5fY291bnQgPSAzOwogICAgICB9IGVsc2UgewogICAgICAgIG1heF9jb3VudCA9IDc7CiAgICAgICAgbWluX2NvdW50ID0gNDsKICAgICAgfQogICAgfQogIH0KICBmdW5jdGlvbiBzZW5kX3RyZWUocywgdHJlZSwgbWF4X2NvZGUpIHsKICAgIHZhciBuOwogICAgdmFyIHByZXZsZW4gPSAtMTsKICAgIHZhciBjdXJsZW47CiAgICB2YXIgbmV4dGxlbiA9IHRyZWVbMCAqIDIgKyAxXTsKICAgIHZhciBjb3VudCA9IDA7CiAgICB2YXIgbWF4X2NvdW50ID0gNzsKICAgIHZhciBtaW5fY291bnQgPSA0OwogICAgaWYgKG5leHRsZW4gPT09IDApIHsKICAgICAgbWF4X2NvdW50ID0gMTM4OwogICAgICBtaW5fY291bnQgPSAzOwogICAgfQogICAgZm9yIChuID0gMDsgbiA8PSBtYXhfY29kZTsgbisrKSB7CiAgICAgIGN1cmxlbiA9IG5leHRsZW47CiAgICAgIG5leHRsZW4gPSB0cmVlWyhuICsgMSkgKiAyICsgMV07CiAgICAgIGlmICgrK2NvdW50IDwgbWF4X2NvdW50ICYmIGN1cmxlbiA9PT0gbmV4dGxlbikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgaWYgKGNvdW50IDwgbWluX2NvdW50KSB7CiAgICAgICAgZG8gewogICAgICAgICAgc2VuZF9jb2RlKHMsIGN1cmxlbiwgcy5ibF90cmVlKTsKICAgICAgICB9IHdoaWxlICgtLWNvdW50ICE9PSAwKTsKICAgICAgfSBlbHNlIGlmIChjdXJsZW4gIT09IDApIHsKICAgICAgICBpZiAoY3VybGVuICE9PSBwcmV2bGVuKSB7CiAgICAgICAgICBzZW5kX2NvZGUocywgY3VybGVuLCBzLmJsX3RyZWUpOwogICAgICAgICAgY291bnQtLTsKICAgICAgICB9CiAgICAgICAgc2VuZF9jb2RlKHMsIFJFUF8zXzYsIHMuYmxfdHJlZSk7CiAgICAgICAgc2VuZF9iaXRzKHMsIGNvdW50IC0gMywgMik7CiAgICAgIH0gZWxzZSBpZiAoY291bnQgPD0gMTApIHsKICAgICAgICBzZW5kX2NvZGUocywgUkVQWl8zXzEwLCBzLmJsX3RyZWUpOwogICAgICAgIHNlbmRfYml0cyhzLCBjb3VudCAtIDMsIDMpOwogICAgICB9IGVsc2UgewogICAgICAgIHNlbmRfY29kZShzLCBSRVBaXzExXzEzOCwgcy5ibF90cmVlKTsKICAgICAgICBzZW5kX2JpdHMocywgY291bnQgLSAxMSwgNyk7CiAgICAgIH0KICAgICAgY291bnQgPSAwOwogICAgICBwcmV2bGVuID0gY3VybGVuOwogICAgICBpZiAobmV4dGxlbiA9PT0gMCkgewogICAgICAgIG1heF9jb3VudCA9IDEzODsKICAgICAgICBtaW5fY291bnQgPSAzOwogICAgICB9IGVsc2UgaWYgKGN1cmxlbiA9PT0gbmV4dGxlbikgewogICAgICAgIG1heF9jb3VudCA9IDY7CiAgICAgICAgbWluX2NvdW50ID0gMzsKICAgICAgfSBlbHNlIHsKICAgICAgICBtYXhfY291bnQgPSA3OwogICAgICAgIG1pbl9jb3VudCA9IDQ7CiAgICAgIH0KICAgIH0KICB9CiAgZnVuY3Rpb24gYnVpbGRfYmxfdHJlZShzKSB7CiAgICB2YXIgbWF4X2JsaW5kZXg7CiAgICBzY2FuX3RyZWUocywgcy5keW5fbHRyZWUsIHMubF9kZXNjLm1heF9jb2RlKTsKICAgIHNjYW5fdHJlZShzLCBzLmR5bl9kdHJlZSwgcy5kX2Rlc2MubWF4X2NvZGUpOwogICAgYnVpbGRfdHJlZShzLCBzLmJsX2Rlc2MpOwogICAgZm9yIChtYXhfYmxpbmRleCA9IEJMX0NPREVTJDEgLSAxOyBtYXhfYmxpbmRleCA+PSAzOyBtYXhfYmxpbmRleC0tKSB7CiAgICAgIGlmIChzLmJsX3RyZWVbYmxfb3JkZXJbbWF4X2JsaW5kZXhdICogMiArIDFdICE9PSAwKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHMub3B0X2xlbiArPSAzICogKG1heF9ibGluZGV4ICsgMSkgKyA1ICsgNSArIDQ7CiAgICByZXR1cm4gbWF4X2JsaW5kZXg7CiAgfQogIGZ1bmN0aW9uIHNlbmRfYWxsX3RyZWVzKHMsIGxjb2RlcywgZGNvZGVzLCBibGNvZGVzKSB7CiAgICB2YXIgcmFuazI7CiAgICBzZW5kX2JpdHMocywgbGNvZGVzIC0gMjU3LCA1KTsKICAgIHNlbmRfYml0cyhzLCBkY29kZXMgLSAxLCA1KTsKICAgIHNlbmRfYml0cyhzLCBibGNvZGVzIC0gNCwgNCk7CiAgICBmb3IgKHJhbmsyID0gMDsgcmFuazIgPCBibGNvZGVzOyByYW5rMisrKSB7CiAgICAgIHNlbmRfYml0cyhzLCBzLmJsX3RyZWVbYmxfb3JkZXJbcmFuazJdICogMiArIDFdLCAzKTsKICAgIH0KICAgIHNlbmRfdHJlZShzLCBzLmR5bl9sdHJlZSwgbGNvZGVzIC0gMSk7CiAgICBzZW5kX3RyZWUocywgcy5keW5fZHRyZWUsIGRjb2RlcyAtIDEpOwogIH0KICBmdW5jdGlvbiBkZXRlY3RfZGF0YV90eXBlKHMpIHsKICAgIHZhciBibGFja19tYXNrID0gNDA5MzYyNDQ0NzsKICAgIHZhciBuOwogICAgZm9yIChuID0gMDsgbiA8PSAzMTsgbisrLCBibGFja19tYXNrID4+Pj0gMSkgewogICAgICBpZiAoYmxhY2tfbWFzayAmIDEgJiYgcy5keW5fbHRyZWVbbiAqIDJdICE9PSAwKSB7CiAgICAgICAgcmV0dXJuIFpfQklOQVJZOwogICAgICB9CiAgICB9CiAgICBpZiAocy5keW5fbHRyZWVbOSAqIDJdICE9PSAwIHx8IHMuZHluX2x0cmVlWzEwICogMl0gIT09IDAgfHwgcy5keW5fbHRyZWVbMTMgKiAyXSAhPT0gMCkgewogICAgICByZXR1cm4gWl9URVhUOwogICAgfQogICAgZm9yIChuID0gMzI7IG4gPCBMSVRFUkFMUyQxOyBuKyspIHsKICAgICAgaWYgKHMuZHluX2x0cmVlW24gKiAyXSAhPT0gMCkgewogICAgICAgIHJldHVybiBaX1RFWFQ7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBaX0JJTkFSWTsKICB9CiAgdmFyIHN0YXRpY19pbml0X2RvbmUgPSBmYWxzZTsKICBmdW5jdGlvbiBfdHJfaW5pdChzKSB7CiAgICBpZiAoIXN0YXRpY19pbml0X2RvbmUpIHsKICAgICAgdHJfc3RhdGljX2luaXQoKTsKICAgICAgc3RhdGljX2luaXRfZG9uZSA9IHRydWU7CiAgICB9CiAgICBzLmxfZGVzYyA9IG5ldyBUcmVlRGVzYyhzLmR5bl9sdHJlZSwgc3RhdGljX2xfZGVzYyk7CiAgICBzLmRfZGVzYyA9IG5ldyBUcmVlRGVzYyhzLmR5bl9kdHJlZSwgc3RhdGljX2RfZGVzYyk7CiAgICBzLmJsX2Rlc2MgPSBuZXcgVHJlZURlc2Mocy5ibF90cmVlLCBzdGF0aWNfYmxfZGVzYyk7CiAgICBzLmJpX2J1ZiA9IDA7CiAgICBzLmJpX3ZhbGlkID0gMDsKICAgIGluaXRfYmxvY2socyk7CiAgfQogIGZ1bmN0aW9uIF90cl9zdG9yZWRfYmxvY2socywgYnVmLCBzdG9yZWRfbGVuLCBsYXN0MikgewogICAgc2VuZF9iaXRzKHMsIChTVE9SRURfQkxPQ0sgPDwgMSkgKyAobGFzdDIgPyAxIDogMCksIDMpOwogICAgY29weV9ibG9jayhzLCBidWYsIHN0b3JlZF9sZW4sIHRydWUpOwogIH0KICBmdW5jdGlvbiBfdHJfYWxpZ24ocykgewogICAgc2VuZF9iaXRzKHMsIFNUQVRJQ19UUkVFUyA8PCAxLCAzKTsKICAgIHNlbmRfY29kZShzLCBFTkRfQkxPQ0ssIHN0YXRpY19sdHJlZSk7CiAgICBiaV9mbHVzaChzKTsKICB9CiAgZnVuY3Rpb24gX3RyX2ZsdXNoX2Jsb2NrKHMsIGJ1Ziwgc3RvcmVkX2xlbiwgbGFzdDIpIHsKICAgIHZhciBvcHRfbGVuYiwgc3RhdGljX2xlbmI7CiAgICB2YXIgbWF4X2JsaW5kZXggPSAwOwogICAgaWYgKHMubGV2ZWwgPiAwKSB7CiAgICAgIGlmIChzLnN0cm0uZGF0YV90eXBlID09PSBaX1VOS05PV04kMSkgewogICAgICAgIHMuc3RybS5kYXRhX3R5cGUgPSBkZXRlY3RfZGF0YV90eXBlKHMpOwogICAgICB9CiAgICAgIGJ1aWxkX3RyZWUocywgcy5sX2Rlc2MpOwogICAgICBidWlsZF90cmVlKHMsIHMuZF9kZXNjKTsKICAgICAgbWF4X2JsaW5kZXggPSBidWlsZF9ibF90cmVlKHMpOwogICAgICBvcHRfbGVuYiA9IHMub3B0X2xlbiArIDMgKyA3ID4+PiAzOwogICAgICBzdGF0aWNfbGVuYiA9IHMuc3RhdGljX2xlbiArIDMgKyA3ID4+PiAzOwogICAgICBpZiAoc3RhdGljX2xlbmIgPD0gb3B0X2xlbmIpIHsKICAgICAgICBvcHRfbGVuYiA9IHN0YXRpY19sZW5iOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBvcHRfbGVuYiA9IHN0YXRpY19sZW5iID0gc3RvcmVkX2xlbiArIDU7CiAgICB9CiAgICBpZiAoc3RvcmVkX2xlbiArIDQgPD0gb3B0X2xlbmIgJiYgYnVmICE9PSAtMSkgewogICAgICBfdHJfc3RvcmVkX2Jsb2NrKHMsIGJ1Ziwgc3RvcmVkX2xlbiwgbGFzdDIpOwogICAgfSBlbHNlIGlmIChzLnN0cmF0ZWd5ID09PSBaX0ZJWEVEJDEgfHwgc3RhdGljX2xlbmIgPT09IG9wdF9sZW5iKSB7CiAgICAgIHNlbmRfYml0cyhzLCAoU1RBVElDX1RSRUVTIDw8IDEpICsgKGxhc3QyID8gMSA6IDApLCAzKTsKICAgICAgY29tcHJlc3NfYmxvY2socywgc3RhdGljX2x0cmVlLCBzdGF0aWNfZHRyZWUpOwogICAgfSBlbHNlIHsKICAgICAgc2VuZF9iaXRzKHMsIChEWU5fVFJFRVMgPDwgMSkgKyAobGFzdDIgPyAxIDogMCksIDMpOwogICAgICBzZW5kX2FsbF90cmVlcyhzLCBzLmxfZGVzYy5tYXhfY29kZSArIDEsIHMuZF9kZXNjLm1heF9jb2RlICsgMSwgbWF4X2JsaW5kZXggKyAxKTsKICAgICAgY29tcHJlc3NfYmxvY2socywgcy5keW5fbHRyZWUsIHMuZHluX2R0cmVlKTsKICAgIH0KICAgIGluaXRfYmxvY2socyk7CiAgICBpZiAobGFzdDIpIHsKICAgICAgYmlfd2luZHVwKHMpOwogICAgfQogIH0KICBmdW5jdGlvbiBfdHJfdGFsbHkocywgZGlzdDIsIGxjKSB7CiAgICBzLnBlbmRpbmdfYnVmW3MuZF9idWYgKyBzLmxhc3RfbGl0ICogMl0gPSBkaXN0MiA+Pj4gOCAmIDI1NTsKICAgIHMucGVuZGluZ19idWZbcy5kX2J1ZiArIHMubGFzdF9saXQgKiAyICsgMV0gPSBkaXN0MiAmIDI1NTsKICAgIHMucGVuZGluZ19idWZbcy5sX2J1ZiArIHMubGFzdF9saXRdID0gbGMgJiAyNTU7CiAgICBzLmxhc3RfbGl0Kys7CiAgICBpZiAoZGlzdDIgPT09IDApIHsKICAgICAgcy5keW5fbHRyZWVbbGMgKiAyXSsrOwogICAgfSBlbHNlIHsKICAgICAgcy5tYXRjaGVzKys7CiAgICAgIGRpc3QyLS07CiAgICAgIHMuZHluX2x0cmVlWyhfbGVuZ3RoX2NvZGVbbGNdICsgTElURVJBTFMkMSArIDEpICogMl0rKzsKICAgICAgcy5keW5fZHRyZWVbZF9jb2RlKGRpc3QyKSAqIDJdKys7CiAgICB9CiAgICByZXR1cm4gcy5sYXN0X2xpdCA9PT0gcy5saXRfYnVmc2l6ZSAtIDE7CiAgfQogIHRyZWVzJDEuX3RyX2luaXQgPSBfdHJfaW5pdDsKICB0cmVlcyQxLl90cl9zdG9yZWRfYmxvY2sgPSBfdHJfc3RvcmVkX2Jsb2NrOwogIHRyZWVzJDEuX3RyX2ZsdXNoX2Jsb2NrID0gX3RyX2ZsdXNoX2Jsb2NrOwogIHRyZWVzJDEuX3RyX3RhbGx5ID0gX3RyX3RhbGx5OwogIHRyZWVzJDEuX3RyX2FsaWduID0gX3RyX2FsaWduOwogIGZ1bmN0aW9uIGFkbGVyMzIkMihhZGxlciwgYnVmLCBsZW4yLCBwb3MpIHsKICAgIHZhciBzMSA9IGFkbGVyICYgNjU1MzUgfCAwLCBzMiA9IGFkbGVyID4+PiAxNiAmIDY1NTM1IHwgMCwgbiA9IDA7CiAgICB3aGlsZSAobGVuMiAhPT0gMCkgewogICAgICBuID0gbGVuMiA+IDJlMyA/IDJlMyA6IGxlbjI7CiAgICAgIGxlbjIgLT0gbjsKICAgICAgZG8gewogICAgICAgIHMxID0gczEgKyBidWZbcG9zKytdIHwgMDsKICAgICAgICBzMiA9IHMyICsgczEgfCAwOwogICAgICB9IHdoaWxlICgtLW4pOwogICAgICBzMSAlPSA2NTUyMTsKICAgICAgczIgJT0gNjU1MjE7CiAgICB9CiAgICByZXR1cm4gczEgfCBzMiA8PCAxNiB8IDA7CiAgfQogIHZhciBhZGxlcjMyXzEgPSBhZGxlcjMyJDI7CiAgZnVuY3Rpb24gbWFrZVRhYmxlKCkgewogICAgdmFyIGMyLCB0YWJsZSA9IFtdOwogICAgZm9yICh2YXIgbiA9IDA7IG4gPCAyNTY7IG4rKykgewogICAgICBjMiA9IG47CiAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgODsgaysrKSB7CiAgICAgICAgYzIgPSBjMiAmIDEgPyAzOTg4MjkyMzg0IF4gYzIgPj4+IDEgOiBjMiA+Pj4gMTsKICAgICAgfQogICAgICB0YWJsZVtuXSA9IGMyOwogICAgfQogICAgcmV0dXJuIHRhYmxlOwogIH0KICB2YXIgY3JjVGFibGUgPSBtYWtlVGFibGUoKTsKICBmdW5jdGlvbiBjcmMzMiQzKGNyYywgYnVmLCBsZW4yLCBwb3MpIHsKICAgIHZhciB0ID0gY3JjVGFibGUsIGVuZCA9IHBvcyArIGxlbjI7CiAgICBjcmMgXj0gLTE7CiAgICBmb3IgKHZhciBpMiA9IHBvczsgaTIgPCBlbmQ7IGkyKyspIHsKICAgICAgY3JjID0gY3JjID4+PiA4IF4gdFsoY3JjIF4gYnVmW2kyXSkgJiAyNTVdOwogICAgfQogICAgcmV0dXJuIGNyYyBeIC0xOwogIH0KICB2YXIgY3JjMzJfMSA9IGNyYzMyJDM7CiAgdmFyIG1lc3NhZ2VzID0gewogICAgMjogIm5lZWQgZGljdGlvbmFyeSIsCiAgICAxOiAic3RyZWFtIGVuZCIsCiAgICAwOiAiIiwKICAgICItMSI6ICJmaWxlIGVycm9yIiwKICAgICItMiI6ICJzdHJlYW0gZXJyb3IiLAogICAgIi0zIjogImRhdGEgZXJyb3IiLAogICAgIi00IjogImluc3VmZmljaWVudCBtZW1vcnkiLAogICAgIi01IjogImJ1ZmZlciBlcnJvciIsCiAgICAiLTYiOiAiaW5jb21wYXRpYmxlIHZlcnNpb24iCiAgfTsKICB2YXIgdXRpbHMkNSA9IGNvbW1vbjsKICB2YXIgdHJlZXMgPSB0cmVlcyQxOwogIHZhciBhZGxlcjMyJDEgPSBhZGxlcjMyXzE7CiAgdmFyIGNyYzMyJDIgPSBjcmMzMl8xOwogIHZhciBtc2ckMiA9IG1lc3NhZ2VzOwogIHZhciBaX05PX0ZMVVNIJDEgPSAwOwogIHZhciBaX1BBUlRJQUxfRkxVU0ggPSAxOwogIHZhciBaX0ZVTExfRkxVU0ggPSAzOwogIHZhciBaX0ZJTklTSCQyID0gNDsKICB2YXIgWl9CTE9DSyQxID0gNTsKICB2YXIgWl9PSyQyID0gMDsKICB2YXIgWl9TVFJFQU1fRU5EJDIgPSAxOwogIHZhciBaX1NUUkVBTV9FUlJPUiQxID0gLTI7CiAgdmFyIFpfREFUQV9FUlJPUiQxID0gLTM7CiAgdmFyIFpfQlVGX0VSUk9SJDEgPSAtNTsKICB2YXIgWl9ERUZBVUxUX0NPTVBSRVNTSU9OJDEgPSAtMTsKICB2YXIgWl9GSUxURVJFRCA9IDE7CiAgdmFyIFpfSFVGRk1BTl9PTkxZID0gMjsKICB2YXIgWl9STEUgPSAzOwogIHZhciBaX0ZJWEVEID0gNDsKICB2YXIgWl9ERUZBVUxUX1NUUkFURUdZJDEgPSAwOwogIHZhciBaX1VOS05PV04gPSAyOwogIHZhciBaX0RFRkxBVEVEJDIgPSA4OwogIHZhciBNQVhfTUVNX0xFVkVMID0gOTsKICB2YXIgTUFYX1dCSVRTJDEgPSAxNTsKICB2YXIgREVGX01FTV9MRVZFTCA9IDg7CiAgdmFyIExFTkdUSF9DT0RFUyA9IDI5OwogIHZhciBMSVRFUkFMUyA9IDI1NjsKICB2YXIgTF9DT0RFUyA9IExJVEVSQUxTICsgMSArIExFTkdUSF9DT0RFUzsKICB2YXIgRF9DT0RFUyA9IDMwOwogIHZhciBCTF9DT0RFUyA9IDE5OwogIHZhciBIRUFQX1NJWkUgPSAyICogTF9DT0RFUyArIDE7CiAgdmFyIE1BWF9CSVRTID0gMTU7CiAgdmFyIE1JTl9NQVRDSCA9IDM7CiAgdmFyIE1BWF9NQVRDSCA9IDI1ODsKICB2YXIgTUlOX0xPT0tBSEVBRCA9IE1BWF9NQVRDSCArIE1JTl9NQVRDSCArIDE7CiAgdmFyIFBSRVNFVF9ESUNUID0gMzI7CiAgdmFyIElOSVRfU1RBVEUgPSA0MjsKICB2YXIgRVhUUkFfU1RBVEUgPSA2OTsKICB2YXIgTkFNRV9TVEFURSA9IDczOwogIHZhciBDT01NRU5UX1NUQVRFID0gOTE7CiAgdmFyIEhDUkNfU1RBVEUgPSAxMDM7CiAgdmFyIEJVU1lfU1RBVEUgPSAxMTM7CiAgdmFyIEZJTklTSF9TVEFURSA9IDY2NjsKICB2YXIgQlNfTkVFRF9NT1JFID0gMTsKICB2YXIgQlNfQkxPQ0tfRE9ORSA9IDI7CiAgdmFyIEJTX0ZJTklTSF9TVEFSVEVEID0gMzsKICB2YXIgQlNfRklOSVNIX0RPTkUgPSA0OwogIHZhciBPU19DT0RFID0gMzsKICBmdW5jdGlvbiBlcnIoc3RybSwgZXJyb3JDb2RlKSB7CiAgICBzdHJtLm1zZyA9IG1zZyQyW2Vycm9yQ29kZV07CiAgICByZXR1cm4gZXJyb3JDb2RlOwogIH0KICBmdW5jdGlvbiByYW5rKGYpIHsKICAgIHJldHVybiAoZiA8PCAxKSAtIChmID4gNCA/IDkgOiAwKTsKICB9CiAgZnVuY3Rpb24gemVybyhidWYpIHsKICAgIHZhciBsZW4yID0gYnVmLmxlbmd0aDsKICAgIHdoaWxlICgtLWxlbjIgPj0gMCkgewogICAgICBidWZbbGVuMl0gPSAwOwogICAgfQogIH0KICBmdW5jdGlvbiBmbHVzaF9wZW5kaW5nKHN0cm0pIHsKICAgIHZhciBzID0gc3RybS5zdGF0ZTsKICAgIHZhciBsZW4yID0gcy5wZW5kaW5nOwogICAgaWYgKGxlbjIgPiBzdHJtLmF2YWlsX291dCkgewogICAgICBsZW4yID0gc3RybS5hdmFpbF9vdXQ7CiAgICB9CiAgICBpZiAobGVuMiA9PT0gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB1dGlscyQ1LmFycmF5U2V0KHN0cm0ub3V0cHV0LCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmdfb3V0LCBsZW4yLCBzdHJtLm5leHRfb3V0KTsKICAgIHN0cm0ubmV4dF9vdXQgKz0gbGVuMjsKICAgIHMucGVuZGluZ19vdXQgKz0gbGVuMjsKICAgIHN0cm0udG90YWxfb3V0ICs9IGxlbjI7CiAgICBzdHJtLmF2YWlsX291dCAtPSBsZW4yOwogICAgcy5wZW5kaW5nIC09IGxlbjI7CiAgICBpZiAocy5wZW5kaW5nID09PSAwKSB7CiAgICAgIHMucGVuZGluZ19vdXQgPSAwOwogICAgfQogIH0KICBmdW5jdGlvbiBmbHVzaF9ibG9ja19vbmx5KHMsIGxhc3QyKSB7CiAgICB0cmVlcy5fdHJfZmx1c2hfYmxvY2socywgcy5ibG9ja19zdGFydCA+PSAwID8gcy5ibG9ja19zdGFydCA6IC0xLCBzLnN0cnN0YXJ0IC0gcy5ibG9ja19zdGFydCwgbGFzdDIpOwogICAgcy5ibG9ja19zdGFydCA9IHMuc3Ryc3RhcnQ7CiAgICBmbHVzaF9wZW5kaW5nKHMuc3RybSk7CiAgfQogIGZ1bmN0aW9uIHB1dF9ieXRlKHMsIGIpIHsKICAgIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gYjsKICB9CiAgZnVuY3Rpb24gcHV0U2hvcnRNU0IocywgYikgewogICAgcy5wZW5kaW5nX2J1ZltzLnBlbmRpbmcrK10gPSBiID4+PiA4ICYgMjU1OwogICAgcy5wZW5kaW5nX2J1ZltzLnBlbmRpbmcrK10gPSBiICYgMjU1OwogIH0KICBmdW5jdGlvbiByZWFkX2J1ZihzdHJtLCBidWYsIHN0YXJ0LCBzaXplKSB7CiAgICB2YXIgbGVuMiA9IHN0cm0uYXZhaWxfaW47CiAgICBpZiAobGVuMiA+IHNpemUpIHsKICAgICAgbGVuMiA9IHNpemU7CiAgICB9CiAgICBpZiAobGVuMiA9PT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHN0cm0uYXZhaWxfaW4gLT0gbGVuMjsKICAgIHV0aWxzJDUuYXJyYXlTZXQoYnVmLCBzdHJtLmlucHV0LCBzdHJtLm5leHRfaW4sIGxlbjIsIHN0YXJ0KTsKICAgIGlmIChzdHJtLnN0YXRlLndyYXAgPT09IDEpIHsKICAgICAgc3RybS5hZGxlciA9IGFkbGVyMzIkMShzdHJtLmFkbGVyLCBidWYsIGxlbjIsIHN0YXJ0KTsKICAgIH0gZWxzZSBpZiAoc3RybS5zdGF0ZS53cmFwID09PSAyKSB7CiAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMiQyKHN0cm0uYWRsZXIsIGJ1ZiwgbGVuMiwgc3RhcnQpOwogICAgfQogICAgc3RybS5uZXh0X2luICs9IGxlbjI7CiAgICBzdHJtLnRvdGFsX2luICs9IGxlbjI7CiAgICByZXR1cm4gbGVuMjsKICB9CiAgZnVuY3Rpb24gbG9uZ2VzdF9tYXRjaChzLCBjdXJfbWF0Y2gpIHsKICAgIHZhciBjaGFpbl9sZW5ndGggPSBzLm1heF9jaGFpbl9sZW5ndGg7CiAgICB2YXIgc2NhbiA9IHMuc3Ryc3RhcnQ7CiAgICB2YXIgbWF0Y2gyOwogICAgdmFyIGxlbjI7CiAgICB2YXIgYmVzdF9sZW4gPSBzLnByZXZfbGVuZ3RoOwogICAgdmFyIG5pY2VfbWF0Y2ggPSBzLm5pY2VfbWF0Y2g7CiAgICB2YXIgbGltaXQgPSBzLnN0cnN0YXJ0ID4gcy53X3NpemUgLSBNSU5fTE9PS0FIRUFEID8gcy5zdHJzdGFydCAtIChzLndfc2l6ZSAtIE1JTl9MT09LQUhFQUQpIDogMDsKICAgIHZhciBfd2luID0gcy53aW5kb3c7CiAgICB2YXIgd21hc2sgPSBzLndfbWFzazsKICAgIHZhciBwcmV2ID0gcy5wcmV2OwogICAgdmFyIHN0cmVuZCA9IHMuc3Ryc3RhcnQgKyBNQVhfTUFUQ0g7CiAgICB2YXIgc2Nhbl9lbmQxID0gX3dpbltzY2FuICsgYmVzdF9sZW4gLSAxXTsKICAgIHZhciBzY2FuX2VuZCA9IF93aW5bc2NhbiArIGJlc3RfbGVuXTsKICAgIGlmIChzLnByZXZfbGVuZ3RoID49IHMuZ29vZF9tYXRjaCkgewogICAgICBjaGFpbl9sZW5ndGggPj49IDI7CiAgICB9CiAgICBpZiAobmljZV9tYXRjaCA+IHMubG9va2FoZWFkKSB7CiAgICAgIG5pY2VfbWF0Y2ggPSBzLmxvb2thaGVhZDsKICAgIH0KICAgIGRvIHsKICAgICAgbWF0Y2gyID0gY3VyX21hdGNoOwogICAgICBpZiAoX3dpblttYXRjaDIgKyBiZXN0X2xlbl0gIT09IHNjYW5fZW5kIHx8IF93aW5bbWF0Y2gyICsgYmVzdF9sZW4gLSAxXSAhPT0gc2Nhbl9lbmQxIHx8IF93aW5bbWF0Y2gyXSAhPT0gX3dpbltzY2FuXSB8fCBfd2luWysrbWF0Y2gyXSAhPT0gX3dpbltzY2FuICsgMV0pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBzY2FuICs9IDI7CiAgICAgIG1hdGNoMisrOwogICAgICBkbyB7CiAgICAgIH0gd2hpbGUgKF93aW5bKytzY2FuXSA9PT0gX3dpblsrK21hdGNoMl0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2gyXSAmJiBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaDJdICYmIF93aW5bKytzY2FuXSA9PT0gX3dpblsrK21hdGNoMl0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2gyXSAmJiBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaDJdICYmIF93aW5bKytzY2FuXSA9PT0gX3dpblsrK21hdGNoMl0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2gyXSAmJiBzY2FuIDwgc3RyZW5kKTsKICAgICAgbGVuMiA9IE1BWF9NQVRDSCAtIChzdHJlbmQgLSBzY2FuKTsKICAgICAgc2NhbiA9IHN0cmVuZCAtIE1BWF9NQVRDSDsKICAgICAgaWYgKGxlbjIgPiBiZXN0X2xlbikgewogICAgICAgIHMubWF0Y2hfc3RhcnQgPSBjdXJfbWF0Y2g7CiAgICAgICAgYmVzdF9sZW4gPSBsZW4yOwogICAgICAgIGlmIChsZW4yID49IG5pY2VfbWF0Y2gpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBzY2FuX2VuZDEgPSBfd2luW3NjYW4gKyBiZXN0X2xlbiAtIDFdOwogICAgICAgIHNjYW5fZW5kID0gX3dpbltzY2FuICsgYmVzdF9sZW5dOwogICAgICB9CiAgICB9IHdoaWxlICgoY3VyX21hdGNoID0gcHJldltjdXJfbWF0Y2ggJiB3bWFza10pID4gbGltaXQgJiYgLS1jaGFpbl9sZW5ndGggIT09IDApOwogICAgaWYgKGJlc3RfbGVuIDw9IHMubG9va2FoZWFkKSB7CiAgICAgIHJldHVybiBiZXN0X2xlbjsKICAgIH0KICAgIHJldHVybiBzLmxvb2thaGVhZDsKICB9CiAgZnVuY3Rpb24gZmlsbF93aW5kb3cocykgewogICAgdmFyIF93X3NpemUgPSBzLndfc2l6ZTsKICAgIHZhciBwLCBuLCBtLCBtb3JlLCBzdHI7CiAgICBkbyB7CiAgICAgIG1vcmUgPSBzLndpbmRvd19zaXplIC0gcy5sb29rYWhlYWQgLSBzLnN0cnN0YXJ0OwogICAgICBpZiAocy5zdHJzdGFydCA+PSBfd19zaXplICsgKF93X3NpemUgLSBNSU5fTE9PS0FIRUFEKSkgewogICAgICAgIHV0aWxzJDUuYXJyYXlTZXQocy53aW5kb3csIHMud2luZG93LCBfd19zaXplLCBfd19zaXplLCAwKTsKICAgICAgICBzLm1hdGNoX3N0YXJ0IC09IF93X3NpemU7CiAgICAgICAgcy5zdHJzdGFydCAtPSBfd19zaXplOwogICAgICAgIHMuYmxvY2tfc3RhcnQgLT0gX3dfc2l6ZTsKICAgICAgICBuID0gcy5oYXNoX3NpemU7CiAgICAgICAgcCA9IG47CiAgICAgICAgZG8gewogICAgICAgICAgbSA9IHMuaGVhZFstLXBdOwogICAgICAgICAgcy5oZWFkW3BdID0gbSA+PSBfd19zaXplID8gbSAtIF93X3NpemUgOiAwOwogICAgICAgIH0gd2hpbGUgKC0tbik7CiAgICAgICAgbiA9IF93X3NpemU7CiAgICAgICAgcCA9IG47CiAgICAgICAgZG8gewogICAgICAgICAgbSA9IHMucHJldlstLXBdOwogICAgICAgICAgcy5wcmV2W3BdID0gbSA+PSBfd19zaXplID8gbSAtIF93X3NpemUgOiAwOwogICAgICAgIH0gd2hpbGUgKC0tbik7CiAgICAgICAgbW9yZSArPSBfd19zaXplOwogICAgICB9CiAgICAgIGlmIChzLnN0cm0uYXZhaWxfaW4gPT09IDApIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBuID0gcmVhZF9idWYocy5zdHJtLCBzLndpbmRvdywgcy5zdHJzdGFydCArIHMubG9va2FoZWFkLCBtb3JlKTsKICAgICAgcy5sb29rYWhlYWQgKz0gbjsKICAgICAgaWYgKHMubG9va2FoZWFkICsgcy5pbnNlcnQgPj0gTUlOX01BVENIKSB7CiAgICAgICAgc3RyID0gcy5zdHJzdGFydCAtIHMuaW5zZXJ0OwogICAgICAgIHMuaW5zX2ggPSBzLndpbmRvd1tzdHJdOwogICAgICAgIHMuaW5zX2ggPSAocy5pbnNfaCA8PCBzLmhhc2hfc2hpZnQgXiBzLndpbmRvd1tzdHIgKyAxXSkgJiBzLmhhc2hfbWFzazsKICAgICAgICB3aGlsZSAocy5pbnNlcnQpIHsKICAgICAgICAgIHMuaW5zX2ggPSAocy5pbnNfaCA8PCBzLmhhc2hfc2hpZnQgXiBzLndpbmRvd1tzdHIgKyBNSU5fTUFUQ0ggLSAxXSkgJiBzLmhhc2hfbWFzazsKICAgICAgICAgIHMucHJldltzdHIgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgICBzLmhlYWRbcy5pbnNfaF0gPSBzdHI7CiAgICAgICAgICBzdHIrKzsKICAgICAgICAgIHMuaW5zZXJ0LS07CiAgICAgICAgICBpZiAocy5sb29rYWhlYWQgKyBzLmluc2VydCA8IE1JTl9NQVRDSCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0gd2hpbGUgKHMubG9va2FoZWFkIDwgTUlOX0xPT0tBSEVBRCAmJiBzLnN0cm0uYXZhaWxfaW4gIT09IDApOwogIH0KICBmdW5jdGlvbiBkZWZsYXRlX3N0b3JlZChzLCBmbHVzaDIpIHsKICAgIHZhciBtYXhfYmxvY2tfc2l6ZSA9IDY1NTM1OwogICAgaWYgKG1heF9ibG9ja19zaXplID4gcy5wZW5kaW5nX2J1Zl9zaXplIC0gNSkgewogICAgICBtYXhfYmxvY2tfc2l6ZSA9IHMucGVuZGluZ19idWZfc2l6ZSAtIDU7CiAgICB9CiAgICBmb3IgKDsgOyApIHsKICAgICAgaWYgKHMubG9va2FoZWFkIDw9IDEpIHsKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPT09IDAgJiYgZmx1c2gyID09PSBaX05PX0ZMVVNIJDEpIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHMuc3Ryc3RhcnQgKz0gcy5sb29rYWhlYWQ7CiAgICAgIHMubG9va2FoZWFkID0gMDsKICAgICAgdmFyIG1heF9zdGFydCA9IHMuYmxvY2tfc3RhcnQgKyBtYXhfYmxvY2tfc2l6ZTsKICAgICAgaWYgKHMuc3Ryc3RhcnQgPT09IDAgfHwgcy5zdHJzdGFydCA+PSBtYXhfc3RhcnQpIHsKICAgICAgICBzLmxvb2thaGVhZCA9IHMuc3Ryc3RhcnQgLSBtYXhfc3RhcnQ7CiAgICAgICAgcy5zdHJzdGFydCA9IG1heF9zdGFydDsKICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHMuc3Ryc3RhcnQgLSBzLmJsb2NrX3N0YXJ0ID49IHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkgewogICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcy5pbnNlcnQgPSAwOwogICAgaWYgKGZsdXNoMiA9PT0gWl9GSU5JU0gkMikgewogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIHRydWUpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19GSU5JU0hfU1RBUlRFRDsKICAgICAgfQogICAgICByZXR1cm4gQlNfRklOSVNIX0RPTkU7CiAgICB9CiAgICBpZiAocy5zdHJzdGFydCA+IHMuYmxvY2tfc3RhcnQpIHsKICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICB9CiAgZnVuY3Rpb24gZGVmbGF0ZV9mYXN0KHMsIGZsdXNoMikgewogICAgdmFyIGhhc2hfaGVhZDsKICAgIHZhciBiZmx1c2g7CiAgICBmb3IgKDsgOyApIHsKICAgICAgaWYgKHMubG9va2FoZWFkIDwgTUlOX0xPT0tBSEVBRCkgewogICAgICAgIGZpbGxfd2luZG93KHMpOwogICAgICAgIGlmIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQgJiYgZmx1c2gyID09PSBaX05PX0ZMVVNIJDEpIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGhhc2hfaGVhZCA9IDA7CiAgICAgIGlmIChzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICBzLmluc19oID0gKHMuaW5zX2ggPDwgcy5oYXNoX3NoaWZ0IF4gcy53aW5kb3dbcy5zdHJzdGFydCArIE1JTl9NQVRDSCAtIDFdKSAmIHMuaGFzaF9tYXNrOwogICAgICAgIGhhc2hfaGVhZCA9IHMucHJldltzLnN0cnN0YXJ0ICYgcy53X21hc2tdID0gcy5oZWFkW3MuaW5zX2hdOwogICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHMuc3Ryc3RhcnQ7CiAgICAgIH0KICAgICAgaWYgKGhhc2hfaGVhZCAhPT0gMCAmJiBzLnN0cnN0YXJ0IC0gaGFzaF9oZWFkIDw9IHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkgewogICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gbG9uZ2VzdF9tYXRjaChzLCBoYXNoX2hlYWQpOwogICAgICB9CiAgICAgIGlmIChzLm1hdGNoX2xlbmd0aCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICBiZmx1c2ggPSB0cmVlcy5fdHJfdGFsbHkocywgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQsIHMubWF0Y2hfbGVuZ3RoIC0gTUlOX01BVENIKTsKICAgICAgICBzLmxvb2thaGVhZCAtPSBzLm1hdGNoX2xlbmd0aDsKICAgICAgICBpZiAocy5tYXRjaF9sZW5ndGggPD0gcy5tYXhfbGF6eV9tYXRjaCAmJiBzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoLS07CiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHMuc3Ryc3RhcnQrKzsKICAgICAgICAgICAgcy5pbnNfaCA9IChzLmluc19oIDw8IHMuaGFzaF9zaGlmdCBeIHMud2luZG93W3Muc3Ryc3RhcnQgKyBNSU5fTUFUQ0ggLSAxXSkgJiBzLmhhc2hfbWFzazsKICAgICAgICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHMuc3Ryc3RhcnQ7CiAgICAgICAgICB9IHdoaWxlICgtLXMubWF0Y2hfbGVuZ3RoICE9PSAwKTsKICAgICAgICAgIHMuc3Ryc3RhcnQrKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcy5zdHJzdGFydCArPSBzLm1hdGNoX2xlbmd0aDsKICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gMDsKICAgICAgICAgIHMuaW5zX2ggPSBzLndpbmRvd1tzLnN0cnN0YXJ0XTsKICAgICAgICAgIHMuaW5zX2ggPSAocy5pbnNfaCA8PCBzLmhhc2hfc2hpZnQgXiBzLndpbmRvd1tzLnN0cnN0YXJ0ICsgMV0pICYgcy5oYXNoX21hc2s7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGJmbHVzaCA9IHRyZWVzLl90cl90YWxseShzLCAwLCBzLndpbmRvd1tzLnN0cnN0YXJ0XSk7CiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgIH0KICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcy5pbnNlcnQgPSBzLnN0cnN0YXJ0IDwgTUlOX01BVENIIC0gMSA/IHMuc3Ryc3RhcnQgOiBNSU5fTUFUQ0ggLSAxOwogICAgaWYgKGZsdXNoMiA9PT0gWl9GSU5JU0gkMikgewogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIHRydWUpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19GSU5JU0hfU1RBUlRFRDsKICAgICAgfQogICAgICByZXR1cm4gQlNfRklOSVNIX0RPTkU7CiAgICB9CiAgICBpZiAocy5sYXN0X2xpdCkgewogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKICB9CiAgZnVuY3Rpb24gZGVmbGF0ZV9zbG93KHMsIGZsdXNoMikgewogICAgdmFyIGhhc2hfaGVhZDsKICAgIHZhciBiZmx1c2g7CiAgICB2YXIgbWF4X2luc2VydDsKICAgIGZvciAoOyA7ICkgewogICAgICBpZiAocy5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFEKSB7CiAgICAgICAgZmlsbF93aW5kb3cocyk7CiAgICAgICAgaWYgKHMubG9va2FoZWFkIDwgTUlOX0xPT0tBSEVBRCAmJiBmbHVzaDIgPT09IFpfTk9fRkxVU0gkMSkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgICAgaWYgKHMubG9va2FoZWFkID09PSAwKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaGFzaF9oZWFkID0gMDsKICAgICAgaWYgKHMubG9va2FoZWFkID49IE1JTl9NQVRDSCkgewogICAgICAgIHMuaW5zX2ggPSAocy5pbnNfaCA8PCBzLmhhc2hfc2hpZnQgXiBzLndpbmRvd1tzLnN0cnN0YXJ0ICsgTUlOX01BVENIIC0gMV0pICYgcy5oYXNoX21hc2s7CiAgICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gcy5zdHJzdGFydDsKICAgICAgfQogICAgICBzLnByZXZfbGVuZ3RoID0gcy5tYXRjaF9sZW5ndGg7CiAgICAgIHMucHJldl9tYXRjaCA9IHMubWF0Y2hfc3RhcnQ7CiAgICAgIHMubWF0Y2hfbGVuZ3RoID0gTUlOX01BVENIIC0gMTsKICAgICAgaWYgKGhhc2hfaGVhZCAhPT0gMCAmJiBzLnByZXZfbGVuZ3RoIDwgcy5tYXhfbGF6eV9tYXRjaCAmJiBzLnN0cnN0YXJ0IC0gaGFzaF9oZWFkIDw9IHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkgewogICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gbG9uZ2VzdF9tYXRjaChzLCBoYXNoX2hlYWQpOwogICAgICAgIGlmIChzLm1hdGNoX2xlbmd0aCA8PSA1ICYmIChzLnN0cmF0ZWd5ID09PSBaX0ZJTFRFUkVEIHx8IHMubWF0Y2hfbGVuZ3RoID09PSBNSU5fTUFUQ0ggJiYgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQgPiA0MDk2KSkgewogICAgICAgICAgcy5tYXRjaF9sZW5ndGggPSBNSU5fTUFUQ0ggLSAxOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocy5wcmV2X2xlbmd0aCA+PSBNSU5fTUFUQ0ggJiYgcy5tYXRjaF9sZW5ndGggPD0gcy5wcmV2X2xlbmd0aCkgewogICAgICAgIG1heF9pbnNlcnQgPSBzLnN0cnN0YXJ0ICsgcy5sb29rYWhlYWQgLSBNSU5fTUFUQ0g7CiAgICAgICAgYmZsdXNoID0gdHJlZXMuX3RyX3RhbGx5KHMsIHMuc3Ryc3RhcnQgLSAxIC0gcy5wcmV2X21hdGNoLCBzLnByZXZfbGVuZ3RoIC0gTUlOX01BVENIKTsKICAgICAgICBzLmxvb2thaGVhZCAtPSBzLnByZXZfbGVuZ3RoIC0gMTsKICAgICAgICBzLnByZXZfbGVuZ3RoIC09IDI7CiAgICAgICAgZG8gewogICAgICAgICAgaWYgKCsrcy5zdHJzdGFydCA8PSBtYXhfaW5zZXJ0KSB7CiAgICAgICAgICAgIHMuaW5zX2ggPSAocy5pbnNfaCA8PCBzLmhhc2hfc2hpZnQgXiBzLndpbmRvd1tzLnN0cnN0YXJ0ICsgTUlOX01BVENIIC0gMV0pICYgcy5oYXNoX21hc2s7CiAgICAgICAgICAgIGhhc2hfaGVhZCA9IHMucHJldltzLnN0cnN0YXJ0ICYgcy53X21hc2tdID0gcy5oZWFkW3MuaW5zX2hdOwogICAgICAgICAgICBzLmhlYWRbcy5pbnNfaF0gPSBzLnN0cnN0YXJ0OwogICAgICAgICAgfQogICAgICAgIH0gd2hpbGUgKC0tcy5wcmV2X2xlbmd0aCAhPT0gMCk7CiAgICAgICAgcy5tYXRjaF9hdmFpbGFibGUgPSAwOwogICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gTUlOX01BVENIIC0gMTsKICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChzLm1hdGNoX2F2YWlsYWJsZSkgewogICAgICAgIGJmbHVzaCA9IHRyZWVzLl90cl90YWxseShzLCAwLCBzLndpbmRvd1tzLnN0cnN0YXJ0IC0gMV0pOwogICAgICAgIGlmIChiZmx1c2gpIHsKICAgICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgIH0KICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcy5tYXRjaF9hdmFpbGFibGUgPSAxOwogICAgICAgIHMuc3Ryc3RhcnQrKzsKICAgICAgICBzLmxvb2thaGVhZC0tOwogICAgICB9CiAgICB9CiAgICBpZiAocy5tYXRjaF9hdmFpbGFibGUpIHsKICAgICAgYmZsdXNoID0gdHJlZXMuX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnQgLSAxXSk7CiAgICAgIHMubWF0Y2hfYXZhaWxhYmxlID0gMDsKICAgIH0KICAgIHMuaW5zZXJ0ID0gcy5zdHJzdGFydCA8IE1JTl9NQVRDSCAtIDEgPyBzLnN0cnN0YXJ0IDogTUlOX01BVENIIC0gMTsKICAgIGlmIChmbHVzaDIgPT09IFpfRklOSVNIJDIpIHsKICAgICAgZmx1c2hfYmxvY2tfb25seShzLCB0cnVlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICAgIH0KICAgICAgcmV0dXJuIEJTX0ZJTklTSF9ET05FOwogICAgfQogICAgaWYgKHMubGFzdF9saXQpIHsKICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIEJTX0JMT0NLX0RPTkU7CiAgfQogIGZ1bmN0aW9uIGRlZmxhdGVfcmxlKHMsIGZsdXNoMikgewogICAgdmFyIGJmbHVzaDsKICAgIHZhciBwcmV2OwogICAgdmFyIHNjYW4sIHN0cmVuZDsKICAgIHZhciBfd2luID0gcy53aW5kb3c7CiAgICBmb3IgKDsgOyApIHsKICAgICAgaWYgKHMubG9va2FoZWFkIDw9IE1BWF9NQVRDSCkgewogICAgICAgIGZpbGxfd2luZG93KHMpOwogICAgICAgIGlmIChzLmxvb2thaGVhZCA8PSBNQVhfTUFUQ0ggJiYgZmx1c2gyID09PSBaX05PX0ZMVVNIJDEpIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHMubWF0Y2hfbGVuZ3RoID0gMDsKICAgICAgaWYgKHMubG9va2FoZWFkID49IE1JTl9NQVRDSCAmJiBzLnN0cnN0YXJ0ID4gMCkgewogICAgICAgIHNjYW4gPSBzLnN0cnN0YXJ0IC0gMTsKICAgICAgICBwcmV2ID0gX3dpbltzY2FuXTsKICAgICAgICBpZiAocHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHByZXYgPT09IF93aW5bKytzY2FuXSAmJiBwcmV2ID09PSBfd2luWysrc2Nhbl0pIHsKICAgICAgICAgIHN0cmVuZCA9IHMuc3Ryc3RhcnQgKyBNQVhfTUFUQ0g7CiAgICAgICAgICBkbyB7CiAgICAgICAgICB9IHdoaWxlIChwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHByZXYgPT09IF93aW5bKytzY2FuXSAmJiBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHByZXYgPT09IF93aW5bKytzY2FuXSAmJiBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHNjYW4gPCBzdHJlbmQpOwogICAgICAgICAgcy5tYXRjaF9sZW5ndGggPSBNQVhfTUFUQ0ggLSAoc3RyZW5kIC0gc2Nhbik7CiAgICAgICAgICBpZiAocy5tYXRjaF9sZW5ndGggPiBzLmxvb2thaGVhZCkgewogICAgICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IHMubG9va2FoZWFkOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocy5tYXRjaF9sZW5ndGggPj0gTUlOX01BVENIKSB7CiAgICAgICAgYmZsdXNoID0gdHJlZXMuX3RyX3RhbGx5KHMsIDEsIHMubWF0Y2hfbGVuZ3RoIC0gTUlOX01BVENIKTsKICAgICAgICBzLmxvb2thaGVhZCAtPSBzLm1hdGNoX2xlbmd0aDsKICAgICAgICBzLnN0cnN0YXJ0ICs9IHMubWF0Y2hfbGVuZ3RoOwogICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICBiZmx1c2ggPSB0cmVlcy5fdHJfdGFsbHkocywgMCwgcy53aW5kb3dbcy5zdHJzdGFydF0pOwogICAgICAgIHMubG9va2FoZWFkLS07CiAgICAgICAgcy5zdHJzdGFydCsrOwogICAgICB9CiAgICAgIGlmIChiZmx1c2gpIHsKICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHMuaW5zZXJ0ID0gMDsKICAgIGlmIChmbHVzaDIgPT09IFpfRklOSVNIJDIpIHsKICAgICAgZmx1c2hfYmxvY2tfb25seShzLCB0cnVlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICAgIH0KICAgICAgcmV0dXJuIEJTX0ZJTklTSF9ET05FOwogICAgfQogICAgaWYgKHMubGFzdF9saXQpIHsKICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIEJTX0JMT0NLX0RPTkU7CiAgfQogIGZ1bmN0aW9uIGRlZmxhdGVfaHVmZihzLCBmbHVzaDIpIHsKICAgIHZhciBiZmx1c2g7CiAgICBmb3IgKDsgOyApIHsKICAgICAgaWYgKHMubG9va2FoZWFkID09PSAwKSB7CiAgICAgICAgZmlsbF93aW5kb3cocyk7CiAgICAgICAgaWYgKHMubG9va2FoZWFkID09PSAwKSB7CiAgICAgICAgICBpZiAoZmx1c2gyID09PSBaX05PX0ZMVVNIJDEpIHsKICAgICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBzLm1hdGNoX2xlbmd0aCA9IDA7CiAgICAgIGJmbHVzaCA9IHRyZWVzLl90cl90YWxseShzLCAwLCBzLndpbmRvd1tzLnN0cnN0YXJ0XSk7CiAgICAgIHMubG9va2FoZWFkLS07CiAgICAgIHMuc3Ryc3RhcnQrKzsKICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcy5pbnNlcnQgPSAwOwogICAgaWYgKGZsdXNoMiA9PT0gWl9GSU5JU0gkMikgewogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIHRydWUpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19GSU5JU0hfU1RBUlRFRDsKICAgICAgfQogICAgICByZXR1cm4gQlNfRklOSVNIX0RPTkU7CiAgICB9CiAgICBpZiAocy5sYXN0X2xpdCkgewogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKICB9CiAgZnVuY3Rpb24gQ29uZmlnKGdvb2RfbGVuZ3RoLCBtYXhfbGF6eSwgbmljZV9sZW5ndGgsIG1heF9jaGFpbiwgZnVuYykgewogICAgdGhpcy5nb29kX2xlbmd0aCA9IGdvb2RfbGVuZ3RoOwogICAgdGhpcy5tYXhfbGF6eSA9IG1heF9sYXp5OwogICAgdGhpcy5uaWNlX2xlbmd0aCA9IG5pY2VfbGVuZ3RoOwogICAgdGhpcy5tYXhfY2hhaW4gPSBtYXhfY2hhaW47CiAgICB0aGlzLmZ1bmMgPSBmdW5jOwogIH0KICB2YXIgY29uZmlndXJhdGlvbl90YWJsZTsKICBjb25maWd1cmF0aW9uX3RhYmxlID0gWwogICAgbmV3IENvbmZpZygwLCAwLCAwLCAwLCBkZWZsYXRlX3N0b3JlZCksCiAgICBuZXcgQ29uZmlnKDQsIDQsIDgsIDQsIGRlZmxhdGVfZmFzdCksCiAgICBuZXcgQ29uZmlnKDQsIDUsIDE2LCA4LCBkZWZsYXRlX2Zhc3QpLAogICAgbmV3IENvbmZpZyg0LCA2LCAzMiwgMzIsIGRlZmxhdGVfZmFzdCksCiAgICBuZXcgQ29uZmlnKDQsIDQsIDE2LCAxNiwgZGVmbGF0ZV9zbG93KSwKICAgIG5ldyBDb25maWcoOCwgMTYsIDMyLCAzMiwgZGVmbGF0ZV9zbG93KSwKICAgIG5ldyBDb25maWcoOCwgMTYsIDEyOCwgMTI4LCBkZWZsYXRlX3Nsb3cpLAogICAgbmV3IENvbmZpZyg4LCAzMiwgMTI4LCAyNTYsIGRlZmxhdGVfc2xvdyksCiAgICBuZXcgQ29uZmlnKDMyLCAxMjgsIDI1OCwgMTAyNCwgZGVmbGF0ZV9zbG93KSwKICAgIG5ldyBDb25maWcoMzIsIDI1OCwgMjU4LCA0MDk2LCBkZWZsYXRlX3Nsb3cpCiAgXTsKICBmdW5jdGlvbiBsbV9pbml0KHMpIHsKICAgIHMud2luZG93X3NpemUgPSAyICogcy53X3NpemU7CiAgICB6ZXJvKHMuaGVhZCk7CiAgICBzLm1heF9sYXp5X21hdGNoID0gY29uZmlndXJhdGlvbl90YWJsZVtzLmxldmVsXS5tYXhfbGF6eTsKICAgIHMuZ29vZF9tYXRjaCA9IGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0uZ29vZF9sZW5ndGg7CiAgICBzLm5pY2VfbWF0Y2ggPSBjb25maWd1cmF0aW9uX3RhYmxlW3MubGV2ZWxdLm5pY2VfbGVuZ3RoOwogICAgcy5tYXhfY2hhaW5fbGVuZ3RoID0gY29uZmlndXJhdGlvbl90YWJsZVtzLmxldmVsXS5tYXhfY2hhaW47CiAgICBzLnN0cnN0YXJ0ID0gMDsKICAgIHMuYmxvY2tfc3RhcnQgPSAwOwogICAgcy5sb29rYWhlYWQgPSAwOwogICAgcy5pbnNlcnQgPSAwOwogICAgcy5tYXRjaF9sZW5ndGggPSBzLnByZXZfbGVuZ3RoID0gTUlOX01BVENIIC0gMTsKICAgIHMubWF0Y2hfYXZhaWxhYmxlID0gMDsKICAgIHMuaW5zX2ggPSAwOwogIH0KICBmdW5jdGlvbiBEZWZsYXRlU3RhdGUoKSB7CiAgICB0aGlzLnN0cm0gPSBudWxsOwogICAgdGhpcy5zdGF0dXMgPSAwOwogICAgdGhpcy5wZW5kaW5nX2J1ZiA9IG51bGw7CiAgICB0aGlzLnBlbmRpbmdfYnVmX3NpemUgPSAwOwogICAgdGhpcy5wZW5kaW5nX291dCA9IDA7CiAgICB0aGlzLnBlbmRpbmcgPSAwOwogICAgdGhpcy53cmFwID0gMDsKICAgIHRoaXMuZ3poZWFkID0gbnVsbDsKICAgIHRoaXMuZ3ppbmRleCA9IDA7CiAgICB0aGlzLm1ldGhvZCA9IFpfREVGTEFURUQkMjsKICAgIHRoaXMubGFzdF9mbHVzaCA9IC0xOwogICAgdGhpcy53X3NpemUgPSAwOwogICAgdGhpcy53X2JpdHMgPSAwOwogICAgdGhpcy53X21hc2sgPSAwOwogICAgdGhpcy53aW5kb3cgPSBudWxsOwogICAgdGhpcy53aW5kb3dfc2l6ZSA9IDA7CiAgICB0aGlzLnByZXYgPSBudWxsOwogICAgdGhpcy5oZWFkID0gbnVsbDsKICAgIHRoaXMuaW5zX2ggPSAwOwogICAgdGhpcy5oYXNoX3NpemUgPSAwOwogICAgdGhpcy5oYXNoX2JpdHMgPSAwOwogICAgdGhpcy5oYXNoX21hc2sgPSAwOwogICAgdGhpcy5oYXNoX3NoaWZ0ID0gMDsKICAgIHRoaXMuYmxvY2tfc3RhcnQgPSAwOwogICAgdGhpcy5tYXRjaF9sZW5ndGggPSAwOwogICAgdGhpcy5wcmV2X21hdGNoID0gMDsKICAgIHRoaXMubWF0Y2hfYXZhaWxhYmxlID0gMDsKICAgIHRoaXMuc3Ryc3RhcnQgPSAwOwogICAgdGhpcy5tYXRjaF9zdGFydCA9IDA7CiAgICB0aGlzLmxvb2thaGVhZCA9IDA7CiAgICB0aGlzLnByZXZfbGVuZ3RoID0gMDsKICAgIHRoaXMubWF4X2NoYWluX2xlbmd0aCA9IDA7CiAgICB0aGlzLm1heF9sYXp5X21hdGNoID0gMDsKICAgIHRoaXMubGV2ZWwgPSAwOwogICAgdGhpcy5zdHJhdGVneSA9IDA7CiAgICB0aGlzLmdvb2RfbWF0Y2ggPSAwOwogICAgdGhpcy5uaWNlX21hdGNoID0gMDsKICAgIHRoaXMuZHluX2x0cmVlID0gbmV3IHV0aWxzJDUuQnVmMTYoSEVBUF9TSVpFICogMik7CiAgICB0aGlzLmR5bl9kdHJlZSA9IG5ldyB1dGlscyQ1LkJ1ZjE2KCgyICogRF9DT0RFUyArIDEpICogMik7CiAgICB0aGlzLmJsX3RyZWUgPSBuZXcgdXRpbHMkNS5CdWYxNigoMiAqIEJMX0NPREVTICsgMSkgKiAyKTsKICAgIHplcm8odGhpcy5keW5fbHRyZWUpOwogICAgemVybyh0aGlzLmR5bl9kdHJlZSk7CiAgICB6ZXJvKHRoaXMuYmxfdHJlZSk7CiAgICB0aGlzLmxfZGVzYyA9IG51bGw7CiAgICB0aGlzLmRfZGVzYyA9IG51bGw7CiAgICB0aGlzLmJsX2Rlc2MgPSBudWxsOwogICAgdGhpcy5ibF9jb3VudCA9IG5ldyB1dGlscyQ1LkJ1ZjE2KE1BWF9CSVRTICsgMSk7CiAgICB0aGlzLmhlYXAgPSBuZXcgdXRpbHMkNS5CdWYxNigyICogTF9DT0RFUyArIDEpOwogICAgemVybyh0aGlzLmhlYXApOwogICAgdGhpcy5oZWFwX2xlbiA9IDA7CiAgICB0aGlzLmhlYXBfbWF4ID0gMDsKICAgIHRoaXMuZGVwdGggPSBuZXcgdXRpbHMkNS5CdWYxNigyICogTF9DT0RFUyArIDEpOwogICAgemVybyh0aGlzLmRlcHRoKTsKICAgIHRoaXMubF9idWYgPSAwOwogICAgdGhpcy5saXRfYnVmc2l6ZSA9IDA7CiAgICB0aGlzLmxhc3RfbGl0ID0gMDsKICAgIHRoaXMuZF9idWYgPSAwOwogICAgdGhpcy5vcHRfbGVuID0gMDsKICAgIHRoaXMuc3RhdGljX2xlbiA9IDA7CiAgICB0aGlzLm1hdGNoZXMgPSAwOwogICAgdGhpcy5pbnNlcnQgPSAwOwogICAgdGhpcy5iaV9idWYgPSAwOwogICAgdGhpcy5iaV92YWxpZCA9IDA7CiAgfQogIGZ1bmN0aW9uIGRlZmxhdGVSZXNldEtlZXAoc3RybSkgewogICAgdmFyIHM7CiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsKICAgICAgcmV0dXJuIGVycihzdHJtLCBaX1NUUkVBTV9FUlJPUiQxKTsKICAgIH0KICAgIHN0cm0udG90YWxfaW4gPSBzdHJtLnRvdGFsX291dCA9IDA7CiAgICBzdHJtLmRhdGFfdHlwZSA9IFpfVU5LTk9XTjsKICAgIHMgPSBzdHJtLnN0YXRlOwogICAgcy5wZW5kaW5nID0gMDsKICAgIHMucGVuZGluZ19vdXQgPSAwOwogICAgaWYgKHMud3JhcCA8IDApIHsKICAgICAgcy53cmFwID0gLXMud3JhcDsKICAgIH0KICAgIHMuc3RhdHVzID0gcy53cmFwID8gSU5JVF9TVEFURSA6IEJVU1lfU1RBVEU7CiAgICBzdHJtLmFkbGVyID0gcy53cmFwID09PSAyID8gMCA6IDE7CiAgICBzLmxhc3RfZmx1c2ggPSBaX05PX0ZMVVNIJDE7CiAgICB0cmVlcy5fdHJfaW5pdChzKTsKICAgIHJldHVybiBaX09LJDI7CiAgfQogIGZ1bmN0aW9uIGRlZmxhdGVSZXNldChzdHJtKSB7CiAgICB2YXIgcmV0ID0gZGVmbGF0ZVJlc2V0S2VlcChzdHJtKTsKICAgIGlmIChyZXQgPT09IFpfT0skMikgewogICAgICBsbV9pbml0KHN0cm0uc3RhdGUpOwogICAgfQogICAgcmV0dXJuIHJldDsKICB9CiAgZnVuY3Rpb24gZGVmbGF0ZVNldEhlYWRlcihzdHJtLCBoZWFkMikgewogICAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlKSB7CiAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOwogICAgfQogICAgaWYgKHN0cm0uc3RhdGUud3JhcCAhPT0gMikgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsKICAgIH0KICAgIHN0cm0uc3RhdGUuZ3poZWFkID0gaGVhZDI7CiAgICByZXR1cm4gWl9PSyQyOwogIH0KICBmdW5jdGlvbiBkZWZsYXRlSW5pdDIoc3RybSwgbGV2ZWwsIG1ldGhvZCwgd2luZG93Qml0cywgbWVtTGV2ZWwsIHN0cmF0ZWd5KSB7CiAgICBpZiAoIXN0cm0pIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7CiAgICB9CiAgICB2YXIgd3JhcDIgPSAxOwogICAgaWYgKGxldmVsID09PSBaX0RFRkFVTFRfQ09NUFJFU1NJT04kMSkgewogICAgICBsZXZlbCA9IDY7CiAgICB9CiAgICBpZiAod2luZG93Qml0cyA8IDApIHsKICAgICAgd3JhcDIgPSAwOwogICAgICB3aW5kb3dCaXRzID0gLXdpbmRvd0JpdHM7CiAgICB9IGVsc2UgaWYgKHdpbmRvd0JpdHMgPiAxNSkgewogICAgICB3cmFwMiA9IDI7CiAgICAgIHdpbmRvd0JpdHMgLT0gMTY7CiAgICB9CiAgICBpZiAobWVtTGV2ZWwgPCAxIHx8IG1lbUxldmVsID4gTUFYX01FTV9MRVZFTCB8fCBtZXRob2QgIT09IFpfREVGTEFURUQkMiB8fCB3aW5kb3dCaXRzIDwgOCB8fCB3aW5kb3dCaXRzID4gMTUgfHwgbGV2ZWwgPCAwIHx8IGxldmVsID4gOSB8fCBzdHJhdGVneSA8IDAgfHwgc3RyYXRlZ3kgPiBaX0ZJWEVEKSB7CiAgICAgIHJldHVybiBlcnIoc3RybSwgWl9TVFJFQU1fRVJST1IkMSk7CiAgICB9CiAgICBpZiAod2luZG93Qml0cyA9PT0gOCkgewogICAgICB3aW5kb3dCaXRzID0gOTsKICAgIH0KICAgIHZhciBzID0gbmV3IERlZmxhdGVTdGF0ZSgpOwogICAgc3RybS5zdGF0ZSA9IHM7CiAgICBzLnN0cm0gPSBzdHJtOwogICAgcy53cmFwID0gd3JhcDI7CiAgICBzLmd6aGVhZCA9IG51bGw7CiAgICBzLndfYml0cyA9IHdpbmRvd0JpdHM7CiAgICBzLndfc2l6ZSA9IDEgPDwgcy53X2JpdHM7CiAgICBzLndfbWFzayA9IHMud19zaXplIC0gMTsKICAgIHMuaGFzaF9iaXRzID0gbWVtTGV2ZWwgKyA3OwogICAgcy5oYXNoX3NpemUgPSAxIDw8IHMuaGFzaF9iaXRzOwogICAgcy5oYXNoX21hc2sgPSBzLmhhc2hfc2l6ZSAtIDE7CiAgICBzLmhhc2hfc2hpZnQgPSB+figocy5oYXNoX2JpdHMgKyBNSU5fTUFUQ0ggLSAxKSAvIE1JTl9NQVRDSCk7CiAgICBzLndpbmRvdyA9IG5ldyB1dGlscyQ1LkJ1Zjgocy53X3NpemUgKiAyKTsKICAgIHMuaGVhZCA9IG5ldyB1dGlscyQ1LkJ1ZjE2KHMuaGFzaF9zaXplKTsKICAgIHMucHJldiA9IG5ldyB1dGlscyQ1LkJ1ZjE2KHMud19zaXplKTsKICAgIHMubGl0X2J1ZnNpemUgPSAxIDw8IG1lbUxldmVsICsgNjsKICAgIHMucGVuZGluZ19idWZfc2l6ZSA9IHMubGl0X2J1ZnNpemUgKiA0OwogICAgcy5wZW5kaW5nX2J1ZiA9IG5ldyB1dGlscyQ1LkJ1Zjgocy5wZW5kaW5nX2J1Zl9zaXplKTsKICAgIHMuZF9idWYgPSAxICogcy5saXRfYnVmc2l6ZTsKICAgIHMubF9idWYgPSAoMSArIDIpICogcy5saXRfYnVmc2l6ZTsKICAgIHMubGV2ZWwgPSBsZXZlbDsKICAgIHMuc3RyYXRlZ3kgPSBzdHJhdGVneTsKICAgIHMubWV0aG9kID0gbWV0aG9kOwogICAgcmV0dXJuIGRlZmxhdGVSZXNldChzdHJtKTsKICB9CiAgZnVuY3Rpb24gZGVmbGF0ZUluaXQoc3RybSwgbGV2ZWwpIHsKICAgIHJldHVybiBkZWZsYXRlSW5pdDIoc3RybSwgbGV2ZWwsIFpfREVGTEFURUQkMiwgTUFYX1dCSVRTJDEsIERFRl9NRU1fTEVWRUwsIFpfREVGQVVMVF9TVFJBVEVHWSQxKTsKICB9CiAgZnVuY3Rpb24gZGVmbGF0ZSQyKHN0cm0sIGZsdXNoMikgewogICAgdmFyIG9sZF9mbHVzaCwgczsKICAgIHZhciBiZWcsIHZhbDsKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSB8fCBmbHVzaDIgPiBaX0JMT0NLJDEgfHwgZmx1c2gyIDwgMCkgewogICAgICByZXR1cm4gc3RybSA/IGVycihzdHJtLCBaX1NUUkVBTV9FUlJPUiQxKSA6IFpfU1RSRUFNX0VSUk9SJDE7CiAgICB9CiAgICBzID0gc3RybS5zdGF0ZTsKICAgIGlmICghc3RybS5vdXRwdXQgfHwgIXN0cm0uaW5wdXQgJiYgc3RybS5hdmFpbF9pbiAhPT0gMCB8fCBzLnN0YXR1cyA9PT0gRklOSVNIX1NUQVRFICYmIGZsdXNoMiAhPT0gWl9GSU5JU0gkMikgewogICAgICByZXR1cm4gZXJyKHN0cm0sIHN0cm0uYXZhaWxfb3V0ID09PSAwID8gWl9CVUZfRVJST1IkMSA6IFpfU1RSRUFNX0VSUk9SJDEpOwogICAgfQogICAgcy5zdHJtID0gc3RybTsKICAgIG9sZF9mbHVzaCA9IHMubGFzdF9mbHVzaDsKICAgIHMubGFzdF9mbHVzaCA9IGZsdXNoMjsKICAgIGlmIChzLnN0YXR1cyA9PT0gSU5JVF9TVEFURSkgewogICAgICBpZiAocy53cmFwID09PSAyKSB7CiAgICAgICAgc3RybS5hZGxlciA9IDA7CiAgICAgICAgcHV0X2J5dGUocywgMzEpOwogICAgICAgIHB1dF9ieXRlKHMsIDEzOSk7CiAgICAgICAgcHV0X2J5dGUocywgOCk7CiAgICAgICAgaWYgKCFzLmd6aGVhZCkgewogICAgICAgICAgcHV0X2J5dGUocywgMCk7CiAgICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIDApOwogICAgICAgICAgcHV0X2J5dGUocywgMCk7CiAgICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIHMubGV2ZWwgPT09IDkgPyAyIDogcy5zdHJhdGVneSA+PSBaX0hVRkZNQU5fT05MWSB8fCBzLmxldmVsIDwgMiA/IDQgOiAwKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIE9TX0NPREUpOwogICAgICAgICAgcy5zdGF0dXMgPSBCVVNZX1NUQVRFOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwdXRfYnl0ZShzLCAocy5nemhlYWQudGV4dCA/IDEgOiAwKSArIChzLmd6aGVhZC5oY3JjID8gMiA6IDApICsgKCFzLmd6aGVhZC5leHRyYSA/IDAgOiA0KSArICghcy5nemhlYWQubmFtZSA/IDAgOiA4KSArICghcy5nemhlYWQuY29tbWVudCA/IDAgOiAxNikpOwogICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQudGltZSAmIDI1NSk7CiAgICAgICAgICBwdXRfYnl0ZShzLCBzLmd6aGVhZC50aW1lID4+IDggJiAyNTUpOwogICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQudGltZSA+PiAxNiAmIDI1NSk7CiAgICAgICAgICBwdXRfYnl0ZShzLCBzLmd6aGVhZC50aW1lID4+IDI0ICYgMjU1KTsKICAgICAgICAgIHB1dF9ieXRlKHMsIHMubGV2ZWwgPT09IDkgPyAyIDogcy5zdHJhdGVneSA+PSBaX0hVRkZNQU5fT05MWSB8fCBzLmxldmVsIDwgMiA/IDQgOiAwKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIHMuZ3poZWFkLm9zICYgMjU1KTsKICAgICAgICAgIGlmIChzLmd6aGVhZC5leHRyYSAmJiBzLmd6aGVhZC5leHRyYS5sZW5ndGgpIHsKICAgICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQuZXh0cmEubGVuZ3RoICYgMjU1KTsKICAgICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQuZXh0cmEubGVuZ3RoID4+IDggJiAyNTUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMpIHsKICAgICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyJDIoc3RybS5hZGxlciwgcy5wZW5kaW5nX2J1Ziwgcy5wZW5kaW5nLCAwKTsKICAgICAgICAgIH0KICAgICAgICAgIHMuZ3ppbmRleCA9IDA7CiAgICAgICAgICBzLnN0YXR1cyA9IEVYVFJBX1NUQVRFOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgaGVhZGVyID0gWl9ERUZMQVRFRCQyICsgKHMud19iaXRzIC0gOCA8PCA0KSA8PCA4OwogICAgICAgIHZhciBsZXZlbF9mbGFncyA9IC0xOwogICAgICAgIGlmIChzLnN0cmF0ZWd5ID49IFpfSFVGRk1BTl9PTkxZIHx8IHMubGV2ZWwgPCAyKSB7CiAgICAgICAgICBsZXZlbF9mbGFncyA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChzLmxldmVsIDwgNikgewogICAgICAgICAgbGV2ZWxfZmxhZ3MgPSAxOwogICAgICAgIH0gZWxzZSBpZiAocy5sZXZlbCA9PT0gNikgewogICAgICAgICAgbGV2ZWxfZmxhZ3MgPSAyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsZXZlbF9mbGFncyA9IDM7CiAgICAgICAgfQogICAgICAgIGhlYWRlciB8PSBsZXZlbF9mbGFncyA8PCA2OwogICAgICAgIGlmIChzLnN0cnN0YXJ0ICE9PSAwKSB7CiAgICAgICAgICBoZWFkZXIgfD0gUFJFU0VUX0RJQ1Q7CiAgICAgICAgfQogICAgICAgIGhlYWRlciArPSAzMSAtIGhlYWRlciAlIDMxOwogICAgICAgIHMuc3RhdHVzID0gQlVTWV9TVEFURTsKICAgICAgICBwdXRTaG9ydE1TQihzLCBoZWFkZXIpOwogICAgICAgIGlmIChzLnN0cnN0YXJ0ICE9PSAwKSB7CiAgICAgICAgICBwdXRTaG9ydE1TQihzLCBzdHJtLmFkbGVyID4+PiAxNik7CiAgICAgICAgICBwdXRTaG9ydE1TQihzLCBzdHJtLmFkbGVyICYgNjU1MzUpOwogICAgICAgIH0KICAgICAgICBzdHJtLmFkbGVyID0gMTsKICAgICAgfQogICAgfQogICAgaWYgKHMuc3RhdHVzID09PSBFWFRSQV9TVEFURSkgewogICAgICBpZiAocy5nemhlYWQuZXh0cmEpIHsKICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgd2hpbGUgKHMuZ3ppbmRleCA8IChzLmd6aGVhZC5leHRyYS5sZW5ndGggJiA2NTUzNSkpIHsKICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICBpZiAocy5nemhlYWQuaGNyYyAmJiBzLnBlbmRpbmcgPiBiZWcpIHsKICAgICAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzIkMihzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgICAgICAgICAgYmVnID0gcy5wZW5kaW5nOwogICAgICAgICAgICBpZiAocy5wZW5kaW5nID09PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQuZXh0cmFbcy5nemluZGV4XSAmIDI1NSk7CiAgICAgICAgICBzLmd6aW5kZXgrKzsKICAgICAgICB9CiAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzIkMihzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgfQogICAgICAgIGlmIChzLmd6aW5kZXggPT09IHMuZ3poZWFkLmV4dHJhLmxlbmd0aCkgewogICAgICAgICAgcy5nemluZGV4ID0gMDsKICAgICAgICAgIHMuc3RhdHVzID0gTkFNRV9TVEFURTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcy5zdGF0dXMgPSBOQU1FX1NUQVRFOwogICAgICB9CiAgICB9CiAgICBpZiAocy5zdGF0dXMgPT09IE5BTUVfU1RBVEUpIHsKICAgICAgaWYgKHMuZ3poZWFkLm5hbWUpIHsKICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgZG8gewogICAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICAgIGlmIChzLmd6aGVhZC5oY3JjICYmIHMucGVuZGluZyA+IGJlZykgewogICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMiQyKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICAgIHZhbCA9IDE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzLmd6aW5kZXggPCBzLmd6aGVhZC5uYW1lLmxlbmd0aCkgewogICAgICAgICAgICB2YWwgPSBzLmd6aGVhZC5uYW1lLmNoYXJDb2RlQXQocy5nemluZGV4KyspICYgMjU1OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIHB1dF9ieXRlKHMsIHZhbCk7CiAgICAgICAgfSB3aGlsZSAodmFsICE9PSAwKTsKICAgICAgICBpZiAocy5nemhlYWQuaGNyYyAmJiBzLnBlbmRpbmcgPiBiZWcpIHsKICAgICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMiQyKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbCA9PT0gMCkgewogICAgICAgICAgcy5nemluZGV4ID0gMDsKICAgICAgICAgIHMuc3RhdHVzID0gQ09NTUVOVF9TVEFURTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcy5zdGF0dXMgPSBDT01NRU5UX1NUQVRFOwogICAgICB9CiAgICB9CiAgICBpZiAocy5zdGF0dXMgPT09IENPTU1FTlRfU1RBVEUpIHsKICAgICAgaWYgKHMuZ3poZWFkLmNvbW1lbnQpIHsKICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgZG8gewogICAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICAgIGlmIChzLmd6aGVhZC5oY3JjICYmIHMucGVuZGluZyA+IGJlZykgewogICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMiQyKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICAgIHZhbCA9IDE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzLmd6aW5kZXggPCBzLmd6aGVhZC5jb21tZW50Lmxlbmd0aCkgewogICAgICAgICAgICB2YWwgPSBzLmd6aGVhZC5jb21tZW50LmNoYXJDb2RlQXQocy5nemluZGV4KyspICYgMjU1OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIHB1dF9ieXRlKHMsIHZhbCk7CiAgICAgICAgfSB3aGlsZSAodmFsICE9PSAwKTsKICAgICAgICBpZiAocy5nemhlYWQuaGNyYyAmJiBzLnBlbmRpbmcgPiBiZWcpIHsKICAgICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMiQyKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbCA9PT0gMCkgewogICAgICAgICAgcy5zdGF0dXMgPSBIQ1JDX1NUQVRFOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzLnN0YXR1cyA9IEhDUkNfU1RBVEU7CiAgICAgIH0KICAgIH0KICAgIGlmIChzLnN0YXR1cyA9PT0gSENSQ19TVEFURSkgewogICAgICBpZiAocy5nemhlYWQuaGNyYykgewogICAgICAgIGlmIChzLnBlbmRpbmcgKyAyID4gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgIH0KICAgICAgICBpZiAocy5wZW5kaW5nICsgMiA8PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgIHB1dF9ieXRlKHMsIHN0cm0uYWRsZXIgJiAyNTUpOwogICAgICAgICAgcHV0X2J5dGUocywgc3RybS5hZGxlciA+PiA4ICYgMjU1KTsKICAgICAgICAgIHN0cm0uYWRsZXIgPSAwOwogICAgICAgICAgcy5zdGF0dXMgPSBCVVNZX1NUQVRFOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzLnN0YXR1cyA9IEJVU1lfU1RBVEU7CiAgICAgIH0KICAgIH0KICAgIGlmIChzLnBlbmRpbmcgIT09IDApIHsKICAgICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgcy5sYXN0X2ZsdXNoID0gLTE7CiAgICAgICAgcmV0dXJuIFpfT0skMjsKICAgICAgfQogICAgfSBlbHNlIGlmIChzdHJtLmF2YWlsX2luID09PSAwICYmIHJhbmsoZmx1c2gyKSA8PSByYW5rKG9sZF9mbHVzaCkgJiYgZmx1c2gyICE9PSBaX0ZJTklTSCQyKSB7CiAgICAgIHJldHVybiBlcnIoc3RybSwgWl9CVUZfRVJST1IkMSk7CiAgICB9CiAgICBpZiAocy5zdGF0dXMgPT09IEZJTklTSF9TVEFURSAmJiBzdHJtLmF2YWlsX2luICE9PSAwKSB7CiAgICAgIHJldHVybiBlcnIoc3RybSwgWl9CVUZfRVJST1IkMSk7CiAgICB9CiAgICBpZiAoc3RybS5hdmFpbF9pbiAhPT0gMCB8fCBzLmxvb2thaGVhZCAhPT0gMCB8fCBmbHVzaDIgIT09IFpfTk9fRkxVU0gkMSAmJiBzLnN0YXR1cyAhPT0gRklOSVNIX1NUQVRFKSB7CiAgICAgIHZhciBic3RhdGUgPSBzLnN0cmF0ZWd5ID09PSBaX0hVRkZNQU5fT05MWSA/IGRlZmxhdGVfaHVmZihzLCBmbHVzaDIpIDogcy5zdHJhdGVneSA9PT0gWl9STEUgPyBkZWZsYXRlX3JsZShzLCBmbHVzaDIpIDogY29uZmlndXJhdGlvbl90YWJsZVtzLmxldmVsXS5mdW5jKHMsIGZsdXNoMik7CiAgICAgIGlmIChic3RhdGUgPT09IEJTX0ZJTklTSF9TVEFSVEVEIHx8IGJzdGF0ZSA9PT0gQlNfRklOSVNIX0RPTkUpIHsKICAgICAgICBzLnN0YXR1cyA9IEZJTklTSF9TVEFURTsKICAgICAgfQogICAgICBpZiAoYnN0YXRlID09PSBCU19ORUVEX01PUkUgfHwgYnN0YXRlID09PSBCU19GSU5JU0hfU1RBUlRFRCkgewogICAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcy5sYXN0X2ZsdXNoID0gLTE7CiAgICAgICAgfQogICAgICAgIHJldHVybiBaX09LJDI7CiAgICAgIH0KICAgICAgaWYgKGJzdGF0ZSA9PT0gQlNfQkxPQ0tfRE9ORSkgewogICAgICAgIGlmIChmbHVzaDIgPT09IFpfUEFSVElBTF9GTFVTSCkgewogICAgICAgICAgdHJlZXMuX3RyX2FsaWduKHMpOwogICAgICAgIH0gZWxzZSBpZiAoZmx1c2gyICE9PSBaX0JMT0NLJDEpIHsKICAgICAgICAgIHRyZWVzLl90cl9zdG9yZWRfYmxvY2socywgMCwgMCwgZmFsc2UpOwogICAgICAgICAgaWYgKGZsdXNoMiA9PT0gWl9GVUxMX0ZMVVNIKSB7CiAgICAgICAgICAgIHplcm8ocy5oZWFkKTsKICAgICAgICAgICAgaWYgKHMubG9va2FoZWFkID09PSAwKSB7CiAgICAgICAgICAgICAgcy5zdHJzdGFydCA9IDA7CiAgICAgICAgICAgICAgcy5ibG9ja19zdGFydCA9IDA7CiAgICAgICAgICAgICAgcy5pbnNlcnQgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZsdXNoX3BlbmRpbmcoc3RybSk7CiAgICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICBzLmxhc3RfZmx1c2ggPSAtMTsKICAgICAgICAgIHJldHVybiBaX09LJDI7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoZmx1c2gyICE9PSBaX0ZJTklTSCQyKSB7CiAgICAgIHJldHVybiBaX09LJDI7CiAgICB9CiAgICBpZiAocy53cmFwIDw9IDApIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VORCQyOwogICAgfQogICAgaWYgKHMud3JhcCA9PT0gMikgewogICAgICBwdXRfYnl0ZShzLCBzdHJtLmFkbGVyICYgMjU1KTsKICAgICAgcHV0X2J5dGUocywgc3RybS5hZGxlciA+PiA4ICYgMjU1KTsKICAgICAgcHV0X2J5dGUocywgc3RybS5hZGxlciA+PiAxNiAmIDI1NSk7CiAgICAgIHB1dF9ieXRlKHMsIHN0cm0uYWRsZXIgPj4gMjQgJiAyNTUpOwogICAgICBwdXRfYnl0ZShzLCBzdHJtLnRvdGFsX2luICYgMjU1KTsKICAgICAgcHV0X2J5dGUocywgc3RybS50b3RhbF9pbiA+PiA4ICYgMjU1KTsKICAgICAgcHV0X2J5dGUocywgc3RybS50b3RhbF9pbiA+PiAxNiAmIDI1NSk7CiAgICAgIHB1dF9ieXRlKHMsIHN0cm0udG90YWxfaW4gPj4gMjQgJiAyNTUpOwogICAgfSBlbHNlIHsKICAgICAgcHV0U2hvcnRNU0Iocywgc3RybS5hZGxlciA+Pj4gMTYpOwogICAgICBwdXRTaG9ydE1TQihzLCBzdHJtLmFkbGVyICYgNjU1MzUpOwogICAgfQogICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgIGlmIChzLndyYXAgPiAwKSB7CiAgICAgIHMud3JhcCA9IC1zLndyYXA7CiAgICB9CiAgICByZXR1cm4gcy5wZW5kaW5nICE9PSAwID8gWl9PSyQyIDogWl9TVFJFQU1fRU5EJDI7CiAgfQogIGZ1bmN0aW9uIGRlZmxhdGVFbmQoc3RybSkgewogICAgdmFyIHN0YXR1czsKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsKICAgIH0KICAgIHN0YXR1cyA9IHN0cm0uc3RhdGUuc3RhdHVzOwogICAgaWYgKHN0YXR1cyAhPT0gSU5JVF9TVEFURSAmJiBzdGF0dXMgIT09IEVYVFJBX1NUQVRFICYmIHN0YXR1cyAhPT0gTkFNRV9TVEFURSAmJiBzdGF0dXMgIT09IENPTU1FTlRfU1RBVEUgJiYgc3RhdHVzICE9PSBIQ1JDX1NUQVRFICYmIHN0YXR1cyAhPT0gQlVTWV9TVEFURSAmJiBzdGF0dXMgIT09IEZJTklTSF9TVEFURSkgewogICAgICByZXR1cm4gZXJyKHN0cm0sIFpfU1RSRUFNX0VSUk9SJDEpOwogICAgfQogICAgc3RybS5zdGF0ZSA9IG51bGw7CiAgICByZXR1cm4gc3RhdHVzID09PSBCVVNZX1NUQVRFID8gZXJyKHN0cm0sIFpfREFUQV9FUlJPUiQxKSA6IFpfT0skMjsKICB9CiAgZnVuY3Rpb24gZGVmbGF0ZVNldERpY3Rpb25hcnkoc3RybSwgZGljdGlvbmFyeSkgewogICAgdmFyIGRpY3RMZW5ndGggPSBkaWN0aW9uYXJ5Lmxlbmd0aDsKICAgIHZhciBzOwogICAgdmFyIHN0ciwgbjsKICAgIHZhciB3cmFwMjsKICAgIHZhciBhdmFpbDsKICAgIHZhciBuZXh0OwogICAgdmFyIGlucHV0OwogICAgdmFyIHRtcERpY3Q7CiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7CiAgICB9CiAgICBzID0gc3RybS5zdGF0ZTsKICAgIHdyYXAyID0gcy53cmFwOwogICAgaWYgKHdyYXAyID09PSAyIHx8IHdyYXAyID09PSAxICYmIHMuc3RhdHVzICE9PSBJTklUX1NUQVRFIHx8IHMubG9va2FoZWFkKSB7CiAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOwogICAgfQogICAgaWYgKHdyYXAyID09PSAxKSB7CiAgICAgIHN0cm0uYWRsZXIgPSBhZGxlcjMyJDEoc3RybS5hZGxlciwgZGljdGlvbmFyeSwgZGljdExlbmd0aCwgMCk7CiAgICB9CiAgICBzLndyYXAgPSAwOwogICAgaWYgKGRpY3RMZW5ndGggPj0gcy53X3NpemUpIHsKICAgICAgaWYgKHdyYXAyID09PSAwKSB7CiAgICAgICAgemVybyhzLmhlYWQpOwogICAgICAgIHMuc3Ryc3RhcnQgPSAwOwogICAgICAgIHMuYmxvY2tfc3RhcnQgPSAwOwogICAgICAgIHMuaW5zZXJ0ID0gMDsKICAgICAgfQogICAgICB0bXBEaWN0ID0gbmV3IHV0aWxzJDUuQnVmOChzLndfc2l6ZSk7CiAgICAgIHV0aWxzJDUuYXJyYXlTZXQodG1wRGljdCwgZGljdGlvbmFyeSwgZGljdExlbmd0aCAtIHMud19zaXplLCBzLndfc2l6ZSwgMCk7CiAgICAgIGRpY3Rpb25hcnkgPSB0bXBEaWN0OwogICAgICBkaWN0TGVuZ3RoID0gcy53X3NpemU7CiAgICB9CiAgICBhdmFpbCA9IHN0cm0uYXZhaWxfaW47CiAgICBuZXh0ID0gc3RybS5uZXh0X2luOwogICAgaW5wdXQgPSBzdHJtLmlucHV0OwogICAgc3RybS5hdmFpbF9pbiA9IGRpY3RMZW5ndGg7CiAgICBzdHJtLm5leHRfaW4gPSAwOwogICAgc3RybS5pbnB1dCA9IGRpY3Rpb25hcnk7CiAgICBmaWxsX3dpbmRvdyhzKTsKICAgIHdoaWxlIChzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgc3RyID0gcy5zdHJzdGFydDsKICAgICAgbiA9IHMubG9va2FoZWFkIC0gKE1JTl9NQVRDSCAtIDEpOwogICAgICBkbyB7CiAgICAgICAgcy5pbnNfaCA9IChzLmluc19oIDw8IHMuaGFzaF9zaGlmdCBeIHMud2luZG93W3N0ciArIE1JTl9NQVRDSCAtIDFdKSAmIHMuaGFzaF9tYXNrOwogICAgICAgIHMucHJldltzdHIgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gc3RyOwogICAgICAgIHN0cisrOwogICAgICB9IHdoaWxlICgtLW4pOwogICAgICBzLnN0cnN0YXJ0ID0gc3RyOwogICAgICBzLmxvb2thaGVhZCA9IE1JTl9NQVRDSCAtIDE7CiAgICAgIGZpbGxfd2luZG93KHMpOwogICAgfQogICAgcy5zdHJzdGFydCArPSBzLmxvb2thaGVhZDsKICAgIHMuYmxvY2tfc3RhcnQgPSBzLnN0cnN0YXJ0OwogICAgcy5pbnNlcnQgPSBzLmxvb2thaGVhZDsKICAgIHMubG9va2FoZWFkID0gMDsKICAgIHMubWF0Y2hfbGVuZ3RoID0gcy5wcmV2X2xlbmd0aCA9IE1JTl9NQVRDSCAtIDE7CiAgICBzLm1hdGNoX2F2YWlsYWJsZSA9IDA7CiAgICBzdHJtLm5leHRfaW4gPSBuZXh0OwogICAgc3RybS5pbnB1dCA9IGlucHV0OwogICAgc3RybS5hdmFpbF9pbiA9IGF2YWlsOwogICAgcy53cmFwID0gd3JhcDI7CiAgICByZXR1cm4gWl9PSyQyOwogIH0KICBkZWZsYXRlJDMuZGVmbGF0ZUluaXQgPSBkZWZsYXRlSW5pdDsKICBkZWZsYXRlJDMuZGVmbGF0ZUluaXQyID0gZGVmbGF0ZUluaXQyOwogIGRlZmxhdGUkMy5kZWZsYXRlUmVzZXQgPSBkZWZsYXRlUmVzZXQ7CiAgZGVmbGF0ZSQzLmRlZmxhdGVSZXNldEtlZXAgPSBkZWZsYXRlUmVzZXRLZWVwOwogIGRlZmxhdGUkMy5kZWZsYXRlU2V0SGVhZGVyID0gZGVmbGF0ZVNldEhlYWRlcjsKICBkZWZsYXRlJDMuZGVmbGF0ZSA9IGRlZmxhdGUkMjsKICBkZWZsYXRlJDMuZGVmbGF0ZUVuZCA9IGRlZmxhdGVFbmQ7CiAgZGVmbGF0ZSQzLmRlZmxhdGVTZXREaWN0aW9uYXJ5ID0gZGVmbGF0ZVNldERpY3Rpb25hcnk7CiAgZGVmbGF0ZSQzLmRlZmxhdGVJbmZvID0gInBha28gZGVmbGF0ZSAoZnJvbSBOb2RlY2EgcHJvamVjdCkiOwogIHZhciBzdHJpbmdzJDIgPSB7fTsKICB2YXIgdXRpbHMkNCA9IGNvbW1vbjsKICB2YXIgU1RSX0FQUExZX09LID0gdHJ1ZTsKICB2YXIgU1RSX0FQUExZX1VJQV9PSyA9IHRydWU7CiAgdHJ5IHsKICAgIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgWzBdKTsKICB9IGNhdGNoIChfXykgewogICAgU1RSX0FQUExZX09LID0gZmFsc2U7CiAgfQogIHRyeSB7CiAgICBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIG5ldyBVaW50OEFycmF5KDEpKTsKICB9IGNhdGNoIChfXykgewogICAgU1RSX0FQUExZX1VJQV9PSyA9IGZhbHNlOwogIH0KICB2YXIgX3V0ZjhsZW4gPSBuZXcgdXRpbHMkNC5CdWY4KDI1Nik7CiAgZm9yICh2YXIgcSA9IDA7IHEgPCAyNTY7IHErKykgewogICAgX3V0ZjhsZW5bcV0gPSBxID49IDI1MiA/IDYgOiBxID49IDI0OCA/IDUgOiBxID49IDI0MCA/IDQgOiBxID49IDIyNCA/IDMgOiBxID49IDE5MiA/IDIgOiAxOwogIH0KICBfdXRmOGxlblsyNTRdID0gX3V0ZjhsZW5bMjU0XSA9IDE7CiAgc3RyaW5ncyQyLnN0cmluZzJidWYgPSBmdW5jdGlvbihzdHIpIHsKICAgIHZhciBidWYsIGMyLCBjMjIsIG1fcG9zLCBpMiwgc3RyX2xlbiA9IHN0ci5sZW5ndGgsIGJ1Zl9sZW4gPSAwOwogICAgZm9yIChtX3BvcyA9IDA7IG1fcG9zIDwgc3RyX2xlbjsgbV9wb3MrKykgewogICAgICBjMiA9IHN0ci5jaGFyQ29kZUF0KG1fcG9zKTsKICAgICAgaWYgKChjMiAmIDY0NTEyKSA9PT0gNTUyOTYgJiYgbV9wb3MgKyAxIDwgc3RyX2xlbikgewogICAgICAgIGMyMiA9IHN0ci5jaGFyQ29kZUF0KG1fcG9zICsgMSk7CiAgICAgICAgaWYgKChjMjIgJiA2NDUxMikgPT09IDU2MzIwKSB7CiAgICAgICAgICBjMiA9IDY1NTM2ICsgKGMyIC0gNTUyOTYgPDwgMTApICsgKGMyMiAtIDU2MzIwKTsKICAgICAgICAgIG1fcG9zKys7CiAgICAgICAgfQogICAgICB9CiAgICAgIGJ1Zl9sZW4gKz0gYzIgPCAxMjggPyAxIDogYzIgPCAyMDQ4ID8gMiA6IGMyIDwgNjU1MzYgPyAzIDogNDsKICAgIH0KICAgIGJ1ZiA9IG5ldyB1dGlscyQ0LkJ1ZjgoYnVmX2xlbik7CiAgICBmb3IgKGkyID0gMCwgbV9wb3MgPSAwOyBpMiA8IGJ1Zl9sZW47IG1fcG9zKyspIHsKICAgICAgYzIgPSBzdHIuY2hhckNvZGVBdChtX3Bvcyk7CiAgICAgIGlmICgoYzIgJiA2NDUxMikgPT09IDU1Mjk2ICYmIG1fcG9zICsgMSA8IHN0cl9sZW4pIHsKICAgICAgICBjMjIgPSBzdHIuY2hhckNvZGVBdChtX3BvcyArIDEpOwogICAgICAgIGlmICgoYzIyICYgNjQ1MTIpID09PSA1NjMyMCkgewogICAgICAgICAgYzIgPSA2NTUzNiArIChjMiAtIDU1Mjk2IDw8IDEwKSArIChjMjIgLSA1NjMyMCk7CiAgICAgICAgICBtX3BvcysrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoYzIgPCAxMjgpIHsKICAgICAgICBidWZbaTIrK10gPSBjMjsKICAgICAgfSBlbHNlIGlmIChjMiA8IDIwNDgpIHsKICAgICAgICBidWZbaTIrK10gPSAxOTIgfCBjMiA+Pj4gNjsKICAgICAgICBidWZbaTIrK10gPSAxMjggfCBjMiAmIDYzOwogICAgICB9IGVsc2UgaWYgKGMyIDwgNjU1MzYpIHsKICAgICAgICBidWZbaTIrK10gPSAyMjQgfCBjMiA+Pj4gMTI7CiAgICAgICAgYnVmW2kyKytdID0gMTI4IHwgYzIgPj4+IDYgJiA2MzsKICAgICAgICBidWZbaTIrK10gPSAxMjggfCBjMiAmIDYzOwogICAgICB9IGVsc2UgewogICAgICAgIGJ1ZltpMisrXSA9IDI0MCB8IGMyID4+PiAxODsKICAgICAgICBidWZbaTIrK10gPSAxMjggfCBjMiA+Pj4gMTIgJiA2MzsKICAgICAgICBidWZbaTIrK10gPSAxMjggfCBjMiA+Pj4gNiAmIDYzOwogICAgICAgIGJ1ZltpMisrXSA9IDEyOCB8IGMyICYgNjM7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBidWY7CiAgfTsKICBmdW5jdGlvbiBidWYyYmluc3RyaW5nKGJ1ZiwgbGVuMikgewogICAgaWYgKGxlbjIgPCA2NTUzNCkgewogICAgICBpZiAoYnVmLnN1YmFycmF5ICYmIFNUUl9BUFBMWV9VSUFfT0sgfHwgIWJ1Zi5zdWJhcnJheSAmJiBTVFJfQVBQTFlfT0spIHsKICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCB1dGlscyQ0LnNocmlua0J1ZihidWYsIGxlbjIpKTsKICAgICAgfQogICAgfQogICAgdmFyIHJlc3VsdCA9ICIiOwogICAgZm9yICh2YXIgaTIgPSAwOyBpMiA8IGxlbjI7IGkyKyspIHsKICAgICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnVmW2kyXSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICBzdHJpbmdzJDIuYnVmMmJpbnN0cmluZyA9IGZ1bmN0aW9uKGJ1ZikgewogICAgcmV0dXJuIGJ1ZjJiaW5zdHJpbmcoYnVmLCBidWYubGVuZ3RoKTsKICB9OwogIHN0cmluZ3MkMi5iaW5zdHJpbmcyYnVmID0gZnVuY3Rpb24oc3RyKSB7CiAgICB2YXIgYnVmID0gbmV3IHV0aWxzJDQuQnVmOChzdHIubGVuZ3RoKTsKICAgIGZvciAodmFyIGkyID0gMCwgbGVuMiA9IGJ1Zi5sZW5ndGg7IGkyIDwgbGVuMjsgaTIrKykgewogICAgICBidWZbaTJdID0gc3RyLmNoYXJDb2RlQXQoaTIpOwogICAgfQogICAgcmV0dXJuIGJ1ZjsKICB9OwogIHN0cmluZ3MkMi5idWYyc3RyaW5nID0gZnVuY3Rpb24oYnVmLCBtYXgyKSB7CiAgICB2YXIgaTIsIG91dCwgYzIsIGNfbGVuOwogICAgdmFyIGxlbjIgPSBtYXgyIHx8IGJ1Zi5sZW5ndGg7CiAgICB2YXIgdXRmMTZidWYgPSBuZXcgQXJyYXkobGVuMiAqIDIpOwogICAgZm9yIChvdXQgPSAwLCBpMiA9IDA7IGkyIDwgbGVuMjsgKSB7CiAgICAgIGMyID0gYnVmW2kyKytdOwogICAgICBpZiAoYzIgPCAxMjgpIHsKICAgICAgICB1dGYxNmJ1ZltvdXQrK10gPSBjMjsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjX2xlbiA9IF91dGY4bGVuW2MyXTsKICAgICAgaWYgKGNfbGVuID4gNCkgewogICAgICAgIHV0ZjE2YnVmW291dCsrXSA9IDY1NTMzOwogICAgICAgIGkyICs9IGNfbGVuIC0gMTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjMiAmPSBjX2xlbiA9PT0gMiA/IDMxIDogY19sZW4gPT09IDMgPyAxNSA6IDc7CiAgICAgIHdoaWxlIChjX2xlbiA+IDEgJiYgaTIgPCBsZW4yKSB7CiAgICAgICAgYzIgPSBjMiA8PCA2IHwgYnVmW2kyKytdICYgNjM7CiAgICAgICAgY19sZW4tLTsKICAgICAgfQogICAgICBpZiAoY19sZW4gPiAxKSB7CiAgICAgICAgdXRmMTZidWZbb3V0KytdID0gNjU1MzM7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGMyIDwgNjU1MzYpIHsKICAgICAgICB1dGYxNmJ1ZltvdXQrK10gPSBjMjsKICAgICAgfSBlbHNlIHsKICAgICAgICBjMiAtPSA2NTUzNjsKICAgICAgICB1dGYxNmJ1ZltvdXQrK10gPSA1NTI5NiB8IGMyID4+IDEwICYgMTAyMzsKICAgICAgICB1dGYxNmJ1ZltvdXQrK10gPSA1NjMyMCB8IGMyICYgMTAyMzsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGJ1ZjJiaW5zdHJpbmcodXRmMTZidWYsIG91dCk7CiAgfTsKICBzdHJpbmdzJDIudXRmOGJvcmRlciA9IGZ1bmN0aW9uKGJ1ZiwgbWF4MikgewogICAgdmFyIHBvczsKICAgIG1heDIgPSBtYXgyIHx8IGJ1Zi5sZW5ndGg7CiAgICBpZiAobWF4MiA+IGJ1Zi5sZW5ndGgpIHsKICAgICAgbWF4MiA9IGJ1Zi5sZW5ndGg7CiAgICB9CiAgICBwb3MgPSBtYXgyIC0gMTsKICAgIHdoaWxlIChwb3MgPj0gMCAmJiAoYnVmW3Bvc10gJiAxOTIpID09PSAxMjgpIHsKICAgICAgcG9zLS07CiAgICB9CiAgICBpZiAocG9zIDwgMCkgewogICAgICByZXR1cm4gbWF4MjsKICAgIH0KICAgIGlmIChwb3MgPT09IDApIHsKICAgICAgcmV0dXJuIG1heDI7CiAgICB9CiAgICByZXR1cm4gcG9zICsgX3V0ZjhsZW5bYnVmW3Bvc11dID4gbWF4MiA/IHBvcyA6IG1heDI7CiAgfTsKICBmdW5jdGlvbiBaU3RyZWFtJDIoKSB7CiAgICB0aGlzLmlucHV0ID0gbnVsbDsKICAgIHRoaXMubmV4dF9pbiA9IDA7CiAgICB0aGlzLmF2YWlsX2luID0gMDsKICAgIHRoaXMudG90YWxfaW4gPSAwOwogICAgdGhpcy5vdXRwdXQgPSBudWxsOwogICAgdGhpcy5uZXh0X291dCA9IDA7CiAgICB0aGlzLmF2YWlsX291dCA9IDA7CiAgICB0aGlzLnRvdGFsX291dCA9IDA7CiAgICB0aGlzLm1zZyA9ICIiOwogICAgdGhpcy5zdGF0ZSA9IG51bGw7CiAgICB0aGlzLmRhdGFfdHlwZSA9IDI7CiAgICB0aGlzLmFkbGVyID0gMDsKICB9CiAgdmFyIHpzdHJlYW0gPSBaU3RyZWFtJDI7CiAgdmFyIHpsaWJfZGVmbGF0ZSA9IGRlZmxhdGUkMzsKICB2YXIgdXRpbHMkMyA9IGNvbW1vbjsKICB2YXIgc3RyaW5ncyQxID0gc3RyaW5ncyQyOwogIHZhciBtc2ckMSA9IG1lc3NhZ2VzOwogIHZhciBaU3RyZWFtJDEgPSB6c3RyZWFtOwogIHZhciB0b1N0cmluZyQ0ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKICB2YXIgWl9OT19GTFVTSCA9IDA7CiAgdmFyIFpfRklOSVNIJDEgPSA0OwogIHZhciBaX09LJDEgPSAwOwogIHZhciBaX1NUUkVBTV9FTkQkMSA9IDE7CiAgdmFyIFpfU1lOQ19GTFVTSCQxID0gMjsKICB2YXIgWl9ERUZBVUxUX0NPTVBSRVNTSU9OID0gLTE7CiAgdmFyIFpfREVGQVVMVF9TVFJBVEVHWSA9IDA7CiAgdmFyIFpfREVGTEFURUQkMSA9IDg7CiAgZnVuY3Rpb24gRGVmbGF0ZShvcHRpb25zKSB7CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgRGVmbGF0ZSkpCiAgICAgIHJldHVybiBuZXcgRGVmbGF0ZShvcHRpb25zKTsKICAgIHRoaXMub3B0aW9ucyA9IHV0aWxzJDMuYXNzaWduKHsKICAgICAgbGV2ZWw6IFpfREVGQVVMVF9DT01QUkVTU0lPTiwKICAgICAgbWV0aG9kOiBaX0RFRkxBVEVEJDEsCiAgICAgIGNodW5rU2l6ZTogMTYzODQsCiAgICAgIHdpbmRvd0JpdHM6IDE1LAogICAgICBtZW1MZXZlbDogOCwKICAgICAgc3RyYXRlZ3k6IFpfREVGQVVMVF9TVFJBVEVHWSwKICAgICAgdG86ICIiCiAgICB9LCBvcHRpb25zIHx8IHt9KTsKICAgIHZhciBvcHQgPSB0aGlzLm9wdGlvbnM7CiAgICBpZiAob3B0LnJhdyAmJiBvcHQud2luZG93Qml0cyA+IDApIHsKICAgICAgb3B0LndpbmRvd0JpdHMgPSAtb3B0LndpbmRvd0JpdHM7CiAgICB9IGVsc2UgaWYgKG9wdC5nemlwICYmIG9wdC53aW5kb3dCaXRzID4gMCAmJiBvcHQud2luZG93Qml0cyA8IDE2KSB7CiAgICAgIG9wdC53aW5kb3dCaXRzICs9IDE2OwogICAgfQogICAgdGhpcy5lcnIgPSAwOwogICAgdGhpcy5tc2cgPSAiIjsKICAgIHRoaXMuZW5kZWQgPSBmYWxzZTsKICAgIHRoaXMuY2h1bmtzID0gW107CiAgICB0aGlzLnN0cm0gPSBuZXcgWlN0cmVhbSQxKCk7CiAgICB0aGlzLnN0cm0uYXZhaWxfb3V0ID0gMDsKICAgIHZhciBzdGF0dXMgPSB6bGliX2RlZmxhdGUuZGVmbGF0ZUluaXQyKHRoaXMuc3RybSwgb3B0LmxldmVsLCBvcHQubWV0aG9kLCBvcHQud2luZG93Qml0cywgb3B0Lm1lbUxldmVsLCBvcHQuc3RyYXRlZ3kpOwogICAgaWYgKHN0YXR1cyAhPT0gWl9PSyQxKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihtc2ckMVtzdGF0dXNdKTsKICAgIH0KICAgIGlmIChvcHQuaGVhZGVyKSB7CiAgICAgIHpsaWJfZGVmbGF0ZS5kZWZsYXRlU2V0SGVhZGVyKHRoaXMuc3RybSwgb3B0LmhlYWRlcik7CiAgICB9CiAgICBpZiAob3B0LmRpY3Rpb25hcnkpIHsKICAgICAgdmFyIGRpY3Q7CiAgICAgIGlmICh0eXBlb2Ygb3B0LmRpY3Rpb25hcnkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgZGljdCA9IHN0cmluZ3MkMS5zdHJpbmcyYnVmKG9wdC5kaWN0aW9uYXJ5KTsKICAgICAgfSBlbHNlIGlmICh0b1N0cmluZyQ0LmNhbGwob3B0LmRpY3Rpb25hcnkpID09PSAiW29iamVjdCBBcnJheUJ1ZmZlcl0iKSB7CiAgICAgICAgZGljdCA9IG5ldyBVaW50OEFycmF5KG9wdC5kaWN0aW9uYXJ5KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkaWN0ID0gb3B0LmRpY3Rpb25hcnk7CiAgICAgIH0KICAgICAgc3RhdHVzID0gemxpYl9kZWZsYXRlLmRlZmxhdGVTZXREaWN0aW9uYXJ5KHRoaXMuc3RybSwgZGljdCk7CiAgICAgIGlmIChzdGF0dXMgIT09IFpfT0skMSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihtc2ckMVtzdGF0dXNdKTsKICAgICAgfQogICAgICB0aGlzLl9kaWN0X3NldCA9IHRydWU7CiAgICB9CiAgfQogIERlZmxhdGUucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbihkYXRhMiwgbW9kZSkgewogICAgdmFyIHN0cm0gPSB0aGlzLnN0cm07CiAgICB2YXIgY2h1bmtTaXplID0gdGhpcy5vcHRpb25zLmNodW5rU2l6ZTsKICAgIHZhciBzdGF0dXMsIF9tb2RlOwogICAgaWYgKHRoaXMuZW5kZWQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgX21vZGUgPSBtb2RlID09PSB+fm1vZGUgPyBtb2RlIDogbW9kZSA9PT0gdHJ1ZSA/IFpfRklOSVNIJDEgOiBaX05PX0ZMVVNIOwogICAgaWYgKHR5cGVvZiBkYXRhMiA9PT0gInN0cmluZyIpIHsKICAgICAgc3RybS5pbnB1dCA9IHN0cmluZ3MkMS5zdHJpbmcyYnVmKGRhdGEyKTsKICAgIH0gZWxzZSBpZiAodG9TdHJpbmckNC5jYWxsKGRhdGEyKSA9PT0gIltvYmplY3QgQXJyYXlCdWZmZXJdIikgewogICAgICBzdHJtLmlucHV0ID0gbmV3IFVpbnQ4QXJyYXkoZGF0YTIpOwogICAgfSBlbHNlIHsKICAgICAgc3RybS5pbnB1dCA9IGRhdGEyOwogICAgfQogICAgc3RybS5uZXh0X2luID0gMDsKICAgIHN0cm0uYXZhaWxfaW4gPSBzdHJtLmlucHV0Lmxlbmd0aDsKICAgIGRvIHsKICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgc3RybS5vdXRwdXQgPSBuZXcgdXRpbHMkMy5CdWY4KGNodW5rU2l6ZSk7CiAgICAgICAgc3RybS5uZXh0X291dCA9IDA7CiAgICAgICAgc3RybS5hdmFpbF9vdXQgPSBjaHVua1NpemU7CiAgICAgIH0KICAgICAgc3RhdHVzID0gemxpYl9kZWZsYXRlLmRlZmxhdGUoc3RybSwgX21vZGUpOwogICAgICBpZiAoc3RhdHVzICE9PSBaX1NUUkVBTV9FTkQkMSAmJiBzdGF0dXMgIT09IFpfT0skMSkgewogICAgICAgIHRoaXMub25FbmQoc3RhdHVzKTsKICAgICAgICB0aGlzLmVuZGVkID0gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwIHx8IHN0cm0uYXZhaWxfaW4gPT09IDAgJiYgKF9tb2RlID09PSBaX0ZJTklTSCQxIHx8IF9tb2RlID09PSBaX1NZTkNfRkxVU0gkMSkpIHsKICAgICAgICBpZiAodGhpcy5vcHRpb25zLnRvID09PSAic3RyaW5nIikgewogICAgICAgICAgdGhpcy5vbkRhdGEoc3RyaW5ncyQxLmJ1ZjJiaW5zdHJpbmcodXRpbHMkMy5zaHJpbmtCdWYoc3RybS5vdXRwdXQsIHN0cm0ubmV4dF9vdXQpKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMub25EYXRhKHV0aWxzJDMuc2hyaW5rQnVmKHN0cm0ub3V0cHV0LCBzdHJtLm5leHRfb3V0KSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IHdoaWxlICgoc3RybS5hdmFpbF9pbiA+IDAgfHwgc3RybS5hdmFpbF9vdXQgPT09IDApICYmIHN0YXR1cyAhPT0gWl9TVFJFQU1fRU5EJDEpOwogICAgaWYgKF9tb2RlID09PSBaX0ZJTklTSCQxKSB7CiAgICAgIHN0YXR1cyA9IHpsaWJfZGVmbGF0ZS5kZWZsYXRlRW5kKHRoaXMuc3RybSk7CiAgICAgIHRoaXMub25FbmQoc3RhdHVzKTsKICAgICAgdGhpcy5lbmRlZCA9IHRydWU7CiAgICAgIHJldHVybiBzdGF0dXMgPT09IFpfT0skMTsKICAgIH0KICAgIGlmIChfbW9kZSA9PT0gWl9TWU5DX0ZMVVNIJDEpIHsKICAgICAgdGhpcy5vbkVuZChaX09LJDEpOwogICAgICBzdHJtLmF2YWlsX291dCA9IDA7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfTsKICBEZWZsYXRlLnByb3RvdHlwZS5vbkRhdGEgPSBmdW5jdGlvbihjaHVuazIpIHsKICAgIHRoaXMuY2h1bmtzLnB1c2goY2h1bmsyKTsKICB9OwogIERlZmxhdGUucHJvdG90eXBlLm9uRW5kID0gZnVuY3Rpb24oc3RhdHVzKSB7CiAgICBpZiAoc3RhdHVzID09PSBaX09LJDEpIHsKICAgICAgaWYgKHRoaXMub3B0aW9ucy50byA9PT0gInN0cmluZyIpIHsKICAgICAgICB0aGlzLnJlc3VsdCA9IHRoaXMuY2h1bmtzLmpvaW4oIiIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucmVzdWx0ID0gdXRpbHMkMy5mbGF0dGVuQ2h1bmtzKHRoaXMuY2h1bmtzKTsKICAgICAgfQogICAgfQogICAgdGhpcy5jaHVua3MgPSBbXTsKICAgIHRoaXMuZXJyID0gc3RhdHVzOwogICAgdGhpcy5tc2cgPSB0aGlzLnN0cm0ubXNnOwogIH07CiAgZnVuY3Rpb24gZGVmbGF0ZSQxKGlucHV0LCBvcHRpb25zKSB7CiAgICB2YXIgZGVmbGF0b3IgPSBuZXcgRGVmbGF0ZShvcHRpb25zKTsKICAgIGRlZmxhdG9yLnB1c2goaW5wdXQsIHRydWUpOwogICAgaWYgKGRlZmxhdG9yLmVycikgewogICAgICB0aHJvdyBkZWZsYXRvci5tc2cgfHwgbXNnJDFbZGVmbGF0b3IuZXJyXTsKICAgIH0KICAgIHJldHVybiBkZWZsYXRvci5yZXN1bHQ7CiAgfQogIGZ1bmN0aW9uIGRlZmxhdGVSYXcoaW5wdXQsIG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgb3B0aW9ucy5yYXcgPSB0cnVlOwogICAgcmV0dXJuIGRlZmxhdGUkMShpbnB1dCwgb3B0aW9ucyk7CiAgfQogIGZ1bmN0aW9uIGd6aXAoaW5wdXQsIG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgb3B0aW9ucy5nemlwID0gdHJ1ZTsKICAgIHJldHVybiBkZWZsYXRlJDEoaW5wdXQsIG9wdGlvbnMpOwogIH0KICBkZWZsYXRlJDQuRGVmbGF0ZSA9IERlZmxhdGU7CiAgZGVmbGF0ZSQ0LmRlZmxhdGUgPSBkZWZsYXRlJDE7CiAgZGVmbGF0ZSQ0LmRlZmxhdGVSYXcgPSBkZWZsYXRlUmF3OwogIGRlZmxhdGUkNC5nemlwID0gZ3ppcDsKICB2YXIgaW5mbGF0ZSQ0ID0ge307CiAgdmFyIGluZmxhdGUkMyA9IHt9OwogIHZhciBCQUQkMSA9IDMwOwogIHZhciBUWVBFJDEgPSAxMjsKICB2YXIgaW5mZmFzdCA9IGZ1bmN0aW9uIGluZmxhdGVfZmFzdDIoc3RybSwgc3RhcnQpIHsKICAgIHZhciBzdGF0ZTsKICAgIHZhciBfaW47CiAgICB2YXIgbGFzdDI7CiAgICB2YXIgX291dDsKICAgIHZhciBiZWc7CiAgICB2YXIgZW5kOwogICAgdmFyIGRtYXg7CiAgICB2YXIgd3NpemU7CiAgICB2YXIgd2hhdmU7CiAgICB2YXIgd25leHQ7CiAgICB2YXIgc193aW5kb3c7CiAgICB2YXIgaG9sZDsKICAgIHZhciBiaXRzOwogICAgdmFyIGxjb2RlOwogICAgdmFyIGRjb2RlOwogICAgdmFyIGxtYXNrOwogICAgdmFyIGRtYXNrOwogICAgdmFyIGhlcmU7CiAgICB2YXIgb3A7CiAgICB2YXIgbGVuMjsKICAgIHZhciBkaXN0MjsKICAgIHZhciBmcm9tMjsKICAgIHZhciBmcm9tX3NvdXJjZTsKICAgIHZhciBpbnB1dCwgb3V0cHV0OwogICAgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgX2luID0gc3RybS5uZXh0X2luOwogICAgaW5wdXQgPSBzdHJtLmlucHV0OwogICAgbGFzdDIgPSBfaW4gKyAoc3RybS5hdmFpbF9pbiAtIDUpOwogICAgX291dCA9IHN0cm0ubmV4dF9vdXQ7CiAgICBvdXRwdXQgPSBzdHJtLm91dHB1dDsKICAgIGJlZyA9IF9vdXQgLSAoc3RhcnQgLSBzdHJtLmF2YWlsX291dCk7CiAgICBlbmQgPSBfb3V0ICsgKHN0cm0uYXZhaWxfb3V0IC0gMjU3KTsKICAgIGRtYXggPSBzdGF0ZS5kbWF4OwogICAgd3NpemUgPSBzdGF0ZS53c2l6ZTsKICAgIHdoYXZlID0gc3RhdGUud2hhdmU7CiAgICB3bmV4dCA9IHN0YXRlLnduZXh0OwogICAgc193aW5kb3cgPSBzdGF0ZS53aW5kb3c7CiAgICBob2xkID0gc3RhdGUuaG9sZDsKICAgIGJpdHMgPSBzdGF0ZS5iaXRzOwogICAgbGNvZGUgPSBzdGF0ZS5sZW5jb2RlOwogICAgZGNvZGUgPSBzdGF0ZS5kaXN0Y29kZTsKICAgIGxtYXNrID0gKDEgPDwgc3RhdGUubGVuYml0cykgLSAxOwogICAgZG1hc2sgPSAoMSA8PCBzdGF0ZS5kaXN0Yml0cykgLSAxOwogICAgdG9wOgogICAgICBkbyB7CiAgICAgICAgaWYgKGJpdHMgPCAxNSkgewogICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgIGhvbGQgKz0gaW5wdXRbX2luKytdIDw8IGJpdHM7CiAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgfQogICAgICAgIGhlcmUgPSBsY29kZVtob2xkICYgbG1hc2tdOwogICAgICAgIGRvbGVuOgogICAgICAgICAgZm9yICg7IDsgKSB7CiAgICAgICAgICAgIG9wID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgIGhvbGQgPj4+PSBvcDsKICAgICAgICAgICAgYml0cyAtPSBvcDsKICAgICAgICAgICAgb3AgPSBoZXJlID4+PiAxNiAmIDI1NTsKICAgICAgICAgICAgaWYgKG9wID09PSAwKSB7CiAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBoZXJlICYgNjU1MzU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAob3AgJiAxNikgewogICAgICAgICAgICAgIGxlbjIgPSBoZXJlICYgNjU1MzU7CiAgICAgICAgICAgICAgb3AgJj0gMTU7CiAgICAgICAgICAgICAgaWYgKG9wKSB7CiAgICAgICAgICAgICAgICBpZiAoYml0cyA8IG9wKSB7CiAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbX2luKytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxlbjIgKz0gaG9sZCAmICgxIDw8IG9wKSAtIDE7CiAgICAgICAgICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgICAgICAgICBiaXRzIC09IG9wOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoYml0cyA8IDE1KSB7CiAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W19pbisrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaGVyZSA9IGRjb2RlW2hvbGQgJiBkbWFza107CiAgICAgICAgICAgICAgZG9kaXN0OgogICAgICAgICAgICAgICAgZm9yICg7IDsgKSB7CiAgICAgICAgICAgICAgICAgIG9wID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgICAgIGhvbGQgPj4+PSBvcDsKICAgICAgICAgICAgICAgICAgYml0cyAtPSBvcDsKICAgICAgICAgICAgICAgICAgb3AgPSBoZXJlID4+PiAxNiAmIDI1NTsKICAgICAgICAgICAgICAgICAgaWYgKG9wICYgMTYpIHsKICAgICAgICAgICAgICAgICAgICBkaXN0MiA9IGhlcmUgJiA2NTUzNTsKICAgICAgICAgICAgICAgICAgICBvcCAmPSAxNTsKICAgICAgICAgICAgICAgICAgICBpZiAoYml0cyA8IG9wKSB7CiAgICAgICAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W19pbisrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgICAgICAgICAgaWYgKGJpdHMgPCBvcCkgewogICAgICAgICAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W19pbisrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRpc3QyICs9IGhvbGQgJiAoMSA8PCBvcCkgLSAxOwogICAgICAgICAgICAgICAgICAgIGlmIChkaXN0MiA+IGRtYXgpIHsKICAgICAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrIjsKICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQkMTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaG9sZCA+Pj49IG9wOwogICAgICAgICAgICAgICAgICAgIGJpdHMgLT0gb3A7CiAgICAgICAgICAgICAgICAgICAgb3AgPSBfb3V0IC0gYmVnOwogICAgICAgICAgICAgICAgICAgIGlmIChkaXN0MiA+IG9wKSB7CiAgICAgICAgICAgICAgICAgICAgICBvcCA9IGRpc3QyIC0gb3A7CiAgICAgICAgICAgICAgICAgICAgICBpZiAob3AgPiB3aGF2ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUuc2FuZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrIjsKICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEJDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgdG9wOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBmcm9tMiA9IDA7CiAgICAgICAgICAgICAgICAgICAgICBmcm9tX3NvdXJjZSA9IHNfd2luZG93OwogICAgICAgICAgICAgICAgICAgICAgaWYgKHduZXh0ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZyb20yICs9IHdzaXplIC0gb3A7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcCA8IGxlbjIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBsZW4yIC09IG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gc193aW5kb3dbZnJvbTIrK107CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1vcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTIgPSBfb3V0IC0gZGlzdDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbV9zb3VyY2UgPSBvdXRwdXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAod25leHQgPCBvcCkgewogICAgICAgICAgICAgICAgICAgICAgICBmcm9tMiArPSB3c2l6ZSArIHduZXh0IC0gb3A7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wIC09IHduZXh0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAob3AgPCBsZW4yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuMiAtPSBvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IHNfd2luZG93W2Zyb20yKytdOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKC0tb3ApOwogICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20yID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod25leHQgPCBsZW4yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcCA9IHduZXh0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuMiAtPSBvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBzX3dpbmRvd1tmcm9tMisrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKC0tb3ApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTIgPSBfb3V0IC0gZGlzdDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tX3NvdXJjZSA9IG91dHB1dDsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZyb20yICs9IHduZXh0IC0gb3A7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcCA8IGxlbjIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBsZW4yIC09IG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gc193aW5kb3dbZnJvbTIrK107CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1vcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTIgPSBfb3V0IC0gZGlzdDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbV9zb3VyY2UgPSBvdXRwdXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChsZW4yID4gMikgewogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGZyb21fc291cmNlW2Zyb20yKytdOwogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGZyb21fc291cmNlW2Zyb20yKytdOwogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGZyb21fc291cmNlW2Zyb20yKytdOwogICAgICAgICAgICAgICAgICAgICAgICBsZW4yIC09IDM7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBpZiAobGVuMikgewogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGZyb21fc291cmNlW2Zyb20yKytdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGVuMiA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGZyb21fc291cmNlW2Zyb20yKytdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGZyb20yID0gX291dCAtIGRpc3QyOwogICAgICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IG91dHB1dFtmcm9tMisrXTsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbTIrK107CiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gb3V0cHV0W2Zyb20yKytdOwogICAgICAgICAgICAgICAgICAgICAgICBsZW4yIC09IDM7CiAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlIChsZW4yID4gMik7CiAgICAgICAgICAgICAgICAgICAgICBpZiAobGVuMikgewogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IG91dHB1dFtmcm9tMisrXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxlbjIgPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbTIrK107CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKG9wICYgNjQpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaGVyZSA9IGRjb2RlWyhoZXJlICYgNjU1MzUpICsgKGhvbGQgJiAoMSA8PCBvcCkgLSAxKV07CiAgICAgICAgICAgICAgICAgICAgY29udGludWUgZG9kaXN0OwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgZGlzdGFuY2UgY29kZSI7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRCQxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICgob3AgJiA2NCkgPT09IDApIHsKICAgICAgICAgICAgICBoZXJlID0gbGNvZGVbKGhlcmUgJiA2NTUzNSkgKyAoaG9sZCAmICgxIDw8IG9wKSAtIDEpXTsKICAgICAgICAgICAgICBjb250aW51ZSBkb2xlbjsKICAgICAgICAgICAgfSBlbHNlIGlmIChvcCAmIDMyKSB7CiAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IFRZUEUkMTsKICAgICAgICAgICAgICBicmVhayB0b3A7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlIjsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEJDE7CiAgICAgICAgICAgICAgYnJlYWsgdG9wOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICB9IHdoaWxlIChfaW4gPCBsYXN0MiAmJiBfb3V0IDwgZW5kKTsKICAgIGxlbjIgPSBiaXRzID4+IDM7CiAgICBfaW4gLT0gbGVuMjsKICAgIGJpdHMgLT0gbGVuMiA8PCAzOwogICAgaG9sZCAmPSAoMSA8PCBiaXRzKSAtIDE7CiAgICBzdHJtLm5leHRfaW4gPSBfaW47CiAgICBzdHJtLm5leHRfb3V0ID0gX291dDsKICAgIHN0cm0uYXZhaWxfaW4gPSBfaW4gPCBsYXN0MiA/IDUgKyAobGFzdDIgLSBfaW4pIDogNSAtIChfaW4gLSBsYXN0Mik7CiAgICBzdHJtLmF2YWlsX291dCA9IF9vdXQgPCBlbmQgPyAyNTcgKyAoZW5kIC0gX291dCkgOiAyNTcgLSAoX291dCAtIGVuZCk7CiAgICBzdGF0ZS5ob2xkID0gaG9sZDsKICAgIHN0YXRlLmJpdHMgPSBiaXRzOwogICAgcmV0dXJuOwogIH07CiAgdmFyIHV0aWxzJDIgPSBjb21tb247CiAgdmFyIE1BWEJJVFMgPSAxNTsKICB2YXIgRU5PVUdIX0xFTlMkMSA9IDg1MjsKICB2YXIgRU5PVUdIX0RJU1RTJDEgPSA1OTI7CiAgdmFyIENPREVTJDEgPSAwOwogIHZhciBMRU5TJDEgPSAxOwogIHZhciBESVNUUyQxID0gMjsKICB2YXIgbGJhc2UgPSBbCiAgICAzLAogICAgNCwKICAgIDUsCiAgICA2LAogICAgNywKICAgIDgsCiAgICA5LAogICAgMTAsCiAgICAxMSwKICAgIDEzLAogICAgMTUsCiAgICAxNywKICAgIDE5LAogICAgMjMsCiAgICAyNywKICAgIDMxLAogICAgMzUsCiAgICA0MywKICAgIDUxLAogICAgNTksCiAgICA2NywKICAgIDgzLAogICAgOTksCiAgICAxMTUsCiAgICAxMzEsCiAgICAxNjMsCiAgICAxOTUsCiAgICAyMjcsCiAgICAyNTgsCiAgICAwLAogICAgMAogIF07CiAgdmFyIGxleHQgPSBbCiAgICAxNiwKICAgIDE2LAogICAgMTYsCiAgICAxNiwKICAgIDE2LAogICAgMTYsCiAgICAxNiwKICAgIDE2LAogICAgMTcsCiAgICAxNywKICAgIDE3LAogICAgMTcsCiAgICAxOCwKICAgIDE4LAogICAgMTgsCiAgICAxOCwKICAgIDE5LAogICAgMTksCiAgICAxOSwKICAgIDE5LAogICAgMjAsCiAgICAyMCwKICAgIDIwLAogICAgMjAsCiAgICAyMSwKICAgIDIxLAogICAgMjEsCiAgICAyMSwKICAgIDE2LAogICAgNzIsCiAgICA3OAogIF07CiAgdmFyIGRiYXNlID0gWwogICAgMSwKICAgIDIsCiAgICAzLAogICAgNCwKICAgIDUsCiAgICA3LAogICAgOSwKICAgIDEzLAogICAgMTcsCiAgICAyNSwKICAgIDMzLAogICAgNDksCiAgICA2NSwKICAgIDk3LAogICAgMTI5LAogICAgMTkzLAogICAgMjU3LAogICAgMzg1LAogICAgNTEzLAogICAgNzY5LAogICAgMTAyNSwKICAgIDE1MzcsCiAgICAyMDQ5LAogICAgMzA3MywKICAgIDQwOTcsCiAgICA2MTQ1LAogICAgODE5MywKICAgIDEyMjg5LAogICAgMTYzODUsCiAgICAyNDU3NywKICAgIDAsCiAgICAwCiAgXTsKICB2YXIgZGV4dCA9IFsKICAgIDE2LAogICAgMTYsCiAgICAxNiwKICAgIDE2LAogICAgMTcsCiAgICAxNywKICAgIDE4LAogICAgMTgsCiAgICAxOSwKICAgIDE5LAogICAgMjAsCiAgICAyMCwKICAgIDIxLAogICAgMjEsCiAgICAyMiwKICAgIDIyLAogICAgMjMsCiAgICAyMywKICAgIDI0LAogICAgMjQsCiAgICAyNSwKICAgIDI1LAogICAgMjYsCiAgICAyNiwKICAgIDI3LAogICAgMjcsCiAgICAyOCwKICAgIDI4LAogICAgMjksCiAgICAyOSwKICAgIDY0LAogICAgNjQKICBdOwogIHZhciBpbmZ0cmVlcyA9IGZ1bmN0aW9uIGluZmxhdGVfdGFibGUyKHR5cGUsIGxlbnMsIGxlbnNfaW5kZXgsIGNvZGVzLCB0YWJsZSwgdGFibGVfaW5kZXgsIHdvcmssIG9wdHMpIHsKICAgIHZhciBiaXRzID0gb3B0cy5iaXRzOwogICAgdmFyIGxlbjIgPSAwOwogICAgdmFyIHN5bSA9IDA7CiAgICB2YXIgbWluMiA9IDAsIG1heDIgPSAwOwogICAgdmFyIHJvb3QgPSAwOwogICAgdmFyIGN1cnIgPSAwOwogICAgdmFyIGRyb3AgPSAwOwogICAgdmFyIGxlZnQgPSAwOwogICAgdmFyIHVzZWQgPSAwOwogICAgdmFyIGh1ZmYgPSAwOwogICAgdmFyIGluY3I7CiAgICB2YXIgZmlsbDsKICAgIHZhciBsb3c7CiAgICB2YXIgbWFzazsKICAgIHZhciBuZXh0OwogICAgdmFyIGJhc2UgPSBudWxsOwogICAgdmFyIGJhc2VfaW5kZXggPSAwOwogICAgdmFyIGVuZDsKICAgIHZhciBjb3VudCA9IG5ldyB1dGlscyQyLkJ1ZjE2KE1BWEJJVFMgKyAxKTsKICAgIHZhciBvZmZzID0gbmV3IHV0aWxzJDIuQnVmMTYoTUFYQklUUyArIDEpOwogICAgdmFyIGV4dHJhID0gbnVsbDsKICAgIHZhciBleHRyYV9pbmRleCA9IDA7CiAgICB2YXIgaGVyZV9iaXRzLCBoZXJlX29wLCBoZXJlX3ZhbDsKICAgIGZvciAobGVuMiA9IDA7IGxlbjIgPD0gTUFYQklUUzsgbGVuMisrKSB7CiAgICAgIGNvdW50W2xlbjJdID0gMDsKICAgIH0KICAgIGZvciAoc3ltID0gMDsgc3ltIDwgY29kZXM7IHN5bSsrKSB7CiAgICAgIGNvdW50W2xlbnNbbGVuc19pbmRleCArIHN5bV1dKys7CiAgICB9CiAgICByb290ID0gYml0czsKICAgIGZvciAobWF4MiA9IE1BWEJJVFM7IG1heDIgPj0gMTsgbWF4Mi0tKSB7CiAgICAgIGlmIChjb3VudFttYXgyXSAhPT0gMCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBpZiAocm9vdCA+IG1heDIpIHsKICAgICAgcm9vdCA9IG1heDI7CiAgICB9CiAgICBpZiAobWF4MiA9PT0gMCkgewogICAgICB0YWJsZVt0YWJsZV9pbmRleCsrXSA9IDEgPDwgMjQgfCA2NCA8PCAxNiB8IDA7CiAgICAgIHRhYmxlW3RhYmxlX2luZGV4KytdID0gMSA8PCAyNCB8IDY0IDw8IDE2IHwgMDsKICAgICAgb3B0cy5iaXRzID0gMTsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBmb3IgKG1pbjIgPSAxOyBtaW4yIDwgbWF4MjsgbWluMisrKSB7CiAgICAgIGlmIChjb3VudFttaW4yXSAhPT0gMCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBpZiAocm9vdCA8IG1pbjIpIHsKICAgICAgcm9vdCA9IG1pbjI7CiAgICB9CiAgICBsZWZ0ID0gMTsKICAgIGZvciAobGVuMiA9IDE7IGxlbjIgPD0gTUFYQklUUzsgbGVuMisrKSB7CiAgICAgIGxlZnQgPDw9IDE7CiAgICAgIGxlZnQgLT0gY291bnRbbGVuMl07CiAgICAgIGlmIChsZWZ0IDwgMCkgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfQogICAgfQogICAgaWYgKGxlZnQgPiAwICYmICh0eXBlID09PSBDT0RFUyQxIHx8IG1heDIgIT09IDEpKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIG9mZnNbMV0gPSAwOwogICAgZm9yIChsZW4yID0gMTsgbGVuMiA8IE1BWEJJVFM7IGxlbjIrKykgewogICAgICBvZmZzW2xlbjIgKyAxXSA9IG9mZnNbbGVuMl0gKyBjb3VudFtsZW4yXTsKICAgIH0KICAgIGZvciAoc3ltID0gMDsgc3ltIDwgY29kZXM7IHN5bSsrKSB7CiAgICAgIGlmIChsZW5zW2xlbnNfaW5kZXggKyBzeW1dICE9PSAwKSB7CiAgICAgICAgd29ya1tvZmZzW2xlbnNbbGVuc19pbmRleCArIHN5bV1dKytdID0gc3ltOwogICAgICB9CiAgICB9CiAgICBpZiAodHlwZSA9PT0gQ09ERVMkMSkgewogICAgICBiYXNlID0gZXh0cmEgPSB3b3JrOwogICAgICBlbmQgPSAxOTsKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gTEVOUyQxKSB7CiAgICAgIGJhc2UgPSBsYmFzZTsKICAgICAgYmFzZV9pbmRleCAtPSAyNTc7CiAgICAgIGV4dHJhID0gbGV4dDsKICAgICAgZXh0cmFfaW5kZXggLT0gMjU3OwogICAgICBlbmQgPSAyNTY7CiAgICB9IGVsc2UgewogICAgICBiYXNlID0gZGJhc2U7CiAgICAgIGV4dHJhID0gZGV4dDsKICAgICAgZW5kID0gLTE7CiAgICB9CiAgICBodWZmID0gMDsKICAgIHN5bSA9IDA7CiAgICBsZW4yID0gbWluMjsKICAgIG5leHQgPSB0YWJsZV9pbmRleDsKICAgIGN1cnIgPSByb290OwogICAgZHJvcCA9IDA7CiAgICBsb3cgPSAtMTsKICAgIHVzZWQgPSAxIDw8IHJvb3Q7CiAgICBtYXNrID0gdXNlZCAtIDE7CiAgICBpZiAodHlwZSA9PT0gTEVOUyQxICYmIHVzZWQgPiBFTk9VR0hfTEVOUyQxIHx8IHR5cGUgPT09IERJU1RTJDEgJiYgdXNlZCA+IEVOT1VHSF9ESVNUUyQxKSB7CiAgICAgIHJldHVybiAxOwogICAgfQogICAgZm9yICg7IDsgKSB7CiAgICAgIGhlcmVfYml0cyA9IGxlbjIgLSBkcm9wOwogICAgICBpZiAod29ya1tzeW1dIDwgZW5kKSB7CiAgICAgICAgaGVyZV9vcCA9IDA7CiAgICAgICAgaGVyZV92YWwgPSB3b3JrW3N5bV07CiAgICAgIH0gZWxzZSBpZiAod29ya1tzeW1dID4gZW5kKSB7CiAgICAgICAgaGVyZV9vcCA9IGV4dHJhW2V4dHJhX2luZGV4ICsgd29ya1tzeW1dXTsKICAgICAgICBoZXJlX3ZhbCA9IGJhc2VbYmFzZV9pbmRleCArIHdvcmtbc3ltXV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaGVyZV9vcCA9IDMyICsgNjQ7CiAgICAgICAgaGVyZV92YWwgPSAwOwogICAgICB9CiAgICAgIGluY3IgPSAxIDw8IGxlbjIgLSBkcm9wOwogICAgICBmaWxsID0gMSA8PCBjdXJyOwogICAgICBtaW4yID0gZmlsbDsKICAgICAgZG8gewogICAgICAgIGZpbGwgLT0gaW5jcjsKICAgICAgICB0YWJsZVtuZXh0ICsgKGh1ZmYgPj4gZHJvcCkgKyBmaWxsXSA9IGhlcmVfYml0cyA8PCAyNCB8IGhlcmVfb3AgPDwgMTYgfCBoZXJlX3ZhbCB8IDA7CiAgICAgIH0gd2hpbGUgKGZpbGwgIT09IDApOwogICAgICBpbmNyID0gMSA8PCBsZW4yIC0gMTsKICAgICAgd2hpbGUgKGh1ZmYgJiBpbmNyKSB7CiAgICAgICAgaW5jciA+Pj0gMTsKICAgICAgfQogICAgICBpZiAoaW5jciAhPT0gMCkgewogICAgICAgIGh1ZmYgJj0gaW5jciAtIDE7CiAgICAgICAgaHVmZiArPSBpbmNyOwogICAgICB9IGVsc2UgewogICAgICAgIGh1ZmYgPSAwOwogICAgICB9CiAgICAgIHN5bSsrOwogICAgICBpZiAoLS1jb3VudFtsZW4yXSA9PT0gMCkgewogICAgICAgIGlmIChsZW4yID09PSBtYXgyKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgbGVuMiA9IGxlbnNbbGVuc19pbmRleCArIHdvcmtbc3ltXV07CiAgICAgIH0KICAgICAgaWYgKGxlbjIgPiByb290ICYmIChodWZmICYgbWFzaykgIT09IGxvdykgewogICAgICAgIGlmIChkcm9wID09PSAwKSB7CiAgICAgICAgICBkcm9wID0gcm9vdDsKICAgICAgICB9CiAgICAgICAgbmV4dCArPSBtaW4yOwogICAgICAgIGN1cnIgPSBsZW4yIC0gZHJvcDsKICAgICAgICBsZWZ0ID0gMSA8PCBjdXJyOwogICAgICAgIHdoaWxlIChjdXJyICsgZHJvcCA8IG1heDIpIHsKICAgICAgICAgIGxlZnQgLT0gY291bnRbY3VyciArIGRyb3BdOwogICAgICAgICAgaWYgKGxlZnQgPD0gMCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGN1cnIrKzsKICAgICAgICAgIGxlZnQgPDw9IDE7CiAgICAgICAgfQogICAgICAgIHVzZWQgKz0gMSA8PCBjdXJyOwogICAgICAgIGlmICh0eXBlID09PSBMRU5TJDEgJiYgdXNlZCA+IEVOT1VHSF9MRU5TJDEgfHwgdHlwZSA9PT0gRElTVFMkMSAmJiB1c2VkID4gRU5PVUdIX0RJU1RTJDEpIHsKICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KICAgICAgICBsb3cgPSBodWZmICYgbWFzazsKICAgICAgICB0YWJsZVtsb3ddID0gcm9vdCA8PCAyNCB8IGN1cnIgPDwgMTYgfCBuZXh0IC0gdGFibGVfaW5kZXggfCAwOwogICAgICB9CiAgICB9CiAgICBpZiAoaHVmZiAhPT0gMCkgewogICAgICB0YWJsZVtuZXh0ICsgaHVmZl0gPSBsZW4yIC0gZHJvcCA8PCAyNCB8IDY0IDw8IDE2IHwgMDsKICAgIH0KICAgIG9wdHMuYml0cyA9IHJvb3Q7CiAgICByZXR1cm4gMDsKICB9OwogIHZhciB1dGlscyQxID0gY29tbW9uOwogIHZhciBhZGxlcjMyID0gYWRsZXIzMl8xOwogIHZhciBjcmMzMiQxID0gY3JjMzJfMTsKICB2YXIgaW5mbGF0ZV9mYXN0ID0gaW5mZmFzdDsKICB2YXIgaW5mbGF0ZV90YWJsZSA9IGluZnRyZWVzOwogIHZhciBDT0RFUyA9IDA7CiAgdmFyIExFTlMgPSAxOwogIHZhciBESVNUUyA9IDI7CiAgdmFyIFpfRklOSVNIID0gNDsKICB2YXIgWl9CTE9DSyA9IDU7CiAgdmFyIFpfVFJFRVMgPSA2OwogIHZhciBaX09LID0gMDsKICB2YXIgWl9TVFJFQU1fRU5EID0gMTsKICB2YXIgWl9ORUVEX0RJQ1QgPSAyOwogIHZhciBaX1NUUkVBTV9FUlJPUiA9IC0yOwogIHZhciBaX0RBVEFfRVJST1IgPSAtMzsKICB2YXIgWl9NRU1fRVJST1IgPSAtNDsKICB2YXIgWl9CVUZfRVJST1IgPSAtNTsKICB2YXIgWl9ERUZMQVRFRCA9IDg7CiAgdmFyIEhFQUQgPSAxOwogIHZhciBGTEFHUyA9IDI7CiAgdmFyIFRJTUUgPSAzOwogIHZhciBPUyA9IDQ7CiAgdmFyIEVYTEVOID0gNTsKICB2YXIgRVhUUkEgPSA2OwogIHZhciBOQU1FID0gNzsKICB2YXIgQ09NTUVOVCA9IDg7CiAgdmFyIEhDUkMgPSA5OwogIHZhciBESUNUSUQgPSAxMDsKICB2YXIgRElDVCA9IDExOwogIHZhciBUWVBFID0gMTI7CiAgdmFyIFRZUEVETyA9IDEzOwogIHZhciBTVE9SRUQgPSAxNDsKICB2YXIgQ09QWV8gPSAxNTsKICB2YXIgQ09QWSA9IDE2OwogIHZhciBUQUJMRSA9IDE3OwogIHZhciBMRU5MRU5TID0gMTg7CiAgdmFyIENPREVMRU5TID0gMTk7CiAgdmFyIExFTl8gPSAyMDsKICB2YXIgTEVOID0gMjE7CiAgdmFyIExFTkVYVCA9IDIyOwogIHZhciBESVNUID0gMjM7CiAgdmFyIERJU1RFWFQgPSAyNDsKICB2YXIgTUFUQ0gkMiA9IDI1OwogIHZhciBMSVQgPSAyNjsKICB2YXIgQ0hFQ0sgPSAyNzsKICB2YXIgTEVOR1RIID0gMjg7CiAgdmFyIERPTkUgPSAyOTsKICB2YXIgQkFEID0gMzA7CiAgdmFyIE1FTSA9IDMxOwogIHZhciBTWU5DID0gMzI7CiAgdmFyIEVOT1VHSF9MRU5TID0gODUyOwogIHZhciBFTk9VR0hfRElTVFMgPSA1OTI7CiAgdmFyIE1BWF9XQklUUyA9IDE1OwogIHZhciBERUZfV0JJVFMgPSBNQVhfV0JJVFM7CiAgZnVuY3Rpb24genN3YXAzMihxMikgewogICAgcmV0dXJuIChxMiA+Pj4gMjQgJiAyNTUpICsgKHEyID4+PiA4ICYgNjUyODApICsgKChxMiAmIDY1MjgwKSA8PCA4KSArICgocTIgJiAyNTUpIDw8IDI0KTsKICB9CiAgZnVuY3Rpb24gSW5mbGF0ZVN0YXRlKCkgewogICAgdGhpcy5tb2RlID0gMDsKICAgIHRoaXMubGFzdCA9IGZhbHNlOwogICAgdGhpcy53cmFwID0gMDsKICAgIHRoaXMuaGF2ZWRpY3QgPSBmYWxzZTsKICAgIHRoaXMuZmxhZ3MgPSAwOwogICAgdGhpcy5kbWF4ID0gMDsKICAgIHRoaXMuY2hlY2sgPSAwOwogICAgdGhpcy50b3RhbCA9IDA7CiAgICB0aGlzLmhlYWQgPSBudWxsOwogICAgdGhpcy53Yml0cyA9IDA7CiAgICB0aGlzLndzaXplID0gMDsKICAgIHRoaXMud2hhdmUgPSAwOwogICAgdGhpcy53bmV4dCA9IDA7CiAgICB0aGlzLndpbmRvdyA9IG51bGw7CiAgICB0aGlzLmhvbGQgPSAwOwogICAgdGhpcy5iaXRzID0gMDsKICAgIHRoaXMubGVuZ3RoID0gMDsKICAgIHRoaXMub2Zmc2V0ID0gMDsKICAgIHRoaXMuZXh0cmEgPSAwOwogICAgdGhpcy5sZW5jb2RlID0gbnVsbDsKICAgIHRoaXMuZGlzdGNvZGUgPSBudWxsOwogICAgdGhpcy5sZW5iaXRzID0gMDsKICAgIHRoaXMuZGlzdGJpdHMgPSAwOwogICAgdGhpcy5uY29kZSA9IDA7CiAgICB0aGlzLm5sZW4gPSAwOwogICAgdGhpcy5uZGlzdCA9IDA7CiAgICB0aGlzLmhhdmUgPSAwOwogICAgdGhpcy5uZXh0ID0gbnVsbDsKICAgIHRoaXMubGVucyA9IG5ldyB1dGlscyQxLkJ1ZjE2KDMyMCk7CiAgICB0aGlzLndvcmsgPSBuZXcgdXRpbHMkMS5CdWYxNigyODgpOwogICAgdGhpcy5sZW5keW4gPSBudWxsOwogICAgdGhpcy5kaXN0ZHluID0gbnVsbDsKICAgIHRoaXMuc2FuZSA9IDA7CiAgICB0aGlzLmJhY2sgPSAwOwogICAgdGhpcy53YXMgPSAwOwogIH0KICBmdW5jdGlvbiBpbmZsYXRlUmVzZXRLZWVwKHN0cm0pIHsKICAgIHZhciBzdGF0ZTsKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICB9CiAgICBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgICBzdHJtLnRvdGFsX2luID0gc3RybS50b3RhbF9vdXQgPSBzdGF0ZS50b3RhbCA9IDA7CiAgICBzdHJtLm1zZyA9ICIiOwogICAgaWYgKHN0YXRlLndyYXApIHsKICAgICAgc3RybS5hZGxlciA9IHN0YXRlLndyYXAgJiAxOwogICAgfQogICAgc3RhdGUubW9kZSA9IEhFQUQ7CiAgICBzdGF0ZS5sYXN0ID0gMDsKICAgIHN0YXRlLmhhdmVkaWN0ID0gMDsKICAgIHN0YXRlLmRtYXggPSAzMjc2ODsKICAgIHN0YXRlLmhlYWQgPSBudWxsOwogICAgc3RhdGUuaG9sZCA9IDA7CiAgICBzdGF0ZS5iaXRzID0gMDsKICAgIHN0YXRlLmxlbmNvZGUgPSBzdGF0ZS5sZW5keW4gPSBuZXcgdXRpbHMkMS5CdWYzMihFTk9VR0hfTEVOUyk7CiAgICBzdGF0ZS5kaXN0Y29kZSA9IHN0YXRlLmRpc3RkeW4gPSBuZXcgdXRpbHMkMS5CdWYzMihFTk9VR0hfRElTVFMpOwogICAgc3RhdGUuc2FuZSA9IDE7CiAgICBzdGF0ZS5iYWNrID0gLTE7CiAgICByZXR1cm4gWl9PSzsKICB9CiAgZnVuY3Rpb24gaW5mbGF0ZVJlc2V0KHN0cm0pIHsKICAgIHZhciBzdGF0ZTsKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICB9CiAgICBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgICBzdGF0ZS53c2l6ZSA9IDA7CiAgICBzdGF0ZS53aGF2ZSA9IDA7CiAgICBzdGF0ZS53bmV4dCA9IDA7CiAgICByZXR1cm4gaW5mbGF0ZVJlc2V0S2VlcChzdHJtKTsKICB9CiAgZnVuY3Rpb24gaW5mbGF0ZVJlc2V0MihzdHJtLCB3aW5kb3dCaXRzKSB7CiAgICB2YXIgd3JhcDI7CiAgICB2YXIgc3RhdGU7CiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SOwogICAgfQogICAgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgaWYgKHdpbmRvd0JpdHMgPCAwKSB7CiAgICAgIHdyYXAyID0gMDsKICAgICAgd2luZG93Qml0cyA9IC13aW5kb3dCaXRzOwogICAgfSBlbHNlIHsKICAgICAgd3JhcDIgPSAod2luZG93Qml0cyA+PiA0KSArIDE7CiAgICAgIGlmICh3aW5kb3dCaXRzIDwgNDgpIHsKICAgICAgICB3aW5kb3dCaXRzICY9IDE1OwogICAgICB9CiAgICB9CiAgICBpZiAod2luZG93Qml0cyAmJiAod2luZG93Qml0cyA8IDggfHwgd2luZG93Qml0cyA+IDE1KSkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICB9CiAgICBpZiAoc3RhdGUud2luZG93ICE9PSBudWxsICYmIHN0YXRlLndiaXRzICE9PSB3aW5kb3dCaXRzKSB7CiAgICAgIHN0YXRlLndpbmRvdyA9IG51bGw7CiAgICB9CiAgICBzdGF0ZS53cmFwID0gd3JhcDI7CiAgICBzdGF0ZS53Yml0cyA9IHdpbmRvd0JpdHM7CiAgICByZXR1cm4gaW5mbGF0ZVJlc2V0KHN0cm0pOwogIH0KICBmdW5jdGlvbiBpbmZsYXRlSW5pdDIoc3RybSwgd2luZG93Qml0cykgewogICAgdmFyIHJldDsKICAgIHZhciBzdGF0ZTsKICAgIGlmICghc3RybSkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICB9CiAgICBzdGF0ZSA9IG5ldyBJbmZsYXRlU3RhdGUoKTsKICAgIHN0cm0uc3RhdGUgPSBzdGF0ZTsKICAgIHN0YXRlLndpbmRvdyA9IG51bGw7CiAgICByZXQgPSBpbmZsYXRlUmVzZXQyKHN0cm0sIHdpbmRvd0JpdHMpOwogICAgaWYgKHJldCAhPT0gWl9PSykgewogICAgICBzdHJtLnN0YXRlID0gbnVsbDsKICAgIH0KICAgIHJldHVybiByZXQ7CiAgfQogIGZ1bmN0aW9uIGluZmxhdGVJbml0KHN0cm0pIHsKICAgIHJldHVybiBpbmZsYXRlSW5pdDIoc3RybSwgREVGX1dCSVRTKTsKICB9CiAgdmFyIHZpcmdpbiA9IHRydWU7CiAgdmFyIGxlbmZpeCwgZGlzdGZpeDsKICBmdW5jdGlvbiBmaXhlZHRhYmxlcyhzdGF0ZSkgewogICAgaWYgKHZpcmdpbikgewogICAgICB2YXIgc3ltOwogICAgICBsZW5maXggPSBuZXcgdXRpbHMkMS5CdWYzMig1MTIpOwogICAgICBkaXN0Zml4ID0gbmV3IHV0aWxzJDEuQnVmMzIoMzIpOwogICAgICBzeW0gPSAwOwogICAgICB3aGlsZSAoc3ltIDwgMTQ0KSB7CiAgICAgICAgc3RhdGUubGVuc1tzeW0rK10gPSA4OwogICAgICB9CiAgICAgIHdoaWxlIChzeW0gPCAyNTYpIHsKICAgICAgICBzdGF0ZS5sZW5zW3N5bSsrXSA9IDk7CiAgICAgIH0KICAgICAgd2hpbGUgKHN5bSA8IDI4MCkgewogICAgICAgIHN0YXRlLmxlbnNbc3ltKytdID0gNzsKICAgICAgfQogICAgICB3aGlsZSAoc3ltIDwgMjg4KSB7CiAgICAgICAgc3RhdGUubGVuc1tzeW0rK10gPSA4OwogICAgICB9CiAgICAgIGluZmxhdGVfdGFibGUoTEVOUywgc3RhdGUubGVucywgMCwgMjg4LCBsZW5maXgsIDAsIHN0YXRlLndvcmssIHsgYml0czogOSB9KTsKICAgICAgc3ltID0gMDsKICAgICAgd2hpbGUgKHN5bSA8IDMyKSB7CiAgICAgICAgc3RhdGUubGVuc1tzeW0rK10gPSA1OwogICAgICB9CiAgICAgIGluZmxhdGVfdGFibGUoRElTVFMsIHN0YXRlLmxlbnMsIDAsIDMyLCBkaXN0Zml4LCAwLCBzdGF0ZS53b3JrLCB7IGJpdHM6IDUgfSk7CiAgICAgIHZpcmdpbiA9IGZhbHNlOwogICAgfQogICAgc3RhdGUubGVuY29kZSA9IGxlbmZpeDsKICAgIHN0YXRlLmxlbmJpdHMgPSA5OwogICAgc3RhdGUuZGlzdGNvZGUgPSBkaXN0Zml4OwogICAgc3RhdGUuZGlzdGJpdHMgPSA1OwogIH0KICBmdW5jdGlvbiB1cGRhdGV3aW5kb3coc3RybSwgc3JjLCBlbmQsIGNvcHkpIHsKICAgIHZhciBkaXN0MjsKICAgIHZhciBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgICBpZiAoc3RhdGUud2luZG93ID09PSBudWxsKSB7CiAgICAgIHN0YXRlLndzaXplID0gMSA8PCBzdGF0ZS53Yml0czsKICAgICAgc3RhdGUud25leHQgPSAwOwogICAgICBzdGF0ZS53aGF2ZSA9IDA7CiAgICAgIHN0YXRlLndpbmRvdyA9IG5ldyB1dGlscyQxLkJ1Zjgoc3RhdGUud3NpemUpOwogICAgfQogICAgaWYgKGNvcHkgPj0gc3RhdGUud3NpemUpIHsKICAgICAgdXRpbHMkMS5hcnJheVNldChzdGF0ZS53aW5kb3csIHNyYywgZW5kIC0gc3RhdGUud3NpemUsIHN0YXRlLndzaXplLCAwKTsKICAgICAgc3RhdGUud25leHQgPSAwOwogICAgICBzdGF0ZS53aGF2ZSA9IHN0YXRlLndzaXplOwogICAgfSBlbHNlIHsKICAgICAgZGlzdDIgPSBzdGF0ZS53c2l6ZSAtIHN0YXRlLnduZXh0OwogICAgICBpZiAoZGlzdDIgPiBjb3B5KSB7CiAgICAgICAgZGlzdDIgPSBjb3B5OwogICAgICB9CiAgICAgIHV0aWxzJDEuYXJyYXlTZXQoc3RhdGUud2luZG93LCBzcmMsIGVuZCAtIGNvcHksIGRpc3QyLCBzdGF0ZS53bmV4dCk7CiAgICAgIGNvcHkgLT0gZGlzdDI7CiAgICAgIGlmIChjb3B5KSB7CiAgICAgICAgdXRpbHMkMS5hcnJheVNldChzdGF0ZS53aW5kb3csIHNyYywgZW5kIC0gY29weSwgY29weSwgMCk7CiAgICAgICAgc3RhdGUud25leHQgPSBjb3B5OwogICAgICAgIHN0YXRlLndoYXZlID0gc3RhdGUud3NpemU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3RhdGUud25leHQgKz0gZGlzdDI7CiAgICAgICAgaWYgKHN0YXRlLnduZXh0ID09PSBzdGF0ZS53c2l6ZSkgewogICAgICAgICAgc3RhdGUud25leHQgPSAwOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhdGUud2hhdmUgPCBzdGF0ZS53c2l6ZSkgewogICAgICAgICAgc3RhdGUud2hhdmUgKz0gZGlzdDI7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gMDsKICB9CiAgZnVuY3Rpb24gaW5mbGF0ZSQyKHN0cm0sIGZsdXNoMikgewogICAgdmFyIHN0YXRlOwogICAgdmFyIGlucHV0LCBvdXRwdXQ7CiAgICB2YXIgbmV4dDsKICAgIHZhciBwdXQ7CiAgICB2YXIgaGF2ZSwgbGVmdDsKICAgIHZhciBob2xkOwogICAgdmFyIGJpdHM7CiAgICB2YXIgX2luLCBfb3V0OwogICAgdmFyIGNvcHk7CiAgICB2YXIgZnJvbTI7CiAgICB2YXIgZnJvbV9zb3VyY2U7CiAgICB2YXIgaGVyZSA9IDA7CiAgICB2YXIgaGVyZV9iaXRzLCBoZXJlX29wLCBoZXJlX3ZhbDsKICAgIHZhciBsYXN0X2JpdHMsIGxhc3Rfb3AsIGxhc3RfdmFsOwogICAgdmFyIGxlbjI7CiAgICB2YXIgcmV0OwogICAgdmFyIGhidWYgPSBuZXcgdXRpbHMkMS5CdWY4KDQpOwogICAgdmFyIG9wdHM7CiAgICB2YXIgbjsKICAgIHZhciBvcmRlciA9IFsxNiwgMTcsIDE4LCAwLCA4LCA3LCA5LCA2LCAxMCwgNSwgMTEsIDQsIDEyLCAzLCAxMywgMiwgMTQsIDEsIDE1XTsKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSB8fCAhc3RybS5vdXRwdXQgfHwgIXN0cm0uaW5wdXQgJiYgc3RybS5hdmFpbF9pbiAhPT0gMCkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICB9CiAgICBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgICBpZiAoc3RhdGUubW9kZSA9PT0gVFlQRSkgewogICAgICBzdGF0ZS5tb2RlID0gVFlQRURPOwogICAgfQogICAgcHV0ID0gc3RybS5uZXh0X291dDsKICAgIG91dHB1dCA9IHN0cm0ub3V0cHV0OwogICAgbGVmdCA9IHN0cm0uYXZhaWxfb3V0OwogICAgbmV4dCA9IHN0cm0ubmV4dF9pbjsKICAgIGlucHV0ID0gc3RybS5pbnB1dDsKICAgIGhhdmUgPSBzdHJtLmF2YWlsX2luOwogICAgaG9sZCA9IHN0YXRlLmhvbGQ7CiAgICBiaXRzID0gc3RhdGUuYml0czsKICAgIF9pbiA9IGhhdmU7CiAgICBfb3V0ID0gbGVmdDsKICAgIHJldCA9IFpfT0s7CiAgICBpbmZfbGVhdmU6CiAgICAgIGZvciAoOyA7ICkgewogICAgICAgIHN3aXRjaCAoc3RhdGUubW9kZSkgewogICAgICAgICAgY2FzZSBIRUFEOgogICAgICAgICAgICBpZiAoc3RhdGUud3JhcCA9PT0gMCkgewogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFRE87CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAxNikgewogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXRlLndyYXAgJiAyICYmIGhvbGQgPT09IDM1NjE1KSB7CiAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSAwOwogICAgICAgICAgICAgIGhidWZbMF0gPSBob2xkICYgMjU1OwogICAgICAgICAgICAgIGhidWZbMV0gPSBob2xkID4+PiA4ICYgMjU1OwogICAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzIkMShzdGF0ZS5jaGVjaywgaGJ1ZiwgMiwgMCk7CiAgICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEZMQUdTOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmZsYWdzID0gMDsKICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmRvbmUgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIShzdGF0ZS53cmFwICYgMSkgfHwgKCgoaG9sZCAmIDI1NSkgPDwgOCkgKyAoaG9sZCA+PiA4KSkgJSAzMSkgewogICAgICAgICAgICAgIHN0cm0ubXNnID0gImluY29ycmVjdCBoZWFkZXIgY2hlY2siOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKChob2xkICYgMTUpICE9PSBaX0RFRkxBVEVEKSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAidW5rbm93biBjb21wcmVzc2lvbiBtZXRob2QiOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaG9sZCA+Pj49IDQ7CiAgICAgICAgICAgIGJpdHMgLT0gNDsKICAgICAgICAgICAgbGVuMiA9IChob2xkICYgMTUpICsgODsKICAgICAgICAgICAgaWYgKHN0YXRlLndiaXRzID09PSAwKSB7CiAgICAgICAgICAgICAgc3RhdGUud2JpdHMgPSBsZW4yOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxlbjIgPiBzdGF0ZS53Yml0cykgewogICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgd2luZG93IHNpemUiOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUuZG1heCA9IDEgPDwgbGVuMjsKICAgICAgICAgICAgc3RybS5hZGxlciA9IHN0YXRlLmNoZWNrID0gMTsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IGhvbGQgJiA1MTIgPyBESUNUSUQgOiBUWVBFOwogICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBGTEFHUzoKICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAxNikgewogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUuZmxhZ3MgPSBob2xkOwogICAgICAgICAgICBpZiAoKHN0YXRlLmZsYWdzICYgMjU1KSAhPT0gWl9ERUZMQVRFRCkgewogICAgICAgICAgICAgIHN0cm0ubXNnID0gInVua25vd24gY29tcHJlc3Npb24gbWV0aG9kIjsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDU3MzQ0KSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAidW5rbm93biBoZWFkZXIgZmxhZ3Mgc2V0IjsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICAgICAgc3RhdGUuaGVhZC50ZXh0ID0gaG9sZCA+PiA4ICYgMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiA1MTIpIHsKICAgICAgICAgICAgICBoYnVmWzBdID0gaG9sZCAmIDI1NTsKICAgICAgICAgICAgICBoYnVmWzFdID0gaG9sZCA+Pj4gOCAmIDI1NTsKICAgICAgICAgICAgICBzdGF0ZS5jaGVjayA9IGNyYzMyJDEoc3RhdGUuY2hlY2ssIGhidWYsIDIsIDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IFRJTUU7CiAgICAgICAgICBjYXNlIFRJTUU6CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMzIpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICAgICAgc3RhdGUuaGVhZC50aW1lID0gaG9sZDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiA1MTIpIHsKICAgICAgICAgICAgICBoYnVmWzBdID0gaG9sZCAmIDI1NTsKICAgICAgICAgICAgICBoYnVmWzFdID0gaG9sZCA+Pj4gOCAmIDI1NTsKICAgICAgICAgICAgICBoYnVmWzJdID0gaG9sZCA+Pj4gMTYgJiAyNTU7CiAgICAgICAgICAgICAgaGJ1ZlszXSA9IGhvbGQgPj4+IDI0ICYgMjU1OwogICAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzIkMShzdGF0ZS5jaGVjaywgaGJ1ZiwgNCwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gT1M7CiAgICAgICAgICBjYXNlIE9TOgogICAgICAgICAgICB3aGlsZSAoYml0cyA8IDE2KSB7CiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgIHN0YXRlLmhlYWQueGZsYWdzID0gaG9sZCAmIDI1NTsKICAgICAgICAgICAgICBzdGF0ZS5oZWFkLm9zID0gaG9sZCA+PiA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDUxMikgewogICAgICAgICAgICAgIGhidWZbMF0gPSBob2xkICYgMjU1OwogICAgICAgICAgICAgIGhidWZbMV0gPSBob2xkID4+PiA4ICYgMjU1OwogICAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzIkMShzdGF0ZS5jaGVjaywgaGJ1ZiwgMiwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gRVhMRU47CiAgICAgICAgICBjYXNlIEVYTEVOOgogICAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAxMDI0KSB7CiAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAxNikgewogICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHN0YXRlLmxlbmd0aCA9IGhvbGQ7CiAgICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQuZXh0cmFfbGVuID0gaG9sZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgNTEyKSB7CiAgICAgICAgICAgICAgICBoYnVmWzBdID0gaG9sZCAmIDI1NTsKICAgICAgICAgICAgICAgIGhidWZbMV0gPSBob2xkID4+PiA4ICYgMjU1OwogICAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMiQxKHN0YXRlLmNoZWNrLCBoYnVmLCAyLCAwKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgIHN0YXRlLmhlYWQuZXh0cmEgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBFWFRSQTsKICAgICAgICAgIGNhc2UgRVhUUkE6CiAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDEwMjQpIHsKICAgICAgICAgICAgICBjb3B5ID0gc3RhdGUubGVuZ3RoOwogICAgICAgICAgICAgIGlmIChjb3B5ID4gaGF2ZSkgewogICAgICAgICAgICAgICAgY29weSA9IGhhdmU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChjb3B5KSB7CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgICAgICBsZW4yID0gc3RhdGUuaGVhZC5leHRyYV9sZW4gLSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgIGlmICghc3RhdGUuaGVhZC5leHRyYSkgewogICAgICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQuZXh0cmEgPSBuZXcgQXJyYXkoc3RhdGUuaGVhZC5leHRyYV9sZW4pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHV0aWxzJDEuYXJyYXlTZXQoc3RhdGUuaGVhZC5leHRyYSwgaW5wdXQsIG5leHQsIGNvcHksIGxlbjIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgNTEyKSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzIkMShzdGF0ZS5jaGVjaywgaW5wdXQsIGNvcHksIG5leHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaGF2ZSAtPSBjb3B5OwogICAgICAgICAgICAgICAgbmV4dCArPSBjb3B5OwogICAgICAgICAgICAgICAgc3RhdGUubGVuZ3RoIC09IGNvcHk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzdGF0ZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUubGVuZ3RoID0gMDsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IE5BTUU7CiAgICAgICAgICBjYXNlIE5BTUU6CiAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDIwNDgpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb3B5ID0gMDsKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICBsZW4yID0gaW5wdXRbbmV4dCArIGNvcHkrK107CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCAmJiBsZW4yICYmIHN0YXRlLmxlbmd0aCA8IDY1NTM2KSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQubmFtZSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGxlbjIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gd2hpbGUgKGxlbjIgJiYgY29weSA8IGhhdmUpOwogICAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDUxMikgewogICAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMiQxKHN0YXRlLmNoZWNrLCBpbnB1dCwgY29weSwgbmV4dCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgICAgICBuZXh0ICs9IGNvcHk7CiAgICAgICAgICAgICAgaWYgKGxlbjIpIHsKICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgIHN0YXRlLmhlYWQubmFtZSA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUubGVuZ3RoID0gMDsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IENPTU1FTlQ7CiAgICAgICAgICBjYXNlIENPTU1FTlQ6CiAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDQwOTYpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb3B5ID0gMDsKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICBsZW4yID0gaW5wdXRbbmV4dCArIGNvcHkrK107CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCAmJiBsZW4yICYmIHN0YXRlLmxlbmd0aCA8IDY1NTM2KSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQuY29tbWVudCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGxlbjIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gd2hpbGUgKGxlbjIgJiYgY29weSA8IGhhdmUpOwogICAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDUxMikgewogICAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMiQxKHN0YXRlLmNoZWNrLCBpbnB1dCwgY29weSwgbmV4dCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgICAgICBuZXh0ICs9IGNvcHk7CiAgICAgICAgICAgICAgaWYgKGxlbjIpIHsKICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgIHN0YXRlLmhlYWQuY29tbWVudCA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUubW9kZSA9IEhDUkM7CiAgICAgICAgICBjYXNlIEhDUkM6CiAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDUxMikgewogICAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoaG9sZCAhPT0gKHN0YXRlLmNoZWNrICYgNjU1MzUpKSB7CiAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJoZWFkZXIgY3JjIG1pc21hdGNoIjsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmhjcmMgPSBzdGF0ZS5mbGFncyA+PiA5ICYgMTsKICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmRvbmUgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9IDA7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgRElDVElEOgogICAgICAgICAgICB3aGlsZSAoYml0cyA8IDMyKSB7CiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdHJtLmFkbGVyID0gc3RhdGUuY2hlY2sgPSB6c3dhcDMyKGhvbGQpOwogICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBESUNUOwogICAgICAgICAgY2FzZSBESUNUOgogICAgICAgICAgICBpZiAoc3RhdGUuaGF2ZWRpY3QgPT09IDApIHsKICAgICAgICAgICAgICBzdHJtLm5leHRfb3V0ID0gcHV0OwogICAgICAgICAgICAgIHN0cm0uYXZhaWxfb3V0ID0gbGVmdDsKICAgICAgICAgICAgICBzdHJtLm5leHRfaW4gPSBuZXh0OwogICAgICAgICAgICAgIHN0cm0uYXZhaWxfaW4gPSBoYXZlOwogICAgICAgICAgICAgIHN0YXRlLmhvbGQgPSBob2xkOwogICAgICAgICAgICAgIHN0YXRlLmJpdHMgPSBiaXRzOwogICAgICAgICAgICAgIHJldHVybiBaX05FRURfRElDVDsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdHJtLmFkbGVyID0gc3RhdGUuY2hlY2sgPSAxOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gVFlQRTsKICAgICAgICAgIGNhc2UgVFlQRToKICAgICAgICAgICAgaWYgKGZsdXNoMiA9PT0gWl9CTE9DSyB8fCBmbHVzaDIgPT09IFpfVFJFRVMpIHsKICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgIH0KICAgICAgICAgIGNhc2UgVFlQRURPOgogICAgICAgICAgICBpZiAoc3RhdGUubGFzdCkgewogICAgICAgICAgICAgIGhvbGQgPj4+PSBiaXRzICYgNzsKICAgICAgICAgICAgICBiaXRzIC09IGJpdHMgJiA3OwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBDSEVDSzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aGlsZSAoYml0cyA8IDMpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmxhc3QgPSBob2xkICYgMTsKICAgICAgICAgICAgaG9sZCA+Pj49IDE7CiAgICAgICAgICAgIGJpdHMgLT0gMTsKICAgICAgICAgICAgc3dpdGNoIChob2xkICYgMykgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBTVE9SRUQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBmaXhlZHRhYmxlcyhzdGF0ZSk7CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gTEVOXzsKICAgICAgICAgICAgICAgIGlmIChmbHVzaDIgPT09IFpfVFJFRVMpIHsKICAgICAgICAgICAgICAgICAgaG9sZCA+Pj49IDI7CiAgICAgICAgICAgICAgICAgIGJpdHMgLT0gMjsKICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IFRBQkxFOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBibG9jayB0eXBlIjsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaG9sZCA+Pj49IDI7CiAgICAgICAgICAgIGJpdHMgLT0gMjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIFNUT1JFRDoKICAgICAgICAgICAgaG9sZCA+Pj49IGJpdHMgJiA3OwogICAgICAgICAgICBiaXRzIC09IGJpdHMgJiA3OwogICAgICAgICAgICB3aGlsZSAoYml0cyA8IDMyKSB7CiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKGhvbGQgJiA2NTUzNSkgIT09IChob2xkID4+PiAxNiBeIDY1NTM1KSkgewogICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgc3RvcmVkIGJsb2NrIGxlbmd0aHMiOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUubGVuZ3RoID0gaG9sZCAmIDY1NTM1OwogICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBDT1BZXzsKICAgICAgICAgICAgaWYgKGZsdXNoMiA9PT0gWl9UUkVFUykgewogICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgfQogICAgICAgICAgY2FzZSBDT1BZXzoKICAgICAgICAgICAgc3RhdGUubW9kZSA9IENPUFk7CiAgICAgICAgICBjYXNlIENPUFk6CiAgICAgICAgICAgIGNvcHkgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICAgIGlmIChjb3B5KSB7CiAgICAgICAgICAgICAgaWYgKGNvcHkgPiBoYXZlKSB7CiAgICAgICAgICAgICAgICBjb3B5ID0gaGF2ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGNvcHkgPiBsZWZ0KSB7CiAgICAgICAgICAgICAgICBjb3B5ID0gbGVmdDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGNvcHkgPT09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdXRpbHMkMS5hcnJheVNldChvdXRwdXQsIGlucHV0LCBuZXh0LCBjb3B5LCBwdXQpOwogICAgICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgICAgICBuZXh0ICs9IGNvcHk7CiAgICAgICAgICAgICAgbGVmdCAtPSBjb3B5OwogICAgICAgICAgICAgIHB1dCArPSBjb3B5OwogICAgICAgICAgICAgIHN0YXRlLmxlbmd0aCAtPSBjb3B5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgVEFCTEU6CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTQpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLm5sZW4gPSAoaG9sZCAmIDMxKSArIDI1NzsKICAgICAgICAgICAgaG9sZCA+Pj49IDU7CiAgICAgICAgICAgIGJpdHMgLT0gNTsKICAgICAgICAgICAgc3RhdGUubmRpc3QgPSAoaG9sZCAmIDMxKSArIDE7CiAgICAgICAgICAgIGhvbGQgPj4+PSA1OwogICAgICAgICAgICBiaXRzIC09IDU7CiAgICAgICAgICAgIHN0YXRlLm5jb2RlID0gKGhvbGQgJiAxNSkgKyA0OwogICAgICAgICAgICBob2xkID4+Pj0gNDsKICAgICAgICAgICAgYml0cyAtPSA0OwogICAgICAgICAgICBpZiAoc3RhdGUubmxlbiA+IDI4NiB8fCBzdGF0ZS5uZGlzdCA+IDMwKSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAidG9vIG1hbnkgbGVuZ3RoIG9yIGRpc3RhbmNlIHN5bWJvbHMiOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUuaGF2ZSA9IDA7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU5MRU5TOwogICAgICAgICAgY2FzZSBMRU5MRU5TOgogICAgICAgICAgICB3aGlsZSAoc3RhdGUuaGF2ZSA8IHN0YXRlLm5jb2RlKSB7CiAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAzKSB7CiAgICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc3RhdGUubGVuc1tvcmRlcltzdGF0ZS5oYXZlKytdXSA9IGhvbGQgJiA3OwogICAgICAgICAgICAgIGhvbGQgPj4+PSAzOwogICAgICAgICAgICAgIGJpdHMgLT0gMzsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aGlsZSAoc3RhdGUuaGF2ZSA8IDE5KSB7CiAgICAgICAgICAgICAgc3RhdGUubGVuc1tvcmRlcltzdGF0ZS5oYXZlKytdXSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUubGVuY29kZSA9IHN0YXRlLmxlbmR5bjsKICAgICAgICAgICAgc3RhdGUubGVuYml0cyA9IDc7CiAgICAgICAgICAgIG9wdHMgPSB7IGJpdHM6IHN0YXRlLmxlbmJpdHMgfTsKICAgICAgICAgICAgcmV0ID0gaW5mbGF0ZV90YWJsZShDT0RFUywgc3RhdGUubGVucywgMCwgMTksIHN0YXRlLmxlbmNvZGUsIDAsIHN0YXRlLndvcmssIG9wdHMpOwogICAgICAgICAgICBzdGF0ZS5sZW5iaXRzID0gb3B0cy5iaXRzOwogICAgICAgICAgICBpZiAocmV0KSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBjb2RlIGxlbmd0aHMgc2V0IjsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmhhdmUgPSAwOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQ09ERUxFTlM7CiAgICAgICAgICBjYXNlIENPREVMRU5TOgogICAgICAgICAgICB3aGlsZSAoc3RhdGUuaGF2ZSA8IHN0YXRlLm5sZW4gKyBzdGF0ZS5uZGlzdCkgewogICAgICAgICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgICAgICAgaGVyZSA9IHN0YXRlLmxlbmNvZGVbaG9sZCAmICgxIDw8IHN0YXRlLmxlbmJpdHMpIC0gMV07CiAgICAgICAgICAgICAgICBoZXJlX2JpdHMgPSBoZXJlID4+PiAyNDsKICAgICAgICAgICAgICAgIGhlcmVfb3AgPSBoZXJlID4+PiAxNiAmIDI1NTsKICAgICAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDY1NTM1OwogICAgICAgICAgICAgICAgaWYgKGhlcmVfYml0cyA8PSBiaXRzKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChoZXJlX3ZhbCA8IDE2KSB7CiAgICAgICAgICAgICAgICBob2xkID4+Pj0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgYml0cyAtPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICBzdGF0ZS5sZW5zW3N0YXRlLmhhdmUrK10gPSBoZXJlX3ZhbDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGhlcmVfdmFsID09PSAxNikgewogICAgICAgICAgICAgICAgICBuID0gaGVyZV9iaXRzICsgMjsKICAgICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCBuKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBob2xkID4+Pj0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLmhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbnZhbGlkIGJpdCBsZW5ndGggcmVwZWF0IjsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGxlbjIgPSBzdGF0ZS5sZW5zW3N0YXRlLmhhdmUgLSAxXTsKICAgICAgICAgICAgICAgICAgY29weSA9IDMgKyAoaG9sZCAmIDMpOwogICAgICAgICAgICAgICAgICBob2xkID4+Pj0gMjsKICAgICAgICAgICAgICAgICAgYml0cyAtPSAyOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoZXJlX3ZhbCA9PT0gMTcpIHsKICAgICAgICAgICAgICAgICAgbiA9IGhlcmVfYml0cyArIDM7CiAgICAgICAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgbikgewogICAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaG9sZCA+Pj49IGhlcmVfYml0czsKICAgICAgICAgICAgICAgICAgYml0cyAtPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICAgIGxlbjIgPSAwOwogICAgICAgICAgICAgICAgICBjb3B5ID0gMyArIChob2xkICYgNyk7CiAgICAgICAgICAgICAgICAgIGhvbGQgPj4+PSAzOwogICAgICAgICAgICAgICAgICBiaXRzIC09IDM7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBuID0gaGVyZV9iaXRzICsgNzsKICAgICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCBuKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBob2xkID4+Pj0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgICAgICAgICAgbGVuMiA9IDA7CiAgICAgICAgICAgICAgICAgIGNvcHkgPSAxMSArIChob2xkICYgMTI3KTsKICAgICAgICAgICAgICAgICAgaG9sZCA+Pj49IDc7CiAgICAgICAgICAgICAgICAgIGJpdHMgLT0gNzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5oYXZlICsgY29weSA+IHN0YXRlLm5sZW4gKyBzdGF0ZS5uZGlzdCkgewogICAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbnZhbGlkIGJpdCBsZW5ndGggcmVwZWF0IjsKICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aGlsZSAoY29weS0tKSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmxlbnNbc3RhdGUuaGF2ZSsrXSA9IGxlbjI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGF0ZS5tb2RlID09PSBCQUQpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhdGUubGVuc1syNTZdID09PSAwKSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBjb2RlIC0tIG1pc3NpbmcgZW5kLW9mLWJsb2NrIjsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmxlbmJpdHMgPSA5OwogICAgICAgICAgICBvcHRzID0geyBiaXRzOiBzdGF0ZS5sZW5iaXRzIH07CiAgICAgICAgICAgIHJldCA9IGluZmxhdGVfdGFibGUoTEVOUywgc3RhdGUubGVucywgMCwgc3RhdGUubmxlbiwgc3RhdGUubGVuY29kZSwgMCwgc3RhdGUud29yaywgb3B0cyk7CiAgICAgICAgICAgIHN0YXRlLmxlbmJpdHMgPSBvcHRzLmJpdHM7CiAgICAgICAgICAgIGlmIChyZXQpIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbnZhbGlkIGxpdGVyYWwvbGVuZ3RocyBzZXQiOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUuZGlzdGJpdHMgPSA2OwogICAgICAgICAgICBzdGF0ZS5kaXN0Y29kZSA9IHN0YXRlLmRpc3RkeW47CiAgICAgICAgICAgIG9wdHMgPSB7IGJpdHM6IHN0YXRlLmRpc3RiaXRzIH07CiAgICAgICAgICAgIHJldCA9IGluZmxhdGVfdGFibGUoRElTVFMsIHN0YXRlLmxlbnMsIHN0YXRlLm5sZW4sIHN0YXRlLm5kaXN0LCBzdGF0ZS5kaXN0Y29kZSwgMCwgc3RhdGUud29yaywgb3B0cyk7CiAgICAgICAgICAgIHN0YXRlLmRpc3RiaXRzID0gb3B0cy5iaXRzOwogICAgICAgICAgICBpZiAocmV0KSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZXMgc2V0IjsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU5fOwogICAgICAgICAgICBpZiAoZmx1c2gyID09PSBaX1RSRUVTKSB7CiAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIExFTl86CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU47CiAgICAgICAgICBjYXNlIExFTjoKICAgICAgICAgICAgaWYgKGhhdmUgPj0gNiAmJiBsZWZ0ID49IDI1OCkgewogICAgICAgICAgICAgIHN0cm0ubmV4dF9vdXQgPSBwdXQ7CiAgICAgICAgICAgICAgc3RybS5hdmFpbF9vdXQgPSBsZWZ0OwogICAgICAgICAgICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICAgICAgICAgICAgc3RybS5hdmFpbF9pbiA9IGhhdmU7CiAgICAgICAgICAgICAgc3RhdGUuaG9sZCA9IGhvbGQ7CiAgICAgICAgICAgICAgc3RhdGUuYml0cyA9IGJpdHM7CiAgICAgICAgICAgICAgaW5mbGF0ZV9mYXN0KHN0cm0sIF9vdXQpOwogICAgICAgICAgICAgIHB1dCA9IHN0cm0ubmV4dF9vdXQ7CiAgICAgICAgICAgICAgb3V0cHV0ID0gc3RybS5vdXRwdXQ7CiAgICAgICAgICAgICAgbGVmdCA9IHN0cm0uYXZhaWxfb3V0OwogICAgICAgICAgICAgIG5leHQgPSBzdHJtLm5leHRfaW47CiAgICAgICAgICAgICAgaW5wdXQgPSBzdHJtLmlucHV0OwogICAgICAgICAgICAgIGhhdmUgPSBzdHJtLmF2YWlsX2luOwogICAgICAgICAgICAgIGhvbGQgPSBzdGF0ZS5ob2xkOwogICAgICAgICAgICAgIGJpdHMgPSBzdGF0ZS5iaXRzOwogICAgICAgICAgICAgIGlmIChzdGF0ZS5tb2RlID09PSBUWVBFKSB7CiAgICAgICAgICAgICAgICBzdGF0ZS5iYWNrID0gLTE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmJhY2sgPSAwOwogICAgICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgICAgICBoZXJlID0gc3RhdGUubGVuY29kZVtob2xkICYgKDEgPDwgc3RhdGUubGVuYml0cykgLSAxXTsKICAgICAgICAgICAgICBoZXJlX2JpdHMgPSBoZXJlID4+PiAyNDsKICAgICAgICAgICAgICBoZXJlX29wID0gaGVyZSA+Pj4gMTYgJiAyNTU7CiAgICAgICAgICAgICAgaGVyZV92YWwgPSBoZXJlICYgNjU1MzU7CiAgICAgICAgICAgICAgaWYgKGhlcmVfYml0cyA8PSBiaXRzKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGVyZV9vcCAmJiAoaGVyZV9vcCAmIDI0MCkgPT09IDApIHsKICAgICAgICAgICAgICBsYXN0X2JpdHMgPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgbGFzdF9vcCA9IGhlcmVfb3A7CiAgICAgICAgICAgICAgbGFzdF92YWwgPSBoZXJlX3ZhbDsKICAgICAgICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5sZW5jb2RlW2xhc3RfdmFsICsgKChob2xkICYgKDEgPDwgbGFzdF9iaXRzICsgbGFzdF9vcCkgLSAxKSA+PiBsYXN0X2JpdHMpXTsKICAgICAgICAgICAgICAgIGhlcmVfYml0cyA9IGhlcmUgPj4+IDI0OwogICAgICAgICAgICAgICAgaGVyZV9vcCA9IGhlcmUgPj4+IDE2ICYgMjU1OwogICAgICAgICAgICAgICAgaGVyZV92YWwgPSBoZXJlICYgNjU1MzU7CiAgICAgICAgICAgICAgICBpZiAobGFzdF9iaXRzICsgaGVyZV9iaXRzIDw9IGJpdHMpIHsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaG9sZCA+Pj49IGxhc3RfYml0czsKICAgICAgICAgICAgICBiaXRzIC09IGxhc3RfYml0czsKICAgICAgICAgICAgICBzdGF0ZS5iYWNrICs9IGxhc3RfYml0czsKICAgICAgICAgICAgfQogICAgICAgICAgICBob2xkID4+Pj0gaGVyZV9iaXRzOwogICAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgICAgc3RhdGUuYmFjayArPSBoZXJlX2JpdHM7CiAgICAgICAgICAgIHN0YXRlLmxlbmd0aCA9IGhlcmVfdmFsOwogICAgICAgICAgICBpZiAoaGVyZV9vcCA9PT0gMCkgewogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBMSVQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhlcmVfb3AgJiAzMikgewogICAgICAgICAgICAgIHN0YXRlLmJhY2sgPSAtMTsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gVFlQRTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGVyZV9vcCAmIDY0KSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlIjsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmV4dHJhID0gaGVyZV9vcCAmIDE1OwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gTEVORVhUOwogICAgICAgICAgY2FzZSBMRU5FWFQ6CiAgICAgICAgICAgIGlmIChzdGF0ZS5leHRyYSkgewogICAgICAgICAgICAgIG4gPSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IG4pIHsKICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzdGF0ZS5sZW5ndGggKz0gaG9sZCAmICgxIDw8IHN0YXRlLmV4dHJhKSAtIDE7CiAgICAgICAgICAgICAgaG9sZCA+Pj49IHN0YXRlLmV4dHJhOwogICAgICAgICAgICAgIGJpdHMgLT0gc3RhdGUuZXh0cmE7CiAgICAgICAgICAgICAgc3RhdGUuYmFjayArPSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZS53YXMgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBESVNUOwogICAgICAgICAgY2FzZSBESVNUOgogICAgICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgICAgICBoZXJlID0gc3RhdGUuZGlzdGNvZGVbaG9sZCAmICgxIDw8IHN0YXRlLmRpc3RiaXRzKSAtIDFdOwogICAgICAgICAgICAgIGhlcmVfYml0cyA9IGhlcmUgPj4+IDI0OwogICAgICAgICAgICAgIGhlcmVfb3AgPSBoZXJlID4+PiAxNiAmIDI1NTsKICAgICAgICAgICAgICBoZXJlX3ZhbCA9IGhlcmUgJiA2NTUzNTsKICAgICAgICAgICAgICBpZiAoaGVyZV9iaXRzIDw9IGJpdHMpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoaGVyZV9vcCAmIDI0MCkgPT09IDApIHsKICAgICAgICAgICAgICBsYXN0X2JpdHMgPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgbGFzdF9vcCA9IGhlcmVfb3A7CiAgICAgICAgICAgICAgbGFzdF92YWwgPSBoZXJlX3ZhbDsKICAgICAgICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5kaXN0Y29kZVtsYXN0X3ZhbCArICgoaG9sZCAmICgxIDw8IGxhc3RfYml0cyArIGxhc3Rfb3ApIC0gMSkgPj4gbGFzdF9iaXRzKV07CiAgICAgICAgICAgICAgICBoZXJlX2JpdHMgPSBoZXJlID4+PiAyNDsKICAgICAgICAgICAgICAgIGhlcmVfb3AgPSBoZXJlID4+PiAxNiAmIDI1NTsKICAgICAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDY1NTM1OwogICAgICAgICAgICAgICAgaWYgKGxhc3RfYml0cyArIGhlcmVfYml0cyA8PSBiaXRzKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGhvbGQgPj4+PSBsYXN0X2JpdHM7CiAgICAgICAgICAgICAgYml0cyAtPSBsYXN0X2JpdHM7CiAgICAgICAgICAgICAgc3RhdGUuYmFjayArPSBsYXN0X2JpdHM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaG9sZCA+Pj49IGhlcmVfYml0czsKICAgICAgICAgICAgYml0cyAtPSBoZXJlX2JpdHM7CiAgICAgICAgICAgIHN0YXRlLmJhY2sgKz0gaGVyZV9iaXRzOwogICAgICAgICAgICBpZiAoaGVyZV9vcCAmIDY0KSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSBjb2RlIjsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLm9mZnNldCA9IGhlcmVfdmFsOwogICAgICAgICAgICBzdGF0ZS5leHRyYSA9IGhlcmVfb3AgJiAxNTsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IERJU1RFWFQ7CiAgICAgICAgICBjYXNlIERJU1RFWFQ6CiAgICAgICAgICAgIGlmIChzdGF0ZS5leHRyYSkgewogICAgICAgICAgICAgIG4gPSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IG4pIHsKICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzdGF0ZS5vZmZzZXQgKz0gaG9sZCAmICgxIDw8IHN0YXRlLmV4dHJhKSAtIDE7CiAgICAgICAgICAgICAgaG9sZCA+Pj49IHN0YXRlLmV4dHJhOwogICAgICAgICAgICAgIGJpdHMgLT0gc3RhdGUuZXh0cmE7CiAgICAgICAgICAgICAgc3RhdGUuYmFjayArPSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhdGUub2Zmc2V0ID4gc3RhdGUuZG1heCkgewogICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrIjsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBNQVRDSCQyOwogICAgICAgICAgY2FzZSBNQVRDSCQyOgogICAgICAgICAgICBpZiAobGVmdCA9PT0gMCkgewogICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb3B5ID0gX291dCAtIGxlZnQ7CiAgICAgICAgICAgIGlmIChzdGF0ZS5vZmZzZXQgPiBjb3B5KSB7CiAgICAgICAgICAgICAgY29weSA9IHN0YXRlLm9mZnNldCAtIGNvcHk7CiAgICAgICAgICAgICAgaWYgKGNvcHkgPiBzdGF0ZS53aGF2ZSkgewogICAgICAgICAgICAgICAgaWYgKHN0YXRlLnNhbmUpIHsKICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siOwogICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGNvcHkgPiBzdGF0ZS53bmV4dCkgewogICAgICAgICAgICAgICAgY29weSAtPSBzdGF0ZS53bmV4dDsKICAgICAgICAgICAgICAgIGZyb20yID0gc3RhdGUud3NpemUgLSBjb3B5OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmcm9tMiA9IHN0YXRlLnduZXh0IC0gY29weTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGNvcHkgPiBzdGF0ZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGNvcHkgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZyb21fc291cmNlID0gc3RhdGUud2luZG93OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGZyb21fc291cmNlID0gb3V0cHV0OwogICAgICAgICAgICAgIGZyb20yID0gcHV0IC0gc3RhdGUub2Zmc2V0OwogICAgICAgICAgICAgIGNvcHkgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNvcHkgPiBsZWZ0KSB7CiAgICAgICAgICAgICAgY29weSA9IGxlZnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGVmdCAtPSBjb3B5OwogICAgICAgICAgICBzdGF0ZS5sZW5ndGggLT0gY29weTsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIG91dHB1dFtwdXQrK10gPSBmcm9tX3NvdXJjZVtmcm9tMisrXTsKICAgICAgICAgICAgfSB3aGlsZSAoLS1jb3B5KTsKICAgICAgICAgICAgaWYgKHN0YXRlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIExJVDoKICAgICAgICAgICAgaWYgKGxlZnQgPT09IDApIHsKICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3V0cHV0W3B1dCsrXSA9IHN0YXRlLmxlbmd0aDsKICAgICAgICAgICAgbGVmdC0tOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gTEVOOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgQ0hFQ0s6CiAgICAgICAgICAgIGlmIChzdGF0ZS53cmFwKSB7CiAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgaG9sZCB8PSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF9vdXQgLT0gbGVmdDsKICAgICAgICAgICAgICBzdHJtLnRvdGFsX291dCArPSBfb3V0OwogICAgICAgICAgICAgIHN0YXRlLnRvdGFsICs9IF9vdXQ7CiAgICAgICAgICAgICAgaWYgKF9vdXQpIHsKICAgICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9IHN0YXRlLmZsYWdzID8gY3JjMzIkMShzdGF0ZS5jaGVjaywgb3V0cHV0LCBfb3V0LCBwdXQgLSBfb3V0KSA6IGFkbGVyMzIoc3RhdGUuY2hlY2ssIG91dHB1dCwgX291dCwgcHV0IC0gX291dCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF9vdXQgPSBsZWZ0OwogICAgICAgICAgICAgIGlmICgoc3RhdGUuZmxhZ3MgPyBob2xkIDogenN3YXAzMihob2xkKSkgIT09IHN0YXRlLmNoZWNrKSB7CiAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbmNvcnJlY3QgZGF0YSBjaGVjayI7CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU5HVEg7CiAgICAgICAgICBjYXNlIExFTkdUSDoKICAgICAgICAgICAgaWYgKHN0YXRlLndyYXAgJiYgc3RhdGUuZmxhZ3MpIHsKICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IDMyKSB7CiAgICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGhvbGQgIT09IChzdGF0ZS50b3RhbCAmIDQyOTQ5NjcyOTUpKSB7CiAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbmNvcnJlY3QgbGVuZ3RoIGNoZWNrIjsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUubW9kZSA9IERPTkU7CiAgICAgICAgICBjYXNlIERPTkU6CiAgICAgICAgICAgIHJldCA9IFpfU1RSRUFNX0VORDsKICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgY2FzZSBCQUQ6CiAgICAgICAgICAgIHJldCA9IFpfREFUQV9FUlJPUjsKICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgY2FzZSBNRU06CiAgICAgICAgICAgIHJldHVybiBaX01FTV9FUlJPUjsKICAgICAgICAgIGNhc2UgU1lOQzoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUjsKICAgICAgICB9CiAgICAgIH0KICAgIHN0cm0ubmV4dF9vdXQgPSBwdXQ7CiAgICBzdHJtLmF2YWlsX291dCA9IGxlZnQ7CiAgICBzdHJtLm5leHRfaW4gPSBuZXh0OwogICAgc3RybS5hdmFpbF9pbiA9IGhhdmU7CiAgICBzdGF0ZS5ob2xkID0gaG9sZDsKICAgIHN0YXRlLmJpdHMgPSBiaXRzOwogICAgaWYgKHN0YXRlLndzaXplIHx8IF9vdXQgIT09IHN0cm0uYXZhaWxfb3V0ICYmIHN0YXRlLm1vZGUgPCBCQUQgJiYgKHN0YXRlLm1vZGUgPCBDSEVDSyB8fCBmbHVzaDIgIT09IFpfRklOSVNIKSkgewogICAgICBpZiAodXBkYXRld2luZG93KHN0cm0sIHN0cm0ub3V0cHV0LCBzdHJtLm5leHRfb3V0LCBfb3V0IC0gc3RybS5hdmFpbF9vdXQpKQogICAgICAgIDsKICAgIH0KICAgIF9pbiAtPSBzdHJtLmF2YWlsX2luOwogICAgX291dCAtPSBzdHJtLmF2YWlsX291dDsKICAgIHN0cm0udG90YWxfaW4gKz0gX2luOwogICAgc3RybS50b3RhbF9vdXQgKz0gX291dDsKICAgIHN0YXRlLnRvdGFsICs9IF9vdXQ7CiAgICBpZiAoc3RhdGUud3JhcCAmJiBfb3V0KSB7CiAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9IHN0YXRlLmZsYWdzID8gY3JjMzIkMShzdGF0ZS5jaGVjaywgb3V0cHV0LCBfb3V0LCBzdHJtLm5leHRfb3V0IC0gX291dCkgOiBhZGxlcjMyKHN0YXRlLmNoZWNrLCBvdXRwdXQsIF9vdXQsIHN0cm0ubmV4dF9vdXQgLSBfb3V0KTsKICAgIH0KICAgIHN0cm0uZGF0YV90eXBlID0gc3RhdGUuYml0cyArIChzdGF0ZS5sYXN0ID8gNjQgOiAwKSArIChzdGF0ZS5tb2RlID09PSBUWVBFID8gMTI4IDogMCkgKyAoc3RhdGUubW9kZSA9PT0gTEVOXyB8fCBzdGF0ZS5tb2RlID09PSBDT1BZXyA/IDI1NiA6IDApOwogICAgaWYgKChfaW4gPT09IDAgJiYgX291dCA9PT0gMCB8fCBmbHVzaDIgPT09IFpfRklOSVNIKSAmJiByZXQgPT09IFpfT0spIHsKICAgICAgcmV0ID0gWl9CVUZfRVJST1I7CiAgICB9CiAgICByZXR1cm4gcmV0OwogIH0KICBmdW5jdGlvbiBpbmZsYXRlRW5kKHN0cm0pIHsKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICB9CiAgICB2YXIgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgaWYgKHN0YXRlLndpbmRvdykgewogICAgICBzdGF0ZS53aW5kb3cgPSBudWxsOwogICAgfQogICAgc3RybS5zdGF0ZSA9IG51bGw7CiAgICByZXR1cm4gWl9PSzsKICB9CiAgZnVuY3Rpb24gaW5mbGF0ZUdldEhlYWRlcihzdHJtLCBoZWFkMikgewogICAgdmFyIHN0YXRlOwogICAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlKSB7CiAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUjsKICAgIH0KICAgIHN0YXRlID0gc3RybS5zdGF0ZTsKICAgIGlmICgoc3RhdGUud3JhcCAmIDIpID09PSAwKSB7CiAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUjsKICAgIH0KICAgIHN0YXRlLmhlYWQgPSBoZWFkMjsKICAgIGhlYWQyLmRvbmUgPSBmYWxzZTsKICAgIHJldHVybiBaX09LOwogIH0KICBmdW5jdGlvbiBpbmZsYXRlU2V0RGljdGlvbmFyeShzdHJtLCBkaWN0aW9uYXJ5KSB7CiAgICB2YXIgZGljdExlbmd0aCA9IGRpY3Rpb25hcnkubGVuZ3RoOwogICAgdmFyIHN0YXRlOwogICAgdmFyIGRpY3RpZDsKICAgIHZhciByZXQ7CiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SOwogICAgfQogICAgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgaWYgKHN0YXRlLndyYXAgIT09IDAgJiYgc3RhdGUubW9kZSAhPT0gRElDVCkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICB9CiAgICBpZiAoc3RhdGUubW9kZSA9PT0gRElDVCkgewogICAgICBkaWN0aWQgPSAxOwogICAgICBkaWN0aWQgPSBhZGxlcjMyKGRpY3RpZCwgZGljdGlvbmFyeSwgZGljdExlbmd0aCwgMCk7CiAgICAgIGlmIChkaWN0aWQgIT09IHN0YXRlLmNoZWNrKSB7CiAgICAgICAgcmV0dXJuIFpfREFUQV9FUlJPUjsKICAgICAgfQogICAgfQogICAgcmV0ID0gdXBkYXRld2luZG93KHN0cm0sIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgsIGRpY3RMZW5ndGgpOwogICAgaWYgKHJldCkgewogICAgICBzdGF0ZS5tb2RlID0gTUVNOwogICAgICByZXR1cm4gWl9NRU1fRVJST1I7CiAgICB9CiAgICBzdGF0ZS5oYXZlZGljdCA9IDE7CiAgICByZXR1cm4gWl9PSzsKICB9CiAgaW5mbGF0ZSQzLmluZmxhdGVSZXNldCA9IGluZmxhdGVSZXNldDsKICBpbmZsYXRlJDMuaW5mbGF0ZVJlc2V0MiA9IGluZmxhdGVSZXNldDI7CiAgaW5mbGF0ZSQzLmluZmxhdGVSZXNldEtlZXAgPSBpbmZsYXRlUmVzZXRLZWVwOwogIGluZmxhdGUkMy5pbmZsYXRlSW5pdCA9IGluZmxhdGVJbml0OwogIGluZmxhdGUkMy5pbmZsYXRlSW5pdDIgPSBpbmZsYXRlSW5pdDI7CiAgaW5mbGF0ZSQzLmluZmxhdGUgPSBpbmZsYXRlJDI7CiAgaW5mbGF0ZSQzLmluZmxhdGVFbmQgPSBpbmZsYXRlRW5kOwogIGluZmxhdGUkMy5pbmZsYXRlR2V0SGVhZGVyID0gaW5mbGF0ZUdldEhlYWRlcjsKICBpbmZsYXRlJDMuaW5mbGF0ZVNldERpY3Rpb25hcnkgPSBpbmZsYXRlU2V0RGljdGlvbmFyeTsKICBpbmZsYXRlJDMuaW5mbGF0ZUluZm8gPSAicGFrbyBpbmZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSI7CiAgdmFyIGNvbnN0YW50cyQyID0gewogICAgWl9OT19GTFVTSDogMCwKICAgIFpfUEFSVElBTF9GTFVTSDogMSwKICAgIFpfU1lOQ19GTFVTSDogMiwKICAgIFpfRlVMTF9GTFVTSDogMywKICAgIFpfRklOSVNIOiA0LAogICAgWl9CTE9DSzogNSwKICAgIFpfVFJFRVM6IDYsCiAgICBaX09LOiAwLAogICAgWl9TVFJFQU1fRU5EOiAxLAogICAgWl9ORUVEX0RJQ1Q6IDIsCiAgICBaX0VSUk5POiAtMSwKICAgIFpfU1RSRUFNX0VSUk9SOiAtMiwKICAgIFpfREFUQV9FUlJPUjogLTMsCiAgICBaX0JVRl9FUlJPUjogLTUsCiAgICBaX05PX0NPTVBSRVNTSU9OOiAwLAogICAgWl9CRVNUX1NQRUVEOiAxLAogICAgWl9CRVNUX0NPTVBSRVNTSU9OOiA5LAogICAgWl9ERUZBVUxUX0NPTVBSRVNTSU9OOiAtMSwKICAgIFpfRklMVEVSRUQ6IDEsCiAgICBaX0hVRkZNQU5fT05MWTogMiwKICAgIFpfUkxFOiAzLAogICAgWl9GSVhFRDogNCwKICAgIFpfREVGQVVMVF9TVFJBVEVHWTogMCwKICAgIFpfQklOQVJZOiAwLAogICAgWl9URVhUOiAxLAogICAgWl9VTktOT1dOOiAyLAogICAgWl9ERUZMQVRFRDogOAogIH07CiAgZnVuY3Rpb24gR1poZWFkZXIkMSgpIHsKICAgIHRoaXMudGV4dCA9IDA7CiAgICB0aGlzLnRpbWUgPSAwOwogICAgdGhpcy54ZmxhZ3MgPSAwOwogICAgdGhpcy5vcyA9IDA7CiAgICB0aGlzLmV4dHJhID0gbnVsbDsKICAgIHRoaXMuZXh0cmFfbGVuID0gMDsKICAgIHRoaXMubmFtZSA9ICIiOwogICAgdGhpcy5jb21tZW50ID0gIiI7CiAgICB0aGlzLmhjcmMgPSAwOwogICAgdGhpcy5kb25lID0gZmFsc2U7CiAgfQogIHZhciBnemhlYWRlciA9IEdaaGVhZGVyJDE7CiAgdmFyIHpsaWJfaW5mbGF0ZSA9IGluZmxhdGUkMzsKICB2YXIgdXRpbHMgPSBjb21tb247CiAgdmFyIHN0cmluZ3MgPSBzdHJpbmdzJDI7CiAgdmFyIGMgPSBjb25zdGFudHMkMjsKICB2YXIgbXNnID0gbWVzc2FnZXM7CiAgdmFyIFpTdHJlYW0gPSB6c3RyZWFtOwogIHZhciBHWmhlYWRlciA9IGd6aGVhZGVyOwogIHZhciB0b1N0cmluZyQzID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKICBmdW5jdGlvbiBJbmZsYXRlJDEob3B0aW9ucykgewogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEluZmxhdGUkMSkpCiAgICAgIHJldHVybiBuZXcgSW5mbGF0ZSQxKG9wdGlvbnMpOwogICAgdGhpcy5vcHRpb25zID0gdXRpbHMuYXNzaWduKHsKICAgICAgY2h1bmtTaXplOiAxNjM4NCwKICAgICAgd2luZG93Qml0czogMCwKICAgICAgdG86ICIiCiAgICB9LCBvcHRpb25zIHx8IHt9KTsKICAgIHZhciBvcHQgPSB0aGlzLm9wdGlvbnM7CiAgICBpZiAob3B0LnJhdyAmJiBvcHQud2luZG93Qml0cyA+PSAwICYmIG9wdC53aW5kb3dCaXRzIDwgMTYpIHsKICAgICAgb3B0LndpbmRvd0JpdHMgPSAtb3B0LndpbmRvd0JpdHM7CiAgICAgIGlmIChvcHQud2luZG93Qml0cyA9PT0gMCkgewogICAgICAgIG9wdC53aW5kb3dCaXRzID0gLTE1OwogICAgICB9CiAgICB9CiAgICBpZiAob3B0LndpbmRvd0JpdHMgPj0gMCAmJiBvcHQud2luZG93Qml0cyA8IDE2ICYmICEob3B0aW9ucyAmJiBvcHRpb25zLndpbmRvd0JpdHMpKSB7CiAgICAgIG9wdC53aW5kb3dCaXRzICs9IDMyOwogICAgfQogICAgaWYgKG9wdC53aW5kb3dCaXRzID4gMTUgJiYgb3B0LndpbmRvd0JpdHMgPCA0OCkgewogICAgICBpZiAoKG9wdC53aW5kb3dCaXRzICYgMTUpID09PSAwKSB7CiAgICAgICAgb3B0LndpbmRvd0JpdHMgfD0gMTU7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuZXJyID0gMDsKICAgIHRoaXMubXNnID0gIiI7CiAgICB0aGlzLmVuZGVkID0gZmFsc2U7CiAgICB0aGlzLmNodW5rcyA9IFtdOwogICAgdGhpcy5zdHJtID0gbmV3IFpTdHJlYW0oKTsKICAgIHRoaXMuc3RybS5hdmFpbF9vdXQgPSAwOwogICAgdmFyIHN0YXR1cyA9IHpsaWJfaW5mbGF0ZS5pbmZsYXRlSW5pdDIodGhpcy5zdHJtLCBvcHQud2luZG93Qml0cyk7CiAgICBpZiAoc3RhdHVzICE9PSBjLlpfT0spIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZ1tzdGF0dXNdKTsKICAgIH0KICAgIHRoaXMuaGVhZGVyID0gbmV3IEdaaGVhZGVyKCk7CiAgICB6bGliX2luZmxhdGUuaW5mbGF0ZUdldEhlYWRlcih0aGlzLnN0cm0sIHRoaXMuaGVhZGVyKTsKICAgIGlmIChvcHQuZGljdGlvbmFyeSkgewogICAgICBpZiAodHlwZW9mIG9wdC5kaWN0aW9uYXJ5ID09PSAic3RyaW5nIikgewogICAgICAgIG9wdC5kaWN0aW9uYXJ5ID0gc3RyaW5ncy5zdHJpbmcyYnVmKG9wdC5kaWN0aW9uYXJ5KTsKICAgICAgfSBlbHNlIGlmICh0b1N0cmluZyQzLmNhbGwob3B0LmRpY3Rpb25hcnkpID09PSAiW29iamVjdCBBcnJheUJ1ZmZlcl0iKSB7CiAgICAgICAgb3B0LmRpY3Rpb25hcnkgPSBuZXcgVWludDhBcnJheShvcHQuZGljdGlvbmFyeSk7CiAgICAgIH0KICAgICAgaWYgKG9wdC5yYXcpIHsKICAgICAgICBzdGF0dXMgPSB6bGliX2luZmxhdGUuaW5mbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLCBvcHQuZGljdGlvbmFyeSk7CiAgICAgICAgaWYgKHN0YXR1cyAhPT0gYy5aX09LKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnW3N0YXR1c10pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBJbmZsYXRlJDEucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbihkYXRhMiwgbW9kZSkgewogICAgdmFyIHN0cm0gPSB0aGlzLnN0cm07CiAgICB2YXIgY2h1bmtTaXplID0gdGhpcy5vcHRpb25zLmNodW5rU2l6ZTsKICAgIHZhciBkaWN0aW9uYXJ5ID0gdGhpcy5vcHRpb25zLmRpY3Rpb25hcnk7CiAgICB2YXIgc3RhdHVzLCBfbW9kZTsKICAgIHZhciBuZXh0X291dF91dGY4LCB0YWlsLCB1dGY4c3RyOwogICAgdmFyIGFsbG93QnVmRXJyb3IgPSBmYWxzZTsKICAgIGlmICh0aGlzLmVuZGVkKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIF9tb2RlID0gbW9kZSA9PT0gfn5tb2RlID8gbW9kZSA6IG1vZGUgPT09IHRydWUgPyBjLlpfRklOSVNIIDogYy5aX05PX0ZMVVNIOwogICAgaWYgKHR5cGVvZiBkYXRhMiA9PT0gInN0cmluZyIpIHsKICAgICAgc3RybS5pbnB1dCA9IHN0cmluZ3MuYmluc3RyaW5nMmJ1ZihkYXRhMik7CiAgICB9IGVsc2UgaWYgKHRvU3RyaW5nJDMuY2FsbChkYXRhMikgPT09ICJbb2JqZWN0IEFycmF5QnVmZmVyXSIpIHsKICAgICAgc3RybS5pbnB1dCA9IG5ldyBVaW50OEFycmF5KGRhdGEyKTsKICAgIH0gZWxzZSB7CiAgICAgIHN0cm0uaW5wdXQgPSBkYXRhMjsKICAgIH0KICAgIHN0cm0ubmV4dF9pbiA9IDA7CiAgICBzdHJtLmF2YWlsX2luID0gc3RybS5pbnB1dC5sZW5ndGg7CiAgICBkbyB7CiAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHN0cm0ub3V0cHV0ID0gbmV3IHV0aWxzLkJ1ZjgoY2h1bmtTaXplKTsKICAgICAgICBzdHJtLm5leHRfb3V0ID0gMDsKICAgICAgICBzdHJtLmF2YWlsX291dCA9IGNodW5rU2l6ZTsKICAgICAgfQogICAgICBzdGF0dXMgPSB6bGliX2luZmxhdGUuaW5mbGF0ZShzdHJtLCBjLlpfTk9fRkxVU0gpOwogICAgICBpZiAoc3RhdHVzID09PSBjLlpfTkVFRF9ESUNUICYmIGRpY3Rpb25hcnkpIHsKICAgICAgICBzdGF0dXMgPSB6bGliX2luZmxhdGUuaW5mbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLCBkaWN0aW9uYXJ5KTsKICAgICAgfQogICAgICBpZiAoc3RhdHVzID09PSBjLlpfQlVGX0VSUk9SICYmIGFsbG93QnVmRXJyb3IgPT09IHRydWUpIHsKICAgICAgICBzdGF0dXMgPSBjLlpfT0s7CiAgICAgICAgYWxsb3dCdWZFcnJvciA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChzdGF0dXMgIT09IGMuWl9TVFJFQU1fRU5EICYmIHN0YXR1cyAhPT0gYy5aX09LKSB7CiAgICAgICAgdGhpcy5vbkVuZChzdGF0dXMpOwogICAgICAgIHRoaXMuZW5kZWQgPSB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAoc3RybS5uZXh0X291dCkgewogICAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCB8fCBzdGF0dXMgPT09IGMuWl9TVFJFQU1fRU5EIHx8IHN0cm0uYXZhaWxfaW4gPT09IDAgJiYgKF9tb2RlID09PSBjLlpfRklOSVNIIHx8IF9tb2RlID09PSBjLlpfU1lOQ19GTFVTSCkpIHsKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG8gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIG5leHRfb3V0X3V0ZjggPSBzdHJpbmdzLnV0Zjhib3JkZXIoc3RybS5vdXRwdXQsIHN0cm0ubmV4dF9vdXQpOwogICAgICAgICAgICB0YWlsID0gc3RybS5uZXh0X291dCAtIG5leHRfb3V0X3V0Zjg7CiAgICAgICAgICAgIHV0ZjhzdHIgPSBzdHJpbmdzLmJ1ZjJzdHJpbmcoc3RybS5vdXRwdXQsIG5leHRfb3V0X3V0ZjgpOwogICAgICAgICAgICBzdHJtLm5leHRfb3V0ID0gdGFpbDsKICAgICAgICAgICAgc3RybS5hdmFpbF9vdXQgPSBjaHVua1NpemUgLSB0YWlsOwogICAgICAgICAgICBpZiAodGFpbCkgewogICAgICAgICAgICAgIHV0aWxzLmFycmF5U2V0KHN0cm0ub3V0cHV0LCBzdHJtLm91dHB1dCwgbmV4dF9vdXRfdXRmOCwgdGFpbCwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5vbkRhdGEodXRmOHN0cik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLm9uRGF0YSh1dGlscy5zaHJpbmtCdWYoc3RybS5vdXRwdXQsIHN0cm0ubmV4dF9vdXQpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHN0cm0uYXZhaWxfaW4gPT09IDAgJiYgc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICBhbGxvd0J1ZkVycm9yID0gdHJ1ZTsKICAgICAgfQogICAgfSB3aGlsZSAoKHN0cm0uYXZhaWxfaW4gPiAwIHx8IHN0cm0uYXZhaWxfb3V0ID09PSAwKSAmJiBzdGF0dXMgIT09IGMuWl9TVFJFQU1fRU5EKTsKICAgIGlmIChzdGF0dXMgPT09IGMuWl9TVFJFQU1fRU5EKSB7CiAgICAgIF9tb2RlID0gYy5aX0ZJTklTSDsKICAgIH0KICAgIGlmIChfbW9kZSA9PT0gYy5aX0ZJTklTSCkgewogICAgICBzdGF0dXMgPSB6bGliX2luZmxhdGUuaW5mbGF0ZUVuZCh0aGlzLnN0cm0pOwogICAgICB0aGlzLm9uRW5kKHN0YXR1cyk7CiAgICAgIHRoaXMuZW5kZWQgPSB0cnVlOwogICAgICByZXR1cm4gc3RhdHVzID09PSBjLlpfT0s7CiAgICB9CiAgICBpZiAoX21vZGUgPT09IGMuWl9TWU5DX0ZMVVNIKSB7CiAgICAgIHRoaXMub25FbmQoYy5aX09LKTsKICAgICAgc3RybS5hdmFpbF9vdXQgPSAwOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH07CiAgSW5mbGF0ZSQxLnByb3RvdHlwZS5vbkRhdGEgPSBmdW5jdGlvbihjaHVuazIpIHsKICAgIHRoaXMuY2h1bmtzLnB1c2goY2h1bmsyKTsKICB9OwogIEluZmxhdGUkMS5wcm90b3R5cGUub25FbmQgPSBmdW5jdGlvbihzdGF0dXMpIHsKICAgIGlmIChzdGF0dXMgPT09IGMuWl9PSykgewogICAgICBpZiAodGhpcy5vcHRpb25zLnRvID09PSAic3RyaW5nIikgewogICAgICAgIHRoaXMucmVzdWx0ID0gdGhpcy5jaHVua3Muam9pbigiIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSB1dGlscy5mbGF0dGVuQ2h1bmtzKHRoaXMuY2h1bmtzKTsKICAgICAgfQogICAgfQogICAgdGhpcy5jaHVua3MgPSBbXTsKICAgIHRoaXMuZXJyID0gc3RhdHVzOwogICAgdGhpcy5tc2cgPSB0aGlzLnN0cm0ubXNnOwogIH07CiAgZnVuY3Rpb24gaW5mbGF0ZSQxKGlucHV0LCBvcHRpb25zKSB7CiAgICB2YXIgaW5mbGF0b3IgPSBuZXcgSW5mbGF0ZSQxKG9wdGlvbnMpOwogICAgaW5mbGF0b3IucHVzaChpbnB1dCwgdHJ1ZSk7CiAgICBpZiAoaW5mbGF0b3IuZXJyKSB7CiAgICAgIHRocm93IGluZmxhdG9yLm1zZyB8fCBtc2dbaW5mbGF0b3IuZXJyXTsKICAgIH0KICAgIHJldHVybiBpbmZsYXRvci5yZXN1bHQ7CiAgfQogIGZ1bmN0aW9uIGluZmxhdGVSYXcoaW5wdXQsIG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgb3B0aW9ucy5yYXcgPSB0cnVlOwogICAgcmV0dXJuIGluZmxhdGUkMShpbnB1dCwgb3B0aW9ucyk7CiAgfQogIGluZmxhdGUkNC5JbmZsYXRlID0gSW5mbGF0ZSQxOwogIGluZmxhdGUkNC5pbmZsYXRlID0gaW5mbGF0ZSQxOwogIGluZmxhdGUkNC5pbmZsYXRlUmF3ID0gaW5mbGF0ZVJhdzsKICBpbmZsYXRlJDQudW5nemlwID0gaW5mbGF0ZSQxOwogIHZhciBhc3NpZ24gPSBjb21tb24uYXNzaWduOwogIHZhciBkZWZsYXRlID0gZGVmbGF0ZSQ0OwogIHZhciBpbmZsYXRlID0gaW5mbGF0ZSQ0OwogIHZhciBjb25zdGFudHMkMSA9IGNvbnN0YW50cyQyOwogIHZhciBwYWtvID0ge307CiAgYXNzaWduKHBha28sIGRlZmxhdGUsIGluZmxhdGUsIGNvbnN0YW50cyQxKTsKICB2YXIgcGFrb18xID0gcGFrbzsKICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQ1ID0gaW50ZXJvcFJlcXVpcmVEZWZhdWx0LmV4cG9ydHM7CiAgdmFyIF9yZWdlbmVyYXRvciQ1ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQ1KHJlZ2VuZXJhdG9yKTsKICB2YXIgX2FzeW5jVG9HZW5lcmF0b3IyJDUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDUoYXN5bmNUb0dlbmVyYXRvci5leHBvcnRzKTsKICB2YXIgX3JlcXVpcmUkMiA9IHBha29fMSwgWl9TWU5DX0ZMVVNIID0gX3JlcXVpcmUkMi5aX1NZTkNfRkxVU0gsIEluZmxhdGUgPSBfcmVxdWlyZSQyLkluZmxhdGU7CiAgZnVuY3Rpb24gdW56aXAkMihfeCkgewogICAgcmV0dXJuIF91bnppcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0KICBmdW5jdGlvbiBfdW56aXAoKSB7CiAgICBfdW56aXAgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyJDUuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvciQ1LmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKGlucHV0RGF0YSkgewogICAgICB2YXIgc3RybSwgcG9zLCBpMiwgY2h1bmtzLCBpbmZsYXRvciwgcmVtYWluaW5nSW5wdXQsIF9pbmZsYXRvciwgcmVzdWx0OwogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDUuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAwOwogICAgICAgICAgICAgIHBvcyA9IDA7CiAgICAgICAgICAgICAgaTIgPSAwOwogICAgICAgICAgICAgIGNodW5rcyA9IFtdOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgcmVtYWluaW5nSW5wdXQgPSBpbnB1dERhdGEuc2xpY2UocG9zKTsKICAgICAgICAgICAgICBpbmZsYXRvciA9IG5ldyBJbmZsYXRlKCk7CiAgICAgICAgICAgICAgX2luZmxhdG9yID0gaW5mbGF0b3I7CiAgICAgICAgICAgICAgc3RybSA9IF9pbmZsYXRvci5zdHJtOwogICAgICAgICAgICAgIGluZmxhdG9yLnB1c2gocmVtYWluaW5nSW5wdXQsIFpfU1lOQ19GTFVTSCk7CiAgICAgICAgICAgICAgaWYgKCFpbmZsYXRvci5lcnIpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoaW5mbGF0b3IubXNnKTsKICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICBwb3MgKz0gc3RybS5uZXh0X2luOwogICAgICAgICAgICAgIGNodW5rc1tpMl0gPSBCdWZmZXIuZnJvbShpbmZsYXRvci5yZXN1bHQpOwogICAgICAgICAgICAgIGkyICs9IDE7CiAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgaWYgKHN0cm0uYXZhaWxfaW4pIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgIHJlc3VsdCA9IEJ1ZmZlci5jb25jYXQoY2h1bmtzKTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCByZXN1bHQpOwogICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxOTsKICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDApOwogICAgICAgICAgICAgIGlmICghX2NvbnRleHQudDAubWVzc2FnZS5tYXRjaCgvaW5jb3JyZWN0IGhlYWRlciBjaGVjay8pKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJwcm9ibGVtIGRlY29tcHJlc3NpbmcgYmxvY2s6IGluY29ycmVjdCBnemlwIGhlYWRlciBjaGVjayIpOwogICAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlLCBudWxsLCBbWzAsIDE5XV0pOwogICAgfSkpOwogICAgcmV0dXJuIF91bnppcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0KICBmdW5jdGlvbiB1bnppcENodW5rJDEoX3gyKSB7CiAgICByZXR1cm4gX3VuemlwQ2h1bmsuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9CiAgZnVuY3Rpb24gX3VuemlwQ2h1bmsoKSB7CiAgICBfdW56aXBDaHVuayA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIkNS5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yJDUuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKGlucHV0RGF0YSkgewogICAgICB2YXIgc3RybSwgY3BvcywgZHBvcywgYmxvY2tzLCBjcG9zaXRpb25zLCBkcG9zaXRpb25zLCByZW1haW5pbmdJbnB1dCwgaW5mbGF0b3IsIF9idWZmZXIsIGJ1ZmZlcjI7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IkNS5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMDsKICAgICAgICAgICAgICBjcG9zID0gMDsKICAgICAgICAgICAgICBkcG9zID0gMDsKICAgICAgICAgICAgICBibG9ja3MgPSBbXTsKICAgICAgICAgICAgICBjcG9zaXRpb25zID0gW107CiAgICAgICAgICAgICAgZHBvc2l0aW9ucyA9IFtdOwogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgcmVtYWluaW5nSW5wdXQgPSBpbnB1dERhdGEuc2xpY2UoY3Bvcyk7CiAgICAgICAgICAgICAgaW5mbGF0b3IgPSBuZXcgSW5mbGF0ZSgpOwogICAgICAgICAgICAgIHN0cm0gPSBpbmZsYXRvci5zdHJtOwogICAgICAgICAgICAgIGluZmxhdG9yLnB1c2gocmVtYWluaW5nSW5wdXQsIFpfU1lOQ19GTFVTSCk7CiAgICAgICAgICAgICAgaWYgKCFpbmZsYXRvci5lcnIpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGluZmxhdG9yLm1zZyk7CiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgX2J1ZmZlciA9IEJ1ZmZlci5mcm9tKGluZmxhdG9yLnJlc3VsdCk7CiAgICAgICAgICAgICAgYmxvY2tzLnB1c2goX2J1ZmZlcik7CiAgICAgICAgICAgICAgY3Bvc2l0aW9ucy5wdXNoKGNwb3MpOwogICAgICAgICAgICAgIGRwb3NpdGlvbnMucHVzaChkcG9zKTsKICAgICAgICAgICAgICBjcG9zICs9IHN0cm0ubmV4dF9pbjsKICAgICAgICAgICAgICBkcG9zICs9IF9idWZmZXIubGVuZ3RoOwogICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgIGlmIChzdHJtLmF2YWlsX2luKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDY7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgYnVmZmVyMiA9IEJ1ZmZlci5jb25jYXQoYmxvY2tzKTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgeyBidWZmZXI6IGJ1ZmZlcjIsIGNwb3NpdGlvbnMsIGRwb3NpdGlvbnMgfSk7CiAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAyMzsKICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgaWYgKCFfY29udGV4dDIudDAubWVzc2FnZS5tYXRjaCgvaW5jb3JyZWN0IGhlYWRlciBjaGVjay8pKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI3OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigicHJvYmxlbSBkZWNvbXByZXNzaW5nIGJsb2NrOiBpbmNvcnJlY3QgZ3ppcCBoZWFkZXIgY2hlY2siKTsKICAgICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUyLCBudWxsLCBbWzAsIDIzXV0pOwogICAgfSkpOwogICAgcmV0dXJuIF91bnppcENodW5rLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQogIGZ1bmN0aW9uIHVuemlwQ2h1bmtTbGljZSQxKF94MywgX3g0KSB7CiAgICByZXR1cm4gX3VuemlwQ2h1bmtTbGljZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0KICBmdW5jdGlvbiBfdW56aXBDaHVua1NsaWNlKCkgewogICAgX3VuemlwQ2h1bmtTbGljZSA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIkNS5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yJDUuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKGlucHV0RGF0YSwgY2h1bmsyKSB7CiAgICAgIHZhciBzdHJtLCBjcG9zLCBkcG9zLCBkZWNvbXByZXNzZWRCbG9ja3MsIGNwb3NpdGlvbnMsIGRwb3NpdGlvbnMsIHJlbWFpbmluZ0lucHV0LCBpbmZsYXRvciwgX2J1ZmZlcjIsIGxlbjIsIG9yaWdDcG9zLCBidWZmZXIyOwogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDUuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dDMucHJldiA9IDA7CiAgICAgICAgICAgICAgY3BvcyA9IGNodW5rMi5taW52LmJsb2NrUG9zaXRpb247CiAgICAgICAgICAgICAgZHBvcyA9IGNodW5rMi5taW52LmRhdGFQb3NpdGlvbjsKICAgICAgICAgICAgICBkZWNvbXByZXNzZWRCbG9ja3MgPSBbXTsKICAgICAgICAgICAgICBjcG9zaXRpb25zID0gW107CiAgICAgICAgICAgICAgZHBvc2l0aW9ucyA9IFtdOwogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgcmVtYWluaW5nSW5wdXQgPSBpbnB1dERhdGEuc2xpY2UoY3BvcyAtIGNodW5rMi5taW52LmJsb2NrUG9zaXRpb24pOwogICAgICAgICAgICAgIGluZmxhdG9yID0gbmV3IEluZmxhdGUoKTsKICAgICAgICAgICAgICBzdHJtID0gaW5mbGF0b3Iuc3RybTsKICAgICAgICAgICAgICBpbmZsYXRvci5wdXNoKHJlbWFpbmluZ0lucHV0LCBaX1NZTkNfRkxVU0gpOwogICAgICAgICAgICAgIGlmICghaW5mbGF0b3IuZXJyKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihpbmZsYXRvci5tc2cpOwogICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgIF9idWZmZXIyID0gQnVmZmVyLmZyb20oaW5mbGF0b3IucmVzdWx0KTsKICAgICAgICAgICAgICBkZWNvbXByZXNzZWRCbG9ja3MucHVzaChfYnVmZmVyMik7CiAgICAgICAgICAgICAgbGVuMiA9IF9idWZmZXIyLmxlbmd0aDsKICAgICAgICAgICAgICBjcG9zaXRpb25zLnB1c2goY3Bvcyk7CiAgICAgICAgICAgICAgZHBvc2l0aW9ucy5wdXNoKGRwb3MpOwogICAgICAgICAgICAgIGlmIChkZWNvbXByZXNzZWRCbG9ja3MubGVuZ3RoID09PSAxICYmIGNodW5rMi5taW52LmRhdGFQb3NpdGlvbikgewogICAgICAgICAgICAgICAgZGVjb21wcmVzc2VkQmxvY2tzWzBdID0gZGVjb21wcmVzc2VkQmxvY2tzWzBdLnNsaWNlKGNodW5rMi5taW52LmRhdGFQb3NpdGlvbik7CiAgICAgICAgICAgICAgICBsZW4yID0gZGVjb21wcmVzc2VkQmxvY2tzWzBdLmxlbmd0aDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgb3JpZ0Nwb3MgPSBjcG9zOwogICAgICAgICAgICAgIGNwb3MgKz0gc3RybS5uZXh0X2luOwogICAgICAgICAgICAgIGRwb3MgKz0gbGVuMjsKICAgICAgICAgICAgICBpZiAoIShvcmlnQ3BvcyA+PSBjaHVuazIubWF4di5ibG9ja1Bvc2l0aW9uKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyNjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBkZWNvbXByZXNzZWRCbG9ja3NbZGVjb21wcmVzc2VkQmxvY2tzLmxlbmd0aCAtIDFdID0gZGVjb21wcmVzc2VkQmxvY2tzW2RlY29tcHJlc3NlZEJsb2Nrcy5sZW5ndGggLSAxXS5zbGljZSgwLCBjaHVuazIubWF4di5ibG9ja1Bvc2l0aW9uID09PSBjaHVuazIubWludi5ibG9ja1Bvc2l0aW9uID8gY2h1bmsyLm1heHYuZGF0YVBvc2l0aW9uIC0gY2h1bmsyLm1pbnYuZGF0YVBvc2l0aW9uICsgMSA6IGNodW5rMi5tYXh2LmRhdGFQb3NpdGlvbiArIDEpOwogICAgICAgICAgICAgIGNwb3NpdGlvbnMucHVzaChjcG9zKTsKICAgICAgICAgICAgICBkcG9zaXRpb25zLnB1c2goZHBvcyk7CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoImJyZWFrIiwgMjcpOwogICAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgICAgIGlmIChzdHJtLmF2YWlsX2luKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDY7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgYnVmZmVyMiA9IEJ1ZmZlci5jb25jYXQoZGVjb21wcmVzc2VkQmxvY2tzKTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgeyBidWZmZXI6IGJ1ZmZlcjIsIGNwb3NpdGlvbnMsIGRwb3NpdGlvbnMgfSk7CiAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgX2NvbnRleHQzLnByZXYgPSAzMTsKICAgICAgICAgICAgICBfY29udGV4dDMudDAgPSBfY29udGV4dDNbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgaWYgKCFfY29udGV4dDMudDAubWVzc2FnZS5tYXRjaCgvaW5jb3JyZWN0IGhlYWRlciBjaGVjay8pKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDM1OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigicHJvYmxlbSBkZWNvbXByZXNzaW5nIGJsb2NrOiBpbmNvcnJlY3QgZ3ppcCBoZWFkZXIgY2hlY2siKTsKICAgICAgICAgICAgY2FzZSAzNToKICAgICAgICAgICAgICB0aHJvdyBfY29udGV4dDMudDA7CiAgICAgICAgICAgIGNhc2UgMzY6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlMywgbnVsbCwgW1swLCAzMV1dKTsKICAgIH0pKTsKICAgIHJldHVybiBfdW56aXBDaHVua1NsaWNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQogIHZhciB1bnppcFBha28gPSB7CiAgICB1bnppcDogdW56aXAkMiwKICAgIHVuemlwQ2h1bms6IHVuemlwQ2h1bmskMSwKICAgIHVuemlwQ2h1bmtTbGljZTogdW56aXBDaHVua1NsaWNlJDEsCiAgICBwYWtvVW56aXA6IHVuemlwJDIsCiAgICBub2RlVW56aXA6IGZ1bmN0aW9uIG5vZGVVbnppcCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJub2RlVW56aXAgbm90IGltcGxlbWVudGVkLiIpOwogICAgfQogIH07CiAgdmFyIF9fdml0ZUJyb3dzZXJFeHRlcm5hbCA9IG5ldyBQcm94eSh7fSwgewogICAgZ2V0KCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ01vZHVsZSAiIiBoYXMgYmVlbiBleHRlcm5hbGl6ZWQgZm9yIGJyb3dzZXIgY29tcGF0aWJpbGl0eSBhbmQgY2Fubm90IGJlIGFjY2Vzc2VkIGluIGNsaWVudCBjb2RlLicpOwogICAgfQogIH0pOwogIHZhciBfX3ZpdGVCcm93c2VyRXh0ZXJuYWwkMSA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuZnJlZXplKHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgICJkZWZhdWx0IjogX192aXRlQnJvd3NlckV4dGVybmFsCiAgfSk7CiAgdmFyIHJlcXVpcmUkJDEgPSAvKiBAX19QVVJFX18gKi8gZ2V0QXVnbWVudGVkTmFtZXNwYWNlKF9fdml0ZUJyb3dzZXJFeHRlcm5hbCQxKTsKICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQ0ID0gaW50ZXJvcFJlcXVpcmVEZWZhdWx0LmV4cG9ydHM7CiAgdmFyIF9yZWdlbmVyYXRvciQ0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQ0KHJlZ2VuZXJhdG9yKTsKICB2YXIgX2FzeW5jVG9HZW5lcmF0b3IyJDQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDQoYXN5bmNUb0dlbmVyYXRvci5leHBvcnRzKTsKICB2YXIgX2NsYXNzQ2FsbENoZWNrMiQ0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQ0KGNsYXNzQ2FsbENoZWNrLmV4cG9ydHMpOwogIHZhciBfY3JlYXRlQ2xhc3MyJDQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDQoY3JlYXRlQ2xhc3MuZXhwb3J0cyk7CiAgdmFyIGZzID0gcmVxdWlyZSQkMTsKICB2YXIgTG9jYWxGaWxlJDIgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBMb2NhbEZpbGUyKHBhdGgyKSB7CiAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syJDQuZGVmYXVsdCkodGhpcywgTG9jYWxGaWxlMik7CiAgICAgIHRoaXMuZmRQcm9taXNlID0gZnMub3BlbihwYXRoMiwgInIiKTsKICAgICAgdGhpcy5wYXRoID0gcGF0aDI7CiAgICB9CiAgICAoMCwgX2NyZWF0ZUNsYXNzMiQ0LmRlZmF1bHQpKExvY2FsRmlsZTIsIFt7IGtleTogInJlYWQiLCB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfcmVhZCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIkNC5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yJDQuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoYnVmLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pIHsKICAgICAgICB2YXIgZmQsIHJldDsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDQuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mZFByb21pc2U7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgZmQgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU7CiAgICAgICAgICAgICAgICByZXR1cm4gZnMucmVhZChmZCwgYnVmLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pOwogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJldCA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCByZXQpOwogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICB9KSk7CiAgICAgIGZ1bmN0aW9uIHJlYWQoX3gsIF94MiwgX3gzLCBfeDQpIHsKICAgICAgICByZXR1cm4gX3JlYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgICByZXR1cm4gcmVhZDsKICAgIH0oKSB9LCB7IGtleTogInN0YXQiLCB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfc3RhdCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIkNC5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yJDQuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHZhciBmZDsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDQuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZkUHJvbWlzZTsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBmZCA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIGZzLmZzdGF0KGZkKSk7CiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwogICAgICBmdW5jdGlvbiBzdGF0KCkgewogICAgICAgIHJldHVybiBfc3RhdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CiAgICAgIHJldHVybiBzdGF0OwogICAgfSgpIH1dKTsKICAgIHJldHVybiBMb2NhbEZpbGUyOwogIH0oKTsKICB2YXIgbG9jYWxGaWxlID0gTG9jYWxGaWxlJDI7CiAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkMyA9IGludGVyb3BSZXF1aXJlRGVmYXVsdC5leHBvcnRzOwogIHZhciBfcmVnZW5lcmF0b3IkMyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkMyhyZWdlbmVyYXRvcik7CiAgdmFyIF9hc3luY1RvR2VuZXJhdG9yMiQzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQzKGFzeW5jVG9HZW5lcmF0b3IuZXhwb3J0cyk7CiAgdmFyIF9jbGFzc0NhbGxDaGVjazIkMyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkMyhjbGFzc0NhbGxDaGVjay5leHBvcnRzKTsKICB2YXIgX2NyZWF0ZUNsYXNzMiQzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQzKGNyZWF0ZUNsYXNzLmV4cG9ydHMpOwogIHZhciBMb25nID0gbG9uZzsKICB2YXIgTG9jYWxGaWxlJDEgPSBsb2NhbEZpbGU7CiAgdmFyIFVOQ09NUFJFU1NFRF9QT1NJVElPTiA9IDE7CiAgdmFyIEd6aUluZGV4JDEgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBHemlJbmRleDIoX3JlZikgewogICAgICB2YXIgZmlsZWhhbmRsZTIgPSBfcmVmLmZpbGVoYW5kbGUsIHBhdGgyID0gX3JlZi5wYXRoOwogICAgICAoMCwgX2NsYXNzQ2FsbENoZWNrMiQzLmRlZmF1bHQpKHRoaXMsIEd6aUluZGV4Mik7CiAgICAgIGlmIChmaWxlaGFuZGxlMikKICAgICAgICB0aGlzLmZpbGVoYW5kbGUgPSBmaWxlaGFuZGxlMjsKICAgICAgZWxzZSBpZiAocGF0aDIpCiAgICAgICAgdGhpcy5maWxlaGFuZGxlID0gbmV3IExvY2FsRmlsZSQxKHBhdGgyKTsKICAgICAgZWxzZQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImVpdGhlciBmaWxlaGFuZGxlIG9yIHBhdGggbXVzdCBiZSBkZWZpbmVkIik7CiAgICB9CiAgICAoMCwgX2NyZWF0ZUNsYXNzMiQzLmRlZmF1bHQpKEd6aUluZGV4MiwgW3sga2V5OiAiX3JlYWRMb25nV2l0aE92ZXJmbG93IiwgdmFsdWU6IGZ1bmN0aW9uIF9yZWFkTG9uZ1dpdGhPdmVyZmxvdyhidWYpIHsKICAgICAgdmFyIG9mZnNldCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDogMDsKICAgICAgdmFyIHVuc2lnbmVkID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMl0gOiB0cnVlOwogICAgICB2YXIgbG9uZzIgPSBMb25nLmZyb21CeXRlc0xFKGJ1Zi5zbGljZShvZmZzZXQsIG9mZnNldCArIDgpLCB1bnNpZ25lZCk7CiAgICAgIGlmIChsb25nMi5ncmVhdGVyVGhhbihOdW1iZXIuTUFYX1NBRkVfSU5URUdFUikgfHwgbG9uZzIubGVzc1RoYW4oTnVtYmVyLk1JTl9TQUZFX0lOVEVHRVIpKQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImludGVnZXIgb3ZlcmZsb3ciKTsKICAgICAgcmV0dXJuIGxvbmcyLnRvTnVtYmVyKCk7CiAgICB9IH0sIHsga2V5OiAiX2dldEluZGV4IiwgdmFsdWU6IGZ1bmN0aW9uIF9nZXRJbmRleCgpIHsKICAgICAgaWYgKCF0aGlzLmluZGV4KQogICAgICAgIHRoaXMuaW5kZXggPSB0aGlzLl9yZWFkSW5kZXgoKTsKICAgICAgcmV0dXJuIHRoaXMuaW5kZXg7CiAgICB9IH0sIHsKICAgICAga2V5OiAiX3JlYWRJbmRleCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX3JlYWRJbmRleDIgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyJDMuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvciQzLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgICAgdmFyIGJ1ZiwgbnVtRW50cmllcywgZW50cmllczIsIGJ1ZlNpemUsIGVudHJ5TnVtYmVyLCBjb21wcmVzc2VkUG9zaXRpb24sIHVuY29tcHJlc3NlZFBvc2l0aW9uOwogICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvciQzLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgYnVmID0gQnVmZmVyLmFsbG9jVW5zYWZlKDgpOwogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZWhhbmRsZS5yZWFkKGJ1ZiwgMCwgOCwgMCk7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgIG51bUVudHJpZXMgPSB0aGlzLl9yZWFkTG9uZ1dpdGhPdmVyZmxvdyhidWYsIDAsIHRydWUpOwogICAgICAgICAgICAgICAgICBpZiAobnVtRW50cmllcykgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIFtbMCwgMF1dKTsKICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICAgZW50cmllczIgPSBuZXcgQXJyYXkobnVtRW50cmllcyArIDEpOwogICAgICAgICAgICAgICAgICBlbnRyaWVzMlswXSA9IFswLCAwXTsKICAgICAgICAgICAgICAgICAgYnVmU2l6ZSA9IDggKiAyICogbnVtRW50cmllczsKICAgICAgICAgICAgICAgICAgaWYgKCEoYnVmU2l6ZSA+IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnRlZ2VyIG92ZXJmbG93Iik7CiAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICBidWYgPSBCdWZmZXIuYWxsb2NVbnNhZmUoYnVmU2l6ZSk7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNDsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZWhhbmRsZS5yZWFkKGJ1ZiwgMCwgYnVmU2l6ZSwgOCk7CiAgICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgICBmb3IgKGVudHJ5TnVtYmVyID0gMDsgZW50cnlOdW1iZXIgPCBudW1FbnRyaWVzOyBlbnRyeU51bWJlciArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgY29tcHJlc3NlZFBvc2l0aW9uID0gdGhpcy5fcmVhZExvbmdXaXRoT3ZlcmZsb3coYnVmLCBlbnRyeU51bWJlciAqIDE2KTsKICAgICAgICAgICAgICAgICAgICB1bmNvbXByZXNzZWRQb3NpdGlvbiA9IHRoaXMuX3JlYWRMb25nV2l0aE92ZXJmbG93KGJ1ZiwgZW50cnlOdW1iZXIgKiAxNiArIDgpOwogICAgICAgICAgICAgICAgICAgIGVudHJpZXMyW2VudHJ5TnVtYmVyICsgMV0gPSBbY29tcHJlc3NlZFBvc2l0aW9uLCB1bmNvbXByZXNzZWRQb3NpdGlvbl07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgZW50cmllczIpOwogICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgICB9KSk7CiAgICAgICAgZnVuY3Rpb24gX3JlYWRJbmRleCgpIHsKICAgICAgICAgIHJldHVybiBfcmVhZEluZGV4Mi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3JlYWRJbmRleDsKICAgICAgfSgpCiAgICB9LCB7CiAgICAgIGtleTogImdldExhc3RCbG9jayIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX2dldExhc3RCbG9jayA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIkMy5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yJDMuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgICAgdmFyIGVudHJpZXMyOwogICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvciQzLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldEluZGV4KCk7CiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgIGVudHJpZXMyID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICAgIGlmIChlbnRyaWVzMi5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHZvaWQgMCk7CiAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBlbnRyaWVzMltlbnRyaWVzMi5sZW5ndGggLSAxXSk7CiAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgICB9KSk7CiAgICAgICAgZnVuY3Rpb24gZ2V0TGFzdEJsb2NrKCkgewogICAgICAgICAgcmV0dXJuIF9nZXRMYXN0QmxvY2suYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGdldExhc3RCbG9jazsKICAgICAgfSgpCiAgICB9LCB7CiAgICAgIGtleTogImdldFJlbGV2YW50QmxvY2tzRm9yUmVhZCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX2dldFJlbGV2YW50QmxvY2tzRm9yUmVhZCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIkMy5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yJDMuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKGxlbmd0aCwgcG9zaXRpb24pIHsKICAgICAgICAgIHZhciBlbmRQb3NpdGlvbiwgZW50cmllczIsIHJlbGV2YW50LCBjb21wYXJlLCBsb3dlckJvdW5kLCB1cHBlckJvdW5kLCBzZWFyY2hQb3NpdGlvbiwgY29tcGFyaXNvbiwgaTI7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDMuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgZW5kUG9zaXRpb24gPSBwb3NpdGlvbiArIGxlbmd0aDsKICAgICAgICAgICAgICAgICAgaWYgKCEobGVuZ3RoID09PSAwKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgW10pOwogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRJbmRleCgpOwogICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICBlbnRyaWVzMiA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgICByZWxldmFudCA9IFtdOwogICAgICAgICAgICAgICAgICBjb21wYXJlID0gZnVuY3Rpb24gY29tcGFyZTIoZW50cnksIG5leHRFbnRyeSkgewogICAgICAgICAgICAgICAgICAgIHZhciB1bmNvbXByZXNzZWRQb3NpdGlvbiA9IGVudHJ5W1VOQ09NUFJFU1NFRF9QT1NJVElPTl07CiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHRVbmNvbXByZXNzZWRQb3NpdGlvbiA9IG5leHRFbnRyeSA/IG5leHRFbnRyeVtVTkNPTVBSRVNTRURfUE9TSVRJT05dIDogSW5maW5pdHk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVuY29tcHJlc3NlZFBvc2l0aW9uIDw9IHBvc2l0aW9uICYmIG5leHRVbmNvbXByZXNzZWRQb3NpdGlvbiA+IHBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVuY29tcHJlc3NlZFBvc2l0aW9uIDwgcG9zaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIGxvd2VyQm91bmQgPSAwOwogICAgICAgICAgICAgICAgICB1cHBlckJvdW5kID0gZW50cmllczIubGVuZ3RoIC0gMTsKICAgICAgICAgICAgICAgICAgc2VhcmNoUG9zaXRpb24gPSBNYXRoLmZsb29yKGVudHJpZXMyLmxlbmd0aCAvIDIpOwogICAgICAgICAgICAgICAgICBjb21wYXJpc29uID0gY29tcGFyZShlbnRyaWVzMltzZWFyY2hQb3NpdGlvbl0sIGVudHJpZXMyW3NlYXJjaFBvc2l0aW9uICsgMV0pOwogICAgICAgICAgICAgICAgICB3aGlsZSAoY29tcGFyaXNvbiAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmIChjb21wYXJpc29uID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgdXBwZXJCb3VuZCA9IHNlYXJjaFBvc2l0aW9uIC0gMTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbXBhcmlzb24gPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBsb3dlckJvdW5kID0gc2VhcmNoUG9zaXRpb24gKyAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzZWFyY2hQb3NpdGlvbiA9IE1hdGguY2VpbCgodXBwZXJCb3VuZCAtIGxvd2VyQm91bmQpIC8gMikgKyBsb3dlckJvdW5kOwogICAgICAgICAgICAgICAgICAgIGNvbXBhcmlzb24gPSBjb21wYXJlKGVudHJpZXMyW3NlYXJjaFBvc2l0aW9uXSwgZW50cmllczJbc2VhcmNoUG9zaXRpb24gKyAxXSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmVsZXZhbnQucHVzaChlbnRyaWVzMltzZWFyY2hQb3NpdGlvbl0pOwogICAgICAgICAgICAgICAgICBpMiA9IHNlYXJjaFBvc2l0aW9uICsgMTsKICAgICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICAgIGlmICghKGkyIDwgZW50cmllczIubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmVsZXZhbnQucHVzaChlbnRyaWVzMltpMl0pOwogICAgICAgICAgICAgICAgICBpZiAoIShlbnRyaWVzMltpMl1bVU5DT01QUkVTU0VEX1BPU0lUSU9OXSA+PSBlbmRQb3NpdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDE5OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJicmVhayIsIDIyKTsKICAgICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICAgIGkyICs9IDE7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgICAgaWYgKHJlbGV2YW50W3JlbGV2YW50Lmxlbmd0aCAtIDFdW1VOQ09NUFJFU1NFRF9QT1NJVElPTl0gPCBlbmRQb3NpdGlvbikgewogICAgICAgICAgICAgICAgICAgIHJlbGV2YW50LnB1c2goW10pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCByZWxldmFudCk7CiAgICAgICAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgICAgfSkpOwogICAgICAgIGZ1bmN0aW9uIGdldFJlbGV2YW50QmxvY2tzRm9yUmVhZChfeCwgX3gyKSB7CiAgICAgICAgICByZXR1cm4gX2dldFJlbGV2YW50QmxvY2tzRm9yUmVhZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZ2V0UmVsZXZhbnRCbG9ja3NGb3JSZWFkOwogICAgICB9KCkKICAgIH1dKTsKICAgIHJldHVybiBHemlJbmRleDI7CiAgfSgpOwogIHZhciBnemlJbmRleCA9IEd6aUluZGV4JDE7CiAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkMiA9IGludGVyb3BSZXF1aXJlRGVmYXVsdC5leHBvcnRzOwogIHZhciBfc2xpY2VkVG9BcnJheTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDIoc2xpY2VkVG9BcnJheS5leHBvcnRzKTsKICB2YXIgX3JlZ2VuZXJhdG9yJDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDIocmVnZW5lcmF0b3IpOwogIHZhciBfYXN5bmNUb0dlbmVyYXRvcjIkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkMihhc3luY1RvR2VuZXJhdG9yLmV4cG9ydHMpOwogIHZhciBfY2xhc3NDYWxsQ2hlY2syJDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDIoY2xhc3NDYWxsQ2hlY2suZXhwb3J0cyk7CiAgdmFyIF9jcmVhdGVDbGFzczIkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkMihjcmVhdGVDbGFzcy5leHBvcnRzKTsKICB2YXIgX3JlcXVpcmUkMSA9IHVuemlwUGFrbywgdW56aXAkMSA9IF9yZXF1aXJlJDEudW56aXA7CiAgdmFyIExvY2FsRmlsZSA9IGxvY2FsRmlsZTsKICB2YXIgR3ppSW5kZXggPSBnemlJbmRleDsKICB2YXIgQmd6RmlsZWhhbmRsZSA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIEJnekZpbGVoYW5kbGUyKF9yZWYpIHsKICAgICAgdmFyIGZpbGVoYW5kbGUyID0gX3JlZi5maWxlaGFuZGxlLCBwYXRoMiA9IF9yZWYucGF0aCwgZ3ppRmlsZWhhbmRsZSA9IF9yZWYuZ3ppRmlsZWhhbmRsZSwgZ3ppUGF0aCA9IF9yZWYuZ3ppUGF0aDsKICAgICAgKDAsIF9jbGFzc0NhbGxDaGVjazIkMi5kZWZhdWx0KSh0aGlzLCBCZ3pGaWxlaGFuZGxlMik7CiAgICAgIGlmIChmaWxlaGFuZGxlMikKICAgICAgICB0aGlzLmZpbGVoYW5kbGUgPSBmaWxlaGFuZGxlMjsKICAgICAgZWxzZSBpZiAocGF0aDIpCiAgICAgICAgdGhpcy5maWxlaGFuZGxlID0gbmV3IExvY2FsRmlsZShwYXRoMik7CiAgICAgIGVsc2UKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJlaXRoZXIgZmlsZWhhbmRsZSBvciBwYXRoIG11c3QgYmUgZGVmaW5lZCIpOwogICAgICBpZiAoIWd6aUZpbGVoYW5kbGUgJiYgIWd6aVBhdGggJiYgIXBhdGgyKQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImVpdGhlciBnemlGaWxlaGFuZGxlIG9yIGd6aVBhdGggbXVzdCBiZSBkZWZpbmVkIik7CiAgICAgIHRoaXMuZ3ppID0gbmV3IEd6aUluZGV4KHsKICAgICAgICBmaWxlaGFuZGxlOiBnemlGaWxlaGFuZGxlLAogICAgICAgIHBhdGg6ICFnemlGaWxlaGFuZGxlICYmICFnemlQYXRoICYmIHBhdGgyID8gZ3ppUGF0aCA6ICIiLmNvbmNhdChwYXRoMiwgIi5nemkiKQogICAgICB9KTsKICAgIH0KICAgICgwLCBfY3JlYXRlQ2xhc3MyJDIuZGVmYXVsdCkoQmd6RmlsZWhhbmRsZTIsIFt7IGtleTogInN0YXQiLCB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfc3RhdCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIkMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yJDIuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIGNvbXByZXNzZWRTdGF0OwogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IkMi5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGVoYW5kbGUuc3RhdCgpOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGNvbXByZXNzZWRTdGF0ID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gT2JqZWN0OwogICAgICAgICAgICAgICAgX2NvbnRleHQudDEgPSBjb21wcmVzc2VkU3RhdDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VW5jb21wcmVzc2VkRmlsZVNpemUoKTsKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBfY29udGV4dC50MiA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dC50MyA9IHZvaWQgMDsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQ0ID0gdm9pZCAwOwogICAgICAgICAgICAgICAgX2NvbnRleHQudDUgPSB7IHNpemU6IF9jb250ZXh0LnQyLCBibG9ja3M6IF9jb250ZXh0LnQzLCBibGtzaXplOiBfY29udGV4dC50NCB9OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQudDAuYXNzaWduLmNhbGwoX2NvbnRleHQudDAsIF9jb250ZXh0LnQxLCBfY29udGV4dC50NSkpOwogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgfSkpOwogICAgICBmdW5jdGlvbiBzdGF0KCkgewogICAgICAgIHJldHVybiBfc3RhdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CiAgICAgIHJldHVybiBzdGF0OwogICAgfSgpIH0sIHsga2V5OiAiZ2V0VW5jb21wcmVzc2VkRmlsZVNpemUiLCB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfZ2V0VW5jb21wcmVzc2VkRmlsZVNpemUgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyJDIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvciQyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgX3JlZjIsIF9yZWYzLCB1bmNvbXByZXNzZWRQb3NpdGlvbiwgX3JlZjQsIHNpemUsIGJ1ZiwgX3JlZjUsIGJ5dGVzUmVhZCwgbGFzdEJsb2NrVW5jb21wcmVzc2VkU2l6ZTsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDIuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmd6aS5nZXRMYXN0QmxvY2soKTsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBfcmVmMiA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgX3JlZjMgPSAoMCwgX3NsaWNlZFRvQXJyYXkyLmRlZmF1bHQpKF9yZWYyLCAyKTsKICAgICAgICAgICAgICAgIHVuY29tcHJlc3NlZFBvc2l0aW9uID0gX3JlZjNbMV07CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlaGFuZGxlLnN0YXQoKTsKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBfcmVmNCA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgc2l6ZSA9IF9yZWY0LnNpemU7CiAgICAgICAgICAgICAgICBidWYgPSBCdWZmZXIuYWxsb2NVbnNhZmUoNCk7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZWhhbmRsZS5yZWFkKGJ1ZiwgMCwgNCwgc2l6ZSAtIDI4IC0gNCk7CiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIF9yZWY1ID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICBieXRlc1JlYWQgPSBfcmVmNS5ieXRlc1JlYWQ7CiAgICAgICAgICAgICAgICBpZiAoIShieXRlc1JlYWQgIT09IDQpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJyZWFkIGVycm9yIik7CiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgIGxhc3RCbG9ja1VuY29tcHJlc3NlZFNpemUgPSBidWYucmVhZFVJbnQzMkxFKDApOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHVuY29tcHJlc3NlZFBvc2l0aW9uICsgbGFzdEJsb2NrVW5jb21wcmVzc2VkU2l6ZSk7CiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgIH0pKTsKICAgICAgZnVuY3Rpb24gZ2V0VW5jb21wcmVzc2VkRmlsZVNpemUoKSB7CiAgICAgICAgcmV0dXJuIF9nZXRVbmNvbXByZXNzZWRGaWxlU2l6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CiAgICAgIHJldHVybiBnZXRVbmNvbXByZXNzZWRGaWxlU2l6ZTsKICAgIH0oKSB9LCB7IGtleTogIl9yZWFkQW5kVW5jb21wcmVzc0Jsb2NrIiwgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgX3JlYWRBbmRVbmNvbXByZXNzQmxvY2syID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMiQyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IkMi5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoYmxvY2tCdWZmZXIsIF9yZWY2LCBfcmVmNykgewogICAgICAgIHZhciBfcmVmOCwgY29tcHJlc3NlZFBvc2l0aW9uLCBfcmVmOSwgbmV4dENvbXByZXNzZWRQb3NpdGlvbiwgbmV4dCwgYmxvY2tDb21wcmVzc2VkTGVuZ3RoLCB1bnppcHBlZEJ1ZmZlcjsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDIuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9yZWY4ID0gKDAsIF9zbGljZWRUb0FycmF5Mi5kZWZhdWx0KShfcmVmNiwgMSksIGNvbXByZXNzZWRQb3NpdGlvbiA9IF9yZWY4WzBdOwogICAgICAgICAgICAgICAgX3JlZjkgPSAoMCwgX3NsaWNlZFRvQXJyYXkyLmRlZmF1bHQpKF9yZWY3LCAxKSwgbmV4dENvbXByZXNzZWRQb3NpdGlvbiA9IF9yZWY5WzBdOwogICAgICAgICAgICAgICAgbmV4dCA9IG5leHRDb21wcmVzc2VkUG9zaXRpb247CiAgICAgICAgICAgICAgICBpZiAobmV4dCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA2OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZWhhbmRsZS5zdGF0KCk7CiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgbmV4dCA9IF9jb250ZXh0My5zZW50LnNpemU7CiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgYmxvY2tDb21wcmVzc2VkTGVuZ3RoID0gbmV4dCAtIGNvbXByZXNzZWRQb3NpdGlvbjsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlaGFuZGxlLnJlYWQoYmxvY2tCdWZmZXIsIDAsIGJsb2NrQ29tcHJlc3NlZExlbmd0aCwgY29tcHJlc3NlZFBvc2l0aW9uKTsKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxMjsKICAgICAgICAgICAgICAgIHJldHVybiB1bnppcCQxKGJsb2NrQnVmZmVyLnNsaWNlKDAsIGJsb2NrQ29tcHJlc3NlZExlbmd0aCkpOwogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICB1bnppcHBlZEJ1ZmZlciA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHVuemlwcGVkQnVmZmVyKTsKICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgfSkpOwogICAgICBmdW5jdGlvbiBfcmVhZEFuZFVuY29tcHJlc3NCbG9jayhfeCwgX3gyLCBfeDMpIHsKICAgICAgICByZXR1cm4gX3JlYWRBbmRVbmNvbXByZXNzQmxvY2syLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgcmV0dXJuIF9yZWFkQW5kVW5jb21wcmVzc0Jsb2NrOwogICAgfSgpIH0sIHsga2V5OiAicmVhZCIsIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9yZWFkID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMiQyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IkMi5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoYnVmLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pIHsKICAgICAgICB2YXIgYmxvY2tQb3NpdGlvbnMsIGJsb2NrQnVmZmVyLCBkZXN0aW5hdGlvbk9mZnNldCwgYnl0ZXNSZWFkLCBibG9ja051bSwgdW5jb21wcmVzc2VkQnVmZmVyLCBfYmxvY2tQb3NpdGlvbnMkYmxvY2ssIHVuY29tcHJlc3NlZFBvc2l0aW9uLCBzb3VyY2VPZmZzZXQsIHNvdXJjZUVuZDsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDIuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmd6aS5nZXRSZWxldmFudEJsb2Nrc0ZvclJlYWQobGVuZ3RoLCBwb3NpdGlvbik7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgYmxvY2tQb3NpdGlvbnMgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgIGJsb2NrQnVmZmVyID0gQnVmZmVyLmFsbG9jVW5zYWZlKDMyNzY4ICogMik7CiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbk9mZnNldCA9IG9mZnNldDsKICAgICAgICAgICAgICAgIGJ5dGVzUmVhZCA9IDA7CiAgICAgICAgICAgICAgICBibG9ja051bSA9IDA7CiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgaWYgKCEoYmxvY2tOdW0gPCBibG9ja1Bvc2l0aW9ucy5sZW5ndGggLSAxKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVhZEFuZFVuY29tcHJlc3NCbG9jayhibG9ja0J1ZmZlciwgYmxvY2tQb3NpdGlvbnNbYmxvY2tOdW1dLCBibG9ja1Bvc2l0aW9uc1tibG9ja051bSArIDFdKTsKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgdW5jb21wcmVzc2VkQnVmZmVyID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICBfYmxvY2tQb3NpdGlvbnMkYmxvY2sgPSAoMCwgX3NsaWNlZFRvQXJyYXkyLmRlZmF1bHQpKGJsb2NrUG9zaXRpb25zW2Jsb2NrTnVtXSwgMiksIHVuY29tcHJlc3NlZFBvc2l0aW9uID0gX2Jsb2NrUG9zaXRpb25zJGJsb2NrWzFdOwogICAgICAgICAgICAgICAgc291cmNlT2Zmc2V0ID0gdW5jb21wcmVzc2VkUG9zaXRpb24gPj0gcG9zaXRpb24gPyAwIDogcG9zaXRpb24gLSB1bmNvbXByZXNzZWRQb3NpdGlvbjsKICAgICAgICAgICAgICAgIHNvdXJjZUVuZCA9IE1hdGgubWluKHBvc2l0aW9uICsgbGVuZ3RoLCB1bmNvbXByZXNzZWRQb3NpdGlvbiArIHVuY29tcHJlc3NlZEJ1ZmZlci5sZW5ndGgpIC0gdW5jb21wcmVzc2VkUG9zaXRpb247CiAgICAgICAgICAgICAgICBpZiAoc291cmNlT2Zmc2V0ID49IDAgJiYgc291cmNlT2Zmc2V0IDwgdW5jb21wcmVzc2VkQnVmZmVyLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICB1bmNvbXByZXNzZWRCdWZmZXIuY29weShidWYsIGRlc3RpbmF0aW9uT2Zmc2V0LCBzb3VyY2VPZmZzZXQsIHNvdXJjZUVuZCk7CiAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uT2Zmc2V0ICs9IHNvdXJjZUVuZCAtIHNvdXJjZU9mZnNldDsKICAgICAgICAgICAgICAgICAgYnl0ZXNSZWFkICs9IHNvdXJjZUVuZCAtIHNvdXJjZU9mZnNldDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgYmxvY2tOdW0gKz0gMTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgeyBieXRlc1JlYWQsIGJ1ZmZlcjogYnVmIH0pOwogICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQsIHRoaXMpOwogICAgICB9KSk7CiAgICAgIGZ1bmN0aW9uIHJlYWQoX3g0LCBfeDUsIF94NiwgX3g3KSB7CiAgICAgICAgcmV0dXJuIF9yZWFkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlYWQ7CiAgICB9KCkgfV0pOwogICAgcmV0dXJuIEJnekZpbGVoYW5kbGUyOwogIH0oKTsKICB2YXIgYmd6RmlsZWhhbmRsZSA9IEJnekZpbGVoYW5kbGU7CiAgdmFyIEJnemZGaWxlaGFuZGxlID0gYmd6RmlsZWhhbmRsZTsKICB2YXIgX3JlcXVpcmUgPSB1bnppcFBha28sIHVuemlwID0gX3JlcXVpcmUudW56aXAsIHVuemlwQ2h1bmsgPSBfcmVxdWlyZS51bnppcENodW5rLCB1bnppcENodW5rU2xpY2UgPSBfcmVxdWlyZS51bnppcENodW5rU2xpY2U7CiAgdmFyIGRpc3QkMSA9IHsgQmd6ZkZpbGVoYW5kbGUsIHVuemlwLCB1bnppcENodW5rLCB1bnppcENodW5rU2xpY2UgfTsKICAoZnVuY3Rpb24oZXhwb3J0cykgewogICAgdmFyIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkID0gaW50ZXJvcFJlcXVpcmVXaWxkY2FyZC5leHBvcnRzOwogICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyID0gaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDEuZXhwb3J0czsKICAgIHZhciBfT2JqZWN0JGRlZmluZVByb3BlcnR5ID0gZGVmaW5lUHJvcGVydHkkOTsKICAgIF9PYmplY3QkZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDsKICAgIHZhciBfZ2V0SXRlcmF0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZ2V0SXRlcmF0b3IkMik7CiAgICB2YXIgX2lzQXJyYXkgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihpc0FycmF5JDYpOwogICAgdmFyIF9nZXRJdGVyYXRvck1ldGhvZDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihnZXRJdGVyYXRvck1ldGhvZCQyKTsKICAgIHZhciBfc3ltYm9sID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoc3ltYm9sJDIpOwogICAgdmFyIF9mcm9tID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZnJvbSQzKTsKICAgIHZhciBfY29uc3RydWN0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoY29uc3RydWN0KTsKICAgIHZhciBfY29uY2F0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoY29uY2F0KTsKICAgIHZhciBfc2xpY2VkVG9BcnJheTIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoc2xpY2VkVG9BcnJheSQxLmV4cG9ydHMpOwogICAgdmFyIF9zbGljZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHNsaWNlJDEpOwogICAgdmFyIF9hc3NpZ24gPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihhc3NpZ24kMSk7CiAgICB2YXIgX3JlZ2VuZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHJlZ2VuZXJhdG9yJDEpOwogICAgdmFyIF9hc3luY1RvR2VuZXJhdG9yMjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihhc3luY1RvR2VuZXJhdG9yJDEuZXhwb3J0cyk7CiAgICB2YXIgX2NsYXNzQ2FsbENoZWNrMjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihjbGFzc0NhbGxDaGVjayQxLmV4cG9ydHMpOwogICAgdmFyIF9jcmVhdGVDbGFzczIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoY3JlYXRlQ2xhc3MkMS5leHBvcnRzKTsKICAgIHZhciBfYXNzZXJ0VGhpc0luaXRpYWxpemVkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGFzc2VydFRoaXNJbml0aWFsaXplZC5leHBvcnRzKTsKICAgIHZhciBfaW5oZXJpdHMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoaW5oZXJpdHMuZXhwb3J0cyk7CiAgICB2YXIgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIocG9zc2libGVDb25zdHJ1Y3RvclJldHVybi5leHBvcnRzKTsKICAgIHZhciBfZ2V0UHJvdG90eXBlT2YyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZ2V0UHJvdG90eXBlT2YkNC5leHBvcnRzKTsKICAgIHZhciBfZGVmaW5lUHJvcGVydHkyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGRlZmluZVByb3BlcnR5JDYuZXhwb3J0cyk7CiAgICB2YXIgX2xvbmcgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihsb25nKTsKICAgIHZhciBfYmd6ZkZpbGVoYW5kbGUgPSBkaXN0JDE7CiAgICB2YXIgX3ZpcnR1YWxPZmZzZXQgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCh2aXJ0dWFsT2Zmc2V0KTsKICAgIHZhciBfY2h1bmsgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihjaHVuayk7CiAgICB2YXIgX3V0aWwgPSB1dGlsOwogICAgdmFyIF9pbmRleEZpbGUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihpbmRleEZpbGUpOwogICAgZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIobywgYWxsb3dBcnJheUxpa2UpIHsKICAgICAgdmFyIGl0OwogICAgICBpZiAodHlwZW9mIF9zeW1ib2wuZGVmYXVsdCA9PT0gInVuZGVmaW5lZCIgfHwgKDAsIF9nZXRJdGVyYXRvck1ldGhvZDIuZGVmYXVsdCkobykgPT0gbnVsbCkgewogICAgICAgIGlmICgoMCwgX2lzQXJyYXkuZGVmYXVsdCkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHsKICAgICAgICAgIGlmIChpdCkKICAgICAgICAgICAgbyA9IGl0OwogICAgICAgICAgdmFyIGkyID0gMDsKICAgICAgICAgIHZhciBGID0gZnVuY3Rpb24gRjIoKSB7CiAgICAgICAgICB9OwogICAgICAgICAgcmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHsKICAgICAgICAgICAgaWYgKGkyID49IG8ubGVuZ3RoKQogICAgICAgICAgICAgIHJldHVybiB7IGRvbmU6IHRydWUgfTsKICAgICAgICAgICAgcmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBvW2kyKytdIH07CiAgICAgICAgICB9LCBlOiBmdW5jdGlvbiBlKF9lKSB7CiAgICAgICAgICAgIHRocm93IF9lOwogICAgICAgICAgfSwgZjogRiB9OwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7CiAgICAgIH0KICAgICAgdmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLCBkaWRFcnIgPSBmYWxzZSwgZXJyMjsKICAgICAgcmV0dXJuIHsgczogZnVuY3Rpb24gcygpIHsKICAgICAgICBpdCA9ICgwLCBfZ2V0SXRlcmF0b3IyLmRlZmF1bHQpKG8pOwogICAgICB9LCBuOiBmdW5jdGlvbiBuKCkgewogICAgICAgIHZhciBzdGVwID0gaXQubmV4dCgpOwogICAgICAgIG5vcm1hbENvbXBsZXRpb24gPSBzdGVwLmRvbmU7CiAgICAgICAgcmV0dXJuIHN0ZXA7CiAgICAgIH0sIGU6IGZ1bmN0aW9uIGUoX2UyKSB7CiAgICAgICAgZGlkRXJyID0gdHJ1ZTsKICAgICAgICBlcnIyID0gX2UyOwogICAgICB9LCBmOiBmdW5jdGlvbiBmKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXQucmV0dXJuICE9IG51bGwpCiAgICAgICAgICAgIGl0LnJldHVybigpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBpZiAoZGlkRXJyKQogICAgICAgICAgICB0aHJvdyBlcnIyOwogICAgICAgIH0KICAgICAgfSB9OwogICAgfQogICAgZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikgewogICAgICB2YXIgX2NvbnRleHQ4OwogICAgICBpZiAoIW8pCiAgICAgICAgcmV0dXJuOwogICAgICBpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKQogICAgICAgIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOwogICAgICB2YXIgbiA9ICgwLCBfc2xpY2UuZGVmYXVsdCkoX2NvbnRleHQ4ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pKS5jYWxsKF9jb250ZXh0OCwgOCwgLTEpOwogICAgICBpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikKICAgICAgICBuID0gby5jb25zdHJ1Y3Rvci5uYW1lOwogICAgICBpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpCiAgICAgICAgcmV0dXJuICgwLCBfZnJvbS5kZWZhdWx0KShvKTsKICAgICAgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKQogICAgICAgIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOwogICAgfQogICAgZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4yKSB7CiAgICAgIGlmIChsZW4yID09IG51bGwgfHwgbGVuMiA+IGFyci5sZW5ndGgpCiAgICAgICAgbGVuMiA9IGFyci5sZW5ndGg7CiAgICAgIGZvciAodmFyIGkyID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4yKTsgaTIgPCBsZW4yOyBpMisrKSB7CiAgICAgICAgYXJyMltpMl0gPSBhcnJbaTJdOwogICAgICB9CiAgICAgIHJldHVybiBhcnIyOwogICAgfQogICAgZnVuY3Rpb24gX2NyZWF0ZVN1cGVyMihEZXJpdmVkKSB7CiAgICAgIHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdDIoKTsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9jcmVhdGVTdXBlckludGVybmFsKCkgewogICAgICAgIHZhciBTdXBlciA9ICgwLCBfZ2V0UHJvdG90eXBlT2YyLmRlZmF1bHQpKERlcml2ZWQpLCByZXN1bHQ7CiAgICAgICAgaWYgKGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QpIHsKICAgICAgICAgIHZhciBOZXdUYXJnZXQgPSAoMCwgX2dldFByb3RvdHlwZU9mMi5kZWZhdWx0KSh0aGlzKS5jb25zdHJ1Y3RvcjsKICAgICAgICAgIHJlc3VsdCA9ICgwLCBfY29uc3RydWN0LmRlZmF1bHQpKFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoMCwgX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4yLmRlZmF1bHQpKHRoaXMsIHJlc3VsdCk7CiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0MigpIHsKICAgICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSAidW5kZWZpbmVkIiB8fCAhX2NvbnN0cnVjdC5kZWZhdWx0KQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgaWYgKF9jb25zdHJ1Y3QuZGVmYXVsdC5zaGFtKQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgaWYgKHR5cGVvZiBQcm94eSA9PT0gImZ1bmN0aW9uIikKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgdHJ5IHsKICAgICAgICBEYXRlLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKCgwLCBfY29uc3RydWN0LmRlZmF1bHQpKERhdGUsIFtdLCBmdW5jdGlvbigpIHsKICAgICAgICB9KSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHZhciBDU0kxX01BR0lDID0gMjE1ODI2NTk7CiAgICB2YXIgQ1NJMl9NQUdJQyA9IDM4MzU5ODc1OwogICAgZnVuY3Rpb24gbHNoaWZ0KG51bSwgYml0cykgewogICAgICByZXR1cm4gbnVtICogTWF0aC5wb3coMiwgYml0cyk7CiAgICB9CiAgICBmdW5jdGlvbiByc2hpZnQobnVtLCBiaXRzKSB7CiAgICAgIHJldHVybiBNYXRoLmZsb29yKG51bSAvIE1hdGgucG93KDIsIGJpdHMpKTsKICAgIH0KICAgIHZhciBDU0kgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oX0luZGV4RmlsZSkgewogICAgICAoMCwgX2luaGVyaXRzMi5kZWZhdWx0KShDU0kyLCBfSW5kZXhGaWxlKTsKICAgICAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcjIoQ1NJMik7CiAgICAgIGZ1bmN0aW9uIENTSTIoYXJncykgewogICAgICAgIHZhciBfdGhpczsKICAgICAgICAoMCwgX2NsYXNzQ2FsbENoZWNrMjIuZGVmYXVsdCkodGhpcywgQ1NJMik7CiAgICAgICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBhcmdzKTsKICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5MjIuZGVmYXVsdCkoKDAsIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQyLmRlZmF1bHQpKF90aGlzKSwgIm1heEJpbk51bWJlciIsIHZvaWQgMCk7CiAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIyLmRlZmF1bHQpKCgwLCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkMi5kZWZhdWx0KShfdGhpcyksICJkZXB0aCIsIHZvaWQgMCk7CiAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIyLmRlZmF1bHQpKCgwLCBfYXNzZXJ0VGhpc0luaXRpYWxpemVkMi5kZWZhdWx0KShfdGhpcyksICJtaW5TaGlmdCIsIHZvaWQgMCk7CiAgICAgICAgX3RoaXMubWF4QmluTnVtYmVyID0gMDsKICAgICAgICBfdGhpcy5kZXB0aCA9IDA7CiAgICAgICAgX3RoaXMubWluU2hpZnQgPSAwOwogICAgICAgIHJldHVybiBfdGhpczsKICAgICAgfQogICAgICAoMCwgX2NyZWF0ZUNsYXNzMjIuZGVmYXVsdCkoQ1NJMiwgW3sKICAgICAgICBrZXk6ICJsaW5lQ291bnQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBfbGluZUNvdW50ID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUocmVmSWQpIHsKICAgICAgICAgICAgdmFyIGluZGV4RGF0YSwgaWR4LCBzdGF0czsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlKCk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICBpbmRleERhdGEgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgICAgIGlmIChpbmRleERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIC0xKTsKICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgIGlkeCA9IGluZGV4RGF0YS5pbmRpY2VzW3JlZklkXTsKICAgICAgICAgICAgICAgICAgICBpZiAoaWR4KSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCAtMSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICBzdGF0cyA9IGluZGV4RGF0YS5pbmRpY2VzW3JlZklkXS5zdGF0czsKICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YXRzKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgc3RhdHMubGluZUNvdW50KTsKICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCAtMSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gbGluZUNvdW50KF94KSB7CiAgICAgICAgICAgIHJldHVybiBfbGluZUNvdW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbGluZUNvdW50OwogICAgICAgIH0oKQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaW5kZXhDb3YiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBfaW5kZXhDb3YgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IyLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIFtdKTsKICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTIpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gaW5kZXhDb3YoKSB7CiAgICAgICAgICAgIHJldHVybiBfaW5kZXhDb3YuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBpbmRleENvdjsKICAgICAgICB9KCkKICAgICAgfSwgewogICAgICAgIGtleTogInBhcnNlQXV4RGF0YSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBhcnNlQXV4RGF0YShieXRlcywgb2Zmc2V0LCBhdXhMZW5ndGgpIHsKICAgICAgICAgIGlmIChhdXhMZW5ndGggPCAzMCkgewogICAgICAgICAgICByZXR1cm4ge307CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZGF0YTIgPSB7fTsKICAgICAgICAgIGRhdGEyLmZvcm1hdEZsYWdzID0gYnl0ZXMucmVhZEludDMyTEUob2Zmc2V0KTsKICAgICAgICAgIGRhdGEyLmNvb3JkaW5hdGVUeXBlID0gZGF0YTIuZm9ybWF0RmxhZ3MgJiA2NTUzNiA/ICJ6ZXJvLWJhc2VkLWhhbGYtb3BlbiIgOiAiMS1iYXNlZC1jbG9zZWQiOwogICAgICAgICAgZGF0YTIuZm9ybWF0ID0gewogICAgICAgICAgICAwOiAiZ2VuZXJpYyIsCiAgICAgICAgICAgIDE6ICJTQU0iLAogICAgICAgICAgICAyOiAiVkNGIgogICAgICAgICAgfVtkYXRhMi5mb3JtYXRGbGFncyAmIDE1XTsKICAgICAgICAgIGlmICghZGF0YTIuZm9ybWF0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBUYWJpeCBwcmVzZXQgZm9ybWF0IGZsYWdzICIuY29uY2F0KGRhdGEyLmZvcm1hdEZsYWdzKSk7CiAgICAgICAgICB9CiAgICAgICAgICBkYXRhMi5jb2x1bW5OdW1iZXJzID0gewogICAgICAgICAgICByZWY6IGJ5dGVzLnJlYWRJbnQzMkxFKG9mZnNldCArIDQpLAogICAgICAgICAgICBzdGFydDogYnl0ZXMucmVhZEludDMyTEUob2Zmc2V0ICsgOCksCiAgICAgICAgICAgIGVuZDogYnl0ZXMucmVhZEludDMyTEUob2Zmc2V0ICsgMTIpCiAgICAgICAgICB9OwogICAgICAgICAgZGF0YTIubWV0YVZhbHVlID0gYnl0ZXMucmVhZEludDMyTEUob2Zmc2V0ICsgMTYpOwogICAgICAgICAgZGF0YTIubWV0YUNoYXIgPSBkYXRhMi5tZXRhVmFsdWUgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKGRhdGEyLm1ldGFWYWx1ZSkgOiAiIjsKICAgICAgICAgIGRhdGEyLnNraXBMaW5lcyA9IGJ5dGVzLnJlYWRJbnQzMkxFKG9mZnNldCArIDIwKTsKICAgICAgICAgIHZhciBuYW1lU2VjdGlvbkxlbmd0aCA9IGJ5dGVzLnJlYWRJbnQzMkxFKG9mZnNldCArIDI0KTsKICAgICAgICAgICgwLCBfYXNzaWduLmRlZmF1bHQpKGRhdGEyLCB0aGlzLl9wYXJzZU5hbWVCeXRlcygoMCwgX3NsaWNlLmRlZmF1bHQpKGJ5dGVzKS5jYWxsKGJ5dGVzLCBvZmZzZXQgKyAyOCwgb2Zmc2V0ICsgMjggKyBuYW1lU2VjdGlvbkxlbmd0aCkpKTsKICAgICAgICAgIHJldHVybiBkYXRhMjsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfcGFyc2VOYW1lQnl0ZXMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcGFyc2VOYW1lQnl0ZXMobmFtZXNCeXRlcykgewogICAgICAgICAgdmFyIGN1cnJSZWZJZCA9IDA7CiAgICAgICAgICB2YXIgY3Vyck5hbWVTdGFydCA9IDA7CiAgICAgICAgICB2YXIgcmVmSWRUb05hbWUgPSBbXTsKICAgICAgICAgIHZhciByZWZOYW1lVG9JZCA9IHt9OwogICAgICAgICAgZm9yICh2YXIgaTIgPSAwOyBpMiA8IG5hbWVzQnl0ZXMubGVuZ3RoOyBpMiArPSAxKSB7CiAgICAgICAgICAgIGlmICghbmFtZXNCeXRlc1tpMl0pIHsKICAgICAgICAgICAgICBpZiAoY3Vyck5hbWVTdGFydCA8IGkyKSB7CiAgICAgICAgICAgICAgICB2YXIgcmVmTmFtZSA9IG5hbWVzQnl0ZXMudG9TdHJpbmcoInV0ZjgiLCBjdXJyTmFtZVN0YXJ0LCBpMik7CiAgICAgICAgICAgICAgICByZWZOYW1lID0gdGhpcy5yZW5hbWVSZWZTZXEocmVmTmFtZSk7CiAgICAgICAgICAgICAgICByZWZJZFRvTmFtZVtjdXJyUmVmSWRdID0gcmVmTmFtZTsKICAgICAgICAgICAgICAgIHJlZk5hbWVUb0lkW3JlZk5hbWVdID0gY3VyclJlZklkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjdXJyTmFtZVN0YXJ0ID0gaTIgKyAxOwogICAgICAgICAgICAgIGN1cnJSZWZJZCArPSAxOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICByZWZOYW1lVG9JZCwKICAgICAgICAgICAgcmVmSWRUb05hbWUKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX3BhcnNlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX3BhcnNlMiA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhvcHRzKSB7CiAgICAgICAgICAgIHZhciBkYXRhMiwgYnVmZmVyMiwgYnl0ZXMsIGF1eExlbmd0aCwgY3Vyck9mZnNldCwgaTIsIGJpbkNvdW50LCBiaW5JbmRleCwgc3RhdHMsIGosIGJpbiwgbG9mZnNldCwgY2h1bmtDb3VudCwgY2h1bmtzLCBrLCB1LCB2OwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIGRhdGEyID0gewogICAgICAgICAgICAgICAgICAgICAgY3NpOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgbWF4QmxvY2tTaXplOiAxIDw8IDE2CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZWhhbmRsZS5yZWFkRmlsZShvcHRzKTsKICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgIGJ1ZmZlcjIgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYmd6ZkZpbGVoYW5kbGUudW56aXApKGJ1ZmZlcjIpOwogICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgYnl0ZXMgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICAgICAgICBpZiAoIShieXRlcy5yZWFkVUludDMyTEUoMCkgPT09IENTSTFfTUFHSUMpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRhdGEyLmNzaVZlcnNpb24gPSAxOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoYnl0ZXMucmVhZFVJbnQzMkxFKDApID09PSBDU0kyX01BR0lDKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkYXRhMi5jc2lWZXJzaW9uID0gMjsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm90IGEgQ1NJIGZpbGUiKTsKICAgICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgICAgICB0aGlzLm1pblNoaWZ0ID0gYnl0ZXMucmVhZEludDMyTEUoNCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXB0aCA9IGJ5dGVzLnJlYWRJbnQzMkxFKDgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubWF4QmluTnVtYmVyID0gKCgxIDw8ICh0aGlzLmRlcHRoICsgMSkgKiAzKSAtIDEpIC8gNzsKICAgICAgICAgICAgICAgICAgICBhdXhMZW5ndGggPSBieXRlcy5yZWFkSW50MzJMRSgxMik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGF1eExlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgKDAsIF9hc3NpZ24uZGVmYXVsdCkoZGF0YTIsIHRoaXMucGFyc2VBdXhEYXRhKGJ5dGVzLCAxNiwgYXV4TGVuZ3RoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRhdGEyLnJlZkNvdW50ID0gYnl0ZXMucmVhZEludDMyTEUoMTYgKyBhdXhMZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIGRhdGEyLmluZGljZXMgPSBuZXcgQXJyYXkoZGF0YTIucmVmQ291bnQpOwogICAgICAgICAgICAgICAgICAgIGN1cnJPZmZzZXQgPSAxNiArIGF1eExlbmd0aCArIDQ7CiAgICAgICAgICAgICAgICAgICAgaTIgPSAwOwogICAgICAgICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgICAgICAgIGlmICghKGkyIDwgZGF0YTIucmVmQ291bnQpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDM3OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjg7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfdXRpbC5hYm9ydEJyZWFrUG9pbnQpKG9wdHMuc2lnbmFsKTsKICAgICAgICAgICAgICAgICAgY2FzZSAyODoKICAgICAgICAgICAgICAgICAgICBiaW5Db3VudCA9IGJ5dGVzLnJlYWRJbnQzMkxFKGN1cnJPZmZzZXQpOwogICAgICAgICAgICAgICAgICAgIGN1cnJPZmZzZXQgKz0gNDsKICAgICAgICAgICAgICAgICAgICBiaW5JbmRleCA9IHt9OwogICAgICAgICAgICAgICAgICAgIHN0YXRzID0gdm9pZCAwOwogICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBiaW5Db3VudDsgaiArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICBiaW4gPSBieXRlcy5yZWFkVUludDMyTEUoY3Vyck9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoYmluID4gdGhpcy5tYXhCaW5OdW1iZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHMgPSB0aGlzLnBhcnNlUHNldWRvQmluKGJ5dGVzLCBjdXJyT2Zmc2V0ICsgNCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJPZmZzZXQgKz0gNCArIDggKyA0ICsgMTYgKyAxNjsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZmZzZXQgPSAoMCwgX3ZpcnR1YWxPZmZzZXQuZnJvbUJ5dGVzKShieXRlcywgY3Vyck9mZnNldCArIDQpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9maW5kRmlyc3REYXRhKGRhdGEyLCBsb2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtDb3VudCA9IGJ5dGVzLnJlYWRJbnQzMkxFKGN1cnJPZmZzZXQgKyAxMik7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJPZmZzZXQgKz0gMTY7CiAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rcyA9IG5ldyBBcnJheShjaHVua0NvdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGNodW5rQ291bnQ7IGsgKz0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHUgPSAoMCwgX3ZpcnR1YWxPZmZzZXQuZnJvbUJ5dGVzKShieXRlcywgY3Vyck9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdiA9ICgwLCBfdmlydHVhbE9mZnNldC5mcm9tQnl0ZXMpKGJ5dGVzLCBjdXJyT2Zmc2V0ICsgOCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY3Vyck9mZnNldCArPSAxNjsKICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVua3Nba10gPSBuZXcgX2NodW5rLmRlZmF1bHQodSwgdiwgYmluKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBiaW5JbmRleFtiaW5dID0gY2h1bmtzOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkYXRhMi5pbmRpY2VzW2kyXSA9IHsKICAgICAgICAgICAgICAgICAgICAgIGJpbkluZGV4LAogICAgICAgICAgICAgICAgICAgICAgc3RhdHMKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICBjYXNlIDM0OgogICAgICAgICAgICAgICAgICAgIGkyICs9IDE7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyNTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAzNzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgZGF0YTIpOwogICAgICAgICAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gX3BhcnNlKF94MikgewogICAgICAgICAgICByZXR1cm4gX3BhcnNlMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIF9wYXJzZTsKICAgICAgICB9KCkKICAgICAgfSwgewogICAgICAgIGtleTogInBhcnNlUHNldWRvQmluIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcGFyc2VQc2V1ZG9CaW4oYnl0ZXMsIG9mZnNldCkgewogICAgICAgICAgdmFyIGxpbmVDb3VudCA9ICgwLCBfdXRpbC5sb25nVG9OdW1iZXIpKF9sb25nLmRlZmF1bHQuZnJvbUJ5dGVzTEUoKDAsIF9zbGljZS5kZWZhdWx0KShBcnJheS5wcm90b3R5cGUpLmNhbGwoYnl0ZXMsIG9mZnNldCArIDI4LCBvZmZzZXQgKyAzNiksIHRydWUpKTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxpbmVDb3VudAogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJibG9ja3NGb3JSYW5nZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF9ibG9ja3NGb3JSYW5nZSA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlNChyZWZJZCwgbWluMiwgbWF4MikgewogICAgICAgICAgICB2YXIgb3B0cywgaW5kZXhEYXRhLCBiYSwgb3ZlcmxhcHBpbmdCaW5zLCBjaHVua3MsIF9pdGVyYXRvciwgX3N0ZXAsIF9zdGVwJHZhbHVlLCBzdGFydCwgZW5kLCBiaW4sIGJpbkNodW5rcywgYzIsIF9hcmdzNCA9IGFyZ3VtZW50czsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBvcHRzID0gX2FyZ3M0Lmxlbmd0aCA+IDMgJiYgX2FyZ3M0WzNdICE9PSB2b2lkIDAgPyBfYXJnczRbM10gOiB7fTsKICAgICAgICAgICAgICAgICAgICBpZiAobWluMiA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgIG1pbjIgPSAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2Uob3B0cyk7CiAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICBpbmRleERhdGEgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXhEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIFtdKTsKICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgIGJhID0gaW5kZXhEYXRhLmluZGljZXNbcmVmSWRdOwogICAgICAgICAgICAgICAgICAgIGlmIChiYSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMDsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgW10pOwogICAgICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgICAgIG92ZXJsYXBwaW5nQmlucyA9IHRoaXMucmVnMmJpbnMobWluMiwgbWF4Mik7CiAgICAgICAgICAgICAgICAgICAgY2h1bmtzID0gW107CiAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIob3ZlcmxhcHBpbmdCaW5zKTsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTsgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9zdGVwJHZhbHVlID0gKDAsIF9zbGljZWRUb0FycmF5MjIuZGVmYXVsdCkoX3N0ZXAudmFsdWUsIDIpLCBzdGFydCA9IF9zdGVwJHZhbHVlWzBdLCBlbmQgPSBfc3RlcCR2YWx1ZVsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChiaW4gPSBzdGFydDsgYmluIDw9IGVuZDsgYmluKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmEuYmluSW5kZXhbYmluXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmluQ2h1bmtzID0gYmEuYmluSW5kZXhbYmluXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYzIgPSAwOyBjMiA8IGJpbkNodW5rcy5sZW5ndGg7ICsrYzIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bmtzLnB1c2gobmV3IF9jaHVuay5kZWZhdWx0KGJpbkNodW5rc1tjMl0ubWludiwgYmluQ2h1bmtzW2MyXS5tYXh2LCBiaW4pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIyKSB7CiAgICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3IuZShlcnIyKTsKICAgICAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsICgwLCBfdXRpbC5vcHRpbWl6ZUNodW5rcykoY2h1bmtzLCBuZXcgX3ZpcnR1YWxPZmZzZXQuZGVmYXVsdCgwLCAwKSkpOwogICAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTQsIHRoaXMpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gYmxvY2tzRm9yUmFuZ2UoX3gzLCBfeDQsIF94NSkgewogICAgICAgICAgICByZXR1cm4gX2Jsb2Nrc0ZvclJhbmdlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYmxvY2tzRm9yUmFuZ2U7CiAgICAgICAgfSgpCiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJyZWcyYmlucyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlZzJiaW5zKGJlZywgZW5kKSB7CiAgICAgICAgICBiZWcgLT0gMTsKICAgICAgICAgIGlmIChiZWcgPCAxKSB7CiAgICAgICAgICAgIGJlZyA9IDE7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZW5kID4gTWF0aC5wb3coMiwgNTApKSB7CiAgICAgICAgICAgIGVuZCA9IE1hdGgucG93KDIsIDM0KTsKICAgICAgICAgIH0KICAgICAgICAgIGVuZCAtPSAxOwogICAgICAgICAgdmFyIGwgPSAwOwogICAgICAgICAgdmFyIHQgPSAwOwogICAgICAgICAgdmFyIHMgPSB0aGlzLm1pblNoaWZ0ICsgdGhpcy5kZXB0aCAqIDM7CiAgICAgICAgICB2YXIgYmlucyA9IFtdOwogICAgICAgICAgZm9yICg7IGwgPD0gdGhpcy5kZXB0aDsgcyAtPSAzLCB0ICs9IGxzaGlmdCgxLCBsICogMyksIGwgKz0gMSkgewogICAgICAgICAgICB2YXIgYiA9IHQgKyByc2hpZnQoYmVnLCBzKTsKICAgICAgICAgICAgdmFyIGUgPSB0ICsgcnNoaWZ0KGVuZCwgcyk7CiAgICAgICAgICAgIGlmIChlIC0gYiArIGJpbnMubGVuZ3RoID4gdGhpcy5tYXhCaW5OdW1iZXIpIHsKICAgICAgICAgICAgICB2YXIgX2NvbnRleHQ1LCBfY29udGV4dDYsIF9jb250ZXh0NzsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKDAsIF9jb25jYXQuZGVmYXVsdCkoX2NvbnRleHQ1ID0gKDAsIF9jb25jYXQuZGVmYXVsdCkoX2NvbnRleHQ2ID0gKDAsIF9jb25jYXQuZGVmYXVsdCkoX2NvbnRleHQ3ID0gInF1ZXJ5ICIuY29uY2F0KGJlZywgIi0iKSkuY2FsbChfY29udGV4dDcsIGVuZCwgIiBpcyB0b28gbGFyZ2UgZm9yIGN1cnJlbnQgYmlubmluZyBzY2hlbWUgKHNoaWZ0ICIpKS5jYWxsKF9jb250ZXh0NiwgdGhpcy5taW5TaGlmdCwgIiwgZGVwdGggIikpLmNhbGwoX2NvbnRleHQ1LCB0aGlzLmRlcHRoLCAiKSwgdHJ5IGEgc21hbGxlciBxdWVyeSBvciBhIGNvYXJzZXIgaW5kZXggYmlubmluZyBzY2hlbWUiKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYmlucy5wdXNoKFtiLCBlXSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYmluczsKICAgICAgICB9CiAgICAgIH1dKTsKICAgICAgcmV0dXJuIENTSTI7CiAgICB9KF9pbmRleEZpbGUuZGVmYXVsdCk7CiAgICBleHBvcnRzLmRlZmF1bHQgPSBDU0k7CiAgfSkoY3NpKTsKICB2YXIgYmFtRmlsZSA9IHt9OwogIHZhciAkJDUgPSBfZXhwb3J0OwogICQkNSh7IHRhcmdldDogIkRhdGUiLCBzdGF0OiB0cnVlIH0sIHsKICAgIG5vdzogZnVuY3Rpb24gbm93MigpIHsKICAgICAgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgfQogIH0pOwogIHZhciBwYXRoJDEgPSBwYXRoJG47CiAgdmFyIG5vdyQyID0gcGF0aCQxLkRhdGUubm93OwogIHZhciBwYXJlbnQkYiA9IG5vdyQyOwogIHZhciBub3ckMSA9IHBhcmVudCRiOwogIHZhciBub3cgPSBub3ckMTsKICB2YXIgYUNhbGxhYmxlID0gYUNhbGxhYmxlJGM7CiAgdmFyIHRvT2JqZWN0ID0gdG9PYmplY3QkYjsKICB2YXIgSW5kZXhlZE9iamVjdCA9IGluZGV4ZWRPYmplY3Q7CiAgdmFyIHRvTGVuZ3RoJDEgPSB0b0xlbmd0aCQ5OwogIHZhciBjcmVhdGVNZXRob2QkMSA9IGZ1bmN0aW9uKElTX1JJR0hUKSB7CiAgICByZXR1cm4gZnVuY3Rpb24odGhhdCwgY2FsbGJhY2tmbiwgYXJndW1lbnRzTGVuZ3RoLCBtZW1vKSB7CiAgICAgIGFDYWxsYWJsZShjYWxsYmFja2ZuKTsKICAgICAgdmFyIE8gPSB0b09iamVjdCh0aGF0KTsKICAgICAgdmFyIHNlbGYyID0gSW5kZXhlZE9iamVjdChPKTsKICAgICAgdmFyIGxlbmd0aCA9IHRvTGVuZ3RoJDEoTy5sZW5ndGgpOwogICAgICB2YXIgaW5kZXggPSBJU19SSUdIVCA/IGxlbmd0aCAtIDEgOiAwOwogICAgICB2YXIgaTIgPSBJU19SSUdIVCA/IC0xIDogMTsKICAgICAgaWYgKGFyZ3VtZW50c0xlbmd0aCA8IDIpCiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgIGlmIChpbmRleCBpbiBzZWxmMikgewogICAgICAgICAgICBtZW1vID0gc2VsZjJbaW5kZXhdOwogICAgICAgICAgICBpbmRleCArPSBpMjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBpbmRleCArPSBpMjsKICAgICAgICAgIGlmIChJU19SSUdIVCA/IGluZGV4IDwgMCA6IGxlbmd0aCA8PSBpbmRleCkgewogICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoIlJlZHVjZSBvZiBlbXB0eSBhcnJheSB3aXRoIG5vIGluaXRpYWwgdmFsdWUiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIGZvciAoOyBJU19SSUdIVCA/IGluZGV4ID49IDAgOiBsZW5ndGggPiBpbmRleDsgaW5kZXggKz0gaTIpCiAgICAgICAgaWYgKGluZGV4IGluIHNlbGYyKSB7CiAgICAgICAgICBtZW1vID0gY2FsbGJhY2tmbihtZW1vLCBzZWxmMltpbmRleF0sIGluZGV4LCBPKTsKICAgICAgICB9CiAgICAgIHJldHVybiBtZW1vOwogICAgfTsKICB9OwogIHZhciBhcnJheVJlZHVjZSA9IHsKICAgIGxlZnQ6IGNyZWF0ZU1ldGhvZCQxKGZhbHNlKSwKICAgIHJpZ2h0OiBjcmVhdGVNZXRob2QkMSh0cnVlKQogIH07CiAgdmFyICQkNCA9IF9leHBvcnQ7CiAgdmFyICRyZWR1Y2UgPSBhcnJheVJlZHVjZS5sZWZ0OwogIHZhciBhcnJheU1ldGhvZElzU3RyaWN0JDEgPSBhcnJheU1ldGhvZElzU3RyaWN0JDQ7CiAgdmFyIENIUk9NRV9WRVJTSU9OID0gZW5naW5lVjhWZXJzaW9uOwogIHZhciBJU19OT0RFID0gZW5naW5lSXNOb2RlOwogIHZhciBTVFJJQ1RfTUVUSE9EJDEgPSBhcnJheU1ldGhvZElzU3RyaWN0JDEoInJlZHVjZSIpOwogIHZhciBDSFJPTUVfQlVHID0gIUlTX05PREUgJiYgQ0hST01FX1ZFUlNJT04gPiA3OSAmJiBDSFJPTUVfVkVSU0lPTiA8IDgzOwogICQkNCh7IHRhcmdldDogIkFycmF5IiwgcHJvdG86IHRydWUsIGZvcmNlZDogIVNUUklDVF9NRVRIT0QkMSB8fCBDSFJPTUVfQlVHIH0sIHsKICAgIHJlZHVjZTogZnVuY3Rpb24gcmVkdWNlMihjYWxsYmFja2ZuKSB7CiAgICAgIHJldHVybiAkcmVkdWNlKHRoaXMsIGNhbGxiYWNrZm4sIGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdm9pZCAwKTsKICAgIH0KICB9KTsKICB2YXIgZW50cnlWaXJ0dWFsJDMgPSBlbnRyeVZpcnR1YWwkYTsKICB2YXIgcmVkdWNlJDMgPSBlbnRyeVZpcnR1YWwkMygiQXJyYXkiKS5yZWR1Y2U7CiAgdmFyIHJlZHVjZSQyID0gcmVkdWNlJDM7CiAgdmFyIEFycmF5UHJvdG90eXBlJDEgPSBBcnJheS5wcm90b3R5cGU7CiAgdmFyIHJlZHVjZV8xID0gZnVuY3Rpb24oaXQpIHsKICAgIHZhciBvd24gPSBpdC5yZWR1Y2U7CiAgICByZXR1cm4gaXQgPT09IEFycmF5UHJvdG90eXBlJDEgfHwgaXQgaW5zdGFuY2VvZiBBcnJheSAmJiBvd24gPT09IEFycmF5UHJvdG90eXBlJDEucmVkdWNlID8gcmVkdWNlJDIgOiBvd247CiAgfTsKICB2YXIgcGFyZW50JGEgPSByZWR1Y2VfMTsKICB2YXIgcmVkdWNlJDEgPSBwYXJlbnQkYTsKICB2YXIgcmVkdWNlID0gcmVkdWNlJDE7CiAgdmFyICQkMyA9IF9leHBvcnQ7CiAgdmFyIGJpbmQkNCA9IGZ1bmN0aW9uQmluZDsKICAkJDMoeyB0YXJnZXQ6ICJGdW5jdGlvbiIsIHByb3RvOiB0cnVlIH0sIHsKICAgIGJpbmQ6IGJpbmQkNAogIH0pOwogIHZhciBlbnRyeVZpcnR1YWwkMiA9IGVudHJ5VmlydHVhbCRhOwogIHZhciBiaW5kJDMgPSBlbnRyeVZpcnR1YWwkMigiRnVuY3Rpb24iKS5iaW5kOwogIHZhciBiaW5kJDIgPSBiaW5kJDM7CiAgdmFyIEZ1bmN0aW9uUHJvdG90eXBlID0gRnVuY3Rpb24ucHJvdG90eXBlOwogIHZhciBiaW5kXzEgPSBmdW5jdGlvbihpdCkgewogICAgdmFyIG93biA9IGl0LmJpbmQ7CiAgICByZXR1cm4gaXQgPT09IEZ1bmN0aW9uUHJvdG90eXBlIHx8IGl0IGluc3RhbmNlb2YgRnVuY3Rpb24gJiYgb3duID09PSBGdW5jdGlvblByb3RvdHlwZS5iaW5kID8gYmluZCQyIDogb3duOwogIH07CiAgdmFyIHBhcmVudCQ5ID0gYmluZF8xOwogIHZhciBiaW5kJDEgPSBwYXJlbnQkOTsKICB2YXIgYmluZCA9IGJpbmQkMTsKICB2YXIgd3JhcEFzeW5jR2VuZXJhdG9yID0geyBleHBvcnRzOiB7fSB9OwogIHZhciBBc3luY0dlbmVyYXRvciA9IHsgZXhwb3J0czoge30gfTsKICB2YXIgV3JhcHBlZFdlbGxLbm93blN5bWJvbE1vZHVsZSA9IHdlbGxLbm93blN5bWJvbFdyYXBwZWQ7CiAgdmFyIGFzeW5jSXRlcmF0b3IkNCA9IFdyYXBwZWRXZWxsS25vd25TeW1ib2xNb2R1bGUuZigiYXN5bmNJdGVyYXRvciIpOwogIHZhciBwYXJlbnQkOCA9IGFzeW5jSXRlcmF0b3IkNDsKICB2YXIgYXN5bmNJdGVyYXRvciQzID0gcGFyZW50JDg7CiAgdmFyIHBhcmVudCQ3ID0gYXN5bmNJdGVyYXRvciQzOwogIHZhciBhc3luY0l0ZXJhdG9yJDIgPSBwYXJlbnQkNzsKICB2YXIgYXN5bmNJdGVyYXRvciQxID0gYXN5bmNJdGVyYXRvciQyOwogIHZhciBBd2FpdFZhbHVlID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUpIHsKICAgIGZ1bmN0aW9uIF9Bd2FpdFZhbHVlKHZhbHVlKSB7CiAgICAgIHRoaXMud3JhcHBlZCA9IHZhbHVlOwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBfQXdhaXRWYWx1ZTsKICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSkoQXdhaXRWYWx1ZSk7CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgdmFyIF9Qcm9taXNlID0gcHJvbWlzZSQxOwogICAgdmFyIF9TeW1ib2wgPSBzeW1ib2w7CiAgICB2YXIgX1N5bWJvbCRhc3luY0l0ZXJhdG9yID0gYXN5bmNJdGVyYXRvciQxOwogICAgdmFyIEF3YWl0VmFsdWUkMSA9IEF3YWl0VmFsdWUuZXhwb3J0czsKICAgIGZ1bmN0aW9uIEFzeW5jR2VuZXJhdG9yMihnZW4pIHsKICAgICAgdmFyIGZyb250LCBiYWNrOwogICAgICBmdW5jdGlvbiBzZW5kKGtleSwgYXJnKSB7CiAgICAgICAgcmV0dXJuIG5ldyBfUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIHZhciByZXF1ZXN0ID0gewogICAgICAgICAgICBrZXksCiAgICAgICAgICAgIGFyZywKICAgICAgICAgICAgcmVzb2x2ZSwKICAgICAgICAgICAgcmVqZWN0LAogICAgICAgICAgICBuZXh0OiBudWxsCiAgICAgICAgICB9OwogICAgICAgICAgaWYgKGJhY2spIHsKICAgICAgICAgICAgYmFjayA9IGJhY2submV4dCA9IHJlcXVlc3Q7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmcm9udCA9IGJhY2sgPSByZXF1ZXN0OwogICAgICAgICAgICByZXN1bWUoa2V5LCBhcmcpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHJlc3VtZShrZXksIGFyZykgewogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gZ2VuW2tleV0oYXJnKTsKICAgICAgICAgIHZhciB2YWx1ZSA9IHJlc3VsdC52YWx1ZTsKICAgICAgICAgIHZhciB3cmFwcGVkQXdhaXQgPSB2YWx1ZSBpbnN0YW5jZW9mIEF3YWl0VmFsdWUkMTsKICAgICAgICAgIF9Qcm9taXNlLnJlc29sdmUod3JhcHBlZEF3YWl0ID8gdmFsdWUud3JhcHBlZCA6IHZhbHVlKS50aGVuKGZ1bmN0aW9uKGFyZzIpIHsKICAgICAgICAgICAgaWYgKHdyYXBwZWRBd2FpdCkgewogICAgICAgICAgICAgIHJlc3VtZShrZXkgPT09ICJyZXR1cm4iID8gInJldHVybiIgOiAibmV4dCIsIGFyZzIpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXR0bGUocmVzdWx0LmRvbmUgPyAicmV0dXJuIiA6ICJub3JtYWwiLCBhcmcyKTsKICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycjIpIHsKICAgICAgICAgICAgcmVzdW1lKCJ0aHJvdyIsIGVycjIpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaCAoZXJyMikgewogICAgICAgICAgc2V0dGxlKCJ0aHJvdyIsIGVycjIpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBzZXR0bGUodHlwZSwgdmFsdWUpIHsKICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgIGNhc2UgInJldHVybiI6CiAgICAgICAgICAgIGZyb250LnJlc29sdmUoewogICAgICAgICAgICAgIHZhbHVlLAogICAgICAgICAgICAgIGRvbmU6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAidGhyb3ciOgogICAgICAgICAgICBmcm9udC5yZWplY3QodmFsdWUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGZyb250LnJlc29sdmUoewogICAgICAgICAgICAgIHZhbHVlLAogICAgICAgICAgICAgIGRvbmU6IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgZnJvbnQgPSBmcm9udC5uZXh0OwogICAgICAgIGlmIChmcm9udCkgewogICAgICAgICAgcmVzdW1lKGZyb250LmtleSwgZnJvbnQuYXJnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYmFjayA9IG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuX2ludm9rZSA9IHNlbmQ7CiAgICAgIGlmICh0eXBlb2YgZ2VuWyJyZXR1cm4iXSAhPT0gImZ1bmN0aW9uIikgewogICAgICAgIHRoaXNbInJldHVybiJdID0gdm9pZCAwOwogICAgICB9CiAgICB9CiAgICBBc3luY0dlbmVyYXRvcjIucHJvdG90eXBlW3R5cGVvZiBfU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIF9TeW1ib2wkYXN5bmNJdGVyYXRvciB8fCAiQEBhc3luY0l0ZXJhdG9yIl0gPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgQXN5bmNHZW5lcmF0b3IyLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24oYXJnKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnZva2UoIm5leHQiLCBhcmcpOwogICAgfTsKICAgIEFzeW5jR2VuZXJhdG9yMi5wcm90b3R5cGVbInRocm93Il0gPSBmdW5jdGlvbihhcmcpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludm9rZSgidGhyb3ciLCBhcmcpOwogICAgfTsKICAgIEFzeW5jR2VuZXJhdG9yMi5wcm90b3R5cGVbInJldHVybiJdID0gZnVuY3Rpb24oYXJnKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnZva2UoInJldHVybiIsIGFyZyk7CiAgICB9OwogICAgbW9kdWxlLmV4cG9ydHMgPSBBc3luY0dlbmVyYXRvcjI7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKEFzeW5jR2VuZXJhdG9yKTsKICAoZnVuY3Rpb24obW9kdWxlKSB7CiAgICB2YXIgQXN5bmNHZW5lcmF0b3IkMSA9IEFzeW5jR2VuZXJhdG9yLmV4cG9ydHM7CiAgICBmdW5jdGlvbiBfd3JhcEFzeW5jR2VuZXJhdG9yKGZuKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IEFzeW5jR2VuZXJhdG9yJDEoZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICAgIH07CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF93cmFwQXN5bmNHZW5lcmF0b3I7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKHdyYXBBc3luY0dlbmVyYXRvcik7CiAgdmFyIGF3YWl0QXN5bmNHZW5lcmF0b3IgPSB7IGV4cG9ydHM6IHt9IH07CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgdmFyIEF3YWl0VmFsdWUkMSA9IEF3YWl0VmFsdWUuZXhwb3J0czsKICAgIGZ1bmN0aW9uIF9hd2FpdEFzeW5jR2VuZXJhdG9yKHZhbHVlKSB7CiAgICAgIHJldHVybiBuZXcgQXdhaXRWYWx1ZSQxKHZhbHVlKTsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gX2F3YWl0QXN5bmNHZW5lcmF0b3I7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKGF3YWl0QXN5bmNHZW5lcmF0b3IpOwogIHZhciBhc3luY0dlbmVyYXRvckRlbGVnYXRlID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUpIHsKICAgIHZhciBfUHJvbWlzZSA9IHByb21pc2UkMTsKICAgIHZhciBfU3ltYm9sID0gc3ltYm9sOwogICAgdmFyIF9TeW1ib2wkaXRlcmF0b3IgPSBpdGVyYXRvcjsKICAgIGZ1bmN0aW9uIF9hc3luY0dlbmVyYXRvckRlbGVnYXRlKGlubmVyLCBhd2FpdFdyYXApIHsKICAgICAgdmFyIGl0ZXIgPSB7fSwgd2FpdGluZyA9IGZhbHNlOwogICAgICBmdW5jdGlvbiBwdW1wKGtleSwgdmFsdWUpIHsKICAgICAgICB3YWl0aW5nID0gdHJ1ZTsKICAgICAgICB2YWx1ZSA9IG5ldyBfUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7CiAgICAgICAgICByZXNvbHZlKGlubmVyW2tleV0odmFsdWUpKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZG9uZTogZmFsc2UsCiAgICAgICAgICB2YWx1ZTogYXdhaXRXcmFwKHZhbHVlKQogICAgICAgIH07CiAgICAgIH0KICAgICAgaXRlclt0eXBlb2YgX1N5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgX1N5bWJvbCRpdGVyYXRvciB8fCAiQEBpdGVyYXRvciJdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIGl0ZXIubmV4dCA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgaWYgKHdhaXRpbmcpIHsKICAgICAgICAgIHdhaXRpbmcgPSBmYWxzZTsKICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHB1bXAoIm5leHQiLCB2YWx1ZSk7CiAgICAgIH07CiAgICAgIGlmICh0eXBlb2YgaW5uZXJbInRocm93Il0gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICBpdGVyWyJ0aHJvdyJdID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgIGlmICh3YWl0aW5nKSB7CiAgICAgICAgICAgIHdhaXRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhyb3cgdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcHVtcCgidGhyb3ciLCB2YWx1ZSk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBpZiAodHlwZW9mIGlubmVyWyJyZXR1cm4iXSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIGl0ZXJbInJldHVybiJdID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgIGlmICh3YWl0aW5nKSB7CiAgICAgICAgICAgIHdhaXRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHB1bXAoInJldHVybiIsIHZhbHVlKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIHJldHVybiBpdGVyOwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBfYXN5bmNHZW5lcmF0b3JEZWxlZ2F0ZTsKICAgIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSkoYXN5bmNHZW5lcmF0b3JEZWxlZ2F0ZSk7CiAgdmFyIGFzeW5jSXRlcmF0b3IgPSB7IGV4cG9ydHM6IHt9IH07CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgdmFyIF9TeW1ib2wgPSBzeW1ib2w7CiAgICB2YXIgX1N5bWJvbCRhc3luY0l0ZXJhdG9yID0gYXN5bmNJdGVyYXRvciQxOwogICAgdmFyIF9TeW1ib2wkaXRlcmF0b3IgPSBpdGVyYXRvcjsKICAgIHZhciBfZ2V0SXRlcmF0b3JNZXRob2QgPSBnZXRJdGVyYXRvck1ldGhvZCQyOwogICAgZnVuY3Rpb24gX2FzeW5jSXRlcmF0b3IoaXRlcmFibGUpIHsKICAgICAgdmFyIG1ldGhvZDsKICAgICAgaWYgKHR5cGVvZiBfU3ltYm9sICE9PSAidW5kZWZpbmVkIikgewogICAgICAgIGlmIChfU3ltYm9sJGFzeW5jSXRlcmF0b3IpCiAgICAgICAgICBtZXRob2QgPSBpdGVyYWJsZVtfU3ltYm9sJGFzeW5jSXRlcmF0b3JdOwogICAgICAgIGlmIChtZXRob2QgPT0gbnVsbCAmJiBfU3ltYm9sJGl0ZXJhdG9yKQogICAgICAgICAgbWV0aG9kID0gX2dldEl0ZXJhdG9yTWV0aG9kKGl0ZXJhYmxlKTsKICAgICAgfQogICAgICBpZiAobWV0aG9kID09IG51bGwpCiAgICAgICAgbWV0aG9kID0gaXRlcmFibGVbIkBAYXN5bmNJdGVyYXRvciJdOwogICAgICBpZiAobWV0aG9kID09IG51bGwpCiAgICAgICAgbWV0aG9kID0gaXRlcmFibGVbIkBAaXRlcmF0b3IiXTsKICAgICAgaWYgKG1ldGhvZCA9PSBudWxsKQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdCBpcyBub3QgYXN5bmMgaXRlcmFibGUiKTsKICAgICAgcmV0dXJuIG1ldGhvZC5jYWxsKGl0ZXJhYmxlKTsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gX2FzeW5jSXRlcmF0b3I7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKGFzeW5jSXRlcmF0b3IpOwogIHZhciBidWZmZXIgPSB7fTsKICB2YXIgYmFzZTY0SnMgPSB7fTsKICBiYXNlNjRKcy5ieXRlTGVuZ3RoID0gYnl0ZUxlbmd0aDsKICBiYXNlNjRKcy50b0J5dGVBcnJheSA9IHRvQnl0ZUFycmF5OwogIGJhc2U2NEpzLmZyb21CeXRlQXJyYXkgPSBmcm9tQnl0ZUFycmF5OwogIHZhciBsb29rdXAgPSBbXTsKICB2YXIgcmV2TG9va3VwID0gW107CiAgdmFyIEFyciA9IHR5cGVvZiBVaW50OEFycmF5ICE9PSAidW5kZWZpbmVkIiA/IFVpbnQ4QXJyYXkgOiBBcnJheTsKICB2YXIgY29kZSA9ICJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvIjsKICBmb3IgKHZhciBpID0gMCwgbGVuID0gY29kZS5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgbG9va3VwW2ldID0gY29kZVtpXTsKICAgIHJldkxvb2t1cFtjb2RlLmNoYXJDb2RlQXQoaSldID0gaTsKICB9CiAgcmV2TG9va3VwWyItIi5jaGFyQ29kZUF0KDApXSA9IDYyOwogIHJldkxvb2t1cFsiXyIuY2hhckNvZGVBdCgwKV0gPSA2MzsKICBmdW5jdGlvbiBnZXRMZW5zKGI2NCkgewogICAgdmFyIGxlbjIgPSBiNjQubGVuZ3RoOwogICAgaWYgKGxlbjIgJSA0ID4gMCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgc3RyaW5nLiBMZW5ndGggbXVzdCBiZSBhIG11bHRpcGxlIG9mIDQiKTsKICAgIH0KICAgIHZhciB2YWxpZExlbiA9IGI2NC5pbmRleE9mKCI9Iik7CiAgICBpZiAodmFsaWRMZW4gPT09IC0xKQogICAgICB2YWxpZExlbiA9IGxlbjI7CiAgICB2YXIgcGxhY2VIb2xkZXJzTGVuID0gdmFsaWRMZW4gPT09IGxlbjIgPyAwIDogNCAtIHZhbGlkTGVuICUgNDsKICAgIHJldHVybiBbdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbl07CiAgfQogIGZ1bmN0aW9uIGJ5dGVMZW5ndGgoYjY0KSB7CiAgICB2YXIgbGVucyA9IGdldExlbnMoYjY0KTsKICAgIHZhciB2YWxpZExlbiA9IGxlbnNbMF07CiAgICB2YXIgcGxhY2VIb2xkZXJzTGVuID0gbGVuc1sxXTsKICAgIHJldHVybiAodmFsaWRMZW4gKyBwbGFjZUhvbGRlcnNMZW4pICogMyAvIDQgLSBwbGFjZUhvbGRlcnNMZW47CiAgfQogIGZ1bmN0aW9uIF9ieXRlTGVuZ3RoKGI2NCwgdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbikgewogICAgcmV0dXJuICh2YWxpZExlbiArIHBsYWNlSG9sZGVyc0xlbikgKiAzIC8gNCAtIHBsYWNlSG9sZGVyc0xlbjsKICB9CiAgZnVuY3Rpb24gdG9CeXRlQXJyYXkoYjY0KSB7CiAgICB2YXIgdG1wOwogICAgdmFyIGxlbnMgPSBnZXRMZW5zKGI2NCk7CiAgICB2YXIgdmFsaWRMZW4gPSBsZW5zWzBdOwogICAgdmFyIHBsYWNlSG9sZGVyc0xlbiA9IGxlbnNbMV07CiAgICB2YXIgYXJyID0gbmV3IEFycihfYnl0ZUxlbmd0aChiNjQsIHZhbGlkTGVuLCBwbGFjZUhvbGRlcnNMZW4pKTsKICAgIHZhciBjdXJCeXRlID0gMDsKICAgIHZhciBsZW4yID0gcGxhY2VIb2xkZXJzTGVuID4gMCA/IHZhbGlkTGVuIC0gNCA6IHZhbGlkTGVuOwogICAgdmFyIGkyOwogICAgZm9yIChpMiA9IDA7IGkyIDwgbGVuMjsgaTIgKz0gNCkgewogICAgICB0bXAgPSByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTIpXSA8PCAxOCB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMiArIDEpXSA8PCAxMiB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMiArIDIpXSA8PCA2IHwgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkyICsgMyldOwogICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCA+PiAxNiAmIDI1NTsKICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgPj4gOCAmIDI1NTsKICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAyNTU7CiAgICB9CiAgICBpZiAocGxhY2VIb2xkZXJzTGVuID09PSAyKSB7CiAgICAgIHRtcCA9IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMildIDw8IDIgfCByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTIgKyAxKV0gPj4gNDsKICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAyNTU7CiAgICB9CiAgICBpZiAocGxhY2VIb2xkZXJzTGVuID09PSAxKSB7CiAgICAgIHRtcCA9IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMildIDw8IDEwIHwgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkyICsgMSldIDw8IDQgfCByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTIgKyAyKV0gPj4gMjsKICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgPj4gOCAmIDI1NTsKICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAyNTU7CiAgICB9CiAgICByZXR1cm4gYXJyOwogIH0KICBmdW5jdGlvbiB0cmlwbGV0VG9CYXNlNjQobnVtKSB7CiAgICByZXR1cm4gbG9va3VwW251bSA+PiAxOCAmIDYzXSArIGxvb2t1cFtudW0gPj4gMTIgJiA2M10gKyBsb29rdXBbbnVtID4+IDYgJiA2M10gKyBsb29rdXBbbnVtICYgNjNdOwogIH0KICBmdW5jdGlvbiBlbmNvZGVDaHVuayh1aW50OCwgc3RhcnQsIGVuZCkgewogICAgdmFyIHRtcDsKICAgIHZhciBvdXRwdXQgPSBbXTsKICAgIGZvciAodmFyIGkyID0gc3RhcnQ7IGkyIDwgZW5kOyBpMiArPSAzKSB7CiAgICAgIHRtcCA9ICh1aW50OFtpMl0gPDwgMTYgJiAxNjcxMTY4MCkgKyAodWludDhbaTIgKyAxXSA8PCA4ICYgNjUyODApICsgKHVpbnQ4W2kyICsgMl0gJiAyNTUpOwogICAgICBvdXRwdXQucHVzaCh0cmlwbGV0VG9CYXNlNjQodG1wKSk7CiAgICB9CiAgICByZXR1cm4gb3V0cHV0LmpvaW4oIiIpOwogIH0KICBmdW5jdGlvbiBmcm9tQnl0ZUFycmF5KHVpbnQ4KSB7CiAgICB2YXIgdG1wOwogICAgdmFyIGxlbjIgPSB1aW50OC5sZW5ndGg7CiAgICB2YXIgZXh0cmFCeXRlcyA9IGxlbjIgJSAzOwogICAgdmFyIHBhcnRzID0gW107CiAgICB2YXIgbWF4Q2h1bmtMZW5ndGggPSAxNjM4MzsKICAgIGZvciAodmFyIGkyID0gMCwgbGVuMjIgPSBsZW4yIC0gZXh0cmFCeXRlczsgaTIgPCBsZW4yMjsgaTIgKz0gbWF4Q2h1bmtMZW5ndGgpIHsKICAgICAgcGFydHMucHVzaChlbmNvZGVDaHVuayh1aW50OCwgaTIsIGkyICsgbWF4Q2h1bmtMZW5ndGggPiBsZW4yMiA/IGxlbjIyIDogaTIgKyBtYXhDaHVua0xlbmd0aCkpOwogICAgfQogICAgaWYgKGV4dHJhQnl0ZXMgPT09IDEpIHsKICAgICAgdG1wID0gdWludDhbbGVuMiAtIDFdOwogICAgICBwYXJ0cy5wdXNoKGxvb2t1cFt0bXAgPj4gMl0gKyBsb29rdXBbdG1wIDw8IDQgJiA2M10gKyAiPT0iKTsKICAgIH0gZWxzZSBpZiAoZXh0cmFCeXRlcyA9PT0gMikgewogICAgICB0bXAgPSAodWludDhbbGVuMiAtIDJdIDw8IDgpICsgdWludDhbbGVuMiAtIDFdOwogICAgICBwYXJ0cy5wdXNoKGxvb2t1cFt0bXAgPj4gMTBdICsgbG9va3VwW3RtcCA+PiA0ICYgNjNdICsgbG9va3VwW3RtcCA8PCAyICYgNjNdICsgIj0iKTsKICAgIH0KICAgIHJldHVybiBwYXJ0cy5qb2luKCIiKTsKICB9CiAgdmFyIGllZWU3NTQgPSB7fTsKICAvKiEgaWVlZTc1NC4gQlNELTMtQ2xhdXNlIExpY2Vuc2UuIEZlcm9zcyBBYm91a2hhZGlqZWggPGh0dHBzOi8vZmVyb3NzLm9yZy9vcGVuc291cmNlPiAqLwogIGllZWU3NTQucmVhZCA9IGZ1bmN0aW9uKGJ1ZmZlcjIsIG9mZnNldCwgaXNMRSwgbUxlbiwgbkJ5dGVzKSB7CiAgICB2YXIgZSwgbTsKICAgIHZhciBlTGVuID0gbkJ5dGVzICogOCAtIG1MZW4gLSAxOwogICAgdmFyIGVNYXggPSAoMSA8PCBlTGVuKSAtIDE7CiAgICB2YXIgZUJpYXMgPSBlTWF4ID4+IDE7CiAgICB2YXIgbkJpdHMgPSAtNzsKICAgIHZhciBpMiA9IGlzTEUgPyBuQnl0ZXMgLSAxIDogMDsKICAgIHZhciBkID0gaXNMRSA/IC0xIDogMTsKICAgIHZhciBzID0gYnVmZmVyMltvZmZzZXQgKyBpMl07CiAgICBpMiArPSBkOwogICAgZSA9IHMgJiAoMSA8PCAtbkJpdHMpIC0gMTsKICAgIHMgPj49IC1uQml0czsKICAgIG5CaXRzICs9IGVMZW47CiAgICBmb3IgKDsgbkJpdHMgPiAwOyBlID0gZSAqIDI1NiArIGJ1ZmZlcjJbb2Zmc2V0ICsgaTJdLCBpMiArPSBkLCBuQml0cyAtPSA4KSB7CiAgICB9CiAgICBtID0gZSAmICgxIDw8IC1uQml0cykgLSAxOwogICAgZSA+Pj0gLW5CaXRzOwogICAgbkJpdHMgKz0gbUxlbjsKICAgIGZvciAoOyBuQml0cyA+IDA7IG0gPSBtICogMjU2ICsgYnVmZmVyMltvZmZzZXQgKyBpMl0sIGkyICs9IGQsIG5CaXRzIC09IDgpIHsKICAgIH0KICAgIGlmIChlID09PSAwKSB7CiAgICAgIGUgPSAxIC0gZUJpYXM7CiAgICB9IGVsc2UgaWYgKGUgPT09IGVNYXgpIHsKICAgICAgcmV0dXJuIG0gPyBOYU4gOiAocyA/IC0xIDogMSkgKiBJbmZpbml0eTsKICAgIH0gZWxzZSB7CiAgICAgIG0gPSBtICsgTWF0aC5wb3coMiwgbUxlbik7CiAgICAgIGUgPSBlIC0gZUJpYXM7CiAgICB9CiAgICByZXR1cm4gKHMgPyAtMSA6IDEpICogbSAqIE1hdGgucG93KDIsIGUgLSBtTGVuKTsKICB9OwogIGllZWU3NTQud3JpdGUgPSBmdW5jdGlvbihidWZmZXIyLCB2YWx1ZSwgb2Zmc2V0LCBpc0xFLCBtTGVuLCBuQnl0ZXMpIHsKICAgIHZhciBlLCBtLCBjMjsKICAgIHZhciBlTGVuID0gbkJ5dGVzICogOCAtIG1MZW4gLSAxOwogICAgdmFyIGVNYXggPSAoMSA8PCBlTGVuKSAtIDE7CiAgICB2YXIgZUJpYXMgPSBlTWF4ID4+IDE7CiAgICB2YXIgcnQgPSBtTGVuID09PSAyMyA/IE1hdGgucG93KDIsIC0yNCkgLSBNYXRoLnBvdygyLCAtNzcpIDogMDsKICAgIHZhciBpMiA9IGlzTEUgPyAwIDogbkJ5dGVzIC0gMTsKICAgIHZhciBkID0gaXNMRSA/IDEgOiAtMTsKICAgIHZhciBzID0gdmFsdWUgPCAwIHx8IHZhbHVlID09PSAwICYmIDEgLyB2YWx1ZSA8IDAgPyAxIDogMDsKICAgIHZhbHVlID0gTWF0aC5hYnModmFsdWUpOwogICAgaWYgKGlzTmFOKHZhbHVlKSB8fCB2YWx1ZSA9PT0gSW5maW5pdHkpIHsKICAgICAgbSA9IGlzTmFOKHZhbHVlKSA/IDEgOiAwOwogICAgICBlID0gZU1heDsKICAgIH0gZWxzZSB7CiAgICAgIGUgPSBNYXRoLmZsb29yKE1hdGgubG9nKHZhbHVlKSAvIE1hdGguTE4yKTsKICAgICAgaWYgKHZhbHVlICogKGMyID0gTWF0aC5wb3coMiwgLWUpKSA8IDEpIHsKICAgICAgICBlLS07CiAgICAgICAgYzIgKj0gMjsKICAgICAgfQogICAgICBpZiAoZSArIGVCaWFzID49IDEpIHsKICAgICAgICB2YWx1ZSArPSBydCAvIGMyOwogICAgICB9IGVsc2UgewogICAgICAgIHZhbHVlICs9IHJ0ICogTWF0aC5wb3coMiwgMSAtIGVCaWFzKTsKICAgICAgfQogICAgICBpZiAodmFsdWUgKiBjMiA+PSAyKSB7CiAgICAgICAgZSsrOwogICAgICAgIGMyIC89IDI7CiAgICAgIH0KICAgICAgaWYgKGUgKyBlQmlhcyA+PSBlTWF4KSB7CiAgICAgICAgbSA9IDA7CiAgICAgICAgZSA9IGVNYXg7CiAgICAgIH0gZWxzZSBpZiAoZSArIGVCaWFzID49IDEpIHsKICAgICAgICBtID0gKHZhbHVlICogYzIgLSAxKSAqIE1hdGgucG93KDIsIG1MZW4pOwogICAgICAgIGUgPSBlICsgZUJpYXM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbSA9IHZhbHVlICogTWF0aC5wb3coMiwgZUJpYXMgLSAxKSAqIE1hdGgucG93KDIsIG1MZW4pOwogICAgICAgIGUgPSAwOwogICAgICB9CiAgICB9CiAgICBmb3IgKDsgbUxlbiA+PSA4OyBidWZmZXIyW29mZnNldCArIGkyXSA9IG0gJiAyNTUsIGkyICs9IGQsIG0gLz0gMjU2LCBtTGVuIC09IDgpIHsKICAgIH0KICAgIGUgPSBlIDw8IG1MZW4gfCBtOwogICAgZUxlbiArPSBtTGVuOwogICAgZm9yICg7IGVMZW4gPiAwOyBidWZmZXIyW29mZnNldCArIGkyXSA9IGUgJiAyNTUsIGkyICs9IGQsIGUgLz0gMjU2LCBlTGVuIC09IDgpIHsKICAgIH0KICAgIGJ1ZmZlcjJbb2Zmc2V0ICsgaTIgLSBkXSB8PSBzICogMTI4OwogIH07CiAgLyohCiAgICogVGhlIGJ1ZmZlciBtb2R1bGUgZnJvbSBub2RlLmpzLCBmb3IgdGhlIGJyb3dzZXIuCiAgICoKICAgKiBAYXV0aG9yICAgRmVyb3NzIEFib3VraGFkaWplaCA8aHR0cHM6Ly9mZXJvc3Mub3JnPgogICAqIEBsaWNlbnNlICBNSVQKICAgKi8KICAoZnVuY3Rpb24oZXhwb3J0cykgewogICAgY29uc3QgYmFzZTY0ID0gYmFzZTY0SnM7CiAgICBjb25zdCBpZWVlNzU0JDEgPSBpZWVlNzU0OwogICAgY29uc3QgY3VzdG9tSW5zcGVjdFN5bWJvbCA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbFsiZm9yIl0gPT09ICJmdW5jdGlvbiIgPyBTeW1ib2xbImZvciJdKCJub2RlanMudXRpbC5pbnNwZWN0LmN1c3RvbSIpIDogbnVsbDsKICAgIGV4cG9ydHMuQnVmZmVyID0gQnVmZmVyMjsKICAgIGV4cG9ydHMuU2xvd0J1ZmZlciA9IFNsb3dCdWZmZXI7CiAgICBleHBvcnRzLklOU1BFQ1RfTUFYX0JZVEVTID0gNTA7CiAgICBjb25zdCBLX01BWF9MRU5HVEggPSAyMTQ3NDgzNjQ3OwogICAgZXhwb3J0cy5rTWF4TGVuZ3RoID0gS19NQVhfTEVOR1RIOwogICAgQnVmZmVyMi5UWVBFRF9BUlJBWV9TVVBQT1JUID0gdHlwZWRBcnJheVN1cHBvcnQoKTsKICAgIGlmICghQnVmZmVyMi5UWVBFRF9BUlJBWV9TVVBQT1JUICYmIHR5cGVvZiBjb25zb2xlICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YgY29uc29sZS5lcnJvciA9PT0gImZ1bmN0aW9uIikgewogICAgICBjb25zb2xlLmVycm9yKCJUaGlzIGJyb3dzZXIgbGFja3MgdHlwZWQgYXJyYXkgKFVpbnQ4QXJyYXkpIHN1cHBvcnQgd2hpY2ggaXMgcmVxdWlyZWQgYnkgYGJ1ZmZlcmAgdjUueC4gVXNlIGBidWZmZXJgIHY0LnggaWYgeW91IHJlcXVpcmUgb2xkIGJyb3dzZXIgc3VwcG9ydC4iKTsKICAgIH0KICAgIGZ1bmN0aW9uIHR5cGVkQXJyYXlTdXBwb3J0KCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IGFyciA9IG5ldyBVaW50OEFycmF5KDEpOwogICAgICAgIGNvbnN0IHByb3RvID0geyBmb286IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIDQyOwogICAgICAgIH0gfTsKICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YocHJvdG8sIFVpbnQ4QXJyYXkucHJvdG90eXBlKTsKICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YoYXJyLCBwcm90byk7CiAgICAgICAgcmV0dXJuIGFyci5mb28oKSA9PT0gNDI7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShCdWZmZXIyLnByb3RvdHlwZSwgInBhcmVudCIsIHsKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoIUJ1ZmZlcjIuaXNCdWZmZXIodGhpcykpCiAgICAgICAgICByZXR1cm4gdm9pZCAwOwogICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlcjsKICAgICAgfQogICAgfSk7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQnVmZmVyMi5wcm90b3R5cGUsICJvZmZzZXQiLCB7CiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKCFCdWZmZXIyLmlzQnVmZmVyKHRoaXMpKQogICAgICAgICAgcmV0dXJuIHZvaWQgMDsKICAgICAgICByZXR1cm4gdGhpcy5ieXRlT2Zmc2V0OwogICAgICB9CiAgICB9KTsKICAgIGZ1bmN0aW9uIGNyZWF0ZUJ1ZmZlcihsZW5ndGgpIHsKICAgICAgaWYgKGxlbmd0aCA+IEtfTUFYX0xFTkdUSCkgewogICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdUaGUgdmFsdWUgIicgKyBsZW5ndGggKyAnIiBpcyBpbnZhbGlkIGZvciBvcHRpb24gInNpemUiJyk7CiAgICAgIH0KICAgICAgY29uc3QgYnVmID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTsKICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKGJ1ZiwgQnVmZmVyMi5wcm90b3R5cGUpOwogICAgICByZXR1cm4gYnVmOwogICAgfQogICAgZnVuY3Rpb24gQnVmZmVyMihhcmcsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCkgewogICAgICBpZiAodHlwZW9mIGFyZyA9PT0gIm51bWJlciIpIHsKICAgICAgICBpZiAodHlwZW9mIGVuY29kaW5nT3JPZmZzZXQgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgInN0cmluZyIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIHN0cmluZy4gUmVjZWl2ZWQgdHlwZSBudW1iZXInKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFsbG9jVW5zYWZlKGFyZyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGZyb20yKGFyZywgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKTsKICAgIH0KICAgIEJ1ZmZlcjIucG9vbFNpemUgPSA4MTkyOwogICAgZnVuY3Rpb24gZnJvbTIodmFsdWUsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCkgewogICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAic3RyaW5nIikgewogICAgICAgIHJldHVybiBmcm9tU3RyaW5nMih2YWx1ZSwgZW5jb2RpbmdPck9mZnNldCk7CiAgICAgIH0KICAgICAgaWYgKEFycmF5QnVmZmVyLmlzVmlldyh2YWx1ZSkpIHsKICAgICAgICByZXR1cm4gZnJvbUFycmF5Vmlldyh2YWx1ZSk7CiAgICAgIH0KICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJUaGUgZmlyc3QgYXJndW1lbnQgbXVzdCBiZSBvbmUgb2YgdHlwZSBzdHJpbmcsIEJ1ZmZlciwgQXJyYXlCdWZmZXIsIEFycmF5LCBvciBBcnJheS1saWtlIE9iamVjdC4gUmVjZWl2ZWQgdHlwZSAiICsgdHlwZW9mIHZhbHVlKTsKICAgICAgfQogICAgICBpZiAoaXNJbnN0YW5jZSh2YWx1ZSwgQXJyYXlCdWZmZXIpIHx8IHZhbHVlICYmIGlzSW5zdGFuY2UodmFsdWUuYnVmZmVyLCBBcnJheUJ1ZmZlcikpIHsKICAgICAgICByZXR1cm4gZnJvbUFycmF5QnVmZmVyKHZhbHVlLCBlbmNvZGluZ09yT2Zmc2V0LCBsZW5ndGgpOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgU2hhcmVkQXJyYXlCdWZmZXIgIT09ICJ1bmRlZmluZWQiICYmIChpc0luc3RhbmNlKHZhbHVlLCBTaGFyZWRBcnJheUJ1ZmZlcikgfHwgdmFsdWUgJiYgaXNJbnN0YW5jZSh2YWx1ZS5idWZmZXIsIFNoYXJlZEFycmF5QnVmZmVyKSkpIHsKICAgICAgICByZXR1cm4gZnJvbUFycmF5QnVmZmVyKHZhbHVlLCBlbmNvZGluZ09yT2Zmc2V0LCBsZW5ndGgpOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJudW1iZXIiKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlICJ2YWx1ZSIgYXJndW1lbnQgbXVzdCBub3QgYmUgb2YgdHlwZSBudW1iZXIuIFJlY2VpdmVkIHR5cGUgbnVtYmVyJyk7CiAgICAgIH0KICAgICAgY29uc3QgdmFsdWVPZjIgPSB2YWx1ZS52YWx1ZU9mICYmIHZhbHVlLnZhbHVlT2YoKTsKICAgICAgaWYgKHZhbHVlT2YyICE9IG51bGwgJiYgdmFsdWVPZjIgIT09IHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIEJ1ZmZlcjIuZnJvbSh2YWx1ZU9mMiwgZW5jb2RpbmdPck9mZnNldCwgbGVuZ3RoKTsKICAgICAgfQogICAgICBjb25zdCBiID0gZnJvbU9iamVjdCh2YWx1ZSk7CiAgICAgIGlmIChiKQogICAgICAgIHJldHVybiBiOwogICAgICBpZiAodHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgU3ltYm9sLnRvUHJpbWl0aXZlICE9IG51bGwgJiYgdHlwZW9mIHZhbHVlW1N5bWJvbC50b1ByaW1pdGl2ZV0gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICByZXR1cm4gQnVmZmVyMi5mcm9tKHZhbHVlW1N5bWJvbC50b1ByaW1pdGl2ZV0oInN0cmluZyIpLCBlbmNvZGluZ09yT2Zmc2V0LCBsZW5ndGgpOwogICAgICB9CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlRoZSBmaXJzdCBhcmd1bWVudCBtdXN0IGJlIG9uZSBvZiB0eXBlIHN0cmluZywgQnVmZmVyLCBBcnJheUJ1ZmZlciwgQXJyYXksIG9yIEFycmF5LWxpa2UgT2JqZWN0LiBSZWNlaXZlZCB0eXBlICIgKyB0eXBlb2YgdmFsdWUpOwogICAgfQogICAgQnVmZmVyMi5mcm9tID0gZnVuY3Rpb24odmFsdWUsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCkgewogICAgICByZXR1cm4gZnJvbTIodmFsdWUsIGVuY29kaW5nT3JPZmZzZXQsIGxlbmd0aCk7CiAgICB9OwogICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKEJ1ZmZlcjIucHJvdG90eXBlLCBVaW50OEFycmF5LnByb3RvdHlwZSk7CiAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YoQnVmZmVyMiwgVWludDhBcnJheSk7CiAgICBmdW5jdGlvbiBhc3NlcnRTaXplKHNpemUpIHsKICAgICAgaWYgKHR5cGVvZiBzaXplICE9PSAibnVtYmVyIikgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJzaXplIiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgbnVtYmVyJyk7CiAgICAgIH0gZWxzZSBpZiAoc2l6ZSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignVGhlIHZhbHVlICInICsgc2l6ZSArICciIGlzIGludmFsaWQgZm9yIG9wdGlvbiAic2l6ZSInKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gYWxsb2Moc2l6ZSwgZmlsbCwgZW5jb2RpbmcpIHsKICAgICAgYXNzZXJ0U2l6ZShzaXplKTsKICAgICAgaWYgKHNpemUgPD0gMCkgewogICAgICAgIHJldHVybiBjcmVhdGVCdWZmZXIoc2l6ZSk7CiAgICAgIH0KICAgICAgaWYgKGZpbGwgIT09IHZvaWQgMCkgewogICAgICAgIHJldHVybiB0eXBlb2YgZW5jb2RpbmcgPT09ICJzdHJpbmciID8gY3JlYXRlQnVmZmVyKHNpemUpLmZpbGwoZmlsbCwgZW5jb2RpbmcpIDogY3JlYXRlQnVmZmVyKHNpemUpLmZpbGwoZmlsbCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNyZWF0ZUJ1ZmZlcihzaXplKTsKICAgIH0KICAgIEJ1ZmZlcjIuYWxsb2MgPSBmdW5jdGlvbihzaXplLCBmaWxsLCBlbmNvZGluZykgewogICAgICByZXR1cm4gYWxsb2Moc2l6ZSwgZmlsbCwgZW5jb2RpbmcpOwogICAgfTsKICAgIGZ1bmN0aW9uIGFsbG9jVW5zYWZlKHNpemUpIHsKICAgICAgYXNzZXJ0U2l6ZShzaXplKTsKICAgICAgcmV0dXJuIGNyZWF0ZUJ1ZmZlcihzaXplIDwgMCA/IDAgOiBjaGVja2VkKHNpemUpIHwgMCk7CiAgICB9CiAgICBCdWZmZXIyLmFsbG9jVW5zYWZlID0gZnVuY3Rpb24oc2l6ZSkgewogICAgICByZXR1cm4gYWxsb2NVbnNhZmUoc2l6ZSk7CiAgICB9OwogICAgQnVmZmVyMi5hbGxvY1Vuc2FmZVNsb3cgPSBmdW5jdGlvbihzaXplKSB7CiAgICAgIHJldHVybiBhbGxvY1Vuc2FmZShzaXplKTsKICAgIH07CiAgICBmdW5jdGlvbiBmcm9tU3RyaW5nMihzdHJpbmcsIGVuY29kaW5nKSB7CiAgICAgIGlmICh0eXBlb2YgZW5jb2RpbmcgIT09ICJzdHJpbmciIHx8IGVuY29kaW5nID09PSAiIikgewogICAgICAgIGVuY29kaW5nID0gInV0ZjgiOwogICAgICB9CiAgICAgIGlmICghQnVmZmVyMi5pc0VuY29kaW5nKGVuY29kaW5nKSkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZW5jb2Rpbmc6ICIgKyBlbmNvZGluZyk7CiAgICAgIH0KICAgICAgY29uc3QgbGVuZ3RoID0gYnl0ZUxlbmd0aDIoc3RyaW5nLCBlbmNvZGluZykgfCAwOwogICAgICBsZXQgYnVmID0gY3JlYXRlQnVmZmVyKGxlbmd0aCk7CiAgICAgIGNvbnN0IGFjdHVhbCA9IGJ1Zi53cml0ZShzdHJpbmcsIGVuY29kaW5nKTsKICAgICAgaWYgKGFjdHVhbCAhPT0gbGVuZ3RoKSB7CiAgICAgICAgYnVmID0gYnVmLnNsaWNlKDAsIGFjdHVhbCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0KICAgIGZ1bmN0aW9uIGZyb21BcnJheUxpa2UoYXJyYXkpIHsKICAgICAgY29uc3QgbGVuZ3RoID0gYXJyYXkubGVuZ3RoIDwgMCA/IDAgOiBjaGVja2VkKGFycmF5Lmxlbmd0aCkgfCAwOwogICAgICBjb25zdCBidWYgPSBjcmVhdGVCdWZmZXIobGVuZ3RoKTsKICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGxlbmd0aDsgaTIgKz0gMSkgewogICAgICAgIGJ1ZltpMl0gPSBhcnJheVtpMl0gJiAyNTU7CiAgICAgIH0KICAgICAgcmV0dXJuIGJ1ZjsKICAgIH0KICAgIGZ1bmN0aW9uIGZyb21BcnJheVZpZXcoYXJyYXlWaWV3KSB7CiAgICAgIGlmIChpc0luc3RhbmNlKGFycmF5VmlldywgVWludDhBcnJheSkpIHsKICAgICAgICBjb25zdCBjb3B5ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlWaWV3KTsKICAgICAgICByZXR1cm4gZnJvbUFycmF5QnVmZmVyKGNvcHkuYnVmZmVyLCBjb3B5LmJ5dGVPZmZzZXQsIGNvcHkuYnl0ZUxlbmd0aCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGZyb21BcnJheUxpa2UoYXJyYXlWaWV3KTsKICAgIH0KICAgIGZ1bmN0aW9uIGZyb21BcnJheUJ1ZmZlcihhcnJheSwgYnl0ZU9mZnNldCwgbGVuZ3RoKSB7CiAgICAgIGlmIChieXRlT2Zmc2V0IDwgMCB8fCBhcnJheS5ieXRlTGVuZ3RoIDwgYnl0ZU9mZnNldCkgewogICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCcib2Zmc2V0IiBpcyBvdXRzaWRlIG9mIGJ1ZmZlciBib3VuZHMnKTsKICAgICAgfQogICAgICBpZiAoYXJyYXkuYnl0ZUxlbmd0aCA8IGJ5dGVPZmZzZXQgKyAobGVuZ3RoIHx8IDApKSB7CiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJyJsZW5ndGgiIGlzIG91dHNpZGUgb2YgYnVmZmVyIGJvdW5kcycpOwogICAgICB9CiAgICAgIGxldCBidWY7CiAgICAgIGlmIChieXRlT2Zmc2V0ID09PSB2b2lkIDAgJiYgbGVuZ3RoID09PSB2b2lkIDApIHsKICAgICAgICBidWYgPSBuZXcgVWludDhBcnJheShhcnJheSk7CiAgICAgIH0gZWxzZSBpZiAobGVuZ3RoID09PSB2b2lkIDApIHsKICAgICAgICBidWYgPSBuZXcgVWludDhBcnJheShhcnJheSwgYnl0ZU9mZnNldCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnVmID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXksIGJ5dGVPZmZzZXQsIGxlbmd0aCk7CiAgICAgIH0KICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKGJ1ZiwgQnVmZmVyMi5wcm90b3R5cGUpOwogICAgICByZXR1cm4gYnVmOwogICAgfQogICAgZnVuY3Rpb24gZnJvbU9iamVjdChvYmopIHsKICAgICAgaWYgKEJ1ZmZlcjIuaXNCdWZmZXIob2JqKSkgewogICAgICAgIGNvbnN0IGxlbjIgPSBjaGVja2VkKG9iai5sZW5ndGgpIHwgMDsKICAgICAgICBjb25zdCBidWYgPSBjcmVhdGVCdWZmZXIobGVuMik7CiAgICAgICAgaWYgKGJ1Zi5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHJldHVybiBidWY7CiAgICAgICAgfQogICAgICAgIG9iai5jb3B5KGJ1ZiwgMCwgMCwgbGVuMik7CiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgICAgfQogICAgICBpZiAob2JqLmxlbmd0aCAhPT0gdm9pZCAwKSB7CiAgICAgICAgaWYgKHR5cGVvZiBvYmoubGVuZ3RoICE9PSAibnVtYmVyIiB8fCBudW1iZXJJc05hTihvYmoubGVuZ3RoKSkgewogICAgICAgICAgcmV0dXJuIGNyZWF0ZUJ1ZmZlcigwKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZyb21BcnJheUxpa2Uob2JqKTsKICAgICAgfQogICAgICBpZiAob2JqLnR5cGUgPT09ICJCdWZmZXIiICYmIEFycmF5LmlzQXJyYXkob2JqLmRhdGEpKSB7CiAgICAgICAgcmV0dXJuIGZyb21BcnJheUxpa2Uob2JqLmRhdGEpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBjaGVja2VkKGxlbmd0aCkgewogICAgICBpZiAobGVuZ3RoID49IEtfTUFYX0xFTkdUSCkgewogICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJBdHRlbXB0IHRvIGFsbG9jYXRlIEJ1ZmZlciBsYXJnZXIgdGhhbiBtYXhpbXVtIHNpemU6IDB4IiArIEtfTUFYX0xFTkdUSC50b1N0cmluZygxNikgKyAiIGJ5dGVzIik7CiAgICAgIH0KICAgICAgcmV0dXJuIGxlbmd0aCB8IDA7CiAgICB9CiAgICBmdW5jdGlvbiBTbG93QnVmZmVyKGxlbmd0aCkgewogICAgICBpZiAoK2xlbmd0aCAhPSBsZW5ndGgpIHsKICAgICAgICBsZW5ndGggPSAwOwogICAgICB9CiAgICAgIHJldHVybiBCdWZmZXIyLmFsbG9jKCtsZW5ndGgpOwogICAgfQogICAgQnVmZmVyMi5pc0J1ZmZlciA9IGZ1bmN0aW9uIGlzQnVmZmVyKGIpIHsKICAgICAgcmV0dXJuIGIgIT0gbnVsbCAmJiBiLl9pc0J1ZmZlciA9PT0gdHJ1ZSAmJiBiICE9PSBCdWZmZXIyLnByb3RvdHlwZTsKICAgIH07CiAgICBCdWZmZXIyLmNvbXBhcmUgPSBmdW5jdGlvbiBjb21wYXJlKGEsIGIpIHsKICAgICAgaWYgKGlzSW5zdGFuY2UoYSwgVWludDhBcnJheSkpCiAgICAgICAgYSA9IEJ1ZmZlcjIuZnJvbShhLCBhLm9mZnNldCwgYS5ieXRlTGVuZ3RoKTsKICAgICAgaWYgKGlzSW5zdGFuY2UoYiwgVWludDhBcnJheSkpCiAgICAgICAgYiA9IEJ1ZmZlcjIuZnJvbShiLCBiLm9mZnNldCwgYi5ieXRlTGVuZ3RoKTsKICAgICAgaWYgKCFCdWZmZXIyLmlzQnVmZmVyKGEpIHx8ICFCdWZmZXIyLmlzQnVmZmVyKGIpKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlICJidWYxIiwgImJ1ZjIiIGFyZ3VtZW50cyBtdXN0IGJlIG9uZSBvZiB0eXBlIEJ1ZmZlciBvciBVaW50OEFycmF5Jyk7CiAgICAgIH0KICAgICAgaWYgKGEgPT09IGIpCiAgICAgICAgcmV0dXJuIDA7CiAgICAgIGxldCB4ID0gYS5sZW5ndGg7CiAgICAgIGxldCB5ID0gYi5sZW5ndGg7CiAgICAgIGZvciAobGV0IGkyID0gMCwgbGVuMiA9IE1hdGgubWluKHgsIHkpOyBpMiA8IGxlbjI7ICsraTIpIHsKICAgICAgICBpZiAoYVtpMl0gIT09IGJbaTJdKSB7CiAgICAgICAgICB4ID0gYVtpMl07CiAgICAgICAgICB5ID0gYltpMl07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHggPCB5KQogICAgICAgIHJldHVybiAtMTsKICAgICAgaWYgKHkgPCB4KQogICAgICAgIHJldHVybiAxOwogICAgICByZXR1cm4gMDsKICAgIH07CiAgICBCdWZmZXIyLmlzRW5jb2RpbmcgPSBmdW5jdGlvbiBpc0VuY29kaW5nKGVuY29kaW5nKSB7CiAgICAgIHN3aXRjaCAoU3RyaW5nKGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpKSB7CiAgICAgICAgY2FzZSAiaGV4IjoKICAgICAgICBjYXNlICJ1dGY4IjoKICAgICAgICBjYXNlICJ1dGYtOCI6CiAgICAgICAgY2FzZSAiYXNjaWkiOgogICAgICAgIGNhc2UgImxhdGluMSI6CiAgICAgICAgY2FzZSAiYmluYXJ5IjoKICAgICAgICBjYXNlICJiYXNlNjQiOgogICAgICAgIGNhc2UgInVjczIiOgogICAgICAgIGNhc2UgInVjcy0yIjoKICAgICAgICBjYXNlICJ1dGYxNmxlIjoKICAgICAgICBjYXNlICJ1dGYtMTZsZSI6CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9OwogICAgQnVmZmVyMi5jb25jYXQgPSBmdW5jdGlvbiBjb25jYXQyKGxpc3QsIGxlbmd0aCkgewogICAgICBpZiAoIUFycmF5LmlzQXJyYXkobGlzdCkpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCcibGlzdCIgYXJndW1lbnQgbXVzdCBiZSBhbiBBcnJheSBvZiBCdWZmZXJzJyk7CiAgICAgIH0KICAgICAgaWYgKGxpc3QubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIEJ1ZmZlcjIuYWxsb2MoMCk7CiAgICAgIH0KICAgICAgbGV0IGkyOwogICAgICBpZiAobGVuZ3RoID09PSB2b2lkIDApIHsKICAgICAgICBsZW5ndGggPSAwOwogICAgICAgIGZvciAoaTIgPSAwOyBpMiA8IGxpc3QubGVuZ3RoOyArK2kyKSB7CiAgICAgICAgICBsZW5ndGggKz0gbGlzdFtpMl0ubGVuZ3RoOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBidWZmZXIyID0gQnVmZmVyMi5hbGxvY1Vuc2FmZShsZW5ndGgpOwogICAgICBsZXQgcG9zID0gMDsKICAgICAgZm9yIChpMiA9IDA7IGkyIDwgbGlzdC5sZW5ndGg7ICsraTIpIHsKICAgICAgICBsZXQgYnVmID0gbGlzdFtpMl07CiAgICAgICAgaWYgKGlzSW5zdGFuY2UoYnVmLCBVaW50OEFycmF5KSkgewogICAgICAgICAgaWYgKHBvcyArIGJ1Zi5sZW5ndGggPiBidWZmZXIyLmxlbmd0aCkgewogICAgICAgICAgICBpZiAoIUJ1ZmZlcjIuaXNCdWZmZXIoYnVmKSkKICAgICAgICAgICAgICBidWYgPSBCdWZmZXIyLmZyb20oYnVmKTsKICAgICAgICAgICAgYnVmLmNvcHkoYnVmZmVyMiwgcG9zKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFVpbnQ4QXJyYXkucHJvdG90eXBlLnNldC5jYWxsKGJ1ZmZlcjIsIGJ1ZiwgcG9zKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKCFCdWZmZXIyLmlzQnVmZmVyKGJ1ZikpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJsaXN0IiBhcmd1bWVudCBtdXN0IGJlIGFuIEFycmF5IG9mIEJ1ZmZlcnMnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYnVmLmNvcHkoYnVmZmVyMiwgcG9zKTsKICAgICAgICB9CiAgICAgICAgcG9zICs9IGJ1Zi5sZW5ndGg7CiAgICAgIH0KICAgICAgcmV0dXJuIGJ1ZmZlcjI7CiAgICB9OwogICAgZnVuY3Rpb24gYnl0ZUxlbmd0aDIoc3RyaW5nLCBlbmNvZGluZykgewogICAgICBpZiAoQnVmZmVyMi5pc0J1ZmZlcihzdHJpbmcpKSB7CiAgICAgICAgcmV0dXJuIHN0cmluZy5sZW5ndGg7CiAgICAgIH0KICAgICAgaWYgKEFycmF5QnVmZmVyLmlzVmlldyhzdHJpbmcpIHx8IGlzSW5zdGFuY2Uoc3RyaW5nLCBBcnJheUJ1ZmZlcikpIHsKICAgICAgICByZXR1cm4gc3RyaW5nLmJ5dGVMZW5ndGg7CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiBzdHJpbmcgIT09ICJzdHJpbmciKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlICJzdHJpbmciIGFyZ3VtZW50IG11c3QgYmUgb25lIG9mIHR5cGUgc3RyaW5nLCBCdWZmZXIsIG9yIEFycmF5QnVmZmVyLiBSZWNlaXZlZCB0eXBlICcgKyB0eXBlb2Ygc3RyaW5nKTsKICAgICAgfQogICAgICBjb25zdCBsZW4yID0gc3RyaW5nLmxlbmd0aDsKICAgICAgY29uc3QgbXVzdE1hdGNoID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdID09PSB0cnVlOwogICAgICBpZiAoIW11c3RNYXRjaCAmJiBsZW4yID09PSAwKQogICAgICAgIHJldHVybiAwOwogICAgICBsZXQgbG93ZXJlZENhc2UgPSBmYWxzZTsKICAgICAgZm9yICg7IDsgKSB7CiAgICAgICAgc3dpdGNoIChlbmNvZGluZykgewogICAgICAgICAgY2FzZSAiYXNjaWkiOgogICAgICAgICAgY2FzZSAibGF0aW4xIjoKICAgICAgICAgIGNhc2UgImJpbmFyeSI6CiAgICAgICAgICAgIHJldHVybiBsZW4yOwogICAgICAgICAgY2FzZSAidXRmOCI6CiAgICAgICAgICBjYXNlICJ1dGYtOCI6CiAgICAgICAgICAgIHJldHVybiB1dGY4VG9CeXRlcyhzdHJpbmcpLmxlbmd0aDsKICAgICAgICAgIGNhc2UgInVjczIiOgogICAgICAgICAgY2FzZSAidWNzLTIiOgogICAgICAgICAgY2FzZSAidXRmMTZsZSI6CiAgICAgICAgICBjYXNlICJ1dGYtMTZsZSI6CiAgICAgICAgICAgIHJldHVybiBsZW4yICogMjsKICAgICAgICAgIGNhc2UgImhleCI6CiAgICAgICAgICAgIHJldHVybiBsZW4yID4+PiAxOwogICAgICAgICAgY2FzZSAiYmFzZTY0IjoKICAgICAgICAgICAgcmV0dXJuIGJhc2U2NFRvQnl0ZXMoc3RyaW5nKS5sZW5ndGg7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBpZiAobG93ZXJlZENhc2UpIHsKICAgICAgICAgICAgICByZXR1cm4gbXVzdE1hdGNoID8gLTEgOiB1dGY4VG9CeXRlcyhzdHJpbmcpLmxlbmd0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbmNvZGluZyA9ICgiIiArIGVuY29kaW5nKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICBsb3dlcmVkQ2FzZSA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBCdWZmZXIyLmJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoMjsKICAgIGZ1bmN0aW9uIHNsb3dUb1N0cmluZyhlbmNvZGluZywgc3RhcnQsIGVuZCkgewogICAgICBsZXQgbG93ZXJlZENhc2UgPSBmYWxzZTsKICAgICAgaWYgKHN0YXJ0ID09PSB2b2lkIDAgfHwgc3RhcnQgPCAwKSB7CiAgICAgICAgc3RhcnQgPSAwOwogICAgICB9CiAgICAgIGlmIChzdGFydCA+IHRoaXMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICAgIGlmIChlbmQgPT09IHZvaWQgMCB8fCBlbmQgPiB0aGlzLmxlbmd0aCkgewogICAgICAgIGVuZCA9IHRoaXMubGVuZ3RoOwogICAgICB9CiAgICAgIGlmIChlbmQgPD0gMCkgewogICAgICAgIHJldHVybiAiIjsKICAgICAgfQogICAgICBlbmQgPj4+PSAwOwogICAgICBzdGFydCA+Pj49IDA7CiAgICAgIGlmIChlbmQgPD0gc3RhcnQpIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgICAgaWYgKCFlbmNvZGluZykKICAgICAgICBlbmNvZGluZyA9ICJ1dGY4IjsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICBzd2l0Y2ggKGVuY29kaW5nKSB7CiAgICAgICAgICBjYXNlICJoZXgiOgogICAgICAgICAgICByZXR1cm4gaGV4U2xpY2UodGhpcywgc3RhcnQsIGVuZCk7CiAgICAgICAgICBjYXNlICJ1dGY4IjoKICAgICAgICAgIGNhc2UgInV0Zi04IjoKICAgICAgICAgICAgcmV0dXJuIHV0ZjhTbGljZSh0aGlzLCBzdGFydCwgZW5kKTsKICAgICAgICAgIGNhc2UgImFzY2lpIjoKICAgICAgICAgICAgcmV0dXJuIGFzY2lpU2xpY2UodGhpcywgc3RhcnQsIGVuZCk7CiAgICAgICAgICBjYXNlICJsYXRpbjEiOgogICAgICAgICAgY2FzZSAiYmluYXJ5IjoKICAgICAgICAgICAgcmV0dXJuIGxhdGluMVNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgY2FzZSAiYmFzZTY0IjoKICAgICAgICAgICAgcmV0dXJuIGJhc2U2NFNsaWNlKHRoaXMsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgY2FzZSAidWNzMiI6CiAgICAgICAgICBjYXNlICJ1Y3MtMiI6CiAgICAgICAgICBjYXNlICJ1dGYxNmxlIjoKICAgICAgICAgIGNhc2UgInV0Zi0xNmxlIjoKICAgICAgICAgICAgcmV0dXJuIHV0ZjE2bGVTbGljZSh0aGlzLCBzdGFydCwgZW5kKTsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGlmIChsb3dlcmVkQ2FzZSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIGVuY29kaW5nOiAiICsgZW5jb2RpbmcpOwogICAgICAgICAgICBlbmNvZGluZyA9IChlbmNvZGluZyArICIiKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICBsb3dlcmVkQ2FzZSA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBCdWZmZXIyLnByb3RvdHlwZS5faXNCdWZmZXIgPSB0cnVlOwogICAgZnVuY3Rpb24gc3dhcChiLCBuLCBtKSB7CiAgICAgIGNvbnN0IGkyID0gYltuXTsKICAgICAgYltuXSA9IGJbbV07CiAgICAgIGJbbV0gPSBpMjsKICAgIH0KICAgIEJ1ZmZlcjIucHJvdG90eXBlLnN3YXAxNiA9IGZ1bmN0aW9uIHN3YXAxNigpIHsKICAgICAgY29uc3QgbGVuMiA9IHRoaXMubGVuZ3RoOwogICAgICBpZiAobGVuMiAlIDIgIT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQnVmZmVyIHNpemUgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDE2LWJpdHMiKTsKICAgICAgfQogICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgbGVuMjsgaTIgKz0gMikgewogICAgICAgIHN3YXAodGhpcywgaTIsIGkyICsgMSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUuc3dhcDMyID0gZnVuY3Rpb24gc3dhcDMyKCkgewogICAgICBjb25zdCBsZW4yID0gdGhpcy5sZW5ndGg7CiAgICAgIGlmIChsZW4yICUgNCAhPT0gMCkgewogICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJCdWZmZXIgc2l6ZSBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgMzItYml0cyIpOwogICAgICB9CiAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBsZW4yOyBpMiArPSA0KSB7CiAgICAgICAgc3dhcCh0aGlzLCBpMiwgaTIgKyAzKTsKICAgICAgICBzd2FwKHRoaXMsIGkyICsgMSwgaTIgKyAyKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICBCdWZmZXIyLnByb3RvdHlwZS5zd2FwNjQgPSBmdW5jdGlvbiBzd2FwNjQoKSB7CiAgICAgIGNvbnN0IGxlbjIgPSB0aGlzLmxlbmd0aDsKICAgICAgaWYgKGxlbjIgJSA4ICE9PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkJ1ZmZlciBzaXplIG11c3QgYmUgYSBtdWx0aXBsZSBvZiA2NC1iaXRzIik7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGxlbjI7IGkyICs9IDgpIHsKICAgICAgICBzd2FwKHRoaXMsIGkyLCBpMiArIDcpOwogICAgICAgIHN3YXAodGhpcywgaTIgKyAxLCBpMiArIDYpOwogICAgICAgIHN3YXAodGhpcywgaTIgKyAyLCBpMiArIDUpOwogICAgICAgIHN3YXAodGhpcywgaTIgKyAzLCBpMiArIDQpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcyKCkgewogICAgICBjb25zdCBsZW5ndGggPSB0aGlzLmxlbmd0aDsKICAgICAgaWYgKGxlbmd0aCA9PT0gMCkKICAgICAgICByZXR1cm4gIiI7CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKQogICAgICAgIHJldHVybiB1dGY4U2xpY2UodGhpcywgMCwgbGVuZ3RoKTsKICAgICAgcmV0dXJuIHNsb3dUb1N0cmluZy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLnRvTG9jYWxlU3RyaW5nID0gQnVmZmVyMi5wcm90b3R5cGUudG9TdHJpbmc7CiAgICBCdWZmZXIyLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiBlcXVhbHMoYikgewogICAgICBpZiAoIUJ1ZmZlcjIuaXNCdWZmZXIoYikpCiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQXJndW1lbnQgbXVzdCBiZSBhIEJ1ZmZlciIpOwogICAgICBpZiAodGhpcyA9PT0gYikKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgcmV0dXJuIEJ1ZmZlcjIuY29tcGFyZSh0aGlzLCBiKSA9PT0gMDsKICAgIH07CiAgICBCdWZmZXIyLnByb3RvdHlwZS5pbnNwZWN0ID0gZnVuY3Rpb24gaW5zcGVjdCgpIHsKICAgICAgbGV0IHN0ciA9ICIiOwogICAgICBjb25zdCBtYXgyID0gZXhwb3J0cy5JTlNQRUNUX01BWF9CWVRFUzsKICAgICAgc3RyID0gdGhpcy50b1N0cmluZygiaGV4IiwgMCwgbWF4MikucmVwbGFjZSgvKC57Mn0pL2csICIkMSAiKS50cmltKCk7CiAgICAgIGlmICh0aGlzLmxlbmd0aCA+IG1heDIpCiAgICAgICAgc3RyICs9ICIgLi4uICI7CiAgICAgIHJldHVybiAiPEJ1ZmZlciAiICsgc3RyICsgIj4iOwogICAgfTsKICAgIGlmIChjdXN0b21JbnNwZWN0U3ltYm9sKSB7CiAgICAgIEJ1ZmZlcjIucHJvdG90eXBlW2N1c3RvbUluc3BlY3RTeW1ib2xdID0gQnVmZmVyMi5wcm90b3R5cGUuaW5zcGVjdDsKICAgIH0KICAgIEJ1ZmZlcjIucHJvdG90eXBlLmNvbXBhcmUgPSBmdW5jdGlvbiBjb21wYXJlKHRhcmdldCwgc3RhcnQsIGVuZCwgdGhpc1N0YXJ0LCB0aGlzRW5kKSB7CiAgICAgIGlmIChpc0luc3RhbmNlKHRhcmdldCwgVWludDhBcnJheSkpIHsKICAgICAgICB0YXJnZXQgPSBCdWZmZXIyLmZyb20odGFyZ2V0LCB0YXJnZXQub2Zmc2V0LCB0YXJnZXQuYnl0ZUxlbmd0aCk7CiAgICAgIH0KICAgICAgaWYgKCFCdWZmZXIyLmlzQnVmZmVyKHRhcmdldCkpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgInRhcmdldCIgYXJndW1lbnQgbXVzdCBiZSBvbmUgb2YgdHlwZSBCdWZmZXIgb3IgVWludDhBcnJheS4gUmVjZWl2ZWQgdHlwZSAnICsgdHlwZW9mIHRhcmdldCk7CiAgICAgIH0KICAgICAgaWYgKHN0YXJ0ID09PSB2b2lkIDApIHsKICAgICAgICBzdGFydCA9IDA7CiAgICAgIH0KICAgICAgaWYgKGVuZCA9PT0gdm9pZCAwKSB7CiAgICAgICAgZW5kID0gdGFyZ2V0ID8gdGFyZ2V0Lmxlbmd0aCA6IDA7CiAgICAgIH0KICAgICAgaWYgKHRoaXNTdGFydCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGhpc1N0YXJ0ID0gMDsKICAgICAgfQogICAgICBpZiAodGhpc0VuZCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGhpc0VuZCA9IHRoaXMubGVuZ3RoOwogICAgICB9CiAgICAgIGlmIChzdGFydCA8IDAgfHwgZW5kID4gdGFyZ2V0Lmxlbmd0aCB8fCB0aGlzU3RhcnQgPCAwIHx8IHRoaXNFbmQgPiB0aGlzLmxlbmd0aCkgewogICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJvdXQgb2YgcmFuZ2UgaW5kZXgiKTsKICAgICAgfQogICAgICBpZiAodGhpc1N0YXJ0ID49IHRoaXNFbmQgJiYgc3RhcnQgPj0gZW5kKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgaWYgKHRoaXNTdGFydCA+PSB0aGlzRW5kKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIGlmIChzdGFydCA+PSBlbmQpIHsKICAgICAgICByZXR1cm4gMTsKICAgICAgfQogICAgICBzdGFydCA+Pj49IDA7CiAgICAgIGVuZCA+Pj49IDA7CiAgICAgIHRoaXNTdGFydCA+Pj49IDA7CiAgICAgIHRoaXNFbmQgPj4+PSAwOwogICAgICBpZiAodGhpcyA9PT0gdGFyZ2V0KQogICAgICAgIHJldHVybiAwOwogICAgICBsZXQgeCA9IHRoaXNFbmQgLSB0aGlzU3RhcnQ7CiAgICAgIGxldCB5ID0gZW5kIC0gc3RhcnQ7CiAgICAgIGNvbnN0IGxlbjIgPSBNYXRoLm1pbih4LCB5KTsKICAgICAgY29uc3QgdGhpc0NvcHkgPSB0aGlzLnNsaWNlKHRoaXNTdGFydCwgdGhpc0VuZCk7CiAgICAgIGNvbnN0IHRhcmdldENvcHkgPSB0YXJnZXQuc2xpY2Uoc3RhcnQsIGVuZCk7CiAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBsZW4yOyArK2kyKSB7CiAgICAgICAgaWYgKHRoaXNDb3B5W2kyXSAhPT0gdGFyZ2V0Q29weVtpMl0pIHsKICAgICAgICAgIHggPSB0aGlzQ29weVtpMl07CiAgICAgICAgICB5ID0gdGFyZ2V0Q29weVtpMl07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHggPCB5KQogICAgICAgIHJldHVybiAtMTsKICAgICAgaWYgKHkgPCB4KQogICAgICAgIHJldHVybiAxOwogICAgICByZXR1cm4gMDsKICAgIH07CiAgICBmdW5jdGlvbiBiaWRpcmVjdGlvbmFsSW5kZXhPZihidWZmZXIyLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpIHsKICAgICAgaWYgKGJ1ZmZlcjIubGVuZ3RoID09PSAwKQogICAgICAgIHJldHVybiAtMTsKICAgICAgaWYgKHR5cGVvZiBieXRlT2Zmc2V0ID09PSAic3RyaW5nIikgewogICAgICAgIGVuY29kaW5nID0gYnl0ZU9mZnNldDsKICAgICAgICBieXRlT2Zmc2V0ID0gMDsKICAgICAgfSBlbHNlIGlmIChieXRlT2Zmc2V0ID4gMjE0NzQ4MzY0NykgewogICAgICAgIGJ5dGVPZmZzZXQgPSAyMTQ3NDgzNjQ3OwogICAgICB9IGVsc2UgaWYgKGJ5dGVPZmZzZXQgPCAtMjE0NzQ4MzY0OCkgewogICAgICAgIGJ5dGVPZmZzZXQgPSAtMjE0NzQ4MzY0ODsKICAgICAgfQogICAgICBieXRlT2Zmc2V0ID0gK2J5dGVPZmZzZXQ7CiAgICAgIGlmIChudW1iZXJJc05hTihieXRlT2Zmc2V0KSkgewogICAgICAgIGJ5dGVPZmZzZXQgPSBkaXIgPyAwIDogYnVmZmVyMi5sZW5ndGggLSAxOwogICAgICB9CiAgICAgIGlmIChieXRlT2Zmc2V0IDwgMCkKICAgICAgICBieXRlT2Zmc2V0ID0gYnVmZmVyMi5sZW5ndGggKyBieXRlT2Zmc2V0OwogICAgICBpZiAoYnl0ZU9mZnNldCA+PSBidWZmZXIyLmxlbmd0aCkgewogICAgICAgIGlmIChkaXIpCiAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgZWxzZQogICAgICAgICAgYnl0ZU9mZnNldCA9IGJ1ZmZlcjIubGVuZ3RoIC0gMTsKICAgICAgfSBlbHNlIGlmIChieXRlT2Zmc2V0IDwgMCkgewogICAgICAgIGlmIChkaXIpCiAgICAgICAgICBieXRlT2Zmc2V0ID0gMDsKICAgICAgICBlbHNlCiAgICAgICAgICByZXR1cm4gLTE7CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICJzdHJpbmciKSB7CiAgICAgICAgdmFsID0gQnVmZmVyMi5mcm9tKHZhbCwgZW5jb2RpbmcpOwogICAgICB9CiAgICAgIGlmIChCdWZmZXIyLmlzQnVmZmVyKHZhbCkpIHsKICAgICAgICBpZiAodmFsLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYXJyYXlJbmRleE9mKGJ1ZmZlcjIsIHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIGRpcik7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbCA9PT0gIm51bWJlciIpIHsKICAgICAgICB2YWwgPSB2YWwgJiAyNTU7CiAgICAgICAgaWYgKHR5cGVvZiBVaW50OEFycmF5LnByb3RvdHlwZS5pbmRleE9mID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICBpZiAoZGlyKSB7CiAgICAgICAgICAgIHJldHVybiBVaW50OEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoYnVmZmVyMiwgdmFsLCBieXRlT2Zmc2V0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBVaW50OEFycmF5LnByb3RvdHlwZS5sYXN0SW5kZXhPZi5jYWxsKGJ1ZmZlcjIsIHZhbCwgYnl0ZU9mZnNldCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBhcnJheUluZGV4T2YoYnVmZmVyMiwgW3ZhbF0sIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCBkaXIpOwogICAgICB9CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoInZhbCBtdXN0IGJlIHN0cmluZywgbnVtYmVyIG9yIEJ1ZmZlciIpOwogICAgfQogICAgZnVuY3Rpb24gYXJyYXlJbmRleE9mKGFyciwgdmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZywgZGlyKSB7CiAgICAgIGxldCBpbmRleFNpemUgPSAxOwogICAgICBsZXQgYXJyTGVuZ3RoID0gYXJyLmxlbmd0aDsKICAgICAgbGV0IHZhbExlbmd0aCA9IHZhbC5sZW5ndGg7CiAgICAgIGlmIChlbmNvZGluZyAhPT0gdm9pZCAwKSB7CiAgICAgICAgZW5jb2RpbmcgPSBTdHJpbmcoZW5jb2RpbmcpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgaWYgKGVuY29kaW5nID09PSAidWNzMiIgfHwgZW5jb2RpbmcgPT09ICJ1Y3MtMiIgfHwgZW5jb2RpbmcgPT09ICJ1dGYxNmxlIiB8fCBlbmNvZGluZyA9PT0gInV0Zi0xNmxlIikgewogICAgICAgICAgaWYgKGFyci5sZW5ndGggPCAyIHx8IHZhbC5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIH0KICAgICAgICAgIGluZGV4U2l6ZSA9IDI7CiAgICAgICAgICBhcnJMZW5ndGggLz0gMjsKICAgICAgICAgIHZhbExlbmd0aCAvPSAyOwogICAgICAgICAgYnl0ZU9mZnNldCAvPSAyOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiByZWFkKGJ1ZiwgaTMpIHsKICAgICAgICBpZiAoaW5kZXhTaXplID09PSAxKSB7CiAgICAgICAgICByZXR1cm4gYnVmW2kzXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGJ1Zi5yZWFkVUludDE2QkUoaTMgKiBpbmRleFNpemUpOwogICAgICAgIH0KICAgICAgfQogICAgICBsZXQgaTI7CiAgICAgIGlmIChkaXIpIHsKICAgICAgICBsZXQgZm91bmRJbmRleCA9IC0xOwogICAgICAgIGZvciAoaTIgPSBieXRlT2Zmc2V0OyBpMiA8IGFyckxlbmd0aDsgaTIrKykgewogICAgICAgICAgaWYgKHJlYWQoYXJyLCBpMikgPT09IHJlYWQodmFsLCBmb3VuZEluZGV4ID09PSAtMSA/IDAgOiBpMiAtIGZvdW5kSW5kZXgpKSB7CiAgICAgICAgICAgIGlmIChmb3VuZEluZGV4ID09PSAtMSkKICAgICAgICAgICAgICBmb3VuZEluZGV4ID0gaTI7CiAgICAgICAgICAgIGlmIChpMiAtIGZvdW5kSW5kZXggKyAxID09PSB2YWxMZW5ndGgpCiAgICAgICAgICAgICAgcmV0dXJuIGZvdW5kSW5kZXggKiBpbmRleFNpemU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoZm91bmRJbmRleCAhPT0gLTEpCiAgICAgICAgICAgICAgaTIgLT0gaTIgLSBmb3VuZEluZGV4OwogICAgICAgICAgICBmb3VuZEluZGV4ID0gLTE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChieXRlT2Zmc2V0ICsgdmFsTGVuZ3RoID4gYXJyTGVuZ3RoKQogICAgICAgICAgYnl0ZU9mZnNldCA9IGFyckxlbmd0aCAtIHZhbExlbmd0aDsKICAgICAgICBmb3IgKGkyID0gYnl0ZU9mZnNldDsgaTIgPj0gMDsgaTItLSkgewogICAgICAgICAgbGV0IGZvdW5kID0gdHJ1ZTsKICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdmFsTGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgaWYgKHJlYWQoYXJyLCBpMiArIGopICE9PSByZWFkKHZhbCwgaikpIHsKICAgICAgICAgICAgICBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZm91bmQpCiAgICAgICAgICAgIHJldHVybiBpMjsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgQnVmZmVyMi5wcm90b3R5cGUuaW5jbHVkZXMgPSBmdW5jdGlvbiBpbmNsdWRlcyh2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nKSB7CiAgICAgIHJldHVybiB0aGlzLmluZGV4T2YodmFsLCBieXRlT2Zmc2V0LCBlbmNvZGluZykgIT09IC0xOwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiBpbmRleE9mMih2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nKSB7CiAgICAgIHJldHVybiBiaWRpcmVjdGlvbmFsSW5kZXhPZih0aGlzLCB2YWwsIGJ5dGVPZmZzZXQsIGVuY29kaW5nLCB0cnVlKTsKICAgIH07CiAgICBCdWZmZXIyLnByb3RvdHlwZS5sYXN0SW5kZXhPZiA9IGZ1bmN0aW9uIGxhc3RJbmRleE9mKHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcpIHsKICAgICAgcmV0dXJuIGJpZGlyZWN0aW9uYWxJbmRleE9mKHRoaXMsIHZhbCwgYnl0ZU9mZnNldCwgZW5jb2RpbmcsIGZhbHNlKTsKICAgIH07CiAgICBmdW5jdGlvbiBoZXhXcml0ZShidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpIHsKICAgICAgb2Zmc2V0ID0gTnVtYmVyKG9mZnNldCkgfHwgMDsKICAgICAgY29uc3QgcmVtYWluaW5nID0gYnVmLmxlbmd0aCAtIG9mZnNldDsKICAgICAgaWYgKCFsZW5ndGgpIHsKICAgICAgICBsZW5ndGggPSByZW1haW5pbmc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGVuZ3RoID0gTnVtYmVyKGxlbmd0aCk7CiAgICAgICAgaWYgKGxlbmd0aCA+IHJlbWFpbmluZykgewogICAgICAgICAgbGVuZ3RoID0gcmVtYWluaW5nOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBzdHJMZW4gPSBzdHJpbmcubGVuZ3RoOwogICAgICBpZiAobGVuZ3RoID4gc3RyTGVuIC8gMikgewogICAgICAgIGxlbmd0aCA9IHN0ckxlbiAvIDI7CiAgICAgIH0KICAgICAgbGV0IGkyOwogICAgICBmb3IgKGkyID0gMDsgaTIgPCBsZW5ndGg7ICsraTIpIHsKICAgICAgICBjb25zdCBwYXJzZWQgPSBwYXJzZUludChzdHJpbmcuc3Vic3RyKGkyICogMiwgMiksIDE2KTsKICAgICAgICBpZiAobnVtYmVySXNOYU4ocGFyc2VkKSkKICAgICAgICAgIHJldHVybiBpMjsKICAgICAgICBidWZbb2Zmc2V0ICsgaTJdID0gcGFyc2VkOwogICAgICB9CiAgICAgIHJldHVybiBpMjsKICAgIH0KICAgIGZ1bmN0aW9uIHV0ZjhXcml0ZShidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpIHsKICAgICAgcmV0dXJuIGJsaXRCdWZmZXIodXRmOFRvQnl0ZXMoc3RyaW5nLCBidWYubGVuZ3RoIC0gb2Zmc2V0KSwgYnVmLCBvZmZzZXQsIGxlbmd0aCk7CiAgICB9CiAgICBmdW5jdGlvbiBhc2NpaVdyaXRlKGJ1Ziwgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCkgewogICAgICByZXR1cm4gYmxpdEJ1ZmZlcihhc2NpaVRvQnl0ZXMoc3RyaW5nKSwgYnVmLCBvZmZzZXQsIGxlbmd0aCk7CiAgICB9CiAgICBmdW5jdGlvbiBiYXNlNjRXcml0ZShidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpIHsKICAgICAgcmV0dXJuIGJsaXRCdWZmZXIoYmFzZTY0VG9CeXRlcyhzdHJpbmcpLCBidWYsIG9mZnNldCwgbGVuZ3RoKTsKICAgIH0KICAgIGZ1bmN0aW9uIHVjczJXcml0ZShidWYsIHN0cmluZywgb2Zmc2V0LCBsZW5ndGgpIHsKICAgICAgcmV0dXJuIGJsaXRCdWZmZXIodXRmMTZsZVRvQnl0ZXMoc3RyaW5nLCBidWYubGVuZ3RoIC0gb2Zmc2V0KSwgYnVmLCBvZmZzZXQsIGxlbmd0aCk7CiAgICB9CiAgICBCdWZmZXIyLnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uIHdyaXRlKHN0cmluZywgb2Zmc2V0LCBsZW5ndGgsIGVuY29kaW5nKSB7CiAgICAgIGlmIChvZmZzZXQgPT09IHZvaWQgMCkgewogICAgICAgIGVuY29kaW5nID0gInV0ZjgiOwogICAgICAgIGxlbmd0aCA9IHRoaXMubGVuZ3RoOwogICAgICAgIG9mZnNldCA9IDA7CiAgICAgIH0gZWxzZSBpZiAobGVuZ3RoID09PSB2b2lkIDAgJiYgdHlwZW9mIG9mZnNldCA9PT0gInN0cmluZyIpIHsKICAgICAgICBlbmNvZGluZyA9IG9mZnNldDsKICAgICAgICBsZW5ndGggPSB0aGlzLmxlbmd0aDsKICAgICAgICBvZmZzZXQgPSAwOwogICAgICB9IGVsc2UgaWYgKGlzRmluaXRlKG9mZnNldCkpIHsKICAgICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgICAgaWYgKGlzRmluaXRlKGxlbmd0aCkpIHsKICAgICAgICAgIGxlbmd0aCA9IGxlbmd0aCA+Pj4gMDsKICAgICAgICAgIGlmIChlbmNvZGluZyA9PT0gdm9pZCAwKQogICAgICAgICAgICBlbmNvZGluZyA9ICJ1dGY4IjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZW5jb2RpbmcgPSBsZW5ndGg7CiAgICAgICAgICBsZW5ndGggPSB2b2lkIDA7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiQnVmZmVyLndyaXRlKHN0cmluZywgZW5jb2RpbmcsIG9mZnNldFssIGxlbmd0aF0pIGlzIG5vIGxvbmdlciBzdXBwb3J0ZWQiKTsKICAgICAgfQogICAgICBjb25zdCByZW1haW5pbmcgPSB0aGlzLmxlbmd0aCAtIG9mZnNldDsKICAgICAgaWYgKGxlbmd0aCA9PT0gdm9pZCAwIHx8IGxlbmd0aCA+IHJlbWFpbmluZykKICAgICAgICBsZW5ndGggPSByZW1haW5pbmc7CiAgICAgIGlmIChzdHJpbmcubGVuZ3RoID4gMCAmJiAobGVuZ3RoIDwgMCB8fCBvZmZzZXQgPCAwKSB8fCBvZmZzZXQgPiB0aGlzLmxlbmd0aCkgewogICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJBdHRlbXB0IHRvIHdyaXRlIG91dHNpZGUgYnVmZmVyIGJvdW5kcyIpOwogICAgICB9CiAgICAgIGlmICghZW5jb2RpbmcpCiAgICAgICAgZW5jb2RpbmcgPSAidXRmOCI7CiAgICAgIGxldCBsb3dlcmVkQ2FzZSA9IGZhbHNlOwogICAgICBmb3IgKDsgOyApIHsKICAgICAgICBzd2l0Y2ggKGVuY29kaW5nKSB7CiAgICAgICAgICBjYXNlICJoZXgiOgogICAgICAgICAgICByZXR1cm4gaGV4V3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCk7CiAgICAgICAgICBjYXNlICJ1dGY4IjoKICAgICAgICAgIGNhc2UgInV0Zi04IjoKICAgICAgICAgICAgcmV0dXJuIHV0ZjhXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKTsKICAgICAgICAgIGNhc2UgImFzY2lpIjoKICAgICAgICAgIGNhc2UgImxhdGluMSI6CiAgICAgICAgICBjYXNlICJiaW5hcnkiOgogICAgICAgICAgICByZXR1cm4gYXNjaWlXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKTsKICAgICAgICAgIGNhc2UgImJhc2U2NCI6CiAgICAgICAgICAgIHJldHVybiBiYXNlNjRXcml0ZSh0aGlzLCBzdHJpbmcsIG9mZnNldCwgbGVuZ3RoKTsKICAgICAgICAgIGNhc2UgInVjczIiOgogICAgICAgICAgY2FzZSAidWNzLTIiOgogICAgICAgICAgY2FzZSAidXRmMTZsZSI6CiAgICAgICAgICBjYXNlICJ1dGYtMTZsZSI6CiAgICAgICAgICAgIHJldHVybiB1Y3MyV3JpdGUodGhpcywgc3RyaW5nLCBvZmZzZXQsIGxlbmd0aCk7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBpZiAobG93ZXJlZENhc2UpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBlbmNvZGluZzogIiArIGVuY29kaW5nKTsKICAgICAgICAgICAgZW5jb2RpbmcgPSAoIiIgKyBlbmNvZGluZykudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgbG93ZXJlZENhc2UgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIHRvSlNPTigpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAiQnVmZmVyIiwKICAgICAgICBkYXRhOiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCh0aGlzLl9hcnIgfHwgdGhpcywgMCkKICAgICAgfTsKICAgIH07CiAgICBmdW5jdGlvbiBiYXNlNjRTbGljZShidWYsIHN0YXJ0LCBlbmQpIHsKICAgICAgaWYgKHN0YXJ0ID09PSAwICYmIGVuZCA9PT0gYnVmLmxlbmd0aCkgewogICAgICAgIHJldHVybiBiYXNlNjQuZnJvbUJ5dGVBcnJheShidWYpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBiYXNlNjQuZnJvbUJ5dGVBcnJheShidWYuc2xpY2Uoc3RhcnQsIGVuZCkpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiB1dGY4U2xpY2UoYnVmLCBzdGFydCwgZW5kKSB7CiAgICAgIGVuZCA9IE1hdGgubWluKGJ1Zi5sZW5ndGgsIGVuZCk7CiAgICAgIGNvbnN0IHJlcyA9IFtdOwogICAgICBsZXQgaTIgPSBzdGFydDsKICAgICAgd2hpbGUgKGkyIDwgZW5kKSB7CiAgICAgICAgY29uc3QgZmlyc3RCeXRlID0gYnVmW2kyXTsKICAgICAgICBsZXQgY29kZVBvaW50ID0gbnVsbDsKICAgICAgICBsZXQgYnl0ZXNQZXJTZXF1ZW5jZSA9IGZpcnN0Qnl0ZSA+IDIzOSA/IDQgOiBmaXJzdEJ5dGUgPiAyMjMgPyAzIDogZmlyc3RCeXRlID4gMTkxID8gMiA6IDE7CiAgICAgICAgaWYgKGkyICsgYnl0ZXNQZXJTZXF1ZW5jZSA8PSBlbmQpIHsKICAgICAgICAgIGxldCBzZWNvbmRCeXRlLCB0aGlyZEJ5dGUsIGZvdXJ0aEJ5dGUsIHRlbXBDb2RlUG9pbnQ7CiAgICAgICAgICBzd2l0Y2ggKGJ5dGVzUGVyU2VxdWVuY2UpIHsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIGlmIChmaXJzdEJ5dGUgPCAxMjgpIHsKICAgICAgICAgICAgICAgIGNvZGVQb2ludCA9IGZpcnN0Qnl0ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBzZWNvbmRCeXRlID0gYnVmW2kyICsgMV07CiAgICAgICAgICAgICAgaWYgKChzZWNvbmRCeXRlICYgMTkyKSA9PT0gMTI4KSB7CiAgICAgICAgICAgICAgICB0ZW1wQ29kZVBvaW50ID0gKGZpcnN0Qnl0ZSAmIDMxKSA8PCA2IHwgc2Vjb25kQnl0ZSAmIDYzOwogICAgICAgICAgICAgICAgaWYgKHRlbXBDb2RlUG9pbnQgPiAxMjcpIHsKICAgICAgICAgICAgICAgICAgY29kZVBvaW50ID0gdGVtcENvZGVQb2ludDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBzZWNvbmRCeXRlID0gYnVmW2kyICsgMV07CiAgICAgICAgICAgICAgdGhpcmRCeXRlID0gYnVmW2kyICsgMl07CiAgICAgICAgICAgICAgaWYgKChzZWNvbmRCeXRlICYgMTkyKSA9PT0gMTI4ICYmICh0aGlyZEJ5dGUgJiAxOTIpID09PSAxMjgpIHsKICAgICAgICAgICAgICAgIHRlbXBDb2RlUG9pbnQgPSAoZmlyc3RCeXRlICYgMTUpIDw8IDEyIHwgKHNlY29uZEJ5dGUgJiA2MykgPDwgNiB8IHRoaXJkQnl0ZSAmIDYzOwogICAgICAgICAgICAgICAgaWYgKHRlbXBDb2RlUG9pbnQgPiAyMDQ3ICYmICh0ZW1wQ29kZVBvaW50IDwgNTUyOTYgfHwgdGVtcENvZGVQb2ludCA+IDU3MzQzKSkgewogICAgICAgICAgICAgICAgICBjb2RlUG9pbnQgPSB0ZW1wQ29kZVBvaW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIHNlY29uZEJ5dGUgPSBidWZbaTIgKyAxXTsKICAgICAgICAgICAgICB0aGlyZEJ5dGUgPSBidWZbaTIgKyAyXTsKICAgICAgICAgICAgICBmb3VydGhCeXRlID0gYnVmW2kyICsgM107CiAgICAgICAgICAgICAgaWYgKChzZWNvbmRCeXRlICYgMTkyKSA9PT0gMTI4ICYmICh0aGlyZEJ5dGUgJiAxOTIpID09PSAxMjggJiYgKGZvdXJ0aEJ5dGUgJiAxOTIpID09PSAxMjgpIHsKICAgICAgICAgICAgICAgIHRlbXBDb2RlUG9pbnQgPSAoZmlyc3RCeXRlICYgMTUpIDw8IDE4IHwgKHNlY29uZEJ5dGUgJiA2MykgPDwgMTIgfCAodGhpcmRCeXRlICYgNjMpIDw8IDYgfCBmb3VydGhCeXRlICYgNjM7CiAgICAgICAgICAgICAgICBpZiAodGVtcENvZGVQb2ludCA+IDY1NTM1ICYmIHRlbXBDb2RlUG9pbnQgPCAxMTE0MTEyKSB7CiAgICAgICAgICAgICAgICAgIGNvZGVQb2ludCA9IHRlbXBDb2RlUG9pbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoY29kZVBvaW50ID09PSBudWxsKSB7CiAgICAgICAgICBjb2RlUG9pbnQgPSA2NTUzMzsKICAgICAgICAgIGJ5dGVzUGVyU2VxdWVuY2UgPSAxOwogICAgICAgIH0gZWxzZSBpZiAoY29kZVBvaW50ID4gNjU1MzUpIHsKICAgICAgICAgIGNvZGVQb2ludCAtPSA2NTUzNjsKICAgICAgICAgIHJlcy5wdXNoKGNvZGVQb2ludCA+Pj4gMTAgJiAxMDIzIHwgNTUyOTYpOwogICAgICAgICAgY29kZVBvaW50ID0gNTYzMjAgfCBjb2RlUG9pbnQgJiAxMDIzOwogICAgICAgIH0KICAgICAgICByZXMucHVzaChjb2RlUG9pbnQpOwogICAgICAgIGkyICs9IGJ5dGVzUGVyU2VxdWVuY2U7CiAgICAgIH0KICAgICAgcmV0dXJuIGRlY29kZUNvZGVQb2ludHNBcnJheShyZXMpOwogICAgfQogICAgY29uc3QgTUFYX0FSR1VNRU5UU19MRU5HVEggPSA0MDk2OwogICAgZnVuY3Rpb24gZGVjb2RlQ29kZVBvaW50c0FycmF5KGNvZGVQb2ludHMpIHsKICAgICAgY29uc3QgbGVuMiA9IGNvZGVQb2ludHMubGVuZ3RoOwogICAgICBpZiAobGVuMiA8PSBNQVhfQVJHVU1FTlRTX0xFTkdUSCkgewogICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZywgY29kZVBvaW50cyk7CiAgICAgIH0KICAgICAgbGV0IHJlcyA9ICIiOwogICAgICBsZXQgaTIgPSAwOwogICAgICB3aGlsZSAoaTIgPCBsZW4yKSB7CiAgICAgICAgcmVzICs9IFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLCBjb2RlUG9pbnRzLnNsaWNlKGkyLCBpMiArPSBNQVhfQVJHVU1FTlRTX0xFTkdUSCkpOwogICAgICB9CiAgICAgIHJldHVybiByZXM7CiAgICB9CiAgICBmdW5jdGlvbiBhc2NpaVNsaWNlKGJ1Ziwgc3RhcnQsIGVuZCkgewogICAgICBsZXQgcmV0ID0gIiI7CiAgICAgIGVuZCA9IE1hdGgubWluKGJ1Zi5sZW5ndGgsIGVuZCk7CiAgICAgIGZvciAobGV0IGkyID0gc3RhcnQ7IGkyIDwgZW5kOyArK2kyKSB7CiAgICAgICAgcmV0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnVmW2kyXSAmIDEyNyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJldDsKICAgIH0KICAgIGZ1bmN0aW9uIGxhdGluMVNsaWNlKGJ1Ziwgc3RhcnQsIGVuZCkgewogICAgICBsZXQgcmV0ID0gIiI7CiAgICAgIGVuZCA9IE1hdGgubWluKGJ1Zi5sZW5ndGgsIGVuZCk7CiAgICAgIGZvciAobGV0IGkyID0gc3RhcnQ7IGkyIDwgZW5kOyArK2kyKSB7CiAgICAgICAgcmV0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnVmW2kyXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJldDsKICAgIH0KICAgIGZ1bmN0aW9uIGhleFNsaWNlKGJ1Ziwgc3RhcnQsIGVuZCkgewogICAgICBjb25zdCBsZW4yID0gYnVmLmxlbmd0aDsKICAgICAgaWYgKCFzdGFydCB8fCBzdGFydCA8IDApCiAgICAgICAgc3RhcnQgPSAwOwogICAgICBpZiAoIWVuZCB8fCBlbmQgPCAwIHx8IGVuZCA+IGxlbjIpCiAgICAgICAgZW5kID0gbGVuMjsKICAgICAgbGV0IG91dCA9ICIiOwogICAgICBmb3IgKGxldCBpMiA9IHN0YXJ0OyBpMiA8IGVuZDsgKytpMikgewogICAgICAgIG91dCArPSBoZXhTbGljZUxvb2t1cFRhYmxlW2J1ZltpMl1dOwogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICBmdW5jdGlvbiB1dGYxNmxlU2xpY2UoYnVmLCBzdGFydCwgZW5kKSB7CiAgICAgIGNvbnN0IGJ5dGVzID0gYnVmLnNsaWNlKHN0YXJ0LCBlbmQpOwogICAgICBsZXQgcmVzID0gIiI7CiAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBieXRlcy5sZW5ndGggLSAxOyBpMiArPSAyKSB7CiAgICAgICAgcmVzICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnl0ZXNbaTJdICsgYnl0ZXNbaTIgKyAxXSAqIDI1Nik7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlczsKICAgIH0KICAgIEJ1ZmZlcjIucHJvdG90eXBlLnNsaWNlID0gZnVuY3Rpb24gc2xpY2UyKHN0YXJ0LCBlbmQpIHsKICAgICAgY29uc3QgbGVuMiA9IHRoaXMubGVuZ3RoOwogICAgICBzdGFydCA9IH5+c3RhcnQ7CiAgICAgIGVuZCA9IGVuZCA9PT0gdm9pZCAwID8gbGVuMiA6IH5+ZW5kOwogICAgICBpZiAoc3RhcnQgPCAwKSB7CiAgICAgICAgc3RhcnQgKz0gbGVuMjsKICAgICAgICBpZiAoc3RhcnQgPCAwKQogICAgICAgICAgc3RhcnQgPSAwOwogICAgICB9IGVsc2UgaWYgKHN0YXJ0ID4gbGVuMikgewogICAgICAgIHN0YXJ0ID0gbGVuMjsKICAgICAgfQogICAgICBpZiAoZW5kIDwgMCkgewogICAgICAgIGVuZCArPSBsZW4yOwogICAgICAgIGlmIChlbmQgPCAwKQogICAgICAgICAgZW5kID0gMDsKICAgICAgfSBlbHNlIGlmIChlbmQgPiBsZW4yKSB7CiAgICAgICAgZW5kID0gbGVuMjsKICAgICAgfQogICAgICBpZiAoZW5kIDwgc3RhcnQpCiAgICAgICAgZW5kID0gc3RhcnQ7CiAgICAgIGNvbnN0IG5ld0J1ZiA9IHRoaXMuc3ViYXJyYXkoc3RhcnQsIGVuZCk7CiAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihuZXdCdWYsIEJ1ZmZlcjIucHJvdG90eXBlKTsKICAgICAgcmV0dXJuIG5ld0J1ZjsKICAgIH07CiAgICBmdW5jdGlvbiBjaGVja09mZnNldChvZmZzZXQsIGV4dCwgbGVuZ3RoKSB7CiAgICAgIGlmIChvZmZzZXQgJSAxICE9PSAwIHx8IG9mZnNldCA8IDApCiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm9mZnNldCBpcyBub3QgdWludCIpOwogICAgICBpZiAob2Zmc2V0ICsgZXh0ID4gbGVuZ3RoKQogICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJUcnlpbmcgdG8gYWNjZXNzIGJleW9uZCBidWZmZXIgbGVuZ3RoIik7CiAgICB9CiAgICBCdWZmZXIyLnByb3RvdHlwZS5yZWFkVWludExFID0gQnVmZmVyMi5wcm90b3R5cGUucmVhZFVJbnRMRSA9IGZ1bmN0aW9uIHJlYWRVSW50TEUob2Zmc2V0LCBieXRlTGVuZ3RoMywgbm9Bc3NlcnQpIHsKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICBieXRlTGVuZ3RoMyA9IGJ5dGVMZW5ndGgzID4+PiAwOwogICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aDMsIHRoaXMubGVuZ3RoKTsKICAgICAgbGV0IHZhbCA9IHRoaXNbb2Zmc2V0XTsKICAgICAgbGV0IG11bCA9IDE7CiAgICAgIGxldCBpMiA9IDA7CiAgICAgIHdoaWxlICgrK2kyIDwgYnl0ZUxlbmd0aDMgJiYgKG11bCAqPSAyNTYpKSB7CiAgICAgICAgdmFsICs9IHRoaXNbb2Zmc2V0ICsgaTJdICogbXVsOwogICAgICB9CiAgICAgIHJldHVybiB2YWw7CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUucmVhZFVpbnRCRSA9IEJ1ZmZlcjIucHJvdG90eXBlLnJlYWRVSW50QkUgPSBmdW5jdGlvbiByZWFkVUludEJFKG9mZnNldCwgYnl0ZUxlbmd0aDMsIG5vQXNzZXJ0KSB7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgYnl0ZUxlbmd0aDMgPSBieXRlTGVuZ3RoMyA+Pj4gMDsKICAgICAgaWYgKCFub0Fzc2VydCkgewogICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgYnl0ZUxlbmd0aDMsIHRoaXMubGVuZ3RoKTsKICAgICAgfQogICAgICBsZXQgdmFsID0gdGhpc1tvZmZzZXQgKyAtLWJ5dGVMZW5ndGgzXTsKICAgICAgbGV0IG11bCA9IDE7CiAgICAgIHdoaWxlIChieXRlTGVuZ3RoMyA+IDAgJiYgKG11bCAqPSAyNTYpKSB7CiAgICAgICAgdmFsICs9IHRoaXNbb2Zmc2V0ICsgLS1ieXRlTGVuZ3RoM10gKiBtdWw7CiAgICAgIH0KICAgICAgcmV0dXJuIHZhbDsKICAgIH07CiAgICBCdWZmZXIyLnByb3RvdHlwZS5yZWFkVWludDggPSBCdWZmZXIyLnByb3RvdHlwZS5yZWFkVUludDggPSBmdW5jdGlvbiByZWFkVUludDgob2Zmc2V0LCBub0Fzc2VydCkgewogICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCAxLCB0aGlzLmxlbmd0aCk7CiAgICAgIHJldHVybiB0aGlzW29mZnNldF07CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUucmVhZFVpbnQxNkxFID0gQnVmZmVyMi5wcm90b3R5cGUucmVhZFVJbnQxNkxFID0gZnVuY3Rpb24gcmVhZFVJbnQxNkxFKG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgMiwgdGhpcy5sZW5ndGgpOwogICAgICByZXR1cm4gdGhpc1tvZmZzZXRdIHwgdGhpc1tvZmZzZXQgKyAxXSA8PCA4OwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLnJlYWRVaW50MTZCRSA9IEJ1ZmZlcjIucHJvdG90eXBlLnJlYWRVSW50MTZCRSA9IGZ1bmN0aW9uIHJlYWRVSW50MTZCRShvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDIsIHRoaXMubGVuZ3RoKTsKICAgICAgcmV0dXJuIHRoaXNbb2Zmc2V0XSA8PCA4IHwgdGhpc1tvZmZzZXQgKyAxXTsKICAgIH07CiAgICBCdWZmZXIyLnByb3RvdHlwZS5yZWFkVWludDMyTEUgPSBCdWZmZXIyLnByb3RvdHlwZS5yZWFkVUludDMyTEUgPSBmdW5jdGlvbiByZWFkVUludDMyTEUob2Zmc2V0LCBub0Fzc2VydCkgewogICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCA0LCB0aGlzLmxlbmd0aCk7CiAgICAgIHJldHVybiAodGhpc1tvZmZzZXRdIHwgdGhpc1tvZmZzZXQgKyAxXSA8PCA4IHwgdGhpc1tvZmZzZXQgKyAyXSA8PCAxNikgKyB0aGlzW29mZnNldCArIDNdICogMTY3NzcyMTY7CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUucmVhZFVpbnQzMkJFID0gQnVmZmVyMi5wcm90b3R5cGUucmVhZFVJbnQzMkJFID0gZnVuY3Rpb24gcmVhZFVJbnQzMkJFKG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpOwogICAgICByZXR1cm4gdGhpc1tvZmZzZXRdICogMTY3NzcyMTYgKyAodGhpc1tvZmZzZXQgKyAxXSA8PCAxNiB8IHRoaXNbb2Zmc2V0ICsgMl0gPDwgOCB8IHRoaXNbb2Zmc2V0ICsgM10pOwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLnJlYWRCaWdVSW50NjRMRSA9IGRlZmluZUJpZ0ludE1ldGhvZChmdW5jdGlvbiByZWFkQmlnVUludDY0TEUob2Zmc2V0KSB7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgdmFsaWRhdGVOdW1iZXIob2Zmc2V0LCAib2Zmc2V0Iik7CiAgICAgIGNvbnN0IGZpcnN0ID0gdGhpc1tvZmZzZXRdOwogICAgICBjb25zdCBsYXN0MiA9IHRoaXNbb2Zmc2V0ICsgN107CiAgICAgIGlmIChmaXJzdCA9PT0gdm9pZCAwIHx8IGxhc3QyID09PSB2b2lkIDApIHsKICAgICAgICBib3VuZHNFcnJvcihvZmZzZXQsIHRoaXMubGVuZ3RoIC0gOCk7CiAgICAgIH0KICAgICAgY29uc3QgbG8gPSBmaXJzdCArIHRoaXNbKytvZmZzZXRdICogMiAqKiA4ICsgdGhpc1srK29mZnNldF0gKiAyICoqIDE2ICsgdGhpc1srK29mZnNldF0gKiAyICoqIDI0OwogICAgICBjb25zdCBoaSA9IHRoaXNbKytvZmZzZXRdICsgdGhpc1srK29mZnNldF0gKiAyICoqIDggKyB0aGlzWysrb2Zmc2V0XSAqIDIgKiogMTYgKyBsYXN0MiAqIDIgKiogMjQ7CiAgICAgIHJldHVybiBCaWdJbnQobG8pICsgKEJpZ0ludChoaSkgPDwgQmlnSW50KDMyKSk7CiAgICB9KTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLnJlYWRCaWdVSW50NjRCRSA9IGRlZmluZUJpZ0ludE1ldGhvZChmdW5jdGlvbiByZWFkQmlnVUludDY0QkUob2Zmc2V0KSB7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgdmFsaWRhdGVOdW1iZXIob2Zmc2V0LCAib2Zmc2V0Iik7CiAgICAgIGNvbnN0IGZpcnN0ID0gdGhpc1tvZmZzZXRdOwogICAgICBjb25zdCBsYXN0MiA9IHRoaXNbb2Zmc2V0ICsgN107CiAgICAgIGlmIChmaXJzdCA9PT0gdm9pZCAwIHx8IGxhc3QyID09PSB2b2lkIDApIHsKICAgICAgICBib3VuZHNFcnJvcihvZmZzZXQsIHRoaXMubGVuZ3RoIC0gOCk7CiAgICAgIH0KICAgICAgY29uc3QgaGkgPSBmaXJzdCAqIDIgKiogMjQgKyB0aGlzWysrb2Zmc2V0XSAqIDIgKiogMTYgKyB0aGlzWysrb2Zmc2V0XSAqIDIgKiogOCArIHRoaXNbKytvZmZzZXRdOwogICAgICBjb25zdCBsbyA9IHRoaXNbKytvZmZzZXRdICogMiAqKiAyNCArIHRoaXNbKytvZmZzZXRdICogMiAqKiAxNiArIHRoaXNbKytvZmZzZXRdICogMiAqKiA4ICsgbGFzdDI7CiAgICAgIHJldHVybiAoQmlnSW50KGhpKSA8PCBCaWdJbnQoMzIpKSArIEJpZ0ludChsbyk7CiAgICB9KTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLnJlYWRJbnRMRSA9IGZ1bmN0aW9uIHJlYWRJbnRMRShvZmZzZXQsIGJ5dGVMZW5ndGgzLCBub0Fzc2VydCkgewogICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgIGJ5dGVMZW5ndGgzID0gYnl0ZUxlbmd0aDMgPj4+IDA7CiAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCBieXRlTGVuZ3RoMywgdGhpcy5sZW5ndGgpOwogICAgICBsZXQgdmFsID0gdGhpc1tvZmZzZXRdOwogICAgICBsZXQgbXVsID0gMTsKICAgICAgbGV0IGkyID0gMDsKICAgICAgd2hpbGUgKCsraTIgPCBieXRlTGVuZ3RoMyAmJiAobXVsICo9IDI1NikpIHsKICAgICAgICB2YWwgKz0gdGhpc1tvZmZzZXQgKyBpMl0gKiBtdWw7CiAgICAgIH0KICAgICAgbXVsICo9IDEyODsKICAgICAgaWYgKHZhbCA+PSBtdWwpCiAgICAgICAgdmFsIC09IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoMyk7CiAgICAgIHJldHVybiB2YWw7CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUucmVhZEludEJFID0gZnVuY3Rpb24gcmVhZEludEJFKG9mZnNldCwgYnl0ZUxlbmd0aDMsIG5vQXNzZXJ0KSB7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgYnl0ZUxlbmd0aDMgPSBieXRlTGVuZ3RoMyA+Pj4gMDsKICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIGJ5dGVMZW5ndGgzLCB0aGlzLmxlbmd0aCk7CiAgICAgIGxldCBpMiA9IGJ5dGVMZW5ndGgzOwogICAgICBsZXQgbXVsID0gMTsKICAgICAgbGV0IHZhbCA9IHRoaXNbb2Zmc2V0ICsgLS1pMl07CiAgICAgIHdoaWxlIChpMiA+IDAgJiYgKG11bCAqPSAyNTYpKSB7CiAgICAgICAgdmFsICs9IHRoaXNbb2Zmc2V0ICsgLS1pMl0gKiBtdWw7CiAgICAgIH0KICAgICAgbXVsICo9IDEyODsKICAgICAgaWYgKHZhbCA+PSBtdWwpCiAgICAgICAgdmFsIC09IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoMyk7CiAgICAgIHJldHVybiB2YWw7CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUucmVhZEludDggPSBmdW5jdGlvbiByZWFkSW50OChvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDEsIHRoaXMubGVuZ3RoKTsKICAgICAgaWYgKCEodGhpc1tvZmZzZXRdICYgMTI4KSkKICAgICAgICByZXR1cm4gdGhpc1tvZmZzZXRdOwogICAgICByZXR1cm4gKDI1NSAtIHRoaXNbb2Zmc2V0XSArIDEpICogLTE7CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUucmVhZEludDE2TEUgPSBmdW5jdGlvbiByZWFkSW50MTZMRShvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDIsIHRoaXMubGVuZ3RoKTsKICAgICAgY29uc3QgdmFsID0gdGhpc1tvZmZzZXRdIHwgdGhpc1tvZmZzZXQgKyAxXSA8PCA4OwogICAgICByZXR1cm4gdmFsICYgMzI3NjggPyB2YWwgfCA0Mjk0OTAxNzYwIDogdmFsOwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLnJlYWRJbnQxNkJFID0gZnVuY3Rpb24gcmVhZEludDE2QkUob2Zmc2V0LCBub0Fzc2VydCkgewogICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCAyLCB0aGlzLmxlbmd0aCk7CiAgICAgIGNvbnN0IHZhbCA9IHRoaXNbb2Zmc2V0ICsgMV0gfCB0aGlzW29mZnNldF0gPDwgODsKICAgICAgcmV0dXJuIHZhbCAmIDMyNzY4ID8gdmFsIHwgNDI5NDkwMTc2MCA6IHZhbDsKICAgIH07CiAgICBCdWZmZXIyLnByb3RvdHlwZS5yZWFkSW50MzJMRSA9IGZ1bmN0aW9uIHJlYWRJbnQzMkxFKG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgNCwgdGhpcy5sZW5ndGgpOwogICAgICByZXR1cm4gdGhpc1tvZmZzZXRdIHwgdGhpc1tvZmZzZXQgKyAxXSA8PCA4IHwgdGhpc1tvZmZzZXQgKyAyXSA8PCAxNiB8IHRoaXNbb2Zmc2V0ICsgM10gPDwgMjQ7CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUucmVhZEludDMyQkUgPSBmdW5jdGlvbiByZWFkSW50MzJCRShvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDQsIHRoaXMubGVuZ3RoKTsKICAgICAgcmV0dXJuIHRoaXNbb2Zmc2V0XSA8PCAyNCB8IHRoaXNbb2Zmc2V0ICsgMV0gPDwgMTYgfCB0aGlzW29mZnNldCArIDJdIDw8IDggfCB0aGlzW29mZnNldCArIDNdOwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLnJlYWRCaWdJbnQ2NExFID0gZGVmaW5lQmlnSW50TWV0aG9kKGZ1bmN0aW9uIHJlYWRCaWdJbnQ2NExFKG9mZnNldCkgewogICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgIHZhbGlkYXRlTnVtYmVyKG9mZnNldCwgIm9mZnNldCIpOwogICAgICBjb25zdCBmaXJzdCA9IHRoaXNbb2Zmc2V0XTsKICAgICAgY29uc3QgbGFzdDIgPSB0aGlzW29mZnNldCArIDddOwogICAgICBpZiAoZmlyc3QgPT09IHZvaWQgMCB8fCBsYXN0MiA9PT0gdm9pZCAwKSB7CiAgICAgICAgYm91bmRzRXJyb3Iob2Zmc2V0LCB0aGlzLmxlbmd0aCAtIDgpOwogICAgICB9CiAgICAgIGNvbnN0IHZhbCA9IHRoaXNbb2Zmc2V0ICsgNF0gKyB0aGlzW29mZnNldCArIDVdICogMiAqKiA4ICsgdGhpc1tvZmZzZXQgKyA2XSAqIDIgKiogMTYgKyAobGFzdDIgPDwgMjQpOwogICAgICByZXR1cm4gKEJpZ0ludCh2YWwpIDw8IEJpZ0ludCgzMikpICsgQmlnSW50KGZpcnN0ICsgdGhpc1srK29mZnNldF0gKiAyICoqIDggKyB0aGlzWysrb2Zmc2V0XSAqIDIgKiogMTYgKyB0aGlzWysrb2Zmc2V0XSAqIDIgKiogMjQpOwogICAgfSk7CiAgICBCdWZmZXIyLnByb3RvdHlwZS5yZWFkQmlnSW50NjRCRSA9IGRlZmluZUJpZ0ludE1ldGhvZChmdW5jdGlvbiByZWFkQmlnSW50NjRCRShvZmZzZXQpIHsKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICB2YWxpZGF0ZU51bWJlcihvZmZzZXQsICJvZmZzZXQiKTsKICAgICAgY29uc3QgZmlyc3QgPSB0aGlzW29mZnNldF07CiAgICAgIGNvbnN0IGxhc3QyID0gdGhpc1tvZmZzZXQgKyA3XTsKICAgICAgaWYgKGZpcnN0ID09PSB2b2lkIDAgfHwgbGFzdDIgPT09IHZvaWQgMCkgewogICAgICAgIGJvdW5kc0Vycm9yKG9mZnNldCwgdGhpcy5sZW5ndGggLSA4KTsKICAgICAgfQogICAgICBjb25zdCB2YWwgPSAoZmlyc3QgPDwgMjQpICsgdGhpc1srK29mZnNldF0gKiAyICoqIDE2ICsgdGhpc1srK29mZnNldF0gKiAyICoqIDggKyB0aGlzWysrb2Zmc2V0XTsKICAgICAgcmV0dXJuIChCaWdJbnQodmFsKSA8PCBCaWdJbnQoMzIpKSArIEJpZ0ludCh0aGlzWysrb2Zmc2V0XSAqIDIgKiogMjQgKyB0aGlzWysrb2Zmc2V0XSAqIDIgKiogMTYgKyB0aGlzWysrb2Zmc2V0XSAqIDIgKiogOCArIGxhc3QyKTsKICAgIH0pOwogICAgQnVmZmVyMi5wcm90b3R5cGUucmVhZEZsb2F0TEUgPSBmdW5jdGlvbiByZWFkRmxvYXRMRShvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICBjaGVja09mZnNldChvZmZzZXQsIDQsIHRoaXMubGVuZ3RoKTsKICAgICAgcmV0dXJuIGllZWU3NTQkMS5yZWFkKHRoaXMsIG9mZnNldCwgdHJ1ZSwgMjMsIDQpOwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLnJlYWRGbG9hdEJFID0gZnVuY3Rpb24gcmVhZEZsb2F0QkUob2Zmc2V0LCBub0Fzc2VydCkgewogICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgY2hlY2tPZmZzZXQob2Zmc2V0LCA0LCB0aGlzLmxlbmd0aCk7CiAgICAgIHJldHVybiBpZWVlNzU0JDEucmVhZCh0aGlzLCBvZmZzZXQsIGZhbHNlLCAyMywgNCk7CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUucmVhZERvdWJsZUxFID0gZnVuY3Rpb24gcmVhZERvdWJsZUxFKG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgOCwgdGhpcy5sZW5ndGgpOwogICAgICByZXR1cm4gaWVlZTc1NCQxLnJlYWQodGhpcywgb2Zmc2V0LCB0cnVlLCA1MiwgOCk7CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUucmVhZERvdWJsZUJFID0gZnVuY3Rpb24gcmVhZERvdWJsZUJFKG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgIGNoZWNrT2Zmc2V0KG9mZnNldCwgOCwgdGhpcy5sZW5ndGgpOwogICAgICByZXR1cm4gaWVlZTc1NCQxLnJlYWQodGhpcywgb2Zmc2V0LCBmYWxzZSwgNTIsIDgpOwogICAgfTsKICAgIGZ1bmN0aW9uIGNoZWNrSW50KGJ1ZiwgdmFsdWUsIG9mZnNldCwgZXh0LCBtYXgyLCBtaW4yKSB7CiAgICAgIGlmICghQnVmZmVyMi5pc0J1ZmZlcihidWYpKQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJyJidWZmZXIiIGFyZ3VtZW50IG11c3QgYmUgYSBCdWZmZXIgaW5zdGFuY2UnKTsKICAgICAgaWYgKHZhbHVlID4gbWF4MiB8fCB2YWx1ZSA8IG1pbjIpCiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJyJ2YWx1ZSIgYXJndW1lbnQgaXMgb3V0IG9mIGJvdW5kcycpOwogICAgICBpZiAob2Zmc2V0ICsgZXh0ID4gYnVmLmxlbmd0aCkKICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiSW5kZXggb3V0IG9mIHJhbmdlIik7CiAgICB9CiAgICBCdWZmZXIyLnByb3RvdHlwZS53cml0ZVVpbnRMRSA9IEJ1ZmZlcjIucHJvdG90eXBlLndyaXRlVUludExFID0gZnVuY3Rpb24gd3JpdGVVSW50TEUodmFsdWUsIG9mZnNldCwgYnl0ZUxlbmd0aDMsIG5vQXNzZXJ0KSB7CiAgICAgIHZhbHVlID0gK3ZhbHVlOwogICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgIGJ5dGVMZW5ndGgzID0gYnl0ZUxlbmd0aDMgPj4+IDA7CiAgICAgIGlmICghbm9Bc3NlcnQpIHsKICAgICAgICBjb25zdCBtYXhCeXRlcyA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoMykgLSAxOwogICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgzLCBtYXhCeXRlcywgMCk7CiAgICAgIH0KICAgICAgbGV0IG11bCA9IDE7CiAgICAgIGxldCBpMiA9IDA7CiAgICAgIHRoaXNbb2Zmc2V0XSA9IHZhbHVlICYgMjU1OwogICAgICB3aGlsZSAoKytpMiA8IGJ5dGVMZW5ndGgzICYmIChtdWwgKj0gMjU2KSkgewogICAgICAgIHRoaXNbb2Zmc2V0ICsgaTJdID0gdmFsdWUgLyBtdWwgJiAyNTU7CiAgICAgIH0KICAgICAgcmV0dXJuIG9mZnNldCArIGJ5dGVMZW5ndGgzOwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLndyaXRlVWludEJFID0gQnVmZmVyMi5wcm90b3R5cGUud3JpdGVVSW50QkUgPSBmdW5jdGlvbiB3cml0ZVVJbnRCRSh2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoMywgbm9Bc3NlcnQpIHsKICAgICAgdmFsdWUgPSArdmFsdWU7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgYnl0ZUxlbmd0aDMgPSBieXRlTGVuZ3RoMyA+Pj4gMDsKICAgICAgaWYgKCFub0Fzc2VydCkgewogICAgICAgIGNvbnN0IG1heEJ5dGVzID0gTWF0aC5wb3coMiwgOCAqIGJ5dGVMZW5ndGgzKSAtIDE7CiAgICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgYnl0ZUxlbmd0aDMsIG1heEJ5dGVzLCAwKTsKICAgICAgfQogICAgICBsZXQgaTIgPSBieXRlTGVuZ3RoMyAtIDE7CiAgICAgIGxldCBtdWwgPSAxOwogICAgICB0aGlzW29mZnNldCArIGkyXSA9IHZhbHVlICYgMjU1OwogICAgICB3aGlsZSAoLS1pMiA+PSAwICYmIChtdWwgKj0gMjU2KSkgewogICAgICAgIHRoaXNbb2Zmc2V0ICsgaTJdID0gdmFsdWUgLyBtdWwgJiAyNTU7CiAgICAgIH0KICAgICAgcmV0dXJuIG9mZnNldCArIGJ5dGVMZW5ndGgzOwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLndyaXRlVWludDggPSBCdWZmZXIyLnByb3RvdHlwZS53cml0ZVVJbnQ4ID0gZnVuY3Rpb24gd3JpdGVVSW50OCh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogICAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDEsIDI1NSwgMCk7CiAgICAgIHRoaXNbb2Zmc2V0XSA9IHZhbHVlICYgMjU1OwogICAgICByZXR1cm4gb2Zmc2V0ICsgMTsKICAgIH07CiAgICBCdWZmZXIyLnByb3RvdHlwZS53cml0ZVVpbnQxNkxFID0gQnVmZmVyMi5wcm90b3R5cGUud3JpdGVVSW50MTZMRSA9IGZ1bmN0aW9uIHdyaXRlVUludDE2TEUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgdmFsdWUgPSArdmFsdWU7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCAyLCA2NTUzNSwgMCk7CiAgICAgIHRoaXNbb2Zmc2V0XSA9IHZhbHVlICYgMjU1OwogICAgICB0aGlzW29mZnNldCArIDFdID0gdmFsdWUgPj4+IDg7CiAgICAgIHJldHVybiBvZmZzZXQgKyAyOwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLndyaXRlVWludDE2QkUgPSBCdWZmZXIyLnByb3RvdHlwZS53cml0ZVVJbnQxNkJFID0gZnVuY3Rpb24gd3JpdGVVSW50MTZCRSh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogICAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDIsIDY1NTM1LCAwKTsKICAgICAgdGhpc1tvZmZzZXRdID0gdmFsdWUgPj4+IDg7CiAgICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSB2YWx1ZSAmIDI1NTsKICAgICAgcmV0dXJuIG9mZnNldCArIDI7CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUud3JpdGVVaW50MzJMRSA9IEJ1ZmZlcjIucHJvdG90eXBlLndyaXRlVUludDMyTEUgPSBmdW5jdGlvbiB3cml0ZVVJbnQzMkxFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgIHZhbHVlID0gK3ZhbHVlOwogICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgNCwgNDI5NDk2NzI5NSwgMCk7CiAgICAgIHRoaXNbb2Zmc2V0ICsgM10gPSB2YWx1ZSA+Pj4gMjQ7CiAgICAgIHRoaXNbb2Zmc2V0ICsgMl0gPSB2YWx1ZSA+Pj4gMTY7CiAgICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSB2YWx1ZSA+Pj4gODsKICAgICAgdGhpc1tvZmZzZXRdID0gdmFsdWUgJiAyNTU7CiAgICAgIHJldHVybiBvZmZzZXQgKyA0OwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLndyaXRlVWludDMyQkUgPSBCdWZmZXIyLnByb3RvdHlwZS53cml0ZVVJbnQzMkJFID0gZnVuY3Rpb24gd3JpdGVVSW50MzJCRSh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogICAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDQsIDQyOTQ5NjcyOTUsIDApOwogICAgICB0aGlzW29mZnNldF0gPSB2YWx1ZSA+Pj4gMjQ7CiAgICAgIHRoaXNbb2Zmc2V0ICsgMV0gPSB2YWx1ZSA+Pj4gMTY7CiAgICAgIHRoaXNbb2Zmc2V0ICsgMl0gPSB2YWx1ZSA+Pj4gODsKICAgICAgdGhpc1tvZmZzZXQgKyAzXSA9IHZhbHVlICYgMjU1OwogICAgICByZXR1cm4gb2Zmc2V0ICsgNDsKICAgIH07CiAgICBmdW5jdGlvbiB3cnRCaWdVSW50NjRMRShidWYsIHZhbHVlLCBvZmZzZXQsIG1pbjIsIG1heDIpIHsKICAgICAgY2hlY2tJbnRCSSh2YWx1ZSwgbWluMiwgbWF4MiwgYnVmLCBvZmZzZXQsIDcpOwogICAgICBsZXQgbG8gPSBOdW1iZXIodmFsdWUgJiBCaWdJbnQoNDI5NDk2NzI5NSkpOwogICAgICBidWZbb2Zmc2V0KytdID0gbG87CiAgICAgIGxvID0gbG8gPj4gODsKICAgICAgYnVmW29mZnNldCsrXSA9IGxvOwogICAgICBsbyA9IGxvID4+IDg7CiAgICAgIGJ1ZltvZmZzZXQrK10gPSBsbzsKICAgICAgbG8gPSBsbyA+PiA4OwogICAgICBidWZbb2Zmc2V0KytdID0gbG87CiAgICAgIGxldCBoaSA9IE51bWJlcih2YWx1ZSA+PiBCaWdJbnQoMzIpICYgQmlnSW50KDQyOTQ5NjcyOTUpKTsKICAgICAgYnVmW29mZnNldCsrXSA9IGhpOwogICAgICBoaSA9IGhpID4+IDg7CiAgICAgIGJ1ZltvZmZzZXQrK10gPSBoaTsKICAgICAgaGkgPSBoaSA+PiA4OwogICAgICBidWZbb2Zmc2V0KytdID0gaGk7CiAgICAgIGhpID0gaGkgPj4gODsKICAgICAgYnVmW29mZnNldCsrXSA9IGhpOwogICAgICByZXR1cm4gb2Zmc2V0OwogICAgfQogICAgZnVuY3Rpb24gd3J0QmlnVUludDY0QkUoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBtaW4yLCBtYXgyKSB7CiAgICAgIGNoZWNrSW50QkkodmFsdWUsIG1pbjIsIG1heDIsIGJ1Ziwgb2Zmc2V0LCA3KTsKICAgICAgbGV0IGxvID0gTnVtYmVyKHZhbHVlICYgQmlnSW50KDQyOTQ5NjcyOTUpKTsKICAgICAgYnVmW29mZnNldCArIDddID0gbG87CiAgICAgIGxvID0gbG8gPj4gODsKICAgICAgYnVmW29mZnNldCArIDZdID0gbG87CiAgICAgIGxvID0gbG8gPj4gODsKICAgICAgYnVmW29mZnNldCArIDVdID0gbG87CiAgICAgIGxvID0gbG8gPj4gODsKICAgICAgYnVmW29mZnNldCArIDRdID0gbG87CiAgICAgIGxldCBoaSA9IE51bWJlcih2YWx1ZSA+PiBCaWdJbnQoMzIpICYgQmlnSW50KDQyOTQ5NjcyOTUpKTsKICAgICAgYnVmW29mZnNldCArIDNdID0gaGk7CiAgICAgIGhpID0gaGkgPj4gODsKICAgICAgYnVmW29mZnNldCArIDJdID0gaGk7CiAgICAgIGhpID0gaGkgPj4gODsKICAgICAgYnVmW29mZnNldCArIDFdID0gaGk7CiAgICAgIGhpID0gaGkgPj4gODsKICAgICAgYnVmW29mZnNldF0gPSBoaTsKICAgICAgcmV0dXJuIG9mZnNldCArIDg7CiAgICB9CiAgICBCdWZmZXIyLnByb3RvdHlwZS53cml0ZUJpZ1VJbnQ2NExFID0gZGVmaW5lQmlnSW50TWV0aG9kKGZ1bmN0aW9uIHdyaXRlQmlnVUludDY0TEUodmFsdWUsIG9mZnNldCA9IDApIHsKICAgICAgcmV0dXJuIHdydEJpZ1VJbnQ2NExFKHRoaXMsIHZhbHVlLCBvZmZzZXQsIEJpZ0ludCgwKSwgQmlnSW50KCIweGZmZmZmZmZmZmZmZmZmZmYiKSk7CiAgICB9KTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLndyaXRlQmlnVUludDY0QkUgPSBkZWZpbmVCaWdJbnRNZXRob2QoZnVuY3Rpb24gd3JpdGVCaWdVSW50NjRCRSh2YWx1ZSwgb2Zmc2V0ID0gMCkgewogICAgICByZXR1cm4gd3J0QmlnVUludDY0QkUodGhpcywgdmFsdWUsIG9mZnNldCwgQmlnSW50KDApLCBCaWdJbnQoIjB4ZmZmZmZmZmZmZmZmZmZmZiIpKTsKICAgIH0pOwogICAgQnVmZmVyMi5wcm90b3R5cGUud3JpdGVJbnRMRSA9IGZ1bmN0aW9uIHdyaXRlSW50TEUodmFsdWUsIG9mZnNldCwgYnl0ZUxlbmd0aDMsIG5vQXNzZXJ0KSB7CiAgICAgIHZhbHVlID0gK3ZhbHVlOwogICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgIGlmICghbm9Bc3NlcnQpIHsKICAgICAgICBjb25zdCBsaW1pdCA9IE1hdGgucG93KDIsIDggKiBieXRlTGVuZ3RoMyAtIDEpOwogICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIGJ5dGVMZW5ndGgzLCBsaW1pdCAtIDEsIC1saW1pdCk7CiAgICAgIH0KICAgICAgbGV0IGkyID0gMDsKICAgICAgbGV0IG11bCA9IDE7CiAgICAgIGxldCBzdWIgPSAwOwogICAgICB0aGlzW29mZnNldF0gPSB2YWx1ZSAmIDI1NTsKICAgICAgd2hpbGUgKCsraTIgPCBieXRlTGVuZ3RoMyAmJiAobXVsICo9IDI1NikpIHsKICAgICAgICBpZiAodmFsdWUgPCAwICYmIHN1YiA9PT0gMCAmJiB0aGlzW29mZnNldCArIGkyIC0gMV0gIT09IDApIHsKICAgICAgICAgIHN1YiA9IDE7CiAgICAgICAgfQogICAgICAgIHRoaXNbb2Zmc2V0ICsgaTJdID0gKHZhbHVlIC8gbXVsID4+IDApIC0gc3ViICYgMjU1OwogICAgICB9CiAgICAgIHJldHVybiBvZmZzZXQgKyBieXRlTGVuZ3RoMzsKICAgIH07CiAgICBCdWZmZXIyLnByb3RvdHlwZS53cml0ZUludEJFID0gZnVuY3Rpb24gd3JpdGVJbnRCRSh2YWx1ZSwgb2Zmc2V0LCBieXRlTGVuZ3RoMywgbm9Bc3NlcnQpIHsKICAgICAgdmFsdWUgPSArdmFsdWU7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgaWYgKCFub0Fzc2VydCkgewogICAgICAgIGNvbnN0IGxpbWl0ID0gTWF0aC5wb3coMiwgOCAqIGJ5dGVMZW5ndGgzIC0gMSk7CiAgICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgYnl0ZUxlbmd0aDMsIGxpbWl0IC0gMSwgLWxpbWl0KTsKICAgICAgfQogICAgICBsZXQgaTIgPSBieXRlTGVuZ3RoMyAtIDE7CiAgICAgIGxldCBtdWwgPSAxOwogICAgICBsZXQgc3ViID0gMDsKICAgICAgdGhpc1tvZmZzZXQgKyBpMl0gPSB2YWx1ZSAmIDI1NTsKICAgICAgd2hpbGUgKC0taTIgPj0gMCAmJiAobXVsICo9IDI1NikpIHsKICAgICAgICBpZiAodmFsdWUgPCAwICYmIHN1YiA9PT0gMCAmJiB0aGlzW29mZnNldCArIGkyICsgMV0gIT09IDApIHsKICAgICAgICAgIHN1YiA9IDE7CiAgICAgICAgfQogICAgICAgIHRoaXNbb2Zmc2V0ICsgaTJdID0gKHZhbHVlIC8gbXVsID4+IDApIC0gc3ViICYgMjU1OwogICAgICB9CiAgICAgIHJldHVybiBvZmZzZXQgKyBieXRlTGVuZ3RoMzsKICAgIH07CiAgICBCdWZmZXIyLnByb3RvdHlwZS53cml0ZUludDggPSBmdW5jdGlvbiB3cml0ZUludDgodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgdmFsdWUgPSArdmFsdWU7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCAxLCAxMjcsIC0xMjgpOwogICAgICBpZiAodmFsdWUgPCAwKQogICAgICAgIHZhbHVlID0gMjU1ICsgdmFsdWUgKyAxOwogICAgICB0aGlzW29mZnNldF0gPSB2YWx1ZSAmIDI1NTsKICAgICAgcmV0dXJuIG9mZnNldCArIDE7CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUud3JpdGVJbnQxNkxFID0gZnVuY3Rpb24gd3JpdGVJbnQxNkxFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgIHZhbHVlID0gK3ZhbHVlOwogICAgICBvZmZzZXQgPSBvZmZzZXQgPj4+IDA7CiAgICAgIGlmICghbm9Bc3NlcnQpCiAgICAgICAgY2hlY2tJbnQodGhpcywgdmFsdWUsIG9mZnNldCwgMiwgMzI3NjcsIC0zMjc2OCk7CiAgICAgIHRoaXNbb2Zmc2V0XSA9IHZhbHVlICYgMjU1OwogICAgICB0aGlzW29mZnNldCArIDFdID0gdmFsdWUgPj4+IDg7CiAgICAgIHJldHVybiBvZmZzZXQgKyAyOwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLndyaXRlSW50MTZCRSA9IGZ1bmN0aW9uIHdyaXRlSW50MTZCRSh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogICAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDIsIDMyNzY3LCAtMzI3NjgpOwogICAgICB0aGlzW29mZnNldF0gPSB2YWx1ZSA+Pj4gODsKICAgICAgdGhpc1tvZmZzZXQgKyAxXSA9IHZhbHVlICYgMjU1OwogICAgICByZXR1cm4gb2Zmc2V0ICsgMjsKICAgIH07CiAgICBCdWZmZXIyLnByb3RvdHlwZS53cml0ZUludDMyTEUgPSBmdW5jdGlvbiB3cml0ZUludDMyTEUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgdmFsdWUgPSArdmFsdWU7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgaWYgKCFub0Fzc2VydCkKICAgICAgICBjaGVja0ludCh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCA0LCAyMTQ3NDgzNjQ3LCAtMjE0NzQ4MzY0OCk7CiAgICAgIHRoaXNbb2Zmc2V0XSA9IHZhbHVlICYgMjU1OwogICAgICB0aGlzW29mZnNldCArIDFdID0gdmFsdWUgPj4+IDg7CiAgICAgIHRoaXNbb2Zmc2V0ICsgMl0gPSB2YWx1ZSA+Pj4gMTY7CiAgICAgIHRoaXNbb2Zmc2V0ICsgM10gPSB2YWx1ZSA+Pj4gMjQ7CiAgICAgIHJldHVybiBvZmZzZXQgKyA0OwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLndyaXRlSW50MzJCRSA9IGZ1bmN0aW9uIHdyaXRlSW50MzJCRSh2YWx1ZSwgb2Zmc2V0LCBub0Fzc2VydCkgewogICAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICBpZiAoIW5vQXNzZXJ0KQogICAgICAgIGNoZWNrSW50KHRoaXMsIHZhbHVlLCBvZmZzZXQsIDQsIDIxNDc0ODM2NDcsIC0yMTQ3NDgzNjQ4KTsKICAgICAgaWYgKHZhbHVlIDwgMCkKICAgICAgICB2YWx1ZSA9IDQyOTQ5NjcyOTUgKyB2YWx1ZSArIDE7CiAgICAgIHRoaXNbb2Zmc2V0XSA9IHZhbHVlID4+PiAyNDsKICAgICAgdGhpc1tvZmZzZXQgKyAxXSA9IHZhbHVlID4+PiAxNjsKICAgICAgdGhpc1tvZmZzZXQgKyAyXSA9IHZhbHVlID4+PiA4OwogICAgICB0aGlzW29mZnNldCArIDNdID0gdmFsdWUgJiAyNTU7CiAgICAgIHJldHVybiBvZmZzZXQgKyA0OwogICAgfTsKICAgIEJ1ZmZlcjIucHJvdG90eXBlLndyaXRlQmlnSW50NjRMRSA9IGRlZmluZUJpZ0ludE1ldGhvZChmdW5jdGlvbiB3cml0ZUJpZ0ludDY0TEUodmFsdWUsIG9mZnNldCA9IDApIHsKICAgICAgcmV0dXJuIHdydEJpZ1VJbnQ2NExFKHRoaXMsIHZhbHVlLCBvZmZzZXQsIC1CaWdJbnQoIjB4ODAwMDAwMDAwMDAwMDAwMCIpLCBCaWdJbnQoIjB4N2ZmZmZmZmZmZmZmZmZmZiIpKTsKICAgIH0pOwogICAgQnVmZmVyMi5wcm90b3R5cGUud3JpdGVCaWdJbnQ2NEJFID0gZGVmaW5lQmlnSW50TWV0aG9kKGZ1bmN0aW9uIHdyaXRlQmlnSW50NjRCRSh2YWx1ZSwgb2Zmc2V0ID0gMCkgewogICAgICByZXR1cm4gd3J0QmlnVUludDY0QkUodGhpcywgdmFsdWUsIG9mZnNldCwgLUJpZ0ludCgiMHg4MDAwMDAwMDAwMDAwMDAwIiksIEJpZ0ludCgiMHg3ZmZmZmZmZmZmZmZmZmZmIikpOwogICAgfSk7CiAgICBmdW5jdGlvbiBjaGVja0lFRUU3NTQoYnVmLCB2YWx1ZSwgb2Zmc2V0LCBleHQsIG1heDIsIG1pbjIpIHsKICAgICAgaWYgKG9mZnNldCArIGV4dCA+IGJ1Zi5sZW5ndGgpCiAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkluZGV4IG91dCBvZiByYW5nZSIpOwogICAgICBpZiAob2Zmc2V0IDwgMCkKICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiSW5kZXggb3V0IG9mIHJhbmdlIik7CiAgICB9CiAgICBmdW5jdGlvbiB3cml0ZUZsb2F0KGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCBub0Fzc2VydCkgewogICAgICB2YWx1ZSA9ICt2YWx1ZTsKICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID4+PiAwOwogICAgICBpZiAoIW5vQXNzZXJ0KSB7CiAgICAgICAgY2hlY2tJRUVFNzU0KGJ1ZiwgdmFsdWUsIG9mZnNldCwgNCk7CiAgICAgIH0KICAgICAgaWVlZTc1NCQxLndyaXRlKGJ1ZiwgdmFsdWUsIG9mZnNldCwgbGl0dGxlRW5kaWFuLCAyMywgNCk7CiAgICAgIHJldHVybiBvZmZzZXQgKyA0OwogICAgfQogICAgQnVmZmVyMi5wcm90b3R5cGUud3JpdGVGbG9hdExFID0gZnVuY3Rpb24gd3JpdGVGbG9hdExFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgIHJldHVybiB3cml0ZUZsb2F0KHRoaXMsIHZhbHVlLCBvZmZzZXQsIHRydWUsIG5vQXNzZXJ0KTsKICAgIH07CiAgICBCdWZmZXIyLnByb3RvdHlwZS53cml0ZUZsb2F0QkUgPSBmdW5jdGlvbiB3cml0ZUZsb2F0QkUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgcmV0dXJuIHdyaXRlRmxvYXQodGhpcywgdmFsdWUsIG9mZnNldCwgZmFsc2UsIG5vQXNzZXJ0KTsKICAgIH07CiAgICBmdW5jdGlvbiB3cml0ZURvdWJsZShidWYsIHZhbHVlLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgbm9Bc3NlcnQpIHsKICAgICAgdmFsdWUgPSArdmFsdWU7CiAgICAgIG9mZnNldCA9IG9mZnNldCA+Pj4gMDsKICAgICAgaWYgKCFub0Fzc2VydCkgewogICAgICAgIGNoZWNrSUVFRTc1NChidWYsIHZhbHVlLCBvZmZzZXQsIDgpOwogICAgICB9CiAgICAgIGllZWU3NTQkMS53cml0ZShidWYsIHZhbHVlLCBvZmZzZXQsIGxpdHRsZUVuZGlhbiwgNTIsIDgpOwogICAgICByZXR1cm4gb2Zmc2V0ICsgODsKICAgIH0KICAgIEJ1ZmZlcjIucHJvdG90eXBlLndyaXRlRG91YmxlTEUgPSBmdW5jdGlvbiB3cml0ZURvdWJsZUxFKHZhbHVlLCBvZmZzZXQsIG5vQXNzZXJ0KSB7CiAgICAgIHJldHVybiB3cml0ZURvdWJsZSh0aGlzLCB2YWx1ZSwgb2Zmc2V0LCB0cnVlLCBub0Fzc2VydCk7CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUud3JpdGVEb3VibGVCRSA9IGZ1bmN0aW9uIHdyaXRlRG91YmxlQkUodmFsdWUsIG9mZnNldCwgbm9Bc3NlcnQpIHsKICAgICAgcmV0dXJuIHdyaXRlRG91YmxlKHRoaXMsIHZhbHVlLCBvZmZzZXQsIGZhbHNlLCBub0Fzc2VydCk7CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uIGNvcHkodGFyZ2V0LCB0YXJnZXRTdGFydCwgc3RhcnQsIGVuZCkgewogICAgICBpZiAoIUJ1ZmZlcjIuaXNCdWZmZXIodGFyZ2V0KSkKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJhcmd1bWVudCBzaG91bGQgYmUgYSBCdWZmZXIiKTsKICAgICAgaWYgKCFzdGFydCkKICAgICAgICBzdGFydCA9IDA7CiAgICAgIGlmICghZW5kICYmIGVuZCAhPT0gMCkKICAgICAgICBlbmQgPSB0aGlzLmxlbmd0aDsKICAgICAgaWYgKHRhcmdldFN0YXJ0ID49IHRhcmdldC5sZW5ndGgpCiAgICAgICAgdGFyZ2V0U3RhcnQgPSB0YXJnZXQubGVuZ3RoOwogICAgICBpZiAoIXRhcmdldFN0YXJ0KQogICAgICAgIHRhcmdldFN0YXJ0ID0gMDsKICAgICAgaWYgKGVuZCA+IDAgJiYgZW5kIDwgc3RhcnQpCiAgICAgICAgZW5kID0gc3RhcnQ7CiAgICAgIGlmIChlbmQgPT09IHN0YXJ0KQogICAgICAgIHJldHVybiAwOwogICAgICBpZiAodGFyZ2V0Lmxlbmd0aCA9PT0gMCB8fCB0aGlzLmxlbmd0aCA9PT0gMCkKICAgICAgICByZXR1cm4gMDsKICAgICAgaWYgKHRhcmdldFN0YXJ0IDwgMCkgewogICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJ0YXJnZXRTdGFydCBvdXQgb2YgYm91bmRzIik7CiAgICAgIH0KICAgICAgaWYgKHN0YXJ0IDwgMCB8fCBzdGFydCA+PSB0aGlzLmxlbmd0aCkKICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiSW5kZXggb3V0IG9mIHJhbmdlIik7CiAgICAgIGlmIChlbmQgPCAwKQogICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJzb3VyY2VFbmQgb3V0IG9mIGJvdW5kcyIpOwogICAgICBpZiAoZW5kID4gdGhpcy5sZW5ndGgpCiAgICAgICAgZW5kID0gdGhpcy5sZW5ndGg7CiAgICAgIGlmICh0YXJnZXQubGVuZ3RoIC0gdGFyZ2V0U3RhcnQgPCBlbmQgLSBzdGFydCkgewogICAgICAgIGVuZCA9IHRhcmdldC5sZW5ndGggLSB0YXJnZXRTdGFydCArIHN0YXJ0OwogICAgICB9CiAgICAgIGNvbnN0IGxlbjIgPSBlbmQgLSBzdGFydDsKICAgICAgaWYgKHRoaXMgPT09IHRhcmdldCAmJiB0eXBlb2YgVWludDhBcnJheS5wcm90b3R5cGUuY29weVdpdGhpbiA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIHRoaXMuY29weVdpdGhpbih0YXJnZXRTdGFydCwgc3RhcnQsIGVuZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgVWludDhBcnJheS5wcm90b3R5cGUuc2V0LmNhbGwodGFyZ2V0LCB0aGlzLnN1YmFycmF5KHN0YXJ0LCBlbmQpLCB0YXJnZXRTdGFydCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGxlbjI7CiAgICB9OwogICAgQnVmZmVyMi5wcm90b3R5cGUuZmlsbCA9IGZ1bmN0aW9uIGZpbGwodmFsLCBzdGFydCwgZW5kLCBlbmNvZGluZykgewogICAgICBpZiAodHlwZW9mIHZhbCA9PT0gInN0cmluZyIpIHsKICAgICAgICBpZiAodHlwZW9mIHN0YXJ0ID09PSAic3RyaW5nIikgewogICAgICAgICAgZW5jb2RpbmcgPSBzdGFydDsKICAgICAgICAgIHN0YXJ0ID0gMDsKICAgICAgICAgIGVuZCA9IHRoaXMubGVuZ3RoOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGVuZCA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIGVuY29kaW5nID0gZW5kOwogICAgICAgICAgZW5kID0gdGhpcy5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIGlmIChlbmNvZGluZyAhPT0gdm9pZCAwICYmIHR5cGVvZiBlbmNvZGluZyAhPT0gInN0cmluZyIpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImVuY29kaW5nIG11c3QgYmUgYSBzdHJpbmciKTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBlbmNvZGluZyA9PT0gInN0cmluZyIgJiYgIUJ1ZmZlcjIuaXNFbmNvZGluZyhlbmNvZGluZykpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gZW5jb2Rpbmc6ICIgKyBlbmNvZGluZyk7CiAgICAgICAgfQogICAgICAgIGlmICh2YWwubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICBjb25zdCBjb2RlMiA9IHZhbC5jaGFyQ29kZUF0KDApOwogICAgICAgICAgaWYgKGVuY29kaW5nID09PSAidXRmOCIgJiYgY29kZTIgPCAxMjggfHwgZW5jb2RpbmcgPT09ICJsYXRpbjEiKSB7CiAgICAgICAgICAgIHZhbCA9IGNvZGUyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsID09PSAibnVtYmVyIikgewogICAgICAgIHZhbCA9IHZhbCAmIDI1NTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsID09PSAiYm9vbGVhbiIpIHsKICAgICAgICB2YWwgPSBOdW1iZXIodmFsKTsKICAgICAgfQogICAgICBpZiAoc3RhcnQgPCAwIHx8IHRoaXMubGVuZ3RoIDwgc3RhcnQgfHwgdGhpcy5sZW5ndGggPCBlbmQpIHsKICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiT3V0IG9mIHJhbmdlIGluZGV4Iik7CiAgICAgIH0KICAgICAgaWYgKGVuZCA8PSBzdGFydCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHN0YXJ0ID0gc3RhcnQgPj4+IDA7CiAgICAgIGVuZCA9IGVuZCA9PT0gdm9pZCAwID8gdGhpcy5sZW5ndGggOiBlbmQgPj4+IDA7CiAgICAgIGlmICghdmFsKQogICAgICAgIHZhbCA9IDA7CiAgICAgIGxldCBpMjsKICAgICAgaWYgKHR5cGVvZiB2YWwgPT09ICJudW1iZXIiKSB7CiAgICAgICAgZm9yIChpMiA9IHN0YXJ0OyBpMiA8IGVuZDsgKytpMikgewogICAgICAgICAgdGhpc1tpMl0gPSB2YWw7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGJ5dGVzID0gQnVmZmVyMi5pc0J1ZmZlcih2YWwpID8gdmFsIDogQnVmZmVyMi5mcm9tKHZhbCwgZW5jb2RpbmcpOwogICAgICAgIGNvbnN0IGxlbjIgPSBieXRlcy5sZW5ndGg7CiAgICAgICAgaWYgKGxlbjIgPT09IDApIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSB2YWx1ZSAiJyArIHZhbCArICciIGlzIGludmFsaWQgZm9yIGFyZ3VtZW50ICJ2YWx1ZSInKTsKICAgICAgICB9CiAgICAgICAgZm9yIChpMiA9IDA7IGkyIDwgZW5kIC0gc3RhcnQ7ICsraTIpIHsKICAgICAgICAgIHRoaXNbaTIgKyBzdGFydF0gPSBieXRlc1tpMiAlIGxlbjJdOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICBjb25zdCBlcnJvcnMgPSB7fTsKICAgIGZ1bmN0aW9uIEUoc3ltLCBnZXRNZXNzYWdlLCBCYXNlKSB7CiAgICAgIGVycm9yc1tzeW1dID0gY2xhc3MgTm9kZUVycm9yIGV4dGVuZHMgQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJtZXNzYWdlIiwgewogICAgICAgICAgICB2YWx1ZTogZ2V0TWVzc2FnZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpLAogICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMubmFtZSA9IGAke3RoaXMubmFtZX0gWyR7c3ltfV1gOwogICAgICAgICAgdGhpcy5zdGFjazsKICAgICAgICAgIGRlbGV0ZSB0aGlzLm5hbWU7CiAgICAgICAgfQogICAgICAgIGdldCBjb2RlKCkgewogICAgICAgICAgcmV0dXJuIHN5bTsKICAgICAgICB9CiAgICAgICAgc2V0IGNvZGUodmFsdWUpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiY29kZSIsIHsKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICB2YWx1ZSwKICAgICAgICAgICAgd3JpdGFibGU6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICB0b1N0cmluZygpIHsKICAgICAgICAgIHJldHVybiBgJHt0aGlzLm5hbWV9IFske3N5bX1dOiAke3RoaXMubWVzc2FnZX1gOwogICAgICAgIH0KICAgICAgfTsKICAgIH0KICAgIEUoIkVSUl9CVUZGRVJfT1VUX09GX0JPVU5EUyIsIGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgaWYgKG5hbWUpIHsKICAgICAgICByZXR1cm4gYCR7bmFtZX0gaXMgb3V0c2lkZSBvZiBidWZmZXIgYm91bmRzYDsKICAgICAgfQogICAgICByZXR1cm4gIkF0dGVtcHQgdG8gYWNjZXNzIG1lbW9yeSBvdXRzaWRlIGJ1ZmZlciBib3VuZHMiOwogICAgfSwgUmFuZ2VFcnJvcik7CiAgICBFKCJFUlJfSU5WQUxJRF9BUkdfVFlQRSIsIGZ1bmN0aW9uKG5hbWUsIGFjdHVhbCkgewogICAgICByZXR1cm4gYFRoZSAiJHtuYW1lfSIgYXJndW1lbnQgbXVzdCBiZSBvZiB0eXBlIG51bWJlci4gUmVjZWl2ZWQgdHlwZSAke3R5cGVvZiBhY3R1YWx9YDsKICAgIH0sIFR5cGVFcnJvcik7CiAgICBFKCJFUlJfT1VUX09GX1JBTkdFIiwgZnVuY3Rpb24oc3RyLCByYW5nZSwgaW5wdXQpIHsKICAgICAgbGV0IG1zZzIgPSBgVGhlIHZhbHVlIG9mICIke3N0cn0iIGlzIG91dCBvZiByYW5nZS5gOwogICAgICBsZXQgcmVjZWl2ZWQgPSBpbnB1dDsKICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIoaW5wdXQpICYmIE1hdGguYWJzKGlucHV0KSA+IDIgKiogMzIpIHsKICAgICAgICByZWNlaXZlZCA9IGFkZE51bWVyaWNhbFNlcGFyYXRvcihTdHJpbmcoaW5wdXQpKTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaW5wdXQgPT09ICJiaWdpbnQiKSB7CiAgICAgICAgcmVjZWl2ZWQgPSBTdHJpbmcoaW5wdXQpOwogICAgICAgIGlmIChpbnB1dCA+IEJpZ0ludCgyKSAqKiBCaWdJbnQoMzIpIHx8IGlucHV0IDwgLShCaWdJbnQoMikgKiogQmlnSW50KDMyKSkpIHsKICAgICAgICAgIHJlY2VpdmVkID0gYWRkTnVtZXJpY2FsU2VwYXJhdG9yKHJlY2VpdmVkKTsKICAgICAgICB9CiAgICAgICAgcmVjZWl2ZWQgKz0gIm4iOwogICAgICB9CiAgICAgIG1zZzIgKz0gYCBJdCBtdXN0IGJlICR7cmFuZ2V9LiBSZWNlaXZlZCAke3JlY2VpdmVkfWA7CiAgICAgIHJldHVybiBtc2cyOwogICAgfSwgUmFuZ2VFcnJvcik7CiAgICBmdW5jdGlvbiBhZGROdW1lcmljYWxTZXBhcmF0b3IodmFsKSB7CiAgICAgIGxldCByZXMgPSAiIjsKICAgICAgbGV0IGkyID0gdmFsLmxlbmd0aDsKICAgICAgY29uc3Qgc3RhcnQgPSB2YWxbMF0gPT09ICItIiA/IDEgOiAwOwogICAgICBmb3IgKDsgaTIgPj0gc3RhcnQgKyA0OyBpMiAtPSAzKSB7CiAgICAgICAgcmVzID0gYF8ke3ZhbC5zbGljZShpMiAtIDMsIGkyKX0ke3Jlc31gOwogICAgICB9CiAgICAgIHJldHVybiBgJHt2YWwuc2xpY2UoMCwgaTIpfSR7cmVzfWA7CiAgICB9CiAgICBmdW5jdGlvbiBjaGVja0JvdW5kcyhidWYsIG9mZnNldCwgYnl0ZUxlbmd0aDMpIHsKICAgICAgdmFsaWRhdGVOdW1iZXIob2Zmc2V0LCAib2Zmc2V0Iik7CiAgICAgIGlmIChidWZbb2Zmc2V0XSA9PT0gdm9pZCAwIHx8IGJ1ZltvZmZzZXQgKyBieXRlTGVuZ3RoM10gPT09IHZvaWQgMCkgewogICAgICAgIGJvdW5kc0Vycm9yKG9mZnNldCwgYnVmLmxlbmd0aCAtIChieXRlTGVuZ3RoMyArIDEpKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gY2hlY2tJbnRCSSh2YWx1ZSwgbWluMiwgbWF4MiwgYnVmLCBvZmZzZXQsIGJ5dGVMZW5ndGgzKSB7CiAgICAgIGlmICh2YWx1ZSA+IG1heDIgfHwgdmFsdWUgPCBtaW4yKSB7CiAgICAgICAgY29uc3QgbiA9IHR5cGVvZiBtaW4yID09PSAiYmlnaW50IiA/ICJuIiA6ICIiOwogICAgICAgIGxldCByYW5nZTsKICAgICAgICBpZiAoYnl0ZUxlbmd0aDMgPiAzKSB7CiAgICAgICAgICBpZiAobWluMiA9PT0gMCB8fCBtaW4yID09PSBCaWdJbnQoMCkpIHsKICAgICAgICAgICAgcmFuZ2UgPSBgPj0gMCR7bn0gYW5kIDwgMiR7bn0gKiogJHsoYnl0ZUxlbmd0aDMgKyAxKSAqIDh9JHtufWA7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByYW5nZSA9IGA+PSAtKDIke259ICoqICR7KGJ5dGVMZW5ndGgzICsgMSkgKiA4IC0gMX0ke259KSBhbmQgPCAyICoqICR7KGJ5dGVMZW5ndGgzICsgMSkgKiA4IC0gMX0ke259YDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmFuZ2UgPSBgPj0gJHttaW4yfSR7bn0gYW5kIDw9ICR7bWF4Mn0ke259YDsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5FUlJfT1VUX09GX1JBTkdFKCJ2YWx1ZSIsIHJhbmdlLCB2YWx1ZSk7CiAgICAgIH0KICAgICAgY2hlY2tCb3VuZHMoYnVmLCBvZmZzZXQsIGJ5dGVMZW5ndGgzKTsKICAgIH0KICAgIGZ1bmN0aW9uIHZhbGlkYXRlTnVtYmVyKHZhbHVlLCBuYW1lKSB7CiAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICJudW1iZXIiKSB7CiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5FUlJfSU5WQUxJRF9BUkdfVFlQRShuYW1lLCAibnVtYmVyIiwgdmFsdWUpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBib3VuZHNFcnJvcih2YWx1ZSwgbGVuZ3RoLCB0eXBlKSB7CiAgICAgIGlmIChNYXRoLmZsb29yKHZhbHVlKSAhPT0gdmFsdWUpIHsKICAgICAgICB2YWxpZGF0ZU51bWJlcih2YWx1ZSwgdHlwZSk7CiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5FUlJfT1VUX09GX1JBTkdFKHR5cGUgfHwgIm9mZnNldCIsICJhbiBpbnRlZ2VyIiwgdmFsdWUpOwogICAgICB9CiAgICAgIGlmIChsZW5ndGggPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5FUlJfQlVGRkVSX09VVF9PRl9CT1VORFMoKTsKICAgICAgfQogICAgICB0aHJvdyBuZXcgZXJyb3JzLkVSUl9PVVRfT0ZfUkFOR0UodHlwZSB8fCAib2Zmc2V0IiwgYD49ICR7dHlwZSA/IDEgOiAwfSBhbmQgPD0gJHtsZW5ndGh9YCwgdmFsdWUpOwogICAgfQogICAgY29uc3QgSU5WQUxJRF9CQVNFNjRfUkUgPSAvW14rLzAtOUEtWmEtei1fXS9nOwogICAgZnVuY3Rpb24gYmFzZTY0Y2xlYW4oc3RyKSB7CiAgICAgIHN0ciA9IHN0ci5zcGxpdCgiPSIpWzBdOwogICAgICBzdHIgPSBzdHIudHJpbSgpLnJlcGxhY2UoSU5WQUxJRF9CQVNFNjRfUkUsICIiKTsKICAgICAgaWYgKHN0ci5sZW5ndGggPCAyKQogICAgICAgIHJldHVybiAiIjsKICAgICAgd2hpbGUgKHN0ci5sZW5ndGggJSA0ICE9PSAwKSB7CiAgICAgICAgc3RyID0gc3RyICsgIj0iOwogICAgICB9CiAgICAgIHJldHVybiBzdHI7CiAgICB9CiAgICBmdW5jdGlvbiB1dGY4VG9CeXRlcyhzdHJpbmcsIHVuaXRzKSB7CiAgICAgIHVuaXRzID0gdW5pdHMgfHwgSW5maW5pdHk7CiAgICAgIGxldCBjb2RlUG9pbnQ7CiAgICAgIGNvbnN0IGxlbmd0aCA9IHN0cmluZy5sZW5ndGg7CiAgICAgIGxldCBsZWFkU3Vycm9nYXRlID0gbnVsbDsKICAgICAgY29uc3QgYnl0ZXMgPSBbXTsKICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGxlbmd0aDsgKytpMikgewogICAgICAgIGNvZGVQb2ludCA9IHN0cmluZy5jaGFyQ29kZUF0KGkyKTsKICAgICAgICBpZiAoY29kZVBvaW50ID4gNTUyOTUgJiYgY29kZVBvaW50IDwgNTczNDQpIHsKICAgICAgICAgIGlmICghbGVhZFN1cnJvZ2F0ZSkgewogICAgICAgICAgICBpZiAoY29kZVBvaW50ID4gNTYzMTkpIHsKICAgICAgICAgICAgICBpZiAoKHVuaXRzIC09IDMpID4gLTEpCiAgICAgICAgICAgICAgICBieXRlcy5wdXNoKDIzOSwgMTkxLCAxODkpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKGkyICsgMSA9PT0gbGVuZ3RoKSB7CiAgICAgICAgICAgICAgaWYgKCh1bml0cyAtPSAzKSA+IC0xKQogICAgICAgICAgICAgICAgYnl0ZXMucHVzaCgyMzksIDE5MSwgMTg5KTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZWFkU3Vycm9nYXRlID0gY29kZVBvaW50OwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChjb2RlUG9pbnQgPCA1NjMyMCkgewogICAgICAgICAgICBpZiAoKHVuaXRzIC09IDMpID4gLTEpCiAgICAgICAgICAgICAgYnl0ZXMucHVzaCgyMzksIDE5MSwgMTg5KTsKICAgICAgICAgICAgbGVhZFN1cnJvZ2F0ZSA9IGNvZGVQb2ludDsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBjb2RlUG9pbnQgPSAobGVhZFN1cnJvZ2F0ZSAtIDU1Mjk2IDw8IDEwIHwgY29kZVBvaW50IC0gNTYzMjApICsgNjU1MzY7CiAgICAgICAgfSBlbHNlIGlmIChsZWFkU3Vycm9nYXRlKSB7CiAgICAgICAgICBpZiAoKHVuaXRzIC09IDMpID4gLTEpCiAgICAgICAgICAgIGJ5dGVzLnB1c2goMjM5LCAxOTEsIDE4OSk7CiAgICAgICAgfQogICAgICAgIGxlYWRTdXJyb2dhdGUgPSBudWxsOwogICAgICAgIGlmIChjb2RlUG9pbnQgPCAxMjgpIHsKICAgICAgICAgIGlmICgodW5pdHMgLT0gMSkgPCAwKQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGJ5dGVzLnB1c2goY29kZVBvaW50KTsKICAgICAgICB9IGVsc2UgaWYgKGNvZGVQb2ludCA8IDIwNDgpIHsKICAgICAgICAgIGlmICgodW5pdHMgLT0gMikgPCAwKQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGJ5dGVzLnB1c2goY29kZVBvaW50ID4+IDYgfCAxOTIsIGNvZGVQb2ludCAmIDYzIHwgMTI4KTsKICAgICAgICB9IGVsc2UgaWYgKGNvZGVQb2ludCA8IDY1NTM2KSB7CiAgICAgICAgICBpZiAoKHVuaXRzIC09IDMpIDwgMCkKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBieXRlcy5wdXNoKGNvZGVQb2ludCA+PiAxMiB8IDIyNCwgY29kZVBvaW50ID4+IDYgJiA2MyB8IDEyOCwgY29kZVBvaW50ICYgNjMgfCAxMjgpOwogICAgICAgIH0gZWxzZSBpZiAoY29kZVBvaW50IDwgMTExNDExMikgewogICAgICAgICAgaWYgKCh1bml0cyAtPSA0KSA8IDApCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgYnl0ZXMucHVzaChjb2RlUG9pbnQgPj4gMTggfCAyNDAsIGNvZGVQb2ludCA+PiAxMiAmIDYzIHwgMTI4LCBjb2RlUG9pbnQgPj4gNiAmIDYzIHwgMTI4LCBjb2RlUG9pbnQgJiA2MyB8IDEyOCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBjb2RlIHBvaW50Iik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBieXRlczsKICAgIH0KICAgIGZ1bmN0aW9uIGFzY2lpVG9CeXRlcyhzdHIpIHsKICAgICAgY29uc3QgYnl0ZUFycmF5ID0gW107CiAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBzdHIubGVuZ3RoOyArK2kyKSB7CiAgICAgICAgYnl0ZUFycmF5LnB1c2goc3RyLmNoYXJDb2RlQXQoaTIpICYgMjU1KTsKICAgICAgfQogICAgICByZXR1cm4gYnl0ZUFycmF5OwogICAgfQogICAgZnVuY3Rpb24gdXRmMTZsZVRvQnl0ZXMoc3RyLCB1bml0cykgewogICAgICBsZXQgYzIsIGhpLCBsbzsKICAgICAgY29uc3QgYnl0ZUFycmF5ID0gW107CiAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBzdHIubGVuZ3RoOyArK2kyKSB7CiAgICAgICAgaWYgKCh1bml0cyAtPSAyKSA8IDApCiAgICAgICAgICBicmVhazsKICAgICAgICBjMiA9IHN0ci5jaGFyQ29kZUF0KGkyKTsKICAgICAgICBoaSA9IGMyID4+IDg7CiAgICAgICAgbG8gPSBjMiAlIDI1NjsKICAgICAgICBieXRlQXJyYXkucHVzaChsbyk7CiAgICAgICAgYnl0ZUFycmF5LnB1c2goaGkpOwogICAgICB9CiAgICAgIHJldHVybiBieXRlQXJyYXk7CiAgICB9CiAgICBmdW5jdGlvbiBiYXNlNjRUb0J5dGVzKHN0cikgewogICAgICByZXR1cm4gYmFzZTY0LnRvQnl0ZUFycmF5KGJhc2U2NGNsZWFuKHN0cikpOwogICAgfQogICAgZnVuY3Rpb24gYmxpdEJ1ZmZlcihzcmMsIGRzdCwgb2Zmc2V0LCBsZW5ndGgpIHsKICAgICAgbGV0IGkyOwogICAgICBmb3IgKGkyID0gMDsgaTIgPCBsZW5ndGg7ICsraTIpIHsKICAgICAgICBpZiAoaTIgKyBvZmZzZXQgPj0gZHN0Lmxlbmd0aCB8fCBpMiA+PSBzcmMubGVuZ3RoKQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZHN0W2kyICsgb2Zmc2V0XSA9IHNyY1tpMl07CiAgICAgIH0KICAgICAgcmV0dXJuIGkyOwogICAgfQogICAgZnVuY3Rpb24gaXNJbnN0YW5jZShvYmosIHR5cGUpIHsKICAgICAgcmV0dXJuIG9iaiBpbnN0YW5jZW9mIHR5cGUgfHwgb2JqICE9IG51bGwgJiYgb2JqLmNvbnN0cnVjdG9yICE9IG51bGwgJiYgb2JqLmNvbnN0cnVjdG9yLm5hbWUgIT0gbnVsbCAmJiBvYmouY29uc3RydWN0b3IubmFtZSA9PT0gdHlwZS5uYW1lOwogICAgfQogICAgZnVuY3Rpb24gbnVtYmVySXNOYU4ob2JqKSB7CiAgICAgIHJldHVybiBvYmogIT09IG9iajsKICAgIH0KICAgIGNvbnN0IGhleFNsaWNlTG9va3VwVGFibGUgPSBmdW5jdGlvbigpIHsKICAgICAgY29uc3QgYWxwaGFiZXQgPSAiMDEyMzQ1Njc4OWFiY2RlZiI7CiAgICAgIGNvbnN0IHRhYmxlID0gbmV3IEFycmF5KDI1Nik7CiAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCAxNjsgKytpMikgewogICAgICAgIGNvbnN0IGkxNiA9IGkyICogMTY7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgICAgICB0YWJsZVtpMTYgKyBqXSA9IGFscGhhYmV0W2kyXSArIGFscGhhYmV0W2pdOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdGFibGU7CiAgICB9KCk7CiAgICBmdW5jdGlvbiBkZWZpbmVCaWdJbnRNZXRob2QoZm4pIHsKICAgICAgcmV0dXJuIHR5cGVvZiBCaWdJbnQgPT09ICJ1bmRlZmluZWQiID8gQnVmZmVyQmlnSW50Tm90RGVmaW5lZCA6IGZuOwogICAgfQogICAgZnVuY3Rpb24gQnVmZmVyQmlnSW50Tm90RGVmaW5lZCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJCaWdJbnQgbm90IHN1cHBvcnRlZCIpOwogICAgfQogIH0pKGJ1ZmZlcik7CiAgdmFyIEJ1ZmZlciQxID0gYnVmZmVyLkJ1ZmZlcjsKICB2YXIgQ1JDX1RBQkxFID0gWwogICAgMCwKICAgIDE5OTY5NTk4OTQsCiAgICAzOTkzOTE5Nzg4LAogICAgMjU2NzUyNDc5NCwKICAgIDEyNDYzNDEzNywKICAgIDE4ODYwNTc2MTUsCiAgICAzOTE1NjIxNjg1LAogICAgMjY1NzM5MjAzNSwKICAgIDI0OTI2ODI3NCwKICAgIDIwNDQ1MDgzMjQsCiAgICAzNzcyMTE1MjMwLAogICAgMjU0NzE3Nzg2NCwKICAgIDE2Mjk0MTk5NSwKICAgIDIxMjU1NjEwMjEsCiAgICAzODg3NjA3MDQ3LAogICAgMjQyODQ0NDA0OSwKICAgIDQ5ODUzNjU0OCwKICAgIDE3ODk5Mjc2NjYsCiAgICA0MDg5MDE2NjQ4LAogICAgMjIyNzA2MTIxNCwKICAgIDQ1MDU0ODg2MSwKICAgIDE4NDMyNTg2MDMsCiAgICA0MTA3NTgwNzUzLAogICAgMjIxMTY3NzYzOSwKICAgIDMyNTg4Mzk5MCwKICAgIDE2ODQ3NzcxNTIsCiAgICA0MjUxMTIyMDQyLAogICAgMjMyMTkyNjYzNiwKICAgIDMzNTYzMzQ4NywKICAgIDE2NjEzNjU0NjUsCiAgICA0MTk1MzAyNzU1LAogICAgMjM2NjExNTMxNywKICAgIDk5NzA3MzA5NiwKICAgIDEyODE5NTM4ODYsCiAgICAzNTc5ODU1MzMyLAogICAgMjcyNDY4ODI0MiwKICAgIDEwMDY4ODgxNDUsCiAgICAxMjU4NjA3Njg3LAogICAgMzUyNDEwMTYyOSwKICAgIDI3Njg5NDI0NDMsCiAgICA5MDEwOTc3MjIsCiAgICAxMTE5MDAwNjg0LAogICAgMzY4NjUxNzIwNiwKICAgIDI4OTgwNjU3MjgsCiAgICA4NTMwNDQ0NTEsCiAgICAxMTcyMjY2MTAxLAogICAgMzcwNTAxNTc1OSwKICAgIDI4ODI2MTY2NjUsCiAgICA2NTE3Njc5ODAsCiAgICAxMzczNTAzNTQ2LAogICAgMzM2OTU1NDMwNCwKICAgIDMyMTgxMDQ1OTgsCiAgICA1NjU1MDcyNTMsCiAgICAxNDU0NjIxNzMxLAogICAgMzQ4NTExMTcwNSwKICAgIDMwOTk0MzYzMDMsCiAgICA2NzEyNjY5NzQsCiAgICAxNTk0MTk4MDI0LAogICAgMzMyMjczMDkzMCwKICAgIDI5NzAzNDc4MTIsCiAgICA3OTU4MzU1MjcsCiAgICAxNDgzMjMwMjI1LAogICAgMzI0NDM2NzI3NSwKICAgIDMwNjAxNDk1NjUsCiAgICAxOTk0MTQ2MTkyLAogICAgMzExNTg1MzQsCiAgICAyNTYzOTA3NzcyLAogICAgNDAyMzcxNzkzMCwKICAgIDE5MDc0NTk0NjUsCiAgICAxMTI2MzcyMTUsCiAgICAyNjgwMTUzMjUzLAogICAgMzkwNDQyNzA1OSwKICAgIDIwMTM3NzYyOTAsCiAgICAyNTE3MjIwMzYsCiAgICAyNTE3MjE1Mzc0LAogICAgMzc3NTgzMDA0MCwKICAgIDIxMzc2NTY3NjMsCiAgICAxNDEzNzY4MTMsCiAgICAyNDM5Mjc3NzE5LAogICAgMzg2NTI3MTI5NywKICAgIDE4MDIxOTU0NDQsCiAgICA0NzY4NjQ4NjYsCiAgICAyMjM4MDAxMzY4LAogICAgNDA2NjUwODg3OCwKICAgIDE4MTIzNzA5MjUsCiAgICA0NTMwOTI3MzEsCiAgICAyMTgxNjI1MDI1LAogICAgNDExMTQ1MTIyMywKICAgIDE3MDYwODg5MDIsCiAgICAzMTQwNDI3MDQsCiAgICAyMzQ0NTMyMjAyLAogICAgNDI0MDAxNzUzMiwKICAgIDE2NTg2NTgyNzEsCiAgICAzNjY2MTk5NzcsCiAgICAyMzYyNjcwMzIzLAogICAgNDIyNDk5NDQwNSwKICAgIDEzMDM1MzU5NjAsCiAgICA5ODQ5NjE0ODYsCiAgICAyNzQ3MDA3MDkyLAogICAgMzU2OTAzNzUzOCwKICAgIDEyNTYxNzA4MTcsCiAgICAxMDM3NjA0MzExLAogICAgMjc2NTIxMDczMywKICAgIDM1NTQwNzk5OTUsCiAgICAxMTMxMDE0NTA2LAogICAgODc5Njc5OTk2LAogICAgMjkwOTI0MzQ2MiwKICAgIDM2NjM3NzE4NTYsCiAgICAxMTQxMTI0NDY3LAogICAgODU1ODQyMjc3LAogICAgMjg1MjgwMTYzMSwKICAgIDM3MDg2NDg2NDksCiAgICAxMzQyNTMzOTQ4LAogICAgNjU0NDU5MzA2LAogICAgMzE4ODM5NjA0OCwKICAgIDMzNzMwMTUxNzQsCiAgICAxNDY2NDc5OTA5LAogICAgNTQ0MTc5NjM1LAogICAgMzExMDUyMzkxMywKICAgIDM0NjI1MjIwMTUsCiAgICAxNTkxNjcxMDU0LAogICAgNzAyMTM4Nzc2LAogICAgMjk2NjQ2MDQ1MCwKICAgIDMzNTI3OTk0MTIsCiAgICAxNTA0OTE4ODA3LAogICAgNzgzNTUxODczLAogICAgMzA4MjY0MDQ0MywKICAgIDMyMzM0NDI5ODksCiAgICAzOTg4MjkyMzg0LAogICAgMjU5NjI1NDY0NiwKICAgIDYyMzE3MDY4LAogICAgMTk1NzgxMDg0MiwKICAgIDM5Mzk4NDU5NDUsCiAgICAyNjQ3ODE2MTExLAogICAgODE0NzA5OTcsCiAgICAxOTQzODAzNTIzLAogICAgMzgxNDkxODkzMCwKICAgIDI0ODk1OTY4MDQsCiAgICAyMjUyNzQ0MzAsCiAgICAyMDUzNzkwMzc2LAogICAgMzgyNjE3NTc1NSwKICAgIDI0NjY5MDYwMTMsCiAgICAxNjc4MTY3NDMsCiAgICAyMDk3NjUxMzc3LAogICAgNDAyNzU1MjU4MCwKICAgIDIyNjU0OTAzODYsCiAgICA1MDM0NDQwNzIsCiAgICAxNzYyMDUwODE0LAogICAgNDE1MDQxNzI0NSwKICAgIDIxNTQxMjkzNTUsCiAgICA0MjY1MjIyMjUsCiAgICAxODUyNTA3ODc5LAogICAgNDI3NTMxMzUyNiwKICAgIDIzMTIzMTc5MjAsCiAgICAyODI3NTM2MjYsCiAgICAxNzQyNTU1ODUyLAogICAgNDE4OTcwODE0MywKICAgIDIzOTQ4Nzc5NDUsCiAgICAzOTc5MTc3NjMsCiAgICAxNjIyMTgzNjM3LAogICAgMzYwNDM5MDg4OCwKICAgIDI3MTQ4NjY1NTgsCiAgICA5NTM3Mjk3MzIsCiAgICAxMzQwMDc2NjI2LAogICAgMzUxODcxOTk4NSwKICAgIDI3OTczNjA5OTksCiAgICAxMDY4ODI4MzgxLAogICAgMTIxOTYzODg1OSwKICAgIDM2MjQ3NDE4NTAsCiAgICAyOTM2Njc1MTQ4LAogICAgOTA2MTg1NDYyLAogICAgMTA5MDgxMjUxMiwKICAgIDM3NDc2NzIwMDMsCiAgICAyODI1Mzc5NjY5LAogICAgODI5MzI5MTM1LAogICAgMTE4MTMzNTE2MSwKICAgIDM0MTIxNzc4MDQsCiAgICAzMTYwODM0ODQyLAogICAgNjI4MDg1NDA4LAogICAgMTM4MjYwNTM2NiwKICAgIDM0MjMzNjkxMDksCiAgICAzMTM4MDc4NDY3LAogICAgNTcwNTYyMjMzLAogICAgMTQyNjQwMDgxNSwKICAgIDMzMTczMTY1NDIsCiAgICAyOTk4NzMzNjA4LAogICAgNzMzMjM5OTU0LAogICAgMTU1NTI2MTk1NiwKICAgIDMyNjg5MzU1OTEsCiAgICAzMDUwMzYwNjI1LAogICAgNzUyNDU5NDAzLAogICAgMTU0MTMyMDIyMSwKICAgIDI2MDcwNzE5MjAsCiAgICAzOTY1OTczMDMwLAogICAgMTk2OTkyMjk3MiwKICAgIDQwNzM1NDk4LAogICAgMjYxNzgzNzIyNSwKICAgIDM5NDM1NzcxNTEsCiAgICAxOTEzMDg3ODc3LAogICAgODM5MDgzNzEsCiAgICAyNTEyMzQxNjM0LAogICAgMzgwMzc0MDY5MiwKICAgIDIwNzUyMDg2MjIsCiAgICAyMTMyNjExMTIsCiAgICAyNDYzMjcyNjAzLAogICAgMzg1NTk5MDI4NSwKICAgIDIwOTQ4NTQwNzEsCiAgICAxOTg5NTg4ODEsCiAgICAyMjYyMDI5MDEyLAogICAgNDA1NzI2MDYxMCwKICAgIDE3NTkzNTk5OTIsCiAgICA1MzQ0MTQxOTAsCiAgICAyMTc2NzE4NTQxLAogICAgNDEzOTMyOTExNSwKICAgIDE4NzM4MzYwMDEsCiAgICA0MTQ2NjQ1NjcsCiAgICAyMjgyMjQ4OTM0LAogICAgNDI3OTIwMDM2OCwKICAgIDE3MTE2ODQ1NTQsCiAgICAyODUyODExMTYsCiAgICAyNDA1ODAxNzI3LAogICAgNDE2NzIxNjc0NSwKICAgIDE2MzQ0Njc3OTUsCiAgICAzNzYyMjk3MDEsCiAgICAyNjg1MDY3ODk2LAogICAgMzYwODAwNzQwNiwKICAgIDEzMDg5MTg2MTIsCiAgICA5NTY1NDM5MzgsCiAgICAyODA4NTU1MTA1LAogICAgMzQ5NTk1ODI2MywKICAgIDEyMzE2MzYzMDEsCiAgICAxMDQ3NDI3MDM1LAogICAgMjkzMjk1OTgxOCwKICAgIDM2NTQ3MDM4MzYsCiAgICAxMDg4MzU5MjcwLAogICAgOTM2OTE4ZTMsCiAgICAyODQ3NzE0ODk5LAogICAgMzczNjgzNzgyOSwKICAgIDEyMDI5MDA4NjMsCiAgICA4MTcyMzM4OTcsCiAgICAzMTgzMzQyMTA4LAogICAgMzQwMTIzNzEzMCwKICAgIDE0MDQyNzc1NTIsCiAgICA2MTU4MTgxNTAsCiAgICAzMTM0MjA3NDkzLAogICAgMzQ1MzQyMTIwMywKICAgIDE0MjM4NTc0NDksCiAgICA2MDE0NTA0MzEsCiAgICAzMDA5ODM3NjE0LAogICAgMzI5NDcxMDQ1NiwKICAgIDE1NjcxMDM3NDYsCiAgICA3MTE5Mjg3MjQsCiAgICAzMDIwNjY4NDcxLAogICAgMzI3MjM4MDA2NSwKICAgIDE1MTAzMzQyMzUsCiAgICA3NTUxNjcxMTcKICBdOwogIGlmICh0eXBlb2YgSW50MzJBcnJheSAhPT0gInVuZGVmaW5lZCIpIHsKICAgIENSQ19UQUJMRSA9IG5ldyBJbnQzMkFycmF5KENSQ19UQUJMRSk7CiAgfQogIGZ1bmN0aW9uIGVuc3VyZUJ1ZmZlcihpbnB1dCkgewogICAgaWYgKEJ1ZmZlciQxLmlzQnVmZmVyKGlucHV0KSkgewogICAgICByZXR1cm4gaW5wdXQ7CiAgICB9CiAgICB2YXIgaGFzTmV3QnVmZmVyQVBJID0gdHlwZW9mIEJ1ZmZlciQxLmFsbG9jID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBCdWZmZXIkMS5mcm9tID09PSAiZnVuY3Rpb24iOwogICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gIm51bWJlciIpIHsKICAgICAgcmV0dXJuIGhhc05ld0J1ZmZlckFQSSA/IEJ1ZmZlciQxLmFsbG9jKGlucHV0KSA6IG5ldyBCdWZmZXIkMShpbnB1dCk7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBpbnB1dCA9PT0gInN0cmluZyIpIHsKICAgICAgcmV0dXJuIGhhc05ld0J1ZmZlckFQSSA/IEJ1ZmZlciQxLmZyb20oaW5wdXQpIDogbmV3IEJ1ZmZlciQxKGlucHV0KTsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiaW5wdXQgbXVzdCBiZSBidWZmZXIsIG51bWJlciwgb3Igc3RyaW5nLCByZWNlaXZlZCAiICsgdHlwZW9mIGlucHV0KTsKICAgIH0KICB9CiAgZnVuY3Rpb24gYnVmZmVyaXplSW50KG51bSkgewogICAgdmFyIHRtcCA9IGVuc3VyZUJ1ZmZlcig0KTsKICAgIHRtcC53cml0ZUludDMyQkUobnVtLCAwKTsKICAgIHJldHVybiB0bXA7CiAgfQogIGZ1bmN0aW9uIF9jcmMzMihidWYsIHByZXZpb3VzKSB7CiAgICBidWYgPSBlbnN1cmVCdWZmZXIoYnVmKTsKICAgIGlmIChCdWZmZXIkMS5pc0J1ZmZlcihwcmV2aW91cykpIHsKICAgICAgcHJldmlvdXMgPSBwcmV2aW91cy5yZWFkVUludDMyQkUoMCk7CiAgICB9CiAgICB2YXIgY3JjID0gfn5wcmV2aW91cyBeIC0xOwogICAgZm9yICh2YXIgbiA9IDA7IG4gPCBidWYubGVuZ3RoOyBuKyspIHsKICAgICAgY3JjID0gQ1JDX1RBQkxFWyhjcmMgXiBidWZbbl0pICYgMjU1XSBeIGNyYyA+Pj4gODsKICAgIH0KICAgIHJldHVybiBjcmMgXiAtMTsKICB9CiAgZnVuY3Rpb24gY3JjMzIoKSB7CiAgICByZXR1cm4gYnVmZmVyaXplSW50KF9jcmMzMi5hcHBseShudWxsLCBhcmd1bWVudHMpKTsKICB9CiAgY3JjMzIuc2lnbmVkID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gX2NyYzMyLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgfTsKICBjcmMzMi51bnNpZ25lZCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIF9jcmMzMi5hcHBseShudWxsLCBhcmd1bWVudHMpID4+PiAwOwogIH07CiAgdmFyIGJ1ZmZlckNyYzMyID0gY3JjMzI7CiAgdmFyIGhhcyA9IGZ1bmN0aW9uKG9iaiwgcHJvcCkgewogICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApOwogIH07CiAgdmFyIGlzRW51bWVyYWJsZSA9IGZ1bmN0aW9uKG9iaiwgcHJvcCkgewogICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChvYmosIHByb3ApOwogIH07CiAgZnVuY3Rpb24gZW50cmllcyhvYmopIHsKICAgIGlmIChvYmogPT0gbnVsbCkgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY29udmVydCB1bmRlZmluZWQgb3IgbnVsbCB0byBvYmplY3QiKTsKICAgIH0KICAgIHZhciBwYWlycyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICBpZiAoaGFzKG9iaiwga2V5KSAmJiBpc0VudW1lcmFibGUob2JqLCBrZXkpKSB7CiAgICAgICAgcGFpcnMucHVzaChba2V5LCBvYmpba2V5XV0pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcGFpcnM7CiAgfQogIHZhciBlbnRyaWVzXzEgPSBlbnRyaWVzOwogIHZhciBvYmplY3RfZW50cmllc1BvbnlmaWxsID0gdHlwZW9mIE9iamVjdC5lbnRyaWVzID09PSAiZnVuY3Rpb24iID8gT2JqZWN0LmVudHJpZXMgOiBlbnRyaWVzXzE7CiAgdmFyIGRpc3QgPSB7fTsKICB2YXIgcmVtb3RlRmlsZSA9IHt9OwogIHZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDEgPSBpbnRlcm9wUmVxdWlyZURlZmF1bHQuZXhwb3J0czsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVtb3RlRmlsZSwgIl9fZXNNb2R1bGUiLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwogIHJlbW90ZUZpbGUuZGVmYXVsdCA9IHZvaWQgMDsKICB2YXIgX3JlZ2VuZXJhdG9yJDEgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDEocmVnZW5lcmF0b3IpOwogIHZhciBfYXN5bmNUb0dlbmVyYXRvcjIkMSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkMShhc3luY1RvR2VuZXJhdG9yLmV4cG9ydHMpOwogIHZhciBfY2xhc3NDYWxsQ2hlY2syJDEgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDEoY2xhc3NDYWxsQ2hlY2suZXhwb3J0cyk7CiAgdmFyIF9jcmVhdGVDbGFzczIkMSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkMShjcmVhdGVDbGFzcy5leHBvcnRzKTsKICB2YXIgX2RlZmluZVByb3BlcnR5MiQxID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQxKGRlZmluZVByb3BlcnR5JDMuZXhwb3J0cyk7CiAgdmFyIF9maWxlVXJpVG9QYXRoID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQxKHJlcXVpcmUkJDEpOwogIHZhciBfID0gZGlzdDsKICBmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICAgIHZhciBrZXlzMiA9IE9iamVjdC5rZXlzKG9iamVjdCk7CiAgICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgICB2YXIgc3ltYm9sczIgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICAgIGlmIChlbnVtZXJhYmxlT25seSkKICAgICAgICBzeW1ib2xzMiA9IHN5bWJvbHMyLmZpbHRlcihmdW5jdGlvbihzeW0pIHsKICAgICAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgICAgIH0pOwogICAgICBrZXlzMi5wdXNoLmFwcGx5KGtleXMyLCBzeW1ib2xzMik7CiAgICB9CiAgICByZXR1cm4ga2V5czI7CiAgfQogIGZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7CiAgICBmb3IgKHZhciBpMiA9IDE7IGkyIDwgYXJndW1lbnRzLmxlbmd0aDsgaTIrKykgewogICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2kyXSAhPSBudWxsID8gYXJndW1lbnRzW2kyXSA6IHt9OwogICAgICBpZiAoaTIgJSAyKSB7CiAgICAgICAgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyJDEuZGVmYXVsdCkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGFyZ2V0OwogIH0KICB2YXIgbXlHbG9iYWwgPSB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiA/IHdpbmRvdyA6IHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIiA/IHNlbGYgOiB7CiAgICBmZXRjaDogdm9pZCAwCiAgfTsKICB2YXIgUmVtb3RlRmlsZSQxID0gLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKCkgewogICAgKDAsIF9jcmVhdGVDbGFzczIkMS5kZWZhdWx0KShSZW1vdGVGaWxlMiwgW3sKICAgICAga2V5OiAiZ2V0QnVmZmVyRnJvbVJlc3BvbnNlIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfZ2V0QnVmZmVyRnJvbVJlc3BvbnNlID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMiQxLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IkMS5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZShyZXNwb25zZSkgewogICAgICAgICAgdmFyIHJlc3A7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDEuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICBpZiAoISh0eXBlb2YgcmVzcG9uc2UuYnVmZmVyID09PSAiZnVuY3Rpb24iKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHJlc3BvbnNlLmJ1ZmZlcigpKTsKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIHJlc3BvbnNlLmFycmF5QnVmZmVyID09PSAiZnVuY3Rpb24iKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmFycmF5QnVmZmVyKCk7CiAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgIHJlc3AgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBCdWZmZXIuZnJvbShyZXNwKSk7CiAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnZhbGlkIEhUVFAgcmVzcG9uc2Ugb2JqZWN0LCBoYXMgbm8gYnVmZmVyIG1ldGhvZCwgYW5kIG5vIGFycmF5QnVmZmVyIG1ldGhvZCIpOwogICAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgICB9KSk7CiAgICAgICAgZnVuY3Rpb24gZ2V0QnVmZmVyRnJvbVJlc3BvbnNlKF94KSB7CiAgICAgICAgICByZXR1cm4gX2dldEJ1ZmZlckZyb21SZXNwb25zZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZ2V0QnVmZmVyRnJvbVJlc3BvbnNlOwogICAgICB9KCkKICAgIH1dKTsKICAgIGZ1bmN0aW9uIFJlbW90ZUZpbGUyKHNvdXJjZSkgewogICAgICB2YXIgb3B0cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syJDEuZGVmYXVsdCkodGhpcywgUmVtb3RlRmlsZTIpOwogICAgICAoMCwgX2RlZmluZVByb3BlcnR5MiQxLmRlZmF1bHQpKHRoaXMsICJ1cmwiLCB2b2lkIDApOwogICAgICAoMCwgX2RlZmluZVByb3BlcnR5MiQxLmRlZmF1bHQpKHRoaXMsICJfc3RhdCIsIHZvaWQgMCk7CiAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyJDEuZGVmYXVsdCkodGhpcywgImZldGNoSW1wbGVtZW50YXRpb24iLCB2b2lkIDApOwogICAgICAoMCwgX2RlZmluZVByb3BlcnR5MiQxLmRlZmF1bHQpKHRoaXMsICJiYXNlT3ZlcnJpZGVzIiwge30pOwogICAgICB0aGlzLnVybCA9IHNvdXJjZTsKICAgICAgaWYgKHNvdXJjZS5zdGFydHNXaXRoKCJmaWxlOi8vIikpIHsKICAgICAgICB2YXIgcGF0aDIgPSAoMCwgX2ZpbGVVcmlUb1BhdGguZGVmYXVsdCkoc291cmNlKTsKICAgICAgICBpZiAoIXBhdGgyKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnZhbGlkIGZpbGUgdXJsIik7CiAgICAgICAgfQogICAgICAgIHZhciBsb2NhbEZpbGUyID0gbmV3IF8uTG9jYWxGaWxlKHBhdGgyKTsKICAgICAgICB0aGlzLnJlYWQgPSBsb2NhbEZpbGUyLnJlYWQuYmluZChsb2NhbEZpbGUyKTsKICAgICAgICB0aGlzLnJlYWRGaWxlID0gbG9jYWxGaWxlMi5yZWFkRmlsZS5iaW5kKGxvY2FsRmlsZTIpOwogICAgICAgIHRoaXMuc3RhdCA9IGxvY2FsRmlsZTIuc3RhdC5iaW5kKGxvY2FsRmlsZTIpOwogICAgICAgIHRoaXMuZmV0Y2hJbXBsZW1lbnRhdGlvbiA9IGZ1bmN0aW9uKCkgewogICAgICAgIH07CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhciBmZXRjaDIgPSBvcHRzLmZldGNoIHx8IG15R2xvYmFsLmZldGNoICYmIG15R2xvYmFsLmZldGNoLmJpbmQobXlHbG9iYWwpOwogICAgICBpZiAoIWZldGNoMikgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIm5vIGZldGNoIGZ1bmN0aW9uIHN1cHBsaWVkLCBhbmQgbm9uZSBmb3VuZCBpbiBnbG9iYWwgZW52aXJvbm1lbnQiKTsKICAgICAgfQogICAgICBpZiAob3B0cy5vdmVycmlkZXMpIHsKICAgICAgICB0aGlzLmJhc2VPdmVycmlkZXMgPSBvcHRzLm92ZXJyaWRlczsKICAgICAgfQogICAgICB0aGlzLmZldGNoSW1wbGVtZW50YXRpb24gPSBmZXRjaDI7CiAgICB9CiAgICAoMCwgX2NyZWF0ZUNsYXNzMiQxLmRlZmF1bHQpKFJlbW90ZUZpbGUyLCBbewogICAgICBrZXk6ICJmZXRjaCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX2ZldGNoID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMiQxLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IkMS5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoaW5wdXQsIGluaXQyKSB7CiAgICAgICAgICB2YXIgcmVzcG9uc2U7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDEuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAwOwogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZldGNoSW1wbGVtZW50YXRpb24oaW5wdXQsIGluaXQyKTsKICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gNjsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLnQwID0gX2NvbnRleHQyWyJjYXRjaCJdKDApOwogICAgICAgICAgICAgICAgICBpZiAoIShfY29udGV4dDIudDAubWVzc2FnZSA9PT0gIkZhaWxlZCB0byBmZXRjaCIpKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oImdlbmVyaWMtZmlsZWhhbmRsZTogcmVmZXRjaGluZyAiLmNvbmNhdChpbnB1dCwgIiB0byBhdHRlbXB0IHRvIHdvcmsgYXJvdW5kIGNocm9tZSBDT1JTIGhlYWRlciBjYWNoaW5nIGJ1ZyIpKTsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmV0Y2hJbXBsZW1lbnRhdGlvbihpbnB1dCwgX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBpbml0MiksIHt9LCB7CiAgICAgICAgICAgICAgICAgICAgY2FjaGU6ICJyZWxvYWQiCiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgICAgdGhyb3cgX2NvbnRleHQyLnQwOwogICAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzLCBbWzAsIDZdXSk7CiAgICAgICAgfSkpOwogICAgICAgIGZ1bmN0aW9uIGZldGNoMihfeDIsIF94MykgewogICAgICAgICAgcmV0dXJuIF9mZXRjaC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmV0Y2gyOwogICAgICB9KCkKICAgIH0sIHsKICAgICAga2V5OiAicmVhZCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX3JlYWQgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyJDEuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvciQxLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhidWZmZXIyKSB7CiAgICAgICAgICB2YXIgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uLCBvcHRzLCBfb3B0cyRoZWFkZXJzLCBoZWFkZXJzLCBzaWduYWwsIF9vcHRzJG92ZXJyaWRlcywgb3ZlcnJpZGVzLCBhcmdzLCByZXNwb25zZSwgcmVzcG9uc2VEYXRhLCBieXRlc0NvcGllZCwgcmVzLCBzaXplTWF0Y2gsIF9hcmdzMyA9IGFyZ3VtZW50czsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IkMS5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICBvZmZzZXQgPSBfYXJnczMubGVuZ3RoID4gMSAmJiBfYXJnczNbMV0gIT09IHZvaWQgMCA/IF9hcmdzM1sxXSA6IDA7CiAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IF9hcmdzMy5sZW5ndGggPiAyID8gX2FyZ3MzWzJdIDogdm9pZCAwOwogICAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IF9hcmdzMy5sZW5ndGggPiAzICYmIF9hcmdzM1szXSAhPT0gdm9pZCAwID8gX2FyZ3MzWzNdIDogMDsKICAgICAgICAgICAgICAgICAgb3B0cyA9IF9hcmdzMy5sZW5ndGggPiA0ICYmIF9hcmdzM1s0XSAhPT0gdm9pZCAwID8gX2FyZ3MzWzRdIDoge307CiAgICAgICAgICAgICAgICAgIF9vcHRzJGhlYWRlcnMgPSBvcHRzLmhlYWRlcnMsIGhlYWRlcnMgPSBfb3B0cyRoZWFkZXJzID09PSB2b2lkIDAgPyB7fSA6IF9vcHRzJGhlYWRlcnMsIHNpZ25hbCA9IG9wdHMuc2lnbmFsLCBfb3B0cyRvdmVycmlkZXMgPSBvcHRzLm92ZXJyaWRlcywgb3ZlcnJpZGVzID0gX29wdHMkb3ZlcnJpZGVzID09PSB2b2lkIDAgPyB7fSA6IF9vcHRzJG92ZXJyaWRlczsKICAgICAgICAgICAgICAgICAgaWYgKGxlbmd0aCA8IEluZmluaXR5KSB7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVycy5yYW5nZSA9ICJieXRlcz0iLmNvbmNhdChwb3NpdGlvbiwgIi0iKS5jb25jYXQocG9zaXRpb24gKyBsZW5ndGgpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxlbmd0aCA9PT0gSW5maW5pdHkgJiYgcG9zaXRpb24gIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzLnJhbmdlID0gImJ5dGVzPSIuY29uY2F0KHBvc2l0aW9uLCAiLSIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGFyZ3MgPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdGhpcy5iYXNlT3ZlcnJpZGVzKSwgb3ZlcnJpZGVzKSwge30sIHsKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgaGVhZGVycyksIG92ZXJyaWRlcy5oZWFkZXJzKSwgdGhpcy5iYXNlT3ZlcnJpZGVzLmhlYWRlcnMpLAogICAgICAgICAgICAgICAgICAgIG1ldGhvZDogIkdFVCIsCiAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3Q6ICJmb2xsb3ciLAogICAgICAgICAgICAgICAgICAgIG1vZGU6ICJjb3JzIiwKICAgICAgICAgICAgICAgICAgICBzaWduYWwKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmV0Y2godGhpcy51cmwsIGFyZ3MpOwogICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSFRUUCAiLmNvbmNhdChyZXNwb25zZS5zdGF0dXMsICIgIikuY29uY2F0KHJlc3BvbnNlLnN0YXR1c1RleHQpKTsKICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgIGlmICghKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwICYmIHBvc2l0aW9uID09PSAwIHx8IHJlc3BvbnNlLnN0YXR1cyA9PT0gMjA2KSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QnVmZmVyRnJvbVJlc3BvbnNlKHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlRGF0YSA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgICBieXRlc0NvcGllZCA9IHJlc3BvbnNlRGF0YS5jb3B5KGJ1ZmZlcjIsIG9mZnNldCwgMCwgTWF0aC5taW4obGVuZ3RoLCByZXNwb25zZURhdGEubGVuZ3RoKSk7CiAgICAgICAgICAgICAgICAgIHJlcyA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCJjb250ZW50LXJhbmdlIik7CiAgICAgICAgICAgICAgICAgIHNpemVNYXRjaCA9IC9cLyhcZCspJC8uZXhlYyhyZXMgfHwgIiIpOwogICAgICAgICAgICAgICAgICBpZiAoc2l6ZU1hdGNoICYmIHNpemVNYXRjaFsxXSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXQgPSB7CiAgICAgICAgICAgICAgICAgICAgICBzaXplOiBwYXJzZUludChzaXplTWF0Y2hbMV0sIDEwKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgICBieXRlc1JlYWQ6IGJ5dGVzQ29waWVkLAogICAgICAgICAgICAgICAgICAgIGJ1ZmZlcjogYnVmZmVyMgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICAgIGlmICghKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIke3RoaXMudXJsfSBmZXRjaCByZXR1cm5lZCBzdGF0dXMgMjAwLCBleHBlY3RlZCAyMDYiKTsKICAgICAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSFRUUCAiLmNvbmNhdChyZXNwb25zZS5zdGF0dXMsICIgZmV0Y2hpbmcgIikuY29uY2F0KHRoaXMudXJsKSk7CiAgICAgICAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgICAgfSkpOwogICAgICAgIGZ1bmN0aW9uIHJlYWQoX3g0KSB7CiAgICAgICAgICByZXR1cm4gX3JlYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlYWQ7CiAgICAgIH0oKQogICAgfSwgewogICAgICBrZXk6ICJyZWFkRmlsZSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX3JlYWRGaWxlID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMiQxLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IkMS5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoKSB7CiAgICAgICAgICB2YXIgb3B0aW9ucywgZW5jb2RpbmcsIG9wdHMsIF9vcHRzLCBfb3B0cyRoZWFkZXJzMiwgaGVhZGVycywgc2lnbmFsLCBfb3B0cyRvdmVycmlkZXMyLCBvdmVycmlkZXMsIGFyZ3MsIHJlc3BvbnNlLCBfYXJnczQgPSBhcmd1bWVudHM7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDEuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IF9hcmdzNC5sZW5ndGggPiAwICYmIF9hcmdzNFswXSAhPT0gdm9pZCAwID8gX2FyZ3M0WzBdIDoge307CiAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgICAgICBlbmNvZGluZyA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgb3B0cyA9IHt9OwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGVuY29kaW5nID0gb3B0aW9ucy5lbmNvZGluZzsKICAgICAgICAgICAgICAgICAgICBvcHRzID0gb3B0aW9uczsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3B0cy5lbmNvZGluZzsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBfb3B0cyA9IG9wdHMsIF9vcHRzJGhlYWRlcnMyID0gX29wdHMuaGVhZGVycywgaGVhZGVycyA9IF9vcHRzJGhlYWRlcnMyID09PSB2b2lkIDAgPyB7fSA6IF9vcHRzJGhlYWRlcnMyLCBzaWduYWwgPSBfb3B0cy5zaWduYWwsIF9vcHRzJG92ZXJyaWRlczIgPSBfb3B0cy5vdmVycmlkZXMsIG92ZXJyaWRlcyA9IF9vcHRzJG92ZXJyaWRlczIgPT09IHZvaWQgMCA/IHt9IDogX29wdHMkb3ZlcnJpZGVzMjsKICAgICAgICAgICAgICAgICAgYXJncyA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVycywKICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICJHRVQiLAogICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0OiAiZm9sbG93IiwKICAgICAgICAgICAgICAgICAgICBtb2RlOiAiY29ycyIsCiAgICAgICAgICAgICAgICAgICAgc2lnbmFsCiAgICAgICAgICAgICAgICAgIH0sIHRoaXMuYmFzZU92ZXJyaWRlcyksIG92ZXJyaWRlcyk7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmV0Y2godGhpcy51cmwsIGFyZ3MpOwogICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJnZW5lcmljLWZpbGVoYW5kbGUgZmFpbGVkIHRvIGZldGNoIik7CiAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgIGlmICghKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhyb3cgT2JqZWN0LmFzc2lnbihuZXcgRXJyb3IoIkhUVFAgIi5jb25jYXQocmVzcG9uc2Uuc3RhdHVzLCAiIGZldGNoaW5nICIpLmNvbmNhdCh0aGlzLnVybCkpLCB7CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICBpZiAoIShlbmNvZGluZyA9PT0gInV0ZjgiKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIHJlc3BvbnNlLnRleHQoKSk7CiAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICBpZiAoIWVuY29kaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxNTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInVuc3VwcG9ydGVkIGVuY29kaW5nOiAiLmNvbmNhdChlbmNvZGluZykpOwogICAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIHRoaXMuZ2V0QnVmZmVyRnJvbVJlc3BvbnNlKHJlc3BvbnNlKSk7CiAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgICAgfSkpOwogICAgICAgIGZ1bmN0aW9uIHJlYWRGaWxlKCkgewogICAgICAgICAgcmV0dXJuIF9yZWFkRmlsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVhZEZpbGU7CiAgICAgIH0oKQogICAgfSwgewogICAgICBrZXk6ICJzdGF0IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfc3RhdCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIkMS5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yJDEuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KCkgewogICAgICAgICAgdmFyIGJ1ZjsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IkMS5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICBpZiAodGhpcy5fc3RhdCkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBidWYgPSBCdWZmZXIuYWxsb2NVbnNhZmUoMTApOwogICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlYWQoYnVmLCAwLCAxMCwgMCk7CiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0KSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidW5hYmxlIHRvIGRldGVybWluZSBzaXplIG9mIGZpbGUgYXQgIi5jb25jYXQodGhpcy51cmwpKTsKICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHRoaXMuX3N0YXQpOwogICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlNSwgdGhpcyk7CiAgICAgICAgfSkpOwogICAgICAgIGZ1bmN0aW9uIHN0YXQoKSB7CiAgICAgICAgICByZXR1cm4gX3N0YXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0YXQ7CiAgICAgIH0oKQogICAgfSwgewogICAgICBrZXk6ICJjbG9zZSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX2Nsb3NlID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMiQxLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IkMS5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoKSB7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDEuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIpOwogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlNik7CiAgICAgICAgfSkpOwogICAgICAgIGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgcmV0dXJuIF9jbG9zZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2xvc2U7CiAgICAgIH0oKQogICAgfV0pOwogICAgcmV0dXJuIFJlbW90ZUZpbGUyOwogIH0oKTsKICByZW1vdGVGaWxlLmRlZmF1bHQgPSBSZW1vdGVGaWxlJDE7CiAgdmFyIGJsb2JGaWxlID0ge307CiAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSBpbnRlcm9wUmVxdWlyZURlZmF1bHQuZXhwb3J0czsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYmxvYkZpbGUsICJfX2VzTW9kdWxlIiwgewogICAgdmFsdWU6IHRydWUKICB9KTsKICBibG9iRmlsZS5kZWZhdWx0ID0gdm9pZCAwOwogIHZhciBfcmVnZW5lcmF0b3IgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlZ2VuZXJhdG9yKTsKICB2YXIgX2FzeW5jVG9HZW5lcmF0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChhc3luY1RvR2VuZXJhdG9yLmV4cG9ydHMpOwogIHZhciBfY2xhc3NDYWxsQ2hlY2syID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChjbGFzc0NhbGxDaGVjay5leHBvcnRzKTsKICB2YXIgX2NyZWF0ZUNsYXNzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoY3JlYXRlQ2xhc3MuZXhwb3J0cyk7CiAgdmFyIF9kZWZpbmVQcm9wZXJ0eTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KGRlZmluZVByb3BlcnR5JDMuZXhwb3J0cyk7CiAgZnVuY3Rpb24gcmVhZEJsb2JBc0FycmF5QnVmZmVyKGJsb2IpIHsKICAgIHZhciBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgZmlsZVJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24oKSB7CiAgICAgICAgZmlsZVJlYWRlci5hYm9ydCgpOwogICAgICAgIHJlamVjdChuZXcgRXJyb3IoInByb2JsZW0gcmVhZGluZyBibG9iIikpOwogICAgICB9OwogICAgICBmaWxlUmVhZGVyLm9uYWJvcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICByZWplY3QobmV3IEVycm9yKCJibG9iIHJlYWRpbmcgd2FzIGFib3J0ZWQiKSk7CiAgICAgIH07CiAgICAgIGZpbGVSZWFkZXIub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKGZpbGVSZWFkZXIucmVzdWx0ICYmIHR5cGVvZiBmaWxlUmVhZGVyLnJlc3VsdCAhPT0gInN0cmluZyIpIHsKICAgICAgICAgIHJlc29sdmUoZmlsZVJlYWRlci5yZXN1bHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZWplY3QobmV3IEVycm9yKCJ1bmtub3duIGVycm9yIHJlYWRpbmcgYmxvYiIpKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIGZpbGVSZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoYmxvYik7CiAgICB9KTsKICB9CiAgZnVuY3Rpb24gcmVhZEJsb2JBc1RleHQoYmxvYikgewogICAgdmFyIGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICBmaWxlUmVhZGVyLm9uZXJyb3IgPSBmdW5jdGlvbigpIHsKICAgICAgICBmaWxlUmVhZGVyLmFib3J0KCk7CiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigicHJvYmxlbSByZWFkaW5nIGJsb2IiKSk7CiAgICAgIH07CiAgICAgIGZpbGVSZWFkZXIub25hYm9ydCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJlamVjdChuZXcgRXJyb3IoImJsb2IgcmVhZGluZyB3YXMgYWJvcnRlZCIpKTsKICAgICAgfTsKICAgICAgZmlsZVJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoZmlsZVJlYWRlci5yZXN1bHQgJiYgdHlwZW9mIGZpbGVSZWFkZXIucmVzdWx0ID09PSAic3RyaW5nIikgewogICAgICAgICAgcmVzb2x2ZShmaWxlUmVhZGVyLnJlc3VsdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoInVua25vd24gZXJyb3IgcmVhZGluZyBibG9iIikpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgZmlsZVJlYWRlci5yZWFkQXNUZXh0KGJsb2IpOwogICAgfSk7CiAgfQogIHZhciBCbG9iRmlsZSA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIEJsb2JGaWxlMihibG9iKSB7CiAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syLmRlZmF1bHQpKHRoaXMsIEJsb2JGaWxlMik7CiAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyLmRlZmF1bHQpKHRoaXMsICJibG9iIiwgdm9pZCAwKTsKICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGhpcywgInNpemUiLCB2b2lkIDApOwogICAgICB0aGlzLmJsb2IgPSBibG9iOwogICAgICB0aGlzLnNpemUgPSBibG9iLnNpemU7CiAgICB9CiAgICAoMCwgX2NyZWF0ZUNsYXNzMi5kZWZhdWx0KShCbG9iRmlsZTIsIFt7CiAgICAgIGtleTogInJlYWQiLAogICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF9yZWFkID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKGJ1ZmZlcjIpIHsKICAgICAgICAgIHZhciBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24sIHN0YXJ0LCBlbmQsIHJlc3VsdCwgcmVzdWx0QnVmZmVyLCBieXRlc0NvcGllZCwgX2FyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gX2FyZ3MubGVuZ3RoID4gMSAmJiBfYXJnc1sxXSAhPT0gdm9pZCAwID8gX2FyZ3NbMV0gOiAwOwogICAgICAgICAgICAgICAgICBsZW5ndGggPSBfYXJncy5sZW5ndGggPiAyID8gX2FyZ3NbMl0gOiB2b2lkIDA7CiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gX2FyZ3MubGVuZ3RoID4gMyAmJiBfYXJnc1szXSAhPT0gdm9pZCAwID8gX2FyZ3NbM10gOiAwOwogICAgICAgICAgICAgICAgICBpZiAobGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzUmVhZDogMCwKICAgICAgICAgICAgICAgICAgICBidWZmZXI6IGJ1ZmZlcjIKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gcG9zaXRpb247CiAgICAgICAgICAgICAgICAgIGVuZCA9IHN0YXJ0ICsgbGVuZ3RoOwogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlYWRCbG9iQXNBcnJheUJ1ZmZlcih0aGlzLmJsb2Iuc2xpY2Uoc3RhcnQsIGVuZCkpOwogICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICByZXN1bHQgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgICByZXN1bHRCdWZmZXIgPSBCdWZmZXIuZnJvbShyZXN1bHQpOwogICAgICAgICAgICAgICAgICBieXRlc0NvcGllZCA9IHJlc3VsdEJ1ZmZlci5jb3B5KGJ1ZmZlcjIsIG9mZnNldCk7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgICBieXRlc1JlYWQ6IGJ5dGVzQ29waWVkLAogICAgICAgICAgICAgICAgICAgIGJ1ZmZlcjogcmVzdWx0QnVmZmVyCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgICB9KSk7CiAgICAgICAgZnVuY3Rpb24gcmVhZChfeCkgewogICAgICAgICAgcmV0dXJuIF9yZWFkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZWFkOwogICAgICB9KCkKICAgIH0sIHsKICAgICAga2V5OiAicmVhZEZpbGUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF9yZWFkRmlsZSA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIob3B0aW9ucykgewogICAgICAgICAgdmFyIGVuY29kaW5nLCByZXN1bHQ7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgICAgICBlbmNvZGluZyA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZW5jb2RpbmcgPSBvcHRpb25zICYmIG9wdGlvbnMuZW5jb2Rpbmc7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKCEoZW5jb2RpbmcgPT09ICJ1dGY4IikpIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIHJlYWRCbG9iQXNUZXh0KHRoaXMuYmxvYikpOwogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICBpZiAoIWVuY29kaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA1OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidW5zdXBwb3J0ZWQgZW5jb2Rpbmc6ICIuY29uY2F0KGVuY29kaW5nKSk7CiAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlYWRCbG9iQXNBcnJheUJ1ZmZlcih0aGlzLmJsb2IpOwogICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICByZXN1bHQgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIEJ1ZmZlci5mcm9tKHJlc3VsdCkpOwogICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgICAgfSkpOwogICAgICAgIGZ1bmN0aW9uIHJlYWRGaWxlKF94MikgewogICAgICAgICAgcmV0dXJuIF9yZWFkRmlsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVhZEZpbGU7CiAgICAgIH0oKQogICAgfSwgewogICAgICBrZXk6ICJzdGF0IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfc3RhdCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICAgc2l6ZTogdGhpcy5zaXplCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgICAgfSkpOwogICAgICAgIGZ1bmN0aW9uIHN0YXQoKSB7CiAgICAgICAgICByZXR1cm4gX3N0YXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0YXQ7CiAgICAgIH0oKQogICAgfSwgewogICAgICBrZXk6ICJjbG9zZSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX2Nsb3NlID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIpOwogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlNCk7CiAgICAgICAgfSkpOwogICAgICAgIGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgcmV0dXJuIF9jbG9zZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2xvc2U7CiAgICAgIH0oKQogICAgfV0pOwogICAgcmV0dXJuIEJsb2JGaWxlMjsKICB9KCk7CiAgYmxvYkZpbGUuZGVmYXVsdCA9IEJsb2JGaWxlOwogIHZhciBmaWxlaGFuZGxlID0gLyogQF9fUFVSRV9fICovIE9iamVjdC5mcmVlemUoewogICAgX19wcm90b19fOiBudWxsCiAgfSk7CiAgdmFyIHJlcXVpcmUkJDQgPSAvKiBAX19QVVJFX18gKi8gZ2V0QXVnbWVudGVkTmFtZXNwYWNlKGZpbGVoYW5kbGUpOwogIChmdW5jdGlvbihleHBvcnRzKSB7CiAgICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIgPSBpbnRlcm9wUmVxdWlyZURlZmF1bHQuZXhwb3J0czsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgdmFyIF9leHBvcnROYW1lcyA9IHsKICAgICAgb3BlbjogdHJ1ZSwKICAgICAgZnJvbVVybDogdHJ1ZSwKICAgICAgTG9jYWxGaWxlOiB0cnVlLAogICAgICBSZW1vdGVGaWxlOiB0cnVlLAogICAgICBCbG9iRmlsZTogdHJ1ZQogICAgfTsKICAgIGV4cG9ydHMub3BlbiA9IG9wZW47CiAgICBleHBvcnRzLmZyb21VcmwgPSBmcm9tVXJsOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJMb2NhbEZpbGUiLCB7CiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0MigpIHsKICAgICAgICByZXR1cm4gX2xvY2FsRmlsZS5kZWZhdWx0OwogICAgICB9CiAgICB9KTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiUmVtb3RlRmlsZSIsIHsKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQyKCkgewogICAgICAgIHJldHVybiBfcmVtb3RlRmlsZS5kZWZhdWx0OwogICAgICB9CiAgICB9KTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiQmxvYkZpbGUiLCB7CiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0MigpIHsKICAgICAgICByZXR1cm4gX2Jsb2JGaWxlLmRlZmF1bHQ7CiAgICAgIH0KICAgIH0pOwogICAgdmFyIF9sb2NhbEZpbGUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihyZXF1aXJlJCQxKTsKICAgIHZhciBfcmVtb3RlRmlsZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHJlbW90ZUZpbGUpOwogICAgdmFyIF9ibG9iRmlsZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGJsb2JGaWxlKTsKICAgIHZhciBfZmlsZWhhbmRsZSA9IHJlcXVpcmUkJDQ7CiAgICBPYmplY3Qua2V5cyhfZmlsZWhhbmRsZSkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgICAgaWYgKGtleSA9PT0gImRlZmF1bHQiIHx8IGtleSA9PT0gIl9fZXNNb2R1bGUiKQogICAgICAgIHJldHVybjsKICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChfZXhwb3J0TmFtZXMsIGtleSkpCiAgICAgICAgcmV0dXJuOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7CiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldDIoKSB7CiAgICAgICAgICByZXR1cm4gX2ZpbGVoYW5kbGVba2V5XTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgICBmdW5jdGlvbiBmcm9tVXJsKHNvdXJjZSkgewogICAgICB2YXIgb3B0cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgIHJldHVybiBuZXcgX3JlbW90ZUZpbGUuZGVmYXVsdChzb3VyY2UsIG9wdHMpOwogICAgfQogICAgZnVuY3Rpb24gb3BlbihtYXliZVVybCwgbWF5YmVQYXRoLCBtYXliZUZpbGVoYW5kbGUpIHsKICAgICAgdmFyIG9wdHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1szXSA6IHt9OwogICAgICBpZiAobWF5YmVGaWxlaGFuZGxlICE9PSB2b2lkIDApIHsKICAgICAgICByZXR1cm4gbWF5YmVGaWxlaGFuZGxlOwogICAgICB9CiAgICAgIGlmIChtYXliZVVybCAhPT0gdm9pZCAwKSB7CiAgICAgICAgcmV0dXJuIGZyb21VcmwobWF5YmVVcmwsIG9wdHMpOwogICAgICB9CiAgICAgIGlmIChtYXliZVBhdGggIT09IHZvaWQgMCkgewogICAgICAgIHJldHVybiBuZXcgX2xvY2FsRmlsZS5kZWZhdWx0KG1heWJlUGF0aCwgb3B0cyk7CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IEVycm9yKCJubyB1cmwsIHBhdGgsIG9yIGZpbGVoYW5kbGUgcHJvdmlkZWQsIGNhbm5vdCBvcGVuIik7CiAgICB9CiAgfSkoZGlzdCk7CiAgdmFyIHJlY29yZCA9IHt9OwogIHZhciBhbk9iamVjdCA9IGFuT2JqZWN0JGk7CiAgdmFyIHJlZ2V4cEZsYWdzID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgdGhhdCA9IGFuT2JqZWN0KHRoaXMpOwogICAgdmFyIHJlc3VsdCA9ICIiOwogICAgaWYgKHRoYXQuZ2xvYmFsKQogICAgICByZXN1bHQgKz0gImciOwogICAgaWYgKHRoYXQuaWdub3JlQ2FzZSkKICAgICAgcmVzdWx0ICs9ICJpIjsKICAgIGlmICh0aGF0Lm11bHRpbGluZSkKICAgICAgcmVzdWx0ICs9ICJtIjsKICAgIGlmICh0aGF0LmRvdEFsbCkKICAgICAgcmVzdWx0ICs9ICJzIjsKICAgIGlmICh0aGF0LnVuaWNvZGUpCiAgICAgIHJlc3VsdCArPSAidSI7CiAgICBpZiAodGhhdC5zdGlja3kpCiAgICAgIHJlc3VsdCArPSAieSI7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CiAgdmFyIGZsYWdzJDMgPSByZWdleHBGbGFnczsKICB2YXIgZmxhZ3NfMSQxID0gZnVuY3Rpb24oaXQpIHsKICAgIHJldHVybiBmbGFncyQzLmNhbGwoaXQpOwogIH07CiAgdmFyIGZsYWdzJDIgPSBmbGFnc18xJDE7CiAgdmFyIFJlZ0V4cFByb3RvdHlwZSA9IFJlZ0V4cC5wcm90b3R5cGU7CiAgdmFyIGZsYWdzXzEgPSBmdW5jdGlvbihpdCkgewogICAgcmV0dXJuIChpdCA9PT0gUmVnRXhwUHJvdG90eXBlIHx8IGl0IGluc3RhbmNlb2YgUmVnRXhwKSAmJiAhKCJmbGFncyIgaW4gaXQpID8gZmxhZ3MkMihpdCkgOiBpdC5mbGFnczsKICB9OwogIHZhciBwYXJlbnQkNiA9IGZsYWdzXzE7CiAgdmFyIGZsYWdzJDEgPSBwYXJlbnQkNjsKICB2YXIgZmxhZ3MgPSBmbGFncyQxOwogIHZhciB3aGl0ZXNwYWNlcyQyID0gIglcblx2XGZcciBceEEwXHUxNjgwXHUyMDAwXHUyMDAxXHUyMDAyXHUyMDAzXHUyMDA0XHUyMDA1XHUyMDA2XHUyMDA3XHUyMDA4XHUyMDA5XHUyMDBBXHUyMDJGXHUyMDVGXHUzMDAwXHUyMDI4XHUyMDI5XHVGRUZGIjsKICB2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSQxID0gcmVxdWlyZU9iamVjdENvZXJjaWJsZSQ1OwogIHZhciB0b1N0cmluZyQyID0gdG9TdHJpbmckYTsKICB2YXIgd2hpdGVzcGFjZXMkMSA9IHdoaXRlc3BhY2VzJDI7CiAgdmFyIHdoaXRlc3BhY2UgPSAiWyIgKyB3aGl0ZXNwYWNlcyQxICsgIl0iOwogIHZhciBsdHJpbSA9IFJlZ0V4cCgiXiIgKyB3aGl0ZXNwYWNlICsgd2hpdGVzcGFjZSArICIqIik7CiAgdmFyIHJ0cmltID0gUmVnRXhwKHdoaXRlc3BhY2UgKyB3aGl0ZXNwYWNlICsgIiokIik7CiAgdmFyIGNyZWF0ZU1ldGhvZCA9IGZ1bmN0aW9uKFRZUEUyKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oJHRoaXMpIHsKICAgICAgdmFyIHN0cmluZyA9IHRvU3RyaW5nJDIocmVxdWlyZU9iamVjdENvZXJjaWJsZSQxKCR0aGlzKSk7CiAgICAgIGlmIChUWVBFMiAmIDEpCiAgICAgICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UobHRyaW0sICIiKTsKICAgICAgaWYgKFRZUEUyICYgMikKICAgICAgICBzdHJpbmcgPSBzdHJpbmcucmVwbGFjZShydHJpbSwgIiIpOwogICAgICByZXR1cm4gc3RyaW5nOwogICAgfTsKICB9OwogIHZhciBzdHJpbmdUcmltID0gewogICAgc3RhcnQ6IGNyZWF0ZU1ldGhvZCgxKSwKICAgIGVuZDogY3JlYXRlTWV0aG9kKDIpLAogICAgdHJpbTogY3JlYXRlTWV0aG9kKDMpCiAgfTsKICB2YXIgZ2xvYmFsJDEgPSBnbG9iYWwkbzsKICB2YXIgZmFpbHMgPSBmYWlscyRuOwogIHZhciB0b1N0cmluZyQxID0gdG9TdHJpbmckYTsKICB2YXIgdHJpbSA9IHN0cmluZ1RyaW0udHJpbTsKICB2YXIgd2hpdGVzcGFjZXMgPSB3aGl0ZXNwYWNlcyQyOwogIHZhciAkcGFyc2VJbnQkMSA9IGdsb2JhbCQxLnBhcnNlSW50OwogIHZhciBTeW1ib2wkMSA9IGdsb2JhbCQxLlN5bWJvbDsKICB2YXIgSVRFUkFUT1IgPSBTeW1ib2wkMSAmJiBTeW1ib2wkMS5pdGVyYXRvcjsKICB2YXIgaGV4ID0gL15bKy1dPzBbWHhdLzsKICB2YXIgRk9SQ0VEID0gJHBhcnNlSW50JDEod2hpdGVzcGFjZXMgKyAiMDgiKSAhPT0gOCB8fCAkcGFyc2VJbnQkMSh3aGl0ZXNwYWNlcyArICIweDE2IikgIT09IDIyIHx8IElURVJBVE9SICYmICFmYWlscyhmdW5jdGlvbigpIHsKICAgICRwYXJzZUludCQxKE9iamVjdChJVEVSQVRPUikpOwogIH0pOwogIHZhciBudW1iZXJQYXJzZUludCA9IEZPUkNFRCA/IGZ1bmN0aW9uIHBhcnNlSW50MihzdHJpbmcsIHJhZGl4KSB7CiAgICB2YXIgUyA9IHRyaW0odG9TdHJpbmckMShzdHJpbmcpKTsKICAgIHJldHVybiAkcGFyc2VJbnQkMShTLCByYWRpeCA+Pj4gMCB8fCAoaGV4LnRlc3QoUykgPyAxNiA6IDEwKSk7CiAgfSA6ICRwYXJzZUludCQxOwogIHZhciAkJDIgPSBfZXhwb3J0OwogIHZhciAkcGFyc2VJbnQgPSBudW1iZXJQYXJzZUludDsKICAkJDIoeyBnbG9iYWw6IHRydWUsIGZvcmNlZDogcGFyc2VJbnQgIT0gJHBhcnNlSW50IH0sIHsKICAgIHBhcnNlSW50OiAkcGFyc2VJbnQKICB9KTsKICB2YXIgcGF0aCA9IHBhdGgkbjsKICB2YXIgX3BhcnNlSW50JDIgPSBwYXRoLnBhcnNlSW50OwogIHZhciBwYXJlbnQkNSA9IF9wYXJzZUludCQyOwogIHZhciBfcGFyc2VJbnQkMSA9IHBhcmVudCQ1OwogIHZhciBfcGFyc2VJbnQgPSBfcGFyc2VJbnQkMTsKICB2YXIgY29uc3RhbnRzID0ge307CiAgKGZ1bmN0aW9uKGV4cG9ydHMpIHsKICAgIHZhciBfT2JqZWN0JGRlZmluZVByb3BlcnR5ID0gZGVmaW5lUHJvcGVydHkkOTsKICAgIF9PYmplY3QkZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDsKICAgIHZhciBfZGVmYXVsdDIgPSB7CiAgICAgIEJBTV9GUEFJUkVEOiAxLAogICAgICBCQU1fRlBST1BFUl9QQUlSOiAyLAogICAgICBCQU1fRlVOTUFQOiA0LAogICAgICBCQU1fRk1VTk1BUDogOCwKICAgICAgQkFNX0ZSRVZFUlNFOiAxNiwKICAgICAgQkFNX0ZNUkVWRVJTRTogMzIsCiAgICAgIEJBTV9GUkVBRDE6IDY0LAogICAgICBCQU1fRlJFQUQyOiAxMjgsCiAgICAgIEJBTV9GU0VDT05EQVJZOiAyNTYsCiAgICAgIEJBTV9GUUNGQUlMOiA1MTIsCiAgICAgIEJBTV9GRFVQOiAxMDI0LAogICAgICBCQU1fRlNVUFBMRU1FTlRBUlk6IDIwNDgKICAgIH07CiAgICBleHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDI7CiAgfSkoY29uc3RhbnRzKTsKICAoZnVuY3Rpb24oZXhwb3J0cykgewogICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyID0gaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDEuZXhwb3J0czsKICAgIHZhciBfT2JqZWN0JGRlZmluZVByb3BlcnR5ID0gZGVmaW5lUHJvcGVydHkkOTsKICAgIF9PYmplY3QkZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDsKICAgIHZhciBfZmxhZ3MyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZmxhZ3MpOwogICAgdmFyIF9wYXJzZUludDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihfcGFyc2VJbnQpOwogICAgdmFyIF9maWx0ZXIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihmaWx0ZXIpOwogICAgdmFyIF9rZXlzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoa2V5cyQyKTsKICAgIHZhciBfZm9yRWFjaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGZvckVhY2gkMSk7CiAgICB2YXIgX2NvbmNhdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGNvbmNhdCk7CiAgICB2YXIgX2NsYXNzQ2FsbENoZWNrMjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihjbGFzc0NhbGxDaGVjayQxLmV4cG9ydHMpOwogICAgdmFyIF9jcmVhdGVDbGFzczIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoY3JlYXRlQ2xhc3MkMS5leHBvcnRzKTsKICAgIHZhciBfZGVmaW5lUHJvcGVydHkyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGRlZmluZVByb3BlcnR5JDYuZXhwb3J0cyk7CiAgICB2YXIgX21hcCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKG1hcCk7CiAgICB2YXIgX2NvbnN0YW50cyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGNvbnN0YW50cyk7CiAgICB2YXIgX2NvbnRleHQ7CiAgICB2YXIgU0VRUkVUX0RFQ09ERVIgPSAoMCwgX21hcC5kZWZhdWx0KShfY29udGV4dCA9ICI9QUNNR1JTVlRXWUhLREJOIi5zcGxpdCgiIikpLmNhbGwoX2NvbnRleHQsIGZ1bmN0aW9uKHMpIHsKICAgICAgcmV0dXJuIHMuY2hhckNvZGVBdCgwKTsKICAgIH0pOwogICAgdmFyIENJR0FSX0RFQ09ERVIgPSAiTUlETlNIUD1YPz8/Pz8/PyIuc3BsaXQoIiIpOwogICAgdmFyIEJhbVJlY29yZCA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgICAgZnVuY3Rpb24gQmFtUmVjb3JkMihhcmdzKSB7CiAgICAgICAgKDAsIF9jbGFzc0NhbGxDaGVjazIyLmRlZmF1bHQpKHRoaXMsIEJhbVJlY29yZDIpOwogICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyMi5kZWZhdWx0KSh0aGlzLCAiZGF0YSIsIHZvaWQgMCk7CiAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIyLmRlZmF1bHQpKHRoaXMsICJieXRlcyIsIHZvaWQgMCk7CiAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIyLmRlZmF1bHQpKHRoaXMsICJmbGFncyIsIHZvaWQgMCk7CiAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIyLmRlZmF1bHQpKHRoaXMsICJfaWQiLCB2b2lkIDApOwogICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyMi5kZWZhdWx0KSh0aGlzLCAiX3JlZklEIiwgdm9pZCAwKTsKICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5MjIuZGVmYXVsdCkodGhpcywgIl90YWdPZmZzZXQiLCB2b2lkIDApOwogICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyMi5kZWZhdWx0KSh0aGlzLCAiX3RhZ0xpc3QiLCBbXSk7CiAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIyLmRlZmF1bHQpKHRoaXMsICJfYWxsVGFnc1BhcnNlZCIsIGZhbHNlKTsKICAgICAgICB0aGlzLmRhdGEgPSB7fTsKICAgICAgICB0aGlzLmJ5dGVzID0gewogICAgICAgICAgc3RhcnQ6IGFyZ3MuYnl0ZXMuc3RhcnQsCiAgICAgICAgICBlbmQ6IGFyZ3MuYnl0ZXMuZW5kLAogICAgICAgICAgYnl0ZUFycmF5OiBhcmdzLmJ5dGVzLmJ5dGVBcnJheQogICAgICAgIH07CiAgICAgICAgdGhpcy5faWQgPSBhcmdzLmZpbGVPZmZzZXQ7CiAgICAgICAgdmFyIF90aGlzJGJ5dGVzID0gdGhpcy5ieXRlcywgc3RhcnQgPSBfdGhpcyRieXRlcy5zdGFydCwgYnl0ZUFycmF5ID0gX3RoaXMkYnl0ZXMuYnl0ZUFycmF5OwogICAgICAgIHRoaXMuX3JlZklEID0gYnl0ZUFycmF5LnJlYWRJbnQzMkxFKHN0YXJ0ICsgNCk7CiAgICAgICAgdGhpcy5kYXRhLnN0YXJ0ID0gYnl0ZUFycmF5LnJlYWRJbnQzMkxFKHN0YXJ0ICsgOCk7CiAgICAgICAgdGhpcy5mbGFncyA9IChieXRlQXJyYXkucmVhZEludDMyTEUoc3RhcnQgKyAxNikgJiA0Mjk0OTAxNzYwKSA+PiAxNjsKICAgICAgfQogICAgICAoMCwgX2NyZWF0ZUNsYXNzMjIuZGVmYXVsdCkoQmFtUmVjb3JkMiwgW3sKICAgICAgICBrZXk6ICJnZXQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXQyKGZpZWxkKSB7CiAgICAgICAgICBpZiAodGhpc1tmaWVsZF0pIHsKICAgICAgICAgICAgaWYgKHRoaXMuZGF0YVtmaWVsZF0pIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhW2ZpZWxkXTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmRhdGFbZmllbGRdID0gdGhpc1tmaWVsZF0oKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVtmaWVsZF07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0KGZpZWxkLnRvTG93ZXJDYXNlKCkpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImVuZCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGVuZCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmdldCgic3RhcnQiKSArICh0aGlzLmdldCgibGVuZ3RoX29uX3JlZiIpIHx8IHRoaXMuZ2V0KCJzZXFfbGVuZ3RoIikgfHwgdm9pZCAwKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJzZXFfaWQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXFfaWQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fcmVmSUQ7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX2dldCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXQyKGZpZWxkKSB7CiAgICAgICAgICBpZiAoZmllbGQgaW4gdGhpcy5kYXRhKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRhdGFbZmllbGRdOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5kYXRhW2ZpZWxkXSA9IHRoaXMuX3BhcnNlVGFnKGZpZWxkKTsKICAgICAgICAgIHJldHVybiB0aGlzLmRhdGFbZmllbGRdOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogIl90YWdzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3RhZ3MoKSB7CiAgICAgICAgICB2YXIgX2NvbnRleHQyLCBfdGhpcyA9IHRoaXM7CiAgICAgICAgICB0aGlzLl9wYXJzZUFsbFRhZ3MoKTsKICAgICAgICAgIHZhciB0YWdzID0gWyJzZXEiXTsKICAgICAgICAgIGlmICghdGhpcy5pc1NlZ21lbnRVbm1hcHBlZCgpKSB7CiAgICAgICAgICAgIHRhZ3MucHVzaCgic3RhcnQiLCAiZW5kIiwgInN0cmFuZCIsICJzY29yZSIsICJxdWFsIiwgIk1RIiwgIkNJR0FSIiwgImxlbmd0aF9vbl9yZWYiLCAidGVtcGxhdGVfbGVuZ3RoIik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5pc1BhaXJlZCgpKSB7CiAgICAgICAgICAgIHRhZ3MucHVzaCgibmV4dF9zZWdtZW50X3Bvc2l0aW9uIiwgInBhaXJfb3JpZW50YXRpb24iKTsKICAgICAgICAgIH0KICAgICAgICAgIHRhZ3MgPSAoMCwgX2NvbmNhdC5kZWZhdWx0KSh0YWdzKS5jYWxsKHRhZ3MsIHRoaXMuX3RhZ0xpc3QgfHwgW10pOwogICAgICAgICAgKDAsIF9mb3JFYWNoLmRlZmF1bHQpKF9jb250ZXh0MiA9ICgwLCBfa2V5cy5kZWZhdWx0KSh0aGlzLmRhdGEpKS5jYWxsKF9jb250ZXh0MiwgZnVuY3Rpb24oaykgewogICAgICAgICAgICBpZiAoa1swXSAhPT0gIl8iICYmIGsgIT09ICJuZXh0X3NlcV9pZCIpIHsKICAgICAgICAgICAgICB0YWdzLnB1c2goayk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIHNlZW4gPSB7fTsKICAgICAgICAgIHRhZ3MgPSAoMCwgX2ZpbHRlci5kZWZhdWx0KSh0YWdzKS5jYWxsKHRhZ3MsIGZ1bmN0aW9uKHQpIHsKICAgICAgICAgICAgaWYgKHQgaW4gX3RoaXMuZGF0YSAmJiBfdGhpcy5kYXRhW3RdID09PSB2b2lkIDAgfHwgdCA9PT0gIkNHIiB8fCB0ID09PSAiY2ciKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBsdCA9IHQudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgdmFyIHMgPSBzZWVuW2x0XTsKICAgICAgICAgICAgc2VlbltsdF0gPSB0cnVlOwogICAgICAgICAgICByZXR1cm4gIXM7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiB0YWdzOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInBhcmVudCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBhcmVudDIoKSB7CiAgICAgICAgICByZXR1cm4gdm9pZCAwOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImNoaWxkcmVuIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gY2hpbGRyZW4oKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoInN1YmZlYXR1cmVzIik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaWQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpZDIoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5faWQ7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAibXEiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBtcSgpIHsKICAgICAgICAgIHZhciBtcTIgPSAodGhpcy5nZXQoIl9iaW5fbXFfbmwiKSAmIDY1MjgwKSA+PiA4OwogICAgICAgICAgcmV0dXJuIG1xMiA9PT0gMjU1ID8gdm9pZCAwIDogbXEyOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogInNjb3JlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gc2NvcmUoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoIm1xIik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAicXVhbCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHF1YWwoKSB7CiAgICAgICAgICB2YXIgX3RoaXMkcXVhbFJhdzsKICAgICAgICAgIHJldHVybiAoX3RoaXMkcXVhbFJhdyA9IHRoaXMucXVhbFJhdygpKSA9PT0gbnVsbCB8fCBfdGhpcyRxdWFsUmF3ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRxdWFsUmF3LmpvaW4oIiAiKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJxdWFsUmF3IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gcXVhbFJhdygpIHsKICAgICAgICAgIGlmICh0aGlzLmlzU2VnbWVudFVubWFwcGVkKCkpIHsKICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBieXRlQXJyYXkgPSB0aGlzLmJ5dGVzLmJ5dGVBcnJheTsKICAgICAgICAgIHZhciBwID0gdGhpcy5ieXRlcy5zdGFydCArIDM2ICsgdGhpcy5nZXQoIl9sX3JlYWRfbmFtZSIpICsgdGhpcy5nZXQoIl9uX2NpZ2FyX29wIikgKiA0ICsgdGhpcy5nZXQoIl9zZXFfYnl0ZXMiKTsKICAgICAgICAgIHZhciBsc2VxID0gdGhpcy5nZXQoInNlcV9sZW5ndGgiKTsKICAgICAgICAgIHZhciBxc2VxID0gQnVmZmVyLmFsbG9jVW5zYWZlKGxzZXEpOwogICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBsc2VxOyArK2opIHsKICAgICAgICAgICAgcXNlcVtqXSA9IGJ5dGVBcnJheVtwICsgal07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcXNlcTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJzdHJhbmQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzdHJhbmQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5pc1JldmVyc2VDb21wbGVtZW50ZWQoKSA/IC0xIDogMTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJtdWx0aV9zZWdtZW50X25leHRfc2VnbWVudF9zdHJhbmQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBtdWx0aV9zZWdtZW50X25leHRfc2VnbWVudF9zdHJhbmQoKSB7CiAgICAgICAgICBpZiAodGhpcy5pc01hdGVVbm1hcHBlZCgpKSB7CiAgICAgICAgICAgIHJldHVybiB2b2lkIDA7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGhpcy5pc01hdGVSZXZlcnNlQ29tcGxlbWVudGVkKCkgPyAtMSA6IDE7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAibmFtZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG5hbWUoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoIl9yZWFkX25hbWUiKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfcmVhZF9uYW1lIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3JlYWRfbmFtZSgpIHsKICAgICAgICAgIHZhciBubCA9IHRoaXMuZ2V0KCJfbF9yZWFkX25hbWUiKTsKICAgICAgICAgIHJldHVybiB0aGlzLmJ5dGVzLmJ5dGVBcnJheS50b1N0cmluZygiYXNjaWkiLCB0aGlzLmJ5dGVzLnN0YXJ0ICsgMzYsIHRoaXMuYnl0ZXMuc3RhcnQgKyAzNiArIG5sIC0gMSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX3BhcnNlVGFnIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3BhcnNlVGFnKHRhZ05hbWUpIHsKICAgICAgICAgIGlmICh0aGlzLl9hbGxUYWdzUGFyc2VkKSB7CiAgICAgICAgICAgIHJldHVybiB2b2lkIDA7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgYnl0ZUFycmF5ID0gdGhpcy5ieXRlcy5ieXRlQXJyYXk7CiAgICAgICAgICB2YXIgcCA9IHRoaXMuX3RhZ09mZnNldCB8fCB0aGlzLmJ5dGVzLnN0YXJ0ICsgMzYgKyB0aGlzLmdldCgiX2xfcmVhZF9uYW1lIikgKyB0aGlzLmdldCgiX25fY2lnYXJfb3AiKSAqIDQgKyB0aGlzLmdldCgiX3NlcV9ieXRlcyIpICsgdGhpcy5nZXQoInNlcV9sZW5ndGgiKTsKICAgICAgICAgIHZhciBibG9ja0VuZCA9IHRoaXMuYnl0ZXMuZW5kOwogICAgICAgICAgdmFyIGxjVGFnOwogICAgICAgICAgd2hpbGUgKHAgPCBibG9ja0VuZCAmJiBsY1RhZyAhPT0gdGFnTmFtZSkgewogICAgICAgICAgICB2YXIgdGFnID0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlQXJyYXlbcF0sIGJ5dGVBcnJheVtwICsgMV0pOwogICAgICAgICAgICBsY1RhZyA9IHRhZy50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICB2YXIgdHlwZSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnl0ZUFycmF5W3AgKyAyXSk7CiAgICAgICAgICAgIHAgKz0gMzsKICAgICAgICAgICAgdmFyIHZhbHVlID0gdm9pZCAwOwogICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgICBjYXNlICJBIjoKICAgICAgICAgICAgICAgIHZhbHVlID0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlQXJyYXlbcF0pOwogICAgICAgICAgICAgICAgcCArPSAxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAiaSI6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGJ5dGVBcnJheS5yZWFkSW50MzJMRShwKTsKICAgICAgICAgICAgICAgIHAgKz0gNDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIkkiOgogICAgICAgICAgICAgICAgdmFsdWUgPSBieXRlQXJyYXkucmVhZFVJbnQzMkxFKHApOwogICAgICAgICAgICAgICAgcCArPSA0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAiYyI6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGJ5dGVBcnJheS5yZWFkSW50OChwKTsKICAgICAgICAgICAgICAgIHAgKz0gMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIkMiOgogICAgICAgICAgICAgICAgdmFsdWUgPSBieXRlQXJyYXkucmVhZFVJbnQ4KHApOwogICAgICAgICAgICAgICAgcCArPSAxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAicyI6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGJ5dGVBcnJheS5yZWFkSW50MTZMRShwKTsKICAgICAgICAgICAgICAgIHAgKz0gMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIlMiOgogICAgICAgICAgICAgICAgdmFsdWUgPSBieXRlQXJyYXkucmVhZFVJbnQxNkxFKHApOwogICAgICAgICAgICAgICAgcCArPSAyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAiZiI6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGJ5dGVBcnJheS5yZWFkRmxvYXRMRShwKTsKICAgICAgICAgICAgICAgIHAgKz0gNDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIloiOgogICAgICAgICAgICAgIGNhc2UgIkgiOgogICAgICAgICAgICAgICAgdmFsdWUgPSAiIjsKICAgICAgICAgICAgICAgIHdoaWxlIChwIDw9IGJsb2NrRW5kKSB7CiAgICAgICAgICAgICAgICAgIHZhciBjYyA9IGJ5dGVBcnJheVtwKytdOwogICAgICAgICAgICAgICAgICBpZiAoY2MgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNjKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAiQiI6IHsKICAgICAgICAgICAgICAgIHZhbHVlID0gIiI7CiAgICAgICAgICAgICAgICB2YXIgX2NjID0gYnl0ZUFycmF5W3ArK107CiAgICAgICAgICAgICAgICB2YXIgQnR5cGUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKF9jYyk7CiAgICAgICAgICAgICAgICB2YXIgbGltaXQgPSBieXRlQXJyYXkucmVhZEludDMyTEUocCk7CiAgICAgICAgICAgICAgICBwICs9IDQ7CiAgICAgICAgICAgICAgICBpZiAoQnR5cGUgPT09ICJpIikgewogICAgICAgICAgICAgICAgICBpZiAodGFnID09PSAiQ0ciKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBsaW1pdDsgaysrKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgY2lnb3AgPSBieXRlQXJyYXkucmVhZEludDMyTEUocCk7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgbG9wID0gY2lnb3AgPj4gNDsKICAgICAgICAgICAgICAgICAgICAgIHZhciBvcCA9IENJR0FSX0RFQ09ERVJbY2lnb3AgJiAxNV07CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSBsb3AgKyBvcDsKICAgICAgICAgICAgICAgICAgICAgIHAgKz0gNDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2sgPSAwOyBfayA8IGxpbWl0OyBfaysrKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSBieXRlQXJyYXkucmVhZEludDMyTEUocCk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoX2sgKyAxIDwgbGltaXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gIiwiOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcCArPSA0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKEJ0eXBlID09PSAiSSIpIHsKICAgICAgICAgICAgICAgICAgaWYgKHRhZyA9PT0gIkNHIikgewogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9rMiA9IDA7IF9rMiA8IGxpbWl0OyBfazIrKykgewogICAgICAgICAgICAgICAgICAgICAgdmFyIF9jaWdvcCA9IGJ5dGVBcnJheS5yZWFkVUludDMyTEUocCk7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgX2xvcCA9IF9jaWdvcCA+PiA0OwogICAgICAgICAgICAgICAgICAgICAgdmFyIF9vcCA9IENJR0FSX0RFQ09ERVJbX2NpZ29wICYgMTVdOwogICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gX2xvcCArIF9vcDsKICAgICAgICAgICAgICAgICAgICAgIHAgKz0gNDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2szID0gMDsgX2szIDwgbGltaXQ7IF9rMysrKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSBieXRlQXJyYXkucmVhZFVJbnQzMkxFKHApOwogICAgICAgICAgICAgICAgICAgICAgaWYgKF9rMyArIDEgPCBsaW1pdCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSAiLCI7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBwICs9IDQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoQnR5cGUgPT09ICJzIikgewogICAgICAgICAgICAgICAgICBmb3IgKHZhciBfazQgPSAwOyBfazQgPCBsaW1pdDsgX2s0KyspIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSBieXRlQXJyYXkucmVhZEludDE2TEUocCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9rNCArIDEgPCBsaW1pdCkgewogICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gIiwiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwICs9IDI7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChCdHlwZSA9PT0gIlMiKSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9rNSA9IDA7IF9rNSA8IGxpbWl0OyBfazUrKykgewogICAgICAgICAgICAgICAgICAgIHZhbHVlICs9IGJ5dGVBcnJheS5yZWFkVUludDE2TEUocCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9rNSArIDEgPCBsaW1pdCkgewogICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gIiwiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwICs9IDI7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChCdHlwZSA9PT0gImMiKSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9rNiA9IDA7IF9rNiA8IGxpbWl0OyBfazYrKykgewogICAgICAgICAgICAgICAgICAgIHZhbHVlICs9IGJ5dGVBcnJheS5yZWFkSW50OChwKTsKICAgICAgICAgICAgICAgICAgICBpZiAoX2s2ICsgMSA8IGxpbWl0KSB7CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSAiLCI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHAgKz0gMTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKEJ0eXBlID09PSAiQyIpIHsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2s3ID0gMDsgX2s3IDwgbGltaXQ7IF9rNysrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gYnl0ZUFycmF5LnJlYWRVSW50OChwKTsKICAgICAgICAgICAgICAgICAgICBpZiAoX2s3ICsgMSA8IGxpbWl0KSB7CiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSAiLCI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHAgKz0gMTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKEJ0eXBlID09PSAiZiIpIHsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2s4ID0gMDsgX2s4IDwgbGltaXQ7IF9rOCsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gYnl0ZUFycmF5LnJlYWRGbG9hdExFKHApOwogICAgICAgICAgICAgICAgICAgIGlmIChfazggKyAxIDwgbGltaXQpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9ICIsIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcCArPSA0OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5rbm93biBCQU0gdGFnIHR5cGUgJyIuY29uY2F0KHR5cGUsICInLCB0YWdzIG1heSBiZSBpbmNvbXBsZXRlIikpOwogICAgICAgICAgICAgICAgdmFsdWUgPSB2b2lkIDA7CiAgICAgICAgICAgICAgICBwID0gYmxvY2tFbmQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fdGFnT2Zmc2V0ID0gcDsKICAgICAgICAgICAgdGhpcy5fdGFnTGlzdC5wdXNoKHRhZyk7CiAgICAgICAgICAgIGlmIChsY1RhZyA9PT0gdGFnTmFtZSkgewogICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmRhdGFbbGNUYWddID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLl9hbGxUYWdzUGFyc2VkID0gdHJ1ZTsKICAgICAgICAgIHJldHVybiB2b2lkIDA7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX3BhcnNlQWxsVGFncyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9wYXJzZUFsbFRhZ3MoKSB7CiAgICAgICAgICB0aGlzLl9wYXJzZVRhZygiIik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX3BhcnNlQ2lnYXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcGFyc2VDaWdhcihjaWdhcikgewogICAgICAgICAgdmFyIF9jb250ZXh0MzsKICAgICAgICAgIHJldHVybiAoMCwgX21hcC5kZWZhdWx0KShfY29udGV4dDMgPSBjaWdhci5tYXRjaCgvXGQrXEQvZykpLmNhbGwoX2NvbnRleHQzLCBmdW5jdGlvbihvcCkgewogICAgICAgICAgICByZXR1cm4gW29wLm1hdGNoKC9cRC8pWzBdLnRvVXBwZXJDYXNlKCksICgwLCBfcGFyc2VJbnQyLmRlZmF1bHQpKG9wLCAxMCldOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaXNQYWlyZWQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc1BhaXJlZCgpIHsKICAgICAgICAgIHJldHVybiAhISgoMCwgX2ZsYWdzMi5kZWZhdWx0KSh0aGlzKSAmIF9jb25zdGFudHMuZGVmYXVsdC5CQU1fRlBBSVJFRCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaXNQcm9wZXJseVBhaXJlZCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzUHJvcGVybHlQYWlyZWQoKSB7CiAgICAgICAgICByZXR1cm4gISEoKDAsIF9mbGFnczIuZGVmYXVsdCkodGhpcykgJiBfY29uc3RhbnRzLmRlZmF1bHQuQkFNX0ZQUk9QRVJfUEFJUik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaXNTZWdtZW50VW5tYXBwZWQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc1NlZ21lbnRVbm1hcHBlZCgpIHsKICAgICAgICAgIHJldHVybiAhISgoMCwgX2ZsYWdzMi5kZWZhdWx0KSh0aGlzKSAmIF9jb25zdGFudHMuZGVmYXVsdC5CQU1fRlVOTUFQKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc01hdGVVbm1hcHBlZCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzTWF0ZVVubWFwcGVkKCkgewogICAgICAgICAgcmV0dXJuICEhKCgwLCBfZmxhZ3MyLmRlZmF1bHQpKHRoaXMpICYgX2NvbnN0YW50cy5kZWZhdWx0LkJBTV9GTVVOTUFQKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc1JldmVyc2VDb21wbGVtZW50ZWQiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc1JldmVyc2VDb21wbGVtZW50ZWQoKSB7CiAgICAgICAgICByZXR1cm4gISEoKDAsIF9mbGFnczIuZGVmYXVsdCkodGhpcykgJiBfY29uc3RhbnRzLmRlZmF1bHQuQkFNX0ZSRVZFUlNFKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc01hdGVSZXZlcnNlQ29tcGxlbWVudGVkIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNNYXRlUmV2ZXJzZUNvbXBsZW1lbnRlZCgpIHsKICAgICAgICAgIHJldHVybiAhISgoMCwgX2ZsYWdzMi5kZWZhdWx0KSh0aGlzKSAmIF9jb25zdGFudHMuZGVmYXVsdC5CQU1fRk1SRVZFUlNFKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc1JlYWQxIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNSZWFkMSgpIHsKICAgICAgICAgIHJldHVybiAhISgoMCwgX2ZsYWdzMi5kZWZhdWx0KSh0aGlzKSAmIF9jb25zdGFudHMuZGVmYXVsdC5CQU1fRlJFQUQxKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc1JlYWQyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNSZWFkMigpIHsKICAgICAgICAgIHJldHVybiAhISgoMCwgX2ZsYWdzMi5kZWZhdWx0KSh0aGlzKSAmIF9jb25zdGFudHMuZGVmYXVsdC5CQU1fRlJFQUQyKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc1NlY29uZGFyeSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzU2Vjb25kYXJ5KCkgewogICAgICAgICAgcmV0dXJuICEhKCgwLCBfZmxhZ3MyLmRlZmF1bHQpKHRoaXMpICYgX2NvbnN0YW50cy5kZWZhdWx0LkJBTV9GU0VDT05EQVJZKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJpc0ZhaWxlZFFjIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNGYWlsZWRRYygpIHsKICAgICAgICAgIHJldHVybiAhISgoMCwgX2ZsYWdzMi5kZWZhdWx0KSh0aGlzKSAmIF9jb25zdGFudHMuZGVmYXVsdC5CQU1fRlFDRkFJTCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaXNEdXBsaWNhdGUiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc0R1cGxpY2F0ZSgpIHsKICAgICAgICAgIHJldHVybiAhISgoMCwgX2ZsYWdzMi5kZWZhdWx0KSh0aGlzKSAmIF9jb25zdGFudHMuZGVmYXVsdC5CQU1fRkRVUCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaXNTdXBwbGVtZW50YXJ5IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaXNTdXBwbGVtZW50YXJ5KCkgewogICAgICAgICAgcmV0dXJuICEhKCgwLCBfZmxhZ3MyLmRlZmF1bHQpKHRoaXMpICYgX2NvbnN0YW50cy5kZWZhdWx0LkJBTV9GU1VQUExFTUVOVEFSWSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiY2lnYXIiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjaWdhcigpIHsKICAgICAgICAgIGlmICh0aGlzLmlzU2VnbWVudFVubWFwcGVkKCkpIHsKICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBfdGhpcyRieXRlczIgPSB0aGlzLmJ5dGVzLCBieXRlQXJyYXkgPSBfdGhpcyRieXRlczIuYnl0ZUFycmF5LCBzdGFydCA9IF90aGlzJGJ5dGVzMi5zdGFydDsKICAgICAgICAgIHZhciBudW1DaWdhck9wcyA9IHRoaXMuZ2V0KCJfbl9jaWdhcl9vcCIpOwogICAgICAgICAgdmFyIHAgPSBzdGFydCArIDM2ICsgdGhpcy5nZXQoIl9sX3JlYWRfbmFtZSIpOwogICAgICAgICAgdmFyIHNlcUxlbiA9IHRoaXMuZ2V0KCJzZXFfbGVuZ3RoIik7CiAgICAgICAgICB2YXIgY2lnYXIyID0gIiI7CiAgICAgICAgICB2YXIgbHJlZiA9IDA7CiAgICAgICAgICB2YXIgY2lnb3AgPSBieXRlQXJyYXkucmVhZEludDMyTEUocCk7CiAgICAgICAgICB2YXIgbG9wID0gY2lnb3AgPj4gNDsKICAgICAgICAgIHZhciBvcCA9IENJR0FSX0RFQ09ERVJbY2lnb3AgJiAxNV07CiAgICAgICAgICBpZiAob3AgPT09ICJTIiAmJiBsb3AgPT09IHNlcUxlbikgewogICAgICAgICAgICBwICs9IDQ7CiAgICAgICAgICAgIGNpZ29wID0gYnl0ZUFycmF5LnJlYWRJbnQzMkxFKHApOwogICAgICAgICAgICBsb3AgPSBjaWdvcCA+PiA0OwogICAgICAgICAgICBvcCA9IENJR0FSX0RFQ09ERVJbY2lnb3AgJiAxNV07CiAgICAgICAgICAgIGlmIChvcCAhPT0gIk4iKSB7CiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJDRyB0YWcgd2l0aCBubyBOIHRhZyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuZGF0YS5sZW5ndGhfb25fcmVmID0gbG9wOwogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoIkNHIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKHZhciBjMiA9IDA7IGMyIDwgbnVtQ2lnYXJPcHM7ICsrYzIpIHsKICAgICAgICAgICAgICBjaWdvcCA9IGJ5dGVBcnJheS5yZWFkSW50MzJMRShwKTsKICAgICAgICAgICAgICBsb3AgPSBjaWdvcCA+PiA0OwogICAgICAgICAgICAgIG9wID0gQ0lHQVJfREVDT0RFUltjaWdvcCAmIDE1XTsKICAgICAgICAgICAgICBjaWdhcjIgKz0gbG9wICsgb3A7CiAgICAgICAgICAgICAgaWYgKG9wICE9PSAiSCIgJiYgb3AgIT09ICJTIiAmJiBvcCAhPT0gIkkiKSB7CiAgICAgICAgICAgICAgICBscmVmICs9IGxvcDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcCArPSA0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuZGF0YS5sZW5ndGhfb25fcmVmID0gbHJlZjsKICAgICAgICAgICAgcmV0dXJuIGNpZ2FyMjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfZmxhZ3MiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZmxhZ3MoKSB7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAibGVuZ3RoX29uX3JlZiIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGxlbmd0aF9vbl9yZWYoKSB7CiAgICAgICAgICB0aGlzLmdldCgiY2lnYXIiKTsKICAgICAgICAgIHJldHVybiB0aGlzLmRhdGEubGVuZ3RoX29uX3JlZjsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfbl9jaWdhcl9vcCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9uX2NpZ2FyX29wKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCJfZmxhZ19uYyIpICYgNjU1MzU7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX2xfcmVhZF9uYW1lIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2xfcmVhZF9uYW1lKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCJfYmluX21xX25sIikgJiAyNTU7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX3NlcV9ieXRlcyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9zZXFfYnl0ZXMoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoInNlcV9sZW5ndGgiKSArIDEgPj4gMTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRSZWFkQmFzZXMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSZWFkQmFzZXMoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5zZXEoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJzZXEiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXEoKSB7CiAgICAgICAgICB2YXIgYnl0ZUFycmF5ID0gdGhpcy5ieXRlcy5ieXRlQXJyYXk7CiAgICAgICAgICB2YXIgcCA9IHRoaXMuYnl0ZXMuc3RhcnQgKyAzNiArIHRoaXMuZ2V0KCJfbF9yZWFkX25hbWUiKSArIHRoaXMuZ2V0KCJfbl9jaWdhcl9vcCIpICogNDsKICAgICAgICAgIHZhciBzZXFCeXRlcyA9IHRoaXMuZ2V0KCJfc2VxX2J5dGVzIik7CiAgICAgICAgICB2YXIgbGVuMiA9IHRoaXMuZ2V0KCJzZXFfbGVuZ3RoIik7CiAgICAgICAgICB2YXIgYnVmID0gIiI7CiAgICAgICAgICB2YXIgaTIgPSAwOwogICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZXFCeXRlczsgKytqKSB7CiAgICAgICAgICAgIHZhciBzYiA9IGJ5dGVBcnJheVtwICsgal07CiAgICAgICAgICAgIGJ1ZiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKFNFUVJFVF9ERUNPREVSWyhzYiAmIDI0MCkgPj4gNF0pOwogICAgICAgICAgICBpMisrOwogICAgICAgICAgICBpZiAoaTIgPCBsZW4yKSB7CiAgICAgICAgICAgICAgYnVmICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoU0VRUkVUX0RFQ09ERVJbc2IgJiAxNV0pOwogICAgICAgICAgICAgIGkyKys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBidWY7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0UGFpck9yaWVudGF0aW9uIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UGFpck9yaWVudGF0aW9uKCkgewogICAgICAgICAgaWYgKCF0aGlzLmlzU2VnbWVudFVubWFwcGVkKCkgJiYgIXRoaXMuaXNNYXRlVW5tYXBwZWQoKSAmJiB0aGlzLl9yZWZJRCA9PT0gdGhpcy5fbmV4dF9yZWZpZCgpKSB7CiAgICAgICAgICAgIHZhciBzMSA9IHRoaXMuaXNSZXZlcnNlQ29tcGxlbWVudGVkKCkgPyAiUiIgOiAiRiI7CiAgICAgICAgICAgIHZhciBzMiA9IHRoaXMuaXNNYXRlUmV2ZXJzZUNvbXBsZW1lbnRlZCgpID8gIlIiIDogIkYiOwogICAgICAgICAgICB2YXIgbzEgPSAiICI7CiAgICAgICAgICAgIHZhciBvMiA9ICIgIjsKICAgICAgICAgICAgaWYgKHRoaXMuaXNSZWFkMSgpKSB7CiAgICAgICAgICAgICAgbzEgPSAiMSI7CiAgICAgICAgICAgICAgbzIgPSAiMiI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc1JlYWQyKCkpIHsKICAgICAgICAgICAgICBvMSA9ICIyIjsKICAgICAgICAgICAgICBvMiA9ICIxIjsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgdG1wID0gW107CiAgICAgICAgICAgIHZhciBpc2l6ZSA9IHRoaXMudGVtcGxhdGVfbGVuZ3RoKCk7CiAgICAgICAgICAgIGlmIChpc2l6ZSA+IDApIHsKICAgICAgICAgICAgICB0bXBbMF0gPSBzMTsKICAgICAgICAgICAgICB0bXBbMV0gPSBvMTsKICAgICAgICAgICAgICB0bXBbMl0gPSBzMjsKICAgICAgICAgICAgICB0bXBbM10gPSBvMjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0bXBbMl0gPSBzMTsKICAgICAgICAgICAgICB0bXBbM10gPSBvMTsKICAgICAgICAgICAgICB0bXBbMF0gPSBzMjsKICAgICAgICAgICAgICB0bXBbMV0gPSBvMjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdG1wLmpvaW4oIiIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX2Jpbl9tcV9ubCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9iaW5fbXFfbmwoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5ieXRlcy5ieXRlQXJyYXkucmVhZEludDMyTEUodGhpcy5ieXRlcy5zdGFydCArIDEyKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfZmxhZ19uYyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9mbGFnX25jKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZXMuYnl0ZUFycmF5LnJlYWRJbnQzMkxFKHRoaXMuYnl0ZXMuc3RhcnQgKyAxNik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAic2VxX2xlbmd0aCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNlcV9sZW5ndGgoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5ieXRlcy5ieXRlQXJyYXkucmVhZEludDMyTEUodGhpcy5ieXRlcy5zdGFydCArIDIwKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfbmV4dF9yZWZpZCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9uZXh0X3JlZmlkKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZXMuYnl0ZUFycmF5LnJlYWRJbnQzMkxFKHRoaXMuYnl0ZXMuc3RhcnQgKyAyNCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAiX25leHRfcG9zIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX25leHRfcG9zKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZXMuYnl0ZUFycmF5LnJlYWRJbnQzMkxFKHRoaXMuYnl0ZXMuc3RhcnQgKyAyOCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAidGVtcGxhdGVfbGVuZ3RoIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdGVtcGxhdGVfbGVuZ3RoKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZXMuYnl0ZUFycmF5LnJlYWRJbnQzMkxFKHRoaXMuYnl0ZXMuc3RhcnQgKyAzMik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAidG9KU09OIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdG9KU09OKCkgewogICAgICAgICAgdmFyIF9jb250ZXh0NCwgX3RoaXMyID0gdGhpczsKICAgICAgICAgIHZhciBkYXRhMiA9IHt9OwogICAgICAgICAgKDAsIF9mb3JFYWNoLmRlZmF1bHQpKF9jb250ZXh0NCA9ICgwLCBfa2V5cy5kZWZhdWx0KSh0aGlzKSkuY2FsbChfY29udGV4dDQsIGZ1bmN0aW9uKGspIHsKICAgICAgICAgICAgaWYgKGsuY2hhckF0KDApID09PSAiXyIgfHwgayA9PT0gImJ5dGVzIikgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBkYXRhMltrXSA9IF90aGlzMltrXTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIGRhdGEyOwogICAgICAgIH0KICAgICAgfV0pOwogICAgICByZXR1cm4gQmFtUmVjb3JkMjsKICAgIH0oKTsKICAgIGV4cG9ydHMuZGVmYXVsdCA9IEJhbVJlY29yZDsKICB9KShyZWNvcmQpOwogIHZhciBzYW0gPSB7fTsKICB2YXIgdG9BcnJheSA9IHsgZXhwb3J0czoge30gfTsKICB2YXIgaXRlcmFibGVUb0FycmF5ID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUpIHsKICAgIHZhciBfU3ltYm9sID0gc3ltYm9sOwogICAgdmFyIF9nZXRJdGVyYXRvck1ldGhvZCA9IGdldEl0ZXJhdG9yTWV0aG9kJDI7CiAgICB2YXIgX0FycmF5JGZyb20gPSBmcm9tJDE7CiAgICBmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsKICAgICAgaWYgKHR5cGVvZiBfU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBfZ2V0SXRlcmF0b3JNZXRob2QoaXRlcikgIT0gbnVsbCB8fCBpdGVyWyJAQGl0ZXJhdG9yIl0gIT0gbnVsbCkKICAgICAgICByZXR1cm4gX0FycmF5JGZyb20oaXRlcik7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF9pdGVyYWJsZVRvQXJyYXk7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKGl0ZXJhYmxlVG9BcnJheSk7CiAgKGZ1bmN0aW9uKG1vZHVsZSkgewogICAgdmFyIGFycmF5V2l0aEhvbGVzMiA9IGFycmF5V2l0aEhvbGVzJDEuZXhwb3J0czsKICAgIHZhciBpdGVyYWJsZVRvQXJyYXkkMSA9IGl0ZXJhYmxlVG9BcnJheS5leHBvcnRzOwogICAgdmFyIHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5MiA9IHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5JDEuZXhwb3J0czsKICAgIHZhciBub25JdGVyYWJsZVJlc3QyID0gbm9uSXRlcmFibGVSZXN0JDEuZXhwb3J0czsKICAgIGZ1bmN0aW9uIF90b0FycmF5KGFycikgewogICAgICByZXR1cm4gYXJyYXlXaXRoSG9sZXMyKGFycikgfHwgaXRlcmFibGVUb0FycmF5JDEoYXJyKSB8fCB1bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheTIoYXJyKSB8fCBub25JdGVyYWJsZVJlc3QyKCk7CiAgICB9CiAgICBtb2R1bGUuZXhwb3J0cyA9IF90b0FycmF5OwogICAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KSh0b0FycmF5KTsKICAoZnVuY3Rpb24oZXhwb3J0cykgewogICAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyID0gaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDEuZXhwb3J0czsKICAgIHZhciBfT2JqZWN0JGRlZmluZVByb3BlcnR5ID0gZGVmaW5lUHJvcGVydHkkOTsKICAgIF9PYmplY3QkZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIGV4cG9ydHMucGFyc2VIZWFkZXJUZXh0ID0gcGFyc2VIZWFkZXJUZXh0OwogICAgdmFyIF9zbGljZWRUb0FycmF5MjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihzbGljZWRUb0FycmF5JDEuZXhwb3J0cyk7CiAgICB2YXIgX21hcCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKG1hcCk7CiAgICB2YXIgX3NsaWNlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoc2xpY2UkMSk7CiAgICB2YXIgX3RvQXJyYXkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIodG9BcnJheS5leHBvcnRzKTsKICAgIHZhciBfZm9yRWFjaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGZvckVhY2gkMSk7CiAgICBmdW5jdGlvbiBwYXJzZUhlYWRlclRleHQodGV4dCkgewogICAgICB2YXIgbGluZXMgPSB0ZXh0LnNwbGl0KC9ccj9cbi8pOwogICAgICB2YXIgZGF0YTIgPSBbXTsKICAgICAgKDAsIF9mb3JFYWNoLmRlZmF1bHQpKGxpbmVzKS5jYWxsKGxpbmVzLCBmdW5jdGlvbihsaW5lKSB7CiAgICAgICAgdmFyIF9saW5lJHNwbGl0ID0gbGluZS5zcGxpdCgvXHQvKSwgX2xpbmUkc3BsaXQyID0gKDAsIF90b0FycmF5Mi5kZWZhdWx0KShfbGluZSRzcGxpdCksIHRhZyA9IF9saW5lJHNwbGl0MlswXSwgZmllbGRzID0gKDAsIF9zbGljZS5kZWZhdWx0KShfbGluZSRzcGxpdDIpLmNhbGwoX2xpbmUkc3BsaXQyLCAxKTsKICAgICAgICB2YXIgcGFyc2VkRmllbGRzID0gKDAsIF9tYXAuZGVmYXVsdCkoZmllbGRzKS5jYWxsKGZpZWxkcywgZnVuY3Rpb24oZikgewogICAgICAgICAgdmFyIF9mJHNwbGl0ID0gZi5zcGxpdCgiOiIsIDIpLCBfZiRzcGxpdDIgPSAoMCwgX3NsaWNlZFRvQXJyYXkyMi5kZWZhdWx0KShfZiRzcGxpdCwgMiksIGZpZWxkVGFnID0gX2Ykc3BsaXQyWzBdLCB2YWx1ZSA9IF9mJHNwbGl0MlsxXTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRhZzogZmllbGRUYWcsCiAgICAgICAgICAgIHZhbHVlCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIGlmICh0YWcpIHsKICAgICAgICAgIGRhdGEyLnB1c2goewogICAgICAgICAgICB0YWc6IHRhZy5zdWJzdHIoMSksCiAgICAgICAgICAgIGRhdGE6IHBhcnNlZEZpZWxkcwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIGRhdGEyOwogICAgfQogIH0pKHNhbSk7CiAgKGZ1bmN0aW9uKGV4cG9ydHMpIHsKICAgIHZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MiA9IGludGVyb3BSZXF1aXJlRGVmYXVsdCQxLmV4cG9ydHM7CiAgICB2YXIgX09iamVjdCRkZWZpbmVQcm9wZXJ0eSA9IGRlZmluZVByb3BlcnR5JDk7CiAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLmRlZmF1bHQgPSBleHBvcnRzLkJBTV9NQUdJQyA9IHZvaWQgMDsKICAgIHZhciBfbm93ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIobm93KTsKICAgIHZhciBfc29ydCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHNvcnQpOwogICAgdmFyIF9maWx0ZXIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihmaWx0ZXIpOwogICAgdmFyIF9zbGljZWRUb0FycmF5MjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihzbGljZWRUb0FycmF5JDEuZXhwb3J0cyk7CiAgICB2YXIgX2ZvckVhY2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihmb3JFYWNoJDEpOwogICAgdmFyIF9wcm9taXNlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIocHJvbWlzZSk7CiAgICB2YXIgX21hcCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKG1hcCk7CiAgICB2YXIgX3JlZHVjZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHJlZHVjZSk7CiAgICB2YXIgX2NvbmNhdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGNvbmNhdCk7CiAgICB2YXIgX3JlZ2VuZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHJlZ2VuZXJhdG9yJDEpOwogICAgdmFyIF9zbGljZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHNsaWNlJDEpOwogICAgdmFyIF9hc3luY1RvR2VuZXJhdG9yMjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihhc3luY1RvR2VuZXJhdG9yJDEuZXhwb3J0cyk7CiAgICB2YXIgX2JpbmQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihiaW5kKTsKICAgIHZhciBfY2xhc3NDYWxsQ2hlY2syMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGNsYXNzQ2FsbENoZWNrJDEuZXhwb3J0cyk7CiAgICB2YXIgX2NyZWF0ZUNsYXNzMjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihjcmVhdGVDbGFzcyQxLmV4cG9ydHMpOwogICAgdmFyIF9kZWZpbmVQcm9wZXJ0eTIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZGVmaW5lUHJvcGVydHkkNi5leHBvcnRzKTsKICAgIHZhciBfd3JhcEFzeW5jR2VuZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHdyYXBBc3luY0dlbmVyYXRvci5leHBvcnRzKTsKICAgIHZhciBfYXdhaXRBc3luY0dlbmVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihhd2FpdEFzeW5jR2VuZXJhdG9yLmV4cG9ydHMpOwogICAgdmFyIF9hc3luY0dlbmVyYXRvckRlbGVnYXRlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGFzeW5jR2VuZXJhdG9yRGVsZWdhdGUuZXhwb3J0cyk7CiAgICB2YXIgX2FzeW5jSXRlcmF0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoYXN5bmNJdGVyYXRvci5leHBvcnRzKTsKICAgIHZhciBfYWJvcnRhYmxlUHJvbWlzZUNhY2hlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZGlzdCQyKTsKICAgIHZhciBfYmFpID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoYmFpKTsKICAgIHZhciBfY3NpID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoY3NpKTsKICAgIHZhciBfYnVmZmVyQ3JjID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoYnVmZmVyQ3JjMzIpOwogICAgdmFyIF9iZ3pmRmlsZWhhbmRsZSA9IGRpc3QkMTsKICAgIHZhciBfb2JqZWN0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIob2JqZWN0X2VudHJpZXNQb255ZmlsbCk7CiAgICB2YXIgX3F1aWNrTHJ1ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIocXVpY2tMcnUpOwogICAgdmFyIF9nZW5lcmljRmlsZWhhbmRsZSA9IGRpc3Q7CiAgICB2YXIgX3JlY29yZCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHJlY29yZCk7CiAgICB2YXIgX3NhbSA9IHNhbTsKICAgIHZhciBfdXRpbCA9IHV0aWw7CiAgICB2YXIgQkFNX01BR0lDID0gMjE4NDAxOTQ7CiAgICBleHBvcnRzLkJBTV9NQUdJQyA9IEJBTV9NQUdJQzsKICAgIHZhciBibG9ja0xlbiA9IDEgPDwgMTY7CiAgICB2YXIgQmFtRmlsZSA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgICAgZnVuY3Rpb24gQmFtRmlsZTIoX3JlZikgewogICAgICAgIHZhciBfY29udGV4dDsKICAgICAgICB2YXIgYmFtRmlsZWhhbmRsZSA9IF9yZWYuYmFtRmlsZWhhbmRsZSwgYmFtUGF0aCA9IF9yZWYuYmFtUGF0aCwgYmFtVXJsID0gX3JlZi5iYW1VcmwsIGJhaVBhdGggPSBfcmVmLmJhaVBhdGgsIGJhaUZpbGVoYW5kbGUgPSBfcmVmLmJhaUZpbGVoYW5kbGUsIGJhaVVybCA9IF9yZWYuYmFpVXJsLCBjc2lQYXRoID0gX3JlZi5jc2lQYXRoLCBjc2lGaWxlaGFuZGxlID0gX3JlZi5jc2lGaWxlaGFuZGxlLCBjc2lVcmwgPSBfcmVmLmNzaVVybCwgY2FjaGVTaXplID0gX3JlZi5jYWNoZVNpemUsIGZldGNoU2l6ZUxpbWl0ID0gX3JlZi5mZXRjaFNpemVMaW1pdCwgY2h1bmtTaXplTGltaXQgPSBfcmVmLmNodW5rU2l6ZUxpbWl0LCBfcmVmJHlpZWxkVGhyZWFkVGltZSA9IF9yZWYueWllbGRUaHJlYWRUaW1lLCB5aWVsZFRocmVhZFRpbWUgPSBfcmVmJHlpZWxkVGhyZWFkVGltZSA9PT0gdm9pZCAwID8gMTAwIDogX3JlZiR5aWVsZFRocmVhZFRpbWUsIF9yZWYkcmVuYW1lUmVmU2VxcyA9IF9yZWYucmVuYW1lUmVmU2VxcywgcmVuYW1lUmVmU2VxcyA9IF9yZWYkcmVuYW1lUmVmU2VxcyA9PT0gdm9pZCAwID8gZnVuY3Rpb24obikgewogICAgICAgICAgcmV0dXJuIG47CiAgICAgICAgfSA6IF9yZWYkcmVuYW1lUmVmU2VxczsKICAgICAgICAoMCwgX2NsYXNzQ2FsbENoZWNrMjIuZGVmYXVsdCkodGhpcywgQmFtRmlsZTIpOwogICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyMi5kZWZhdWx0KSh0aGlzLCAicmVuYW1lUmVmU2VxIiwgdm9pZCAwKTsKICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5MjIuZGVmYXVsdCkodGhpcywgImJhbSIsIHZvaWQgMCk7CiAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIyLmRlZmF1bHQpKHRoaXMsICJpbmRleCIsIHZvaWQgMCk7CiAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIyLmRlZmF1bHQpKHRoaXMsICJjaHVua1NpemVMaW1pdCIsIHZvaWQgMCk7CiAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIyLmRlZmF1bHQpKHRoaXMsICJmZXRjaFNpemVMaW1pdCIsIHZvaWQgMCk7CiAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIyLmRlZmF1bHQpKHRoaXMsICJoZWFkZXIiLCB2b2lkIDApOwogICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyMi5kZWZhdWx0KSh0aGlzLCAiZmVhdHVyZUNhY2hlIiwgdm9pZCAwKTsKICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5MjIuZGVmYXVsdCkodGhpcywgImNoclRvSW5kZXgiLCB2b2lkIDApOwogICAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyMi5kZWZhdWx0KSh0aGlzLCAiaW5kZXhUb0NociIsIHZvaWQgMCk7CiAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIyLmRlZmF1bHQpKHRoaXMsICJ5aWVsZFRocmVhZFRpbWUiLCB2b2lkIDApOwogICAgICAgIHRoaXMucmVuYW1lUmVmU2VxID0gcmVuYW1lUmVmU2VxczsKICAgICAgICBpZiAoYmFtRmlsZWhhbmRsZSkgewogICAgICAgICAgdGhpcy5iYW0gPSBiYW1GaWxlaGFuZGxlOwogICAgICAgIH0gZWxzZSBpZiAoYmFtUGF0aCkgewogICAgICAgICAgdGhpcy5iYW0gPSBuZXcgX2dlbmVyaWNGaWxlaGFuZGxlLkxvY2FsRmlsZShiYW1QYXRoKTsKICAgICAgICB9IGVsc2UgaWYgKGJhbVVybCkgewogICAgICAgICAgdGhpcy5iYW0gPSBuZXcgX2dlbmVyaWNGaWxlaGFuZGxlLlJlbW90ZUZpbGUoYmFtVXJsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1bmFibGUgdG8gaW5pdGlhbGl6ZSBiYW0iKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNzaUZpbGVoYW5kbGUpIHsKICAgICAgICAgIHRoaXMuaW5kZXggPSBuZXcgX2NzaS5kZWZhdWx0KHsKICAgICAgICAgICAgZmlsZWhhbmRsZTogY3NpRmlsZWhhbmRsZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChjc2lQYXRoKSB7CiAgICAgICAgICB0aGlzLmluZGV4ID0gbmV3IF9jc2kuZGVmYXVsdCh7CiAgICAgICAgICAgIGZpbGVoYW5kbGU6IG5ldyBfZ2VuZXJpY0ZpbGVoYW5kbGUuTG9jYWxGaWxlKGNzaVBhdGgpCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKGNzaVVybCkgewogICAgICAgICAgdGhpcy5pbmRleCA9IG5ldyBfY3NpLmRlZmF1bHQoewogICAgICAgICAgICBmaWxlaGFuZGxlOiBuZXcgX2dlbmVyaWNGaWxlaGFuZGxlLlJlbW90ZUZpbGUoY3NpVXJsKQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChiYWlGaWxlaGFuZGxlKSB7CiAgICAgICAgICB0aGlzLmluZGV4ID0gbmV3IF9iYWkuZGVmYXVsdCh7CiAgICAgICAgICAgIGZpbGVoYW5kbGU6IGJhaUZpbGVoYW5kbGUKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoYmFpUGF0aCkgewogICAgICAgICAgdGhpcy5pbmRleCA9IG5ldyBfYmFpLmRlZmF1bHQoewogICAgICAgICAgICBmaWxlaGFuZGxlOiBuZXcgX2dlbmVyaWNGaWxlaGFuZGxlLkxvY2FsRmlsZShiYWlQYXRoKQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChiYWlVcmwpIHsKICAgICAgICAgIHRoaXMuaW5kZXggPSBuZXcgX2JhaS5kZWZhdWx0KHsKICAgICAgICAgICAgZmlsZWhhbmRsZTogbmV3IF9nZW5lcmljRmlsZWhhbmRsZS5SZW1vdGVGaWxlKGJhaVVybCkKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoYmFtUGF0aCkgewogICAgICAgICAgdGhpcy5pbmRleCA9IG5ldyBfYmFpLmRlZmF1bHQoewogICAgICAgICAgICBmaWxlaGFuZGxlOiBuZXcgX2dlbmVyaWNGaWxlaGFuZGxlLkxvY2FsRmlsZSgiIi5jb25jYXQoYmFtUGF0aCwgIi5iYWkiKSkKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoYmFtVXJsKSB7CiAgICAgICAgICB0aGlzLmluZGV4ID0gbmV3IF9iYWkuZGVmYXVsdCh7CiAgICAgICAgICAgIGZpbGVoYW5kbGU6IG5ldyBfZ2VuZXJpY0ZpbGVoYW5kbGUuUmVtb3RlRmlsZSgiIi5jb25jYXQoYmFtVXJsLCAiLmJhaSIpKQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidW5hYmxlIHRvIGluZmVyIGluZGV4IGZvcm1hdCIpOwogICAgICAgIH0KICAgICAgICB0aGlzLmZlYXR1cmVDYWNoZSA9IG5ldyBfYWJvcnRhYmxlUHJvbWlzZUNhY2hlLmRlZmF1bHQoewogICAgICAgICAgY2FjaGU6IG5ldyBfcXVpY2tMcnUuZGVmYXVsdCh7CiAgICAgICAgICAgIG1heFNpemU6IGNhY2hlU2l6ZSAhPT0gdm9pZCAwID8gY2FjaGVTaXplIDogNTAKICAgICAgICAgIH0pLAogICAgICAgICAgZmlsbDogKDAsIF9iaW5kLmRlZmF1bHQpKF9jb250ZXh0ID0gdGhpcy5fcmVhZENodW5rKS5jYWxsKF9jb250ZXh0LCB0aGlzKQogICAgICAgIH0pOwogICAgICAgIHRoaXMuZmV0Y2hTaXplTGltaXQgPSBmZXRjaFNpemVMaW1pdCB8fCA1ZTg7CiAgICAgICAgdGhpcy5jaHVua1NpemVMaW1pdCA9IGNodW5rU2l6ZUxpbWl0IHx8IDNlODsKICAgICAgICB0aGlzLnlpZWxkVGhyZWFkVGltZSA9IHlpZWxkVGhyZWFkVGltZTsKICAgICAgfQogICAgICAoMCwgX2NyZWF0ZUNsYXNzMjIuZGVmYXVsdCkoQmFtRmlsZTIsIFt7CiAgICAgICAga2V5OiAiZ2V0SGVhZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX2dldEhlYWRlciA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgICAgICB2YXIgb3JpZ09wdHMsIG9wdHMsIGluZGV4RGF0YSwgcmV0LCBidWZmZXIyLCByZXMsIGJ5dGVzUmVhZCwgdW5jYmEsIGhlYWRMZW4sIF95aWVsZCR0aGlzJF9yZWFkUmVmUywgY2hyVG9JbmRleCwgaW5kZXhUb0NociwgX2FyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IyLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dDIpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBvcmlnT3B0cyA9IF9hcmdzLmxlbmd0aCA+IDAgJiYgX2FyZ3NbMF0gIT09IHZvaWQgMCA/IF9hcmdzWzBdIDoge307CiAgICAgICAgICAgICAgICAgICAgb3B0cyA9ICgwLCBfdXRpbC5tYWtlT3B0cykob3JpZ09wdHMpOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbmRleC5wYXJzZShvcHRzKTsKICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgIGluZGV4RGF0YSA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgICAgIHJldCA9IGluZGV4RGF0YS5maXJzdERhdGFMaW5lID8gaW5kZXhEYXRhLmZpcnN0RGF0YUxpbmUuYmxvY2tQb3NpdGlvbiArIDY1NTM1IDogdm9pZCAwOwogICAgICAgICAgICAgICAgICAgIGlmICghcmV0KSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE3OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5iYW0ucmVhZChCdWZmZXIuYWxsb2MocmV0ICsgYmxvY2tMZW4pLCAwLCByZXQgKyBibG9ja0xlbiwgMCwgb3B0cyk7CiAgICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgICByZXMgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgICAgICBieXRlc1JlYWQgPSByZXMuYnl0ZXNSZWFkOwogICAgICAgICAgICAgICAgICAgIGJ1ZmZlcjIgPSByZXMuYnVmZmVyOwogICAgICAgICAgICAgICAgICAgIGlmIChieXRlc1JlYWQpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFcnJvciByZWFkaW5nIGhlYWRlciIpOwogICAgICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgICAgIGlmIChieXRlc1JlYWQgPCByZXQpIHsKICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlcjIgPSAoMCwgX3NsaWNlLmRlZmF1bHQpKGJ1ZmZlcjIpLmNhbGwoYnVmZmVyMiwgMCwgYnl0ZXNSZWFkKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgYnVmZmVyMiA9ICgwLCBfc2xpY2UuZGVmYXVsdCkoYnVmZmVyMikuY2FsbChidWZmZXIyLCAwLCByZXQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDIwOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYmFtLnJlYWRGaWxlKG9wdHMpOwogICAgICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgICAgIGJ1ZmZlcjIgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDIyOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAoMCwgX2JnemZGaWxlaGFuZGxlLnVuemlwKShidWZmZXIyKTsKICAgICAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgICAgICB1bmNiYSA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgICAgIGlmICghKHVuY2JhLnJlYWRJbnQzMkxFKDApICE9PSBCQU1fTUFHSUMpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm90IGEgQkFNIGZpbGUiKTsKICAgICAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgICAgICBoZWFkTGVuID0gdW5jYmEucmVhZEludDMyTEUoNCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oZWFkZXIgPSB1bmNiYS50b1N0cmluZygidXRmOCIsIDgsIDggKyBoZWFkTGVuKTsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI5OwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZWFkUmVmU2VxcyhoZWFkTGVuICsgOCwgNjU1MzUsIG9wdHMpOwogICAgICAgICAgICAgICAgICBjYXNlIDI5OgogICAgICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJF9yZWFkUmVmUyA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgICAgIGNoclRvSW5kZXggPSBfeWllbGQkdGhpcyRfcmVhZFJlZlMuY2hyVG9JbmRleDsKICAgICAgICAgICAgICAgICAgICBpbmRleFRvQ2hyID0gX3lpZWxkJHRoaXMkX3JlYWRSZWZTLmluZGV4VG9DaHI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaHJUb0luZGV4ID0gY2hyVG9JbmRleDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV4VG9DaHIgPSBpbmRleFRvQ2hyOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCAoMCwgX3NhbS5wYXJzZUhlYWRlclRleHQpKHRoaXMuaGVhZGVyKSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMzU6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgICAgIH0pKTsKICAgICAgICAgIGZ1bmN0aW9uIGdldEhlYWRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIF9nZXRIZWFkZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBnZXRIZWFkZXI7CiAgICAgICAgfSgpCiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJnZXRIZWFkZXJUZXh0IiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX2dldEhlYWRlclRleHQgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgICAgIHZhciBvcHRzLCBfYXJnczIgPSBhcmd1bWVudHM7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IyLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQzKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgb3B0cyA9IF9hcmdzMi5sZW5ndGggPiAwICYmIF9hcmdzMlswXSAhPT0gdm9pZCAwID8gX2FyZ3MyWzBdIDoge307CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEhlYWRlcihvcHRzKTsKICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCB0aGlzLmhlYWRlcik7CiAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgICAgIH0pKTsKICAgICAgICAgIGZ1bmN0aW9uIGdldEhlYWRlclRleHQoKSB7CiAgICAgICAgICAgIHJldHVybiBfZ2V0SGVhZGVyVGV4dC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGdldEhlYWRlclRleHQ7CiAgICAgICAgfSgpCiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfcmVhZFJlZlNlcXMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBfcmVhZFJlZlNlcXMyID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKHN0YXJ0LCByZWZTZXFCeXRlcykgewogICAgICAgICAgICB2YXIgb3B0cywgcmVzLCBieXRlc1JlYWQsIGJ1ZmZlcjIsIHVuY2JhLCBuUmVmLCBwLCBjaHJUb0luZGV4LCBpbmRleFRvQ2hyLCBpMiwgbE5hbWUsIHJlZk5hbWUsIGxSZWYsIF9hcmdzMyA9IGFyZ3VtZW50czsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDQpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBvcHRzID0gX2FyZ3MzLmxlbmd0aCA+IDIgJiYgX2FyZ3MzWzJdICE9PSB2b2lkIDAgPyBfYXJnczNbMl0gOiB7fTsKICAgICAgICAgICAgICAgICAgICBpZiAoIShzdGFydCA+IHJlZlNlcUJ5dGVzKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCB0aGlzLl9yZWFkUmVmU2VxcyhzdGFydCwgcmVmU2VxQnl0ZXMgKiAyLCBvcHRzKSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYmFtLnJlYWQoQnVmZmVyLmFsbG9jKHJlZlNlcUJ5dGVzICsgYmxvY2tMZW4pLCAwLCByZWZTZXFCeXRlcywgMCwgb3B0cyk7CiAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICByZXMgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgICAgICBieXRlc1JlYWQgPSByZXMuYnl0ZXNSZWFkOwogICAgICAgICAgICAgICAgICAgIGJ1ZmZlcjIgPSByZXMuYnVmZmVyOwogICAgICAgICAgICAgICAgICAgIGlmIChieXRlc1JlYWQpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFcnJvciByZWFkaW5nIHJlZnNlcXMgZnJvbSBoZWFkZXIiKTsKICAgICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICBpZiAoYnl0ZXNSZWFkIDwgcmVmU2VxQnl0ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlcjIgPSAoMCwgX3NsaWNlLmRlZmF1bHQpKGJ1ZmZlcjIpLmNhbGwoYnVmZmVyMiwgMCwgYnl0ZXNSZWFkKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgYnVmZmVyMiA9ICgwLCBfc2xpY2UuZGVmYXVsdCkoYnVmZmVyMikuY2FsbChidWZmZXIyLCAwLCByZWZTZXFCeXRlcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYmd6ZkZpbGVoYW5kbGUudW56aXApKGJ1ZmZlcjIpOwogICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgIHVuY2JhID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgblJlZiA9IHVuY2JhLnJlYWRJbnQzMkxFKHN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICBwID0gc3RhcnQgKyA0OwogICAgICAgICAgICAgICAgICAgIGNoclRvSW5kZXggPSB7fTsKICAgICAgICAgICAgICAgICAgICBpbmRleFRvQ2hyID0gW107CiAgICAgICAgICAgICAgICAgICAgaTIgPSAwOwogICAgICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgICAgIGlmICghKGkyIDwgblJlZikpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMzU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyMjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF91dGlsLmFib3J0QnJlYWtQb2ludCkob3B0cy5zaWduYWwpOwogICAgICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgICAgIGxOYW1lID0gdW5jYmEucmVhZEludDMyTEUocCk7CiAgICAgICAgICAgICAgICAgICAgcmVmTmFtZSA9IHVuY2JhLnRvU3RyaW5nKCJ1dGY4IiwgcCArIDQsIHAgKyA0ICsgbE5hbWUgLSAxKTsKICAgICAgICAgICAgICAgICAgICByZWZOYW1lID0gdGhpcy5yZW5hbWVSZWZTZXEocmVmTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgbFJlZiA9IHVuY2JhLnJlYWRJbnQzMkxFKHAgKyBsTmFtZSArIDQpOwogICAgICAgICAgICAgICAgICAgIGNoclRvSW5kZXhbcmVmTmFtZV0gPSBpMjsKICAgICAgICAgICAgICAgICAgICBpbmRleFRvQ2hyLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgcmVmTmFtZSwKICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aDogbFJlZgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHAgPSBwICsgOCArIGxOYW1lOwogICAgICAgICAgICAgICAgICAgIGlmICghKHAgPiB1bmNiYS5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDMyOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiQkFNIGhlYWRlciBpcyB2ZXJ5IGJpZy4gIFJlLWZldGNoaW5nICIuY29uY2F0KHJlZlNlcUJ5dGVzLCAiIGJ5dGVzLiIpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgdGhpcy5fcmVhZFJlZlNlcXMoc3RhcnQsIHJlZlNlcUJ5dGVzICogMiwgb3B0cykpOwogICAgICAgICAgICAgICAgICBjYXNlIDMyOgogICAgICAgICAgICAgICAgICAgIGkyICs9IDE7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxOTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAzNToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgY2hyVG9JbmRleCwKICAgICAgICAgICAgICAgICAgICAgIGluZGV4VG9DaHIKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgY2FzZSAzNjoKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgICAgIH0pKTsKICAgICAgICAgIGZ1bmN0aW9uIF9yZWFkUmVmU2VxcyhfeCwgX3gyKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhZFJlZlNlcXMyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gX3JlYWRSZWZTZXFzOwogICAgICAgIH0oKQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0UmVjb3Jkc0ZvclJhbmdlIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX2dldFJlY29yZHNGb3JSYW5nZSA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlNChjaHIsIG1pbjIsIG1heDIpIHsKICAgICAgICAgICAgdmFyIG9wdHMsIHJlY29yZHMsIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24sIF9kaWRJdGVyYXRvckVycm9yLCBfaXRlcmF0b3JFcnJvciwgX2l0ZXJhdG9yLCBfc3RlcCwgX3ZhbHVlLCBjaHVuazIsIF9hcmdzNCA9IGFyZ3VtZW50czsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDUpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBvcHRzID0gX2FyZ3M0Lmxlbmd0aCA+IDMgJiYgX2FyZ3M0WzNdICE9PSB2b2lkIDAgPyBfYXJnczRbM10gOiB7CiAgICAgICAgICAgICAgICAgICAgICB2aWV3QXNQYWlyczogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICBwYWlyQWNyb3NzQ2hyOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIG1heEluc2VydFNpemU6IDJlNQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgcmVjb3JkcyA9IFtdOwogICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1LnByZXYgPSA0OwogICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvciA9ICgwLCBfYXN5bmNJdGVyYXRvcjIuZGVmYXVsdCkodGhpcy5zdHJlYW1SZWNvcmRzRm9yUmFuZ2UoY2hyLCBtaW4yLCBtYXgyLCBvcHRzKSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9pdGVyYXRvci5uZXh0KCk7CiAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICBfc3RlcCA9IF9jb250ZXh0NS5zZW50OwogICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSBfc3RlcC5kb25lOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9zdGVwLnZhbHVlOwogICAgICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgICAgIF92YWx1ZSA9IF9jb250ZXh0NS5zZW50OwogICAgICAgICAgICAgICAgICAgIGlmIChfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDE5OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNodW5rMiA9IF92YWx1ZTsKICAgICAgICAgICAgICAgICAgICByZWNvcmRzID0gKDAsIF9jb25jYXQuZGVmYXVsdCkocmVjb3JkcykuY2FsbChyZWNvcmRzLCBjaHVuazIpOwogICAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5wcmV2ID0gMjE7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1LnQwID0gX2NvbnRleHQ1WyJjYXRjaCJdKDQpOwogICAgICAgICAgICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IF9jb250ZXh0NS50MDsKICAgICAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDUucHJldiA9IDI1OwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5wcmV2ID0gMjY7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yLnJldHVybiAhPSBudWxsKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAzMDsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDMwOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfaXRlcmF0b3IucmV0dXJuKCk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1LnByZXYgPSAzMDsKICAgICAgICAgICAgICAgICAgICBpZiAoIV9kaWRJdGVyYXRvckVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDMzOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yOwogICAgICAgICAgICAgICAgICBjYXNlIDMzOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuZmluaXNoKDMwKTsKICAgICAgICAgICAgICAgICAgY2FzZSAzNDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmZpbmlzaCgyNSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMzU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHJlY29yZHMpOwogICAgICAgICAgICAgICAgICBjYXNlIDM2OgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTQsIHRoaXMsIFtbNCwgMjEsIDI1LCAzNV0sIFsyNiwgLCAzMCwgMzRdXSk7CiAgICAgICAgICB9KSk7CiAgICAgICAgICBmdW5jdGlvbiBnZXRSZWNvcmRzRm9yUmFuZ2UoX3gzLCBfeDQsIF94NSkgewogICAgICAgICAgICByZXR1cm4gX2dldFJlY29yZHNGb3JSYW5nZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGdldFJlY29yZHNGb3JSYW5nZTsKICAgICAgICB9KCkKICAgICAgfSwgewogICAgICAgIGtleTogInN0cmVhbVJlY29yZHNGb3JSYW5nZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHN0cmVhbVJlY29yZHNGb3JSYW5nZShjaHIsIG1pbjIsIG1heDIpIHsKICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICB2YXIgb3B0cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzNdIDogewogICAgICAgICAgICB2aWV3QXNQYWlyczogZmFsc2UsCiAgICAgICAgICAgIHBhaXJBY3Jvc3NDaHI6IGZhbHNlLAogICAgICAgICAgICBtYXhJbnNlcnRTaXplOiAyZTUKICAgICAgICAgIH07CiAgICAgICAgICByZXR1cm4gKDAsIF93cmFwQXN5bmNHZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlNSgpIHsKICAgICAgICAgICAgdmFyIF9jb250ZXh0NzsKICAgICAgICAgICAgdmFyIGNocklkLCBjaHVua3MsIGkyLCBzaXplLCBfY29udGV4dDYsIHRvdGFsU2l6ZSwgX2NvbnRleHQ4OwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0OSkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIG9wdHMudmlld0FzUGFpcnMgPSBvcHRzLnZpZXdBc1BhaXJzIHx8IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIG9wdHMucGFpckFjcm9zc0NociA9IG9wdHMucGFpckFjcm9zc0NociB8fCBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBvcHRzLm1heEluc2VydFNpemUgPSBvcHRzLm1heEluc2VydFNpemUgIT09IHZvaWQgMCA/IG9wdHMubWF4SW5zZXJ0U2l6ZSA6IDJlNTsKICAgICAgICAgICAgICAgICAgICBjaHJJZCA9IF90aGlzLmNoclRvSW5kZXggJiYgX3RoaXMuY2hyVG9JbmRleFtjaHJdOwogICAgICAgICAgICAgICAgICAgIGlmIChjaHJJZCA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2h1bmtzID0gW107CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYXdhaXRBc3luY0dlbmVyYXRvcjIuZGVmYXVsdCkoX3RoaXMuaW5kZXguYmxvY2tzRm9yUmFuZ2UoY2hySWQsIG1pbjIgLSAxLCBtYXgyLCBvcHRzKSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgY2h1bmtzID0gX2NvbnRleHQ5LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNodW5rcykgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkVycm9yIGluIGluZGV4IGZldGNoIik7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICAgICAgaTIgPSAwOwogICAgICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgICAgIGlmICghKGkyIDwgY2h1bmtzLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAxNzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF9hd2FpdEFzeW5jR2VuZXJhdG9yMi5kZWZhdWx0KSgoMCwgX3V0aWwuYWJvcnRCcmVha1BvaW50KShvcHRzLnNpZ25hbCkpOwogICAgICAgICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgICAgICAgIHNpemUgPSBjaHVua3NbaTJdLmZldGNoZWRTaXplKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoc2l6ZSA+IF90aGlzLmNodW5rU2l6ZUxpbWl0KSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAyMDsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKDAsIF9jb25jYXQuZGVmYXVsdCkoX2NvbnRleHQ2ID0gIlRvbyBtYW55IEJBTSBmZWF0dXJlcy4gQkFNIGNodW5rIHNpemUgIi5jb25jYXQoc2l6ZSwgIiBieXRlcyBleGNlZWRzIGNodW5rU2l6ZUxpbWl0IG9mICIpKS5jYWxsKF9jb250ZXh0NiwgX3RoaXMuY2h1bmtTaXplTGltaXQpKTsKICAgICAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgICAgICBpMiArPSAxOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgICAgICAgdG90YWxTaXplID0gKDAsIF9yZWR1Y2UuZGVmYXVsdCkoX2NvbnRleHQ3ID0gKDAsIF9tYXAuZGVmYXVsdCkoY2h1bmtzKS5jYWxsKGNodW5rcywgZnVuY3Rpb24ocykgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMuZmV0Y2hlZFNpemUoKTsKICAgICAgICAgICAgICAgICAgICB9KSkuY2FsbChfY29udGV4dDcsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhICsgYjsKICAgICAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgICAgICAgICBpZiAoISh0b3RhbFNpemUgPiBfdGhpcy5mZXRjaFNpemVMaW1pdCkpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMjY7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCgwLCBfY29uY2F0LmRlZmF1bHQpKF9jb250ZXh0OCA9ICJkYXRhIHNpemUgb2YgIi5jb25jYXQodG90YWxTaXplLnRvTG9jYWxlU3RyaW5nKCksICIgYnl0ZXMgZXhjZWVkZWQgZmV0Y2ggc2l6ZSBsaW1pdCBvZiAiKSkuY2FsbChfY29udGV4dDgsIF90aGlzLmZldGNoU2l6ZUxpbWl0LnRvTG9jYWxlU3RyaW5nKCksICIgYnl0ZXMiKSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5kZWxlZ2F0ZVlpZWxkKCgwLCBfYXN5bmNHZW5lcmF0b3JEZWxlZ2F0ZTIuZGVmYXVsdCkoKDAsIF9hc3luY0l0ZXJhdG9yMi5kZWZhdWx0KShfdGhpcy5fZmV0Y2hDaHVua0ZlYXR1cmVzKGNodW5rcywgY2hySWQsIG1pbjIsIG1heDIsIG9wdHMpKSwgX2F3YWl0QXN5bmNHZW5lcmF0b3IyLmRlZmF1bHQpLCAidDAiLCAyNyk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlNSk7CiAgICAgICAgICB9KSkoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfZmV0Y2hDaHVua0ZlYXR1cmVzIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2ZldGNoQ2h1bmtGZWF0dXJlcyhjaHVua3MsIGNocklkLCBtaW4yLCBtYXgyLCBvcHRzKSB7CiAgICAgICAgICB2YXIgX3RoaXMyID0gdGhpczsKICAgICAgICAgIHJldHVybiAoMCwgX3dyYXBBc3luY0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KCkgewogICAgICAgICAgICB2YXIgZmVhdFByb21pc2VzLCBkb25lLCBpMiwgYzIsIF95aWVsZCRfYXdhaXRBc3luY0dlbiwgZGF0YTIsIGNwb3NpdGlvbnMsIGRwb3NpdGlvbnMsIGNodW5rMiwgcHJvbWlzZTIsIF9pMjsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDEwKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMC5wcmV2ID0gX2NvbnRleHQxMC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBmZWF0UHJvbWlzZXMgPSBbXTsKICAgICAgICAgICAgICAgICAgICBkb25lID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaTIgPSAwOwogICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoaTIgPCBjaHVua3MubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gMjE7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYzIgPSBjaHVua3NbaTJdOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYXdhaXRBc3luY0dlbmVyYXRvcjIuZGVmYXVsdCkoX3RoaXMyLmZlYXR1cmVDYWNoZS5nZXQoYzIudG9TdHJpbmcoKSwgewogICAgICAgICAgICAgICAgICAgICAgY2h1bms6IGMyLAogICAgICAgICAgICAgICAgICAgICAgb3B0cwogICAgICAgICAgICAgICAgICAgIH0sIG9wdHMuc2lnbmFsKSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICBfeWllbGQkX2F3YWl0QXN5bmNHZW4gPSBfY29udGV4dDEwLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgZGF0YTIgPSBfeWllbGQkX2F3YWl0QXN5bmNHZW4uZGF0YTsKICAgICAgICAgICAgICAgICAgICBjcG9zaXRpb25zID0gX3lpZWxkJF9hd2FpdEFzeW5jR2VuLmNwb3NpdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgZHBvc2l0aW9ucyA9IF95aWVsZCRfYXdhaXRBc3luY0dlbi5kcG9zaXRpb25zOwogICAgICAgICAgICAgICAgICAgIGNodW5rMiA9IF95aWVsZCRfYXdhaXRBc3luY0dlbi5jaHVuazsKICAgICAgICAgICAgICAgICAgICBwcm9taXNlMiA9IF90aGlzMi5yZWFkQmFtRmVhdHVyZXMoZGF0YTIsIGNwb3NpdGlvbnMsIGRwb3NpdGlvbnMsIGNodW5rMikudGhlbihmdW5jdGlvbihyZWNvcmRzKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVjcyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IHJlY29yZHMubGVuZ3RoOyBfaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmZWF0dXJlID0gcmVjb3Jkc1tfaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmZWF0dXJlLnNlcV9pZCgpID09PSBjaHJJZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmZWF0dXJlLmdldCgic3RhcnQiKSA+PSBtYXgyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZmVhdHVyZS5nZXQoImVuZCIpID49IG1pbjIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY3MucHVzaChmZWF0dXJlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWNzOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGZlYXRQcm9taXNlcy5wdXNoKHByb21pc2UyKTsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF9hd2FpdEFzeW5jR2VuZXJhdG9yMi5kZWZhdWx0KShwcm9taXNlMik7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICAgICAgaWYgKCFkb25lKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAxODsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoImJyZWFrIiwgMjEpOwogICAgICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgICAgIGkyKys7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwuY2hlY2tBYm9ydFNpZ25hbCkob3B0cy5zaWduYWwpOwogICAgICAgICAgICAgICAgICAgIF9pMiA9IDA7CiAgICAgICAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoX2kyIDwgZmVhdFByb21pc2VzLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDI5OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDI2OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmZWF0UHJvbWlzZXNbX2kyXTsKICAgICAgICAgICAgICAgICAgY2FzZSAyNjoKICAgICAgICAgICAgICAgICAgICBfaTIrKzsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAyMzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAyOToKICAgICAgICAgICAgICAgICAgICAoMCwgX3V0aWwuY2hlY2tBYm9ydFNpZ25hbCkob3B0cy5zaWduYWwpOwogICAgICAgICAgICAgICAgICAgIGlmICghb3B0cy52aWV3QXNQYWlycykgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gMzM7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gMzM7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5mZXRjaFBhaXJzKGNocklkLCBmZWF0UHJvbWlzZXMsIG9wdHMpOwogICAgICAgICAgICAgICAgICBjYXNlIDMzOgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWU2KTsKICAgICAgICAgIH0pKSgpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogImZldGNoUGFpcnMiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBfZmV0Y2hQYWlycyA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlMTAoY2hySWQsIGZlYXRQcm9taXNlcywgb3B0cykgewogICAgICAgICAgICB2YXIgX3RoaXMzID0gdGhpcywgX2NvbnRleHQxNCwgX2NvbnRleHQxNTsKICAgICAgICAgICAgdmFyIHVubWF0ZWRQYWlycywgcmVhZElkcywgbWF0ZVByb21pc2VzLCBtYXRlQmxvY2tzLCBtYXRlQ2h1bmtzLCBpMiwgbWF0ZVRvdGFsU2l6ZSwgX2NvbnRleHQxNiwgbWF0ZUZlYXRQcm9taXNlcywgbmV3TWF0ZUZlYXRzLCBmZWF0dXJlc1JldCwgbmV3TWF0ZXM7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IyLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMTAkKF9jb250ZXh0MTgpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE4LnByZXYgPSBfY29udGV4dDE4Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIHVubWF0ZWRQYWlycyA9IHt9OwogICAgICAgICAgICAgICAgICAgIHJlYWRJZHMgPSB7fTsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE4Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcHJvbWlzZS5kZWZhdWx0LmFsbCgoMCwgX21hcC5kZWZhdWx0KShmZWF0UHJvbWlzZXMpLmNhbGwoZmVhdFByb21pc2VzLCAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgX3JlZjIgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcoZikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2NvbnRleHQxMTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldCwgcmVhZE5hbWVzLCBpMywgbmFtZSwgaWQyOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0MTIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEyLnByZXYgPSBfY29udGV4dDEyLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBfY29udGV4dDEyLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZE5hbWVzID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpMyA9IDA7IGkzIDwgcmV0Lmxlbmd0aDsgaTMrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSA9IHJldFtpM10ubmFtZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQyID0gcmV0W2kzXS5pZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZWFkTmFtZXNbbmFtZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZE5hbWVzW25hbWVdID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWROYW1lc1tuYW1lXSsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZElkc1tpZDJdID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKDAsIF9mb3JFYWNoLmRlZmF1bHQpKF9jb250ZXh0MTEgPSAoMCwgX29iamVjdC5kZWZhdWx0KShyZWFkTmFtZXMpKS5jYWxsKF9jb250ZXh0MTEsIGZ1bmN0aW9uKF9yZWYzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3JlZjQgPSAoMCwgX3NsaWNlZFRvQXJyYXkyMi5kZWZhdWx0KShfcmVmMywgMiksIGsgPSBfcmVmNFswXSwgdiA9IF9yZWY0WzFdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5tYXRlZFBhaXJzW2tdID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEyLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWU3KTsKICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihfeDkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9yZWYyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0oKSkpOwogICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgbWF0ZVByb21pc2VzID0gW107CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxOC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3Byb21pc2UuZGVmYXVsdC5hbGwoKDAsIF9tYXAuZGVmYXVsdCkoZmVhdFByb21pc2VzKS5jYWxsKGZlYXRQcm9taXNlcywgLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWY1ID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU4KGYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldCwgaTMsIG5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IyLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlOCQoX2NvbnRleHQxMykgewogICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTMucHJldiA9IF9jb250ZXh0MTMubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMy5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IF9jb250ZXh0MTMuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkzID0gMDsgaTMgPCByZXQubGVuZ3RoOyBpMysrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gcmV0W2kzXS5uYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodW5tYXRlZFBhaXJzW25hbWVdICYmIChvcHRzLnBhaXJBY3Jvc3NDaHIgfHwgcmV0W2kzXS5fbmV4dF9yZWZpZCgpID09PSBjaHJJZCAmJiBNYXRoLmFicyhyZXRbaTNdLmdldCgic3RhcnQiKSAtIHJldFtpM10uX25leHRfcG9zKCkpIDwgKG9wdHMubWF4SW5zZXJ0U2l6ZSB8fCAyZTUpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRlUHJvbWlzZXMucHVzaChfdGhpczMuaW5kZXguYmxvY2tzRm9yUmFuZ2UocmV0W2kzXS5fbmV4dF9yZWZpZCgpLCByZXRbaTNdLl9uZXh0X3BvcygpLCByZXRbaTNdLl9uZXh0X3BvcygpICsgMSwgb3B0cykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEzLnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWU4KTsKICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihfeDEwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmNS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB9KCkpKTsKICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTgubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9wcm9taXNlLmRlZmF1bHQuYWxsKG1hdGVQcm9taXNlcyk7CiAgICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgICBtYXRlQmxvY2tzID0gX2NvbnRleHQxOC5zZW50OwogICAgICAgICAgICAgICAgICAgIG1hdGVDaHVua3MgPSBbXTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGkyID0gMDsgaTIgPCBtYXRlQmxvY2tzLmxlbmd0aDsgaTIrKykgewogICAgICAgICAgICAgICAgICAgICAgbWF0ZUNodW5rcyA9ICgwLCBfY29uY2F0LmRlZmF1bHQpKG1hdGVDaHVua3MpLmNhbGwobWF0ZUNodW5rcywgbWF0ZUJsb2Nrc1tpMl0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBtYXRlQ2h1bmtzID0gKDAsIF9maWx0ZXIuZGVmYXVsdCkoX2NvbnRleHQxNCA9ICgwLCBfc29ydC5kZWZhdWx0KShtYXRlQ2h1bmtzKS5jYWxsKG1hdGVDaHVua3MpKS5jYWxsKF9jb250ZXh0MTQsIGZ1bmN0aW9uKGl0ZW0sIHBvcywgYXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIXBvcyB8fCBpdGVtLnRvU3RyaW5nKCkgIT09IGFyeVtwb3MgLSAxXS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIG1hdGVUb3RhbFNpemUgPSAoMCwgX3JlZHVjZS5kZWZhdWx0KShfY29udGV4dDE1ID0gKDAsIF9tYXAuZGVmYXVsdCkobWF0ZUNodW5rcykuY2FsbChtYXRlQ2h1bmtzLCBmdW5jdGlvbihzKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcy5mZXRjaGVkU2l6ZSgpOwogICAgICAgICAgICAgICAgICAgIH0pKS5jYWxsKF9jb250ZXh0MTUsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhICsgYjsKICAgICAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIShtYXRlVG90YWxTaXplID4gdGhpcy5mZXRjaFNpemVMaW1pdCkpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTgubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigoMCwgX2NvbmNhdC5kZWZhdWx0KShfY29udGV4dDE2ID0gImRhdGEgc2l6ZSBvZiAiLmNvbmNhdChtYXRlVG90YWxTaXplLnRvTG9jYWxlU3RyaW5nKCksICIgYnl0ZXMgZXhjZWVkZWQgZmV0Y2ggc2l6ZSBsaW1pdCBvZiAiKSkuY2FsbChfY29udGV4dDE2LCB0aGlzLmZldGNoU2l6ZUxpbWl0LnRvTG9jYWxlU3RyaW5nKCksICIgYnl0ZXMiKSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICAgICAgbWF0ZUZlYXRQcm9taXNlcyA9ICgwLCBfbWFwLmRlZmF1bHQpKG1hdGVDaHVua3MpLmNhbGwobWF0ZUNodW5rcywgLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWY2ID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KGMyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfeWllbGQkX3RoaXMzJGZlYXR1cmUsIGRhdGEyLCBjcG9zaXRpb25zLCBkcG9zaXRpb25zLCBjaHVuazIsIGZlYXRzLCBtYXRlUmVjcywgX2kzLCBmZWF0dXJlOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0MTcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE3LnByZXYgPSBfY29udGV4dDE3Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTcubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMy5mZWF0dXJlQ2FjaGUuZ2V0KGMyLnRvU3RyaW5nKCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rOiBjMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBvcHRzLnNpZ25hbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfeWllbGQkX3RoaXMzJGZlYXR1cmUgPSBfY29udGV4dDE3LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTIgPSBfeWllbGQkX3RoaXMzJGZlYXR1cmUuZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcG9zaXRpb25zID0gX3lpZWxkJF90aGlzMyRmZWF0dXJlLmNwb3NpdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHBvc2l0aW9ucyA9IF95aWVsZCRfdGhpczMkZmVhdHVyZS5kcG9zaXRpb25zOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rMiA9IF95aWVsZCRfdGhpczMkZmVhdHVyZS5jaHVuazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE3Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczMucmVhZEJhbUZlYXR1cmVzKGRhdGEyLCBjcG9zaXRpb25zLCBkcG9zaXRpb25zLCBjaHVuazIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmVhdHMgPSBfY29udGV4dDE3LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0ZVJlY3MgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKF9pMyA9IDA7IF9pMyA8IGZlYXRzLmxlbmd0aDsgX2kzICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlYXR1cmUgPSBmZWF0c1tfaTNdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVubWF0ZWRQYWlyc1tmZWF0dXJlLmdldCgibmFtZSIpXSAmJiAhcmVhZElkc1tmZWF0dXJlLmlkKCldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGVSZWNzLnB1c2goZmVhdHVyZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgbWF0ZVJlY3MpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE3LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWU5KTsKICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihfeDExKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmNi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB9KCkpOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTgubmV4dCA9IDE5OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcHJvbWlzZS5kZWZhdWx0LmFsbChtYXRlRmVhdFByb21pc2VzKTsKICAgICAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICAgICAgICBuZXdNYXRlRmVhdHMgPSBfY29udGV4dDE4LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZXNSZXQgPSBbXTsKICAgICAgICAgICAgICAgICAgICBpZiAobmV3TWF0ZUZlYXRzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgbmV3TWF0ZXMgPSAoMCwgX3JlZHVjZS5kZWZhdWx0KShuZXdNYXRlRmVhdHMpLmNhbGwobmV3TWF0ZUZlYXRzLCBmdW5jdGlvbihyZXN1bHQsIGN1cnJlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfY29uY2F0LmRlZmF1bHQpKHJlc3VsdCkuY2FsbChyZXN1bHQsIGN1cnJlbnQpOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlc1JldCA9ICgwLCBfY29uY2F0LmRlZmF1bHQpKGZlYXR1cmVzUmV0KS5jYWxsKGZlYXR1cmVzUmV0LCBuZXdNYXRlcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE4LmFicnVwdCgicmV0dXJuIiwgZmVhdHVyZXNSZXQpOwogICAgICAgICAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE4LnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUxMCwgdGhpcyk7CiAgICAgICAgICB9KSk7CiAgICAgICAgICBmdW5jdGlvbiBmZXRjaFBhaXJzKF94NiwgX3g3LCBfeDgpIHsKICAgICAgICAgICAgcmV0dXJuIF9mZXRjaFBhaXJzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZmV0Y2hQYWlyczsKICAgICAgICB9KCkKICAgICAgfSwgewogICAgICAgIGtleTogIl9yZWFkQ2h1bmsiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBfcmVhZENodW5rMiA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlMTEoX3JlZjcsIGFib3J0U2lnbmFsKSB7CiAgICAgICAgICAgIHZhciBjaHVuazIsIG9wdHMsIGMyLCBidWZzaXplLCByZXMsIGJ5dGVzUmVhZCwgYnVmZmVyMiwgX3lpZWxkJHVuemlwQ2h1bmtTbGljLCBkYXRhMiwgY3Bvc2l0aW9ucywgZHBvc2l0aW9uczsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMSQoX2NvbnRleHQxOSkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTkucHJldiA9IF9jb250ZXh0MTkubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgY2h1bmsyID0gX3JlZjcuY2h1bmssIG9wdHMgPSBfcmVmNy5vcHRzOwogICAgICAgICAgICAgICAgICAgIGMyID0gY2h1bmsyOwogICAgICAgICAgICAgICAgICAgIGJ1ZnNpemUgPSBjMi5mZXRjaGVkU2l6ZSgpOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTkubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYmFtLnJlYWQoQnVmZmVyLmFsbG9jKGJ1ZnNpemUpLCAwLCBidWZzaXplLCBjMi5taW52LmJsb2NrUG9zaXRpb24sIG9wdHMpOwogICAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgcmVzID0gX2NvbnRleHQxOS5zZW50OwogICAgICAgICAgICAgICAgICAgIGJ5dGVzUmVhZCA9IHJlcy5ieXRlc1JlYWQ7CiAgICAgICAgICAgICAgICAgICAgYnVmZmVyMiA9IHJlcy5idWZmZXI7CiAgICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLmNoZWNrQWJvcnRTaWduYWwpKGFib3J0U2lnbmFsKTsKICAgICAgICAgICAgICAgICAgICBpZiAoYnl0ZXNSZWFkKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE5Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOS5hYnJ1cHQoInJldHVybiIsIFtdKTsKICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICBpZiAoYnl0ZXNSZWFkIDwgYnVmc2l6ZSkgewogICAgICAgICAgICAgICAgICAgICAgYnVmZmVyMiA9ICgwLCBfc2xpY2UuZGVmYXVsdCkoYnVmZmVyMikuY2FsbChidWZmZXIyLCAwLCBieXRlc1JlYWQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBidWZmZXIyID0gKDAsIF9zbGljZS5kZWZhdWx0KShidWZmZXIyKS5jYWxsKGJ1ZmZlcjIsIDAsIGJ1ZnNpemUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE5Lm5leHQgPSAxNDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF9iZ3pmRmlsZWhhbmRsZS51bnppcENodW5rU2xpY2UpKGJ1ZmZlcjIsIGNodW5rMik7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICAgICAgX3lpZWxkJHVuemlwQ2h1bmtTbGljID0gX2NvbnRleHQxOS5zZW50OwogICAgICAgICAgICAgICAgICAgIGRhdGEyID0gX3lpZWxkJHVuemlwQ2h1bmtTbGljLmJ1ZmZlcjsKICAgICAgICAgICAgICAgICAgICBjcG9zaXRpb25zID0gX3lpZWxkJHVuemlwQ2h1bmtTbGljLmNwb3NpdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgZHBvc2l0aW9ucyA9IF95aWVsZCR1bnppcENodW5rU2xpYy5kcG9zaXRpb25zOwogICAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC5jaGVja0Fib3J0U2lnbmFsKShhYm9ydFNpZ25hbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTkuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhMiwKICAgICAgICAgICAgICAgICAgICAgIGNwb3NpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICBkcG9zaXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgY2h1bms6IGNodW5rMgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE5LnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUxMSwgdGhpcyk7CiAgICAgICAgICB9KSk7CiAgICAgICAgICBmdW5jdGlvbiBfcmVhZENodW5rKF94MTIsIF94MTMpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZWFkQ2h1bmsyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gX3JlYWRDaHVuazsKICAgICAgICB9KCkKICAgICAgfSwgewogICAgICAgIGtleTogInJlYWRCYW1GZWF0dXJlcyIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF9yZWFkQmFtRmVhdHVyZXMgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEyKGJhLCBjcG9zaXRpb25zLCBkcG9zaXRpb25zLCBjaHVuazIpIHsKICAgICAgICAgICAgdmFyIGJsb2NrU3RhcnQsIHNpbmssIHBvcywgbGFzdDIsIGJsb2NrU2l6ZSwgYmxvY2tFbmQsIGZlYXR1cmU7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IyLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMTIkKF9jb250ZXh0MjApIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIwLnByZXYgPSBfY29udGV4dDIwLm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIGJsb2NrU3RhcnQgPSAwOwogICAgICAgICAgICAgICAgICAgIHNpbmsgPSBbXTsKICAgICAgICAgICAgICAgICAgICBwb3MgPSAwOwogICAgICAgICAgICAgICAgICAgIGxhc3QyID0gKygwLCBfbm93LmRlZmF1bHQpKCk7CiAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICBpZiAoIShibG9ja1N0YXJ0ICsgNCA8IGJhLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjAubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJsb2NrU2l6ZSA9IGJhLnJlYWRJbnQzMkxFKGJsb2NrU3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGJsb2NrRW5kID0gYmxvY2tTdGFydCArIDQgKyBibG9ja1NpemUgLSAxOwogICAgICAgICAgICAgICAgICAgIGlmIChkcG9zaXRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYmxvY2tTdGFydCArIGNodW5rMi5taW52LmRhdGFQb3NpdGlvbiA+PSBkcG9zaXRpb25zW3BvcysrXSkgewogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgcG9zLS07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghKGJsb2NrRW5kIDwgYmEubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyMC5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZSA9IG5ldyBfcmVjb3JkLmRlZmF1bHQoewogICAgICAgICAgICAgICAgICAgICAgYnl0ZXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZUFycmF5OiBiYSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IGJsb2NrU3RhcnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogYmxvY2tFbmQKICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICBmaWxlT2Zmc2V0OiBjcG9zaXRpb25zID8gY3Bvc2l0aW9uc1twb3NdICogKDEgPDwgOCkgKyAoYmxvY2tTdGFydCAtIGRwb3NpdGlvbnNbcG9zXSkgKyBjaHVuazIubWludi5kYXRhUG9zaXRpb24gKyAxIDogX2J1ZmZlckNyYy5kZWZhdWx0LnNpZ25lZCgoMCwgX3NsaWNlLmRlZmF1bHQpKGJhKS5jYWxsKGJhLCBibG9ja1N0YXJ0LCBibG9ja0VuZCkpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgc2luay5wdXNoKGZlYXR1cmUpOwogICAgICAgICAgICAgICAgICAgIGlmICghKHRoaXMueWllbGRUaHJlYWRUaW1lICYmICsoMCwgX25vdy5kZWZhdWx0KSgpIC0gbGFzdDIgPiB0aGlzLnlpZWxkVGhyZWFkVGltZSkpIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjAubmV4dCA9IDE1OwogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjAubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwudGltZW91dCkoMSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICAgICAgbGFzdDIgPSArKDAsIF9ub3cuZGVmYXVsdCkoKTsKICAgICAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgICAgICBibG9ja1N0YXJ0ID0gYmxvY2tFbmQgKyAxOwogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MjAubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjAuYWJydXB0KCJyZXR1cm4iLCBzaW5rKTsKICAgICAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMC5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlMTIsIHRoaXMpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gcmVhZEJhbUZlYXR1cmVzKF94MTQsIF94MTUsIF94MTYsIF94MTcpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZWFkQmFtRmVhdHVyZXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZWFkQmFtRmVhdHVyZXM7CiAgICAgICAgfSgpCiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJoYXNSZWZTZXEiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBfaGFzUmVmU2VxID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMyhzZXFOYW1lKSB7CiAgICAgICAgICAgIHZhciByZWZJZDsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvcjIuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMyQoX2NvbnRleHQyMSkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MjEucHJldiA9IF9jb250ZXh0MjEubmV4dCkgewogICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgcmVmSWQgPSB0aGlzLmNoclRvSW5kZXggJiYgdGhpcy5jaHJUb0luZGV4W3NlcU5hbWVdOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIxLmFicnVwdCgicmV0dXJuIiwgdGhpcy5pbmRleC5oYXNSZWZTZXEocmVmSWQpKTsKICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIxLnN0b3AoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9jYWxsZWUxMywgdGhpcyk7CiAgICAgICAgICB9KSk7CiAgICAgICAgICBmdW5jdGlvbiBoYXNSZWZTZXEoX3gxOCkgewogICAgICAgICAgICByZXR1cm4gX2hhc1JlZlNlcS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGhhc1JlZlNlcTsKICAgICAgICB9KCkKICAgICAgfSwgewogICAgICAgIGtleTogImxpbmVDb3VudCIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIF9saW5lQ291bnQgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE0KHNlcU5hbWUpIHsKICAgICAgICAgICAgdmFyIHJlZklkOwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTE0JChfY29udGV4dDIyKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyMi5wcmV2ID0gX2NvbnRleHQyMi5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICByZWZJZCA9IHRoaXMuY2hyVG9JbmRleCAmJiB0aGlzLmNoclRvSW5kZXhbc2VxTmFtZV07CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjIuYWJydXB0KCJyZXR1cm4iLCB0aGlzLmluZGV4LmxpbmVDb3VudChyZWZJZCkpOwogICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjIuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTE0LCB0aGlzKTsKICAgICAgICAgIH0pKTsKICAgICAgICAgIGZ1bmN0aW9uIGxpbmVDb3VudChfeDE5KSB7CiAgICAgICAgICAgIHJldHVybiBfbGluZUNvdW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbGluZUNvdW50OwogICAgICAgIH0oKQogICAgICB9LCB7CiAgICAgICAga2V5OiAiaW5kZXhDb3YiLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBfaW5kZXhDb3YgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE1KHNlcU5hbWUsIHN0YXJ0LCBlbmQpIHsKICAgICAgICAgICAgdmFyIHNlcUlkOwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTE1JChfY29udGV4dDIzKSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyMy5wcmV2ID0gX2NvbnRleHQyMy5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIzLm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmluZGV4LnBhcnNlKCk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICBzZXFJZCA9IHRoaXMuY2hyVG9JbmRleCAmJiB0aGlzLmNoclRvSW5kZXhbc2VxTmFtZV07CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MjMuYWJydXB0KCJyZXR1cm4iLCB0aGlzLmluZGV4LmluZGV4Q292KHNlcUlkLCBzdGFydCwgZW5kKSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyMy5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlMTUsIHRoaXMpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gaW5kZXhDb3YoX3gyMCwgX3gyMSwgX3gyMikgewogICAgICAgICAgICByZXR1cm4gX2luZGV4Q292LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaW5kZXhDb3Y7CiAgICAgICAgfSgpCiAgICAgIH1dKTsKICAgICAgcmV0dXJuIEJhbUZpbGUyOwogICAgfSgpOwogICAgZXhwb3J0cy5kZWZhdWx0ID0gQmFtRmlsZTsKICB9KShiYW1GaWxlKTsKICB2YXIgaHRzZ2V0ID0ge307CiAgdmFyIG9iamVjdFdpdGhvdXRQcm9wZXJ0aWVzID0geyBleHBvcnRzOiB7fSB9OwogIHZhciBwYXJlbnQkNCA9IGdldE93blByb3BlcnR5U3ltYm9scyQzOwogIHZhciBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMkMSA9IHBhcmVudCQ0OwogIHZhciBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMkMTsKICB2YXIgJCQxID0gX2V4cG9ydDsKICB2YXIgJGluZGV4T2YgPSBhcnJheUluY2x1ZGVzLmluZGV4T2Y7CiAgdmFyIGFycmF5TWV0aG9kSXNTdHJpY3QgPSBhcnJheU1ldGhvZElzU3RyaWN0JDQ7CiAgdmFyIG5hdGl2ZUluZGV4T2YgPSBbXS5pbmRleE9mOwogIHZhciBORUdBVElWRV9aRVJPID0gISFuYXRpdmVJbmRleE9mICYmIDEgLyBbMV0uaW5kZXhPZigxLCAtMCkgPCAwOwogIHZhciBTVFJJQ1RfTUVUSE9EID0gYXJyYXlNZXRob2RJc1N0cmljdCgiaW5kZXhPZiIpOwogICQkMSh7IHRhcmdldDogIkFycmF5IiwgcHJvdG86IHRydWUsIGZvcmNlZDogTkVHQVRJVkVfWkVSTyB8fCAhU1RSSUNUX01FVEhPRCB9LCB7CiAgICBpbmRleE9mOiBmdW5jdGlvbiBpbmRleE9mMihzZWFyY2hFbGVtZW50KSB7CiAgICAgIHJldHVybiBORUdBVElWRV9aRVJPID8gbmF0aXZlSW5kZXhPZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IDAgOiAkaW5kZXhPZih0aGlzLCBzZWFyY2hFbGVtZW50LCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHZvaWQgMCk7CiAgICB9CiAgfSk7CiAgdmFyIGVudHJ5VmlydHVhbCQxID0gZW50cnlWaXJ0dWFsJGE7CiAgdmFyIGluZGV4T2YkNCA9IGVudHJ5VmlydHVhbCQxKCJBcnJheSIpLmluZGV4T2Y7CiAgdmFyIGluZGV4T2YkMyA9IGluZGV4T2YkNDsKICB2YXIgQXJyYXlQcm90b3R5cGUgPSBBcnJheS5wcm90b3R5cGU7CiAgdmFyIGluZGV4T2ZfMSA9IGZ1bmN0aW9uKGl0KSB7CiAgICB2YXIgb3duID0gaXQuaW5kZXhPZjsKICAgIHJldHVybiBpdCA9PT0gQXJyYXlQcm90b3R5cGUgfHwgaXQgaW5zdGFuY2VvZiBBcnJheSAmJiBvd24gPT09IEFycmF5UHJvdG90eXBlLmluZGV4T2YgPyBpbmRleE9mJDMgOiBvd247CiAgfTsKICB2YXIgcGFyZW50JDMgPSBpbmRleE9mXzE7CiAgdmFyIGluZGV4T2YkMiA9IHBhcmVudCQzOwogIHZhciBwYXJlbnQkMiA9IGluZGV4T2YkMjsKICB2YXIgaW5kZXhPZiQxID0gcGFyZW50JDI7CiAgdmFyIGluZGV4T2YgPSBpbmRleE9mJDE7CiAgdmFyIG9iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UgPSB7IGV4cG9ydHM6IHt9IH07CiAgdmFyIHBhcmVudCQxID0ga2V5cyQzOwogIHZhciBrZXlzJDEgPSBwYXJlbnQkMTsKICB2YXIga2V5cyA9IGtleXMkMTsKICAoZnVuY3Rpb24obW9kdWxlKSB7CiAgICB2YXIgX09iamVjdCRrZXlzID0ga2V5czsKICAgIHZhciBfaW5kZXhPZkluc3RhbmNlUHJvcGVydHkgPSBpbmRleE9mOwogICAgZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2Uoc291cmNlLCBleGNsdWRlZCkgewogICAgICBpZiAoc291cmNlID09IG51bGwpCiAgICAgICAgcmV0dXJuIHt9OwogICAgICB2YXIgdGFyZ2V0ID0ge307CiAgICAgIHZhciBzb3VyY2VLZXlzID0gX09iamVjdCRrZXlzKHNvdXJjZSk7CiAgICAgIHZhciBrZXksIGkyOwogICAgICBmb3IgKGkyID0gMDsgaTIgPCBzb3VyY2VLZXlzLmxlbmd0aDsgaTIrKykgewogICAgICAgIGtleSA9IHNvdXJjZUtleXNbaTJdOwogICAgICAgIGlmIChfaW5kZXhPZkluc3RhbmNlUHJvcGVydHkoZXhjbHVkZWQpLmNhbGwoZXhjbHVkZWQsIGtleSkgPj0gMCkKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgIH0KICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIG1vZHVsZS5leHBvcnRzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2U7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKG9iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UpOwogIChmdW5jdGlvbihtb2R1bGUpIHsKICAgIHZhciBfT2JqZWN0JGdldE93blByb3BlcnR5U3ltYm9scyA9IGdldE93blByb3BlcnR5U3ltYm9sczsKICAgIHZhciBfaW5kZXhPZkluc3RhbmNlUHJvcGVydHkgPSBpbmRleE9mOwogICAgdmFyIG9iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UkMSA9IG9iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UuZXhwb3J0czsKICAgIGZ1bmN0aW9uIF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhzb3VyY2UsIGV4Y2x1ZGVkKSB7CiAgICAgIGlmIChzb3VyY2UgPT0gbnVsbCkKICAgICAgICByZXR1cm4ge307CiAgICAgIHZhciB0YXJnZXQgPSBvYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlJDEoc291cmNlLCBleGNsdWRlZCk7CiAgICAgIHZhciBrZXksIGkyOwogICAgICBpZiAoX09iamVjdCRnZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgICAgICB2YXIgc291cmNlU3ltYm9sS2V5cyA9IF9PYmplY3QkZ2V0T3duUHJvcGVydHlTeW1ib2xzKHNvdXJjZSk7CiAgICAgICAgZm9yIChpMiA9IDA7IGkyIDwgc291cmNlU3ltYm9sS2V5cy5sZW5ndGg7IGkyKyspIHsKICAgICAgICAgIGtleSA9IHNvdXJjZVN5bWJvbEtleXNbaTJdOwogICAgICAgICAgaWYgKF9pbmRleE9mSW5zdGFuY2VQcm9wZXJ0eShleGNsdWRlZCkuY2FsbChleGNsdWRlZCwga2V5KSA+PSAwKQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHNvdXJjZSwga2V5KSkKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgbW9kdWxlLmV4cG9ydHMgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXM7CiAgICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKG9iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKTsKICB2YXIgaXNPYmplY3QgPSBpc09iamVjdCRpOwogIHZhciBjbGFzc29mID0gY2xhc3NvZlJhdyQxOwogIHZhciB3ZWxsS25vd25TeW1ib2wkMSA9IHdlbGxLbm93blN5bWJvbCRsOwogIHZhciBNQVRDSCQxID0gd2VsbEtub3duU3ltYm9sJDEoIm1hdGNoIik7CiAgdmFyIGlzUmVnZXhwID0gZnVuY3Rpb24oaXQpIHsKICAgIHZhciBpc1JlZ0V4cDI7CiAgICByZXR1cm4gaXNPYmplY3QoaXQpICYmICgoaXNSZWdFeHAyID0gaXRbTUFUQ0gkMV0pICE9PSB2b2lkIDAgPyAhIWlzUmVnRXhwMiA6IGNsYXNzb2YoaXQpID09ICJSZWdFeHAiKTsKICB9OwogIHZhciBpc1JlZ0V4cCA9IGlzUmVnZXhwOwogIHZhciBub3RBUmVnZXhwID0gZnVuY3Rpb24oaXQpIHsKICAgIGlmIChpc1JlZ0V4cChpdCkpIHsKICAgICAgdGhyb3cgVHlwZUVycm9yKCJUaGUgbWV0aG9kIGRvZXNuJ3QgYWNjZXB0IHJlZ3VsYXIgZXhwcmVzc2lvbnMiKTsKICAgIH0KICAgIHJldHVybiBpdDsKICB9OwogIHZhciB3ZWxsS25vd25TeW1ib2wgPSB3ZWxsS25vd25TeW1ib2wkbDsKICB2YXIgTUFUQ0ggPSB3ZWxsS25vd25TeW1ib2woIm1hdGNoIik7CiAgdmFyIGNvcnJlY3RJc1JlZ2V4cExvZ2ljID0gZnVuY3Rpb24oTUVUSE9EX05BTUUpIHsKICAgIHZhciByZWdleHAgPSAvLi87CiAgICB0cnkgewogICAgICAiLy4vIltNRVRIT0RfTkFNRV0ocmVnZXhwKTsKICAgIH0gY2F0Y2ggKGVycm9yMSkgewogICAgICB0cnkgewogICAgICAgIHJlZ2V4cFtNQVRDSF0gPSBmYWxzZTsKICAgICAgICByZXR1cm4gIi8uLyJbTUVUSE9EX05BTUVdKHJlZ2V4cCk7CiAgICAgIH0gY2F0Y2ggKGVycm9yMikgewogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfTsKICB2YXIgJCA9IF9leHBvcnQ7CiAgdmFyIHRvTGVuZ3RoID0gdG9MZW5ndGgkOTsKICB2YXIgdG9TdHJpbmcgPSB0b1N0cmluZyRhOwogIHZhciBub3RBUmVnRXhwID0gbm90QVJlZ2V4cDsKICB2YXIgcmVxdWlyZU9iamVjdENvZXJjaWJsZSA9IHJlcXVpcmVPYmplY3RDb2VyY2libGUkNTsKICB2YXIgY29ycmVjdElzUmVnRXhwTG9naWMgPSBjb3JyZWN0SXNSZWdleHBMb2dpYzsKICB2YXIgJHN0YXJ0c1dpdGggPSAiIi5zdGFydHNXaXRoOwogIHZhciBtaW4gPSBNYXRoLm1pbjsKICB2YXIgQ09SUkVDVF9JU19SRUdFWFBfTE9HSUMgPSBjb3JyZWN0SXNSZWdFeHBMb2dpYygic3RhcnRzV2l0aCIpOwogICQoeyB0YXJnZXQ6ICJTdHJpbmciLCBwcm90bzogdHJ1ZSwgZm9yY2VkOiAhQ09SUkVDVF9JU19SRUdFWFBfTE9HSUMgfSwgewogICAgc3RhcnRzV2l0aDogZnVuY3Rpb24gc3RhcnRzV2l0aDIoc2VhcmNoU3RyaW5nKSB7CiAgICAgIHZhciB0aGF0ID0gdG9TdHJpbmcocmVxdWlyZU9iamVjdENvZXJjaWJsZSh0aGlzKSk7CiAgICAgIG5vdEFSZWdFeHAoc2VhcmNoU3RyaW5nKTsKICAgICAgdmFyIGluZGV4ID0gdG9MZW5ndGgobWluKGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdm9pZCAwLCB0aGF0Lmxlbmd0aCkpOwogICAgICB2YXIgc2VhcmNoID0gdG9TdHJpbmcoc2VhcmNoU3RyaW5nKTsKICAgICAgcmV0dXJuICRzdGFydHNXaXRoID8gJHN0YXJ0c1dpdGguY2FsbCh0aGF0LCBzZWFyY2gsIGluZGV4KSA6IHRoYXQuc2xpY2UoaW5kZXgsIGluZGV4ICsgc2VhcmNoLmxlbmd0aCkgPT09IHNlYXJjaDsKICAgIH0KICB9KTsKICB2YXIgZW50cnlWaXJ0dWFsID0gZW50cnlWaXJ0dWFsJGE7CiAgdmFyIHN0YXJ0c1dpdGgkMyA9IGVudHJ5VmlydHVhbCgiU3RyaW5nIikuc3RhcnRzV2l0aDsKICB2YXIgc3RhcnRzV2l0aCQyID0gc3RhcnRzV2l0aCQzOwogIHZhciBTdHJpbmdQcm90b3R5cGUgPSBTdHJpbmcucHJvdG90eXBlOwogIHZhciBzdGFydHNXaXRoXzEgPSBmdW5jdGlvbihpdCkgewogICAgdmFyIG93biA9IGl0LnN0YXJ0c1dpdGg7CiAgICByZXR1cm4gdHlwZW9mIGl0ID09PSAic3RyaW5nIiB8fCBpdCA9PT0gU3RyaW5nUHJvdG90eXBlIHx8IGl0IGluc3RhbmNlb2YgU3RyaW5nICYmIG93biA9PT0gU3RyaW5nUHJvdG90eXBlLnN0YXJ0c1dpdGggPyBzdGFydHNXaXRoJDIgOiBvd247CiAgfTsKICB2YXIgcGFyZW50ID0gc3RhcnRzV2l0aF8xOwogIHZhciBzdGFydHNXaXRoJDEgPSBwYXJlbnQ7CiAgdmFyIHN0YXJ0c1dpdGggPSBzdGFydHNXaXRoJDE7CiAgKGZ1bmN0aW9uKCkgewogICAgKGZ1bmN0aW9uKHNlbGYyKSB7CiAgICAgIChmdW5jdGlvbihleHBvcnRzKSB7CiAgICAgICAgdmFyIHN1cHBvcnQgPSB7CiAgICAgICAgICBzZWFyY2hQYXJhbXM6ICJVUkxTZWFyY2hQYXJhbXMiIGluIHNlbGYyLAogICAgICAgICAgaXRlcmFibGU6ICJTeW1ib2wiIGluIHNlbGYyICYmICJpdGVyYXRvciIgaW4gU3ltYm9sLAogICAgICAgICAgYmxvYjogIkZpbGVSZWFkZXIiIGluIHNlbGYyICYmICJCbG9iIiBpbiBzZWxmMiAmJiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBuZXcgQmxvYigpOwogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KCksCiAgICAgICAgICBmb3JtRGF0YTogIkZvcm1EYXRhIiBpbiBzZWxmMiwKICAgICAgICAgIGFycmF5QnVmZmVyOiAiQXJyYXlCdWZmZXIiIGluIHNlbGYyCiAgICAgICAgfTsKICAgICAgICBmdW5jdGlvbiBpc0RhdGFWaWV3KG9iaikgewogICAgICAgICAgcmV0dXJuIG9iaiAmJiBEYXRhVmlldy5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihvYmopOwogICAgICAgIH0KICAgICAgICBpZiAoc3VwcG9ydC5hcnJheUJ1ZmZlcikgewogICAgICAgICAgdmFyIHZpZXdDbGFzc2VzID0gWwogICAgICAgICAgICAiW29iamVjdCBJbnQ4QXJyYXldIiwKICAgICAgICAgICAgIltvYmplY3QgVWludDhBcnJheV0iLAogICAgICAgICAgICAiW29iamVjdCBVaW50OENsYW1wZWRBcnJheV0iLAogICAgICAgICAgICAiW29iamVjdCBJbnQxNkFycmF5XSIsCiAgICAgICAgICAgICJbb2JqZWN0IFVpbnQxNkFycmF5XSIsCiAgICAgICAgICAgICJbb2JqZWN0IEludDMyQXJyYXldIiwKICAgICAgICAgICAgIltvYmplY3QgVWludDMyQXJyYXldIiwKICAgICAgICAgICAgIltvYmplY3QgRmxvYXQzMkFycmF5XSIsCiAgICAgICAgICAgICJbb2JqZWN0IEZsb2F0NjRBcnJheV0iCiAgICAgICAgICBdOwogICAgICAgICAgdmFyIGlzQXJyYXlCdWZmZXJWaWV3ID0gQXJyYXlCdWZmZXIuaXNWaWV3IHx8IGZ1bmN0aW9uKG9iaikgewogICAgICAgICAgICByZXR1cm4gb2JqICYmIHZpZXdDbGFzc2VzLmluZGV4T2YoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikpID4gLTE7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBub3JtYWxpemVOYW1lKG5hbWUpIHsKICAgICAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgbmFtZSA9IFN0cmluZyhuYW1lKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICgvW15hLXowLTlcLSMkJSYnKisuXl9gfH5dL2kudGVzdChuYW1lKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGNoYXJhY3RlciBpbiBoZWFkZXIgZmllbGQgbmFtZSIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbm9ybWFsaXplVmFsdWUodmFsdWUpIHsKICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIHZhbHVlID0gU3RyaW5nKHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaXRlcmF0b3JGb3IoaXRlbXMpIHsKICAgICAgICAgIHZhciBpdGVyYXRvcjIgPSB7CiAgICAgICAgICAgIG5leHQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGl0ZW1zLnNoaWZ0KCk7CiAgICAgICAgICAgICAgcmV0dXJuIHsgZG9uZTogdmFsdWUgPT09IHZvaWQgMCwgdmFsdWUgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIGlmIChzdXBwb3J0Lml0ZXJhYmxlKSB7CiAgICAgICAgICAgIGl0ZXJhdG9yMltTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGl0ZXJhdG9yMjsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBpdGVyYXRvcjI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEhlYWRlcnMoaGVhZGVycykgewogICAgICAgICAgdGhpcy5tYXAgPSB7fTsKICAgICAgICAgIGlmIChoZWFkZXJzIGluc3RhbmNlb2YgSGVhZGVycykgewogICAgICAgICAgICBoZWFkZXJzLmZvckVhY2goZnVuY3Rpb24odmFsdWUsIG5hbWUpIHsKICAgICAgICAgICAgICB0aGlzLmFwcGVuZChuYW1lLCB2YWx1ZSk7CiAgICAgICAgICAgIH0sIHRoaXMpOwogICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGhlYWRlcnMpKSB7CiAgICAgICAgICAgIGhlYWRlcnMuZm9yRWFjaChmdW5jdGlvbihoZWFkZXIpIHsKICAgICAgICAgICAgICB0aGlzLmFwcGVuZChoZWFkZXJbMF0sIGhlYWRlclsxXSk7CiAgICAgICAgICAgIH0sIHRoaXMpOwogICAgICAgICAgfSBlbHNlIGlmIChoZWFkZXJzKSB7CiAgICAgICAgICAgIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGhlYWRlcnMpLmZvckVhY2goZnVuY3Rpb24obmFtZSkgewogICAgICAgICAgICAgIHRoaXMuYXBwZW5kKG5hbWUsIGhlYWRlcnNbbmFtZV0pOwogICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgSGVhZGVycy5wcm90b3R5cGUuYXBwZW5kID0gZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKICAgICAgICAgIG5hbWUgPSBub3JtYWxpemVOYW1lKG5hbWUpOwogICAgICAgICAgdmFsdWUgPSBub3JtYWxpemVWYWx1ZSh2YWx1ZSk7CiAgICAgICAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLm1hcFtuYW1lXTsKICAgICAgICAgIHRoaXMubWFwW25hbWVdID0gb2xkVmFsdWUgPyBvbGRWYWx1ZSArICIsICIgKyB2YWx1ZSA6IHZhbHVlOwogICAgICAgIH07CiAgICAgICAgSGVhZGVycy5wcm90b3R5cGVbImRlbGV0ZSJdID0gZnVuY3Rpb24obmFtZSkgewogICAgICAgICAgZGVsZXRlIHRoaXMubWFwW25vcm1hbGl6ZU5hbWUobmFtZSldOwogICAgICAgIH07CiAgICAgICAgSGVhZGVycy5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24obmFtZSkgewogICAgICAgICAgbmFtZSA9IG5vcm1hbGl6ZU5hbWUobmFtZSk7CiAgICAgICAgICByZXR1cm4gdGhpcy5oYXMobmFtZSkgPyB0aGlzLm1hcFtuYW1lXSA6IG51bGw7CiAgICAgICAgfTsKICAgICAgICBIZWFkZXJzLnByb3RvdHlwZS5oYXMgPSBmdW5jdGlvbihuYW1lKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5tYXAuaGFzT3duUHJvcGVydHkobm9ybWFsaXplTmFtZShuYW1lKSk7CiAgICAgICAgfTsKICAgICAgICBIZWFkZXJzLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewogICAgICAgICAgdGhpcy5tYXBbbm9ybWFsaXplTmFtZShuYW1lKV0gPSBub3JtYWxpemVWYWx1ZSh2YWx1ZSk7CiAgICAgICAgfTsKICAgICAgICBIZWFkZXJzLnByb3RvdHlwZS5mb3JFYWNoID0gZnVuY3Rpb24oY2FsbGJhY2ssIHRoaXNBcmcpIHsKICAgICAgICAgIGZvciAodmFyIG5hbWUgaW4gdGhpcy5tYXApIHsKICAgICAgICAgICAgaWYgKHRoaXMubWFwLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzQXJnLCB0aGlzLm1hcFtuYW1lXSwgbmFtZSwgdGhpcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIEhlYWRlcnMucHJvdG90eXBlLmtleXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBpdGVtcyA9IFtdOwogICAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7CiAgICAgICAgICAgIGl0ZW1zLnB1c2gobmFtZSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBpdGVyYXRvckZvcihpdGVtcyk7CiAgICAgICAgfTsKICAgICAgICBIZWFkZXJzLnByb3RvdHlwZS52YWx1ZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBpdGVtcyA9IFtdOwogICAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgIGl0ZW1zLnB1c2godmFsdWUpOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gaXRlcmF0b3JGb3IoaXRlbXMpOwogICAgICAgIH07CiAgICAgICAgSGVhZGVycy5wcm90b3R5cGUuZW50cmllcyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGl0ZW1zID0gW107CiAgICAgICAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24odmFsdWUsIG5hbWUpIHsKICAgICAgICAgICAgaXRlbXMucHVzaChbbmFtZSwgdmFsdWVdKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIGl0ZXJhdG9yRm9yKGl0ZW1zKTsKICAgICAgICB9OwogICAgICAgIGlmIChzdXBwb3J0Lml0ZXJhYmxlKSB7CiAgICAgICAgICBIZWFkZXJzLnByb3RvdHlwZVtTeW1ib2wuaXRlcmF0b3JdID0gSGVhZGVycy5wcm90b3R5cGUuZW50cmllczsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY29uc3VtZWQoYm9keSkgewogICAgICAgICAgaWYgKGJvZHkuYm9keVVzZWQpIHsKICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBUeXBlRXJyb3IoIkFscmVhZHkgcmVhZCIpKTsKICAgICAgICAgIH0KICAgICAgICAgIGJvZHkuYm9keVVzZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBmaWxlUmVhZGVyUmVhZHkocmVhZGVyKSB7CiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXNvbHZlKHJlYWRlci5yZXN1bHQpOwogICAgICAgICAgICB9OwogICAgICAgICAgICByZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJlamVjdChyZWFkZXIuZXJyb3IpOwogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHJlYWRCbG9iQXNBcnJheUJ1ZmZlcjIoYmxvYikgewogICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICB2YXIgcHJvbWlzZTIgPSBmaWxlUmVhZGVyUmVhZHkocmVhZGVyKTsKICAgICAgICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihibG9iKTsKICAgICAgICAgIHJldHVybiBwcm9taXNlMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcmVhZEJsb2JBc1RleHQyKGJsb2IpIHsKICAgICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgdmFyIHByb21pc2UyID0gZmlsZVJlYWRlclJlYWR5KHJlYWRlcik7CiAgICAgICAgICByZWFkZXIucmVhZEFzVGV4dChibG9iKTsKICAgICAgICAgIHJldHVybiBwcm9taXNlMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcmVhZEFycmF5QnVmZmVyQXNUZXh0KGJ1ZikgewogICAgICAgICAgdmFyIHZpZXcgPSBuZXcgVWludDhBcnJheShidWYpOwogICAgICAgICAgdmFyIGNoYXJzID0gbmV3IEFycmF5KHZpZXcubGVuZ3RoKTsKICAgICAgICAgIGZvciAodmFyIGkyID0gMDsgaTIgPCB2aWV3Lmxlbmd0aDsgaTIrKykgewogICAgICAgICAgICBjaGFyc1tpMl0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHZpZXdbaTJdKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBjaGFycy5qb2luKCIiKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYnVmZmVyQ2xvbmUoYnVmKSB7CiAgICAgICAgICBpZiAoYnVmLnNsaWNlKSB7CiAgICAgICAgICAgIHJldHVybiBidWYuc2xpY2UoMCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgdmlldyA9IG5ldyBVaW50OEFycmF5KGJ1Zi5ieXRlTGVuZ3RoKTsKICAgICAgICAgICAgdmlldy5zZXQobmV3IFVpbnQ4QXJyYXkoYnVmKSk7CiAgICAgICAgICAgIHJldHVybiB2aWV3LmJ1ZmZlcjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gQm9keSgpIHsKICAgICAgICAgIHRoaXMuYm9keVVzZWQgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuX2luaXRCb2R5ID0gZnVuY3Rpb24oYm9keSkgewogICAgICAgICAgICB0aGlzLl9ib2R5SW5pdCA9IGJvZHk7CiAgICAgICAgICAgIGlmICghYm9keSkgewogICAgICAgICAgICAgIHRoaXMuX2JvZHlUZXh0ID0gIiI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGJvZHkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgdGhpcy5fYm9keVRleHQgPSBib2R5OwogICAgICAgICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuYmxvYiAmJiBCbG9iLnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKGJvZHkpKSB7CiAgICAgICAgICAgICAgdGhpcy5fYm9keUJsb2IgPSBib2R5OwogICAgICAgICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuZm9ybURhdGEgJiYgRm9ybURhdGEucHJvdG90eXBlLmlzUHJvdG90eXBlT2YoYm9keSkpIHsKICAgICAgICAgICAgICB0aGlzLl9ib2R5Rm9ybURhdGEgPSBib2R5OwogICAgICAgICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuc2VhcmNoUGFyYW1zICYmIFVSTFNlYXJjaFBhcmFtcy5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihib2R5KSkgewogICAgICAgICAgICAgIHRoaXMuX2JvZHlUZXh0ID0gYm9keS50b1N0cmluZygpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuYXJyYXlCdWZmZXIgJiYgc3VwcG9ydC5ibG9iICYmIGlzRGF0YVZpZXcoYm9keSkpIHsKICAgICAgICAgICAgICB0aGlzLl9ib2R5QXJyYXlCdWZmZXIgPSBidWZmZXJDbG9uZShib2R5LmJ1ZmZlcik7CiAgICAgICAgICAgICAgdGhpcy5fYm9keUluaXQgPSBuZXcgQmxvYihbdGhpcy5fYm9keUFycmF5QnVmZmVyXSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydC5hcnJheUJ1ZmZlciAmJiAoQXJyYXlCdWZmZXIucHJvdG90eXBlLmlzUHJvdG90eXBlT2YoYm9keSkgfHwgaXNBcnJheUJ1ZmZlclZpZXcoYm9keSkpKSB7CiAgICAgICAgICAgICAgdGhpcy5fYm9keUFycmF5QnVmZmVyID0gYnVmZmVyQ2xvbmUoYm9keSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5fYm9keVRleHQgPSBib2R5ID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGJvZHkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghdGhpcy5oZWFkZXJzLmdldCgiY29udGVudC10eXBlIikpIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGJvZHkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICB0aGlzLmhlYWRlcnMuc2V0KCJjb250ZW50LXR5cGUiLCAidGV4dC9wbGFpbjtjaGFyc2V0PVVURi04Iik7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9ib2R5QmxvYiAmJiB0aGlzLl9ib2R5QmxvYi50eXBlKSB7CiAgICAgICAgICAgICAgICB0aGlzLmhlYWRlcnMuc2V0KCJjb250ZW50LXR5cGUiLCB0aGlzLl9ib2R5QmxvYi50eXBlKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN1cHBvcnQuc2VhcmNoUGFyYW1zICYmIFVSTFNlYXJjaFBhcmFtcy5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihib2R5KSkgewogICAgICAgICAgICAgICAgdGhpcy5oZWFkZXJzLnNldCgiY29udGVudC10eXBlIiwgImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDtjaGFyc2V0PVVURi04Iik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgaWYgKHN1cHBvcnQuYmxvYikgewogICAgICAgICAgICB0aGlzLmJsb2IgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB2YXIgcmVqZWN0ZWQgPSBjb25zdW1lZCh0aGlzKTsKICAgICAgICAgICAgICBpZiAocmVqZWN0ZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZWplY3RlZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHRoaXMuX2JvZHlCbG9iKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuX2JvZHlCbG9iKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2JvZHlBcnJheUJ1ZmZlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgQmxvYihbdGhpcy5fYm9keUFycmF5QnVmZmVyXSkpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fYm9keUZvcm1EYXRhKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImNvdWxkIG5vdCByZWFkIEZvcm1EYXRhIGJvZHkgYXMgYmxvYiIpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBCbG9iKFt0aGlzLl9ib2R5VGV4dF0pKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMuYXJyYXlCdWZmZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5fYm9keUFycmF5QnVmZmVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3VtZWQodGhpcykgfHwgUHJvbWlzZS5yZXNvbHZlKHRoaXMuX2JvZHlBcnJheUJ1ZmZlcik7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJsb2IoKS50aGVuKHJlYWRCbG9iQXNBcnJheUJ1ZmZlcjIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMudGV4dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgcmVqZWN0ZWQgPSBjb25zdW1lZCh0aGlzKTsKICAgICAgICAgICAgaWYgKHJlamVjdGVkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdGVkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9ib2R5QmxvYikgewogICAgICAgICAgICAgIHJldHVybiByZWFkQmxvYkFzVGV4dDIodGhpcy5fYm9keUJsb2IpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2JvZHlBcnJheUJ1ZmZlcikgewogICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVhZEFycmF5QnVmZmVyQXNUZXh0KHRoaXMuX2JvZHlBcnJheUJ1ZmZlcikpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2JvZHlGb3JtRGF0YSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiY291bGQgbm90IHJlYWQgRm9ybURhdGEgYm9keSBhcyB0ZXh0Iik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLl9ib2R5VGV4dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgICBpZiAoc3VwcG9ydC5mb3JtRGF0YSkgewogICAgICAgICAgICB0aGlzLmZvcm1EYXRhID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudGV4dCgpLnRoZW4oZGVjb2RlKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuanNvbiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy50ZXh0KCkudGhlbihKU09OLnBhcnNlKTsKICAgICAgICAgIH07CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgdmFyIG1ldGhvZHMgPSBbIkRFTEVURSIsICJHRVQiLCAiSEVBRCIsICJPUFRJT05TIiwgIlBPU1QiLCAiUFVUIl07CiAgICAgICAgZnVuY3Rpb24gbm9ybWFsaXplTWV0aG9kKG1ldGhvZCkgewogICAgICAgICAgdmFyIHVwY2FzZWQgPSBtZXRob2QudG9VcHBlckNhc2UoKTsKICAgICAgICAgIHJldHVybiBtZXRob2RzLmluZGV4T2YodXBjYXNlZCkgPiAtMSA/IHVwY2FzZWQgOiBtZXRob2Q7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFJlcXVlc3QoaW5wdXQsIG9wdGlvbnMpIHsKICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgICAgdmFyIGJvZHkgPSBvcHRpb25zLmJvZHk7CiAgICAgICAgICBpZiAoaW5wdXQgaW5zdGFuY2VvZiBSZXF1ZXN0KSB7CiAgICAgICAgICAgIGlmIChpbnB1dC5ib2R5VXNlZCkgewogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkFscmVhZHkgcmVhZCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudXJsID0gaW5wdXQudXJsOwogICAgICAgICAgICB0aGlzLmNyZWRlbnRpYWxzID0gaW5wdXQuY3JlZGVudGlhbHM7CiAgICAgICAgICAgIGlmICghb3B0aW9ucy5oZWFkZXJzKSB7CiAgICAgICAgICAgICAgdGhpcy5oZWFkZXJzID0gbmV3IEhlYWRlcnMoaW5wdXQuaGVhZGVycyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5tZXRob2QgPSBpbnB1dC5tZXRob2Q7CiAgICAgICAgICAgIHRoaXMubW9kZSA9IGlucHV0Lm1vZGU7CiAgICAgICAgICAgIHRoaXMuc2lnbmFsID0gaW5wdXQuc2lnbmFsOwogICAgICAgICAgICBpZiAoIWJvZHkgJiYgaW5wdXQuX2JvZHlJbml0ICE9IG51bGwpIHsKICAgICAgICAgICAgICBib2R5ID0gaW5wdXQuX2JvZHlJbml0OwogICAgICAgICAgICAgIGlucHV0LmJvZHlVc2VkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy51cmwgPSBTdHJpbmcoaW5wdXQpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5jcmVkZW50aWFscyA9IG9wdGlvbnMuY3JlZGVudGlhbHMgfHwgdGhpcy5jcmVkZW50aWFscyB8fCAic2FtZS1vcmlnaW4iOwogICAgICAgICAgaWYgKG9wdGlvbnMuaGVhZGVycyB8fCAhdGhpcy5oZWFkZXJzKSB7CiAgICAgICAgICAgIHRoaXMuaGVhZGVycyA9IG5ldyBIZWFkZXJzKG9wdGlvbnMuaGVhZGVycyk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLm1ldGhvZCA9IG5vcm1hbGl6ZU1ldGhvZChvcHRpb25zLm1ldGhvZCB8fCB0aGlzLm1ldGhvZCB8fCAiR0VUIik7CiAgICAgICAgICB0aGlzLm1vZGUgPSBvcHRpb25zLm1vZGUgfHwgdGhpcy5tb2RlIHx8IG51bGw7CiAgICAgICAgICB0aGlzLnNpZ25hbCA9IG9wdGlvbnMuc2lnbmFsIHx8IHRoaXMuc2lnbmFsOwogICAgICAgICAgdGhpcy5yZWZlcnJlciA9IG51bGw7CiAgICAgICAgICBpZiAoKHRoaXMubWV0aG9kID09PSAiR0VUIiB8fCB0aGlzLm1ldGhvZCA9PT0gIkhFQUQiKSAmJiBib2R5KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkJvZHkgbm90IGFsbG93ZWQgZm9yIEdFVCBvciBIRUFEIHJlcXVlc3RzIik7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLl9pbml0Qm9keShib2R5KTsKICAgICAgICB9CiAgICAgICAgUmVxdWVzdC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBuZXcgUmVxdWVzdCh0aGlzLCB7IGJvZHk6IHRoaXMuX2JvZHlJbml0IH0pOwogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gZGVjb2RlKGJvZHkpIHsKICAgICAgICAgIHZhciBmb3JtID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgICAgICBib2R5LnRyaW0oKS5zcGxpdCgiJiIpLmZvckVhY2goZnVuY3Rpb24oYnl0ZXMpIHsKICAgICAgICAgICAgaWYgKGJ5dGVzKSB7CiAgICAgICAgICAgICAgdmFyIHNwbGl0MiA9IGJ5dGVzLnNwbGl0KCI9Iik7CiAgICAgICAgICAgICAgdmFyIG5hbWUgPSBzcGxpdDIuc2hpZnQoKS5yZXBsYWNlKC9cKy9nLCAiICIpOwogICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHNwbGl0Mi5qb2luKCI9IikucmVwbGFjZSgvXCsvZywgIiAiKTsKICAgICAgICAgICAgICBmb3JtLmFwcGVuZChkZWNvZGVVUklDb21wb25lbnQobmFtZSksIGRlY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBmb3JtOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBwYXJzZUhlYWRlcnMocmF3SGVhZGVycykgewogICAgICAgICAgdmFyIGhlYWRlcnMgPSBuZXcgSGVhZGVycygpOwogICAgICAgICAgdmFyIHByZVByb2Nlc3NlZEhlYWRlcnMgPSByYXdIZWFkZXJzLnJlcGxhY2UoL1xyP1xuW1x0IF0rL2csICIgIik7CiAgICAgICAgICBwcmVQcm9jZXNzZWRIZWFkZXJzLnNwbGl0KC9ccj9cbi8pLmZvckVhY2goZnVuY3Rpb24obGluZSkgewogICAgICAgICAgICB2YXIgcGFydHMgPSBsaW5lLnNwbGl0KCI6Iik7CiAgICAgICAgICAgIHZhciBrZXkgPSBwYXJ0cy5zaGlmdCgpLnRyaW0oKTsKICAgICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHBhcnRzLmpvaW4oIjoiKS50cmltKCk7CiAgICAgICAgICAgICAgaGVhZGVycy5hcHBlbmQoa2V5LCB2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIGhlYWRlcnM7CiAgICAgICAgfQogICAgICAgIEJvZHkuY2FsbChSZXF1ZXN0LnByb3RvdHlwZSk7CiAgICAgICAgZnVuY3Rpb24gUmVzcG9uc2UoYm9keUluaXQsIG9wdGlvbnMpIHsKICAgICAgICAgIGlmICghb3B0aW9ucykgewogICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnR5cGUgPSAiZGVmYXVsdCI7CiAgICAgICAgICB0aGlzLnN0YXR1cyA9IG9wdGlvbnMuc3RhdHVzID09PSB2b2lkIDAgPyAyMDAgOiBvcHRpb25zLnN0YXR1czsKICAgICAgICAgIHRoaXMub2sgPSB0aGlzLnN0YXR1cyA+PSAyMDAgJiYgdGhpcy5zdGF0dXMgPCAzMDA7CiAgICAgICAgICB0aGlzLnN0YXR1c1RleHQgPSAic3RhdHVzVGV4dCIgaW4gb3B0aW9ucyA/IG9wdGlvbnMuc3RhdHVzVGV4dCA6ICJPSyI7CiAgICAgICAgICB0aGlzLmhlYWRlcnMgPSBuZXcgSGVhZGVycyhvcHRpb25zLmhlYWRlcnMpOwogICAgICAgICAgdGhpcy51cmwgPSBvcHRpb25zLnVybCB8fCAiIjsKICAgICAgICAgIHRoaXMuX2luaXRCb2R5KGJvZHlJbml0KTsKICAgICAgICB9CiAgICAgICAgQm9keS5jYWxsKFJlc3BvbnNlLnByb3RvdHlwZSk7CiAgICAgICAgUmVzcG9uc2UucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKHRoaXMuX2JvZHlJbml0LCB7CiAgICAgICAgICAgIHN0YXR1czogdGhpcy5zdGF0dXMsCiAgICAgICAgICAgIHN0YXR1c1RleHQ6IHRoaXMuc3RhdHVzVGV4dCwKICAgICAgICAgICAgaGVhZGVyczogbmV3IEhlYWRlcnModGhpcy5oZWFkZXJzKSwKICAgICAgICAgICAgdXJsOiB0aGlzLnVybAogICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBSZXNwb25zZS5lcnJvciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHJlc3BvbnNlID0gbmV3IFJlc3BvbnNlKG51bGwsIHsgc3RhdHVzOiAwLCBzdGF0dXNUZXh0OiAiIiB9KTsKICAgICAgICAgIHJlc3BvbnNlLnR5cGUgPSAiZXJyb3IiOwogICAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICAgIH07CiAgICAgICAgdmFyIHJlZGlyZWN0U3RhdHVzZXMgPSBbMzAxLCAzMDIsIDMwMywgMzA3LCAzMDhdOwogICAgICAgIFJlc3BvbnNlLnJlZGlyZWN0ID0gZnVuY3Rpb24odXJsLCBzdGF0dXMpIHsKICAgICAgICAgIGlmIChyZWRpcmVjdFN0YXR1c2VzLmluZGV4T2Yoc3RhdHVzKSA9PT0gLTEpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkludmFsaWQgc3RhdHVzIGNvZGUiKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UobnVsbCwgeyBzdGF0dXMsIGhlYWRlcnM6IHsgbG9jYXRpb246IHVybCB9IH0pOwogICAgICAgIH07CiAgICAgICAgZXhwb3J0cy5ET01FeGNlcHRpb24gPSBzZWxmMi5ET01FeGNlcHRpb247CiAgICAgICAgdHJ5IHsKICAgICAgICAgIG5ldyBleHBvcnRzLkRPTUV4Y2VwdGlvbigpOwogICAgICAgIH0gY2F0Y2ggKGVycjIpIHsKICAgICAgICAgIGV4cG9ydHMuRE9NRXhjZXB0aW9uID0gZnVuY3Rpb24obWVzc2FnZSwgbmFtZSkgewogICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOwogICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICAgICAgICB2YXIgZXJyb3IgPSBFcnJvcihtZXNzYWdlKTsKICAgICAgICAgICAgdGhpcy5zdGFjayA9IGVycm9yLnN0YWNrOwogICAgICAgICAgfTsKICAgICAgICAgIGV4cG9ydHMuRE9NRXhjZXB0aW9uLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoRXJyb3IucHJvdG90eXBlKTsKICAgICAgICAgIGV4cG9ydHMuRE9NRXhjZXB0aW9uLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGV4cG9ydHMuRE9NRXhjZXB0aW9uOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBmZXRjaDIoaW5wdXQsIGluaXQyKSB7CiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IFJlcXVlc3QoaW5wdXQsIGluaXQyKTsKICAgICAgICAgICAgaWYgKHJlcXVlc3Quc2lnbmFsICYmIHJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHsKICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KG5ldyBleHBvcnRzLkRPTUV4Y2VwdGlvbigiQWJvcnRlZCIsICJBYm9ydEVycm9yIikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgICAgZnVuY3Rpb24gYWJvcnRYaHIoKSB7CiAgICAgICAgICAgICAgeGhyLmFib3J0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHZhciBvcHRpb25zID0gewogICAgICAgICAgICAgICAgc3RhdHVzOiB4aHIuc3RhdHVzLAogICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogeGhyLnN0YXR1c1RleHQsCiAgICAgICAgICAgICAgICBoZWFkZXJzOiBwYXJzZUhlYWRlcnMoeGhyLmdldEFsbFJlc3BvbnNlSGVhZGVycygpIHx8ICIiKQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgb3B0aW9ucy51cmwgPSAicmVzcG9uc2VVUkwiIGluIHhociA/IHhoci5yZXNwb25zZVVSTCA6IG9wdGlvbnMuaGVhZGVycy5nZXQoIlgtUmVxdWVzdC1VUkwiKTsKICAgICAgICAgICAgICB2YXIgYm9keSA9ICJyZXNwb25zZSIgaW4geGhyID8geGhyLnJlc3BvbnNlIDogeGhyLnJlc3BvbnNlVGV4dDsKICAgICAgICAgICAgICByZXNvbHZlKG5ldyBSZXNwb25zZShib2R5LCBvcHRpb25zKSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHhoci5vbmVycm9yID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmVqZWN0KG5ldyBUeXBlRXJyb3IoIk5ldHdvcmsgcmVxdWVzdCBmYWlsZWQiKSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHhoci5vbnRpbWVvdXQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZWplY3QobmV3IFR5cGVFcnJvcigiTmV0d29yayByZXF1ZXN0IGZhaWxlZCIpKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgeGhyLm9uYWJvcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZWplY3QobmV3IGV4cG9ydHMuRE9NRXhjZXB0aW9uKCJBYm9ydGVkIiwgIkFib3J0RXJyb3IiKSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHhoci5vcGVuKHJlcXVlc3QubWV0aG9kLCByZXF1ZXN0LnVybCwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChyZXF1ZXN0LmNyZWRlbnRpYWxzID09PSAiaW5jbHVkZSIpIHsKICAgICAgICAgICAgICB4aHIud2l0aENyZWRlbnRpYWxzID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXF1ZXN0LmNyZWRlbnRpYWxzID09PSAib21pdCIpIHsKICAgICAgICAgICAgICB4aHIud2l0aENyZWRlbnRpYWxzID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCJyZXNwb25zZVR5cGUiIGluIHhociAmJiBzdXBwb3J0LmJsb2IpIHsKICAgICAgICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gImJsb2IiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlcXVlc3QuaGVhZGVycy5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7CiAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIobmFtZSwgdmFsdWUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKHJlcXVlc3Quc2lnbmFsKSB7CiAgICAgICAgICAgICAgcmVxdWVzdC5zaWduYWwuYWRkRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBhYm9ydFhocik7CiAgICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0KSB7CiAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2lnbmFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoImFib3J0IiwgYWJvcnRYaHIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgeGhyLnNlbmQodHlwZW9mIHJlcXVlc3QuX2JvZHlJbml0ID09PSAidW5kZWZpbmVkIiA/IG51bGwgOiByZXF1ZXN0Ll9ib2R5SW5pdCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZmV0Y2gyLnBvbHlmaWxsID0gdHJ1ZTsKICAgICAgICBpZiAoIXNlbGYyLmZldGNoKSB7CiAgICAgICAgICBzZWxmMi5mZXRjaCA9IGZldGNoMjsKICAgICAgICAgIHNlbGYyLkhlYWRlcnMgPSBIZWFkZXJzOwogICAgICAgICAgc2VsZjIuUmVxdWVzdCA9IFJlcXVlc3Q7CiAgICAgICAgICBzZWxmMi5SZXNwb25zZSA9IFJlc3BvbnNlOwogICAgICAgIH0KICAgICAgICBleHBvcnRzLkhlYWRlcnMgPSBIZWFkZXJzOwogICAgICAgIGV4cG9ydHMuUmVxdWVzdCA9IFJlcXVlc3Q7CiAgICAgICAgZXhwb3J0cy5SZXNwb25zZSA9IFJlc3BvbnNlOwogICAgICAgIGV4cG9ydHMuZmV0Y2ggPSBmZXRjaDI7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgICByZXR1cm4gZXhwb3J0czsKICAgICAgfSkoe30pOwogICAgfSkodHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IGNvbW1vbmpzR2xvYmFsKTsKICB9KSgpOwogIChmdW5jdGlvbihleHBvcnRzKSB7CiAgICB2YXIgX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQgPSBpbnRlcm9wUmVxdWlyZVdpbGRjYXJkLmV4cG9ydHM7CiAgICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIgPSBpbnRlcm9wUmVxdWlyZURlZmF1bHQkMS5leHBvcnRzOwogICAgdmFyIF9PYmplY3QkZGVmaW5lUHJvcGVydHkyID0gZGVmaW5lUHJvcGVydHkkOTsKICAgIF9PYmplY3QkZGVmaW5lUHJvcGVydHkyKGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICBleHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7CiAgICB2YXIgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKG9iamVjdFdpdGhvdXRQcm9wZXJ0aWVzLmV4cG9ydHMpOwogICAgdmFyIF9zdGFydHNXaXRoID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoc3RhcnRzV2l0aCk7CiAgICB2YXIgX21hcCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKG1hcCk7CiAgICB2YXIgX3Byb21pc2UgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihwcm9taXNlKTsKICAgIHZhciBfZGVmaW5lUHJvcGVydHkyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGRlZmluZVByb3BlcnR5JDkpOwogICAgdmFyIF9kZWZpbmVQcm9wZXJ0aWVzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGRlZmluZVByb3BlcnRpZXMpOwogICAgdmFyIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyk7CiAgICB2YXIgX2dldE93blByb3BlcnR5RGVzY3JpcHRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGdldE93blByb3BlcnR5RGVzY3JpcHRvciQzKTsKICAgIHZhciBfZ2V0T3duUHJvcGVydHlTeW1ib2xzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoZ2V0T3duUHJvcGVydHlTeW1ib2xzJDIpOwogICAgdmFyIF9rZXlzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoa2V5cyQyKTsKICAgIHZhciBfY29uc3RydWN0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoY29uc3RydWN0KTsKICAgIHZhciBfZm9yRWFjaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGZvckVhY2gkMSk7CiAgICB2YXIgX2ZpbHRlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGZpbHRlcik7CiAgICB2YXIgX3JlZ2VuZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHJlZ2VuZXJhdG9yJDEpOwogICAgdmFyIF9zbGljZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHNsaWNlJDEpOwogICAgdmFyIF9jb25jYXQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoY29uY2F0KTsKICAgIHZhciBfY2xhc3NDYWxsQ2hlY2syMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGNsYXNzQ2FsbENoZWNrJDEuZXhwb3J0cyk7CiAgICB2YXIgX2NyZWF0ZUNsYXNzMjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihjcmVhdGVDbGFzcyQxLmV4cG9ydHMpOwogICAgdmFyIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoYXNzZXJ0VGhpc0luaXRpYWxpemVkLmV4cG9ydHMpOwogICAgdmFyIF9pbmhlcml0czIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihpbmhlcml0cy5leHBvcnRzKTsKICAgIHZhciBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihwb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuLmV4cG9ydHMpOwogICAgdmFyIF9nZXRQcm90b3R5cGVPZjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihnZXRQcm90b3R5cGVPZiQ0LmV4cG9ydHMpOwogICAgdmFyIF9kZWZpbmVQcm9wZXJ0eTMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihkZWZpbmVQcm9wZXJ0eSQ2LmV4cG9ydHMpOwogICAgdmFyIF9hc3luY1RvR2VuZXJhdG9yMjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihhc3luY1RvR2VuZXJhdG9yJDEuZXhwb3J0cyk7CiAgICB2YXIgX3dyYXBBc3luY0dlbmVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mih3cmFwQXN5bmNHZW5lcmF0b3IuZXhwb3J0cyk7CiAgICB2YXIgX2F3YWl0QXN5bmNHZW5lcmF0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoYXdhaXRBc3luY0dlbmVyYXRvci5leHBvcnRzKTsKICAgIHZhciBfYXN5bmNJdGVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Mihhc3luY0l0ZXJhdG9yLmV4cG9ydHMpOwogICAgdmFyIF9hc3luY0dlbmVyYXRvckRlbGVnYXRlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGFzeW5jR2VuZXJhdG9yRGVsZWdhdGUuZXhwb3J0cyk7CiAgICB2YXIgX2JhbUZpbGUgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChiYW1GaWxlKTsKICAgIHZhciBfYmd6ZkZpbGVoYW5kbGUgPSBkaXN0JDE7CiAgICB2YXIgX3NhbSA9IHNhbTsKICAgIGZ1bmN0aW9uIG93bktleXMyKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICAgICAgdmFyIGtleXMyID0gKDAsIF9rZXlzLmRlZmF1bHQpKG9iamVjdCk7CiAgICAgIGlmIChfZ2V0T3duUHJvcGVydHlTeW1ib2xzLmRlZmF1bHQpIHsKICAgICAgICB2YXIgc3ltYm9sczIgPSAoMCwgX2dldE93blByb3BlcnR5U3ltYm9scy5kZWZhdWx0KShvYmplY3QpOwogICAgICAgIGlmIChlbnVtZXJhYmxlT25seSkKICAgICAgICAgIHN5bWJvbHMyID0gKDAsIF9maWx0ZXIuZGVmYXVsdCkoc3ltYm9sczIpLmNhbGwoc3ltYm9sczIsIGZ1bmN0aW9uKHN5bSkgewogICAgICAgICAgICByZXR1cm4gKDAsIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IuZGVmYXVsdCkob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICAgICAgICB9KTsKICAgICAgICBrZXlzMi5wdXNoLmFwcGx5KGtleXMyLCBzeW1ib2xzMik7CiAgICAgIH0KICAgICAgcmV0dXJuIGtleXMyOwogICAgfQogICAgZnVuY3Rpb24gX29iamVjdFNwcmVhZDIodGFyZ2V0KSB7CiAgICAgIGZvciAodmFyIGkyID0gMTsgaTIgPCBhcmd1bWVudHMubGVuZ3RoOyBpMisrKSB7CiAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpMl0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpMl0gOiB7fTsKICAgICAgICBpZiAoaTIgJSAyKSB7CiAgICAgICAgICB2YXIgX2NvbnRleHQxMzsKICAgICAgICAgICgwLCBfZm9yRWFjaC5kZWZhdWx0KShfY29udGV4dDEzID0gb3duS2V5czIoT2JqZWN0KHNvdXJjZSksIHRydWUpKS5jYWxsKF9jb250ZXh0MTMsIGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5My5kZWZhdWx0KSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycy5kZWZhdWx0KSB7CiAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnRpZXMyLmRlZmF1bHQpKHRhcmdldCwgKDAsIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzLmRlZmF1bHQpKHNvdXJjZSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgX2NvbnRleHQxNDsKICAgICAgICAgICgwLCBfZm9yRWFjaC5kZWZhdWx0KShfY29udGV4dDE0ID0gb3duS2V5czIoT2JqZWN0KHNvdXJjZSkpKS5jYWxsKF9jb250ZXh0MTQsIGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5MjIuZGVmYXVsdCkodGFyZ2V0LCBrZXksICgwLCBfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLmRlZmF1bHQpKHNvdXJjZSwga2V5KSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGZ1bmN0aW9uIF9jcmVhdGVTdXBlcjIoRGVyaXZlZCkgewogICAgICB2YXIgaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCA9IF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QyKCk7CiAgICAgIHJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsKICAgICAgICB2YXIgU3VwZXIgPSAoMCwgX2dldFByb3RvdHlwZU9mMi5kZWZhdWx0KShEZXJpdmVkKSwgcmVzdWx0OwogICAgICAgIGlmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7CiAgICAgICAgICB2YXIgTmV3VGFyZ2V0ID0gKDAsIF9nZXRQcm90b3R5cGVPZjIuZGVmYXVsdCkodGhpcykuY29uc3RydWN0b3I7CiAgICAgICAgICByZXN1bHQgPSAoMCwgX2NvbnN0cnVjdC5kZWZhdWx0KShTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKDAsIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuMi5kZWZhdWx0KSh0aGlzLCByZXN1bHQpOwogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdDIoKSB7CiAgICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIV9jb25zdHJ1Y3QuZGVmYXVsdCkKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIGlmIChfY29uc3RydWN0LmRlZmF1bHQuc2hhbSkKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIHRyeSB7CiAgICAgICAgRGF0ZS5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCgoMCwgX2NvbnN0cnVjdC5kZWZhdWx0KShEYXRlLCBbXSwgZnVuY3Rpb24oKSB7CiAgICAgICAgfSkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBjb25jYXQkMTIoX3gsIF94MikgewogICAgICByZXR1cm4gX2NvbmNhdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQogICAgZnVuY3Rpb24gX2NvbmNhdCgpIHsKICAgICAgX2NvbmNhdCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlNShhcnIsIG9wdHMpIHsKICAgICAgICB2YXIgcmVzOwogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IyLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQxNikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE2LnByZXYgPSBfY29udGV4dDE2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDE2Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIF9wcm9taXNlLmRlZmF1bHQuYWxsKCgwLCBfbWFwLmRlZmF1bHQpKGFycikuY2FsbChhcnIsIC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgdmFyIF9yZWYgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoY2h1bmsyKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHVybCwgaGVhZGVycywgcmVzdCwgX3JlczsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0MTUpIHsKICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNS5wcmV2ID0gX2NvbnRleHQxNS5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gY2h1bmsyLnVybCwgaGVhZGVycyA9IGNodW5rMi5oZWFkZXJzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoMCwgX3N0YXJ0c1dpdGguZGVmYXVsdCkodXJsKS5jYWxsKHVybCwgImRhdGE6IikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNS5uZXh0ID0gNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNS5hYnJ1cHQoInJldHVybiIsIEJ1ZmZlci5mcm9tKHVybC5zcGxpdCgiLCIpWzFdLCAiYmFzZTY0IikpOwogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3QgPSAoMCwgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzMi5kZWZhdWx0KShoZWFkZXJzLCBbInJlZmVyZXIiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE1Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoKHVybCwgX29iamVjdFNwcmVhZDIoX29iamVjdFNwcmVhZDIoe30sIG9wdHMpLCB7fSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiBfb2JqZWN0U3ByZWFkMihfb2JqZWN0U3ByZWFkMih7fSwgb3B0cy5oZWFkZXJzKSwgcmVzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcmVzID0gX2NvbnRleHQxNS5zZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9yZXMub2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNS5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJGYWlsZWQgdG8gZmV0Y2ggIi5jb25jYXQoX3Jlcy5zdGF0dXNUZXh0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTUudDAgPSBCdWZmZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE1Lm5leHQgPSAxNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVzLmFycmF5QnVmZmVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTUudDEgPSBfY29udGV4dDE1LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNS5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0MTUudDAuZnJvbS5jYWxsKF9jb250ZXh0MTUudDAsIF9jb250ZXh0MTUudDEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlNCk7CiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKF94NCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9KCkpKTsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICByZXMgPSBfY29udGV4dDE2LnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDE2LnQwID0gKDAsIF9jb25jYXQyLmRlZmF1bHQpKEJ1ZmZlcik7CiAgICAgICAgICAgICAgICBfY29udGV4dDE2LnQxID0gQnVmZmVyOwogICAgICAgICAgICAgICAgX2NvbnRleHQxNi5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiBfcHJvbWlzZS5kZWZhdWx0LmFsbCgoMCwgX21hcC5kZWZhdWx0KShyZXMpLmNhbGwocmVzLCBmdW5jdGlvbihlbHQpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYmd6ZkZpbGVoYW5kbGUudW56aXApKGVsdCk7CiAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgX2NvbnRleHQxNi50MiA9IF9jb250ZXh0MTYuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDE2LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQxNi50MC5jYWxsLmNhbGwoX2NvbnRleHQxNi50MCwgX2NvbnRleHQxNi50MSwgX2NvbnRleHQxNi50MikpOwogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUpOwogICAgICB9KSk7CiAgICAgIHJldHVybiBfY29uY2F0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CiAgICB2YXIgSHRzZ2V0RmlsZSA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbihfQmFtRmlsZSkgewogICAgICAoMCwgX2luaGVyaXRzMi5kZWZhdWx0KShIdHNnZXRGaWxlMiwgX0JhbUZpbGUpOwogICAgICB2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyMihIdHNnZXRGaWxlMik7CiAgICAgIGZ1bmN0aW9uIEh0c2dldEZpbGUyKGFyZ3MpIHsKICAgICAgICB2YXIgX3RoaXMyOwogICAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syMi5kZWZhdWx0KSh0aGlzLCBIdHNnZXRGaWxlMik7CiAgICAgICAgX3RoaXMyID0gX3N1cGVyLmNhbGwodGhpcywgewogICAgICAgICAgYmFtRmlsZWhhbmRsZTogIj8iLAogICAgICAgICAgYmFpRmlsZWhhbmRsZTogIj8iCiAgICAgICAgfSk7CiAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTMuZGVmYXVsdCkoKDAsIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQyLmRlZmF1bHQpKF90aGlzMiksICJiYXNlVXJsIiwgdm9pZCAwKTsKICAgICAgICAoMCwgX2RlZmluZVByb3BlcnR5My5kZWZhdWx0KSgoMCwgX2Fzc2VydFRoaXNJbml0aWFsaXplZDIuZGVmYXVsdCkoX3RoaXMyKSwgInRyYWNrSWQiLCB2b2lkIDApOwogICAgICAgIF90aGlzMi5iYXNlVXJsID0gYXJncy5iYXNlVXJsOwogICAgICAgIF90aGlzMi50cmFja0lkID0gYXJncy50cmFja0lkOwogICAgICAgIHJldHVybiBfdGhpczI7CiAgICAgIH0KICAgICAgKDAsIF9jcmVhdGVDbGFzczIyLmRlZmF1bHQpKEh0c2dldEZpbGUyLCBbewogICAgICAgIGtleTogInN0cmVhbVJlY29yZHNGb3JSYW5nZSIsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHN0cmVhbVJlY29yZHNGb3JSYW5nZShjaHIsIG1pbjIsIG1heDIpIHsKICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICB2YXIgb3B0cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzNdIDogewogICAgICAgICAgICB2aWV3QXNQYWlyczogZmFsc2UsCiAgICAgICAgICAgIHBhaXJBY3Jvc3NDaHI6IGZhbHNlLAogICAgICAgICAgICBtYXhJbnNlcnRTaXplOiAyZTUKICAgICAgICAgIH07CiAgICAgICAgICByZXR1cm4gKDAsIF93cmFwQXN5bmNHZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgICAgICB2YXIgX2NvbnRleHQsIF9jb250ZXh0MiwgX2NvbnRleHQzLCBfY29udGV4dDQsIF9jb250ZXh0NTsKICAgICAgICAgICAgdmFyIGJhc2UsIHVybCwgY2hySWQsIHJlc3VsdCwgZGF0YTIsIHVuY2JhLCBjaHVuazI7CiAgICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IyLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dDgpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBiYXNlID0gKDAsIF9jb25jYXQyLmRlZmF1bHQpKF9jb250ZXh0ID0gIiIuY29uY2F0KF90aGlzLmJhc2VVcmwsICIvIikpLmNhbGwoX2NvbnRleHQsIF90aGlzLnRyYWNrSWQpOwogICAgICAgICAgICAgICAgICAgIHVybCA9ICgwLCBfY29uY2F0Mi5kZWZhdWx0KShfY29udGV4dDIgPSAoMCwgX2NvbmNhdDIuZGVmYXVsdCkoX2NvbnRleHQzID0gKDAsIF9jb25jYXQyLmRlZmF1bHQpKF9jb250ZXh0NCA9ICIiLmNvbmNhdChiYXNlLCAiP3JlZmVyZW5jZU5hbWU9IikpLmNhbGwoX2NvbnRleHQ0LCBjaHIsICImc3RhcnQ9IikpLmNhbGwoX2NvbnRleHQzLCBtaW4yLCAiJmVuZD0iKSkuY2FsbChfY29udGV4dDIsIG1heDIsICImZm9ybWF0PUJBTSIpOwogICAgICAgICAgICAgICAgICAgIGNocklkID0gX3RoaXMuY2hyVG9JbmRleCAmJiBfdGhpcy5jaHJUb0luZGV4W2Nocl07CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgICAgIHJldHVybiAoMCwgX2F3YWl0QXN5bmNHZW5lcmF0b3IyLmRlZmF1bHQpKGZldGNoKHVybCwgX29iamVjdFNwcmVhZDIoe30sIG9wdHMpKSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBfY29udGV4dDguc2VudDsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lm9rKSB7CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3VsdC5zdGF0dXNUZXh0KTsKICAgICAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYXdhaXRBc3luY0dlbmVyYXRvcjIuZGVmYXVsdCkocmVzdWx0Lmpzb24oKSk7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgZGF0YTIgPSBfY29udGV4dDguc2VudDsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAoMCwgX2F3YWl0QXN5bmNHZW5lcmF0b3IyLmRlZmF1bHQpKGNvbmNhdCQxMigoMCwgX3NsaWNlLmRlZmF1bHQpKF9jb250ZXh0NSA9IGRhdGEyLmh0c2dldC51cmxzKS5jYWxsKF9jb250ZXh0NSwgMSksIG9wdHMpKTsKICAgICAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgICAgICB1bmNiYSA9IF9jb250ZXh0OC5zZW50OwogICAgICAgICAgICAgICAgICAgIGNodW5rMiA9IHsKICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlcjogdW5jYmEsCiAgICAgICAgICAgICAgICAgICAgICBjaHVuazogewogICAgICAgICAgICAgICAgICAgICAgICBtaW52OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVBvc2l0aW9uOiAwCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gdG9TdHJpbmcyKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2NvbnRleHQ2LCBfY29udGV4dDc7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoMCwgX2NvbmNhdDIuZGVmYXVsdCkoX2NvbnRleHQ2ID0gKDAsIF9jb25jYXQyLmRlZmF1bHQpKF9jb250ZXh0NyA9ICIiLmNvbmNhdChjaHIsICJfIikpLmNhbGwoX2NvbnRleHQ3LCBtaW4yLCAiXyIpKS5jYWxsKF9jb250ZXh0NiwgbWF4Mik7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LmRlbGVnYXRlWWllbGQoKDAsIF9hc3luY0dlbmVyYXRvckRlbGVnYXRlMi5kZWZhdWx0KSgoMCwgX2FzeW5jSXRlcmF0b3IyLmRlZmF1bHQpKF90aGlzLl9mZXRjaENodW5rRmVhdHVyZXMoW2NodW5rMl0sIGNocklkLCBtaW4yLCBtYXgyLCBvcHRzKSksIF9hd2FpdEFzeW5jR2VuZXJhdG9yMi5kZWZhdWx0KSwgInQwIiwgMTYpOwogICAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgICAgICB9KSkoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICJfcmVhZENodW5rIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX3JlYWRDaHVuazIgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIocGFyYW1zKSB7CiAgICAgICAgICAgIHZhciBjaHVuazIsIGJ1ZmZlcjIsIGMyOwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0OSkgewogICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIGNodW5rMiA9IHBhcmFtcy5jaHVuazsKICAgICAgICAgICAgICAgICAgICBidWZmZXIyID0gY2h1bmsyLmJ1ZmZlciwgYzIgPSBjaHVuazIuY2h1bms7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGJ1ZmZlcjIsCiAgICAgICAgICAgICAgICAgICAgICBjcG9zaXRpb25zOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgZHBvc2l0aW9uczogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGNodW5rOiBjMgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgICAgICB9KSk7CiAgICAgICAgICBmdW5jdGlvbiBfcmVhZENodW5rKF94MykgewogICAgICAgICAgICByZXR1cm4gX3JlYWRDaHVuazIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBfcmVhZENodW5rOwogICAgICAgIH0oKQogICAgICB9LCB7CiAgICAgICAga2V5OiAiZ2V0SGVhZGVyIiwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgX2dldEhlYWRlciA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgICAgICAgdmFyIF9jb250ZXh0MTA7CiAgICAgICAgICAgIHZhciBvcHRzLCB1cmwsIHJlc3VsdCwgZGF0YTIsIHVuY2JhLCBoZWFkTGVuLCBoZWFkZXJUZXh0LCBzYW1IZWFkZXIsIGlkVG9OYW1lLCBuYW1lVG9JZCwgc3FMaW5lcywgX2FyZ3MzID0gYXJndW1lbnRzOwogICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yMi5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MTIpIHsKICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEyLnByZXYgPSBfY29udGV4dDEyLm5leHQpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIG9wdHMgPSBfYXJnczMubGVuZ3RoID4gMCAmJiBfYXJnczNbMF0gIT09IHZvaWQgMCA/IF9hcmdzM1swXSA6IHt9OwogICAgICAgICAgICAgICAgICAgIHVybCA9ICgwLCBfY29uY2F0Mi5kZWZhdWx0KShfY29udGV4dDEwID0gIiIuY29uY2F0KHRoaXMuYmFzZVVybCwgIi8iKSkuY2FsbChfY29udGV4dDEwLCB0aGlzLnRyYWNrSWQsICI/cmVmZXJlbmNlTmFtZT1uYSZjbGFzcz1oZWFkZXIiKTsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEyLm5leHQgPSA0OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaCh1cmwsIG9wdHMpOwogICAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gX2NvbnRleHQxMi5zZW50OwogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQub2spIHsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJGYWlsZWQgdG8gZmV0Y2ggIi5jb25jYXQocmVzdWx0LnN0YXR1c1RleHQpKTsKICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5qc29uKCk7CiAgICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgICBkYXRhMiA9IF9jb250ZXh0MTIuc2VudDsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEyLm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uY2F0JDEyKGRhdGEyLmh0c2dldC51cmxzLCBvcHRzKTsKICAgICAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgICAgICB1bmNiYSA9IF9jb250ZXh0MTIuc2VudDsKICAgICAgICAgICAgICAgICAgICBpZiAoISh1bmNiYS5yZWFkSW50MzJMRSgwKSAhPT0gX2JhbUZpbGUuQkFNX01BR0lDKSkgewogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMi5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgYSBCQU0gZmlsZSIpOwogICAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICAgIGhlYWRMZW4gPSB1bmNiYS5yZWFkSW50MzJMRSg0KTsKICAgICAgICAgICAgICAgICAgICBoZWFkZXJUZXh0ID0gdW5jYmEudG9TdHJpbmcoInV0ZjgiLCA4LCA4ICsgaGVhZExlbik7CiAgICAgICAgICAgICAgICAgICAgc2FtSGVhZGVyID0gKDAsIF9zYW0ucGFyc2VIZWFkZXJUZXh0KShoZWFkZXJUZXh0KTsKICAgICAgICAgICAgICAgICAgICBpZFRvTmFtZSA9IFtdOwogICAgICAgICAgICAgICAgICAgIG5hbWVUb0lkID0ge307CiAgICAgICAgICAgICAgICAgICAgc3FMaW5lcyA9ICgwLCBfZmlsdGVyLmRlZmF1bHQpKHNhbUhlYWRlcikuY2FsbChzYW1IZWFkZXIsIGZ1bmN0aW9uKGwpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsLnRhZyA9PT0gIlNRIjsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAoMCwgX2ZvckVhY2guZGVmYXVsdCkoc3FMaW5lcykuY2FsbChzcUxpbmVzLCBmdW5jdGlvbihzcUxpbmUsIHJlZklkKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgX2NvbnRleHQxMTsKICAgICAgICAgICAgICAgICAgICAgICgwLCBfZm9yRWFjaC5kZWZhdWx0KShfY29udGV4dDExID0gc3FMaW5lLmRhdGEpLmNhbGwoX2NvbnRleHQxMSwgZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS50YWcgPT09ICJTTiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVmTmFtZSA9IGl0ZW0udmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZVRvSWRbcmVmTmFtZV0gPSByZWZJZDsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZFRvTmFtZVtyZWZJZF0gPSByZWZOYW1lOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNoclRvSW5kZXggPSBuYW1lVG9JZDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmluZGV4VG9DaHIgPSBpZFRvTmFtZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5hYnJ1cHQoInJldHVybiIsIHNhbUhlYWRlcik7CiAgICAgICAgICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuc3RvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICAgICAgfSkpOwogICAgICAgICAgZnVuY3Rpb24gZ2V0SGVhZGVyKCkgewogICAgICAgICAgICByZXR1cm4gX2dldEhlYWRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGdldEhlYWRlcjsKICAgICAgICB9KCkKICAgICAgfV0pOwogICAgICByZXR1cm4gSHRzZ2V0RmlsZTI7CiAgICB9KF9iYW1GaWxlLmRlZmF1bHQpOwogICAgZXhwb3J0cy5kZWZhdWx0ID0gSHRzZ2V0RmlsZTsKICB9KShodHNnZXQpOwogIChmdW5jdGlvbihleHBvcnRzKSB7CiAgICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIgPSBpbnRlcm9wUmVxdWlyZURlZmF1bHQkMS5leHBvcnRzOwogICAgdmFyIF9PYmplY3QkZGVmaW5lUHJvcGVydHkgPSBkZWZpbmVQcm9wZXJ0eSQ5OwogICAgX09iamVjdCRkZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgX09iamVjdCRkZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiQkFJIiwgewogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldDIoKSB7CiAgICAgICAgcmV0dXJuIF9iYWkuZGVmYXVsdDsKICAgICAgfQogICAgfSk7CiAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJDU0kiLCB7CiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0MigpIHsKICAgICAgICByZXR1cm4gX2NzaS5kZWZhdWx0OwogICAgICB9CiAgICB9KTsKICAgIF9PYmplY3QkZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIkJhbUZpbGUiLCB7CiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0MigpIHsKICAgICAgICByZXR1cm4gX2JhbUZpbGUuZGVmYXVsdDsKICAgICAgfQogICAgfSk7CiAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJIdHNnZXRGaWxlIiwgewogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldDIoKSB7CiAgICAgICAgcmV0dXJuIF9odHNnZXQuZGVmYXVsdDsKICAgICAgfQogICAgfSk7CiAgICBfT2JqZWN0JGRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJCYW1SZWNvcmQiLCB7CiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0MigpIHsKICAgICAgICByZXR1cm4gX3JlY29yZC5kZWZhdWx0OwogICAgICB9CiAgICB9KTsKICAgIHZhciBfYmFpID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoYmFpKTsKICAgIHZhciBfY3NpID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIoY3NpKTsKICAgIHZhciBfYmFtRmlsZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGJhbUZpbGUpOwogICAgdmFyIF9odHNnZXQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihodHNnZXQpOwogICAgdmFyIF9yZWNvcmQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihyZWNvcmQpOwogIH0pKGRpc3QkMyk7CiAgY2xhc3MgUXVpY2tMUlUgZXh0ZW5kcyBNYXAgewogICAgY29uc3RydWN0b3Iob3B0aW9ucyA9IHt9KSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIGlmICghKG9wdGlvbnMubWF4U2l6ZSAmJiBvcHRpb25zLm1heFNpemUgPiAwKSkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImBtYXhTaXplYCBtdXN0IGJlIGEgbnVtYmVyIGdyZWF0ZXIgdGhhbiAwIik7CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLm1heEFnZSA9PT0gIm51bWJlciIgJiYgb3B0aW9ucy5tYXhBZ2UgPT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJgbWF4QWdlYCBtdXN0IGJlIGEgbnVtYmVyIGdyZWF0ZXIgdGhhbiAwIik7CiAgICAgIH0KICAgICAgdGhpcy5tYXhTaXplID0gb3B0aW9ucy5tYXhTaXplOwogICAgICB0aGlzLm1heEFnZSA9IG9wdGlvbnMubWF4QWdlIHx8IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTsKICAgICAgdGhpcy5vbkV2aWN0aW9uID0gb3B0aW9ucy5vbkV2aWN0aW9uOwogICAgICB0aGlzLmNhY2hlID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICAgICAgdGhpcy5vbGRDYWNoZSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgICAgIHRoaXMuX3NpemUgPSAwOwogICAgfQogICAgX2VtaXRFdmljdGlvbnMoY2FjaGUpIHsKICAgICAgaWYgKHR5cGVvZiB0aGlzLm9uRXZpY3Rpb24gIT09ICJmdW5jdGlvbiIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBba2V5LCBpdGVtXSBvZiBjYWNoZSkgewogICAgICAgIHRoaXMub25FdmljdGlvbihrZXksIGl0ZW0udmFsdWUpOwogICAgICB9CiAgICB9CiAgICBfZGVsZXRlSWZFeHBpcmVkKGtleSwgaXRlbSkgewogICAgICBpZiAodHlwZW9mIGl0ZW0uZXhwaXJ5ID09PSAibnVtYmVyIiAmJiBpdGVtLmV4cGlyeSA8PSBEYXRlLm5vdygpKSB7CiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9uRXZpY3Rpb24gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgIHRoaXMub25FdmljdGlvbihrZXksIGl0ZW0udmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5kZWxldGUoa2V5KTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBfZ2V0T3JEZWxldGVJZkV4cGlyZWQoa2V5LCBpdGVtKSB7CiAgICAgIGNvbnN0IGRlbGV0ZWQgPSB0aGlzLl9kZWxldGVJZkV4cGlyZWQoa2V5LCBpdGVtKTsKICAgICAgaWYgKGRlbGV0ZWQgPT09IGZhbHNlKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0udmFsdWU7CiAgICAgIH0KICAgIH0KICAgIF9nZXRJdGVtVmFsdWUoa2V5LCBpdGVtKSB7CiAgICAgIHJldHVybiBpdGVtLmV4cGlyeSA/IHRoaXMuX2dldE9yRGVsZXRlSWZFeHBpcmVkKGtleSwgaXRlbSkgOiBpdGVtLnZhbHVlOwogICAgfQogICAgX3BlZWsoa2V5LCBjYWNoZSkgewogICAgICBjb25zdCBpdGVtID0gY2FjaGUuZ2V0KGtleSk7CiAgICAgIHJldHVybiB0aGlzLl9nZXRJdGVtVmFsdWUoa2V5LCBpdGVtKTsKICAgIH0KICAgIF9zZXQoa2V5LCB2YWx1ZSkgewogICAgICB0aGlzLmNhY2hlLnNldChrZXksIHZhbHVlKTsKICAgICAgdGhpcy5fc2l6ZSsrOwogICAgICBpZiAodGhpcy5fc2l6ZSA+PSB0aGlzLm1heFNpemUpIHsKICAgICAgICB0aGlzLl9zaXplID0gMDsKICAgICAgICB0aGlzLl9lbWl0RXZpY3Rpb25zKHRoaXMub2xkQ2FjaGUpOwogICAgICAgIHRoaXMub2xkQ2FjaGUgPSB0aGlzLmNhY2hlOwogICAgICAgIHRoaXMuY2FjaGUgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpOwogICAgICB9CiAgICB9CiAgICBfbW92ZVRvUmVjZW50KGtleSwgaXRlbSkgewogICAgICB0aGlzLm9sZENhY2hlLmRlbGV0ZShrZXkpOwogICAgICB0aGlzLl9zZXQoa2V5LCBpdGVtKTsKICAgIH0KICAgICpfZW50cmllc0FzY2VuZGluZygpIHsKICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMub2xkQ2FjaGUpIHsKICAgICAgICBjb25zdCBba2V5LCB2YWx1ZV0gPSBpdGVtOwogICAgICAgIGlmICghdGhpcy5jYWNoZS5oYXMoa2V5KSkgewogICAgICAgICAgY29uc3QgZGVsZXRlZCA9IHRoaXMuX2RlbGV0ZUlmRXhwaXJlZChrZXksIHZhbHVlKTsKICAgICAgICAgIGlmIChkZWxldGVkID09PSBmYWxzZSkgewogICAgICAgICAgICB5aWVsZCBpdGVtOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5jYWNoZSkgewogICAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSA9IGl0ZW07CiAgICAgICAgY29uc3QgZGVsZXRlZCA9IHRoaXMuX2RlbGV0ZUlmRXhwaXJlZChrZXksIHZhbHVlKTsKICAgICAgICBpZiAoZGVsZXRlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgIHlpZWxkIGl0ZW07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBnZXQoa2V5KSB7CiAgICAgIGlmICh0aGlzLmNhY2hlLmhhcyhrZXkpKSB7CiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuY2FjaGUuZ2V0KGtleSk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dldEl0ZW1WYWx1ZShrZXksIGl0ZW0pOwogICAgICB9CiAgICAgIGlmICh0aGlzLm9sZENhY2hlLmhhcyhrZXkpKSB7CiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMub2xkQ2FjaGUuZ2V0KGtleSk7CiAgICAgICAgaWYgKHRoaXMuX2RlbGV0ZUlmRXhwaXJlZChrZXksIGl0ZW0pID09PSBmYWxzZSkgewogICAgICAgICAgdGhpcy5fbW92ZVRvUmVjZW50KGtleSwgaXRlbSk7CiAgICAgICAgICByZXR1cm4gaXRlbS52YWx1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHNldChrZXksIHZhbHVlLCB7IG1heEFnZSA9IHRoaXMubWF4QWdlIH0gPSB7fSkgewogICAgICBjb25zdCBleHBpcnkgPSB0eXBlb2YgbWF4QWdlID09PSAibnVtYmVyIiAmJiBtYXhBZ2UgIT09IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSA/IERhdGUubm93KCkgKyBtYXhBZ2UgOiB2b2lkIDA7CiAgICAgIGlmICh0aGlzLmNhY2hlLmhhcyhrZXkpKSB7CiAgICAgICAgdGhpcy5jYWNoZS5zZXQoa2V5LCB7CiAgICAgICAgICB2YWx1ZSwKICAgICAgICAgIGV4cGlyeQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuX3NldChrZXksIHsgdmFsdWUsIGV4cGlyeSB9KTsKICAgICAgfQogICAgfQogICAgaGFzKGtleSkgewogICAgICBpZiAodGhpcy5jYWNoZS5oYXMoa2V5KSkgewogICAgICAgIHJldHVybiAhdGhpcy5fZGVsZXRlSWZFeHBpcmVkKGtleSwgdGhpcy5jYWNoZS5nZXQoa2V5KSk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMub2xkQ2FjaGUuaGFzKGtleSkpIHsKICAgICAgICByZXR1cm4gIXRoaXMuX2RlbGV0ZUlmRXhwaXJlZChrZXksIHRoaXMub2xkQ2FjaGUuZ2V0KGtleSkpOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHBlZWsoa2V5KSB7CiAgICAgIGlmICh0aGlzLmNhY2hlLmhhcyhrZXkpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BlZWsoa2V5LCB0aGlzLmNhY2hlKTsKICAgICAgfQogICAgICBpZiAodGhpcy5vbGRDYWNoZS5oYXMoa2V5KSkgewogICAgICAgIHJldHVybiB0aGlzLl9wZWVrKGtleSwgdGhpcy5vbGRDYWNoZSk7CiAgICAgIH0KICAgIH0KICAgIGRlbGV0ZShrZXkpIHsKICAgICAgY29uc3QgZGVsZXRlZCA9IHRoaXMuY2FjaGUuZGVsZXRlKGtleSk7CiAgICAgIGlmIChkZWxldGVkKSB7CiAgICAgICAgdGhpcy5fc2l6ZS0tOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLm9sZENhY2hlLmRlbGV0ZShrZXkpIHx8IGRlbGV0ZWQ7CiAgICB9CiAgICBjbGVhcigpIHsKICAgICAgdGhpcy5jYWNoZS5jbGVhcigpOwogICAgICB0aGlzLm9sZENhY2hlLmNsZWFyKCk7CiAgICAgIHRoaXMuX3NpemUgPSAwOwogICAgfQogICAgcmVzaXplKG5ld1NpemUpIHsKICAgICAgaWYgKCEobmV3U2l6ZSAmJiBuZXdTaXplID4gMCkpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJgbWF4U2l6ZWAgbXVzdCBiZSBhIG51bWJlciBncmVhdGVyIHRoYW4gMCIpOwogICAgICB9CiAgICAgIGNvbnN0IGl0ZW1zID0gWy4uLnRoaXMuX2VudHJpZXNBc2NlbmRpbmcoKV07CiAgICAgIGNvbnN0IHJlbW92ZUNvdW50ID0gaXRlbXMubGVuZ3RoIC0gbmV3U2l6ZTsKICAgICAgaWYgKHJlbW92ZUNvdW50IDwgMCkgewogICAgICAgIHRoaXMuY2FjaGUgPSBuZXcgTWFwKGl0ZW1zKTsKICAgICAgICB0aGlzLm9sZENhY2hlID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICAgICAgICB0aGlzLl9zaXplID0gaXRlbXMubGVuZ3RoOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChyZW1vdmVDb3VudCA+IDApIHsKICAgICAgICAgIHRoaXMuX2VtaXRFdmljdGlvbnMoaXRlbXMuc2xpY2UoMCwgcmVtb3ZlQ291bnQpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5vbGRDYWNoZSA9IG5ldyBNYXAoaXRlbXMuc2xpY2UocmVtb3ZlQ291bnQpKTsKICAgICAgICB0aGlzLmNhY2hlID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICAgICAgICB0aGlzLl9zaXplID0gMDsKICAgICAgfQogICAgICB0aGlzLm1heFNpemUgPSBuZXdTaXplOwogICAgfQogICAgKmtleXMoKSB7CiAgICAgIGZvciAoY29uc3QgW2tleV0gb2YgdGhpcykgewogICAgICAgIHlpZWxkIGtleTsKICAgICAgfQogICAgfQogICAgKnZhbHVlcygpIHsKICAgICAgZm9yIChjb25zdCBbLCB2YWx1ZV0gb2YgdGhpcykgewogICAgICAgIHlpZWxkIHZhbHVlOwogICAgICB9CiAgICB9CiAgICAqW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLmNhY2hlKSB7CiAgICAgICAgY29uc3QgW2tleSwgdmFsdWVdID0gaXRlbTsKICAgICAgICBjb25zdCBkZWxldGVkID0gdGhpcy5fZGVsZXRlSWZFeHBpcmVkKGtleSwgdmFsdWUpOwogICAgICAgIGlmIChkZWxldGVkID09PSBmYWxzZSkgewogICAgICAgICAgeWllbGQgW2tleSwgdmFsdWUudmFsdWVdOwogICAgICAgIH0KICAgICAgfQogICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5vbGRDYWNoZSkgewogICAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSA9IGl0ZW07CiAgICAgICAgaWYgKCF0aGlzLmNhY2hlLmhhcyhrZXkpKSB7CiAgICAgICAgICBjb25zdCBkZWxldGVkID0gdGhpcy5fZGVsZXRlSWZFeHBpcmVkKGtleSwgdmFsdWUpOwogICAgICAgICAgaWYgKGRlbGV0ZWQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHlpZWxkIFtrZXksIHZhbHVlLnZhbHVlXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgICplbnRyaWVzRGVzY2VuZGluZygpIHsKICAgICAgbGV0IGl0ZW1zID0gWy4uLnRoaXMuY2FjaGVdOwogICAgICBmb3IgKGxldCBpMiA9IGl0ZW1zLmxlbmd0aCAtIDE7IGkyID49IDA7IC0taTIpIHsKICAgICAgICBjb25zdCBpdGVtID0gaXRlbXNbaTJdOwogICAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSA9IGl0ZW07CiAgICAgICAgY29uc3QgZGVsZXRlZCA9IHRoaXMuX2RlbGV0ZUlmRXhwaXJlZChrZXksIHZhbHVlKTsKICAgICAgICBpZiAoZGVsZXRlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgIHlpZWxkIFtrZXksIHZhbHVlLnZhbHVlXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaXRlbXMgPSBbLi4udGhpcy5vbGRDYWNoZV07CiAgICAgIGZvciAobGV0IGkyID0gaXRlbXMubGVuZ3RoIC0gMTsgaTIgPj0gMDsgLS1pMikgewogICAgICAgIGNvbnN0IGl0ZW0gPSBpdGVtc1tpMl07CiAgICAgICAgY29uc3QgW2tleSwgdmFsdWVdID0gaXRlbTsKICAgICAgICBpZiAoIXRoaXMuY2FjaGUuaGFzKGtleSkpIHsKICAgICAgICAgIGNvbnN0IGRlbGV0ZWQgPSB0aGlzLl9kZWxldGVJZkV4cGlyZWQoa2V5LCB2YWx1ZSk7CiAgICAgICAgICBpZiAoZGVsZXRlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgeWllbGQgW2tleSwgdmFsdWUudmFsdWVdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgKmVudHJpZXNBc2NlbmRpbmcoKSB7CiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHRoaXMuX2VudHJpZXNBc2NlbmRpbmcoKSkgewogICAgICAgIHlpZWxkIFtrZXksIHZhbHVlLnZhbHVlXTsKICAgICAgfQogICAgfQogICAgZ2V0IHNpemUoKSB7CiAgICAgIGlmICghdGhpcy5fc2l6ZSkgewogICAgICAgIHJldHVybiB0aGlzLm9sZENhY2hlLnNpemU7CiAgICAgIH0KICAgICAgbGV0IG9sZENhY2hlU2l6ZSA9IDA7CiAgICAgIGZvciAoY29uc3Qga2V5IG9mIHRoaXMub2xkQ2FjaGUua2V5cygpKSB7CiAgICAgICAgaWYgKCF0aGlzLmNhY2hlLmhhcyhrZXkpKSB7CiAgICAgICAgICBvbGRDYWNoZVNpemUrKzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIE1hdGgubWluKHRoaXMuX3NpemUgKyBvbGRDYWNoZVNpemUsIHRoaXMubWF4U2l6ZSk7CiAgICB9CiAgICBlbnRyaWVzKCkgewogICAgICByZXR1cm4gdGhpcy5lbnRyaWVzQXNjZW5kaW5nKCk7CiAgICB9CiAgICBmb3JFYWNoKGNhbGxiYWNrRnVuY3Rpb24sIHRoaXNBcmd1bWVudCA9IHRoaXMpIHsKICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5lbnRyaWVzQXNjZW5kaW5nKCkpIHsKICAgICAgICBjYWxsYmFja0Z1bmN0aW9uLmNhbGwodGhpc0FyZ3VtZW50LCB2YWx1ZSwga2V5LCB0aGlzKTsKICAgICAgfQogICAgfQogICAgZ2V0IFtTeW1ib2wudG9TdHJpbmdUYWddKCkgewogICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoWy4uLnRoaXMuZW50cmllc0FzY2VuZGluZygpXSk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGFzY2VuZGluZyhhLCBiKSB7CiAgICByZXR1cm4gYSA8IGIgPyAtMSA6IGEgPiBiID8gMSA6IGEgPj0gYiA/IDAgOiBOYU47CiAgfQogIGZ1bmN0aW9uIGJpc2VjdG9yKGYpIHsKICAgIGxldCBkZWx0YSA9IGY7CiAgICBsZXQgY29tcGFyZSA9IGY7CiAgICBpZiAoZi5sZW5ndGggPT09IDEpIHsKICAgICAgZGVsdGEgPSAoZCwgeCkgPT4gZihkKSAtIHg7CiAgICAgIGNvbXBhcmUgPSBhc2NlbmRpbmdDb21wYXJhdG9yKGYpOwogICAgfQogICAgZnVuY3Rpb24gbGVmdChhLCB4LCBsbywgaGkpIHsKICAgICAgaWYgKGxvID09IG51bGwpCiAgICAgICAgbG8gPSAwOwogICAgICBpZiAoaGkgPT0gbnVsbCkKICAgICAgICBoaSA9IGEubGVuZ3RoOwogICAgICB3aGlsZSAobG8gPCBoaSkgewogICAgICAgIGNvbnN0IG1pZCA9IGxvICsgaGkgPj4+IDE7CiAgICAgICAgaWYgKGNvbXBhcmUoYVttaWRdLCB4KSA8IDApCiAgICAgICAgICBsbyA9IG1pZCArIDE7CiAgICAgICAgZWxzZQogICAgICAgICAgaGkgPSBtaWQ7CiAgICAgIH0KICAgICAgcmV0dXJuIGxvOwogICAgfQogICAgZnVuY3Rpb24gcmlnaHQoYSwgeCwgbG8sIGhpKSB7CiAgICAgIGlmIChsbyA9PSBudWxsKQogICAgICAgIGxvID0gMDsKICAgICAgaWYgKGhpID09IG51bGwpCiAgICAgICAgaGkgPSBhLmxlbmd0aDsKICAgICAgd2hpbGUgKGxvIDwgaGkpIHsKICAgICAgICBjb25zdCBtaWQgPSBsbyArIGhpID4+PiAxOwogICAgICAgIGlmIChjb21wYXJlKGFbbWlkXSwgeCkgPiAwKQogICAgICAgICAgaGkgPSBtaWQ7CiAgICAgICAgZWxzZQogICAgICAgICAgbG8gPSBtaWQgKyAxOwogICAgICB9CiAgICAgIHJldHVybiBsbzsKICAgIH0KICAgIGZ1bmN0aW9uIGNlbnRlcihhLCB4LCBsbywgaGkpIHsKICAgICAgaWYgKGxvID09IG51bGwpCiAgICAgICAgbG8gPSAwOwogICAgICBpZiAoaGkgPT0gbnVsbCkKICAgICAgICBoaSA9IGEubGVuZ3RoOwogICAgICBjb25zdCBpMiA9IGxlZnQoYSwgeCwgbG8sIGhpIC0gMSk7CiAgICAgIHJldHVybiBpMiA+IGxvICYmIGRlbHRhKGFbaTIgLSAxXSwgeCkgPiAtZGVsdGEoYVtpMl0sIHgpID8gaTIgLSAxIDogaTI7CiAgICB9CiAgICByZXR1cm4geyBsZWZ0LCBjZW50ZXIsIHJpZ2h0IH07CiAgfQogIGZ1bmN0aW9uIGFzY2VuZGluZ0NvbXBhcmF0b3IoZikgewogICAgcmV0dXJuIChkLCB4KSA9PiBhc2NlbmRpbmcoZihkKSwgeCk7CiAgfQogIHZhciBFT0wgPSB7fSwgRU9GID0ge30sIFFVT1RFID0gMzQsIE5FV0xJTkUgPSAxMCwgUkVUVVJOID0gMTM7CiAgZnVuY3Rpb24gb2JqZWN0Q29udmVydGVyKGNvbHVtbnMpIHsKICAgIHJldHVybiBuZXcgRnVuY3Rpb24oImQiLCAicmV0dXJuIHsiICsgY29sdW1ucy5tYXAoZnVuY3Rpb24obmFtZSwgaTIpIHsKICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG5hbWUpICsgIjogZFsiICsgaTIgKyAnXSB8fCAiIic7CiAgICB9KS5qb2luKCIsIikgKyAifSIpOwogIH0KICBmdW5jdGlvbiBjdXN0b21Db252ZXJ0ZXIoY29sdW1ucywgZikgewogICAgdmFyIG9iamVjdCA9IG9iamVjdENvbnZlcnRlcihjb2x1bW5zKTsKICAgIHJldHVybiBmdW5jdGlvbihyb3csIGkyKSB7CiAgICAgIHJldHVybiBmKG9iamVjdChyb3cpLCBpMiwgY29sdW1ucyk7CiAgICB9OwogIH0KICBmdW5jdGlvbiBpbmZlckNvbHVtbnMocm93cykgewogICAgdmFyIGNvbHVtblNldCA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpLCBjb2x1bW5zID0gW107CiAgICByb3dzLmZvckVhY2goZnVuY3Rpb24ocm93KSB7CiAgICAgIGZvciAodmFyIGNvbHVtbiBpbiByb3cpIHsKICAgICAgICBpZiAoIShjb2x1bW4gaW4gY29sdW1uU2V0KSkgewogICAgICAgICAgY29sdW1ucy5wdXNoKGNvbHVtblNldFtjb2x1bW5dID0gY29sdW1uKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIGNvbHVtbnM7CiAgfQogIGZ1bmN0aW9uIHBhZCh2YWx1ZSwgd2lkdGgpIHsKICAgIHZhciBzID0gdmFsdWUgKyAiIiwgbGVuZ3RoID0gcy5sZW5ndGg7CiAgICByZXR1cm4gbGVuZ3RoIDwgd2lkdGggPyBuZXcgQXJyYXkod2lkdGggLSBsZW5ndGggKyAxKS5qb2luKDApICsgcyA6IHM7CiAgfQogIGZ1bmN0aW9uIGZvcm1hdFllYXIoeWVhcikgewogICAgcmV0dXJuIHllYXIgPCAwID8gIi0iICsgcGFkKC15ZWFyLCA2KSA6IHllYXIgPiA5OTk5ID8gIisiICsgcGFkKHllYXIsIDYpIDogcGFkKHllYXIsIDQpOwogIH0KICBmdW5jdGlvbiBmb3JtYXREYXRlKGRhdGUpIHsKICAgIHZhciBob3VycyA9IGRhdGUuZ2V0VVRDSG91cnMoKSwgbWludXRlcyA9IGRhdGUuZ2V0VVRDTWludXRlcygpLCBzZWNvbmRzID0gZGF0ZS5nZXRVVENTZWNvbmRzKCksIG1pbGxpc2Vjb25kcyA9IGRhdGUuZ2V0VVRDTWlsbGlzZWNvbmRzKCk7CiAgICByZXR1cm4gaXNOYU4oZGF0ZSkgPyAiSW52YWxpZCBEYXRlIiA6IGZvcm1hdFllYXIoZGF0ZS5nZXRVVENGdWxsWWVhcigpKSArICItIiArIHBhZChkYXRlLmdldFVUQ01vbnRoKCkgKyAxLCAyKSArICItIiArIHBhZChkYXRlLmdldFVUQ0RhdGUoKSwgMikgKyAobWlsbGlzZWNvbmRzID8gIlQiICsgcGFkKGhvdXJzLCAyKSArICI6IiArIHBhZChtaW51dGVzLCAyKSArICI6IiArIHBhZChzZWNvbmRzLCAyKSArICIuIiArIHBhZChtaWxsaXNlY29uZHMsIDMpICsgIloiIDogc2Vjb25kcyA/ICJUIiArIHBhZChob3VycywgMikgKyAiOiIgKyBwYWQobWludXRlcywgMikgKyAiOiIgKyBwYWQoc2Vjb25kcywgMikgKyAiWiIgOiBtaW51dGVzIHx8IGhvdXJzID8gIlQiICsgcGFkKGhvdXJzLCAyKSArICI6IiArIHBhZChtaW51dGVzLCAyKSArICJaIiA6ICIiKTsKICB9CiAgZnVuY3Rpb24gZHN2KGRlbGltaXRlcikgewogICAgdmFyIHJlRm9ybWF0ID0gbmV3IFJlZ0V4cCgnWyInICsgZGVsaW1pdGVyICsgIlxuXHJdIiksIERFTElNSVRFUiA9IGRlbGltaXRlci5jaGFyQ29kZUF0KDApOwogICAgZnVuY3Rpb24gcGFyc2UodGV4dCwgZikgewogICAgICB2YXIgY29udmVydCwgY29sdW1ucywgcm93cyA9IHBhcnNlUm93cyh0ZXh0LCBmdW5jdGlvbihyb3csIGkyKSB7CiAgICAgICAgaWYgKGNvbnZlcnQpCiAgICAgICAgICByZXR1cm4gY29udmVydChyb3csIGkyIC0gMSk7CiAgICAgICAgY29sdW1ucyA9IHJvdywgY29udmVydCA9IGYgPyBjdXN0b21Db252ZXJ0ZXIocm93LCBmKSA6IG9iamVjdENvbnZlcnRlcihyb3cpOwogICAgICB9KTsKICAgICAgcm93cy5jb2x1bW5zID0gY29sdW1ucyB8fCBbXTsKICAgICAgcmV0dXJuIHJvd3M7CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZVJvd3ModGV4dCwgZikgewogICAgICB2YXIgcm93cyA9IFtdLCBOID0gdGV4dC5sZW5ndGgsIEkgPSAwLCBuID0gMCwgdCwgZW9mID0gTiA8PSAwLCBlb2wgPSBmYWxzZTsKICAgICAgaWYgKHRleHQuY2hhckNvZGVBdChOIC0gMSkgPT09IE5FV0xJTkUpCiAgICAgICAgLS1OOwogICAgICBpZiAodGV4dC5jaGFyQ29kZUF0KE4gLSAxKSA9PT0gUkVUVVJOKQogICAgICAgIC0tTjsKICAgICAgZnVuY3Rpb24gdG9rZW4oKSB7CiAgICAgICAgaWYgKGVvZikKICAgICAgICAgIHJldHVybiBFT0Y7CiAgICAgICAgaWYgKGVvbCkKICAgICAgICAgIHJldHVybiBlb2wgPSBmYWxzZSwgRU9MOwogICAgICAgIHZhciBpMiwgaiA9IEksIGMyOwogICAgICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQoaikgPT09IFFVT1RFKSB7CiAgICAgICAgICB3aGlsZSAoSSsrIDwgTiAmJiB0ZXh0LmNoYXJDb2RlQXQoSSkgIT09IFFVT1RFIHx8IHRleHQuY2hhckNvZGVBdCgrK0kpID09PSBRVU9URSkKICAgICAgICAgICAgOwogICAgICAgICAgaWYgKChpMiA9IEkpID49IE4pCiAgICAgICAgICAgIGVvZiA9IHRydWU7CiAgICAgICAgICBlbHNlIGlmICgoYzIgPSB0ZXh0LmNoYXJDb2RlQXQoSSsrKSkgPT09IE5FV0xJTkUpCiAgICAgICAgICAgIGVvbCA9IHRydWU7CiAgICAgICAgICBlbHNlIGlmIChjMiA9PT0gUkVUVVJOKSB7CiAgICAgICAgICAgIGVvbCA9IHRydWU7CiAgICAgICAgICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQoSSkgPT09IE5FV0xJTkUpCiAgICAgICAgICAgICAgKytJOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRleHQuc2xpY2UoaiArIDEsIGkyIC0gMSkucmVwbGFjZSgvIiIvZywgJyInKTsKICAgICAgICB9CiAgICAgICAgd2hpbGUgKEkgPCBOKSB7CiAgICAgICAgICBpZiAoKGMyID0gdGV4dC5jaGFyQ29kZUF0KGkyID0gSSsrKSkgPT09IE5FV0xJTkUpCiAgICAgICAgICAgIGVvbCA9IHRydWU7CiAgICAgICAgICBlbHNlIGlmIChjMiA9PT0gUkVUVVJOKSB7CiAgICAgICAgICAgIGVvbCA9IHRydWU7CiAgICAgICAgICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQoSSkgPT09IE5FV0xJTkUpCiAgICAgICAgICAgICAgKytJOwogICAgICAgICAgfSBlbHNlIGlmIChjMiAhPT0gREVMSU1JVEVSKQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIHJldHVybiB0ZXh0LnNsaWNlKGosIGkyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVvZiA9IHRydWUsIHRleHQuc2xpY2UoaiwgTik7CiAgICAgIH0KICAgICAgd2hpbGUgKCh0ID0gdG9rZW4oKSkgIT09IEVPRikgewogICAgICAgIHZhciByb3cgPSBbXTsKICAgICAgICB3aGlsZSAodCAhPT0gRU9MICYmIHQgIT09IEVPRikKICAgICAgICAgIHJvdy5wdXNoKHQpLCB0ID0gdG9rZW4oKTsKICAgICAgICBpZiAoZiAmJiAocm93ID0gZihyb3csIG4rKykpID09IG51bGwpCiAgICAgICAgICBjb250aW51ZTsKICAgICAgICByb3dzLnB1c2gocm93KTsKICAgICAgfQogICAgICByZXR1cm4gcm93czsKICAgIH0KICAgIGZ1bmN0aW9uIHByZWZvcm1hdEJvZHkocm93cywgY29sdW1ucykgewogICAgICByZXR1cm4gcm93cy5tYXAoZnVuY3Rpb24ocm93KSB7CiAgICAgICAgcmV0dXJuIGNvbHVtbnMubWFwKGZ1bmN0aW9uKGNvbHVtbikgewogICAgICAgICAgcmV0dXJuIGZvcm1hdFZhbHVlKHJvd1tjb2x1bW5dKTsKICAgICAgICB9KS5qb2luKGRlbGltaXRlcik7CiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gZm9ybWF0KHJvd3MsIGNvbHVtbnMpIHsKICAgICAgaWYgKGNvbHVtbnMgPT0gbnVsbCkKICAgICAgICBjb2x1bW5zID0gaW5mZXJDb2x1bW5zKHJvd3MpOwogICAgICByZXR1cm4gW2NvbHVtbnMubWFwKGZvcm1hdFZhbHVlKS5qb2luKGRlbGltaXRlcildLmNvbmNhdChwcmVmb3JtYXRCb2R5KHJvd3MsIGNvbHVtbnMpKS5qb2luKCJcbiIpOwogICAgfQogICAgZnVuY3Rpb24gZm9ybWF0Qm9keShyb3dzLCBjb2x1bW5zKSB7CiAgICAgIGlmIChjb2x1bW5zID09IG51bGwpCiAgICAgICAgY29sdW1ucyA9IGluZmVyQ29sdW1ucyhyb3dzKTsKICAgICAgcmV0dXJuIHByZWZvcm1hdEJvZHkocm93cywgY29sdW1ucykuam9pbigiXG4iKTsKICAgIH0KICAgIGZ1bmN0aW9uIGZvcm1hdFJvd3Mocm93cykgewogICAgICByZXR1cm4gcm93cy5tYXAoZm9ybWF0Um93KS5qb2luKCJcbiIpOwogICAgfQogICAgZnVuY3Rpb24gZm9ybWF0Um93KHJvdykgewogICAgICByZXR1cm4gcm93Lm1hcChmb3JtYXRWYWx1ZSkuam9pbihkZWxpbWl0ZXIpOwogICAgfQogICAgZnVuY3Rpb24gZm9ybWF0VmFsdWUodmFsdWUpIHsKICAgICAgcmV0dXJuIHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVlIGluc3RhbmNlb2YgRGF0ZSA/IGZvcm1hdERhdGUodmFsdWUpIDogcmVGb3JtYXQudGVzdCh2YWx1ZSArPSAiIikgPyAnIicgKyB2YWx1ZS5yZXBsYWNlKC8iL2csICciIicpICsgJyInIDogdmFsdWU7CiAgICB9CiAgICByZXR1cm4gewogICAgICBwYXJzZSwKICAgICAgcGFyc2VSb3dzLAogICAgICBmb3JtYXQsCiAgICAgIGZvcm1hdEJvZHksCiAgICAgIGZvcm1hdFJvd3MsCiAgICAgIGZvcm1hdFJvdywKICAgICAgZm9ybWF0VmFsdWUKICAgIH07CiAgfQogIHZhciB0c3YgPSBkc3YoIgkiKTsKICB2YXIgdHN2UGFyc2VSb3dzID0gdHN2LnBhcnNlUm93czsKICBjb25zdCBjaHJvbUluZm9CaXNlY3RvciA9IGJpc2VjdG9yKChkKSA9PiBkLnBvcykubGVmdDsKICBjb25zdCBjaHJUb0FicyA9IChjaHJvbSwgY2hyb21Qb3MsIGNocm9tSW5mbykgPT4gY2hyb21JbmZvLmNoclBvc2l0aW9uc1tjaHJvbV0ucG9zICsgY2hyb21Qb3M7CiAgY29uc3QgYWJzVG9DaHIgPSAoYWJzUG9zaXRpb24sIGNocm9tSW5mbykgPT4gewogICAgaWYgKCFjaHJvbUluZm8gfHwgIWNocm9tSW5mby5jdW1Qb3NpdGlvbnMgfHwgIWNocm9tSW5mby5jdW1Qb3NpdGlvbnMubGVuZ3RoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgbGV0IGluc2VydFBvaW50ID0gY2hyb21JbmZvQmlzZWN0b3IoY2hyb21JbmZvLmN1bVBvc2l0aW9ucywgYWJzUG9zaXRpb24pOwogICAgY29uc3QgbGFzdENociA9IGNocm9tSW5mby5jdW1Qb3NpdGlvbnNbY2hyb21JbmZvLmN1bVBvc2l0aW9ucy5sZW5ndGggLSAxXS5jaHI7CiAgICBjb25zdCBsYXN0TGVuZ3RoID0gY2hyb21JbmZvLmNocm9tTGVuZ3Roc1tsYXN0Q2hyXTsKICAgIGluc2VydFBvaW50IC09IGluc2VydFBvaW50ID4gMCAmJiAxOwogICAgbGV0IGNoclBvc2l0aW9uID0gTWF0aC5mbG9vcihhYnNQb3NpdGlvbiAtIGNocm9tSW5mby5jdW1Qb3NpdGlvbnNbaW5zZXJ0UG9pbnRdLnBvcyk7CiAgICBsZXQgb2Zmc2V0ID0gMDsKICAgIGlmIChjaHJQb3NpdGlvbiA8IDApIHsKICAgICAgb2Zmc2V0ID0gY2hyUG9zaXRpb24gLSAxOwogICAgICBjaHJQb3NpdGlvbiA9IDE7CiAgICB9CiAgICBpZiAoaW5zZXJ0UG9pbnQgPT09IGNocm9tSW5mby5jdW1Qb3NpdGlvbnMubGVuZ3RoIC0gMSAmJiBjaHJQb3NpdGlvbiA+IGxhc3RMZW5ndGgpIHsKICAgICAgb2Zmc2V0ID0gY2hyUG9zaXRpb24gLSBsYXN0TGVuZ3RoOwogICAgICBjaHJQb3NpdGlvbiA9IGxhc3RMZW5ndGg7CiAgICB9CiAgICByZXR1cm4gW2Nocm9tSW5mby5jdW1Qb3NpdGlvbnNbaW5zZXJ0UG9pbnRdLmNociwgY2hyUG9zaXRpb24sIG9mZnNldCwgaW5zZXJ0UG9pbnRdOwogIH07CiAgZnVuY3Rpb24gcGFyc2VDaHJTaXplcyhyb3dzKSB7CiAgICBjb25zdCBpbmZvID0gewogICAgICBjdW1Qb3NpdGlvbnM6IFtdLAogICAgICBjaHJvbUxlbmd0aHM6IHt9LAogICAgICBjaHJQb3NpdGlvbnM6IHt9LAogICAgICB0b3RhbExlbmd0aDogMAogICAgfTsKICAgIHJvd3MuZm9yRWFjaCgoZCwgaTIpID0+IHsKICAgICAgY29uc3QgY2hyID0gZFswXTsKICAgICAgY29uc3QgbGVuZ3RoID0gTnVtYmVyKGRbMV0pOwogICAgICBjb25zdCBjaHJQb3NpdGlvbiA9IHsgaWQ6IGkyLCBjaHIsIHBvczogaW5mby50b3RhbExlbmd0aCB9OwogICAgICBpbmZvLmNoclBvc2l0aW9uc1tjaHJdID0gY2hyUG9zaXRpb247CiAgICAgIGluZm8uY2hyb21MZW5ndGhzW2Nocl0gPSBsZW5ndGg7CiAgICAgIGluZm8uY3VtUG9zaXRpb25zLnB1c2goY2hyUG9zaXRpb24pOwogICAgICBpbmZvLnRvdGFsTGVuZ3RoICs9IGxlbmd0aDsKICAgIH0pOwogICAgcmV0dXJuIGluZm87CiAgfQogIGFzeW5jIGZ1bmN0aW9uIGZldGNoQ2hyb21JbmZvKHVybCkgewogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwpOwogICAgY29uc3QgY2hySW5mb1RleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7CiAgICBjb25zdCBkYXRhMiA9IHRzdlBhcnNlUm93cyhjaHJJbmZvVGV4dCk7CiAgICBjb25zdCBpbmZvID0gcGFyc2VDaHJTaXplcyhkYXRhMik7CiAgICByZXR1cm4gewogICAgICAuLi5pbmZvLAogICAgICBhYnNUb0NocjogKGFic1BvcykgPT4gaW5mby5jaHJQb3NpdGlvbnMgPyBhYnNUb0NocihhYnNQb3MsIGluZm8pIDogbnVsbCwKICAgICAgY2hyVG9BYnM6IChbY2hyTmFtZSwgY2hyUG9zXSkgPT4gaW5mby5jaHJQb3NpdGlvbnMgPyBjaHJUb0FicyhjaHJOYW1lLCBjaHJQb3MsIGluZm8pIDogbnVsbAogICAgfTsKICB9CiAgY2xhc3MgUmVtb3RlRmlsZSBleHRlbmRzIGRpc3QuUmVtb3RlRmlsZSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy5yZWFkID0gYXN5bmMgKGJ1ZmZlcjIsIG9mZnNldCA9IDAsIGxlbmd0aCwgcG9zaXRpb24gPSAwLCBvcHRzID0ge30pID0+IHsKICAgICAgICBjb25zdCB7IGhlYWRlcnMgPSB7fSwgc2lnbmFsLCBvdmVycmlkZXMgPSB7fSB9ID0gb3B0czsKICAgICAgICBpZiAobGVuZ3RoIDwgSW5maW5pdHkpIHsKICAgICAgICAgIGhlYWRlcnMucmFuZ2UgPSBgYnl0ZXM9JHtwb3NpdGlvbn0tJHtwb3NpdGlvbiArIGxlbmd0aH1gOwogICAgICAgIH0gZWxzZSBpZiAobGVuZ3RoID09PSBJbmZpbml0eSAmJiBwb3NpdGlvbiAhPT0gMCkgewogICAgICAgICAgaGVhZGVycy5yYW5nZSA9IGBieXRlcz0ke3Bvc2l0aW9ufS1gOwogICAgICAgIH0KICAgICAgICBjb25zdCBhcmdzID0gewogICAgICAgICAgLi4udGhpcy5iYXNlT3ZlcnJpZGVzLAogICAgICAgICAgLi4ub3ZlcnJpZGVzLAogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAuLi5oZWFkZXJzLAogICAgICAgICAgICAuLi5vdmVycmlkZXMuaGVhZGVycywKICAgICAgICAgICAgLi4udGhpcy5iYXNlT3ZlcnJpZGVzLmhlYWRlcnMKICAgICAgICAgIH0sCiAgICAgICAgICBtZXRob2Q6ICJHRVQiLAogICAgICAgICAgcmVkaXJlY3Q6ICJmb2xsb3ciLAogICAgICAgICAgbW9kZTogImNvcnMiLAogICAgICAgICAgc2lnbmFsCiAgICAgICAgfTsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuZmV0Y2godGhpcy51cmwsIGFyZ3MpOwogICAgICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCAke3Jlc3BvbnNlLnN0YXR1c30gJHtyZXNwb25zZS5zdGF0dXNUZXh0fSAke3RoaXMudXJsfWApOwogICAgICAgIH0KICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDAgfHwgcmVzcG9uc2Uuc3RhdHVzID09PSAyMDYpIHsKICAgICAgICAgIGNvbnN0IHJlc3BvbnNlRGF0YSA9IGF3YWl0IHRoaXMuZ2V0QnVmZmVyRnJvbVJlc3BvbnNlKHJlc3BvbnNlKTsKICAgICAgICAgIGNvbnN0IGJ5dGVzQ29waWVkID0gcmVzcG9uc2VEYXRhLmNvcHkoYnVmZmVyMiwgb2Zmc2V0LCAwLCBNYXRoLm1pbihsZW5ndGgsIHJlc3BvbnNlRGF0YS5sZW5ndGgpKTsKICAgICAgICAgIGNvbnN0IHJlcyA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCJjb250ZW50LXJhbmdlIik7CiAgICAgICAgICBjb25zdCBzaXplTWF0Y2ggPSAvXC8oXGQrKSQvLmV4ZWMocmVzIHx8ICIiKTsKICAgICAgICAgIGlmIChzaXplTWF0Y2ggJiYgc2l6ZU1hdGNoWzFdKSB7CiAgICAgICAgICAgIHRoaXMuX3N0YXQgPSB7IHNpemU6IHBhcnNlSW50KHNpemVNYXRjaFsxXSwgMTApIH07CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4geyBieXRlc1JlYWQ6IGJ5dGVzQ29waWVkLCBidWZmZXI6IGJ1ZmZlcjIgfTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBIVFRQICR7cmVzcG9uc2Uuc3RhdHVzfSBmZXRjaGluZyAke3RoaXMudXJsfWApOwogICAgICB9OwogICAgfQogIH0KICBmdW5jdGlvbiBwYXJzZU1EKG1kU3RyaW5nLCB1c2VDb3VudHMpIHsKICAgIGxldCBjdXJyUG9zID0gMDsKICAgIGxldCBjdXJyTnVtID0gMDsKICAgIGxldCBkZWxldGlvbkVuY291bnRlcmVkID0gZmFsc2U7CiAgICBsZXQgYmFtU2VxU2hpZnQgPSAwOwogICAgY29uc3Qgc3Vic3RpdHV0aW9ucyA9IFtdOwogICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IG1kU3RyaW5nLmxlbmd0aDsgaTIrKykgewogICAgICBpZiAobWRTdHJpbmdbaTJdLm1hdGNoKC9bMC05XS9nKSkgewogICAgICAgIGN1cnJOdW0gPSBjdXJyTnVtICogMTAgKyArbWRTdHJpbmdbaTJdOwogICAgICAgIGRlbGV0aW9uRW5jb3VudGVyZWQgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmIChtZFN0cmluZ1tpMl0gPT09ICJeIikgewogICAgICAgIGRlbGV0aW9uRW5jb3VudGVyZWQgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIGN1cnJQb3MgKz0gY3Vyck51bTsKICAgICAgICBpZiAodXNlQ291bnRzKSB7CiAgICAgICAgICBzdWJzdGl0dXRpb25zLnB1c2goewogICAgICAgICAgICBsZW5ndGg6IGN1cnJOdW0sCiAgICAgICAgICAgIHR5cGU6IG1kU3RyaW5nW2kyXQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChkZWxldGlvbkVuY291bnRlcmVkKSB7CiAgICAgICAgICBiYW1TZXFTaGlmdCAtPSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdWJzdGl0dXRpb25zLnB1c2goewogICAgICAgICAgICBwb3M6IGN1cnJQb3MsCiAgICAgICAgICAgIGJhc2U6IG1kU3RyaW5nW2kyXSwKICAgICAgICAgICAgbGVuZ3RoOiAxLAogICAgICAgICAgICBiYW1TZXFTaGlmdAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGN1cnJOdW0gPSAwOwogICAgICAgIGN1cnJQb3MgKz0gMTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHN1YnN0aXR1dGlvbnM7CiAgfQogIGZ1bmN0aW9uIGdldFN1YnN0aXR1dGlvbnMoc2VnbWVudCwgc2VxKSB7CiAgICBsZXQgc3Vic3RpdHV0aW9ucyA9IFtdOwogICAgbGV0IHNvZnRDbGlwcGluZ0F0UmVhZFN0YXJ0ID0gbnVsbDsKICAgIGlmIChzZWdtZW50LmNpZ2FyKSB7CiAgICAgIGNvbnN0IGNpZ2FyU3VicyA9IHBhcnNlTUQoc2VnbWVudC5jaWdhciwgdHJ1ZSk7CiAgICAgIGxldCBjdXJyUG9zID0gMDsKICAgICAgZm9yIChjb25zdCBzdWIgb2YgY2lnYXJTdWJzKSB7CiAgICAgICAgaWYgKHN1Yi50eXBlID09PSAiWCIpIHsKICAgICAgICAgIHN1YnN0aXR1dGlvbnMucHVzaCh7CiAgICAgICAgICAgIHBvczogY3VyclBvcywKICAgICAgICAgICAgbGVuZ3RoOiBzdWIubGVuZ3RoLAogICAgICAgICAgICB0eXBlOiAiWCIKICAgICAgICAgIH0pOwogICAgICAgICAgY3VyclBvcyArPSBzdWIubGVuZ3RoOwogICAgICAgIH0gZWxzZSBpZiAoc3ViLnR5cGUgPT09ICJJIikgewogICAgICAgICAgc3Vic3RpdHV0aW9ucy5wdXNoKHsKICAgICAgICAgICAgcG9zOiBjdXJyUG9zLAogICAgICAgICAgICBsZW5ndGg6IHN1Yi5sZW5ndGgsCiAgICAgICAgICAgIHR5cGU6ICJJIgogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChzdWIudHlwZSA9PT0gIkQiKSB7CiAgICAgICAgICBzdWJzdGl0dXRpb25zLnB1c2goewogICAgICAgICAgICBwb3M6IGN1cnJQb3MsCiAgICAgICAgICAgIGxlbmd0aDogc3ViLmxlbmd0aCwKICAgICAgICAgICAgdHlwZTogIkQiCiAgICAgICAgICB9KTsKICAgICAgICAgIGN1cnJQb3MgKz0gc3ViLmxlbmd0aDsKICAgICAgICB9IGVsc2UgaWYgKHN1Yi50eXBlID09PSAiTiIpIHsKICAgICAgICAgIHN1YnN0aXR1dGlvbnMucHVzaCh7CiAgICAgICAgICAgIHBvczogY3VyclBvcywKICAgICAgICAgICAgbGVuZ3RoOiBzdWIubGVuZ3RoLAogICAgICAgICAgICB0eXBlOiAiTiIKICAgICAgICAgIH0pOwogICAgICAgICAgY3VyclBvcyArPSBzdWIubGVuZ3RoOwogICAgICAgIH0gZWxzZSBpZiAoc3ViLnR5cGUgPT09ICI9IiB8fCBzdWIudHlwZSA9PT0gIk0iKSB7CiAgICAgICAgICBjdXJyUG9zICs9IHN1Yi5sZW5ndGg7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICA7CiAgICAgIH0KICAgICAgY29uc3QgZmlyc3RTdWIgPSBjaWdhclN1YnNbMF07CiAgICAgIGNvbnN0IGxhc3RTdWIgPSBjaWdhclN1YnNbY2lnYXJTdWJzLmxlbmd0aCAtIDFdOwogICAgICBpZiAoZmlyc3RTdWIudHlwZSA9PT0gIlMiKSB7CiAgICAgICAgc29mdENsaXBwaW5nQXRSZWFkU3RhcnQgPSBmaXJzdFN1YjsKICAgICAgICBzdWJzdGl0dXRpb25zLnB1c2goewogICAgICAgICAgcG9zOiAtZmlyc3RTdWIubGVuZ3RoLAogICAgICAgICAgdHlwZTogIlMiLAogICAgICAgICAgbGVuZ3RoOiBmaXJzdFN1Yi5sZW5ndGgKICAgICAgICB9KTsKICAgICAgfQogICAgICBpZiAobGFzdFN1Yi50eXBlID09PSAiUyIpIHsKICAgICAgICBzdWJzdGl0dXRpb25zLnB1c2goewogICAgICAgICAgcG9zOiBzZWdtZW50LmVuZCAtIHNlZ21lbnQuc3RhcnQsCiAgICAgICAgICBsZW5ndGg6IGxhc3RTdWIubGVuZ3RoLAogICAgICAgICAgdHlwZTogIlMiCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKGZpcnN0U3ViLnR5cGUgPT09ICJIIikgewogICAgICAgIHN1YnN0aXR1dGlvbnMucHVzaCh7CiAgICAgICAgICBwb3M6IC1maXJzdFN1Yi5sZW5ndGgsCiAgICAgICAgICB0eXBlOiAiSCIsCiAgICAgICAgICBsZW5ndGg6IGZpcnN0U3ViLmxlbmd0aAogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmIChsYXN0U3ViLnR5cGUgPT09ICJIIikgewogICAgICAgIHN1YnN0aXR1dGlvbnMucHVzaCh7CiAgICAgICAgICBwb3M6IHNlZ21lbnQuZW5kIC0gc2VnbWVudC5zdGFydCwKICAgICAgICAgIGxlbmd0aDogbGFzdFN1Yi5sZW5ndGgsCiAgICAgICAgICB0eXBlOiAiSCIKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgaWYgKHNlZ21lbnQubWQpIHsKICAgICAgY29uc3QgbWRTdWJzdGl0dXRpb25zID0gcGFyc2VNRChzZWdtZW50Lm1kLCBmYWxzZSk7CiAgICAgIG1kU3Vic3RpdHV0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHN1YnN0aXR1dGlvbikgewogICAgICAgIGxldCBwb3NTdGFydCA9IHN1YnN0aXR1dGlvblsicG9zIl0gKyBzdWJzdGl0dXRpb25bImJhbVNlcVNoaWZ0Il07CiAgICAgICAgbGV0IHBvc0VuZCA9IHBvc1N0YXJ0ICsgc3Vic3RpdHV0aW9uWyJsZW5ndGgiXTsKICAgICAgICBpZiAoc29mdENsaXBwaW5nQXRSZWFkU3RhcnQgIT09IG51bGwpIHsKICAgICAgICAgIHBvc1N0YXJ0ICs9IHNvZnRDbGlwcGluZ0F0UmVhZFN0YXJ0Lmxlbmd0aDsKICAgICAgICAgIHBvc0VuZCArPSBzb2Z0Q2xpcHBpbmdBdFJlYWRTdGFydC5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIHN1YnN0aXR1dGlvblsidmFyaWFudCJdID0gc2VxLnN1YnN0cmluZyhwb3NTdGFydCwgcG9zRW5kKTsKICAgICAgICBkZWxldGUgc3Vic3RpdHV0aW9uWyJiYW1TZXFTaGlmdCJdOwogICAgICB9KTsKICAgICAgc3Vic3RpdHV0aW9ucyA9IG1kU3Vic3RpdHV0aW9ucy5jb25jYXQoc3Vic3RpdHV0aW9ucyk7CiAgICB9CiAgICByZXR1cm4gc3Vic3RpdHV0aW9uczsKICB9CiAgZnVuY3Rpb24gbmF0Y21wKHhSb3csIHlSb3cpIHsKICAgIHZhciBfYSwgX2I7CiAgICBjb25zdCB4ID0geFJvd1swXTsKICAgIGNvbnN0IHkgPSB5Um93WzBdOwogICAgaWYgKHguaW5kZXhPZigiXyIpID49IDApIHsKICAgICAgY29uc3QgeFBhcnRzMiA9IHguc3BsaXQoIl8iKTsKICAgICAgaWYgKHkuaW5kZXhPZigiXyIpID49IDApIHsKICAgICAgICBjb25zdCB5UGFydHMyID0geS5zcGxpdCgiXyIpOwogICAgICAgIHJldHVybiBuYXRjbXAoeFBhcnRzMlsxXSwgeVBhcnRzMlsxXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIDE7CiAgICB9CiAgICBpZiAoeS5pbmRleE9mKCJfIikgPj0gMCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICBjb25zdCB4UGFydHMgPSBbXTsKICAgIGNvbnN0IHlQYXJ0cyA9IFtdOwogICAgZm9yIChjb25zdCBwYXJ0IG9mIChfYSA9IHgubWF0Y2goLyhcZCt8W15cZF0rKS9nKSkgIT0gbnVsbCA/IF9hIDogW10pIHsKICAgICAgeFBhcnRzLnB1c2goTnVtYmVyLmlzTmFOKHBhcnQpID8gcGFydC50b0xvd2VyQ2FzZSgpIDogK3BhcnQpOwogICAgfQogICAgZm9yIChjb25zdCBwYXJ0IG9mIChfYiA9IHkubWF0Y2goLyhcZCt8W15cZF0rKS9nKSkgIT0gbnVsbCA/IF9iIDogW10pIHsKICAgICAgeFBhcnRzLnB1c2goTnVtYmVyLmlzTmFOKHBhcnQpID8gcGFydC50b0xvd2VyQ2FzZSgpIDogK3BhcnQpOwogICAgfQogICAgZm9yIChjb25zdCBrZXkgb2YgWyJtIiwgInkiLCAieCJdKSB7CiAgICAgIGlmICh5LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoa2V5KSkKICAgICAgICByZXR1cm4gLTE7CiAgICAgIGlmICh4LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoa2V5KSkKICAgICAgICByZXR1cm4gMTsKICAgIH0KICAgIGlmICh4UGFydHMgPCB5UGFydHMpIHsKICAgICAgcmV0dXJuIC0xOwogICAgfSBlbHNlIGlmICh5UGFydHMgPiB4UGFydHMpIHsKICAgICAgcmV0dXJuIDE7CiAgICB9CiAgICByZXR1cm4gMDsKICB9CiAgZnVuY3Rpb24gcGFyc2VDaHJvbXNpemVzUm93cyhkYXRhMikgewogICAgY29uc3QgY3VtVmFsdWVzID0gW107CiAgICBjb25zdCBjaHJvbUxlbmd0aHMgPSB7fTsKICAgIGNvbnN0IGNoclBvc2l0aW9ucyA9IHt9OwogICAgbGV0IHRvdGFsTGVuZ3RoID0gMDsKICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBkYXRhMi5sZW5ndGg7IGkyKyspIHsKICAgICAgY29uc3QgbGVuZ3RoID0gTnVtYmVyKGRhdGEyW2kyXVsxXSk7CiAgICAgIHRvdGFsTGVuZ3RoICs9IGxlbmd0aDsKICAgICAgY29uc3QgbmV3VmFsdWUgPSB7CiAgICAgICAgaWQ6IGkyLAogICAgICAgIGNocjogZGF0YTJbaTJdWzBdLAogICAgICAgIHBvczogdG90YWxMZW5ndGggLSBsZW5ndGgKICAgICAgfTsKICAgICAgY3VtVmFsdWVzLnB1c2gobmV3VmFsdWUpOwogICAgICBjaHJQb3NpdGlvbnNbbmV3VmFsdWUuY2hyXSA9IG5ld1ZhbHVlOwogICAgICBjaHJvbUxlbmd0aHNbZGF0YTJbaTJdWzBdXSA9IGxlbmd0aDsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGN1bVBvc2l0aW9uczogY3VtVmFsdWVzLAogICAgICBjaHJQb3NpdGlvbnMsCiAgICAgIHRvdGFsTGVuZ3RoLAogICAgICBjaHJvbUxlbmd0aHMKICAgIH07CiAgfQogIGNvbnN0IGJhbVJlY29yZFRvSnNvbiA9IChiYW1SZWNvcmQsIGNock5hbWUsIGNock9mZnNldCkgPT4gewogICAgY29uc3Qgc2VxID0gYmFtUmVjb3JkLmdldCgic2VxIik7CiAgICBjb25zdCBzZWdtZW50ID0gewogICAgICBpZDogYmFtUmVjb3JkLl9pZCwKICAgICAgbmFtZTogYmFtUmVjb3JkLmdldCgibmFtZSIpLAogICAgICBzdGFydDogK2JhbVJlY29yZC5kYXRhLnN0YXJ0ICsgMSArIGNock9mZnNldCwKICAgICAgZW5kOiArYmFtUmVjb3JkLmRhdGEuZW5kICsgMSArIGNock9mZnNldCwKICAgICAgbWQ6IGJhbVJlY29yZC5nZXQoIk1EIiksCiAgICAgIGNock5hbWUsCiAgICAgIGNock9mZnNldCwKICAgICAgY2lnYXI6IGJhbVJlY29yZC5nZXQoImNpZ2FyIiksCiAgICAgIG1hcHE6IGJhbVJlY29yZC5nZXQoIm1xIiksCiAgICAgIHN0cmFuZDogYmFtUmVjb3JkLmdldCgic3RyYW5kIikgPT09IDEgPyAiKyIgOiAiLSIKICAgIH07CiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihzZWdtZW50LCB7IHN1YnN0aXR1dGlvbnM6IGdldFN1YnN0aXR1dGlvbnMoc2VnbWVudCwgc2VxKSB9KTsKICB9OwogIGNvbnN0IGJhbUZpbGVzID0ge307CiAgY29uc3QgYmFtSGVhZGVycyA9IHt9OwogIGNvbnN0IGNocm9tU2l6ZXMgPSB7fTsKICBjb25zdCBNQVhfVElMRVMgPSAyMDsKICBjb25zdCB0aWxlVmFsdWVzID0gbmV3IFF1aWNrTFJVKHsgbWF4U2l6ZTogTUFYX1RJTEVTIH0pOwogIGNvbnN0IHRpbGVzZXRJbmZvcyA9IHt9OwogIGNvbnN0IGRhdGFDb25mcyA9IHt9OwogIGNvbnN0IGluaXQgPSAodWlkMiwgewogICAgYmFtVXJsLAogICAgYmFpVXJsLAogICAgY2hyb21TaXplc1VybCwKICAgIGxvYWRNYXRlcyA9IGZhbHNlLAogICAgbWF4SW5zZXJ0U2l6ZSA9IDVlMywKICAgIGV4dHJhY3RKdW5jdGlvbiA9IGZhbHNlLAogICAganVuY3Rpb25NaW5Db3ZlcmFnZSA9IDEKICB9KSA9PiB7CiAgICBpZiAoIWJhbUZpbGVzW2JhbVVybF0pIHsKICAgICAgYmFtRmlsZXNbYmFtVXJsXSA9IG5ldyBkaXN0JDMuQmFtRmlsZSh7CiAgICAgICAgYmFtRmlsZWhhbmRsZTogbmV3IFJlbW90ZUZpbGUoYmFtVXJsKSwKICAgICAgICBiYWlGaWxlaGFuZGxlOiBuZXcgUmVtb3RlRmlsZShiYWlVcmwpCiAgICAgIH0pOwogICAgICBiYW1IZWFkZXJzW2JhbVVybF0gPSBiYW1GaWxlc1tiYW1VcmxdLmdldEhlYWRlcigpOwogICAgfQogICAgaWYgKGNocm9tU2l6ZXNVcmwpIHsKICAgICAgY2hyb21TaXplc1tjaHJvbVNpemVzVXJsXSA9IGZldGNoQ2hyb21JbmZvKGNocm9tU2l6ZXNVcmwpOwogICAgfQogICAgZGF0YUNvbmZzW3VpZDJdID0geyBiYW1VcmwsIGNocm9tU2l6ZXNVcmwsIGxvYWRNYXRlcywgbWF4SW5zZXJ0U2l6ZSwgZXh0cmFjdEp1bmN0aW9uLCBqdW5jdGlvbk1pbkNvdmVyYWdlIH07CiAgfTsKICBjb25zdCB0aWxlc2V0SW5mbyA9ICh1aWQyKSA9PiB7CiAgICBpZiAodWlkMiBpbiB0aWxlc2V0SW5mb3MpIHsKICAgICAgcmV0dXJuIHRpbGVzZXRJbmZvc1t1aWQyXTsKICAgIH0KICAgIGNvbnN0IHsgY2hyb21TaXplc1VybCwgYmFtVXJsIH0gPSBkYXRhQ29uZnNbdWlkMl07CiAgICBjb25zdCBwcm9taXNlcyA9IFsKICAgICAgYmFtSGVhZGVyc1tiYW1VcmxdLAogICAgICBjaHJvbVNpemVzVXJsID8gY2hyb21TaXplc1tjaHJvbVNpemVzVXJsXSA6IHZvaWQgMAogICAgXTsKICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcykudGhlbigocmVzKSA9PiB7CiAgICAgIGNvbnN0IG1heWJlSW5mbyA9IHJlc1sxXTsKICAgICAgY29uc3QgVElMRV9TSVpFID0gMTAyNDsKICAgICAgbGV0IGNocm9tSW5mbzsKICAgICAgaWYgKG1heWJlSW5mbykgewogICAgICAgIGNocm9tSW5mbyA9IG1heWJlSW5mbzsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBjaHJvbXMgPSBbXTsKICAgICAgICBjb25zdCBpbmRleFRvQ2hyID0gYmFtRmlsZXNbYmFtVXJsXS5pbmRleFRvQ2hyOwogICAgICAgIGZvciAoY29uc3QgeyByZWZOYW1lOiBjaHJOYW1lLCBsZW5ndGggfSBvZiBpbmRleFRvQ2hyKSB7CiAgICAgICAgICBjaHJvbXMucHVzaChbY2hyTmFtZSwgbGVuZ3RoXSk7CiAgICAgICAgfQogICAgICAgIGNocm9tcy5zb3J0KG5hdGNtcCk7CiAgICAgICAgY2hyb21JbmZvID0gcGFyc2VDaHJvbXNpemVzUm93cyhjaHJvbXMpOwogICAgICB9CiAgICAgIHRpbGVzZXRJbmZvc1t1aWQyXSA9IHsKICAgICAgICB0aWxlX3NpemU6IFRJTEVfU0laRSwKICAgICAgICBiaW5zX3Blcl9kaW1lbnNpb246IFRJTEVfU0laRSwKICAgICAgICBtYXhfem9vbTogTWF0aC5jZWlsKE1hdGgubG9nKGNocm9tSW5mby50b3RhbExlbmd0aCAvIFRJTEVfU0laRSkgLyBNYXRoLmxvZygyKSksCiAgICAgICAgbWF4X3dpZHRoOiBjaHJvbUluZm8udG90YWxMZW5ndGgsCiAgICAgICAgbWluX3BvczogWzBdLAogICAgICAgIG1heF9wb3M6IFtjaHJvbUluZm8udG90YWxMZW5ndGhdLAogICAgICAgIGNocm9tSW5mbwogICAgICB9OwogICAgICByZXR1cm4gdGlsZXNldEluZm9zW3VpZDJdOwogICAgfSk7CiAgfTsKICBjb25zdCB0aWxlID0gYXN5bmMgKHVpZDIsIHosIHgpID0+IHsKICAgIGNvbnN0IE1BWF9USUxFX1dJRFRIID0gMmU1OwogICAgY29uc3QgeyBiYW1VcmwsIGxvYWRNYXRlcyB9ID0gZGF0YUNvbmZzW3VpZDJdOwogICAgY29uc3QgYmFtRmlsZTIgPSBiYW1GaWxlc1tiYW1VcmxdOwogICAgY29uc3QgaW5mbyA9IGF3YWl0IHRpbGVzZXRJbmZvKHVpZDIpOwogICAgaWYgKCEoIm1heF93aWR0aCIgaW4gaW5mbykpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJ0aWxlc2V0SW5mbyBkb2VzIG5vdCBpbmNsdWRlIGBtYXhfd2lkdGhgLCB3aGljaCBpcyByZXF1aXJlZCBmb3IgdGhlIEdvc2xpbmcgQmFtRGF0YUZldGNoZXIuIik7CiAgICB9CiAgICBjb25zdCB0aWxlV2lkdGggPSAraW5mby5tYXhfd2lkdGggLyAyICoqICt6OwogICAgY29uc3QgcmVjb3JkUHJvbWlzZXMgPSBbXTsKICAgIGlmICh0aWxlV2lkdGggPiBNQVhfVElMRV9XSURUSCkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHJlc29sdmUoW10pKTsKICAgIH0KICAgIGxldCBtaW5YID0gaW5mby5taW5fcG9zWzBdICsgeCAqIHRpbGVXaWR0aDsKICAgIGNvbnN0IG1heFggPSBpbmZvLm1pbl9wb3NbMF0gKyAoeCArIDEpICogdGlsZVdpZHRoOwogICAgY29uc3QgeyBjaHJvbUxlbmd0aHMsIGN1bVBvc2l0aW9ucyB9ID0gaW5mby5jaHJvbUluZm87CiAgICBjb25zdCBvcHQgPSB7CiAgICAgIHZpZXdBc1BhaXJzOiBsb2FkTWF0ZXMKICAgIH07CiAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgY3VtUG9zaXRpb25zLmxlbmd0aDsgaTIrKykgewogICAgICBjb25zdCBjaHJvbU5hbWUgPSBjdW1Qb3NpdGlvbnNbaTJdLmNocjsKICAgICAgY29uc3QgY2hyb21TdGFydCA9IGN1bVBvc2l0aW9uc1tpMl0ucG9zOwogICAgICBjb25zdCBjaHJvbUVuZCA9IGN1bVBvc2l0aW9uc1tpMl0ucG9zICsgY2hyb21MZW5ndGhzW2Nocm9tTmFtZV07CiAgICAgIHRpbGVWYWx1ZXMuc2V0KGAke3VpZDJ9LiR7en0uJHt4fWAsIFtdKTsKICAgICAgaWYgKGNocm9tU3RhcnQgPD0gbWluWCAmJiBtaW5YIDwgY2hyb21FbmQpIHsKICAgICAgICBpZiAobWF4WCA+IGNocm9tRW5kKSB7CiAgICAgICAgICByZWNvcmRQcm9taXNlcy5wdXNoKGJhbUZpbGUyLmdldFJlY29yZHNGb3JSYW5nZShjaHJvbU5hbWUsIG1pblggLSBjaHJvbVN0YXJ0LCBjaHJvbUVuZCAtIGNocm9tU3RhcnQsIG9wdCkudGhlbigocmVjb3JkcykgPT4gewogICAgICAgICAgICBjb25zdCBtYXBwZWRSZWNvcmRzID0gcmVjb3Jkcy5tYXAoKHJlYykgPT4gYmFtUmVjb3JkVG9Kc29uKHJlYywgY2hyb21OYW1lLCBjdW1Qb3NpdGlvbnNbaTJdLnBvcykpOwogICAgICAgICAgICB0aWxlVmFsdWVzLnNldChgJHt1aWQyfS4ke3p9LiR7eH1gLCB0aWxlVmFsdWVzLmdldChgJHt1aWQyfS4ke3p9LiR7eH1gKS5jb25jYXQobWFwcGVkUmVjb3JkcykpOwogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICB9KSk7CiAgICAgICAgICBtaW5YID0gY2hyb21FbmQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IHN0YXJ0UG9zID0gTWF0aC5mbG9vcihtaW5YIC0gY2hyb21TdGFydCk7CiAgICAgICAgICBjb25zdCBlbmRQb3MgPSBNYXRoLmNlaWwobWF4WCAtIGNocm9tU3RhcnQpOwogICAgICAgICAgcmVjb3JkUHJvbWlzZXMucHVzaChiYW1GaWxlMi5nZXRSZWNvcmRzRm9yUmFuZ2UoY2hyb21OYW1lLCBzdGFydFBvcywgZW5kUG9zLCBvcHQpLnRoZW4oKHJlY29yZHMpID0+IHsKICAgICAgICAgICAgY29uc3QgbWFwcGVkUmVjb3JkcyA9IHJlY29yZHMubWFwKChyZWMpID0+IGJhbVJlY29yZFRvSnNvbihyZWMsIGNocm9tTmFtZSwgY3VtUG9zaXRpb25zW2kyXS5wb3MpKTsKICAgICAgICAgICAgdGlsZVZhbHVlcy5zZXQoYCR7dWlkMn0uJHt6fS4ke3h9YCwgdGlsZVZhbHVlcy5nZXQoYCR7dWlkMn0uJHt6fS4ke3h9YCkuY29uY2F0KG1hcHBlZFJlY29yZHMpKTsKICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgfSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gUHJvbWlzZS5hbGwocmVjb3JkUHJvbWlzZXMpLnRoZW4oKHZhbHVlcykgPT4gewogICAgICByZXR1cm4gdmFsdWVzLmZsYXQoKTsKICAgIH0pOwogIH07CiAgY29uc3QgZmV0Y2hUaWxlc0RlYm91bmNlZCA9IGFzeW5jICh1aWQyLCB0aWxlSWRzKSA9PiB7CiAgICBjb25zdCB0aWxlcyA9IHt9OwogICAgY29uc3QgdmFsaWRUaWxlSWRzID0gW107CiAgICBjb25zdCB0aWxlUHJvbWlzZXMgPSBbXTsKICAgIGZvciAoY29uc3QgdGlsZUlkIG9mIHRpbGVJZHMpIHsKICAgICAgY29uc3QgcGFydHMgPSB0aWxlSWQuc3BsaXQoIi4iKTsKICAgICAgY29uc3QgeiA9IHBhcnNlSW50KHBhcnRzWzBdLCAxMCk7CiAgICAgIGNvbnN0IHggPSBwYXJzZUludChwYXJ0c1sxXSwgMTApOwogICAgICBpZiAoTnVtYmVyLmlzTmFOKHgpIHx8IE51bWJlci5pc05hTih6KSkgewogICAgICAgIGNvbnNvbGUud2FybigiSW52YWxpZCB0aWxlIHpvb20gb3IgcG9zaXRpb246IiwgeiwgeCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdmFsaWRUaWxlSWRzLnB1c2godGlsZUlkKTsKICAgICAgdGlsZVByb21pc2VzLnB1c2godGlsZSh1aWQyLCB6LCB4KSk7CiAgICB9CiAgICByZXR1cm4gUHJvbWlzZS5hbGwodGlsZVByb21pc2VzKS50aGVuKCh2YWx1ZXMpID0+IHsKICAgICAgdmFsdWVzLmZvckVhY2goKGQsIGkyKSA9PiB7CiAgICAgICAgY29uc3QgdmFsaWRUaWxlSWQgPSB2YWxpZFRpbGVJZHNbaTJdOwogICAgICAgIHRpbGVzW3ZhbGlkVGlsZUlkXSA9IE9iamVjdC5hc3NpZ24oZCwgeyB0aWxlUG9zaXRpb25JZDogdmFsaWRUaWxlSWQgfSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gdGlsZXM7CiAgICB9KTsKICB9OwogIGNvbnN0IGdldFRhYnVsYXJEYXRhID0gKHVpZDIsIHRpbGVJZHMpID0+IHsKICAgIGNvbnN0IGNvbmZpZyA9IGRhdGFDb25mc1t1aWQyXTsKICAgIGNvbnN0IGFsbFNlZ21lbnRzID0ge307CiAgICBmb3IgKGNvbnN0IHRpbGVJZCBvZiB0aWxlSWRzKSB7CiAgICAgIGNvbnN0IHRpbGVWYWx1ZSA9IHRpbGVWYWx1ZXMuZ2V0KGAke3VpZDJ9LiR7dGlsZUlkfWApOwogICAgICBpZiAoIXRpbGVWYWx1ZSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICgiZXJyb3IiIGluIHRpbGVWYWx1ZSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcih0aWxlVmFsdWUuZXJyb3IpOwogICAgICB9CiAgICAgIGZvciAoY29uc3Qgc2VnbWVudCBvZiB0aWxlVmFsdWUpIHsKICAgICAgICBhbGxTZWdtZW50c1tzZWdtZW50LmlkXSA9IHsKICAgICAgICAgIC4uLnNlZ21lbnQsCiAgICAgICAgICBzdWJzdGl0dXRpb25zOiBKU09OLnN0cmluZ2lmeShzZWdtZW50LnN1YnN0aXR1dGlvbnMpCiAgICAgICAgfTsKICAgICAgfQogICAgfQogICAgY29uc3Qgc2VnbWVudHMgPSBPYmplY3QudmFsdWVzKGFsbFNlZ21lbnRzKTsKICAgIGlmIChjb25maWcubG9hZE1hdGVzKSB7CiAgICAgIGZpbmRNYXRlcyhzZWdtZW50cywgY29uZmlnLm1heEluc2VydFNpemUpOwogICAgfQogICAgbGV0IG91dHB1dDsKICAgIGlmIChjb25maWcuZXh0cmFjdEp1bmN0aW9uKSB7CiAgICAgIG91dHB1dCA9IGZpbmRKdW5jdGlvbnMoc2VnbWVudHMsIGNvbmZpZy5qdW5jdGlvbk1pbkNvdmVyYWdlKTsKICAgIH0gZWxzZSB7CiAgICAgIG91dHB1dCA9IHNlZ21lbnRzOwogICAgfQogICAgY29uc3QgYnVmZmVyMiA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShKU09OLnN0cmluZ2lmeShvdXRwdXQpKS5idWZmZXI7CiAgICByZXR1cm4gVHJhbnNmZXIoYnVmZmVyMiwgW2J1ZmZlcjJdKTsKICB9OwogIGNvbnN0IGdyb3VwQnkgPSAoeHMsIGtleSkgPT4geHMucmVkdWNlKChydiwgeCkgPT4gewogICAgKHJ2W3hba2V5XV0gPSBydlt4W2tleV1dIHx8IFtdKS5wdXNoKHgpOwogICAgcmV0dXJuIHJ2OwogIH0sIHt9KTsKICBjb25zdCBmaW5kTWF0ZXMgPSAoc2VnbWVudHMsIG1heEluc2VydFNpemUgPSAwKSA9PiB7CiAgICBjb25zdCBzZWdtZW50c0J5UmVhZE5hbWUgPSBncm91cEJ5KHNlZ21lbnRzLCAibmFtZSIpOwogICAgT2JqZWN0LnZhbHVlcyhzZWdtZW50c0J5UmVhZE5hbWUpLmZvckVhY2goKHNlZ21lbnRHcm91cCkgPT4gewogICAgICBpZiAoc2VnbWVudEdyb3VwLmxlbmd0aCA9PT0gMikgewogICAgICAgIGNvbnN0IHJlYWQgPSBzZWdtZW50R3JvdXBbMF07CiAgICAgICAgY29uc3QgbWF0ZSA9IHNlZ21lbnRHcm91cFsxXTsKICAgICAgICByZWFkLm1hdGVJZHMgPSBbbWF0ZS5pZF07CiAgICAgICAgbWF0ZS5tYXRlSWRzID0gW3JlYWQuaWRdOwogICAgICAgIGNvbnN0IFtsLCByXSA9IFtyZWFkLCBtYXRlXS5zb3J0KChhLCBiKSA9PiArYS5zdGFydCAtICtiLnN0YXJ0KTsKICAgICAgICBjb25zdCBpbnNlcnRTaXplID0gTWF0aC5tYXgoMCwgK3Iuc3RhcnQgLSArbC5lbmQpOwogICAgICAgIGNvbnN0IGxhcmdlSW5zZXJ0U2l6ZSA9IGluc2VydFNpemUgPj0gbWF4SW5zZXJ0U2l6ZTsKICAgICAgICBsZXQgc3ZUeXBlOwogICAgICAgIGlmICghbGFyZ2VJbnNlcnRTaXplKSB7CiAgICAgICAgICBzdlR5cGUgPSAibm9ybWFsIHJlYWQiOwogICAgICAgIH0gZWxzZSBpZiAobC5zdHJhbmQgPT09ICIrIiAmJiByLnN0cmFuZCA9PT0gIi0iKSB7CiAgICAgICAgICBzdlR5cGUgPSAiZGVsZXRpb24gKCstKSI7CiAgICAgICAgfSBlbHNlIGlmIChsLnN0cmFuZCA9PT0gIisiICYmIHIuc3RyYW5kID09PSAiKyIpIHsKICAgICAgICAgIHN2VHlwZSA9ICJpbnZlcnNpb24gKCsrKSI7CiAgICAgICAgfSBlbHNlIGlmIChsLnN0cmFuZCA9PT0gIi0iICYmIHIuc3RyYW5kID09PSAiLSIpIHsKICAgICAgICAgIHN2VHlwZSA9ICJpbnZlcnNpb24gKC0tKSI7CiAgICAgICAgfSBlbHNlIGlmIChsLnN0cmFuZCA9PT0gIi0iICYmIHIuc3RyYW5kID09PSAiKyIpIHsKICAgICAgICAgIHN2VHlwZSA9ICJkdXBsaWNhdGlvbiAoLSspIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3ZUeXBlID0gYCgke2wuc3RyYW5kfSR7ci5zdHJhbmR9KWA7CiAgICAgICAgfQogICAgICAgIFtyZWFkLCBtYXRlXS5mb3JFYWNoKChkKSA9PiB7CiAgICAgICAgICBkLmZvdW5kTWF0ZSA9IHRydWU7CiAgICAgICAgICBkLmluc2VydFNpemUgPSBpbnNlcnRTaXplOwogICAgICAgICAgZC5sYXJnZUluc2VydFNpemUgPSBsYXJnZUluc2VydFNpemU7CiAgICAgICAgICBkLnN2VHlwZSA9IHN2VHlwZTsKICAgICAgICAgIGQubnVtTWF0ZXMgPSAyOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHNlZ21lbnRHcm91cC5mb3JFYWNoKChkKSA9PiB7CiAgICAgICAgICBkLm1hdGVJZHMgPSBzZWdtZW50R3JvdXAuZmlsdGVyKChtYXRlKSA9PiBtYXRlLmlkICE9PSBkLmlkKS5tYXAoKG1hdGUpID0+IG1hdGUuaWQpOwogICAgICAgICAgZC5mb3VuZE1hdGUgPSBmYWxzZTsKICAgICAgICAgIGQuaW5zZXJ0U2l6ZSA9IC0xOwogICAgICAgICAgZC5sYXJnZUluc2VydFNpemUgPSBmYWxzZTsKICAgICAgICAgIGQuc3ZUeXBlID0gc2VnbWVudEdyb3VwLmxlbmd0aCA9PT0gMSA/ICJtYXRlcyBub3QgZm91bmQgd2l0aGluIGNocm9tb3NvbWUiIDogIm1vcmUgdGhhbiB0d28gbWF0ZXMiOwogICAgICAgICAgZC5udW1NYXRlcyA9IHNlZ21lbnRHcm91cC5sZW5ndGg7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHNlZ21lbnRzQnlSZWFkTmFtZTsKICB9OwogIGNvbnN0IGZpbmRKdW5jdGlvbnMgPSAoc2VnbWVudHMsIG1pbkNvdmVyYWdlID0gMCkgPT4gewogICAgY29uc3QganVuY3Rpb25zID0gW107CiAgICBzZWdtZW50cy5mb3JFYWNoKChzZWdtZW50KSA9PiB7CiAgICAgIGNvbnN0IHN1YnN0aXR1dGlvbnMgPSBKU09OLnBhcnNlKHNlZ21lbnQuc3Vic3RpdHV0aW9ucyk7CiAgICAgIHN1YnN0aXR1dGlvbnMuZm9yRWFjaCgoc3ViKSA9PiB7CiAgICAgICAgY29uc3QgZG9uID0gc2VnbWVudC5zdGFydCArIHN1Yi5wb3M7CiAgICAgICAgY29uc3QgYWNjID0gc2VnbWVudC5zdGFydCArIHN1Yi5wb3MgKyBzdWIubGVuZ3RoOwogICAgICAgIGlmIChzZWdtZW50LnN0YXJ0IDwgZG9uICYmIGFjYyA8IHNlZ21lbnQuZW5kKSB7CiAgICAgICAgICBjb25zdCBqID0ganVuY3Rpb25zLmZpbmQoKGQpID0+IGQuc3RhcnQgPT09IGRvbiAmJiBkLmVuZCA9PT0gYWNjKTsKICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgIGouc2NvcmUgKz0gMTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGp1bmN0aW9ucy5wdXNoKHsgc3RhcnQ6IGRvbiwgZW5kOiBhY2MsIHNjb3JlOiAxIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICAgIHJldHVybiBqdW5jdGlvbnMuZmlsdGVyKChkKSA9PiBkLnNjb3JlID49IG1pbkNvdmVyYWdlKTsKICB9OwogIGNvbnN0IHRpbGVGdW5jdGlvbnMgPSB7CiAgICBpbml0LAogICAgdGlsZXNldEluZm8sCiAgICBmZXRjaFRpbGVzRGVib3VuY2VkLAogICAgdGlsZSwKICAgIGdldFRhYnVsYXJEYXRhCiAgfTsKICBleHBvc2UodGlsZUZ1bmN0aW9ucyk7Cn0pKCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPWFzc2V0cy9iYW0td29ya2VyLjMyZTg0YWVhLmpzLm1hcA==",YZ="undefined"!==typeof window&&window.Blob&&new Blob([atob(HZ)],{type:"text/javascript;charset=utf-8"});function RZ(){var I=YZ&&(window.URL||window.webkitURL).createObjectURL(YZ);try{return I?new Worker(I,{}):new Worker("data:application/javascript;base64,"+HZ,{type:"module"})}finally{I&&(window.URL||window.webkitURL).revokeObjectURL(I)}}var fZ=function(){function I(g,C){var A=this;Object(t.a)(this,I),this.dataConfig=C,this.uid=g.libraries.slugid.nice(),this.assembly="hg38",this.toFetch=new Set,this.worker=Object(eI.a)(new RZ).then(function(){var I=Object(e.a)(Object(i.a)().mark((function I(g){var e,l,o,t,c;return Object(i.a)().wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return t=null!=(e=C.bamUrl)?e:C.url,c=Object(m.a)(Object(m.a)({},C),{},{bamUrl:t,baiUrl:null!=(o=null!=(l=C.baiUrl)?l:C.indexUrl)?o:"".concat(t,".bai")}),I.next=4,g.init(A.uid,c);case 4:return I.abrupt("return",g);case 5:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}())}return Object(c.a)(I,[{key:"tilesetInfo",value:function(){var I=Object(e.a)(Object(i.a)().mark((function I(g){return Object(i.a)().wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.worker;case 2:I.sent.tilesetInfo(this.uid).then(g);case 3:case"end":return I.stop()}}),I,this)})));return function(g){return I.apply(this,arguments)}}()},{key:"fetchTilesDebounced",value:function(I,g){var C,A=this,i=this.toFetch;if(g[0].split(".")[0]!==(i.size?Object(b.a)(i)[0].split(".")[0]:null)){var e,o=Object(l.a)(this.toFetch);try{for(o.s();!(e=o.n()).done;){var t=e.value;null==(C=this.track)||C.fetching.delete(t)}}catch(c){o.e(c)}finally{o.f()}this.toFetch.clear()}g.forEach((function(I){return A.toFetch.add(I)})),this.fetchTimeout&&clearTimeout(this.fetchTimeout),this.fetchTimeout=setTimeout((function(){A.sendFetch(I,Object(b.a)(A.toFetch)),A.toFetch.clear()}),200)}},{key:"sendFetch",value:function(){var I=Object(e.a)(Object(i.a)().mark((function I(g,C){return Object(i.a)().wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.worker;case 2:I.sent.fetchTilesDebounced(this.uid,C).then(g);case 3:case"end":return I.stop()}}),I,this)})));return function(g,C){return I.apply(this,arguments)}}()},{key:"getTabularData",value:function(){var I=Object(e.a)(Object(i.a)().mark((function I(g,C){var A;return Object(i.a)().wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.worker;case 2:return I.next=4,I.sent.getTabularData(g,C);case 4:return A=I.sent,I.abrupt("return",JSON.parse((new TextDecoder).decode(A)));case 6:case"end":return I.stop()}}),I,this)})));return function(g,C){return I.apply(this,arguments)}}()}]),I}(),KZ="KGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgdmNmUmVzZXJ2ZWQgPSB7CiAgICBJbmZvRmllbGRzOiB7CiAgICAgIEFBOiB7IE51bWJlcjogMSwgVHlwZTogIlN0cmluZyIsIERlc2NyaXB0aW9uOiAiQW5jZXN0cmFsIGFsbGVsZSIgfSwKICAgICAgQUM6IHsKICAgICAgICBOdW1iZXI6ICJBIiwKICAgICAgICBUeXBlOiAiSW50ZWdlciIsCiAgICAgICAgRGVzY3JpcHRpb246ICJBbGxlbGUgY291bnQgaW4gZ2Vub3R5cGVzLCBmb3IgZWFjaCBBTFQgYWxsZWxlLCBpbiB0aGUgc2FtZSBvcmRlciBhcyBsaXN0ZWQiCiAgICAgIH0sCiAgICAgIEFEOiB7CiAgICAgICAgTnVtYmVyOiAiUiIsCiAgICAgICAgVHlwZTogIkludGVnZXIiLAogICAgICAgIERlc2NyaXB0aW9uOiAiVG90YWwgcmVhZCBkZXB0aCBmb3IgZWFjaCBhbGxlbGUiCiAgICAgIH0sCiAgICAgIEFERjogewogICAgICAgIE51bWJlcjogIlIiLAogICAgICAgIFR5cGU6ICJJbnRlZ2VyIiwKICAgICAgICBEZXNjcmlwdGlvbjogIlJlYWQgZGVwdGggZm9yIGVhY2ggYWxsZWxlIG9uIHRoZSBmb3J3YXJkIHN0cmFuZCIKICAgICAgfSwKICAgICAgQURSOiB7CiAgICAgICAgTnVtYmVyOiAiUiIsCiAgICAgICAgVHlwZTogIkludGVnZXIiLAogICAgICAgIERlc2NyaXB0aW9uOiAiUmVhZCBkZXB0aCBmb3IgZWFjaCBhbGxlbGUgb24gdGhlIHJldmVyc2Ugc3RyYW5kIgogICAgICB9LAogICAgICBBRjogewogICAgICAgIE51bWJlcjogIkEiLAogICAgICAgIFR5cGU6ICJGbG9hdCIsCiAgICAgICAgRGVzY3JpcHRpb246ICJBbGxlbGUgZnJlcXVlbmN5IGZvciBlYWNoIEFMVCBhbGxlbGUgaW4gdGhlIHNhbWUgb3JkZXIgYXMgbGlzdGVkIChlc3RpbWF0ZWQgZnJvbSBwcmltYXJ5IGRhdGEsIG5vdCBjYWxsZWQgZ2Vub3R5cGVzKSIKICAgICAgfSwKICAgICAgQU46IHsKICAgICAgICBOdW1iZXI6IDEsCiAgICAgICAgVHlwZTogIkludGVnZXIiLAogICAgICAgIERlc2NyaXB0aW9uOiAiVG90YWwgbnVtYmVyIG9mIGFsbGVsZXMgaW4gY2FsbGVkIGdlbm90eXBlcyIKICAgICAgfSwKICAgICAgQlE6IHsKICAgICAgICBOdW1iZXI6IDEsCiAgICAgICAgVHlwZTogIkZsb2F0IiwKICAgICAgICBEZXNjcmlwdGlvbjogIlJNUyBiYXNlIHF1YWxpdHkiCiAgICAgIH0sCiAgICAgIENJR0FSOiB7CiAgICAgICAgTnVtYmVyOiAxLAogICAgICAgIFR5cGU6ICJGbG9hdCIsCiAgICAgICAgRGVzY3JpcHRpb246ICJDaWdhciBzdHJpbmcgZGVzY3JpYmluZyBob3cgdG8gYWxpZ24gYW4gYWx0ZXJuYXRlIGFsbGVsZSB0byB0aGUgcmVmZXJlbmNlIGFsbGVsZSIKICAgICAgfSwKICAgICAgREI6IHsKICAgICAgICBOdW1iZXI6IDAsCiAgICAgICAgVHlwZTogIkZsYWciLAogICAgICAgIERlc2NyaXB0aW9uOiAiZGJTTlAgbWVtYmVyc2hpcCIKICAgICAgfSwKICAgICAgRFA6IHsKICAgICAgICBOdW1iZXI6IDEsCiAgICAgICAgVHlwZTogIkludGVnZXIiLAogICAgICAgIERlc2NyaXB0aW9uOiAiY29tYmluZWQgZGVwdGggYWNyb3NzIHNhbXBsZXMiCiAgICAgIH0sCiAgICAgIEVORDogewogICAgICAgIE51bWJlcjogMSwKICAgICAgICBUeXBlOiAiSW50ZWdlciIsCiAgICAgICAgRGVzY3JpcHRpb246ICJFbmQgcG9zaXRpb24gKGZvciB1c2Ugd2l0aCBzeW1ib2xpYyBhbGxlbGVzKSIKICAgICAgfSwKICAgICAgSDI6IHsKICAgICAgICBOdW1iZXI6IDAsCiAgICAgICAgVHlwZTogIkZsYWciLAogICAgICAgIERlc2NyaXB0aW9uOiAiSGFwTWFwMiBtZW1iZXJzaGlwIgogICAgICB9LAogICAgICBIMzogewogICAgICAgIE51bWJlcjogMCwKICAgICAgICBUeXBlOiAiRmxhZyIsCiAgICAgICAgRGVzY3JpcHRpb246ICJIYXBNYXAzIG1lbWJlcnNoaXAiCiAgICAgIH0sCiAgICAgIE1ROiB7CiAgICAgICAgTnVtYmVyOiAxLAogICAgICAgIFR5cGU6IG51bGwsCiAgICAgICAgRGVzY3JpcHRpb246ICJSTVMgbWFwcGluZyBxdWFsaXR5IgogICAgICB9LAogICAgICBNUTA6IHsKICAgICAgICBOdW1iZXI6IDEsCiAgICAgICAgVHlwZTogIkludGVnZXIiLAogICAgICAgIERlc2NyaXB0aW9uOiAiTnVtYmVyIG9mIE1BUFEgPT0gMCByZWFkcyIKICAgICAgfSwKICAgICAgTlM6IHsKICAgICAgICBOdW1iZXI6IDEsCiAgICAgICAgVHlwZTogIkludGVnZXIiLAogICAgICAgIERlc2NyaXB0aW9uOiAiTnVtYmVyIG9mIHNhbXBsZXMgd2l0aCBkYXRhIgogICAgICB9LAogICAgICBTQjogewogICAgICAgIE51bWJlcjogNCwKICAgICAgICBUeXBlOiAiSW50ZWdlciIsCiAgICAgICAgRGVzY3JpcHRpb246ICJTdHJhbmQgYmlhcyIKICAgICAgfSwKICAgICAgU09NQVRJQzogewogICAgICAgIE51bWJlcjogMCwKICAgICAgICBUeXBlOiAiRmxhZyIsCiAgICAgICAgRGVzY3JpcHRpb246ICJTb21hdGljIG11dGF0aW9uIChmb3IgY2FuY2VyIGdlbm9taWNzKSIKICAgICAgfSwKICAgICAgVkFMSURBVEVEOiB7CiAgICAgICAgTnVtYmVyOiAwLAogICAgICAgIFR5cGU6ICJGbGFnIiwKICAgICAgICBEZXNjcmlwdGlvbjogIlZhbGlkYXRlZCBieSBmb2xsb3ctdXAgZXhwZXJpbWVudCIKICAgICAgfSwKICAgICAgIjEwMDBHIjogewogICAgICAgIE51bWJlcjogMCwKICAgICAgICBUeXBlOiAiRmxhZyIsCiAgICAgICAgRGVzY3JpcHRpb246ICIxMDAwIEdlbm9tZXMgbWVtYmVyc2hpcCIKICAgICAgfSwKICAgICAgSU1QUkVDSVNFOiB7CiAgICAgICAgTnVtYmVyOiAwLAogICAgICAgIFR5cGU6ICJGbGFnIiwKICAgICAgICBEZXNjcmlwdGlvbjogIkltcHJlY2lzZSBzdHJ1Y3R1cmFsIHZhcmlhdGlvbiIKICAgICAgfSwKICAgICAgTk9WRUw6IHsKICAgICAgICBOdW1iZXI6IDAsCiAgICAgICAgVHlwZTogIkZsYWciLAogICAgICAgIERlc2NyaXB0aW9uOiAiSW5kaWNhdGVzIGEgbm92ZWwgc3RydWN0dXJhbCB2YXJpYXRpb24iCiAgICAgIH0sCiAgICAgIFNWVFlQRTogewogICAgICAgIE51bWJlcjogMSwKICAgICAgICBUeXBlOiAiU3RyaW5nIiwKICAgICAgICBEZXNjcmlwdGlvbjogIlR5cGUgb2Ygc3RydWN0dXJhbCB2YXJpYW50IgogICAgICB9LAogICAgICBTVkxFTjogewogICAgICAgIE51bWJlcjogbnVsbCwKICAgICAgICBUeXBlOiAiSW50ZWdlciIsCiAgICAgICAgRGVzY3JpcHRpb246ICJEaWZmZXJlbmNlIGluIGxlbmd0aCBiZXR3ZWVuIFJFRiBhbmQgQUxUIGFsbGVsZXMiCiAgICAgIH0sCiAgICAgIENJUE9TOiB7CiAgICAgICAgTnVtYmVyOiAyLAogICAgICAgIFR5cGU6ICJJbnRlZ2VyIiwKICAgICAgICBEZXNjcmlwdGlvbjogIkNvbmZpZGVuY2UgaW50ZXJ2YWwgYXJvdW5kIFBPUyBmb3IgaW1wcmVjaXNlIHZhcmlhbnRzIgogICAgICB9LAogICAgICBDSUVORDogewogICAgICAgIE51bWJlcjogMiwKICAgICAgICBUeXBlOiAiSW50ZWdlciIsCiAgICAgICAgRGVzY3JpcHRpb246ICJDb25maWRlbmNlIGludGVydmFsIGFyb3VuZCBFTkQgZm9yIGltcHJlY2lzZSB2YXJpYW50cyIKICAgICAgfSwKICAgICAgSE9NTEVOOiB7CiAgICAgICAgVHlwZTogIkludGVnZXIiLAogICAgICAgIERlc2NyaXB0aW9uOiAiTGVuZ3RoIG9mIGJhc2UgcGFpciBpZGVudGljYWwgbWljcm8taG9tb2xvZ3kgYXQgZXZlbnQgYnJlYWtwb2ludHMiCiAgICAgIH0sCiAgICAgIEhPTVNFUTogewogICAgICAgIFR5cGU6ICJTdHJpbmciLAogICAgICAgIERlc2NyaXB0aW9uOiAiU2VxdWVuY2Ugb2YgYmFzZSBwYWlyIGlkZW50aWNhbCBtaWNyby1ob21vbG9neSBhdCBldmVudCBicmVha3BvaW50cyIKICAgICAgfSwKICAgICAgQktQVElEOiB7CiAgICAgICAgVHlwZTogIlN0cmluZyIsCiAgICAgICAgRGVzY3JpcHRpb246ICJJRCBvZiB0aGUgYXNzZW1ibGVkIGFsdGVybmF0ZSBhbGxlbGUgaW4gdGhlIGFzc2VtYmx5IGZpbGUiCiAgICAgIH0sCiAgICAgIE1FSU5GTzogewogICAgICAgIE51bWJlcjogNCwKICAgICAgICBUeXBlOiAiU3RyaW5nIiwKICAgICAgICBEZXNjcmlwdGlvbjogIk1vYmlsZSBlbGVtZW50IGluZm8gb2YgdGhlIGZvcm0gTkFNRSxTVEFSVCxFTkQsUE9MQVJJVFkiCiAgICAgIH0sCiAgICAgIE1FVFJBTlM6IHsKICAgICAgICBOdW1iZXI6IDQsCiAgICAgICAgVHlwZTogIlN0cmluZyIsCiAgICAgICAgRGVzY3JpcHRpb246ICJNb2JpbGUgZWxlbWVudCB0cmFuc2R1Y3Rpb24gaW5mbyBvZiB0aGUgZm9ybSBDSFIsU1RBUlQsRU5ELFBPTEFSSVRZIgogICAgICB9LAogICAgICBER1ZJRDogewogICAgICAgIE51bWJlcjogMSwKICAgICAgICBUeXBlOiAiU3RyaW5nIiwKICAgICAgICBEZXNjcmlwdGlvbjogIklEIG9mIHRoaXMgZWxlbWVudCBpbiBEYXRhYmFzZSBvZiBHZW5vbWljIFZhcmlhdGlvbiIKICAgICAgfSwKICAgICAgREJWQVJJRDogewogICAgICAgIE51bWJlcjogMSwKICAgICAgICBUeXBlOiAiU3RyaW5nIiwKICAgICAgICBEZXNjcmlwdGlvbjogIklEIG9mIHRoaXMgZWxlbWVudCBpbiBEQlZBUiIKICAgICAgfSwKICAgICAgREJSSVBJRDogewogICAgICAgIE51bWJlcjogMSwKICAgICAgICBUeXBlOiAiU3RyaW5nIiwKICAgICAgICBEZXNjcmlwdGlvbjogIklEIG9mIHRoaXMgZWxlbWVudCBpbiBEQlJJUCIKICAgICAgfSwKICAgICAgTUFURUlEOiB7CiAgICAgICAgTnVtYmVyOiBudWxsLAogICAgICAgIFR5cGU6ICJTdHJpbmciLAogICAgICAgIERlc2NyaXB0aW9uOiAiSUQgb2YgbWF0ZSBicmVha2VuZHMiCiAgICAgIH0sCiAgICAgIFBBUklEOiB7CiAgICAgICAgTnVtYmVyOiAxLAogICAgICAgIFR5cGU6ICJTdHJpbmciLAogICAgICAgIERlc2NyaXB0aW9uOiAiSUQgb2YgcGFydG5lciBicmVha2VuZCIKICAgICAgfSwKICAgICAgRVZFTlQ6IHsKICAgICAgICBOdW1iZXI6IDEsCiAgICAgICAgVHlwZTogIlN0cmluZyIsCiAgICAgICAgRGVzY3JpcHRpb246ICJJRCBvZiBldmVudCBhc3NvY2lhdGVkIHRvIGJyZWFrZW5kIgogICAgICB9LAogICAgICBDSUxFTjogewogICAgICAgIE51bWJlcjogMiwKICAgICAgICBUeXBlOiAiSW50ZWdlciIsCiAgICAgICAgRGVzY3JpcHRpb246ICJDb25maWRlbmNlIGludGVydmFsIGFyb3VuZCB0aGUgaW5zZXJ0ZWQgbWF0ZXJpYWwgYmV0d2VlbiBicmVha2VuZCIKICAgICAgfSwKICAgICAgRFBBREo6IHsgVHlwZTogIkludGVnZXIiLCBEZXNjcmlwdGlvbjogIlJlYWQgRGVwdGggb2YgYWRqYWNlbmN5IiB9LAogICAgICBDTjogewogICAgICAgIE51bWJlcjogMSwKICAgICAgICBUeXBlOiAiSW50ZWdlciIsCiAgICAgICAgRGVzY3JpcHRpb246ICJDb3B5IG51bWJlciBvZiBzZWdtZW50IGNvbnRhaW5pbmcgYnJlYWtlbmQiCiAgICAgIH0sCiAgICAgIENOQURKOiB7CiAgICAgICAgTnVtYmVyOiBudWxsLAogICAgICAgIFR5cGU6ICJJbnRlZ2VyIiwKICAgICAgICBEZXNjcmlwdGlvbjogIkNvcHkgbnVtYmVyIG9mIGFkamFjZW5jeSIKICAgICAgfSwKICAgICAgQ0lDTjogewogICAgICAgIE51bWJlcjogMiwKICAgICAgICBUeXBlOiAiSW50ZWdlciIsCiAgICAgICAgRGVzY3JpcHRpb246ICJDb25maWRlbmNlIGludGVydmFsIGFyb3VuZCBjb3B5IG51bWJlciBmb3IgdGhlIHNlZ21lbnQiCiAgICAgIH0sCiAgICAgIENJQ05BREo6IHsKICAgICAgICBOdW1iZXI6IG51bGwsCiAgICAgICAgVHlwZTogIkludGVnZXIiLAogICAgICAgIERlc2NyaXB0aW9uOiAiQ29uZmlkZW5jZSBpbnRlcnZhbCBhcm91bmQgY29weSBudW1iZXIgZm9yIHRoZSBhZGphY2VuY3kiCiAgICAgIH0KICAgIH0sCiAgICBHZW5vdHlwZUZpZWxkczogewogICAgICBBRDogewogICAgICAgIE51bWJlcjogIlIiLAogICAgICAgIFR5cGU6ICJJbnRlZ2VyIiwKICAgICAgICBEZXNjcmlwdGlvbjogIlJlYWQgZGVwdGggZm9yIGVhY2ggYWxsZWxlIgogICAgICB9LAogICAgICBBREY6IHsKICAgICAgICBOdW1iZXI6ICJSIiwKICAgICAgICBUeXBlOiAiSW50ZWdlciIsCiAgICAgICAgRGVzY3JpcHRpb246ICJSZWFkIGRlcHRoIGZvciBlYWNoIGFsbGVsZSBvbiB0aGUgZm9yd2FyZCBzdHJhbmQiCiAgICAgIH0sCiAgICAgIEFEUjogewogICAgICAgIE51bWJlcjogIlIiLAogICAgICAgIFR5cGU6ICJJbnRlZ2VyIiwKICAgICAgICBEZXNjcmlwdGlvbjogIlJlYWQgZGVwdGggZm9yIGVhY2ggYWxsZWxlIG9uIHRoZSByZXZlcnNlIHN0cmFuZCIKICAgICAgfSwKICAgICAgRFA6IHsKICAgICAgICBOdW1iZXI6IDEsCiAgICAgICAgVHlwZTogIkludGVnZXIiLAogICAgICAgIERlc2NyaXB0aW9uOiAiUmVhZCBkZXB0aCIKICAgICAgfSwKICAgICAgRUM6IHsKICAgICAgICBOdW1iZXI6ICJBIiwKICAgICAgICBUeXBlOiAiSW50ZWdlciIsCiAgICAgICAgRGVzY3JpcHRpb246ICJFeHBlY3RlZCBhbHRlcm5hdGUgYWxsZWxlIGNvdW50cyIKICAgICAgfSwKICAgICAgRlQ6IHsKICAgICAgICBOdW1iZXI6IDEsCiAgICAgICAgVHlwZTogIlN0cmluZyIsCiAgICAgICAgRGVzY3JpcHRpb246ICdGaWx0ZXIgaW5kaWNhdGluZyBpZiB0aGlzIGdlbm90eXBlIHdhcyAiY2FsbGVkIicKICAgICAgfSwKICAgICAgR0w6IHsKICAgICAgICBOdW1iZXI6ICJHIiwKICAgICAgICBUeXBlOiAiRmxvYXQiLAogICAgICAgIERlc2NyaXB0aW9uOiAiR2Vub3R5cGUgbGlrZWxpaG9vZHMiCiAgICAgIH0sCiAgICAgIEdQOiB7CiAgICAgICAgTnVtYmVyOiAiRyIsCiAgICAgICAgVHlwZTogIkZsb2F0IiwKICAgICAgICBEZXNjcmlwdGlvbjogIkdlbm90eXBlIHBvc3RlcmlvciBwcm9iYWJpbGl0aWVzIgogICAgICB9LAogICAgICBHUTogewogICAgICAgIE51bWJlcjogMSwKICAgICAgICBUeXBlOiAiSW50ZWdlciIsCiAgICAgICAgRGVzY3JpcHRpb246ICJDb25kaXRpb25hbCBnZW5vdHlwZSBxdWFsaXR5IgogICAgICB9LAogICAgICBHVDogewogICAgICAgIE51bWJlcjogMSwKICAgICAgICBUeXBlOiAiU3RyaW5nIiwKICAgICAgICBEZXNjcmlwdGlvbjogIkdlbm90eXBlIgogICAgICB9LAogICAgICBIUTogewogICAgICAgIE51bWJlcjogMiwKICAgICAgICBUeXBlOiAiSW50ZWdlciIsCiAgICAgICAgRGVzY3JpcHRpb246ICJIYXBsb3R5cGUgcXVhbGl0eSIKICAgICAgfSwKICAgICAgTVE6IHsKICAgICAgICBOdW1iZXI6IDEsCiAgICAgICAgVHlwZTogIkludGVnZXIiLAogICAgICAgIERlc2NyaXB0aW9uOiAiUk1TIG1hcHBpbmcgcXVhbGl0eSIKICAgICAgfSwKICAgICAgUEw6IHsKICAgICAgICBOdW1iZXI6ICJHIiwKICAgICAgICBUeXBlOiAiSW50ZWdlciIsCiAgICAgICAgRGVzY3JpcHRpb246ICJQaHJlZC1zY2FsZWQgZ2Vub3R5cGUgbGlrZWxpaG9vZHMgcm91bmRlZCB0byB0aGUgY2xvc2VzdCBpbnRlZ2VyIgogICAgICB9LAogICAgICBQUTogewogICAgICAgIE51bWJlcjogMSwKICAgICAgICBUeXBlOiAiSW50ZWdlciIsCiAgICAgICAgRGVzY3JpcHRpb246ICJQaGFzaW5nIHF1YWxpdHkiCiAgICAgIH0sCiAgICAgIFBTOiB7CiAgICAgICAgTnVtYmVyOiAxLAogICAgICAgIFR5cGU6ICJJbnRlZ2VyIiwKICAgICAgICBEZXNjcmlwdGlvbjogIlBoYXNlIHNldCIKICAgICAgfQogICAgfSwKICAgIEFsdFR5cGVzOiB7CiAgICAgIERFTDogewogICAgICAgIERlc2NyaXB0aW9uOiAiRGVsZXRpb24gcmVsYXRpdmUgdG8gdGhlIHJlZmVyZW5jZSIKICAgICAgfSwKICAgICAgSU5TOiB7CiAgICAgICAgRGVzY3JpcHRpb246ICJJbnNlcnRpb24gb2Ygbm92ZWwgc2VxdWVuY2UgcmVsYXRpdmUgdG8gdGhlIHJlZmVyZW5jZSIKICAgICAgfSwKICAgICAgRFVQOiB7CiAgICAgICAgRGVzY3JpcHRpb246ICJSZWdpb24gb2YgZWxldmF0ZWQgY29weSBudW1iZXIgcmVsYXRpdmUgdG8gdGhlIHJlZmVyZW5jZSIKICAgICAgfSwKICAgICAgSU5WOiB7CiAgICAgICAgRGVzY3JpcHRpb246ICJJbnZlcnNpb24gb2YgcmVmZXJlbmNlIHNlcXVlbmNlIgogICAgICB9LAogICAgICBDTlY6IHsKICAgICAgICBEZXNjcmlwdGlvbjogIkNvcHkgbnVtYmVyIHZhcmlhYmxlIHJlZ2lvbiAobWF5IGJlIGJvdGggZGVsZXRpb24gYW5kIGR1cGxpY2F0aW9uKSIKICAgICAgfSwKICAgICAgIkRVUDpUQU5ERU0iOiB7CiAgICAgICAgRGVzY3JpcHRpb246ICJUYW5kZW0gZHVwbGljYXRpb24iCiAgICAgIH0sCiAgICAgICJERUw6TUUiOiB7CiAgICAgICAgRGVzY3JpcHRpb246ICJEZWxldGlvbiBvZiBtb2JpbGUgZWxlbWVudCByZWxhdGl2ZSB0byB0aGUgcmVmZXJlbmNlIgogICAgICB9LAogICAgICAiSU5TOk1FIjogewogICAgICAgIERlc2NyaXB0aW9uOiAiSW5zZXJ0aW9uIG9mIGEgbW9iaWxlIGVsZW1lbnQgcmVsYXRpdmUgdG8gdGhlIHJlZmVyZW5jZSIKICAgICAgfSwKICAgICAgTk9OX1JFRjogewogICAgICAgIERlc2NyaXB0aW9uOiAiUmVwcmVzZW50cyBhbnkgcG9zc2libGUgYWx0ZXJuYXRpdmUgYWxsZWxlIGF0IHRoaXMgbG9jYXRpb24iCiAgICAgIH0sCiAgICAgICIqIjogewogICAgICAgIERlc2NyaXB0aW9uOiAiUmVwcmVzZW50cyBhbnkgcG9zc2libGUgYWx0ZXJuYXRpdmUgYWxsZWxlIGF0IHRoaXMgbG9jYXRpb24iCiAgICAgIH0KICAgIH0sCiAgICBGaWx0ZXJUeXBlczogewogICAgICBQQVNTOiB7CiAgICAgICAgRGVzY3JpcHRpb246ICJQYXNzZWQgYWxsIGZpbHRlcnMiCiAgICAgIH0KICAgIH0KICB9OwogIGZ1bmN0aW9uIFZhcmlhbnQoc3R1ZmYpIHsKICAgIE9iamVjdC5hc3NpZ24odGhpcywgc3R1ZmYpOwogIH0KICBmdW5jdGlvbiBkZWNvZGVVUklDb21wb25lbnROb1Rocm93KHVyaSkgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudCh1cmkpOwogICAgfSBjYXRjaCAoZSkgewogICAgICByZXR1cm4gdXJpOwogICAgfQogIH0KICBjbGFzcyBWQ0YgewogICAgY29uc3RydWN0b3IoeyBoZWFkZXIgPSAiIiwgc3RyaWN0ID0gdHJ1ZSB9KSB7CiAgICAgIGlmICghaGVhZGVyIHx8ICFoZWFkZXIubGVuZ3RoKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJlbXB0eSBoZWFkZXIgcmVjZWl2ZWQiKTsKICAgICAgfQogICAgICBjb25zdCBoZWFkZXJMaW5lcyA9IGhlYWRlci5zcGxpdCgvW1xyXG5dKy8pLmZpbHRlcigobGluZSkgPT4gbGluZSk7CiAgICAgIGlmICghaGVhZGVyTGluZXMubGVuZ3RoKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJubyBub24tZW1wdHkgaGVhZGVyIGxpbmVzIHNwZWNpZmllZCIpOwogICAgICB9CiAgICAgIHRoaXMuc3RyaWN0ID0gc3RyaWN0OwogICAgICB0aGlzLm1ldGFkYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgSU5GTzogdmNmUmVzZXJ2ZWQuSW5mb0ZpZWxkcywKICAgICAgICBGT1JNQVQ6IHZjZlJlc2VydmVkLkdlbm90eXBlRmllbGRzLAogICAgICAgIEFMVDogdmNmUmVzZXJ2ZWQuQWx0VHlwZXMsCiAgICAgICAgRklMVEVSOiB2Y2ZSZXNlcnZlZC5GaWx0ZXJUeXBlcwogICAgICB9KSk7CiAgICAgIGxldCBsYXN0TGluZTsKICAgICAgaGVhZGVyTGluZXMuZm9yRWFjaCgobGluZSkgPT4gewogICAgICAgIGlmICghbGluZS5zdGFydHNXaXRoKCIjIikpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQmFkIGxpbmUgaW4gaGVhZGVyOgoke2xpbmV9YCk7CiAgICAgICAgfSBlbHNlIGlmIChsaW5lLnN0YXJ0c1dpdGgoIiMjIikpIHsKICAgICAgICAgIHRoaXMuX3BhcnNlTWV0YWRhdGEobGluZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxhc3RMaW5lID0gbGluZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBpZiAoIWxhc3RMaW5lKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBmb3JtYXQgbGluZSBmb3VuZCBpbiBoZWFkZXIiKTsKICAgICAgfQogICAgICBjb25zdCBmaWVsZHMgPSBsYXN0TGluZS50cmltKCkuc3BsaXQoIgkiKTsKICAgICAgY29uc3QgdGhpc0hlYWRlciA9IGZpZWxkcy5zbGljZSgwLCA4KTsKICAgICAgY29uc3QgY29ycmVjdEhlYWRlciA9IFsKICAgICAgICAiI0NIUk9NIiwKICAgICAgICAiUE9TIiwKICAgICAgICAiSUQiLAogICAgICAgICJSRUYiLAogICAgICAgICJBTFQiLAogICAgICAgICJRVUFMIiwKICAgICAgICAiRklMVEVSIiwKICAgICAgICAiSU5GTyIKICAgICAgXTsKICAgICAgaWYgKGZpZWxkcy5sZW5ndGggPCA4KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBWQ0YgaGVhZGVyIG1pc3NpbmcgY29sdW1uczoKJHtsYXN0TGluZX1gKTsKICAgICAgfSBlbHNlIGlmIChmaWVsZHMubGVuZ3RoID09PSA5KSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBWQ0YgaGVhZGVyIGhhcyBGT1JNQVQgYnV0IG5vIHNhbXBsZXM6CiR7bGFzdExpbmV9YCk7CiAgICAgIH0gZWxzZSBpZiAodGhpc0hlYWRlci5sZW5ndGggIT09IGNvcnJlY3RIZWFkZXIubGVuZ3RoIHx8ICF0aGlzSGVhZGVyLmV2ZXJ5KCh2YWx1ZSwgaW5kZXgpID0+IHZhbHVlID09PSBjb3JyZWN0SGVhZGVyW2luZGV4XSkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZDRiBjb2x1bW4gaGVhZGVycyBub3QgY29ycmVjdDoKJHtsYXN0TGluZX1gKTsKICAgICAgfQogICAgICB0aGlzLnNhbXBsZXMgPSBmaWVsZHMuc2xpY2UoOSk7CiAgICB9CiAgICBfcGFyc2VHZW5vdHlwZXMoZm9ybWF0LCBwcmVyZXN0KSB7CiAgICAgIGNvbnN0IHJlc3QgPSBwcmVyZXN0LnNwbGl0KCIJIik7CiAgICAgIGNvbnN0IGdlbm90eXBlcyA9IHt9OwogICAgICBjb25zdCBmb3JtYXRLZXlzID0gZm9ybWF0ID09PSBudWxsIHx8IGZvcm1hdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZm9ybWF0LnNwbGl0KCI6Iik7CiAgICAgIGlmIChmb3JtYXRLZXlzKSB7CiAgICAgICAgdGhpcy5zYW1wbGVzLmZvckVhY2goKHNhbXBsZSwgaW5kZXgpID0+IHsKICAgICAgICAgIGdlbm90eXBlc1tzYW1wbGVdID0ge307CiAgICAgICAgICBmb3JtYXRLZXlzLmZvckVhY2goKGtleSkgPT4gewogICAgICAgICAgICBnZW5vdHlwZXNbc2FtcGxlXVtrZXldID0gbnVsbDsKICAgICAgICAgIH0pOwogICAgICAgICAgcmVzdFtpbmRleF0uc3BsaXQoIjoiKS5maWx0ZXIoKGYpID0+IGYpLmZvckVhY2goKHZhbCwgaW5kZXgyKSA9PiB7CiAgICAgICAgICAgIGxldCB0aGlzVmFsdWU7CiAgICAgICAgICAgIGlmICh2YWwgPT09ICIiIHx8IHZhbCA9PT0gIi4iIHx8IHZhbCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgdGhpc1ZhbHVlID0gbnVsbDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjb25zdCBlbnRyaWVzID0gdmFsLnNwbGl0KCIsIikubWFwKChlbnQpID0+IGVudCA9PT0gIi4iID8gbnVsbCA6IGVudCk7CiAgICAgICAgICAgICAgY29uc3QgdmFsdWVUeXBlID0gdGhpcy5nZXRNZXRhZGF0YSgiRk9STUFUIiwgZm9ybWF0S2V5c1tpbmRleDJdLCAiVHlwZSIpOwogICAgICAgICAgICAgIGlmICh2YWx1ZVR5cGUgPT09ICJJbnRlZ2VyIiB8fCB2YWx1ZVR5cGUgPT09ICJGbG9hdCIpIHsKICAgICAgICAgICAgICAgIHRoaXNWYWx1ZSA9IGVudHJpZXMubWFwKCh2YWwyKSA9PiB2YWwyID8gK3ZhbDIgOiB2YWwyKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpc1ZhbHVlID0gZW50cmllczsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2Vub3R5cGVzW3NhbXBsZV1bZm9ybWF0S2V5c1tpbmRleDJdXSA9IHRoaXNWYWx1ZTsKICAgICAgICAgIH0sIHt9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgICByZXR1cm4gZ2Vub3R5cGVzOwogICAgfQogICAgX3BhcnNlTWV0YWRhdGEobGluZSkgewogICAgICBjb25zdCBtYXRjaCA9IGxpbmUudHJpbSgpLm1hdGNoKC9eIyMoLis/KT0oLiopLyk7CiAgICAgIGlmICghbWF0Y2gpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYExpbmUgaXMgbm90IGEgdmFsaWQgbWV0YWRhdGEgbGluZTogJHtsaW5lfWApOwogICAgICB9CiAgICAgIGNvbnN0IFttZXRhS2V5LCBtZXRhVmFsXSA9IG1hdGNoLnNsaWNlKDEsIDMpOwogICAgICBpZiAobWV0YVZhbC5zdGFydHNXaXRoKCI8IikpIHsKICAgICAgICBpZiAoIShtZXRhS2V5IGluIHRoaXMubWV0YWRhdGEpKSB7CiAgICAgICAgICB0aGlzLm1ldGFkYXRhW21ldGFLZXldID0ge307CiAgICAgICAgfQogICAgICAgIGNvbnN0IFtpZCwga2V5VmFsc10gPSB0aGlzLl9wYXJzZVN0cnVjdHVyZWRNZXRhVmFsKG1ldGFWYWwpOwogICAgICAgIHRoaXMubWV0YWRhdGFbbWV0YUtleV1baWRdID0ga2V5VmFsczsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm1ldGFkYXRhW21ldGFLZXldID0gbWV0YVZhbDsKICAgICAgfQogICAgfQogICAgX3BhcnNlU3RydWN0dXJlZE1ldGFWYWwobWV0YVZhbCkgewogICAgICBjb25zdCBrZXlWYWxzID0gdGhpcy5fcGFyc2VLZXlWYWx1ZShtZXRhVmFsLnJlcGxhY2UoL148fD4kL2csICIiKSwgIiwiKTsKICAgICAgY29uc3QgaWQgPSBrZXlWYWxzLklEOwogICAgICBkZWxldGUga2V5VmFscy5JRDsKICAgICAgaWYgKCJOdW1iZXIiIGluIGtleVZhbHMpIHsKICAgICAgICBpZiAoIU51bWJlci5pc05hTihOdW1iZXIoa2V5VmFscy5OdW1iZXIpKSkgewogICAgICAgICAga2V5VmFscy5OdW1iZXIgPSBOdW1iZXIoa2V5VmFscy5OdW1iZXIpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gW2lkLCBrZXlWYWxzXTsKICAgIH0KICAgIGdldE1ldGFkYXRhKC4uLmFyZ3MpIHsKICAgICAgbGV0IGZpbHRlcmVkTWV0YWRhdGEgPSB0aGlzLm1ldGFkYXRhOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICBmaWx0ZXJlZE1ldGFkYXRhID0gZmlsdGVyZWRNZXRhZGF0YVthcmdzW2ldXTsKICAgICAgICBpZiAoIWZpbHRlcmVkTWV0YWRhdGEpIHsKICAgICAgICAgIHJldHVybiBmaWx0ZXJlZE1ldGFkYXRhOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZmlsdGVyZWRNZXRhZGF0YTsKICAgIH0KICAgIF9wYXJzZUtleVZhbHVlKHN0ciwgcGFpclNlcGFyYXRvciA9ICI7IikgewogICAgICBjb25zdCBkYXRhID0ge307CiAgICAgIGxldCBjdXJyS2V5ID0gIiI7CiAgICAgIGxldCBjdXJyVmFsdWUgPSAiIjsKICAgICAgbGV0IHN0YXRlID0gMTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICBpZiAoc3RhdGUgPT09IDEpIHsKICAgICAgICAgIGlmIChzdHJbaV0gPT09ICI9IikgewogICAgICAgICAgICBzdGF0ZSA9IDI7CiAgICAgICAgICB9IGVsc2UgaWYgKHN0cltpXSAhPT0gcGFpclNlcGFyYXRvcikgewogICAgICAgICAgICBjdXJyS2V5ICs9IHN0cltpXTsKICAgICAgICAgIH0gZWxzZSBpZiAoY3VyclZhbHVlID09PSAiIikgewogICAgICAgICAgICBkYXRhW2N1cnJLZXldID0gbnVsbDsKICAgICAgICAgICAgY3VycktleSA9ICIiOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoc3RhdGUgPT09IDIpIHsKICAgICAgICAgIGlmIChzdHJbaV0gPT09IHBhaXJTZXBhcmF0b3IpIHsKICAgICAgICAgICAgZGF0YVtjdXJyS2V5XSA9IGN1cnJWYWx1ZTsKICAgICAgICAgICAgY3VycktleSA9ICIiOwogICAgICAgICAgICBjdXJyVmFsdWUgPSAiIjsKICAgICAgICAgICAgc3RhdGUgPSAxOwogICAgICAgICAgfSBlbHNlIGlmIChzdHJbaV0gPT09ICciJykgewogICAgICAgICAgICBzdGF0ZSA9IDM7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdXJyVmFsdWUgKz0gc3RyW2ldOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoc3RhdGUgPT09IDMpIHsKICAgICAgICAgIGlmIChzdHJbaV0gIT09ICciJykgewogICAgICAgICAgICBjdXJyVmFsdWUgKz0gc3RyW2ldOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhdGUgPSAyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc3RhdGUgPT09IDIgfHwgc3RhdGUgPT09IDMpIHsKICAgICAgICBkYXRhW2N1cnJLZXldID0gY3VyclZhbHVlOwogICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAxKSB7CiAgICAgICAgZGF0YVtjdXJyS2V5XSA9IG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICBwYXJzZUxpbmUobGluZSkgewogICAgICBsaW5lID0gbGluZS50cmltKCk7CiAgICAgIGlmICghbGluZS5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gdm9pZCAwOwogICAgICB9CiAgICAgIGNvbnN0IHBhcnNlciA9IHRoaXM7CiAgICAgIGxldCBjdXJyQ2hhciA9IDA7CiAgICAgIGZvciAobGV0IGN1cnJGaWVsZCA9IDA7IGN1cnJDaGFyIDwgbGluZS5sZW5ndGg7IGN1cnJDaGFyICs9IDEpIHsKICAgICAgICBpZiAobGluZVtjdXJyQ2hhcl0gPT09ICIJIikgewogICAgICAgICAgY3VyckZpZWxkICs9IDE7CiAgICAgICAgfQogICAgICAgIGlmIChjdXJyRmllbGQgPT09IDkpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBmaWVsZHMgPSBsaW5lLnN1YnN0cigwLCBjdXJyQ2hhcikuc3BsaXQoIgkiKTsKICAgICAgY29uc3QgcmVzdCA9IGxpbmUuc3Vic3RyKGN1cnJDaGFyICsgMSk7CiAgICAgIGNvbnN0IFtDSFJPTSwgUE9TLCBJRCwgUkVGLCBBTFQsIFFVQUwsIEZJTFRFUl0gPSBmaWVsZHM7CiAgICAgIGNvbnN0IGNocm9tID0gQ0hST007CiAgICAgIGNvbnN0IHBvcyA9ICtQT1M7CiAgICAgIGNvbnN0IGlkID0gSUQgPT09ICIuIiA/IG51bGwgOiBJRC5zcGxpdCgiOyIpOwogICAgICBjb25zdCByZWYgPSBSRUY7CiAgICAgIGNvbnN0IGFsdCA9IEFMVCA9PT0gIi4iID8gbnVsbCA6IEFMVC5zcGxpdCgiLCIpOwogICAgICBjb25zdCBxdWFsID0gUVVBTCA9PT0gIi4iID8gbnVsbCA6ICtRVUFMOwogICAgICBjb25zdCBmaWx0ZXIgPSBGSUxURVIgPT09ICIuIiA/IG51bGwgOiBGSUxURVIuc3BsaXQoIjsiKTsKICAgICAgaWYgKHRoaXMuc3RyaWN0ICYmIGZpZWxkc1s3XSA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJubyBJTkZPIGZpZWxkIHNwZWNpZmllZCwgbXVzdCBjb250YWluIGF0IGxlYXN0IGEgJy4nICh0dXJuIG9mZiBzdHJpY3QgbW9kZSB0byBhbGxvdykiKTsKICAgICAgfQogICAgICBjb25zdCBpbmZvID0gZmllbGRzWzddID09PSB2b2lkIDAgfHwgZmllbGRzWzddID09PSAiLiIgPyB7fSA6IHRoaXMuX3BhcnNlS2V5VmFsdWUoZmllbGRzWzddKTsKICAgICAgT2JqZWN0LmtleXMoaW5mbykuZm9yRWFjaCgoa2V5KSA9PiB7CiAgICAgICAgbGV0IGl0ZW1zOwogICAgICAgIGlmIChpbmZvW2tleV0pIHsKICAgICAgICAgIGl0ZW1zID0gaW5mb1trZXldLnNwbGl0KCIsIikubWFwKCh2YWwpID0+IHZhbCA9PT0gIi4iID8gbnVsbCA6IHZhbCkubWFwKChmKSA9PiBmID8gZGVjb2RlVVJJQ29tcG9uZW50Tm9UaHJvdyhmKSA6IGYpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpdGVtcyA9IGluZm9ba2V5XTsKICAgICAgICB9CiAgICAgICAgY29uc3QgaXRlbVR5cGUgPSB0aGlzLmdldE1ldGFkYXRhKCJJTkZPIiwga2V5LCAiVHlwZSIpOwogICAgICAgIGlmIChpdGVtVHlwZSkgewogICAgICAgICAgaWYgKGl0ZW1UeXBlID09PSAiSW50ZWdlciIgfHwgaXRlbVR5cGUgPT09ICJGbG9hdCIpIHsKICAgICAgICAgICAgaXRlbXMgPSBpdGVtcy5tYXAoKHZhbCkgPT4gewogICAgICAgICAgICAgIGlmICh2YWwgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gTnVtYmVyKHZhbCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChpdGVtVHlwZSA9PT0gIkZsYWciKSB7CiAgICAgICAgICAgIGlmIChpbmZvW2tleV0pIHsKICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYEluZm8gZmllbGQgJHtrZXl9IGlzIGEgRmxhZyBhbmQgc2hvdWxkIG5vdCBoYXZlIGEgdmFsdWUgKGdvdCB2YWx1ZSAke2luZm9ba2V5XX0pYCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaXRlbXMgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGluZm9ba2V5XSA9IGl0ZW1zOwogICAgICB9KTsKICAgICAgY29uc3QgdmFyaWFudCA9IG5ldyBWYXJpYW50KHsKICAgICAgICBDSFJPTTogY2hyb20sCiAgICAgICAgUE9TOiBwb3MsCiAgICAgICAgQUxUOiBhbHQsCiAgICAgICAgSU5GTzogaW5mbywKICAgICAgICBSRUY6IHJlZiwKICAgICAgICBGSUxURVI6IGZpbHRlciAmJiBmaWx0ZXIubGVuZ3RoID09PSAxICYmIGZpbHRlclswXSA9PT0gIlBBU1MiID8gIlBBU1MiIDogZmlsdGVyLAogICAgICAgIElEOiBpZCwKICAgICAgICBRVUFMOiBxdWFsCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodmFyaWFudCwgIlNBTVBMRVMiLCB7CiAgICAgICAgZ2V0KCkgewogICAgICAgICAgY29uc3Qgc2FtcGxlcyA9IHBhcnNlci5fcGFyc2VHZW5vdHlwZXMoZmllbGRzWzhdLCByZXN0KTsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiU0FNUExFUyIsIHsKICAgICAgICAgICAgdmFsdWU6IHNhbXBsZXMsCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIHNhbXBsZXM7CiAgICAgICAgfSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIHJldHVybiB2YXJpYW50OwogICAgfQogIH0KICB2YXIgY29tbW9uanNHbG9iYWwgPSB0eXBlb2YgZ2xvYmFsVGhpcyAhPT0gInVuZGVmaW5lZCIgPyBnbG9iYWxUaGlzIDogdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB0eXBlb2YgZ2xvYmFsICE9PSAidW5kZWZpbmVkIiA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIiA/IHNlbGYgOiB7fTsKICBmdW5jdGlvbiBnZXREZWZhdWx0RXhwb3J0RnJvbUNqcyh4KSB7CiAgICByZXR1cm4geCAmJiB4Ll9fZXNNb2R1bGUgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICJkZWZhdWx0IikgPyB4WyJkZWZhdWx0Il0gOiB4OwogIH0KICBmdW5jdGlvbiBnZXRBdWdtZW50ZWROYW1lc3BhY2UobikgewogICAgaWYgKG4uX19lc01vZHVsZSkKICAgICAgcmV0dXJuIG47CiAgICB2YXIgYSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgT2JqZWN0LmtleXMobikuZm9yRWFjaChmdW5jdGlvbihrKSB7CiAgICAgIHZhciBkID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihuLCBrKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGEsIGssIGQuZ2V0ID8gZCA6IHsKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gbltrXTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgICByZXR1cm4gYTsKICB9CiAgdmFyIGVzbSA9IHt9OwogIHZhciBBYm9ydGFibGVQcm9taXNlQ2FjaGUkMSA9IHt9OwogIHZhciBhYm9ydGNvbnRyb2xsZXJQb255ZmlsbCA9IHt9OwogIHZhciBjanNQb255ZmlsbCA9IHt9OwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjanNQb255ZmlsbCwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICAgIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgfQogIH0KICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKQogICAgICAgIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgICB9CiAgfQogIGZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICAgIGlmIChwcm90b1Byb3BzKQogICAgICBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogICAgaWYgKHN0YXRpY1Byb3BzKQogICAgICBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogICAgcmV0dXJuIENvbnN0cnVjdG9yOwogIH0KICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICAgIGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgICB9CiAgICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsKICAgICAgY29uc3RydWN0b3I6IHsKICAgICAgICB2YWx1ZTogc3ViQ2xhc3MsCiAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0KICAgIH0pOwogICAgaWYgKHN1cGVyQ2xhc3MpCiAgICAgIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7CiAgfQogIGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YyKG8yKSB7CiAgICAgIHJldHVybiBvMi5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8yKTsKICAgIH07CiAgICByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOwogIH0KICBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogICAgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZjIobzIsIHAyKSB7CiAgICAgIG8yLl9fcHJvdG9fXyA9IHAyOwogICAgICByZXR1cm4gbzI7CiAgICB9OwogICAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKICB9CiAgZnVuY3Rpb24gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpIHsKICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KQogICAgICByZXR1cm4gZmFsc2U7CiAgICBpZiAoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSkKICAgICAgcmV0dXJuIGZhbHNlOwogICAgaWYgKHR5cGVvZiBQcm94eSA9PT0gImZ1bmN0aW9uIikKICAgICAgcmV0dXJuIHRydWU7CiAgICB0cnkgewogICAgICBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uKCkgewogICAgICB9KSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSBjYXRjaCAoZSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQogIGZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZjIpIHsKICAgIGlmIChzZWxmMiA9PT0gdm9pZCAwKSB7CiAgICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgICB9CiAgICByZXR1cm4gc2VsZjI7CiAgfQogIGZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYyLCBjYWxsKSB7CiAgICBpZiAoY2FsbCAmJiAodHlwZW9mIGNhbGwgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgewogICAgICByZXR1cm4gY2FsbDsKICAgIH0KICAgIHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYyKTsKICB9CiAgZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHsKICAgIHZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpOwogICAgcmV0dXJuIGZ1bmN0aW9uIF9jcmVhdGVTdXBlckludGVybmFsKCkgewogICAgICB2YXIgU3VwZXIgPSBfZ2V0UHJvdG90eXBlT2YoRGVyaXZlZCksIHJlc3VsdDsKICAgICAgaWYgKGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QpIHsKICAgICAgICB2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOwogICAgICAgIHJlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0ID0gU3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgcmVzdWx0KTsKICAgIH07CiAgfQogIGZ1bmN0aW9uIF9zdXBlclByb3BCYXNlKG9iamVjdCwgcHJvcGVydHkpIHsKICAgIHdoaWxlICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpKSB7CiAgICAgIG9iamVjdCA9IF9nZXRQcm90b3R5cGVPZihvYmplY3QpOwogICAgICBpZiAob2JqZWN0ID09PSBudWxsKQogICAgICAgIGJyZWFrOwogICAgfQogICAgcmV0dXJuIG9iamVjdDsKICB9CiAgZnVuY3Rpb24gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlcikgewogICAgaWYgKHR5cGVvZiBSZWZsZWN0ICE9PSAidW5kZWZpbmVkIiAmJiBSZWZsZWN0LmdldCkgewogICAgICBfZ2V0ID0gUmVmbGVjdC5nZXQ7CiAgICB9IGVsc2UgewogICAgICBfZ2V0ID0gZnVuY3Rpb24gX2dldDIodGFyZ2V0MiwgcHJvcGVydHkyLCByZWNlaXZlcjIpIHsKICAgICAgICB2YXIgYmFzZSA9IF9zdXBlclByb3BCYXNlKHRhcmdldDIsIHByb3BlcnR5Mik7CiAgICAgICAgaWYgKCFiYXNlKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihiYXNlLCBwcm9wZXJ0eTIpOwogICAgICAgIGlmIChkZXNjLmdldCkgewogICAgICAgICAgcmV0dXJuIGRlc2MuZ2V0LmNhbGwocmVjZWl2ZXIyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRlc2MudmFsdWU7CiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlciB8fCB0YXJnZXQpOwogIH0KICB2YXIgRW1pdHRlciA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIEVtaXR0ZXIyKCkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRW1pdHRlcjIpOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgImxpc3RlbmVycyIsIHsKICAgICAgICB2YWx1ZToge30sCiAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgIH0pOwogICAgfQogICAgX2NyZWF0ZUNsYXNzKEVtaXR0ZXIyLCBbewogICAgICBrZXk6ICJhZGRFdmVudExpc3RlbmVyIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXIodHlwZSwgY2FsbGJhY2ssIG9wdGlvbnMpIHsKICAgICAgICBpZiAoISh0eXBlIGluIHRoaXMubGlzdGVuZXJzKSkgewogICAgICAgICAgdGhpcy5saXN0ZW5lcnNbdHlwZV0gPSBbXTsKICAgICAgICB9CiAgICAgICAgdGhpcy5saXN0ZW5lcnNbdHlwZV0ucHVzaCh7CiAgICAgICAgICBjYWxsYmFjaywKICAgICAgICAgIG9wdGlvbnMKICAgICAgICB9KTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJyZW1vdmVFdmVudExpc3RlbmVyIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgY2FsbGJhY2spIHsKICAgICAgICBpZiAoISh0eXBlIGluIHRoaXMubGlzdGVuZXJzKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgc3RhY2sgPSB0aGlzLmxpc3RlbmVyc1t0eXBlXTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHN0YWNrLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgaWYgKHN0YWNrW2ldLmNhbGxiYWNrID09PSBjYWxsYmFjaykgewogICAgICAgICAgICBzdGFjay5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZGlzcGF0Y2hFdmVudCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNwYXRjaEV2ZW50KGV2ZW50KSB7CiAgICAgICAgaWYgKCEoZXZlbnQudHlwZSBpbiB0aGlzLmxpc3RlbmVycykpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIHN0YWNrID0gdGhpcy5saXN0ZW5lcnNbZXZlbnQudHlwZV07CiAgICAgICAgdmFyIHN0YWNrVG9DYWxsID0gc3RhY2suc2xpY2UoKTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHN0YWNrVG9DYWxsLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgdmFyIGxpc3RlbmVyID0gc3RhY2tUb0NhbGxbaV07CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBsaXN0ZW5lci5jYWxsYmFjay5jYWxsKHRoaXMsIGV2ZW50KTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChsaXN0ZW5lci5vcHRpb25zICYmIGxpc3RlbmVyLm9wdGlvbnMub25jZSkgewogICAgICAgICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQudHlwZSwgbGlzdGVuZXIuY2FsbGJhY2spOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gIWV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQ7CiAgICAgIH0KICAgIH1dKTsKICAgIHJldHVybiBFbWl0dGVyMjsKICB9KCk7CiAgdmFyIEFib3J0U2lnbmFsJDEgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oX0VtaXR0ZXIpIHsKICAgIF9pbmhlcml0cyhBYm9ydFNpZ25hbDIsIF9FbWl0dGVyKTsKICAgIHZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoQWJvcnRTaWduYWwyKTsKICAgIGZ1bmN0aW9uIEFib3J0U2lnbmFsMigpIHsKICAgICAgdmFyIF90aGlzOwogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQWJvcnRTaWduYWwyKTsKICAgICAgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKTsKICAgICAgaWYgKCFfdGhpcy5saXN0ZW5lcnMpIHsKICAgICAgICBFbWl0dGVyLmNhbGwoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgICB9CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImFib3J0ZWQiLCB7CiAgICAgICAgdmFsdWU6IGZhbHNlLAogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25hYm9ydCIsIHsKICAgICAgICB2YWx1ZTogbnVsbCwKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIHJldHVybiBfdGhpczsKICAgIH0KICAgIF9jcmVhdGVDbGFzcyhBYm9ydFNpZ25hbDIsIFt7CiAgICAgIGtleTogInRvU3RyaW5nIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRvU3RyaW5nMigpIHsKICAgICAgICByZXR1cm4gIltvYmplY3QgQWJvcnRTaWduYWxdIjsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJkaXNwYXRjaEV2ZW50IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gImFib3J0IikgewogICAgICAgICAgdGhpcy5hYm9ydGVkID0gdHJ1ZTsKICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5vbmFib3J0ID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIHRoaXMub25hYm9ydC5jYWxsKHRoaXMsIGV2ZW50KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX2dldChfZ2V0UHJvdG90eXBlT2YoQWJvcnRTaWduYWwyLnByb3RvdHlwZSksICJkaXNwYXRjaEV2ZW50IiwgdGhpcykuY2FsbCh0aGlzLCBldmVudCk7CiAgICAgIH0KICAgIH1dKTsKICAgIHJldHVybiBBYm9ydFNpZ25hbDI7CiAgfShFbWl0dGVyKTsKICB2YXIgQWJvcnRDb250cm9sbGVyJDEgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBBYm9ydENvbnRyb2xsZXIyKCkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQWJvcnRDb250cm9sbGVyMik7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAic2lnbmFsIiwgewogICAgICAgIHZhbHVlOiBuZXcgQWJvcnRTaWduYWwkMSgpLAogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9KTsKICAgIH0KICAgIF9jcmVhdGVDbGFzcyhBYm9ydENvbnRyb2xsZXIyLCBbewogICAgICBrZXk6ICJhYm9ydCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBhYm9ydCgpIHsKICAgICAgICB2YXIgZXZlbnQ7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGV2ZW50ID0gbmV3IEV2ZW50KCJhYm9ydCIpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIGlmICghZG9jdW1lbnQuY3JlYXRlRXZlbnQpIHsKICAgICAgICAgICAgICBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50T2JqZWN0KCk7CiAgICAgICAgICAgICAgZXZlbnQudHlwZSA9ICJhYm9ydCI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgiRXZlbnQiKTsKICAgICAgICAgICAgICBldmVudC5pbml0RXZlbnQoImFib3J0IiwgZmFsc2UsIGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZXZlbnQgPSB7CiAgICAgICAgICAgICAgdHlwZTogImFib3J0IiwKICAgICAgICAgICAgICBidWJibGVzOiBmYWxzZSwKICAgICAgICAgICAgICBjYW5jZWxhYmxlOiBmYWxzZQogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLnNpZ25hbC5kaXNwYXRjaEV2ZW50KGV2ZW50KTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJ0b1N0cmluZyIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB0b1N0cmluZzIoKSB7CiAgICAgICAgcmV0dXJuICJbb2JqZWN0IEFib3J0Q29udHJvbGxlcl0iOwogICAgICB9CiAgICB9XSk7CiAgICByZXR1cm4gQWJvcnRDb250cm9sbGVyMjsKICB9KCk7CiAgaWYgKHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIFN5bWJvbC50b1N0cmluZ1RhZykgewogICAgQWJvcnRDb250cm9sbGVyJDEucHJvdG90eXBlW1N5bWJvbC50b1N0cmluZ1RhZ10gPSAiQWJvcnRDb250cm9sbGVyIjsKICAgIEFib3J0U2lnbmFsJDEucHJvdG90eXBlW1N5bWJvbC50b1N0cmluZ1RhZ10gPSAiQWJvcnRTaWduYWwiOwogIH0KICBmdW5jdGlvbiBwb2x5ZmlsbE5lZWRlZChzZWxmMikgewogICAgaWYgKHNlbGYyLl9fRk9SQ0VfSU5TVEFMTF9BQk9SVENPTlRST0xMRVJfUE9MWUZJTEwpIHsKICAgICAgY29uc29sZS5sb2coIl9fRk9SQ0VfSU5TVEFMTF9BQk9SVENPTlRST0xMRVJfUE9MWUZJTEw9dHJ1ZSBpcyBzZXQsIHdpbGwgZm9yY2UgaW5zdGFsbCBwb2x5ZmlsbCIpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiB0eXBlb2Ygc2VsZjIuUmVxdWVzdCA9PT0gImZ1bmN0aW9uIiAmJiAhc2VsZjIuUmVxdWVzdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkoInNpZ25hbCIpIHx8ICFzZWxmMi5BYm9ydENvbnRyb2xsZXI7CiAgfQogIGZ1bmN0aW9uIGFib3J0YWJsZUZldGNoRGVjb3JhdG9yKHBhdGNoVGFyZ2V0cykgewogICAgaWYgKHR5cGVvZiBwYXRjaFRhcmdldHMgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgcGF0Y2hUYXJnZXRzID0gewogICAgICAgIGZldGNoOiBwYXRjaFRhcmdldHMKICAgICAgfTsKICAgIH0KICAgIHZhciBfcGF0Y2hUYXJnZXRzID0gcGF0Y2hUYXJnZXRzLCBmZXRjaDIgPSBfcGF0Y2hUYXJnZXRzLmZldGNoLCBfcGF0Y2hUYXJnZXRzJFJlcXVlc3QgPSBfcGF0Y2hUYXJnZXRzLlJlcXVlc3QsIE5hdGl2ZVJlcXVlc3QgPSBfcGF0Y2hUYXJnZXRzJFJlcXVlc3QgPT09IHZvaWQgMCA/IGZldGNoMi5SZXF1ZXN0IDogX3BhdGNoVGFyZ2V0cyRSZXF1ZXN0LCBOYXRpdmVBYm9ydENvbnRyb2xsZXIgPSBfcGF0Y2hUYXJnZXRzLkFib3J0Q29udHJvbGxlciwgX3BhdGNoVGFyZ2V0cyRfX0ZPUkNFID0gX3BhdGNoVGFyZ2V0cy5fX0ZPUkNFX0lOU1RBTExfQUJPUlRDT05UUk9MTEVSX1BPTFlGSUxMLCBfX0ZPUkNFX0lOU1RBTExfQUJPUlRDT05UUk9MTEVSX1BPTFlGSUxMID0gX3BhdGNoVGFyZ2V0cyRfX0ZPUkNFID09PSB2b2lkIDAgPyBmYWxzZSA6IF9wYXRjaFRhcmdldHMkX19GT1JDRTsKICAgIGlmICghcG9seWZpbGxOZWVkZWQoewogICAgICBmZXRjaDogZmV0Y2gyLAogICAgICBSZXF1ZXN0OiBOYXRpdmVSZXF1ZXN0LAogICAgICBBYm9ydENvbnRyb2xsZXI6IE5hdGl2ZUFib3J0Q29udHJvbGxlciwKICAgICAgX19GT1JDRV9JTlNUQUxMX0FCT1JUQ09OVFJPTExFUl9QT0xZRklMTAogICAgfSkpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBmZXRjaDogZmV0Y2gyLAogICAgICAgIFJlcXVlc3QKICAgICAgfTsKICAgIH0KICAgIHZhciBSZXF1ZXN0ID0gTmF0aXZlUmVxdWVzdDsKICAgIGlmIChSZXF1ZXN0ICYmICFSZXF1ZXN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSgic2lnbmFsIikgfHwgX19GT1JDRV9JTlNUQUxMX0FCT1JUQ09OVFJPTExFUl9QT0xZRklMTCkgewogICAgICBSZXF1ZXN0ID0gZnVuY3Rpb24gUmVxdWVzdDIoaW5wdXQsIGluaXQyKSB7CiAgICAgICAgdmFyIHNpZ25hbDsKICAgICAgICBpZiAoaW5pdDIgJiYgaW5pdDIuc2lnbmFsKSB7CiAgICAgICAgICBzaWduYWwgPSBpbml0Mi5zaWduYWw7CiAgICAgICAgICBkZWxldGUgaW5pdDIuc2lnbmFsOwogICAgICAgIH0KICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBOYXRpdmVSZXF1ZXN0KGlucHV0LCBpbml0Mik7CiAgICAgICAgaWYgKHNpZ25hbCkgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlcXVlc3QsICJzaWduYWwiLCB7CiAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZSwKICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgdmFsdWU6IHNpZ25hbAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXF1ZXN0OwogICAgICB9OwogICAgICBSZXF1ZXN0LnByb3RvdHlwZSA9IE5hdGl2ZVJlcXVlc3QucHJvdG90eXBlOwogICAgfQogICAgdmFyIHJlYWxGZXRjaCA9IGZldGNoMjsKICAgIHZhciBhYm9ydGFibGVGZXRjaCA9IGZ1bmN0aW9uIGFib3J0YWJsZUZldGNoMihpbnB1dCwgaW5pdDIpIHsKICAgICAgdmFyIHNpZ25hbCA9IFJlcXVlc3QgJiYgUmVxdWVzdC5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihpbnB1dCkgPyBpbnB1dC5zaWduYWwgOiBpbml0MiA/IGluaXQyLnNpZ25hbCA6IHZvaWQgMDsKICAgICAgaWYgKHNpZ25hbCkgewogICAgICAgIHZhciBhYm9ydEVycm9yOwogICAgICAgIHRyeSB7CiAgICAgICAgICBhYm9ydEVycm9yID0gbmV3IERPTUV4Y2VwdGlvbigiQWJvcnRlZCIsICJBYm9ydEVycm9yIik7CiAgICAgICAgfSBjYXRjaCAoZXJyMikgewogICAgICAgICAgYWJvcnRFcnJvciA9IG5ldyBFcnJvcigiQWJvcnRlZCIpOwogICAgICAgICAgYWJvcnRFcnJvci5uYW1lID0gIkFib3J0RXJyb3IiOwogICAgICAgIH0KICAgICAgICBpZiAoc2lnbmFsLmFib3J0ZWQpIHsKICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChhYm9ydEVycm9yKTsKICAgICAgICB9CiAgICAgICAgdmFyIGNhbmNlbGxhdGlvbiA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKF8yLCByZWplY3QpIHsKICAgICAgICAgIHNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gcmVqZWN0KGFib3J0RXJyb3IpOwogICAgICAgICAgfSwgewogICAgICAgICAgICBvbmNlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBpZiAoaW5pdDIgJiYgaW5pdDIuc2lnbmFsKSB7CiAgICAgICAgICBkZWxldGUgaW5pdDIuc2lnbmFsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gUHJvbWlzZS5yYWNlKFtjYW5jZWxsYXRpb24sIHJlYWxGZXRjaChpbnB1dCwgaW5pdDIpXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlYWxGZXRjaChpbnB1dCwgaW5pdDIpOwogICAgfTsKICAgIHJldHVybiB7CiAgICAgIGZldGNoOiBhYm9ydGFibGVGZXRjaCwKICAgICAgUmVxdWVzdAogICAgfTsKICB9CiAgY2pzUG9ueWZpbGwuQWJvcnRDb250cm9sbGVyID0gQWJvcnRDb250cm9sbGVyJDE7CiAgY2pzUG9ueWZpbGwuQWJvcnRTaWduYWwgPSBBYm9ydFNpZ25hbCQxOwogIGNqc1BvbnlmaWxsLmFib3J0YWJsZUZldGNoID0gYWJvcnRhYmxlRmV0Y2hEZWNvcmF0b3I7CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGFib3J0Y29udHJvbGxlclBvbnlmaWxsLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgYWJvcnRjb250cm9sbGVyUG9ueWZpbGwuQWJvcnRTaWduYWwgPSBhYm9ydGNvbnRyb2xsZXJQb255ZmlsbC5BYm9ydENvbnRyb2xsZXIgPSB2b2lkIDA7CiAgY29uc3QgY2pzX3BvbnlmaWxsXzEgPSBjanNQb255ZmlsbDsKICB2YXIgZ2V0R2xvYmFsID0gZnVuY3Rpb24oKSB7CiAgICBpZiAodHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIHJldHVybiBzZWxmOwogICAgfQogICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIHJldHVybiB3aW5kb3c7CiAgICB9CiAgICBpZiAodHlwZW9mIGNvbW1vbmpzR2xvYmFsICE9PSAidW5kZWZpbmVkIikgewogICAgICByZXR1cm4gY29tbW9uanNHbG9iYWw7CiAgICB9CiAgICB0aHJvdyBuZXcgRXJyb3IoInVuYWJsZSB0byBsb2NhdGUgZ2xvYmFsIG9iamVjdCIpOwogIH07CiAgbGV0IEFib3J0Q29udHJvbGxlciA9IHR5cGVvZiBnZXRHbG9iYWwoKS5BYm9ydENvbnRyb2xsZXIgPT09ICJ1bmRlZmluZWQiID8gY2pzX3BvbnlmaWxsXzEuQWJvcnRDb250cm9sbGVyIDogZ2V0R2xvYmFsKCkuQWJvcnRDb250cm9sbGVyOwogIGFib3J0Y29udHJvbGxlclBvbnlmaWxsLkFib3J0Q29udHJvbGxlciA9IEFib3J0Q29udHJvbGxlcjsKICBsZXQgQWJvcnRTaWduYWwgPSB0eXBlb2YgZ2V0R2xvYmFsKCkuQWJvcnRDb250cm9sbGVyID09PSAidW5kZWZpbmVkIiA/IGNqc19wb255ZmlsbF8xLkFib3J0U2lnbmFsIDogZ2V0R2xvYmFsKCkuQWJvcnRTaWduYWw7CiAgYWJvcnRjb250cm9sbGVyUG9ueWZpbGwuQWJvcnRTaWduYWwgPSBBYm9ydFNpZ25hbDsKICB2YXIgQWdncmVnYXRlQWJvcnRDb250cm9sbGVyJDEgPSB7fTsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWdncmVnYXRlQWJvcnRDb250cm9sbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICBjb25zdCBhYm9ydGNvbnRyb2xsZXJfcG9ueWZpbGxfMSQxID0gYWJvcnRjb250cm9sbGVyUG9ueWZpbGw7CiAgY2xhc3MgTnVsbFNpZ25hbCB7CiAgfQogIGNsYXNzIEFnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlciB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5zaWduYWxzID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTsKICAgICAgdGhpcy5hYm9ydENvbnRyb2xsZXIgPSBuZXcgYWJvcnRjb250cm9sbGVyX3BvbnlmaWxsXzEkMS5BYm9ydENvbnRyb2xsZXIoKTsKICAgIH0KICAgIGFkZFNpZ25hbChzaWduYWwgPSBuZXcgTnVsbFNpZ25hbCgpKSB7CiAgICAgIGlmICh0aGlzLnNpZ25hbC5hYm9ydGVkKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgYWRkIGEgc2lnbmFsLCBhbHJlYWR5IGFib3J0ZWQhIik7CiAgICAgIH0KICAgICAgdGhpcy5zaWduYWxzLmFkZChzaWduYWwpOwogICAgICBpZiAoc2lnbmFsLmFib3J0ZWQpIHsKICAgICAgICB0aGlzLmhhbmRsZUFib3J0ZWQoc2lnbmFsKTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICBzaWduYWwuYWRkRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCAoKSA9PiB7CiAgICAgICAgICB0aGlzLmhhbmRsZUFib3J0ZWQoc2lnbmFsKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgaGFuZGxlQWJvcnRlZChzaWduYWwpIHsKICAgICAgdGhpcy5zaWduYWxzLmRlbGV0ZShzaWduYWwpOwogICAgICBpZiAodGhpcy5zaWduYWxzLnNpemUgPT09IDApIHsKICAgICAgICB0aGlzLmFib3J0Q29udHJvbGxlci5hYm9ydCgpOwogICAgICB9CiAgICB9CiAgICBnZXQgc2lnbmFsKCkgewogICAgICByZXR1cm4gdGhpcy5hYm9ydENvbnRyb2xsZXIuc2lnbmFsOwogICAgfQogICAgYWJvcnQoKSB7CiAgICAgIHRoaXMuYWJvcnRDb250cm9sbGVyLmFib3J0KCk7CiAgICB9CiAgfQogIEFnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlciQxLmRlZmF1bHQgPSBBZ2dyZWdhdGVBYm9ydENvbnRyb2xsZXI7CiAgdmFyIEFnZ3JlZ2F0ZVN0YXR1c1JlcG9ydGVyJDEgPSB7fTsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWdncmVnYXRlU3RhdHVzUmVwb3J0ZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogIGNsYXNzIEFnZ3JlZ2F0ZVN0YXR1c1JlcG9ydGVyIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmNhbGxiYWNrcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgU2V0KCk7CiAgICB9CiAgICBhZGRDYWxsYmFjayhjYWxsYmFjayA9ICgpID0+IHsKICAgIH0pIHsKICAgICAgdGhpcy5jYWxsYmFja3MuYWRkKGNhbGxiYWNrKTsKICAgICAgY2FsbGJhY2sodGhpcy5jdXJyZW50TWVzc2FnZSk7CiAgICB9CiAgICBjYWxsYmFjayhtZXNzYWdlKSB7CiAgICAgIHRoaXMuY3VycmVudE1lc3NhZ2UgPSBtZXNzYWdlOwogICAgICB0aGlzLmNhbGxiYWNrcy5mb3JFYWNoKChlbHQpID0+IHsKICAgICAgICBlbHQobWVzc2FnZSk7CiAgICAgIH0pOwogICAgfQogIH0KICBBZ2dyZWdhdGVTdGF0dXNSZXBvcnRlciQxLmRlZmF1bHQgPSBBZ2dyZWdhdGVTdGF0dXNSZXBvcnRlcjsKICB2YXIgX19pbXBvcnREZWZhdWx0JDEgPSBjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2ltcG9ydERlZmF1bHQgfHwgZnVuY3Rpb24obW9kKSB7CiAgICByZXR1cm4gbW9kICYmIG1vZC5fX2VzTW9kdWxlID8gbW9kIDogeyAiZGVmYXVsdCI6IG1vZCB9OwogIH07CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFib3J0YWJsZVByb21pc2VDYWNoZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgY29uc3QgYWJvcnRjb250cm9sbGVyX3BvbnlmaWxsXzEgPSBhYm9ydGNvbnRyb2xsZXJQb255ZmlsbDsKICBjb25zdCBBZ2dyZWdhdGVBYm9ydENvbnRyb2xsZXJfMSA9IF9faW1wb3J0RGVmYXVsdCQxKEFnZ3JlZ2F0ZUFib3J0Q29udHJvbGxlciQxKTsKICBjb25zdCBBZ2dyZWdhdGVTdGF0dXNSZXBvcnRlcl8xID0gX19pbXBvcnREZWZhdWx0JDEoQWdncmVnYXRlU3RhdHVzUmVwb3J0ZXIkMSk7CiAgY2xhc3MgQWJvcnRhYmxlUHJvbWlzZUNhY2hlIHsKICAgIGNvbnN0cnVjdG9yKHsgZmlsbCwgY2FjaGUgfSkgewogICAgICBpZiAodHlwZW9mIGZpbGwgIT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJtdXN0IHBhc3MgYSBmaWxsIGZ1bmN0aW9uIik7CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiBjYWNoZSAhPT0gIm9iamVjdCIpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJtdXN0IHBhc3MgYSBjYWNoZSBvYmplY3QiKTsKICAgICAgfQogICAgICBpZiAodHlwZW9mIGNhY2hlLmdldCAhPT0gImZ1bmN0aW9uIiB8fCB0eXBlb2YgY2FjaGUuc2V0ICE9PSAiZnVuY3Rpb24iIHx8IHR5cGVvZiBjYWNoZS5kZWxldGUgIT09ICJmdW5jdGlvbiIpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJjYWNoZSBtdXN0IGltcGxlbWVudCBnZXQoa2V5KSwgc2V0KGtleSwgdmFsKSwgYW5kIGFuZCBkZWxldGUoa2V5KSIpOwogICAgICB9CiAgICAgIHRoaXMuY2FjaGUgPSBjYWNoZTsKICAgICAgdGhpcy5maWxsQ2FsbGJhY2sgPSBmaWxsOwogICAgfQogICAgc3RhdGljIGlzQWJvcnRFeGNlcHRpb24oZXhjZXB0aW9uKSB7CiAgICAgIHJldHVybiBleGNlcHRpb24ubmFtZSA9PT0gIkFib3J0RXJyb3IiIHx8IGV4Y2VwdGlvbi5jb2RlID09PSAiRVJSX0FCT1JURUQiIHx8IGV4Y2VwdGlvbi5tZXNzYWdlID09PSAiQWJvcnRFcnJvcjogYWJvcnRlZCIgfHwgZXhjZXB0aW9uLm1lc3NhZ2UgPT09ICJFcnJvcjogYWJvcnRlZCI7CiAgICB9CiAgICBldmljdChrZXksIGVudHJ5KSB7CiAgICAgIGlmICh0aGlzLmNhY2hlLmdldChrZXkpID09PSBlbnRyeSkgewogICAgICAgIHRoaXMuY2FjaGUuZGVsZXRlKGtleSk7CiAgICAgIH0KICAgIH0KICAgIGZpbGwoa2V5LCBkYXRhLCBzaWduYWwsIHN0YXR1c0NhbGxiYWNrKSB7CiAgICAgIGNvbnN0IGFib3J0ZXIgPSBuZXcgQWdncmVnYXRlQWJvcnRDb250cm9sbGVyXzEuZGVmYXVsdCgpOwogICAgICBjb25zdCBzdGF0dXNSZXBvcnRlciA9IG5ldyBBZ2dyZWdhdGVTdGF0dXNSZXBvcnRlcl8xLmRlZmF1bHQoKTsKICAgICAgc3RhdHVzUmVwb3J0ZXIuYWRkQ2FsbGJhY2soc3RhdHVzQ2FsbGJhY2spOwogICAgICBjb25zdCBuZXdFbnRyeSA9IHsKICAgICAgICBhYm9ydGVyLAogICAgICAgIHByb21pc2U6IHRoaXMuZmlsbENhbGxiYWNrKGRhdGEsIGFib3J0ZXIuc2lnbmFsLCAobWVzc2FnZSkgPT4gewogICAgICAgICAgc3RhdHVzUmVwb3J0ZXIuY2FsbGJhY2sobWVzc2FnZSk7CiAgICAgICAgfSksCiAgICAgICAgc2V0dGxlZDogZmFsc2UsCiAgICAgICAgc3RhdHVzUmVwb3J0ZXIsCiAgICAgICAgZ2V0IGFib3J0ZWQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5hYm9ydGVyLnNpZ25hbC5hYm9ydGVkOwogICAgICAgIH0KICAgICAgfTsKICAgICAgbmV3RW50cnkuYWJvcnRlci5hZGRTaWduYWwoc2lnbmFsKTsKICAgICAgbmV3RW50cnkuYWJvcnRlci5zaWduYWwuYWRkRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCAoKSA9PiB7CiAgICAgICAgaWYgKCFuZXdFbnRyeS5zZXR0bGVkKSB7CiAgICAgICAgICB0aGlzLmV2aWN0KGtleSwgbmV3RW50cnkpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIG5ld0VudHJ5LnByb21pc2UudGhlbigoKSA9PiB7CiAgICAgICAgbmV3RW50cnkuc2V0dGxlZCA9IHRydWU7CiAgICAgIH0sICgpID0+IHsKICAgICAgICBuZXdFbnRyeS5zZXR0bGVkID0gdHJ1ZTsKICAgICAgICB0aGlzLmV2aWN0KGtleSwgbmV3RW50cnkpOwogICAgICB9KS5jYXRjaCgoZSkgPT4gewogICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgdGhyb3cgZTsKICAgICAgfSk7CiAgICAgIHRoaXMuY2FjaGUuc2V0KGtleSwgbmV3RW50cnkpOwogICAgfQogICAgc3RhdGljIGNoZWNrU2luZ2xlUHJvbWlzZShwcm9taXNlLCBzaWduYWwpIHsKICAgICAgZnVuY3Rpb24gY2hlY2tGb3JTaW5nbGVBYm9ydCgpIHsKICAgICAgICBpZiAoc2lnbmFsICYmIHNpZ25hbC5hYm9ydGVkKSB7CiAgICAgICAgICB0aHJvdyBPYmplY3QuYXNzaWduKG5ldyBFcnJvcigiYWJvcnRlZCIpLCB7IGNvZGU6ICJFUlJfQUJPUlRFRCIgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBwcm9taXNlLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgIGNoZWNrRm9yU2luZ2xlQWJvcnQoKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9LCAoZXJyb3IpID0+IHsKICAgICAgICBjaGVja0ZvclNpbmdsZUFib3J0KCk7CiAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgIH0pOwogICAgfQogICAgaGFzKGtleSkgewogICAgICByZXR1cm4gdGhpcy5jYWNoZS5oYXMoa2V5KTsKICAgIH0KICAgIGdldChrZXksIGRhdGEsIHNpZ25hbCwgc3RhdHVzQ2FsbGJhY2spIHsKICAgICAgaWYgKCFzaWduYWwgJiYgZGF0YSBpbnN0YW5jZW9mIGFib3J0Y29udHJvbGxlcl9wb255ZmlsbF8xLkFib3J0U2lnbmFsKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigic2Vjb25kIGdldCBhcmd1bWVudCBhcHBlYXJzIHRvIGJlIGFuIEFib3J0U2lnbmFsLCBwZXJoYXBzIHlvdSBtZWFudCB0byBwYXNzIGBudWxsYCBmb3IgdGhlIGZpbGwgZGF0YT8iKTsKICAgICAgfQogICAgICBjb25zdCBjYWNoZUVudHJ5ID0gdGhpcy5jYWNoZS5nZXQoa2V5KTsKICAgICAgaWYgKGNhY2hlRW50cnkpIHsKICAgICAgICBpZiAoY2FjaGVFbnRyeS5hYm9ydGVkICYmICFjYWNoZUVudHJ5LnNldHRsZWQpIHsKICAgICAgICAgIHRoaXMuZXZpY3Qoa2V5LCBjYWNoZUVudHJ5KTsKICAgICAgICAgIHJldHVybiB0aGlzLmdldChrZXksIGRhdGEsIHNpZ25hbCwgc3RhdHVzQ2FsbGJhY2spOwogICAgICAgIH0KICAgICAgICBpZiAoY2FjaGVFbnRyeS5zZXR0bGVkKSB7CiAgICAgICAgICByZXR1cm4gY2FjaGVFbnRyeS5wcm9taXNlOwogICAgICAgIH0KICAgICAgICBjYWNoZUVudHJ5LmFib3J0ZXIuYWRkU2lnbmFsKHNpZ25hbCk7CiAgICAgICAgY2FjaGVFbnRyeS5zdGF0dXNSZXBvcnRlci5hZGRDYWxsYmFjayhzdGF0dXNDYWxsYmFjayk7CiAgICAgICAgcmV0dXJuIEFib3J0YWJsZVByb21pc2VDYWNoZS5jaGVja1NpbmdsZVByb21pc2UoY2FjaGVFbnRyeS5wcm9taXNlLCBzaWduYWwpOwogICAgICB9CiAgICAgIHRoaXMuZmlsbChrZXksIGRhdGEsIHNpZ25hbCwgc3RhdHVzQ2FsbGJhY2spOwogICAgICByZXR1cm4gQWJvcnRhYmxlUHJvbWlzZUNhY2hlLmNoZWNrU2luZ2xlUHJvbWlzZSh0aGlzLmNhY2hlLmdldChrZXkpLnByb21pc2UsIHNpZ25hbCk7CiAgICB9CiAgICBkZWxldGUoa2V5KSB7CiAgICAgIGNvbnN0IGNhY2hlZEVudHJ5ID0gdGhpcy5jYWNoZS5nZXQoa2V5KTsKICAgICAgaWYgKGNhY2hlZEVudHJ5KSB7CiAgICAgICAgaWYgKCFjYWNoZWRFbnRyeS5zZXR0bGVkKSB7CiAgICAgICAgICBjYWNoZWRFbnRyeS5hYm9ydGVyLmFib3J0KCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuY2FjaGUuZGVsZXRlKGtleSk7CiAgICAgIH0KICAgIH0KICAgIGNsZWFyKCkgewogICAgICBjb25zdCBrZXlJdGVyID0gdGhpcy5jYWNoZS5rZXlzKCk7CiAgICAgIGxldCBkZWxldGVDb3VudCA9IDA7CiAgICAgIGZvciAobGV0IHJlc3VsdCA9IGtleUl0ZXIubmV4dCgpOyAhcmVzdWx0LmRvbmU7IHJlc3VsdCA9IGtleUl0ZXIubmV4dCgpKSB7CiAgICAgICAgdGhpcy5kZWxldGUocmVzdWx0LnZhbHVlKTsKICAgICAgICBkZWxldGVDb3VudCArPSAxOwogICAgICB9CiAgICAgIHJldHVybiBkZWxldGVDb3VudDsKICAgIH0KICB9CiAgQWJvcnRhYmxlUHJvbWlzZUNhY2hlJDEuZGVmYXVsdCA9IEFib3J0YWJsZVByb21pc2VDYWNoZTsKICB2YXIgX19pbXBvcnREZWZhdWx0ID0gY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19pbXBvcnREZWZhdWx0IHx8IGZ1bmN0aW9uKG1vZCkgewogICAgcmV0dXJuIG1vZCAmJiBtb2QuX19lc01vZHVsZSA/IG1vZCA6IHsgImRlZmF1bHQiOiBtb2QgfTsKICB9OwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlc20sICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICBjb25zdCBBYm9ydGFibGVQcm9taXNlQ2FjaGVfMSA9IF9faW1wb3J0RGVmYXVsdChBYm9ydGFibGVQcm9taXNlQ2FjaGUkMSk7CiAgdmFyIF9kZWZhdWx0ID0gZXNtLmRlZmF1bHQgPSBBYm9ydGFibGVQcm9taXNlQ2FjaGVfMS5kZWZhdWx0OwogIGNsYXNzIFF1aWNrTFJVIHsKICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkgewogICAgICBpZiAoIShvcHRpb25zLm1heFNpemUgJiYgb3B0aW9ucy5tYXhTaXplID4gMCkpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJgbWF4U2l6ZWAgbXVzdCBiZSBhIG51bWJlciBncmVhdGVyIHRoYW4gMCIpOwogICAgICB9CiAgICAgIHRoaXMubWF4U2l6ZSA9IG9wdGlvbnMubWF4U2l6ZTsKICAgICAgdGhpcy5jYWNoZSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgICAgIHRoaXMub2xkQ2FjaGUgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpOwogICAgICB0aGlzLl9zaXplID0gMDsKICAgIH0KICAgIF9zZXQoa2V5LCB2YWx1ZSkgewogICAgICB0aGlzLmNhY2hlLnNldChrZXksIHZhbHVlKTsKICAgICAgdGhpcy5fc2l6ZSsrOwogICAgICBpZiAodGhpcy5fc2l6ZSA+PSB0aGlzLm1heFNpemUpIHsKICAgICAgICB0aGlzLl9zaXplID0gMDsKICAgICAgICB0aGlzLm9sZENhY2hlID0gdGhpcy5jYWNoZTsKICAgICAgICB0aGlzLmNhY2hlID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICAgICAgfQogICAgfQogICAgZ2V0KGtleSkgewogICAgICBpZiAodGhpcy5jYWNoZS5oYXMoa2V5KSkgewogICAgICAgIHJldHVybiB0aGlzLmNhY2hlLmdldChrZXkpOwogICAgICB9CiAgICAgIGlmICh0aGlzLm9sZENhY2hlLmhhcyhrZXkpKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLm9sZENhY2hlLmdldChrZXkpOwogICAgICAgIHRoaXMub2xkQ2FjaGUuZGVsZXRlKGtleSk7CiAgICAgICAgdGhpcy5fc2V0KGtleSwgdmFsdWUpOwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfQogICAgfQogICAgc2V0KGtleSwgdmFsdWUpIHsKICAgICAgaWYgKHRoaXMuY2FjaGUuaGFzKGtleSkpIHsKICAgICAgICB0aGlzLmNhY2hlLnNldChrZXksIHZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9zZXQoa2V5LCB2YWx1ZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBoYXMoa2V5KSB7CiAgICAgIHJldHVybiB0aGlzLmNhY2hlLmhhcyhrZXkpIHx8IHRoaXMub2xkQ2FjaGUuaGFzKGtleSk7CiAgICB9CiAgICBwZWVrKGtleSkgewogICAgICBpZiAodGhpcy5jYWNoZS5oYXMoa2V5KSkgewogICAgICAgIHJldHVybiB0aGlzLmNhY2hlLmdldChrZXkpOwogICAgICB9CiAgICAgIGlmICh0aGlzLm9sZENhY2hlLmhhcyhrZXkpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMub2xkQ2FjaGUuZ2V0KGtleSk7CiAgICAgIH0KICAgIH0KICAgIGRlbGV0ZShrZXkpIHsKICAgICAgY29uc3QgZGVsZXRlZCA9IHRoaXMuY2FjaGUuZGVsZXRlKGtleSk7CiAgICAgIGlmIChkZWxldGVkKSB7CiAgICAgICAgdGhpcy5fc2l6ZS0tOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLm9sZENhY2hlLmRlbGV0ZShrZXkpIHx8IGRlbGV0ZWQ7CiAgICB9CiAgICBjbGVhcigpIHsKICAgICAgdGhpcy5jYWNoZS5jbGVhcigpOwogICAgICB0aGlzLm9sZENhY2hlLmNsZWFyKCk7CiAgICAgIHRoaXMuX3NpemUgPSAwOwogICAgfQogICAgKmtleXMoKSB7CiAgICAgIGZvciAoY29uc3QgW2tleV0gb2YgdGhpcykgewogICAgICAgIHlpZWxkIGtleTsKICAgICAgfQogICAgfQogICAgKnZhbHVlcygpIHsKICAgICAgZm9yIChjb25zdCBbLCB2YWx1ZV0gb2YgdGhpcykgewogICAgICAgIHlpZWxkIHZhbHVlOwogICAgICB9CiAgICB9CiAgICAqW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLmNhY2hlKSB7CiAgICAgICAgeWllbGQgaXRlbTsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5vbGRDYWNoZSkgewogICAgICAgIGNvbnN0IFtrZXldID0gaXRlbTsKICAgICAgICBpZiAoIXRoaXMuY2FjaGUuaGFzKGtleSkpIHsKICAgICAgICAgIHlpZWxkIGl0ZW07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBnZXQgc2l6ZSgpIHsKICAgICAgbGV0IG9sZENhY2hlU2l6ZSA9IDA7CiAgICAgIGZvciAoY29uc3Qga2V5IG9mIHRoaXMub2xkQ2FjaGUua2V5cygpKSB7CiAgICAgICAgaWYgKCF0aGlzLmNhY2hlLmhhcyhrZXkpKSB7CiAgICAgICAgICBvbGRDYWNoZVNpemUrKzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3NpemUgKyBvbGRDYWNoZVNpemU7CiAgICB9CiAgfQogIHZhciBxdWlja0xydSA9IFF1aWNrTFJVOwogIHZhciBkaXN0JDEgPSB7fTsKICB2YXIgaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUyKSB7CiAgICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihvYmopIHsKICAgICAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsKICAgICAgICAiZGVmYXVsdCI6IG9iagogICAgICB9OwogICAgfQogICAgbW9kdWxlMi5leHBvcnRzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdDI7CiAgICBtb2R1bGUyLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZTIuZXhwb3J0cywgbW9kdWxlMi5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKGludGVyb3BSZXF1aXJlRGVmYXVsdCk7CiAgdmFyIF9fdml0ZUJyb3dzZXJFeHRlcm5hbCA9IG5ldyBQcm94eSh7fSwgewogICAgZ2V0KCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ01vZHVsZSAiIiBoYXMgYmVlbiBleHRlcm5hbGl6ZWQgZm9yIGJyb3dzZXIgY29tcGF0aWJpbGl0eSBhbmQgY2Fubm90IGJlIGFjY2Vzc2VkIGluIGNsaWVudCBjb2RlLicpOwogICAgfQogIH0pOwogIHZhciBfX3ZpdGVCcm93c2VyRXh0ZXJuYWwkMSA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuZnJlZXplKHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgICJkZWZhdWx0IjogX192aXRlQnJvd3NlckV4dGVybmFsCiAgfSk7CiAgdmFyIHJlcXVpcmUkJDUgPSAvKiBAX19QVVJFX18gKi8gZ2V0QXVnbWVudGVkTmFtZXNwYWNlKF9fdml0ZUJyb3dzZXJFeHRlcm5hbCQxKTsKICB2YXIgcmVtb3RlRmlsZSA9IHt9OwogIHZhciBydW50aW1lID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUyKSB7CiAgICB2YXIgcnVudGltZTIgPSBmdW5jdGlvbihleHBvcnRzMikgewogICAgICB2YXIgT3AgPSBPYmplY3QucHJvdG90eXBlOwogICAgICB2YXIgaGFzT3duID0gT3AuaGFzT3duUHJvcGVydHk7CiAgICAgIHZhciB1bmRlZmluZWQkMTsKICAgICAgdmFyICRTeW1ib2wgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iID8gU3ltYm9sIDoge307CiAgICAgIHZhciBpdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuaXRlcmF0b3IgfHwgIkBAaXRlcmF0b3IiOwogICAgICB2YXIgYXN5bmNJdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuYXN5bmNJdGVyYXRvciB8fCAiQEBhc3luY0l0ZXJhdG9yIjsKICAgICAgdmFyIHRvU3RyaW5nVGFnU3ltYm9sID0gJFN5bWJvbC50b1N0cmluZ1RhZyB8fCAiQEB0b1N0cmluZ1RhZyI7CiAgICAgIGZ1bmN0aW9uIGRlZmluZShvYmosIGtleSwgdmFsdWUpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgICAgIHZhbHVlLAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIG9ialtrZXldOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgZGVmaW5lKHt9LCAiIik7CiAgICAgIH0gY2F0Y2ggKGVycjIpIHsKICAgICAgICBkZWZpbmUgPSBmdW5jdGlvbihvYmosIGtleSwgdmFsdWUpIHsKICAgICAgICAgIHJldHVybiBvYmpba2V5XSA9IHZhbHVlOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gd3JhcChpbm5lckZuLCBvdXRlckZuLCBzZWxmMiwgdHJ5TG9jc0xpc3QpIHsKICAgICAgICB2YXIgcHJvdG9HZW5lcmF0b3IgPSBvdXRlckZuICYmIG91dGVyRm4ucHJvdG90eXBlIGluc3RhbmNlb2YgR2VuZXJhdG9yID8gb3V0ZXJGbiA6IEdlbmVyYXRvcjsKICAgICAgICB2YXIgZ2VuZXJhdG9yID0gT2JqZWN0LmNyZWF0ZShwcm90b0dlbmVyYXRvci5wcm90b3R5cGUpOwogICAgICAgIHZhciBjb250ZXh0ID0gbmV3IENvbnRleHQodHJ5TG9jc0xpc3QgfHwgW10pOwogICAgICAgIGdlbmVyYXRvci5faW52b2tlID0gbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmMiwgY29udGV4dCk7CiAgICAgICAgcmV0dXJuIGdlbmVyYXRvcjsKICAgICAgfQogICAgICBleHBvcnRzMi53cmFwID0gd3JhcDsKICAgICAgZnVuY3Rpb24gdHJ5Q2F0Y2goZm4sIG9iaiwgYXJnKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiB7IHR5cGU6ICJub3JtYWwiLCBhcmc6IGZuLmNhbGwob2JqLCBhcmcpIH07CiAgICAgICAgfSBjYXRjaCAoZXJyMikgewogICAgICAgICAgcmV0dXJuIHsgdHlwZTogInRocm93IiwgYXJnOiBlcnIyIH07CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciBHZW5TdGF0ZVN1c3BlbmRlZFN0YXJ0ID0gInN1c3BlbmRlZFN0YXJ0IjsKICAgICAgdmFyIEdlblN0YXRlU3VzcGVuZGVkWWllbGQgPSAic3VzcGVuZGVkWWllbGQiOwogICAgICB2YXIgR2VuU3RhdGVFeGVjdXRpbmcgPSAiZXhlY3V0aW5nIjsKICAgICAgdmFyIEdlblN0YXRlQ29tcGxldGVkID0gImNvbXBsZXRlZCI7CiAgICAgIHZhciBDb250aW51ZVNlbnRpbmVsID0ge307CiAgICAgIGZ1bmN0aW9uIEdlbmVyYXRvcigpIHsKICAgICAgfQogICAgICBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHsKICAgICAgfQogICAgICBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSgpIHsKICAgICAgfQogICAgICB2YXIgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTsKICAgICAgZGVmaW5lKEl0ZXJhdG9yUHJvdG90eXBlLCBpdGVyYXRvclN5bWJvbCwgZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0pOwogICAgICB2YXIgZ2V0UHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Y7CiAgICAgIHZhciBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvICYmIGdldFByb3RvKGdldFByb3RvKHZhbHVlczIoW10pKSk7CiAgICAgIGlmIChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAmJiBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAhPT0gT3AgJiYgaGFzT3duLmNhbGwoTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sKSkgewogICAgICAgIEl0ZXJhdG9yUHJvdG90eXBlID0gTmF0aXZlSXRlcmF0b3JQcm90b3R5cGU7CiAgICAgIH0KICAgICAgdmFyIEdwID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlID0gR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUpOwogICAgICBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZTsKICAgICAgZGVmaW5lKEdwLCAiY29uc3RydWN0b3IiLCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSk7CiAgICAgIGRlZmluZShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgImNvbnN0cnVjdG9yIiwgR2VuZXJhdG9yRnVuY3Rpb24pOwogICAgICBHZW5lcmF0b3JGdW5jdGlvbi5kaXNwbGF5TmFtZSA9IGRlZmluZShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgdG9TdHJpbmdUYWdTeW1ib2wsICJHZW5lcmF0b3JGdW5jdGlvbiIpOwogICAgICBmdW5jdGlvbiBkZWZpbmVJdGVyYXRvck1ldGhvZHMocHJvdG90eXBlKSB7CiAgICAgICAgWyJuZXh0IiwgInRocm93IiwgInJldHVybiJdLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7CiAgICAgICAgICBkZWZpbmUocHJvdG90eXBlLCBtZXRob2QsIGZ1bmN0aW9uKGFyZykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgYXJnKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGV4cG9ydHMyLmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBmdW5jdGlvbihnZW5GdW4pIHsKICAgICAgICB2YXIgY3RvciA9IHR5cGVvZiBnZW5GdW4gPT09ICJmdW5jdGlvbiIgJiYgZ2VuRnVuLmNvbnN0cnVjdG9yOwogICAgICAgIHJldHVybiBjdG9yID8gY3RvciA9PT0gR2VuZXJhdG9yRnVuY3Rpb24gfHwgKGN0b3IuZGlzcGxheU5hbWUgfHwgY3Rvci5uYW1lKSA9PT0gIkdlbmVyYXRvckZ1bmN0aW9uIiA6IGZhbHNlOwogICAgICB9OwogICAgICBleHBvcnRzMi5tYXJrID0gZnVuY3Rpb24oZ2VuRnVuKSB7CiAgICAgICAgaWYgKE9iamVjdC5zZXRQcm90b3R5cGVPZikgewogICAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKGdlbkZ1biwgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBnZW5GdW4uX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGU7CiAgICAgICAgICBkZWZpbmUoZ2VuRnVuLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvckZ1bmN0aW9uIik7CiAgICAgICAgfQogICAgICAgIGdlbkZ1bi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEdwKTsKICAgICAgICByZXR1cm4gZ2VuRnVuOwogICAgICB9OwogICAgICBleHBvcnRzMi5hd3JhcCA9IGZ1bmN0aW9uKGFyZykgewogICAgICAgIHJldHVybiB7IF9fYXdhaXQ6IGFyZyB9OwogICAgICB9OwogICAgICBmdW5jdGlvbiBBc3luY0l0ZXJhdG9yKGdlbmVyYXRvciwgUHJvbWlzZUltcGwpIHsKICAgICAgICBmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgdmFyIHJlY29yZCA9IHRyeUNhdGNoKGdlbmVyYXRvclttZXRob2RdLCBnZW5lcmF0b3IsIGFyZyk7CiAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgcmVqZWN0KHJlY29yZC5hcmcpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHJlY29yZC5hcmc7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHJlc3VsdC52YWx1ZTsKICAgICAgICAgICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYgaGFzT3duLmNhbGwodmFsdWUsICJfX2F3YWl0IikpIHsKICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZUltcGwucmVzb2x2ZSh2YWx1ZS5fX2F3YWl0KS50aGVuKGZ1bmN0aW9uKHZhbHVlMikgewogICAgICAgICAgICAgICAgaW52b2tlKCJuZXh0IiwgdmFsdWUyLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycjIpIHsKICAgICAgICAgICAgICAgIGludm9rZSgidGhyb3ciLCBlcnIyLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBQcm9taXNlSW1wbC5yZXNvbHZlKHZhbHVlKS50aGVuKGZ1bmN0aW9uKHVud3JhcHBlZCkgewogICAgICAgICAgICAgIHJlc3VsdC52YWx1ZSA9IHVud3JhcHBlZDsKICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGludm9rZSgidGhyb3ciLCBlcnJvciwgcmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBwcmV2aW91c1Byb21pc2U7CiAgICAgICAgZnVuY3Rpb24gZW5xdWV1ZShtZXRob2QsIGFyZykgewogICAgICAgICAgZnVuY3Rpb24gY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZUltcGwoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBwcmV2aW91c1Byb21pc2UgPSBwcmV2aW91c1Byb21pc2UgPyBwcmV2aW91c1Byb21pc2UudGhlbihjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZywgY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcpIDogY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5faW52b2tlID0gZW5xdWV1ZTsKICAgICAgfQogICAgICBkZWZpbmVJdGVyYXRvck1ldGhvZHMoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUpOwogICAgICBkZWZpbmUoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUsIGFzeW5jSXRlcmF0b3JTeW1ib2wsIGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9KTsKICAgICAgZXhwb3J0czIuQXN5bmNJdGVyYXRvciA9IEFzeW5jSXRlcmF0b3I7CiAgICAgIGV4cG9ydHMyLmFzeW5jID0gZnVuY3Rpb24oaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZjIsIHRyeUxvY3NMaXN0LCBQcm9taXNlSW1wbCkgewogICAgICAgIGlmIChQcm9taXNlSW1wbCA9PT0gdm9pZCAwKQogICAgICAgICAgUHJvbWlzZUltcGwgPSBQcm9taXNlOwogICAgICAgIHZhciBpdGVyID0gbmV3IEFzeW5jSXRlcmF0b3Iod3JhcChpbm5lckZuLCBvdXRlckZuLCBzZWxmMiwgdHJ5TG9jc0xpc3QpLCBQcm9taXNlSW1wbCk7CiAgICAgICAgcmV0dXJuIGV4cG9ydHMyLmlzR2VuZXJhdG9yRnVuY3Rpb24ob3V0ZXJGbikgPyBpdGVyIDogaXRlci5uZXh0KCkudGhlbihmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgICAgIHJldHVybiByZXN1bHQuZG9uZSA/IHJlc3VsdC52YWx1ZSA6IGl0ZXIubmV4dCgpOwogICAgICAgIH0pOwogICAgICB9OwogICAgICBmdW5jdGlvbiBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYyLCBjb250ZXh0KSB7CiAgICAgICAgdmFyIHN0YXRlID0gR2VuU3RhdGVTdXNwZW5kZWRTdGFydDsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gaW52b2tlKG1ldGhvZCwgYXJnKSB7CiAgICAgICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlRXhlY3V0aW5nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlID09PSBHZW5TdGF0ZUNvbXBsZXRlZCkgewogICAgICAgICAgICBpZiAobWV0aG9kID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgdGhyb3cgYXJnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBkb25lUmVzdWx0KCk7CiAgICAgICAgICB9CiAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9IG1ldGhvZDsKICAgICAgICAgIGNvbnRleHQuYXJnID0gYXJnOwogICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgdmFyIGRlbGVnYXRlID0gY29udGV4dC5kZWxlZ2F0ZTsKICAgICAgICAgICAgaWYgKGRlbGVnYXRlKSB7CiAgICAgICAgICAgICAgdmFyIGRlbGVnYXRlUmVzdWx0ID0gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCk7CiAgICAgICAgICAgICAgaWYgKGRlbGVnYXRlUmVzdWx0KSB7CiAgICAgICAgICAgICAgICBpZiAoZGVsZWdhdGVSZXN1bHQgPT09IENvbnRpbnVlU2VudGluZWwpCiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgcmV0dXJuIGRlbGVnYXRlUmVzdWx0OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09ICJuZXh0IikgewogICAgICAgICAgICAgIGNvbnRleHQuc2VudCA9IGNvbnRleHQuX3NlbnQgPSBjb250ZXh0LmFyZzsKICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZXh0Lm1ldGhvZCA9PT0gInRocm93IikgewogICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gR2VuU3RhdGVTdXNwZW5kZWRTdGFydCkgewogICAgICAgICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUNvbXBsZXRlZDsKICAgICAgICAgICAgICAgIHRocm93IGNvbnRleHQuYXJnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb250ZXh0LmRpc3BhdGNoRXhjZXB0aW9uKGNvbnRleHQuYXJnKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChjb250ZXh0Lm1ldGhvZCA9PT0gInJldHVybiIpIHsKICAgICAgICAgICAgICBjb250ZXh0LmFicnVwdCgicmV0dXJuIiwgY29udGV4dC5hcmcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlID0gR2VuU3RhdGVFeGVjdXRpbmc7CiAgICAgICAgICAgIHZhciByZWNvcmQgPSB0cnlDYXRjaChpbm5lckZuLCBzZWxmMiwgY29udGV4dCk7CiAgICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gIm5vcm1hbCIpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IGNvbnRleHQuZG9uZSA/IEdlblN0YXRlQ29tcGxldGVkIDogR2VuU3RhdGVTdXNwZW5kZWRZaWVsZDsKICAgICAgICAgICAgICBpZiAocmVjb3JkLmFyZyA9PT0gQ29udGludWVTZW50aW5lbCkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB2YWx1ZTogcmVjb3JkLmFyZywKICAgICAgICAgICAgICAgIGRvbmU6IGNvbnRleHQuZG9uZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVjb3JkLnR5cGUgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IEdlblN0YXRlQ29tcGxldGVkOwogICAgICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gInRocm93IjsKICAgICAgICAgICAgICBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmc7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpIHsKICAgICAgICB2YXIgbWV0aG9kID0gZGVsZWdhdGUuaXRlcmF0b3JbY29udGV4dC5tZXRob2RdOwogICAgICAgIGlmIChtZXRob2QgPT09IHVuZGVmaW5lZCQxKSB7CiAgICAgICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDsKICAgICAgICAgIGlmIChjb250ZXh0Lm1ldGhvZCA9PT0gInRocm93IikgewogICAgICAgICAgICBpZiAoZGVsZWdhdGUuaXRlcmF0b3JbInJldHVybiJdKSB7CiAgICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAicmV0dXJuIjsKICAgICAgICAgICAgICBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCQxOwogICAgICAgICAgICAgIG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpOwogICAgICAgICAgICAgIGlmIChjb250ZXh0Lm1ldGhvZCA9PT0gInRocm93IikgewogICAgICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gInRocm93IjsKICAgICAgICAgICAgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhICd0aHJvdycgbWV0aG9kIik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICB9CiAgICAgICAgdmFyIHJlY29yZCA9IHRyeUNhdGNoKG1ldGhvZCwgZGVsZWdhdGUuaXRlcmF0b3IsIGNvbnRleHQuYXJnKTsKICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09ICJ0aHJvdyIpIHsKICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gInRocm93IjsKICAgICAgICAgIGNvbnRleHQuYXJnID0gcmVjb3JkLmFyZzsKICAgICAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsOwogICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgfQogICAgICAgIHZhciBpbmZvID0gcmVjb3JkLmFyZzsKICAgICAgICBpZiAoIWluZm8pIHsKICAgICAgICAgIGNvbnRleHQubWV0aG9kID0gInRocm93IjsKICAgICAgICAgIGNvbnRleHQuYXJnID0gbmV3IFR5cGVFcnJvcigiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3QiKTsKICAgICAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsOwogICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CiAgICAgICAgfQogICAgICAgIGlmIChpbmZvLmRvbmUpIHsKICAgICAgICAgIGNvbnRleHRbZGVsZWdhdGUucmVzdWx0TmFtZV0gPSBpbmZvLnZhbHVlOwogICAgICAgICAgY29udGV4dC5uZXh0ID0gZGVsZWdhdGUubmV4dExvYzsKICAgICAgICAgIGlmIChjb250ZXh0Lm1ldGhvZCAhPT0gInJldHVybiIpIHsKICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAibmV4dCI7CiAgICAgICAgICAgIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkJDE7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBpbmZvOwogICAgICAgIH0KICAgICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDsKICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgfQogICAgICBkZWZpbmVJdGVyYXRvck1ldGhvZHMoR3ApOwogICAgICBkZWZpbmUoR3AsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yIik7CiAgICAgIGRlZmluZShHcCwgaXRlcmF0b3JTeW1ib2wsIGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9KTsKICAgICAgZGVmaW5lKEdwLCAidG9TdHJpbmciLCBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gIltvYmplY3QgR2VuZXJhdG9yXSI7CiAgICAgIH0pOwogICAgICBmdW5jdGlvbiBwdXNoVHJ5RW50cnkobG9jcykgewogICAgICAgIHZhciBlbnRyeSA9IHsgdHJ5TG9jOiBsb2NzWzBdIH07CiAgICAgICAgaWYgKDEgaW4gbG9jcykgewogICAgICAgICAgZW50cnkuY2F0Y2hMb2MgPSBsb2NzWzFdOwogICAgICAgIH0KICAgICAgICBpZiAoMiBpbiBsb2NzKSB7CiAgICAgICAgICBlbnRyeS5maW5hbGx5TG9jID0gbG9jc1syXTsKICAgICAgICAgIGVudHJ5LmFmdGVyTG9jID0gbG9jc1szXTsKICAgICAgICB9CiAgICAgICAgdGhpcy50cnlFbnRyaWVzLnB1c2goZW50cnkpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkoZW50cnkpIHsKICAgICAgICB2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbiB8fCB7fTsKICAgICAgICByZWNvcmQudHlwZSA9ICJub3JtYWwiOwogICAgICAgIGRlbGV0ZSByZWNvcmQuYXJnOwogICAgICAgIGVudHJ5LmNvbXBsZXRpb24gPSByZWNvcmQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gQ29udGV4dCh0cnlMb2NzTGlzdCkgewogICAgICAgIHRoaXMudHJ5RW50cmllcyA9IFt7IHRyeUxvYzogInJvb3QiIH1dOwogICAgICAgIHRyeUxvY3NMaXN0LmZvckVhY2gocHVzaFRyeUVudHJ5LCB0aGlzKTsKICAgICAgICB0aGlzLnJlc2V0KHRydWUpOwogICAgICB9CiAgICAgIGV4cG9ydHMyLmtleXMgPSBmdW5jdGlvbihvYmplY3QpIHsKICAgICAgICB2YXIga2V5czIgPSBbXTsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7CiAgICAgICAgICBrZXlzMi5wdXNoKGtleSk7CiAgICAgICAgfQogICAgICAgIGtleXMyLnJldmVyc2UoKTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICAgIHdoaWxlIChrZXlzMi5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGtleTIgPSBrZXlzMi5wb3AoKTsKICAgICAgICAgICAgaWYgKGtleTIgaW4gb2JqZWN0KSB7CiAgICAgICAgICAgICAgbmV4dC52YWx1ZSA9IGtleTI7CiAgICAgICAgICAgICAgbmV4dC5kb25lID0gZmFsc2U7CiAgICAgICAgICAgICAgcmV0dXJuIG5leHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIG5leHQuZG9uZSA9IHRydWU7CiAgICAgICAgICByZXR1cm4gbmV4dDsKICAgICAgICB9OwogICAgICB9OwogICAgICBmdW5jdGlvbiB2YWx1ZXMyKGl0ZXJhYmxlKSB7CiAgICAgICAgaWYgKGl0ZXJhYmxlKSB7CiAgICAgICAgICB2YXIgaXRlcmF0b3JNZXRob2QgPSBpdGVyYWJsZVtpdGVyYXRvclN5bWJvbF07CiAgICAgICAgICBpZiAoaXRlcmF0b3JNZXRob2QpIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZXJhdG9yTWV0aG9kLmNhbGwoaXRlcmFibGUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGVvZiBpdGVyYWJsZS5uZXh0ID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVyYWJsZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghaXNOYU4oaXRlcmFibGUubGVuZ3RoKSkgewogICAgICAgICAgICB2YXIgaSA9IC0xLCBuZXh0ID0gZnVuY3Rpb24gbmV4dDIoKSB7CiAgICAgICAgICAgICAgd2hpbGUgKCsraSA8IGl0ZXJhYmxlLmxlbmd0aCkgewogICAgICAgICAgICAgICAgaWYgKGhhc093bi5jYWxsKGl0ZXJhYmxlLCBpKSkgewogICAgICAgICAgICAgICAgICBuZXh0Mi52YWx1ZSA9IGl0ZXJhYmxlW2ldOwogICAgICAgICAgICAgICAgICBuZXh0Mi5kb25lID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHJldHVybiBuZXh0MjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbmV4dDIudmFsdWUgPSB1bmRlZmluZWQkMTsKICAgICAgICAgICAgICBuZXh0Mi5kb25lID0gdHJ1ZTsKICAgICAgICAgICAgICByZXR1cm4gbmV4dDI7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBuZXh0Lm5leHQgPSBuZXh0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4geyBuZXh0OiBkb25lUmVzdWx0IH07CiAgICAgIH0KICAgICAgZXhwb3J0czIudmFsdWVzID0gdmFsdWVzMjsKICAgICAgZnVuY3Rpb24gZG9uZVJlc3VsdCgpIHsKICAgICAgICByZXR1cm4geyB2YWx1ZTogdW5kZWZpbmVkJDEsIGRvbmU6IHRydWUgfTsKICAgICAgfQogICAgICBDb250ZXh0LnByb3RvdHlwZSA9IHsKICAgICAgICBjb25zdHJ1Y3RvcjogQ29udGV4dCwKICAgICAgICByZXNldDogZnVuY3Rpb24oc2tpcFRlbXBSZXNldCkgewogICAgICAgICAgdGhpcy5wcmV2ID0gMDsKICAgICAgICAgIHRoaXMubmV4dCA9IDA7CiAgICAgICAgICB0aGlzLnNlbnQgPSB0aGlzLl9zZW50ID0gdW5kZWZpbmVkJDE7CiAgICAgICAgICB0aGlzLmRvbmUgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuZGVsZWdhdGUgPSBudWxsOwogICAgICAgICAgdGhpcy5tZXRob2QgPSAibmV4dCI7CiAgICAgICAgICB0aGlzLmFyZyA9IHVuZGVmaW5lZCQxOwogICAgICAgICAgdGhpcy50cnlFbnRyaWVzLmZvckVhY2gocmVzZXRUcnlFbnRyeSk7CiAgICAgICAgICBpZiAoIXNraXBUZW1wUmVzZXQpIHsKICAgICAgICAgICAgZm9yICh2YXIgbmFtZSBpbiB0aGlzKSB7CiAgICAgICAgICAgICAgaWYgKG5hbWUuY2hhckF0KDApID09PSAidCIgJiYgaGFzT3duLmNhbGwodGhpcywgbmFtZSkgJiYgIWlzTmFOKCtuYW1lLnNsaWNlKDEpKSkgewogICAgICAgICAgICAgICAgdGhpc1tuYW1lXSA9IHVuZGVmaW5lZCQxOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgICAgICB0aGlzLmRvbmUgPSB0cnVlOwogICAgICAgICAgdmFyIHJvb3RFbnRyeSA9IHRoaXMudHJ5RW50cmllc1swXTsKICAgICAgICAgIHZhciByb290UmVjb3JkID0gcm9vdEVudHJ5LmNvbXBsZXRpb247CiAgICAgICAgICBpZiAocm9vdFJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgIHRocm93IHJvb3RSZWNvcmQuYXJnOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRoaXMucnZhbDsKICAgICAgICB9LAogICAgICAgIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbihleGNlcHRpb24pIHsKICAgICAgICAgIGlmICh0aGlzLmRvbmUpIHsKICAgICAgICAgICAgdGhyb3cgZXhjZXB0aW9uOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzOwogICAgICAgICAgZnVuY3Rpb24gaGFuZGxlKGxvYywgY2F1Z2h0KSB7CiAgICAgICAgICAgIHJlY29yZC50eXBlID0gInRocm93IjsKICAgICAgICAgICAgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbjsKICAgICAgICAgICAgY29udGV4dC5uZXh0ID0gbG9jOwogICAgICAgICAgICBpZiAoY2F1Z2h0KSB7CiAgICAgICAgICAgICAgY29udGV4dC5tZXRob2QgPSAibmV4dCI7CiAgICAgICAgICAgICAgY29udGV4dC5hcmcgPSB1bmRlZmluZWQkMTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gISFjYXVnaHQ7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgIHZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTsKICAgICAgICAgICAgdmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247CiAgICAgICAgICAgIGlmIChlbnRyeS50cnlMb2MgPT09ICJyb290IikgewogICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoImVuZCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2KSB7CiAgICAgICAgICAgICAgdmFyIGhhc0NhdGNoID0gaGFzT3duLmNhbGwoZW50cnksICJjYXRjaExvYyIpOwogICAgICAgICAgICAgIHZhciBoYXNGaW5hbGx5ID0gaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIik7CiAgICAgICAgICAgICAgaWYgKGhhc0NhdGNoICYmIGhhc0ZpbmFsbHkpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBlbnRyeS5jYXRjaExvYykgewogICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgewogICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlKGVudHJ5LmZpbmFsbHlMb2MpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzQ2F0Y2gpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBlbnRyeS5jYXRjaExvYykgewogICAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhhc0ZpbmFsbHkpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHkiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFicnVwdDogZnVuY3Rpb24odHlwZSwgYXJnKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgIHZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTsKICAgICAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYgJiYgaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIikgJiYgdGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgewogICAgICAgICAgICAgIHZhciBmaW5hbGx5RW50cnkgPSBlbnRyeTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGZpbmFsbHlFbnRyeSAmJiAodHlwZSA9PT0gImJyZWFrIiB8fCB0eXBlID09PSAiY29udGludWUiKSAmJiBmaW5hbGx5RW50cnkudHJ5TG9jIDw9IGFyZyAmJiBhcmcgPD0gZmluYWxseUVudHJ5LmZpbmFsbHlMb2MpIHsKICAgICAgICAgICAgZmluYWxseUVudHJ5ID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHZhciByZWNvcmQgPSBmaW5hbGx5RW50cnkgPyBmaW5hbGx5RW50cnkuY29tcGxldGlvbiA6IHt9OwogICAgICAgICAgcmVjb3JkLnR5cGUgPSB0eXBlOwogICAgICAgICAgcmVjb3JkLmFyZyA9IGFyZzsKICAgICAgICAgIGlmIChmaW5hbGx5RW50cnkpIHsKICAgICAgICAgICAgdGhpcy5tZXRob2QgPSAibmV4dCI7CiAgICAgICAgICAgIHRoaXMubmV4dCA9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jOwogICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBsZXRlKHJlY29yZCk7CiAgICAgICAgfSwKICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24ocmVjb3JkLCBhZnRlckxvYykgewogICAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgIHRocm93IHJlY29yZC5hcmc7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09ICJicmVhayIgfHwgcmVjb3JkLnR5cGUgPT09ICJjb250aW51ZSIpIHsKICAgICAgICAgICAgdGhpcy5uZXh0ID0gcmVjb3JkLmFyZzsKICAgICAgICAgIH0gZWxzZSBpZiAocmVjb3JkLnR5cGUgPT09ICJyZXR1cm4iKSB7CiAgICAgICAgICAgIHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgdGhpcy5tZXRob2QgPSAicmV0dXJuIjsKICAgICAgICAgICAgdGhpcy5uZXh0ID0gImVuZCI7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSAibm9ybWFsIiAmJiBhZnRlckxvYykgewogICAgICAgICAgICB0aGlzLm5leHQgPSBhZnRlckxvYzsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsOwogICAgICAgIH0sCiAgICAgICAgZmluaXNoOiBmdW5jdGlvbihmaW5hbGx5TG9jKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgIHZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTsKICAgICAgICAgICAgaWYgKGVudHJ5LmZpbmFsbHlMb2MgPT09IGZpbmFsbHlMb2MpIHsKICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlKGVudHJ5LmNvbXBsZXRpb24sIGVudHJ5LmFmdGVyTG9jKTsKICAgICAgICAgICAgICByZXNldFRyeUVudHJ5KGVudHJ5KTsKICAgICAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgImNhdGNoIjogZnVuY3Rpb24odHJ5TG9jKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgIHZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTsKICAgICAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA9PT0gdHJ5TG9jKSB7CiAgICAgICAgICAgICAgdmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247CiAgICAgICAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSAidGhyb3ciKSB7CiAgICAgICAgICAgICAgICB2YXIgdGhyb3duID0gcmVjb3JkLmFyZzsKICAgICAgICAgICAgICAgIHJlc2V0VHJ5RW50cnkoZW50cnkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gdGhyb3duOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdCIpOwogICAgICAgIH0sCiAgICAgICAgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24oaXRlcmFibGUsIHJlc3VsdE5hbWUsIG5leHRMb2MpIHsKICAgICAgICAgIHRoaXMuZGVsZWdhdGUgPSB7CiAgICAgICAgICAgIGl0ZXJhdG9yOiB2YWx1ZXMyKGl0ZXJhYmxlKSwKICAgICAgICAgICAgcmVzdWx0TmFtZSwKICAgICAgICAgICAgbmV4dExvYwogICAgICAgICAgfTsKICAgICAgICAgIGlmICh0aGlzLm1ldGhvZCA9PT0gIm5leHQiKSB7CiAgICAgICAgICAgIHRoaXMuYXJnID0gdW5kZWZpbmVkJDE7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHJldHVybiBleHBvcnRzMjsKICAgIH0obW9kdWxlMi5leHBvcnRzKTsKICAgIHRyeSB7CiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZSA9IHJ1bnRpbWUyOwogICAgfSBjYXRjaCAoYWNjaWRlbnRhbFN0cmljdE1vZGUpIHsKICAgICAgaWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAib2JqZWN0IikgewogICAgICAgIGdsb2JhbFRoaXMucmVnZW5lcmF0b3JSdW50aW1lID0gcnVudGltZTI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgRnVuY3Rpb24oInIiLCAicmVnZW5lcmF0b3JSdW50aW1lID0gciIpKHJ1bnRpbWUyKTsKICAgICAgfQogICAgfQogIH0pKHJ1bnRpbWUpOwogIHZhciByZWdlbmVyYXRvciA9IHJ1bnRpbWUuZXhwb3J0czsKICB2YXIgYXN5bmNUb0dlbmVyYXRvciA9IHsgZXhwb3J0czoge30gfTsKICAoZnVuY3Rpb24obW9kdWxlMikgewogICAgZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgewogICAgICB0cnkgewogICAgICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsKICAgICAgICB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChpbmZvLmRvbmUpIHsKICAgICAgICByZXNvbHZlKHZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgc2VsZjIgPSB0aGlzLCBhcmdzID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICAgIHZhciBnZW4gPSBmbi5hcHBseShzZWxmMiwgYXJncyk7CiAgICAgICAgICBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgewogICAgICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gX3Rocm93KGVycjIpIHsKICAgICAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIyKTsKICAgICAgICAgIH0KICAgICAgICAgIF9uZXh0KHZvaWQgMCk7CiAgICAgICAgfSk7CiAgICAgIH07CiAgICB9CiAgICBtb2R1bGUyLmV4cG9ydHMgPSBfYXN5bmNUb0dlbmVyYXRvcjsKICAgIG1vZHVsZTIuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlMi5leHBvcnRzLCBtb2R1bGUyLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSkoYXN5bmNUb0dlbmVyYXRvcik7CiAgdmFyIGNsYXNzQ2FsbENoZWNrID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUyKSB7CiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2szKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogICAgICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgICB9CiAgICB9CiAgICBtb2R1bGUyLmV4cG9ydHMgPSBfY2xhc3NDYWxsQ2hlY2szOwogICAgbW9kdWxlMi5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUyLmV4cG9ydHMsIG1vZHVsZTIuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShjbGFzc0NhbGxDaGVjayk7CiAgdmFyIGNyZWF0ZUNsYXNzID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUyKSB7CiAgICBmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllczIodGFyZ2V0LCBwcm9wcykgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpCiAgICAgICAgICBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIF9jcmVhdGVDbGFzczMoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgICAgIGlmIChwcm90b1Byb3BzKQogICAgICAgIF9kZWZpbmVQcm9wZXJ0aWVzMihDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogICAgICBpZiAoc3RhdGljUHJvcHMpCiAgICAgICAgX2RlZmluZVByb3BlcnRpZXMyKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICAgIH0KICAgIG1vZHVsZTIuZXhwb3J0cyA9IF9jcmVhdGVDbGFzczM7CiAgICBtb2R1bGUyLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZTIuZXhwb3J0cywgbW9kdWxlMi5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKGNyZWF0ZUNsYXNzKTsKICB2YXIgZGVmaW5lUHJvcGVydHkgPSB7IGV4cG9ydHM6IHt9IH07CiAgKGZ1bmN0aW9uKG1vZHVsZTIpIHsKICAgIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICAgICAgaWYgKGtleSBpbiBvYmopIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgICAgIHZhbHVlLAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb2JqW2tleV0gPSB2YWx1ZTsKICAgICAgfQogICAgICByZXR1cm4gb2JqOwogICAgfQogICAgbW9kdWxlMi5leHBvcnRzID0gX2RlZmluZVByb3BlcnR5OwogICAgbW9kdWxlMi5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUyLmV4cG9ydHMsIG1vZHVsZTIuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShkZWZpbmVQcm9wZXJ0eSk7CiAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkNSA9IGludGVyb3BSZXF1aXJlRGVmYXVsdC5leHBvcnRzOwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZW1vdGVGaWxlLCAiX19lc01vZHVsZSIsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CiAgcmVtb3RlRmlsZS5kZWZhdWx0ID0gdm9pZCAwOwogIHZhciBfcmVnZW5lcmF0b3IkNSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkNShyZWdlbmVyYXRvcik7CiAgdmFyIF9hc3luY1RvR2VuZXJhdG9yMiQ1ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQ1KGFzeW5jVG9HZW5lcmF0b3IuZXhwb3J0cyk7CiAgdmFyIF9jbGFzc0NhbGxDaGVjazIkNCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkNShjbGFzc0NhbGxDaGVjay5leHBvcnRzKTsKICB2YXIgX2NyZWF0ZUNsYXNzMiQ0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQ1KGNyZWF0ZUNsYXNzLmV4cG9ydHMpOwogIHZhciBfZGVmaW5lUHJvcGVydHkyJDEgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDUoZGVmaW5lUHJvcGVydHkuZXhwb3J0cyk7CiAgdmFyIF9maWxlVXJpVG9QYXRoID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQ1KHJlcXVpcmUkJDUpOwogIHZhciBfID0gZGlzdCQxOwogIGZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewogICAgdmFyIGtleXMyID0gT2JqZWN0LmtleXMob2JqZWN0KTsKICAgIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICAgIHZhciBzeW1ib2xzMiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgICAgaWYgKGVudW1lcmFibGVPbmx5KQogICAgICAgIHN5bWJvbHMyID0gc3ltYm9sczIuZmlsdGVyKGZ1bmN0aW9uKHN5bSkgewogICAgICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICAgICAgfSk7CiAgICAgIGtleXMyLnB1c2guYXBwbHkoa2V5czIsIHN5bWJvbHMyKTsKICAgIH0KICAgIHJldHVybiBrZXlzMjsKICB9CiAgZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OwogICAgICBpZiAoaSAlIDIpIHsKICAgICAgICBvd25LZXlzKE9iamVjdChzb3VyY2UpLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIkMS5kZWZhdWx0KSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0YXJnZXQ7CiAgfQogIHZhciBteUdsb2JhbCA9IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiID8gd2luZG93IDogdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IHsKICAgIGZldGNoOiB2b2lkIDAKICB9OwogIHZhciBSZW1vdGVGaWxlJDEgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICAoMCwgX2NyZWF0ZUNsYXNzMiQ0LmRlZmF1bHQpKFJlbW90ZUZpbGUyLCBbewogICAgICBrZXk6ICJnZXRCdWZmZXJGcm9tUmVzcG9uc2UiLAogICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF9nZXRCdWZmZXJGcm9tUmVzcG9uc2UgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyJDUuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvciQ1LmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKHJlc3BvbnNlKSB7CiAgICAgICAgICB2YXIgcmVzcDsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IkNS5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIGlmICghKHR5cGVvZiByZXNwb25zZS5idWZmZXIgPT09ICJmdW5jdGlvbiIpKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgcmVzcG9uc2UuYnVmZmVyKCkpOwogICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICBpZiAoISh0eXBlb2YgcmVzcG9uc2UuYXJyYXlCdWZmZXIgPT09ICJmdW5jdGlvbiIpKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuYXJyYXlCdWZmZXIoKTsKICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgcmVzcCA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIEJ1ZmZlci5mcm9tKHJlc3ApKTsKICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImludmFsaWQgSFRUUCByZXNwb25zZSBvYmplY3QsIGhhcyBubyBidWZmZXIgbWV0aG9kLCBhbmQgbm8gYXJyYXlCdWZmZXIgbWV0aG9kIik7CiAgICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWUpOwogICAgICAgIH0pKTsKICAgICAgICBmdW5jdGlvbiBnZXRCdWZmZXJGcm9tUmVzcG9uc2UoX3gpIHsKICAgICAgICAgIHJldHVybiBfZ2V0QnVmZmVyRnJvbVJlc3BvbnNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBnZXRCdWZmZXJGcm9tUmVzcG9uc2U7CiAgICAgIH0oKQogICAgfV0pOwogICAgZnVuY3Rpb24gUmVtb3RlRmlsZTIoc291cmNlKSB7CiAgICAgIHZhciBvcHRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgICAgKDAsIF9jbGFzc0NhbGxDaGVjazIkNC5kZWZhdWx0KSh0aGlzLCBSZW1vdGVGaWxlMik7CiAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyJDEuZGVmYXVsdCkodGhpcywgInVybCIsIHZvaWQgMCk7CiAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyJDEuZGVmYXVsdCkodGhpcywgIl9zdGF0Iiwgdm9pZCAwKTsKICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIkMS5kZWZhdWx0KSh0aGlzLCAiZmV0Y2hJbXBsZW1lbnRhdGlvbiIsIHZvaWQgMCk7CiAgICAgICgwLCBfZGVmaW5lUHJvcGVydHkyJDEuZGVmYXVsdCkodGhpcywgImJhc2VPdmVycmlkZXMiLCB7fSk7CiAgICAgIHRoaXMudXJsID0gc291cmNlOwogICAgICBpZiAoc291cmNlLnN0YXJ0c1dpdGgoImZpbGU6Ly8iKSkgewogICAgICAgIHZhciBwYXRoID0gKDAsIF9maWxlVXJpVG9QYXRoLmRlZmF1bHQpKHNvdXJjZSk7CiAgICAgICAgaWYgKCFwYXRoKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnZhbGlkIGZpbGUgdXJsIik7CiAgICAgICAgfQogICAgICAgIHZhciBsb2NhbEZpbGUyID0gbmV3IF8uTG9jYWxGaWxlKHBhdGgpOwogICAgICAgIHRoaXMucmVhZCA9IGxvY2FsRmlsZTIucmVhZC5iaW5kKGxvY2FsRmlsZTIpOwogICAgICAgIHRoaXMucmVhZEZpbGUgPSBsb2NhbEZpbGUyLnJlYWRGaWxlLmJpbmQobG9jYWxGaWxlMik7CiAgICAgICAgdGhpcy5zdGF0ID0gbG9jYWxGaWxlMi5zdGF0LmJpbmQobG9jYWxGaWxlMik7CiAgICAgICAgdGhpcy5mZXRjaEltcGxlbWVudGF0aW9uID0gZnVuY3Rpb24oKSB7CiAgICAgICAgfTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIGZldGNoMiA9IG9wdHMuZmV0Y2ggfHwgbXlHbG9iYWwuZmV0Y2ggJiYgbXlHbG9iYWwuZmV0Y2guYmluZChteUdsb2JhbCk7CiAgICAgIGlmICghZmV0Y2gyKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigibm8gZmV0Y2ggZnVuY3Rpb24gc3VwcGxpZWQsIGFuZCBub25lIGZvdW5kIGluIGdsb2JhbCBlbnZpcm9ubWVudCIpOwogICAgICB9CiAgICAgIGlmIChvcHRzLm92ZXJyaWRlcykgewogICAgICAgIHRoaXMuYmFzZU92ZXJyaWRlcyA9IG9wdHMub3ZlcnJpZGVzOwogICAgICB9CiAgICAgIHRoaXMuZmV0Y2hJbXBsZW1lbnRhdGlvbiA9IGZldGNoMjsKICAgIH0KICAgICgwLCBfY3JlYXRlQ2xhc3MyJDQuZGVmYXVsdCkoUmVtb3RlRmlsZTIsIFt7CiAgICAgIGtleTogImZldGNoIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfZmV0Y2ggPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyJDUuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvciQ1LmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlMihpbnB1dCwgaW5pdDIpIHsKICAgICAgICAgIHZhciByZXNwb25zZTsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IkNS5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDA7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmV0Y2hJbXBsZW1lbnRhdGlvbihpbnB1dCwgaW5pdDIpOwogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSA2OwogICAgICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgICAgIGlmICghKF9jb250ZXh0Mi50MC5tZXNzYWdlID09PSAiRmFpbGVkIHRvIGZldGNoIikpIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE1OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiZ2VuZXJpYy1maWxlaGFuZGxlOiByZWZldGNoaW5nICIuY29uY2F0KGlucHV0LCAiIHRvIGF0dGVtcHQgdG8gd29yayBhcm91bmQgY2hyb21lIENPUlMgaGVhZGVyIGNhY2hpbmcgYnVnIikpOwogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mZXRjaEltcGxlbWVudGF0aW9uKGlucHV0LCBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGluaXQyKSwge30sIHsKICAgICAgICAgICAgICAgICAgICBjYWNoZTogInJlbG9hZCIKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICB0aHJvdyBfY29udGV4dDIudDA7CiAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgcmVzcG9uc2UpOwogICAgICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMsIFtbMCwgNl1dKTsKICAgICAgICB9KSk7CiAgICAgICAgZnVuY3Rpb24gZmV0Y2gyKF94MiwgX3gzKSB7CiAgICAgICAgICByZXR1cm4gX2ZldGNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmZXRjaDI7CiAgICAgIH0oKQogICAgfSwgewogICAgICBrZXk6ICJyZWFkIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfcmVhZCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIkNS5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yJDUuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKGJ1ZmZlcikgewogICAgICAgICAgdmFyIG9mZnNldCwgbGVuZ3RoLCBwb3NpdGlvbiwgb3B0cywgX29wdHMkaGVhZGVycywgaGVhZGVycywgc2lnbmFsLCBfb3B0cyRvdmVycmlkZXMsIG92ZXJyaWRlcywgYXJncywgcmVzcG9uc2UsIHJlc3BvbnNlRGF0YSwgYnl0ZXNDb3BpZWQsIHJlcywgc2l6ZU1hdGNoLCBfYXJnczMgPSBhcmd1bWVudHM7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDUuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gX2FyZ3MzLmxlbmd0aCA+IDEgJiYgX2FyZ3MzWzFdICE9PSB2b2lkIDAgPyBfYXJnczNbMV0gOiAwOwogICAgICAgICAgICAgICAgICBsZW5ndGggPSBfYXJnczMubGVuZ3RoID4gMiA/IF9hcmdzM1syXSA6IHZvaWQgMDsKICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSBfYXJnczMubGVuZ3RoID4gMyAmJiBfYXJnczNbM10gIT09IHZvaWQgMCA/IF9hcmdzM1szXSA6IDA7CiAgICAgICAgICAgICAgICAgIG9wdHMgPSBfYXJnczMubGVuZ3RoID4gNCAmJiBfYXJnczNbNF0gIT09IHZvaWQgMCA/IF9hcmdzM1s0XSA6IHt9OwogICAgICAgICAgICAgICAgICBfb3B0cyRoZWFkZXJzID0gb3B0cy5oZWFkZXJzLCBoZWFkZXJzID0gX29wdHMkaGVhZGVycyA9PT0gdm9pZCAwID8ge30gOiBfb3B0cyRoZWFkZXJzLCBzaWduYWwgPSBvcHRzLnNpZ25hbCwgX29wdHMkb3ZlcnJpZGVzID0gb3B0cy5vdmVycmlkZXMsIG92ZXJyaWRlcyA9IF9vcHRzJG92ZXJyaWRlcyA9PT0gdm9pZCAwID8ge30gOiBfb3B0cyRvdmVycmlkZXM7CiAgICAgICAgICAgICAgICAgIGlmIChsZW5ndGggPCBJbmZpbml0eSkgewogICAgICAgICAgICAgICAgICAgIGhlYWRlcnMucmFuZ2UgPSAiYnl0ZXM9Ii5jb25jYXQocG9zaXRpb24sICItIikuY29uY2F0KHBvc2l0aW9uICsgbGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChsZW5ndGggPT09IEluZmluaXR5ICYmIHBvc2l0aW9uICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVycy5yYW5nZSA9ICJieXRlcz0iLmNvbmNhdChwb3NpdGlvbiwgIi0iKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBhcmdzID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHRoaXMuYmFzZU92ZXJyaWRlcyksIG92ZXJyaWRlcyksIHt9LCB7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGhlYWRlcnMpLCBvdmVycmlkZXMuaGVhZGVycyksIHRoaXMuYmFzZU92ZXJyaWRlcy5oZWFkZXJzKSwKICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICJHRVQiLAogICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0OiAiZm9sbG93IiwKICAgICAgICAgICAgICAgICAgICBtb2RlOiAiY29ycyIsCiAgICAgICAgICAgICAgICAgICAgc2lnbmFsCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZldGNoKHRoaXMudXJsLCBhcmdzKTsKICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkhUVFAgIi5jb25jYXQocmVzcG9uc2Uuc3RhdHVzLCAiICIpLmNvbmNhdChyZXNwb25zZS5zdGF0dXNUZXh0KSk7CiAgICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgICBpZiAoIShyZXNwb25zZS5zdGF0dXMgPT09IDIwMCAmJiBwb3NpdGlvbiA9PT0gMCB8fCByZXNwb25zZS5zdGF0dXMgPT09IDIwNikpIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEJ1ZmZlckZyb21SZXNwb25zZShyZXNwb25zZSk7CiAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICByZXNwb25zZURhdGEgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICAgICAgYnl0ZXNDb3BpZWQgPSByZXNwb25zZURhdGEuY29weShidWZmZXIsIG9mZnNldCwgMCwgTWF0aC5taW4obGVuZ3RoLCByZXNwb25zZURhdGEubGVuZ3RoKSk7CiAgICAgICAgICAgICAgICAgIHJlcyA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCJjb250ZW50LXJhbmdlIik7CiAgICAgICAgICAgICAgICAgIHNpemVNYXRjaCA9IC9cLyhcZCspJC8uZXhlYyhyZXMgfHwgIiIpOwogICAgICAgICAgICAgICAgICBpZiAoc2l6ZU1hdGNoICYmIHNpemVNYXRjaFsxXSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXQgPSB7CiAgICAgICAgICAgICAgICAgICAgICBzaXplOiBwYXJzZUludChzaXplTWF0Y2hbMV0sIDEwKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgICBieXRlc1JlYWQ6IGJ5dGVzQ29waWVkLAogICAgICAgICAgICAgICAgICAgIGJ1ZmZlcgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICAgIGlmICghKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIke3RoaXMudXJsfSBmZXRjaCByZXR1cm5lZCBzdGF0dXMgMjAwLCBleHBlY3RlZCAyMDYiKTsKICAgICAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSFRUUCAiLmNvbmNhdChyZXNwb25zZS5zdGF0dXMsICIgZmV0Y2hpbmcgIikuY29uY2F0KHRoaXMudXJsKSk7CiAgICAgICAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgICAgfSkpOwogICAgICAgIGZ1bmN0aW9uIHJlYWQoX3g0KSB7CiAgICAgICAgICByZXR1cm4gX3JlYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlYWQ7CiAgICAgIH0oKQogICAgfSwgewogICAgICBrZXk6ICJyZWFkRmlsZSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX3JlYWRGaWxlID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMiQ1LmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IkNS5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoKSB7CiAgICAgICAgICB2YXIgb3B0aW9ucywgZW5jb2RpbmcsIG9wdHMsIF9vcHRzLCBfb3B0cyRoZWFkZXJzMiwgaGVhZGVycywgc2lnbmFsLCBfb3B0cyRvdmVycmlkZXMyLCBvdmVycmlkZXMsIGFyZ3MsIHJlc3BvbnNlLCBfYXJnczQgPSBhcmd1bWVudHM7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDUuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IF9hcmdzNC5sZW5ndGggPiAwICYmIF9hcmdzNFswXSAhPT0gdm9pZCAwID8gX2FyZ3M0WzBdIDoge307CiAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgICAgICBlbmNvZGluZyA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgb3B0cyA9IHt9OwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGVuY29kaW5nID0gb3B0aW9ucy5lbmNvZGluZzsKICAgICAgICAgICAgICAgICAgICBvcHRzID0gb3B0aW9uczsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3B0cy5lbmNvZGluZzsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBfb3B0cyA9IG9wdHMsIF9vcHRzJGhlYWRlcnMyID0gX29wdHMuaGVhZGVycywgaGVhZGVycyA9IF9vcHRzJGhlYWRlcnMyID09PSB2b2lkIDAgPyB7fSA6IF9vcHRzJGhlYWRlcnMyLCBzaWduYWwgPSBfb3B0cy5zaWduYWwsIF9vcHRzJG92ZXJyaWRlczIgPSBfb3B0cy5vdmVycmlkZXMsIG92ZXJyaWRlcyA9IF9vcHRzJG92ZXJyaWRlczIgPT09IHZvaWQgMCA/IHt9IDogX29wdHMkb3ZlcnJpZGVzMjsKICAgICAgICAgICAgICAgICAgYXJncyA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVycywKICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICJHRVQiLAogICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0OiAiZm9sbG93IiwKICAgICAgICAgICAgICAgICAgICBtb2RlOiAiY29ycyIsCiAgICAgICAgICAgICAgICAgICAgc2lnbmFsCiAgICAgICAgICAgICAgICAgIH0sIHRoaXMuYmFzZU92ZXJyaWRlcyksIG92ZXJyaWRlcyk7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmV0Y2godGhpcy51cmwsIGFyZ3MpOwogICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJnZW5lcmljLWZpbGVoYW5kbGUgZmFpbGVkIHRvIGZldGNoIik7CiAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgIGlmICghKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhyb3cgT2JqZWN0LmFzc2lnbihuZXcgRXJyb3IoIkhUVFAgIi5jb25jYXQocmVzcG9uc2Uuc3RhdHVzLCAiIGZldGNoaW5nICIpLmNvbmNhdCh0aGlzLnVybCkpLCB7CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICBpZiAoIShlbmNvZGluZyA9PT0gInV0ZjgiKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIHJlc3BvbnNlLnRleHQoKSk7CiAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICBpZiAoIWVuY29kaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxNTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInVuc3VwcG9ydGVkIGVuY29kaW5nOiAiLmNvbmNhdChlbmNvZGluZykpOwogICAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIHRoaXMuZ2V0QnVmZmVyRnJvbVJlc3BvbnNlKHJlc3BvbnNlKSk7CiAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgICAgfSkpOwogICAgICAgIGZ1bmN0aW9uIHJlYWRGaWxlKCkgewogICAgICAgICAgcmV0dXJuIF9yZWFkRmlsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVhZEZpbGU7CiAgICAgIH0oKQogICAgfSwgewogICAgICBrZXk6ICJzdGF0IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfc3RhdCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIkNS5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yJDUuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KCkgewogICAgICAgICAgdmFyIGJ1ZjsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IkNS5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICBpZiAodGhpcy5fc3RhdCkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBidWYgPSBCdWZmZXIuYWxsb2NVbnNhZmUoMTApOwogICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlYWQoYnVmLCAwLCAxMCwgMCk7CiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zdGF0KSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidW5hYmxlIHRvIGRldGVybWluZSBzaXplIG9mIGZpbGUgYXQgIi5jb25jYXQodGhpcy51cmwpKTsKICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHRoaXMuX3N0YXQpOwogICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlNSwgdGhpcyk7CiAgICAgICAgfSkpOwogICAgICAgIGZ1bmN0aW9uIHN0YXQoKSB7CiAgICAgICAgICByZXR1cm4gX3N0YXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0YXQ7CiAgICAgIH0oKQogICAgfSwgewogICAgICBrZXk6ICJjbG9zZSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX2Nsb3NlID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMiQ1LmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IkNS5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoKSB7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDUuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIpOwogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LCBfY2FsbGVlNik7CiAgICAgICAgfSkpOwogICAgICAgIGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgcmV0dXJuIF9jbG9zZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2xvc2U7CiAgICAgIH0oKQogICAgfV0pOwogICAgcmV0dXJuIFJlbW90ZUZpbGUyOwogIH0oKTsKICByZW1vdGVGaWxlLmRlZmF1bHQgPSBSZW1vdGVGaWxlJDE7CiAgdmFyIGJsb2JGaWxlID0ge307CiAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkNCA9IGludGVyb3BSZXF1aXJlRGVmYXVsdC5leHBvcnRzOwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShibG9iRmlsZSwgIl9fZXNNb2R1bGUiLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwogIGJsb2JGaWxlLmRlZmF1bHQgPSB2b2lkIDA7CiAgdmFyIF9yZWdlbmVyYXRvciQ0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQ0KHJlZ2VuZXJhdG9yKTsKICB2YXIgX2FzeW5jVG9HZW5lcmF0b3IyJDQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDQoYXN5bmNUb0dlbmVyYXRvci5leHBvcnRzKTsKICB2YXIgX2NsYXNzQ2FsbENoZWNrMiQzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQ0KGNsYXNzQ2FsbENoZWNrLmV4cG9ydHMpOwogIHZhciBfY3JlYXRlQ2xhc3MyJDMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDQoY3JlYXRlQ2xhc3MuZXhwb3J0cyk7CiAgdmFyIF9kZWZpbmVQcm9wZXJ0eTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDQoZGVmaW5lUHJvcGVydHkuZXhwb3J0cyk7CiAgZnVuY3Rpb24gcmVhZEJsb2JBc0FycmF5QnVmZmVyKGJsb2IpIHsKICAgIHZhciBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgZmlsZVJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24oKSB7CiAgICAgICAgZmlsZVJlYWRlci5hYm9ydCgpOwogICAgICAgIHJlamVjdChuZXcgRXJyb3IoInByb2JsZW0gcmVhZGluZyBibG9iIikpOwogICAgICB9OwogICAgICBmaWxlUmVhZGVyLm9uYWJvcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICByZWplY3QobmV3IEVycm9yKCJibG9iIHJlYWRpbmcgd2FzIGFib3J0ZWQiKSk7CiAgICAgIH07CiAgICAgIGZpbGVSZWFkZXIub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKGZpbGVSZWFkZXIucmVzdWx0ICYmIHR5cGVvZiBmaWxlUmVhZGVyLnJlc3VsdCAhPT0gInN0cmluZyIpIHsKICAgICAgICAgIHJlc29sdmUoZmlsZVJlYWRlci5yZXN1bHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZWplY3QobmV3IEVycm9yKCJ1bmtub3duIGVycm9yIHJlYWRpbmcgYmxvYiIpKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIGZpbGVSZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoYmxvYik7CiAgICB9KTsKICB9CiAgZnVuY3Rpb24gcmVhZEJsb2JBc1RleHQoYmxvYikgewogICAgdmFyIGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewogICAgICBmaWxlUmVhZGVyLm9uZXJyb3IgPSBmdW5jdGlvbigpIHsKICAgICAgICBmaWxlUmVhZGVyLmFib3J0KCk7CiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigicHJvYmxlbSByZWFkaW5nIGJsb2IiKSk7CiAgICAgIH07CiAgICAgIGZpbGVSZWFkZXIub25hYm9ydCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJlamVjdChuZXcgRXJyb3IoImJsb2IgcmVhZGluZyB3YXMgYWJvcnRlZCIpKTsKICAgICAgfTsKICAgICAgZmlsZVJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoZmlsZVJlYWRlci5yZXN1bHQgJiYgdHlwZW9mIGZpbGVSZWFkZXIucmVzdWx0ID09PSAic3RyaW5nIikgewogICAgICAgICAgcmVzb2x2ZShmaWxlUmVhZGVyLnJlc3VsdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoInVua25vd24gZXJyb3IgcmVhZGluZyBibG9iIikpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgZmlsZVJlYWRlci5yZWFkQXNUZXh0KGJsb2IpOwogICAgfSk7CiAgfQogIHZhciBCbG9iRmlsZSA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIEJsb2JGaWxlMihibG9iKSB7CiAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syJDMuZGVmYXVsdCkodGhpcywgQmxvYkZpbGUyKTsKICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGhpcywgImJsb2IiLCB2b2lkIDApOwogICAgICAoMCwgX2RlZmluZVByb3BlcnR5Mi5kZWZhdWx0KSh0aGlzLCAic2l6ZSIsIHZvaWQgMCk7CiAgICAgIHRoaXMuYmxvYiA9IGJsb2I7CiAgICAgIHRoaXMuc2l6ZSA9IGJsb2Iuc2l6ZTsKICAgIH0KICAgICgwLCBfY3JlYXRlQ2xhc3MyJDMuZGVmYXVsdCkoQmxvYkZpbGUyLCBbewogICAgICBrZXk6ICJyZWFkIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfcmVhZCA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIkNC5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yJDQuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoYnVmZmVyKSB7CiAgICAgICAgICB2YXIgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uLCBzdGFydCwgZW5kLCByZXN1bHQsIHJlc3VsdEJ1ZmZlciwgYnl0ZXNDb3BpZWQsIF9hcmdzID0gYXJndW1lbnRzOwogICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvciQ0LmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gX2FyZ3MubGVuZ3RoID4gMSAmJiBfYXJnc1sxXSAhPT0gdm9pZCAwID8gX2FyZ3NbMV0gOiAwOwogICAgICAgICAgICAgICAgICBsZW5ndGggPSBfYXJncy5sZW5ndGggPiAyID8gX2FyZ3NbMl0gOiB2b2lkIDA7CiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gX2FyZ3MubGVuZ3RoID4gMyAmJiBfYXJnc1szXSAhPT0gdm9pZCAwID8gX2FyZ3NbM10gOiAwOwogICAgICAgICAgICAgICAgICBpZiAobGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzUmVhZDogMCwKICAgICAgICAgICAgICAgICAgICBidWZmZXIKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gcG9zaXRpb247CiAgICAgICAgICAgICAgICAgIGVuZCA9IHN0YXJ0ICsgbGVuZ3RoOwogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlYWRCbG9iQXNBcnJheUJ1ZmZlcih0aGlzLmJsb2Iuc2xpY2Uoc3RhcnQsIGVuZCkpOwogICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICByZXN1bHQgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgICByZXN1bHRCdWZmZXIgPSBCdWZmZXIuZnJvbShyZXN1bHQpOwogICAgICAgICAgICAgICAgICBieXRlc0NvcGllZCA9IHJlc3VsdEJ1ZmZlci5jb3B5KGJ1ZmZlciwgb2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzUmVhZDogYnl0ZXNDb3BpZWQsCiAgICAgICAgICAgICAgICAgICAgYnVmZmVyOiByZXN1bHRCdWZmZXIKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICAgIH0pKTsKICAgICAgICBmdW5jdGlvbiByZWFkKF94KSB7CiAgICAgICAgICByZXR1cm4gX3JlYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlYWQ7CiAgICAgIH0oKQogICAgfSwgewogICAgICBrZXk6ICJyZWFkRmlsZSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX3JlYWRGaWxlID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMiQ0LmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IkNC5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIob3B0aW9ucykgewogICAgICAgICAgdmFyIGVuY29kaW5nLCByZXN1bHQ7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDQuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgICAgIGVuY29kaW5nID0gb3B0aW9uczsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBlbmNvZGluZyA9IG9wdGlvbnMgJiYgb3B0aW9ucy5lbmNvZGluZzsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoIShlbmNvZGluZyA9PT0gInV0ZjgiKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgcmVhZEJsb2JBc1RleHQodGhpcy5ibG9iKSk7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgIGlmICghZW5jb2RpbmcpIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1bnN1cHBvcnRlZCBlbmNvZGluZzogIi5jb25jYXQoZW5jb2RpbmcpKTsKICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgICAgICByZXR1cm4gcmVhZEJsb2JBc0FycmF5QnVmZmVyKHRoaXMuYmxvYik7CiAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgQnVmZmVyLmZyb20ocmVzdWx0KSk7CiAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgICB9KSk7CiAgICAgICAgZnVuY3Rpb24gcmVhZEZpbGUoX3gyKSB7CiAgICAgICAgICByZXR1cm4gX3JlYWRGaWxlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZWFkRmlsZTsKICAgICAgfSgpCiAgICB9LCB7CiAgICAgIGtleTogInN0YXQiLAogICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF9zdGF0ID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMiQ0LmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IkNC5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDQuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgICBzaXplOiB0aGlzLnNpemUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgICB9KSk7CiAgICAgICAgZnVuY3Rpb24gc3RhdCgpIHsKICAgICAgICAgIHJldHVybiBfc3RhdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RhdDsKICAgICAgfSgpCiAgICB9LCB7CiAgICAgIGtleTogImNsb3NlIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfY2xvc2UgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyJDQuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvciQ0LmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IkNC5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIik7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWU0KTsKICAgICAgICB9KSk7CiAgICAgICAgZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgICByZXR1cm4gX2Nsb3NlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjbG9zZTsKICAgICAgfSgpCiAgICB9XSk7CiAgICByZXR1cm4gQmxvYkZpbGUyOwogIH0oKTsKICBibG9iRmlsZS5kZWZhdWx0ID0gQmxvYkZpbGU7CiAgdmFyIGZpbGVoYW5kbGUgPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmZyZWV6ZSh7CiAgICBfX3Byb3RvX186IG51bGwKICB9KTsKICB2YXIgcmVxdWlyZSQkNCA9IC8qIEBfX1BVUkVfXyAqLyBnZXRBdWdtZW50ZWROYW1lc3BhY2UoZmlsZWhhbmRsZSk7CiAgKGZ1bmN0aW9uKGV4cG9ydHMyKSB7CiAgICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdDIgPSBpbnRlcm9wUmVxdWlyZURlZmF1bHQuZXhwb3J0czsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzMiwgIl9fZXNNb2R1bGUiLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIHZhciBfZXhwb3J0TmFtZXMgPSB7CiAgICAgIG9wZW46IHRydWUsCiAgICAgIGZyb21Vcmw6IHRydWUsCiAgICAgIExvY2FsRmlsZTogdHJ1ZSwKICAgICAgUmVtb3RlRmlsZTogdHJ1ZSwKICAgICAgQmxvYkZpbGU6IHRydWUKICAgIH07CiAgICBleHBvcnRzMi5vcGVuID0gb3BlbjsKICAgIGV4cG9ydHMyLmZyb21VcmwgPSBmcm9tVXJsOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMyLCAiTG9jYWxGaWxlIiwgewogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gX2xvY2FsRmlsZS5kZWZhdWx0OwogICAgICB9CiAgICB9KTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzMiwgIlJlbW90ZUZpbGUiLCB7CiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiBfcmVtb3RlRmlsZS5kZWZhdWx0OwogICAgICB9CiAgICB9KTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzMiwgIkJsb2JGaWxlIiwgewogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gX2Jsb2JGaWxlLmRlZmF1bHQ7CiAgICAgIH0KICAgIH0pOwogICAgdmFyIF9sb2NhbEZpbGUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0MihyZXF1aXJlJCQ1KTsKICAgIHZhciBfcmVtb3RlRmlsZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKHJlbW90ZUZpbGUpOwogICAgdmFyIF9ibG9iRmlsZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQyKGJsb2JGaWxlKTsKICAgIHZhciBfZmlsZWhhbmRsZSA9IHJlcXVpcmUkJDQ7CiAgICBPYmplY3Qua2V5cyhfZmlsZWhhbmRsZSkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgICAgaWYgKGtleSA9PT0gImRlZmF1bHQiIHx8IGtleSA9PT0gIl9fZXNNb2R1bGUiKQogICAgICAgIHJldHVybjsKICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChfZXhwb3J0TmFtZXMsIGtleSkpCiAgICAgICAgcmV0dXJuOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0czIsIGtleSwgewogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gX2ZpbGVoYW5kbGVba2V5XTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgICBmdW5jdGlvbiBmcm9tVXJsKHNvdXJjZSkgewogICAgICB2YXIgb3B0cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgIHJldHVybiBuZXcgX3JlbW90ZUZpbGUuZGVmYXVsdChzb3VyY2UsIG9wdHMpOwogICAgfQogICAgZnVuY3Rpb24gb3BlbihtYXliZVVybCwgbWF5YmVQYXRoLCBtYXliZUZpbGVoYW5kbGUpIHsKICAgICAgdmFyIG9wdHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHZvaWQgMCA/IGFyZ3VtZW50c1szXSA6IHt9OwogICAgICBpZiAobWF5YmVGaWxlaGFuZGxlICE9PSB2b2lkIDApIHsKICAgICAgICByZXR1cm4gbWF5YmVGaWxlaGFuZGxlOwogICAgICB9CiAgICAgIGlmIChtYXliZVVybCAhPT0gdm9pZCAwKSB7CiAgICAgICAgcmV0dXJuIGZyb21VcmwobWF5YmVVcmwsIG9wdHMpOwogICAgICB9CiAgICAgIGlmIChtYXliZVBhdGggIT09IHZvaWQgMCkgewogICAgICAgIHJldHVybiBuZXcgX2xvY2FsRmlsZS5kZWZhdWx0KG1heWJlUGF0aCwgb3B0cyk7CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IEVycm9yKCJubyB1cmwsIHBhdGgsIG9yIGZpbGVoYW5kbGUgcHJvdmlkZWQsIGNhbm5vdCBvcGVuIik7CiAgICB9CiAgfSkoZGlzdCQxKTsKICB2YXIgc2xpY2VkVG9BcnJheSA9IHsgZXhwb3J0czoge30gfTsKICB2YXIgYXJyYXlXaXRoSG9sZXMgPSB7IGV4cG9ydHM6IHt9IH07CiAgKGZ1bmN0aW9uKG1vZHVsZTIpIHsKICAgIGZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkKICAgICAgICByZXR1cm4gYXJyOwogICAgfQogICAgbW9kdWxlMi5leHBvcnRzID0gX2FycmF5V2l0aEhvbGVzOwogICAgbW9kdWxlMi5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUyLmV4cG9ydHMsIG1vZHVsZTIuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShhcnJheVdpdGhIb2xlcyk7CiAgdmFyIGl0ZXJhYmxlVG9BcnJheUxpbWl0ID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUyKSB7CiAgICBmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7CiAgICAgIHZhciBfaSA9IGFyciA9PSBudWxsID8gbnVsbCA6IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIGFycltTeW1ib2wuaXRlcmF0b3JdIHx8IGFyclsiQEBpdGVyYXRvciJdOwogICAgICBpZiAoX2kgPT0gbnVsbCkKICAgICAgICByZXR1cm47CiAgICAgIHZhciBfYXJyID0gW107CiAgICAgIHZhciBfbiA9IHRydWU7CiAgICAgIHZhciBfZCA9IGZhbHNlOwogICAgICB2YXIgX3MsIF9lOwogICAgICB0cnkgewogICAgICAgIGZvciAoX2kgPSBfaS5jYWxsKGFycik7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsKICAgICAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7CiAgICAgICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIyKSB7CiAgICAgICAgX2QgPSB0cnVlOwogICAgICAgIF9lID0gZXJyMjsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkKICAgICAgICAgICAgX2lbInJldHVybiJdKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIGlmIChfZCkKICAgICAgICAgICAgdGhyb3cgX2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBfYXJyOwogICAgfQogICAgbW9kdWxlMi5leHBvcnRzID0gX2l0ZXJhYmxlVG9BcnJheUxpbWl0OwogICAgbW9kdWxlMi5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUyLmV4cG9ydHMsIG1vZHVsZTIuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KShpdGVyYWJsZVRvQXJyYXlMaW1pdCk7CiAgdmFyIHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5ID0geyBleHBvcnRzOiB7fSB9OwogIHZhciBhcnJheUxpa2VUb0FycmF5ID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUyKSB7CiAgICBmdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikgewogICAgICBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkKICAgICAgICBsZW4gPSBhcnIubGVuZ3RoOwogICAgICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBhcnIyW2ldID0gYXJyW2ldOwogICAgICB9CiAgICAgIHJldHVybiBhcnIyOwogICAgfQogICAgbW9kdWxlMi5leHBvcnRzID0gX2FycmF5TGlrZVRvQXJyYXk7CiAgICBtb2R1bGUyLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZTIuZXhwb3J0cywgbW9kdWxlMi5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKGFycmF5TGlrZVRvQXJyYXkpOwogIChmdW5jdGlvbihtb2R1bGUyKSB7CiAgICB2YXIgYXJyYXlMaWtlVG9BcnJheSQxID0gYXJyYXlMaWtlVG9BcnJheS5leHBvcnRzOwogICAgZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikgewogICAgICBpZiAoIW8pCiAgICAgICAgcmV0dXJuOwogICAgICBpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKQogICAgICAgIHJldHVybiBhcnJheUxpa2VUb0FycmF5JDEobywgbWluTGVuKTsKICAgICAgdmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpOwogICAgICBpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikKICAgICAgICBuID0gby5jb25zdHJ1Y3Rvci5uYW1lOwogICAgICBpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpCiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20obyk7CiAgICAgIGlmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkKICAgICAgICByZXR1cm4gYXJyYXlMaWtlVG9BcnJheSQxKG8sIG1pbkxlbik7CiAgICB9CiAgICBtb2R1bGUyLmV4cG9ydHMgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXk7CiAgICBtb2R1bGUyLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZTIuZXhwb3J0cywgbW9kdWxlMi5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pKHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KTsKICB2YXIgbm9uSXRlcmFibGVSZXN0ID0geyBleHBvcnRzOiB7fSB9OwogIChmdW5jdGlvbihtb2R1bGUyKSB7CiAgICBmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOwogICAgfQogICAgbW9kdWxlMi5leHBvcnRzID0gX25vbkl0ZXJhYmxlUmVzdDsKICAgIG1vZHVsZTIuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlMi5leHBvcnRzLCBtb2R1bGUyLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSkobm9uSXRlcmFibGVSZXN0KTsKICAoZnVuY3Rpb24obW9kdWxlMikgewogICAgdmFyIGFycmF5V2l0aEhvbGVzJDEgPSBhcnJheVdpdGhIb2xlcy5leHBvcnRzOwogICAgdmFyIGl0ZXJhYmxlVG9BcnJheUxpbWl0JDEgPSBpdGVyYWJsZVRvQXJyYXlMaW1pdC5leHBvcnRzOwogICAgdmFyIHVuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5JDEgPSB1bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheS5leHBvcnRzOwogICAgdmFyIG5vbkl0ZXJhYmxlUmVzdCQxID0gbm9uSXRlcmFibGVSZXN0LmV4cG9ydHM7CiAgICBmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsKICAgICAgcmV0dXJuIGFycmF5V2l0aEhvbGVzJDEoYXJyKSB8fCBpdGVyYWJsZVRvQXJyYXlMaW1pdCQxKGFyciwgaSkgfHwgdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkkMShhcnIsIGkpIHx8IG5vbkl0ZXJhYmxlUmVzdCQxKCk7CiAgICB9CiAgICBtb2R1bGUyLmV4cG9ydHMgPSBfc2xpY2VkVG9BcnJheTsKICAgIG1vZHVsZTIuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlMi5leHBvcnRzLCBtb2R1bGUyLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSkoc2xpY2VkVG9BcnJheSk7CiAgdmFyIGNvbW1vbiQxID0ge307CiAgKGZ1bmN0aW9uKGV4cG9ydHMyKSB7CiAgICB2YXIgVFlQRURfT0sgPSB0eXBlb2YgVWludDhBcnJheSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIFVpbnQxNkFycmF5ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YgSW50MzJBcnJheSAhPT0gInVuZGVmaW5lZCI7CiAgICBmdW5jdGlvbiBfaGFzKG9iaiwga2V5KSB7CiAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpOwogICAgfQogICAgZXhwb3J0czIuYXNzaWduID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHZhciBzb3VyY2VzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgd2hpbGUgKHNvdXJjZXMubGVuZ3RoKSB7CiAgICAgICAgdmFyIHNvdXJjZSA9IHNvdXJjZXMuc2hpZnQoKTsKICAgICAgICBpZiAoIXNvdXJjZSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2Ygc291cmNlICE9PSAib2JqZWN0IikgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzb3VyY2UgKyAibXVzdCBiZSBub24tb2JqZWN0Iik7CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIHAgaW4gc291cmNlKSB7CiAgICAgICAgICBpZiAoX2hhcyhzb3VyY2UsIHApKSB7CiAgICAgICAgICAgIG9ialtwXSA9IHNvdXJjZVtwXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG9iajsKICAgIH07CiAgICBleHBvcnRzMi5zaHJpbmtCdWYgPSBmdW5jdGlvbihidWYsIHNpemUpIHsKICAgICAgaWYgKGJ1Zi5sZW5ndGggPT09IHNpemUpIHsKICAgICAgICByZXR1cm4gYnVmOwogICAgICB9CiAgICAgIGlmIChidWYuc3ViYXJyYXkpIHsKICAgICAgICByZXR1cm4gYnVmLnN1YmFycmF5KDAsIHNpemUpOwogICAgICB9CiAgICAgIGJ1Zi5sZW5ndGggPSBzaXplOwogICAgICByZXR1cm4gYnVmOwogICAgfTsKICAgIHZhciBmblR5cGVkID0gewogICAgICBhcnJheVNldDogZnVuY3Rpb24oZGVzdCwgc3JjLCBzcmNfb2ZmcywgbGVuLCBkZXN0X29mZnMpIHsKICAgICAgICBpZiAoc3JjLnN1YmFycmF5ICYmIGRlc3Quc3ViYXJyYXkpIHsKICAgICAgICAgIGRlc3Quc2V0KHNyYy5zdWJhcnJheShzcmNfb2Zmcywgc3JjX29mZnMgKyBsZW4pLCBkZXN0X29mZnMpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBkZXN0W2Rlc3Rfb2ZmcyArIGldID0gc3JjW3NyY19vZmZzICsgaV07CiAgICAgICAgfQogICAgICB9LAogICAgICBmbGF0dGVuQ2h1bmtzOiBmdW5jdGlvbihjaHVua3MpIHsKICAgICAgICB2YXIgaSwgbCwgbGVuLCBwb3MsIGNodW5rLCByZXN1bHQ7CiAgICAgICAgbGVuID0gMDsKICAgICAgICBmb3IgKGkgPSAwLCBsID0gY2h1bmtzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgbGVuICs9IGNodW5rc1tpXS5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KGxlbik7CiAgICAgICAgcG9zID0gMDsKICAgICAgICBmb3IgKGkgPSAwLCBsID0gY2h1bmtzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgY2h1bmsgPSBjaHVua3NbaV07CiAgICAgICAgICByZXN1bHQuc2V0KGNodW5rLCBwb3MpOwogICAgICAgICAgcG9zICs9IGNodW5rLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgfTsKICAgIHZhciBmblVudHlwZWQgPSB7CiAgICAgIGFycmF5U2V0OiBmdW5jdGlvbihkZXN0LCBzcmMsIHNyY19vZmZzLCBsZW4sIGRlc3Rfb2ZmcykgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIGRlc3RbZGVzdF9vZmZzICsgaV0gPSBzcmNbc3JjX29mZnMgKyBpXTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGZsYXR0ZW5DaHVua3M6IGZ1bmN0aW9uKGNodW5rcykgewogICAgICAgIHJldHVybiBbXS5jb25jYXQuYXBwbHkoW10sIGNodW5rcyk7CiAgICAgIH0KICAgIH07CiAgICBleHBvcnRzMi5zZXRUeXBlZCA9IGZ1bmN0aW9uKG9uKSB7CiAgICAgIGlmIChvbikgewogICAgICAgIGV4cG9ydHMyLkJ1ZjggPSBVaW50OEFycmF5OwogICAgICAgIGV4cG9ydHMyLkJ1ZjE2ID0gVWludDE2QXJyYXk7CiAgICAgICAgZXhwb3J0czIuQnVmMzIgPSBJbnQzMkFycmF5OwogICAgICAgIGV4cG9ydHMyLmFzc2lnbihleHBvcnRzMiwgZm5UeXBlZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZXhwb3J0czIuQnVmOCA9IEFycmF5OwogICAgICAgIGV4cG9ydHMyLkJ1ZjE2ID0gQXJyYXk7CiAgICAgICAgZXhwb3J0czIuQnVmMzIgPSBBcnJheTsKICAgICAgICBleHBvcnRzMi5hc3NpZ24oZXhwb3J0czIsIGZuVW50eXBlZCk7CiAgICAgIH0KICAgIH07CiAgICBleHBvcnRzMi5zZXRUeXBlZChUWVBFRF9PSyk7CiAgfSkoY29tbW9uJDEpOwogIHZhciBkZWZsYXRlJDQgPSB7fTsKICB2YXIgZGVmbGF0ZSQzID0ge307CiAgdmFyIHRyZWVzJDEgPSB7fTsKICB2YXIgdXRpbHMkNiA9IGNvbW1vbiQxOwogIHZhciBaX0ZJWEVEJDEgPSA0OwogIHZhciBaX0JJTkFSWSA9IDA7CiAgdmFyIFpfVEVYVCA9IDE7CiAgdmFyIFpfVU5LTk9XTiQxID0gMjsKICBmdW5jdGlvbiB6ZXJvJDEoYnVmKSB7CiAgICB2YXIgbGVuID0gYnVmLmxlbmd0aDsKICAgIHdoaWxlICgtLWxlbiA+PSAwKSB7CiAgICAgIGJ1ZltsZW5dID0gMDsKICAgIH0KICB9CiAgdmFyIFNUT1JFRF9CTE9DSyA9IDA7CiAgdmFyIFNUQVRJQ19UUkVFUyA9IDE7CiAgdmFyIERZTl9UUkVFUyA9IDI7CiAgdmFyIE1JTl9NQVRDSCQxID0gMzsKICB2YXIgTUFYX01BVENIJDEgPSAyNTg7CiAgdmFyIExFTkdUSF9DT0RFUyQxID0gMjk7CiAgdmFyIExJVEVSQUxTJDEgPSAyNTY7CiAgdmFyIExfQ09ERVMkMSA9IExJVEVSQUxTJDEgKyAxICsgTEVOR1RIX0NPREVTJDE7CiAgdmFyIERfQ09ERVMkMSA9IDMwOwogIHZhciBCTF9DT0RFUyQxID0gMTk7CiAgdmFyIEhFQVBfU0laRSQxID0gMiAqIExfQ09ERVMkMSArIDE7CiAgdmFyIE1BWF9CSVRTJDEgPSAxNTsKICB2YXIgQnVmX3NpemUgPSAxNjsKICB2YXIgTUFYX0JMX0JJVFMgPSA3OwogIHZhciBFTkRfQkxPQ0sgPSAyNTY7CiAgdmFyIFJFUF8zXzYgPSAxNjsKICB2YXIgUkVQWl8zXzEwID0gMTc7CiAgdmFyIFJFUFpfMTFfMTM4ID0gMTg7CiAgdmFyIGV4dHJhX2xiaXRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDEsIDEsIDEsIDEsIDIsIDIsIDIsIDIsIDMsIDMsIDMsIDMsIDQsIDQsIDQsIDQsIDUsIDUsIDUsIDUsIDBdOwogIHZhciBleHRyYV9kYml0cyA9IFswLCAwLCAwLCAwLCAxLCAxLCAyLCAyLCAzLCAzLCA0LCA0LCA1LCA1LCA2LCA2LCA3LCA3LCA4LCA4LCA5LCA5LCAxMCwgMTAsIDExLCAxMSwgMTIsIDEyLCAxMywgMTNdOwogIHZhciBleHRyYV9ibGJpdHMgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMiwgMywgN107CiAgdmFyIGJsX29yZGVyID0gWzE2LCAxNywgMTgsIDAsIDgsIDcsIDksIDYsIDEwLCA1LCAxMSwgNCwgMTIsIDMsIDEzLCAyLCAxNCwgMSwgMTVdOwogIHZhciBESVNUX0NPREVfTEVOID0gNTEyOwogIHZhciBzdGF0aWNfbHRyZWUgPSBuZXcgQXJyYXkoKExfQ09ERVMkMSArIDIpICogMik7CiAgemVybyQxKHN0YXRpY19sdHJlZSk7CiAgdmFyIHN0YXRpY19kdHJlZSA9IG5ldyBBcnJheShEX0NPREVTJDEgKiAyKTsKICB6ZXJvJDEoc3RhdGljX2R0cmVlKTsKICB2YXIgX2Rpc3RfY29kZSA9IG5ldyBBcnJheShESVNUX0NPREVfTEVOKTsKICB6ZXJvJDEoX2Rpc3RfY29kZSk7CiAgdmFyIF9sZW5ndGhfY29kZSA9IG5ldyBBcnJheShNQVhfTUFUQ0gkMSAtIE1JTl9NQVRDSCQxICsgMSk7CiAgemVybyQxKF9sZW5ndGhfY29kZSk7CiAgdmFyIGJhc2VfbGVuZ3RoID0gbmV3IEFycmF5KExFTkdUSF9DT0RFUyQxKTsKICB6ZXJvJDEoYmFzZV9sZW5ndGgpOwogIHZhciBiYXNlX2Rpc3QgPSBuZXcgQXJyYXkoRF9DT0RFUyQxKTsKICB6ZXJvJDEoYmFzZV9kaXN0KTsKICBmdW5jdGlvbiBTdGF0aWNUcmVlRGVzYyhzdGF0aWNfdHJlZSwgZXh0cmFfYml0cywgZXh0cmFfYmFzZSwgZWxlbXMsIG1heF9sZW5ndGgpIHsKICAgIHRoaXMuc3RhdGljX3RyZWUgPSBzdGF0aWNfdHJlZTsKICAgIHRoaXMuZXh0cmFfYml0cyA9IGV4dHJhX2JpdHM7CiAgICB0aGlzLmV4dHJhX2Jhc2UgPSBleHRyYV9iYXNlOwogICAgdGhpcy5lbGVtcyA9IGVsZW1zOwogICAgdGhpcy5tYXhfbGVuZ3RoID0gbWF4X2xlbmd0aDsKICAgIHRoaXMuaGFzX3N0cmVlID0gc3RhdGljX3RyZWUgJiYgc3RhdGljX3RyZWUubGVuZ3RoOwogIH0KICB2YXIgc3RhdGljX2xfZGVzYzsKICB2YXIgc3RhdGljX2RfZGVzYzsKICB2YXIgc3RhdGljX2JsX2Rlc2M7CiAgZnVuY3Rpb24gVHJlZURlc2MoZHluX3RyZWUsIHN0YXRfZGVzYykgewogICAgdGhpcy5keW5fdHJlZSA9IGR5bl90cmVlOwogICAgdGhpcy5tYXhfY29kZSA9IDA7CiAgICB0aGlzLnN0YXRfZGVzYyA9IHN0YXRfZGVzYzsKICB9CiAgZnVuY3Rpb24gZF9jb2RlKGRpc3QyKSB7CiAgICByZXR1cm4gZGlzdDIgPCAyNTYgPyBfZGlzdF9jb2RlW2Rpc3QyXSA6IF9kaXN0X2NvZGVbMjU2ICsgKGRpc3QyID4+PiA3KV07CiAgfQogIGZ1bmN0aW9uIHB1dF9zaG9ydChzLCB3KSB7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IHcgJiAyNTU7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IHcgPj4+IDggJiAyNTU7CiAgfQogIGZ1bmN0aW9uIHNlbmRfYml0cyhzLCB2YWx1ZSwgbGVuZ3RoKSB7CiAgICBpZiAocy5iaV92YWxpZCA+IEJ1Zl9zaXplIC0gbGVuZ3RoKSB7CiAgICAgIHMuYmlfYnVmIHw9IHZhbHVlIDw8IHMuYmlfdmFsaWQgJiA2NTUzNTsKICAgICAgcHV0X3Nob3J0KHMsIHMuYmlfYnVmKTsKICAgICAgcy5iaV9idWYgPSB2YWx1ZSA+PiBCdWZfc2l6ZSAtIHMuYmlfdmFsaWQ7CiAgICAgIHMuYmlfdmFsaWQgKz0gbGVuZ3RoIC0gQnVmX3NpemU7CiAgICB9IGVsc2UgewogICAgICBzLmJpX2J1ZiB8PSB2YWx1ZSA8PCBzLmJpX3ZhbGlkICYgNjU1MzU7CiAgICAgIHMuYmlfdmFsaWQgKz0gbGVuZ3RoOwogICAgfQogIH0KICBmdW5jdGlvbiBzZW5kX2NvZGUocywgYzIsIHRyZWUpIHsKICAgIHNlbmRfYml0cyhzLCB0cmVlW2MyICogMl0sIHRyZWVbYzIgKiAyICsgMV0pOwogIH0KICBmdW5jdGlvbiBiaV9yZXZlcnNlKGNvZGUsIGxlbikgewogICAgdmFyIHJlcyA9IDA7CiAgICBkbyB7CiAgICAgIHJlcyB8PSBjb2RlICYgMTsKICAgICAgY29kZSA+Pj49IDE7CiAgICAgIHJlcyA8PD0gMTsKICAgIH0gd2hpbGUgKC0tbGVuID4gMCk7CiAgICByZXR1cm4gcmVzID4+PiAxOwogIH0KICBmdW5jdGlvbiBiaV9mbHVzaChzKSB7CiAgICBpZiAocy5iaV92YWxpZCA9PT0gMTYpIHsKICAgICAgcHV0X3Nob3J0KHMsIHMuYmlfYnVmKTsKICAgICAgcy5iaV9idWYgPSAwOwogICAgICBzLmJpX3ZhbGlkID0gMDsKICAgIH0gZWxzZSBpZiAocy5iaV92YWxpZCA+PSA4KSB7CiAgICAgIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gcy5iaV9idWYgJiAyNTU7CiAgICAgIHMuYmlfYnVmID4+PSA4OwogICAgICBzLmJpX3ZhbGlkIC09IDg7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGdlbl9iaXRsZW4ocywgZGVzYykgewogICAgdmFyIHRyZWUgPSBkZXNjLmR5bl90cmVlOwogICAgdmFyIG1heF9jb2RlID0gZGVzYy5tYXhfY29kZTsKICAgIHZhciBzdHJlZSA9IGRlc2Muc3RhdF9kZXNjLnN0YXRpY190cmVlOwogICAgdmFyIGhhc19zdHJlZSA9IGRlc2Muc3RhdF9kZXNjLmhhc19zdHJlZTsKICAgIHZhciBleHRyYSA9IGRlc2Muc3RhdF9kZXNjLmV4dHJhX2JpdHM7CiAgICB2YXIgYmFzZSA9IGRlc2Muc3RhdF9kZXNjLmV4dHJhX2Jhc2U7CiAgICB2YXIgbWF4X2xlbmd0aCA9IGRlc2Muc3RhdF9kZXNjLm1heF9sZW5ndGg7CiAgICB2YXIgaDsKICAgIHZhciBuLCBtOwogICAgdmFyIGJpdHM7CiAgICB2YXIgeGJpdHM7CiAgICB2YXIgZjsKICAgIHZhciBvdmVyZmxvdyA9IDA7CiAgICBmb3IgKGJpdHMgPSAwOyBiaXRzIDw9IE1BWF9CSVRTJDE7IGJpdHMrKykgewogICAgICBzLmJsX2NvdW50W2JpdHNdID0gMDsKICAgIH0KICAgIHRyZWVbcy5oZWFwW3MuaGVhcF9tYXhdICogMiArIDFdID0gMDsKICAgIGZvciAoaCA9IHMuaGVhcF9tYXggKyAxOyBoIDwgSEVBUF9TSVpFJDE7IGgrKykgewogICAgICBuID0gcy5oZWFwW2hdOwogICAgICBiaXRzID0gdHJlZVt0cmVlW24gKiAyICsgMV0gKiAyICsgMV0gKyAxOwogICAgICBpZiAoYml0cyA+IG1heF9sZW5ndGgpIHsKICAgICAgICBiaXRzID0gbWF4X2xlbmd0aDsKICAgICAgICBvdmVyZmxvdysrOwogICAgICB9CiAgICAgIHRyZWVbbiAqIDIgKyAxXSA9IGJpdHM7CiAgICAgIGlmIChuID4gbWF4X2NvZGUpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBzLmJsX2NvdW50W2JpdHNdKys7CiAgICAgIHhiaXRzID0gMDsKICAgICAgaWYgKG4gPj0gYmFzZSkgewogICAgICAgIHhiaXRzID0gZXh0cmFbbiAtIGJhc2VdOwogICAgICB9CiAgICAgIGYgPSB0cmVlW24gKiAyXTsKICAgICAgcy5vcHRfbGVuICs9IGYgKiAoYml0cyArIHhiaXRzKTsKICAgICAgaWYgKGhhc19zdHJlZSkgewogICAgICAgIHMuc3RhdGljX2xlbiArPSBmICogKHN0cmVlW24gKiAyICsgMV0gKyB4Yml0cyk7CiAgICAgIH0KICAgIH0KICAgIGlmIChvdmVyZmxvdyA9PT0gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBkbyB7CiAgICAgIGJpdHMgPSBtYXhfbGVuZ3RoIC0gMTsKICAgICAgd2hpbGUgKHMuYmxfY291bnRbYml0c10gPT09IDApIHsKICAgICAgICBiaXRzLS07CiAgICAgIH0KICAgICAgcy5ibF9jb3VudFtiaXRzXS0tOwogICAgICBzLmJsX2NvdW50W2JpdHMgKyAxXSArPSAyOwogICAgICBzLmJsX2NvdW50W21heF9sZW5ndGhdLS07CiAgICAgIG92ZXJmbG93IC09IDI7CiAgICB9IHdoaWxlIChvdmVyZmxvdyA+IDApOwogICAgZm9yIChiaXRzID0gbWF4X2xlbmd0aDsgYml0cyAhPT0gMDsgYml0cy0tKSB7CiAgICAgIG4gPSBzLmJsX2NvdW50W2JpdHNdOwogICAgICB3aGlsZSAobiAhPT0gMCkgewogICAgICAgIG0gPSBzLmhlYXBbLS1oXTsKICAgICAgICBpZiAobSA+IG1heF9jb2RlKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHRyZWVbbSAqIDIgKyAxXSAhPT0gYml0cykgewogICAgICAgICAgcy5vcHRfbGVuICs9IChiaXRzIC0gdHJlZVttICogMiArIDFdKSAqIHRyZWVbbSAqIDJdOwogICAgICAgICAgdHJlZVttICogMiArIDFdID0gYml0czsKICAgICAgICB9CiAgICAgICAgbi0tOwogICAgICB9CiAgICB9CiAgfQogIGZ1bmN0aW9uIGdlbl9jb2Rlcyh0cmVlLCBtYXhfY29kZSwgYmxfY291bnQpIHsKICAgIHZhciBuZXh0X2NvZGUgPSBuZXcgQXJyYXkoTUFYX0JJVFMkMSArIDEpOwogICAgdmFyIGNvZGUgPSAwOwogICAgdmFyIGJpdHM7CiAgICB2YXIgbjsKICAgIGZvciAoYml0cyA9IDE7IGJpdHMgPD0gTUFYX0JJVFMkMTsgYml0cysrKSB7CiAgICAgIG5leHRfY29kZVtiaXRzXSA9IGNvZGUgPSBjb2RlICsgYmxfY291bnRbYml0cyAtIDFdIDw8IDE7CiAgICB9CiAgICBmb3IgKG4gPSAwOyBuIDw9IG1heF9jb2RlOyBuKyspIHsKICAgICAgdmFyIGxlbiA9IHRyZWVbbiAqIDIgKyAxXTsKICAgICAgaWYgKGxlbiA9PT0gMCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRyZWVbbiAqIDJdID0gYmlfcmV2ZXJzZShuZXh0X2NvZGVbbGVuXSsrLCBsZW4pOwogICAgfQogIH0KICBmdW5jdGlvbiB0cl9zdGF0aWNfaW5pdCgpIHsKICAgIHZhciBuOwogICAgdmFyIGJpdHM7CiAgICB2YXIgbGVuZ3RoOwogICAgdmFyIGNvZGU7CiAgICB2YXIgZGlzdDI7CiAgICB2YXIgYmxfY291bnQgPSBuZXcgQXJyYXkoTUFYX0JJVFMkMSArIDEpOwogICAgbGVuZ3RoID0gMDsKICAgIGZvciAoY29kZSA9IDA7IGNvZGUgPCBMRU5HVEhfQ09ERVMkMSAtIDE7IGNvZGUrKykgewogICAgICBiYXNlX2xlbmd0aFtjb2RlXSA9IGxlbmd0aDsKICAgICAgZm9yIChuID0gMDsgbiA8IDEgPDwgZXh0cmFfbGJpdHNbY29kZV07IG4rKykgewogICAgICAgIF9sZW5ndGhfY29kZVtsZW5ndGgrK10gPSBjb2RlOwogICAgICB9CiAgICB9CiAgICBfbGVuZ3RoX2NvZGVbbGVuZ3RoIC0gMV0gPSBjb2RlOwogICAgZGlzdDIgPSAwOwogICAgZm9yIChjb2RlID0gMDsgY29kZSA8IDE2OyBjb2RlKyspIHsKICAgICAgYmFzZV9kaXN0W2NvZGVdID0gZGlzdDI7CiAgICAgIGZvciAobiA9IDA7IG4gPCAxIDw8IGV4dHJhX2RiaXRzW2NvZGVdOyBuKyspIHsKICAgICAgICBfZGlzdF9jb2RlW2Rpc3QyKytdID0gY29kZTsKICAgICAgfQogICAgfQogICAgZGlzdDIgPj49IDc7CiAgICBmb3IgKDsgY29kZSA8IERfQ09ERVMkMTsgY29kZSsrKSB7CiAgICAgIGJhc2VfZGlzdFtjb2RlXSA9IGRpc3QyIDw8IDc7CiAgICAgIGZvciAobiA9IDA7IG4gPCAxIDw8IGV4dHJhX2RiaXRzW2NvZGVdIC0gNzsgbisrKSB7CiAgICAgICAgX2Rpc3RfY29kZVsyNTYgKyBkaXN0MisrXSA9IGNvZGU7CiAgICAgIH0KICAgIH0KICAgIGZvciAoYml0cyA9IDA7IGJpdHMgPD0gTUFYX0JJVFMkMTsgYml0cysrKSB7CiAgICAgIGJsX2NvdW50W2JpdHNdID0gMDsKICAgIH0KICAgIG4gPSAwOwogICAgd2hpbGUgKG4gPD0gMTQzKSB7CiAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdID0gODsKICAgICAgbisrOwogICAgICBibF9jb3VudFs4XSsrOwogICAgfQogICAgd2hpbGUgKG4gPD0gMjU1KSB7CiAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdID0gOTsKICAgICAgbisrOwogICAgICBibF9jb3VudFs5XSsrOwogICAgfQogICAgd2hpbGUgKG4gPD0gMjc5KSB7CiAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdID0gNzsKICAgICAgbisrOwogICAgICBibF9jb3VudFs3XSsrOwogICAgfQogICAgd2hpbGUgKG4gPD0gMjg3KSB7CiAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdID0gODsKICAgICAgbisrOwogICAgICBibF9jb3VudFs4XSsrOwogICAgfQogICAgZ2VuX2NvZGVzKHN0YXRpY19sdHJlZSwgTF9DT0RFUyQxICsgMSwgYmxfY291bnQpOwogICAgZm9yIChuID0gMDsgbiA8IERfQ09ERVMkMTsgbisrKSB7CiAgICAgIHN0YXRpY19kdHJlZVtuICogMiArIDFdID0gNTsKICAgICAgc3RhdGljX2R0cmVlW24gKiAyXSA9IGJpX3JldmVyc2UobiwgNSk7CiAgICB9CiAgICBzdGF0aWNfbF9kZXNjID0gbmV3IFN0YXRpY1RyZWVEZXNjKHN0YXRpY19sdHJlZSwgZXh0cmFfbGJpdHMsIExJVEVSQUxTJDEgKyAxLCBMX0NPREVTJDEsIE1BWF9CSVRTJDEpOwogICAgc3RhdGljX2RfZGVzYyA9IG5ldyBTdGF0aWNUcmVlRGVzYyhzdGF0aWNfZHRyZWUsIGV4dHJhX2RiaXRzLCAwLCBEX0NPREVTJDEsIE1BWF9CSVRTJDEpOwogICAgc3RhdGljX2JsX2Rlc2MgPSBuZXcgU3RhdGljVHJlZURlc2MobmV3IEFycmF5KDApLCBleHRyYV9ibGJpdHMsIDAsIEJMX0NPREVTJDEsIE1BWF9CTF9CSVRTKTsKICB9CiAgZnVuY3Rpb24gaW5pdF9ibG9jayhzKSB7CiAgICB2YXIgbjsKICAgIGZvciAobiA9IDA7IG4gPCBMX0NPREVTJDE7IG4rKykgewogICAgICBzLmR5bl9sdHJlZVtuICogMl0gPSAwOwogICAgfQogICAgZm9yIChuID0gMDsgbiA8IERfQ09ERVMkMTsgbisrKSB7CiAgICAgIHMuZHluX2R0cmVlW24gKiAyXSA9IDA7CiAgICB9CiAgICBmb3IgKG4gPSAwOyBuIDwgQkxfQ09ERVMkMTsgbisrKSB7CiAgICAgIHMuYmxfdHJlZVtuICogMl0gPSAwOwogICAgfQogICAgcy5keW5fbHRyZWVbRU5EX0JMT0NLICogMl0gPSAxOwogICAgcy5vcHRfbGVuID0gcy5zdGF0aWNfbGVuID0gMDsKICAgIHMubGFzdF9saXQgPSBzLm1hdGNoZXMgPSAwOwogIH0KICBmdW5jdGlvbiBiaV93aW5kdXAocykgewogICAgaWYgKHMuYmlfdmFsaWQgPiA4KSB7CiAgICAgIHB1dF9zaG9ydChzLCBzLmJpX2J1Zik7CiAgICB9IGVsc2UgaWYgKHMuYmlfdmFsaWQgPiAwKSB7CiAgICAgIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gcy5iaV9idWY7CiAgICB9CiAgICBzLmJpX2J1ZiA9IDA7CiAgICBzLmJpX3ZhbGlkID0gMDsKICB9CiAgZnVuY3Rpb24gY29weV9ibG9jayhzLCBidWYsIGxlbiwgaGVhZGVyKSB7CiAgICBiaV93aW5kdXAocyk7CiAgICBpZiAoaGVhZGVyKSB7CiAgICAgIHB1dF9zaG9ydChzLCBsZW4pOwogICAgICBwdXRfc2hvcnQocywgfmxlbik7CiAgICB9CiAgICB1dGlscyQ2LmFycmF5U2V0KHMucGVuZGluZ19idWYsIHMud2luZG93LCBidWYsIGxlbiwgcy5wZW5kaW5nKTsKICAgIHMucGVuZGluZyArPSBsZW47CiAgfQogIGZ1bmN0aW9uIHNtYWxsZXIodHJlZSwgbiwgbSwgZGVwdGgpIHsKICAgIHZhciBfbjIgPSBuICogMjsKICAgIHZhciBfbTIgPSBtICogMjsKICAgIHJldHVybiB0cmVlW19uMl0gPCB0cmVlW19tMl0gfHwgdHJlZVtfbjJdID09PSB0cmVlW19tMl0gJiYgZGVwdGhbbl0gPD0gZGVwdGhbbV07CiAgfQogIGZ1bmN0aW9uIHBxZG93bmhlYXAocywgdHJlZSwgaykgewogICAgdmFyIHYgPSBzLmhlYXBba107CiAgICB2YXIgaiA9IGsgPDwgMTsKICAgIHdoaWxlIChqIDw9IHMuaGVhcF9sZW4pIHsKICAgICAgaWYgKGogPCBzLmhlYXBfbGVuICYmIHNtYWxsZXIodHJlZSwgcy5oZWFwW2ogKyAxXSwgcy5oZWFwW2pdLCBzLmRlcHRoKSkgewogICAgICAgIGorKzsKICAgICAgfQogICAgICBpZiAoc21hbGxlcih0cmVlLCB2LCBzLmhlYXBbal0sIHMuZGVwdGgpKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgcy5oZWFwW2tdID0gcy5oZWFwW2pdOwogICAgICBrID0gajsKICAgICAgaiA8PD0gMTsKICAgIH0KICAgIHMuaGVhcFtrXSA9IHY7CiAgfQogIGZ1bmN0aW9uIGNvbXByZXNzX2Jsb2NrKHMsIGx0cmVlLCBkdHJlZSkgewogICAgdmFyIGRpc3QyOwogICAgdmFyIGxjOwogICAgdmFyIGx4ID0gMDsKICAgIHZhciBjb2RlOwogICAgdmFyIGV4dHJhOwogICAgaWYgKHMubGFzdF9saXQgIT09IDApIHsKICAgICAgZG8gewogICAgICAgIGRpc3QyID0gcy5wZW5kaW5nX2J1ZltzLmRfYnVmICsgbHggKiAyXSA8PCA4IHwgcy5wZW5kaW5nX2J1ZltzLmRfYnVmICsgbHggKiAyICsgMV07CiAgICAgICAgbGMgPSBzLnBlbmRpbmdfYnVmW3MubF9idWYgKyBseF07CiAgICAgICAgbHgrKzsKICAgICAgICBpZiAoZGlzdDIgPT09IDApIHsKICAgICAgICAgIHNlbmRfY29kZShzLCBsYywgbHRyZWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb2RlID0gX2xlbmd0aF9jb2RlW2xjXTsKICAgICAgICAgIHNlbmRfY29kZShzLCBjb2RlICsgTElURVJBTFMkMSArIDEsIGx0cmVlKTsKICAgICAgICAgIGV4dHJhID0gZXh0cmFfbGJpdHNbY29kZV07CiAgICAgICAgICBpZiAoZXh0cmEgIT09IDApIHsKICAgICAgICAgICAgbGMgLT0gYmFzZV9sZW5ndGhbY29kZV07CiAgICAgICAgICAgIHNlbmRfYml0cyhzLCBsYywgZXh0cmEpOwogICAgICAgICAgfQogICAgICAgICAgZGlzdDItLTsKICAgICAgICAgIGNvZGUgPSBkX2NvZGUoZGlzdDIpOwogICAgICAgICAgc2VuZF9jb2RlKHMsIGNvZGUsIGR0cmVlKTsKICAgICAgICAgIGV4dHJhID0gZXh0cmFfZGJpdHNbY29kZV07CiAgICAgICAgICBpZiAoZXh0cmEgIT09IDApIHsKICAgICAgICAgICAgZGlzdDIgLT0gYmFzZV9kaXN0W2NvZGVdOwogICAgICAgICAgICBzZW5kX2JpdHMocywgZGlzdDIsIGV4dHJhKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gd2hpbGUgKGx4IDwgcy5sYXN0X2xpdCk7CiAgICB9CiAgICBzZW5kX2NvZGUocywgRU5EX0JMT0NLLCBsdHJlZSk7CiAgfQogIGZ1bmN0aW9uIGJ1aWxkX3RyZWUocywgZGVzYykgewogICAgdmFyIHRyZWUgPSBkZXNjLmR5bl90cmVlOwogICAgdmFyIHN0cmVlID0gZGVzYy5zdGF0X2Rlc2Muc3RhdGljX3RyZWU7CiAgICB2YXIgaGFzX3N0cmVlID0gZGVzYy5zdGF0X2Rlc2MuaGFzX3N0cmVlOwogICAgdmFyIGVsZW1zID0gZGVzYy5zdGF0X2Rlc2MuZWxlbXM7CiAgICB2YXIgbiwgbTsKICAgIHZhciBtYXhfY29kZSA9IC0xOwogICAgdmFyIG5vZGU7CiAgICBzLmhlYXBfbGVuID0gMDsKICAgIHMuaGVhcF9tYXggPSBIRUFQX1NJWkUkMTsKICAgIGZvciAobiA9IDA7IG4gPCBlbGVtczsgbisrKSB7CiAgICAgIGlmICh0cmVlW24gKiAyXSAhPT0gMCkgewogICAgICAgIHMuaGVhcFsrK3MuaGVhcF9sZW5dID0gbWF4X2NvZGUgPSBuOwogICAgICAgIHMuZGVwdGhbbl0gPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIHRyZWVbbiAqIDIgKyAxXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIHdoaWxlIChzLmhlYXBfbGVuIDwgMikgewogICAgICBub2RlID0gcy5oZWFwWysrcy5oZWFwX2xlbl0gPSBtYXhfY29kZSA8IDIgPyArK21heF9jb2RlIDogMDsKICAgICAgdHJlZVtub2RlICogMl0gPSAxOwogICAgICBzLmRlcHRoW25vZGVdID0gMDsKICAgICAgcy5vcHRfbGVuLS07CiAgICAgIGlmIChoYXNfc3RyZWUpIHsKICAgICAgICBzLnN0YXRpY19sZW4gLT0gc3RyZWVbbm9kZSAqIDIgKyAxXTsKICAgICAgfQogICAgfQogICAgZGVzYy5tYXhfY29kZSA9IG1heF9jb2RlOwogICAgZm9yIChuID0gcy5oZWFwX2xlbiA+PiAxOyBuID49IDE7IG4tLSkgewogICAgICBwcWRvd25oZWFwKHMsIHRyZWUsIG4pOwogICAgfQogICAgbm9kZSA9IGVsZW1zOwogICAgZG8gewogICAgICBuID0gcy5oZWFwWzFdOwogICAgICBzLmhlYXBbMV0gPSBzLmhlYXBbcy5oZWFwX2xlbi0tXTsKICAgICAgcHFkb3duaGVhcChzLCB0cmVlLCAxKTsKICAgICAgbSA9IHMuaGVhcFsxXTsKICAgICAgcy5oZWFwWy0tcy5oZWFwX21heF0gPSBuOwogICAgICBzLmhlYXBbLS1zLmhlYXBfbWF4XSA9IG07CiAgICAgIHRyZWVbbm9kZSAqIDJdID0gdHJlZVtuICogMl0gKyB0cmVlW20gKiAyXTsKICAgICAgcy5kZXB0aFtub2RlXSA9IChzLmRlcHRoW25dID49IHMuZGVwdGhbbV0gPyBzLmRlcHRoW25dIDogcy5kZXB0aFttXSkgKyAxOwogICAgICB0cmVlW24gKiAyICsgMV0gPSB0cmVlW20gKiAyICsgMV0gPSBub2RlOwogICAgICBzLmhlYXBbMV0gPSBub2RlKys7CiAgICAgIHBxZG93bmhlYXAocywgdHJlZSwgMSk7CiAgICB9IHdoaWxlIChzLmhlYXBfbGVuID49IDIpOwogICAgcy5oZWFwWy0tcy5oZWFwX21heF0gPSBzLmhlYXBbMV07CiAgICBnZW5fYml0bGVuKHMsIGRlc2MpOwogICAgZ2VuX2NvZGVzKHRyZWUsIG1heF9jb2RlLCBzLmJsX2NvdW50KTsKICB9CiAgZnVuY3Rpb24gc2Nhbl90cmVlKHMsIHRyZWUsIG1heF9jb2RlKSB7CiAgICB2YXIgbjsKICAgIHZhciBwcmV2bGVuID0gLTE7CiAgICB2YXIgY3VybGVuOwogICAgdmFyIG5leHRsZW4gPSB0cmVlWzAgKiAyICsgMV07CiAgICB2YXIgY291bnQgPSAwOwogICAgdmFyIG1heF9jb3VudCA9IDc7CiAgICB2YXIgbWluX2NvdW50ID0gNDsKICAgIGlmIChuZXh0bGVuID09PSAwKSB7CiAgICAgIG1heF9jb3VudCA9IDEzODsKICAgICAgbWluX2NvdW50ID0gMzsKICAgIH0KICAgIHRyZWVbKG1heF9jb2RlICsgMSkgKiAyICsgMV0gPSA2NTUzNTsKICAgIGZvciAobiA9IDA7IG4gPD0gbWF4X2NvZGU7IG4rKykgewogICAgICBjdXJsZW4gPSBuZXh0bGVuOwogICAgICBuZXh0bGVuID0gdHJlZVsobiArIDEpICogMiArIDFdOwogICAgICBpZiAoKytjb3VudCA8IG1heF9jb3VudCAmJiBjdXJsZW4gPT09IG5leHRsZW4pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIGlmIChjb3VudCA8IG1pbl9jb3VudCkgewogICAgICAgIHMuYmxfdHJlZVtjdXJsZW4gKiAyXSArPSBjb3VudDsKICAgICAgfSBlbHNlIGlmIChjdXJsZW4gIT09IDApIHsKICAgICAgICBpZiAoY3VybGVuICE9PSBwcmV2bGVuKSB7CiAgICAgICAgICBzLmJsX3RyZWVbY3VybGVuICogMl0rKzsKICAgICAgICB9CiAgICAgICAgcy5ibF90cmVlW1JFUF8zXzYgKiAyXSsrOwogICAgICB9IGVsc2UgaWYgKGNvdW50IDw9IDEwKSB7CiAgICAgICAgcy5ibF90cmVlW1JFUFpfM18xMCAqIDJdKys7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcy5ibF90cmVlW1JFUFpfMTFfMTM4ICogMl0rKzsKICAgICAgfQogICAgICBjb3VudCA9IDA7CiAgICAgIHByZXZsZW4gPSBjdXJsZW47CiAgICAgIGlmIChuZXh0bGVuID09PSAwKSB7CiAgICAgICAgbWF4X2NvdW50ID0gMTM4OwogICAgICAgIG1pbl9jb3VudCA9IDM7CiAgICAgIH0gZWxzZSBpZiAoY3VybGVuID09PSBuZXh0bGVuKSB7CiAgICAgICAgbWF4X2NvdW50ID0gNjsKICAgICAgICBtaW5fY291bnQgPSAzOwogICAgICB9IGVsc2UgewogICAgICAgIG1heF9jb3VudCA9IDc7CiAgICAgICAgbWluX2NvdW50ID0gNDsKICAgICAgfQogICAgfQogIH0KICBmdW5jdGlvbiBzZW5kX3RyZWUocywgdHJlZSwgbWF4X2NvZGUpIHsKICAgIHZhciBuOwogICAgdmFyIHByZXZsZW4gPSAtMTsKICAgIHZhciBjdXJsZW47CiAgICB2YXIgbmV4dGxlbiA9IHRyZWVbMCAqIDIgKyAxXTsKICAgIHZhciBjb3VudCA9IDA7CiAgICB2YXIgbWF4X2NvdW50ID0gNzsKICAgIHZhciBtaW5fY291bnQgPSA0OwogICAgaWYgKG5leHRsZW4gPT09IDApIHsKICAgICAgbWF4X2NvdW50ID0gMTM4OwogICAgICBtaW5fY291bnQgPSAzOwogICAgfQogICAgZm9yIChuID0gMDsgbiA8PSBtYXhfY29kZTsgbisrKSB7CiAgICAgIGN1cmxlbiA9IG5leHRsZW47CiAgICAgIG5leHRsZW4gPSB0cmVlWyhuICsgMSkgKiAyICsgMV07CiAgICAgIGlmICgrK2NvdW50IDwgbWF4X2NvdW50ICYmIGN1cmxlbiA9PT0gbmV4dGxlbikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgaWYgKGNvdW50IDwgbWluX2NvdW50KSB7CiAgICAgICAgZG8gewogICAgICAgICAgc2VuZF9jb2RlKHMsIGN1cmxlbiwgcy5ibF90cmVlKTsKICAgICAgICB9IHdoaWxlICgtLWNvdW50ICE9PSAwKTsKICAgICAgfSBlbHNlIGlmIChjdXJsZW4gIT09IDApIHsKICAgICAgICBpZiAoY3VybGVuICE9PSBwcmV2bGVuKSB7CiAgICAgICAgICBzZW5kX2NvZGUocywgY3VybGVuLCBzLmJsX3RyZWUpOwogICAgICAgICAgY291bnQtLTsKICAgICAgICB9CiAgICAgICAgc2VuZF9jb2RlKHMsIFJFUF8zXzYsIHMuYmxfdHJlZSk7CiAgICAgICAgc2VuZF9iaXRzKHMsIGNvdW50IC0gMywgMik7CiAgICAgIH0gZWxzZSBpZiAoY291bnQgPD0gMTApIHsKICAgICAgICBzZW5kX2NvZGUocywgUkVQWl8zXzEwLCBzLmJsX3RyZWUpOwogICAgICAgIHNlbmRfYml0cyhzLCBjb3VudCAtIDMsIDMpOwogICAgICB9IGVsc2UgewogICAgICAgIHNlbmRfY29kZShzLCBSRVBaXzExXzEzOCwgcy5ibF90cmVlKTsKICAgICAgICBzZW5kX2JpdHMocywgY291bnQgLSAxMSwgNyk7CiAgICAgIH0KICAgICAgY291bnQgPSAwOwogICAgICBwcmV2bGVuID0gY3VybGVuOwogICAgICBpZiAobmV4dGxlbiA9PT0gMCkgewogICAgICAgIG1heF9jb3VudCA9IDEzODsKICAgICAgICBtaW5fY291bnQgPSAzOwogICAgICB9IGVsc2UgaWYgKGN1cmxlbiA9PT0gbmV4dGxlbikgewogICAgICAgIG1heF9jb3VudCA9IDY7CiAgICAgICAgbWluX2NvdW50ID0gMzsKICAgICAgfSBlbHNlIHsKICAgICAgICBtYXhfY291bnQgPSA3OwogICAgICAgIG1pbl9jb3VudCA9IDQ7CiAgICAgIH0KICAgIH0KICB9CiAgZnVuY3Rpb24gYnVpbGRfYmxfdHJlZShzKSB7CiAgICB2YXIgbWF4X2JsaW5kZXg7CiAgICBzY2FuX3RyZWUocywgcy5keW5fbHRyZWUsIHMubF9kZXNjLm1heF9jb2RlKTsKICAgIHNjYW5fdHJlZShzLCBzLmR5bl9kdHJlZSwgcy5kX2Rlc2MubWF4X2NvZGUpOwogICAgYnVpbGRfdHJlZShzLCBzLmJsX2Rlc2MpOwogICAgZm9yIChtYXhfYmxpbmRleCA9IEJMX0NPREVTJDEgLSAxOyBtYXhfYmxpbmRleCA+PSAzOyBtYXhfYmxpbmRleC0tKSB7CiAgICAgIGlmIChzLmJsX3RyZWVbYmxfb3JkZXJbbWF4X2JsaW5kZXhdICogMiArIDFdICE9PSAwKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHMub3B0X2xlbiArPSAzICogKG1heF9ibGluZGV4ICsgMSkgKyA1ICsgNSArIDQ7CiAgICByZXR1cm4gbWF4X2JsaW5kZXg7CiAgfQogIGZ1bmN0aW9uIHNlbmRfYWxsX3RyZWVzKHMsIGxjb2RlcywgZGNvZGVzLCBibGNvZGVzKSB7CiAgICB2YXIgcmFuazI7CiAgICBzZW5kX2JpdHMocywgbGNvZGVzIC0gMjU3LCA1KTsKICAgIHNlbmRfYml0cyhzLCBkY29kZXMgLSAxLCA1KTsKICAgIHNlbmRfYml0cyhzLCBibGNvZGVzIC0gNCwgNCk7CiAgICBmb3IgKHJhbmsyID0gMDsgcmFuazIgPCBibGNvZGVzOyByYW5rMisrKSB7CiAgICAgIHNlbmRfYml0cyhzLCBzLmJsX3RyZWVbYmxfb3JkZXJbcmFuazJdICogMiArIDFdLCAzKTsKICAgIH0KICAgIHNlbmRfdHJlZShzLCBzLmR5bl9sdHJlZSwgbGNvZGVzIC0gMSk7CiAgICBzZW5kX3RyZWUocywgcy5keW5fZHRyZWUsIGRjb2RlcyAtIDEpOwogIH0KICBmdW5jdGlvbiBkZXRlY3RfZGF0YV90eXBlKHMpIHsKICAgIHZhciBibGFja19tYXNrID0gNDA5MzYyNDQ0NzsKICAgIHZhciBuOwogICAgZm9yIChuID0gMDsgbiA8PSAzMTsgbisrLCBibGFja19tYXNrID4+Pj0gMSkgewogICAgICBpZiAoYmxhY2tfbWFzayAmIDEgJiYgcy5keW5fbHRyZWVbbiAqIDJdICE9PSAwKSB7CiAgICAgICAgcmV0dXJuIFpfQklOQVJZOwogICAgICB9CiAgICB9CiAgICBpZiAocy5keW5fbHRyZWVbOSAqIDJdICE9PSAwIHx8IHMuZHluX2x0cmVlWzEwICogMl0gIT09IDAgfHwgcy5keW5fbHRyZWVbMTMgKiAyXSAhPT0gMCkgewogICAgICByZXR1cm4gWl9URVhUOwogICAgfQogICAgZm9yIChuID0gMzI7IG4gPCBMSVRFUkFMUyQxOyBuKyspIHsKICAgICAgaWYgKHMuZHluX2x0cmVlW24gKiAyXSAhPT0gMCkgewogICAgICAgIHJldHVybiBaX1RFWFQ7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBaX0JJTkFSWTsKICB9CiAgdmFyIHN0YXRpY19pbml0X2RvbmUgPSBmYWxzZTsKICBmdW5jdGlvbiBfdHJfaW5pdChzKSB7CiAgICBpZiAoIXN0YXRpY19pbml0X2RvbmUpIHsKICAgICAgdHJfc3RhdGljX2luaXQoKTsKICAgICAgc3RhdGljX2luaXRfZG9uZSA9IHRydWU7CiAgICB9CiAgICBzLmxfZGVzYyA9IG5ldyBUcmVlRGVzYyhzLmR5bl9sdHJlZSwgc3RhdGljX2xfZGVzYyk7CiAgICBzLmRfZGVzYyA9IG5ldyBUcmVlRGVzYyhzLmR5bl9kdHJlZSwgc3RhdGljX2RfZGVzYyk7CiAgICBzLmJsX2Rlc2MgPSBuZXcgVHJlZURlc2Mocy5ibF90cmVlLCBzdGF0aWNfYmxfZGVzYyk7CiAgICBzLmJpX2J1ZiA9IDA7CiAgICBzLmJpX3ZhbGlkID0gMDsKICAgIGluaXRfYmxvY2socyk7CiAgfQogIGZ1bmN0aW9uIF90cl9zdG9yZWRfYmxvY2socywgYnVmLCBzdG9yZWRfbGVuLCBsYXN0KSB7CiAgICBzZW5kX2JpdHMocywgKFNUT1JFRF9CTE9DSyA8PCAxKSArIChsYXN0ID8gMSA6IDApLCAzKTsKICAgIGNvcHlfYmxvY2socywgYnVmLCBzdG9yZWRfbGVuLCB0cnVlKTsKICB9CiAgZnVuY3Rpb24gX3RyX2FsaWduKHMpIHsKICAgIHNlbmRfYml0cyhzLCBTVEFUSUNfVFJFRVMgPDwgMSwgMyk7CiAgICBzZW5kX2NvZGUocywgRU5EX0JMT0NLLCBzdGF0aWNfbHRyZWUpOwogICAgYmlfZmx1c2gocyk7CiAgfQogIGZ1bmN0aW9uIF90cl9mbHVzaF9ibG9jayhzLCBidWYsIHN0b3JlZF9sZW4sIGxhc3QpIHsKICAgIHZhciBvcHRfbGVuYiwgc3RhdGljX2xlbmI7CiAgICB2YXIgbWF4X2JsaW5kZXggPSAwOwogICAgaWYgKHMubGV2ZWwgPiAwKSB7CiAgICAgIGlmIChzLnN0cm0uZGF0YV90eXBlID09PSBaX1VOS05PV04kMSkgewogICAgICAgIHMuc3RybS5kYXRhX3R5cGUgPSBkZXRlY3RfZGF0YV90eXBlKHMpOwogICAgICB9CiAgICAgIGJ1aWxkX3RyZWUocywgcy5sX2Rlc2MpOwogICAgICBidWlsZF90cmVlKHMsIHMuZF9kZXNjKTsKICAgICAgbWF4X2JsaW5kZXggPSBidWlsZF9ibF90cmVlKHMpOwogICAgICBvcHRfbGVuYiA9IHMub3B0X2xlbiArIDMgKyA3ID4+PiAzOwogICAgICBzdGF0aWNfbGVuYiA9IHMuc3RhdGljX2xlbiArIDMgKyA3ID4+PiAzOwogICAgICBpZiAoc3RhdGljX2xlbmIgPD0gb3B0X2xlbmIpIHsKICAgICAgICBvcHRfbGVuYiA9IHN0YXRpY19sZW5iOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBvcHRfbGVuYiA9IHN0YXRpY19sZW5iID0gc3RvcmVkX2xlbiArIDU7CiAgICB9CiAgICBpZiAoc3RvcmVkX2xlbiArIDQgPD0gb3B0X2xlbmIgJiYgYnVmICE9PSAtMSkgewogICAgICBfdHJfc3RvcmVkX2Jsb2NrKHMsIGJ1Ziwgc3RvcmVkX2xlbiwgbGFzdCk7CiAgICB9IGVsc2UgaWYgKHMuc3RyYXRlZ3kgPT09IFpfRklYRUQkMSB8fCBzdGF0aWNfbGVuYiA9PT0gb3B0X2xlbmIpIHsKICAgICAgc2VuZF9iaXRzKHMsIChTVEFUSUNfVFJFRVMgPDwgMSkgKyAobGFzdCA/IDEgOiAwKSwgMyk7CiAgICAgIGNvbXByZXNzX2Jsb2NrKHMsIHN0YXRpY19sdHJlZSwgc3RhdGljX2R0cmVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHNlbmRfYml0cyhzLCAoRFlOX1RSRUVTIDw8IDEpICsgKGxhc3QgPyAxIDogMCksIDMpOwogICAgICBzZW5kX2FsbF90cmVlcyhzLCBzLmxfZGVzYy5tYXhfY29kZSArIDEsIHMuZF9kZXNjLm1heF9jb2RlICsgMSwgbWF4X2JsaW5kZXggKyAxKTsKICAgICAgY29tcHJlc3NfYmxvY2socywgcy5keW5fbHRyZWUsIHMuZHluX2R0cmVlKTsKICAgIH0KICAgIGluaXRfYmxvY2socyk7CiAgICBpZiAobGFzdCkgewogICAgICBiaV93aW5kdXAocyk7CiAgICB9CiAgfQogIGZ1bmN0aW9uIF90cl90YWxseShzLCBkaXN0MiwgbGMpIHsKICAgIHMucGVuZGluZ19idWZbcy5kX2J1ZiArIHMubGFzdF9saXQgKiAyXSA9IGRpc3QyID4+PiA4ICYgMjU1OwogICAgcy5wZW5kaW5nX2J1ZltzLmRfYnVmICsgcy5sYXN0X2xpdCAqIDIgKyAxXSA9IGRpc3QyICYgMjU1OwogICAgcy5wZW5kaW5nX2J1ZltzLmxfYnVmICsgcy5sYXN0X2xpdF0gPSBsYyAmIDI1NTsKICAgIHMubGFzdF9saXQrKzsKICAgIGlmIChkaXN0MiA9PT0gMCkgewogICAgICBzLmR5bl9sdHJlZVtsYyAqIDJdKys7CiAgICB9IGVsc2UgewogICAgICBzLm1hdGNoZXMrKzsKICAgICAgZGlzdDItLTsKICAgICAgcy5keW5fbHRyZWVbKF9sZW5ndGhfY29kZVtsY10gKyBMSVRFUkFMUyQxICsgMSkgKiAyXSsrOwogICAgICBzLmR5bl9kdHJlZVtkX2NvZGUoZGlzdDIpICogMl0rKzsKICAgIH0KICAgIHJldHVybiBzLmxhc3RfbGl0ID09PSBzLmxpdF9idWZzaXplIC0gMTsKICB9CiAgdHJlZXMkMS5fdHJfaW5pdCA9IF90cl9pbml0OwogIHRyZWVzJDEuX3RyX3N0b3JlZF9ibG9jayA9IF90cl9zdG9yZWRfYmxvY2s7CiAgdHJlZXMkMS5fdHJfZmx1c2hfYmxvY2sgPSBfdHJfZmx1c2hfYmxvY2s7CiAgdHJlZXMkMS5fdHJfdGFsbHkgPSBfdHJfdGFsbHk7CiAgdHJlZXMkMS5fdHJfYWxpZ24gPSBfdHJfYWxpZ247CiAgZnVuY3Rpb24gYWRsZXIzMiQyKGFkbGVyLCBidWYsIGxlbiwgcG9zKSB7CiAgICB2YXIgczEgPSBhZGxlciAmIDY1NTM1IHwgMCwgczIgPSBhZGxlciA+Pj4gMTYgJiA2NTUzNSB8IDAsIG4gPSAwOwogICAgd2hpbGUgKGxlbiAhPT0gMCkgewogICAgICBuID0gbGVuID4gMmUzID8gMmUzIDogbGVuOwogICAgICBsZW4gLT0gbjsKICAgICAgZG8gewogICAgICAgIHMxID0gczEgKyBidWZbcG9zKytdIHwgMDsKICAgICAgICBzMiA9IHMyICsgczEgfCAwOwogICAgICB9IHdoaWxlICgtLW4pOwogICAgICBzMSAlPSA2NTUyMTsKICAgICAgczIgJT0gNjU1MjE7CiAgICB9CiAgICByZXR1cm4gczEgfCBzMiA8PCAxNiB8IDA7CiAgfQogIHZhciBhZGxlcjMyXzEgPSBhZGxlcjMyJDI7CiAgZnVuY3Rpb24gbWFrZVRhYmxlKCkgewogICAgdmFyIGMyLCB0YWJsZSA9IFtdOwogICAgZm9yICh2YXIgbiA9IDA7IG4gPCAyNTY7IG4rKykgewogICAgICBjMiA9IG47CiAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgODsgaysrKSB7CiAgICAgICAgYzIgPSBjMiAmIDEgPyAzOTg4MjkyMzg0IF4gYzIgPj4+IDEgOiBjMiA+Pj4gMTsKICAgICAgfQogICAgICB0YWJsZVtuXSA9IGMyOwogICAgfQogICAgcmV0dXJuIHRhYmxlOwogIH0KICB2YXIgY3JjVGFibGUgPSBtYWtlVGFibGUoKTsKICBmdW5jdGlvbiBjcmMzMiQyKGNyYywgYnVmLCBsZW4sIHBvcykgewogICAgdmFyIHQgPSBjcmNUYWJsZSwgZW5kID0gcG9zICsgbGVuOwogICAgY3JjIF49IC0xOwogICAgZm9yICh2YXIgaSA9IHBvczsgaSA8IGVuZDsgaSsrKSB7CiAgICAgIGNyYyA9IGNyYyA+Pj4gOCBeIHRbKGNyYyBeIGJ1ZltpXSkgJiAyNTVdOwogICAgfQogICAgcmV0dXJuIGNyYyBeIC0xOwogIH0KICB2YXIgY3JjMzJfMSA9IGNyYzMyJDI7CiAgdmFyIG1lc3NhZ2VzJDEgPSB7CiAgICAyOiAibmVlZCBkaWN0aW9uYXJ5IiwKICAgIDE6ICJzdHJlYW0gZW5kIiwKICAgIDA6ICIiLAogICAgIi0xIjogImZpbGUgZXJyb3IiLAogICAgIi0yIjogInN0cmVhbSBlcnJvciIsCiAgICAiLTMiOiAiZGF0YSBlcnJvciIsCiAgICAiLTQiOiAiaW5zdWZmaWNpZW50IG1lbW9yeSIsCiAgICAiLTUiOiAiYnVmZmVyIGVycm9yIiwKICAgICItNiI6ICJpbmNvbXBhdGlibGUgdmVyc2lvbiIKICB9OwogIHZhciB1dGlscyQ1ID0gY29tbW9uJDE7CiAgdmFyIHRyZWVzID0gdHJlZXMkMTsKICB2YXIgYWRsZXIzMiQxID0gYWRsZXIzMl8xOwogIHZhciBjcmMzMiQxID0gY3JjMzJfMTsKICB2YXIgbXNnJDIgPSBtZXNzYWdlcyQxOwogIHZhciBaX05PX0ZMVVNIJDEgPSAwOwogIHZhciBaX1BBUlRJQUxfRkxVU0ggPSAxOwogIHZhciBaX0ZVTExfRkxVU0ggPSAzOwogIHZhciBaX0ZJTklTSCQyID0gNDsKICB2YXIgWl9CTE9DSyQxID0gNTsKICB2YXIgWl9PSyQyID0gMDsKICB2YXIgWl9TVFJFQU1fRU5EJDIgPSAxOwogIHZhciBaX1NUUkVBTV9FUlJPUiQxID0gLTI7CiAgdmFyIFpfREFUQV9FUlJPUiQxID0gLTM7CiAgdmFyIFpfQlVGX0VSUk9SJDEgPSAtNTsKICB2YXIgWl9ERUZBVUxUX0NPTVBSRVNTSU9OJDEgPSAtMTsKICB2YXIgWl9GSUxURVJFRCA9IDE7CiAgdmFyIFpfSFVGRk1BTl9PTkxZID0gMjsKICB2YXIgWl9STEUgPSAzOwogIHZhciBaX0ZJWEVEID0gNDsKICB2YXIgWl9ERUZBVUxUX1NUUkFURUdZJDEgPSAwOwogIHZhciBaX1VOS05PV04gPSAyOwogIHZhciBaX0RFRkxBVEVEJDIgPSA4OwogIHZhciBNQVhfTUVNX0xFVkVMID0gOTsKICB2YXIgTUFYX1dCSVRTJDEgPSAxNTsKICB2YXIgREVGX01FTV9MRVZFTCA9IDg7CiAgdmFyIExFTkdUSF9DT0RFUyA9IDI5OwogIHZhciBMSVRFUkFMUyA9IDI1NjsKICB2YXIgTF9DT0RFUyA9IExJVEVSQUxTICsgMSArIExFTkdUSF9DT0RFUzsKICB2YXIgRF9DT0RFUyA9IDMwOwogIHZhciBCTF9DT0RFUyA9IDE5OwogIHZhciBIRUFQX1NJWkUgPSAyICogTF9DT0RFUyArIDE7CiAgdmFyIE1BWF9CSVRTID0gMTU7CiAgdmFyIE1JTl9NQVRDSCA9IDM7CiAgdmFyIE1BWF9NQVRDSCA9IDI1ODsKICB2YXIgTUlOX0xPT0tBSEVBRCA9IE1BWF9NQVRDSCArIE1JTl9NQVRDSCArIDE7CiAgdmFyIFBSRVNFVF9ESUNUID0gMzI7CiAgdmFyIElOSVRfU1RBVEUgPSA0MjsKICB2YXIgRVhUUkFfU1RBVEUgPSA2OTsKICB2YXIgTkFNRV9TVEFURSA9IDczOwogIHZhciBDT01NRU5UX1NUQVRFID0gOTE7CiAgdmFyIEhDUkNfU1RBVEUgPSAxMDM7CiAgdmFyIEJVU1lfU1RBVEUgPSAxMTM7CiAgdmFyIEZJTklTSF9TVEFURSA9IDY2NjsKICB2YXIgQlNfTkVFRF9NT1JFID0gMTsKICB2YXIgQlNfQkxPQ0tfRE9ORSA9IDI7CiAgdmFyIEJTX0ZJTklTSF9TVEFSVEVEID0gMzsKICB2YXIgQlNfRklOSVNIX0RPTkUgPSA0OwogIHZhciBPU19DT0RFID0gMzsKICBmdW5jdGlvbiBlcnIoc3RybSwgZXJyb3JDb2RlKSB7CiAgICBzdHJtLm1zZyA9IG1zZyQyW2Vycm9yQ29kZV07CiAgICByZXR1cm4gZXJyb3JDb2RlOwogIH0KICBmdW5jdGlvbiByYW5rKGYpIHsKICAgIHJldHVybiAoZiA8PCAxKSAtIChmID4gNCA/IDkgOiAwKTsKICB9CiAgZnVuY3Rpb24gemVybyhidWYpIHsKICAgIHZhciBsZW4gPSBidWYubGVuZ3RoOwogICAgd2hpbGUgKC0tbGVuID49IDApIHsKICAgICAgYnVmW2xlbl0gPSAwOwogICAgfQogIH0KICBmdW5jdGlvbiBmbHVzaF9wZW5kaW5nKHN0cm0pIHsKICAgIHZhciBzID0gc3RybS5zdGF0ZTsKICAgIHZhciBsZW4gPSBzLnBlbmRpbmc7CiAgICBpZiAobGVuID4gc3RybS5hdmFpbF9vdXQpIHsKICAgICAgbGVuID0gc3RybS5hdmFpbF9vdXQ7CiAgICB9CiAgICBpZiAobGVuID09PSAwKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHV0aWxzJDUuYXJyYXlTZXQoc3RybS5vdXRwdXQsIHMucGVuZGluZ19idWYsIHMucGVuZGluZ19vdXQsIGxlbiwgc3RybS5uZXh0X291dCk7CiAgICBzdHJtLm5leHRfb3V0ICs9IGxlbjsKICAgIHMucGVuZGluZ19vdXQgKz0gbGVuOwogICAgc3RybS50b3RhbF9vdXQgKz0gbGVuOwogICAgc3RybS5hdmFpbF9vdXQgLT0gbGVuOwogICAgcy5wZW5kaW5nIC09IGxlbjsKICAgIGlmIChzLnBlbmRpbmcgPT09IDApIHsKICAgICAgcy5wZW5kaW5nX291dCA9IDA7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGZsdXNoX2Jsb2NrX29ubHkocywgbGFzdCkgewogICAgdHJlZXMuX3RyX2ZsdXNoX2Jsb2NrKHMsIHMuYmxvY2tfc3RhcnQgPj0gMCA/IHMuYmxvY2tfc3RhcnQgOiAtMSwgcy5zdHJzdGFydCAtIHMuYmxvY2tfc3RhcnQsIGxhc3QpOwogICAgcy5ibG9ja19zdGFydCA9IHMuc3Ryc3RhcnQ7CiAgICBmbHVzaF9wZW5kaW5nKHMuc3RybSk7CiAgfQogIGZ1bmN0aW9uIHB1dF9ieXRlKHMsIGIpIHsKICAgIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gYjsKICB9CiAgZnVuY3Rpb24gcHV0U2hvcnRNU0IocywgYikgewogICAgcy5wZW5kaW5nX2J1ZltzLnBlbmRpbmcrK10gPSBiID4+PiA4ICYgMjU1OwogICAgcy5wZW5kaW5nX2J1ZltzLnBlbmRpbmcrK10gPSBiICYgMjU1OwogIH0KICBmdW5jdGlvbiByZWFkX2J1ZihzdHJtLCBidWYsIHN0YXJ0LCBzaXplKSB7CiAgICB2YXIgbGVuID0gc3RybS5hdmFpbF9pbjsKICAgIGlmIChsZW4gPiBzaXplKSB7CiAgICAgIGxlbiA9IHNpemU7CiAgICB9CiAgICBpZiAobGVuID09PSAwKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgc3RybS5hdmFpbF9pbiAtPSBsZW47CiAgICB1dGlscyQ1LmFycmF5U2V0KGJ1Ziwgc3RybS5pbnB1dCwgc3RybS5uZXh0X2luLCBsZW4sIHN0YXJ0KTsKICAgIGlmIChzdHJtLnN0YXRlLndyYXAgPT09IDEpIHsKICAgICAgc3RybS5hZGxlciA9IGFkbGVyMzIkMShzdHJtLmFkbGVyLCBidWYsIGxlbiwgc3RhcnQpOwogICAgfSBlbHNlIGlmIChzdHJtLnN0YXRlLndyYXAgPT09IDIpIHsKICAgICAgc3RybS5hZGxlciA9IGNyYzMyJDEoc3RybS5hZGxlciwgYnVmLCBsZW4sIHN0YXJ0KTsKICAgIH0KICAgIHN0cm0ubmV4dF9pbiArPSBsZW47CiAgICBzdHJtLnRvdGFsX2luICs9IGxlbjsKICAgIHJldHVybiBsZW47CiAgfQogIGZ1bmN0aW9uIGxvbmdlc3RfbWF0Y2gocywgY3VyX21hdGNoKSB7CiAgICB2YXIgY2hhaW5fbGVuZ3RoID0gcy5tYXhfY2hhaW5fbGVuZ3RoOwogICAgdmFyIHNjYW4gPSBzLnN0cnN0YXJ0OwogICAgdmFyIG1hdGNoOwogICAgdmFyIGxlbjsKICAgIHZhciBiZXN0X2xlbiA9IHMucHJldl9sZW5ndGg7CiAgICB2YXIgbmljZV9tYXRjaCA9IHMubmljZV9tYXRjaDsKICAgIHZhciBsaW1pdCA9IHMuc3Ryc3RhcnQgPiBzLndfc2l6ZSAtIE1JTl9MT09LQUhFQUQgPyBzLnN0cnN0YXJ0IC0gKHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkgOiAwOwogICAgdmFyIF93aW4gPSBzLndpbmRvdzsKICAgIHZhciB3bWFzayA9IHMud19tYXNrOwogICAgdmFyIHByZXYgPSBzLnByZXY7CiAgICB2YXIgc3RyZW5kID0gcy5zdHJzdGFydCArIE1BWF9NQVRDSDsKICAgIHZhciBzY2FuX2VuZDEgPSBfd2luW3NjYW4gKyBiZXN0X2xlbiAtIDFdOwogICAgdmFyIHNjYW5fZW5kID0gX3dpbltzY2FuICsgYmVzdF9sZW5dOwogICAgaWYgKHMucHJldl9sZW5ndGggPj0gcy5nb29kX21hdGNoKSB7CiAgICAgIGNoYWluX2xlbmd0aCA+Pj0gMjsKICAgIH0KICAgIGlmIChuaWNlX21hdGNoID4gcy5sb29rYWhlYWQpIHsKICAgICAgbmljZV9tYXRjaCA9IHMubG9va2FoZWFkOwogICAgfQogICAgZG8gewogICAgICBtYXRjaCA9IGN1cl9tYXRjaDsKICAgICAgaWYgKF93aW5bbWF0Y2ggKyBiZXN0X2xlbl0gIT09IHNjYW5fZW5kIHx8IF93aW5bbWF0Y2ggKyBiZXN0X2xlbiAtIDFdICE9PSBzY2FuX2VuZDEgfHwgX3dpblttYXRjaF0gIT09IF93aW5bc2Nhbl0gfHwgX3dpblsrK21hdGNoXSAhPT0gX3dpbltzY2FuICsgMV0pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBzY2FuICs9IDI7CiAgICAgIG1hdGNoKys7CiAgICAgIGRvIHsKICAgICAgfSB3aGlsZSAoX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmIF93aW5bKytzY2FuXSA9PT0gX3dpblsrK21hdGNoXSAmJiBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmIF93aW5bKytzY2FuXSA9PT0gX3dpblsrK21hdGNoXSAmJiBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmIF93aW5bKytzY2FuXSA9PT0gX3dpblsrK21hdGNoXSAmJiBzY2FuIDwgc3RyZW5kKTsKICAgICAgbGVuID0gTUFYX01BVENIIC0gKHN0cmVuZCAtIHNjYW4pOwogICAgICBzY2FuID0gc3RyZW5kIC0gTUFYX01BVENIOwogICAgICBpZiAobGVuID4gYmVzdF9sZW4pIHsKICAgICAgICBzLm1hdGNoX3N0YXJ0ID0gY3VyX21hdGNoOwogICAgICAgIGJlc3RfbGVuID0gbGVuOwogICAgICAgIGlmIChsZW4gPj0gbmljZV9tYXRjaCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHNjYW5fZW5kMSA9IF93aW5bc2NhbiArIGJlc3RfbGVuIC0gMV07CiAgICAgICAgc2Nhbl9lbmQgPSBfd2luW3NjYW4gKyBiZXN0X2xlbl07CiAgICAgIH0KICAgIH0gd2hpbGUgKChjdXJfbWF0Y2ggPSBwcmV2W2N1cl9tYXRjaCAmIHdtYXNrXSkgPiBsaW1pdCAmJiAtLWNoYWluX2xlbmd0aCAhPT0gMCk7CiAgICBpZiAoYmVzdF9sZW4gPD0gcy5sb29rYWhlYWQpIHsKICAgICAgcmV0dXJuIGJlc3RfbGVuOwogICAgfQogICAgcmV0dXJuIHMubG9va2FoZWFkOwogIH0KICBmdW5jdGlvbiBmaWxsX3dpbmRvdyhzKSB7CiAgICB2YXIgX3dfc2l6ZSA9IHMud19zaXplOwogICAgdmFyIHAsIG4sIG0sIG1vcmUsIHN0cjsKICAgIGRvIHsKICAgICAgbW9yZSA9IHMud2luZG93X3NpemUgLSBzLmxvb2thaGVhZCAtIHMuc3Ryc3RhcnQ7CiAgICAgIGlmIChzLnN0cnN0YXJ0ID49IF93X3NpemUgKyAoX3dfc2l6ZSAtIE1JTl9MT09LQUhFQUQpKSB7CiAgICAgICAgdXRpbHMkNS5hcnJheVNldChzLndpbmRvdywgcy53aW5kb3csIF93X3NpemUsIF93X3NpemUsIDApOwogICAgICAgIHMubWF0Y2hfc3RhcnQgLT0gX3dfc2l6ZTsKICAgICAgICBzLnN0cnN0YXJ0IC09IF93X3NpemU7CiAgICAgICAgcy5ibG9ja19zdGFydCAtPSBfd19zaXplOwogICAgICAgIG4gPSBzLmhhc2hfc2l6ZTsKICAgICAgICBwID0gbjsKICAgICAgICBkbyB7CiAgICAgICAgICBtID0gcy5oZWFkWy0tcF07CiAgICAgICAgICBzLmhlYWRbcF0gPSBtID49IF93X3NpemUgPyBtIC0gX3dfc2l6ZSA6IDA7CiAgICAgICAgfSB3aGlsZSAoLS1uKTsKICAgICAgICBuID0gX3dfc2l6ZTsKICAgICAgICBwID0gbjsKICAgICAgICBkbyB7CiAgICAgICAgICBtID0gcy5wcmV2Wy0tcF07CiAgICAgICAgICBzLnByZXZbcF0gPSBtID49IF93X3NpemUgPyBtIC0gX3dfc2l6ZSA6IDA7CiAgICAgICAgfSB3aGlsZSAoLS1uKTsKICAgICAgICBtb3JlICs9IF93X3NpemU7CiAgICAgIH0KICAgICAgaWYgKHMuc3RybS5hdmFpbF9pbiA9PT0gMCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIG4gPSByZWFkX2J1ZihzLnN0cm0sIHMud2luZG93LCBzLnN0cnN0YXJ0ICsgcy5sb29rYWhlYWQsIG1vcmUpOwogICAgICBzLmxvb2thaGVhZCArPSBuOwogICAgICBpZiAocy5sb29rYWhlYWQgKyBzLmluc2VydCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICBzdHIgPSBzLnN0cnN0YXJ0IC0gcy5pbnNlcnQ7CiAgICAgICAgcy5pbnNfaCA9IHMud2luZG93W3N0cl07CiAgICAgICAgcy5pbnNfaCA9IChzLmluc19oIDw8IHMuaGFzaF9zaGlmdCBeIHMud2luZG93W3N0ciArIDFdKSAmIHMuaGFzaF9tYXNrOwogICAgICAgIHdoaWxlIChzLmluc2VydCkgewogICAgICAgICAgcy5pbnNfaCA9IChzLmluc19oIDw8IHMuaGFzaF9zaGlmdCBeIHMud2luZG93W3N0ciArIE1JTl9NQVRDSCAtIDFdKSAmIHMuaGFzaF9tYXNrOwogICAgICAgICAgcy5wcmV2W3N0ciAmIHMud19tYXNrXSA9IHMuaGVhZFtzLmluc19oXTsKICAgICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHN0cjsKICAgICAgICAgIHN0cisrOwogICAgICAgICAgcy5pbnNlcnQtLTsKICAgICAgICAgIGlmIChzLmxvb2thaGVhZCArIHMuaW5zZXJ0IDwgTUlOX01BVENIKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSB3aGlsZSAocy5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFEICYmIHMuc3RybS5hdmFpbF9pbiAhPT0gMCk7CiAgfQogIGZ1bmN0aW9uIGRlZmxhdGVfc3RvcmVkKHMsIGZsdXNoKSB7CiAgICB2YXIgbWF4X2Jsb2NrX3NpemUgPSA2NTUzNTsKICAgIGlmIChtYXhfYmxvY2tfc2l6ZSA+IHMucGVuZGluZ19idWZfc2l6ZSAtIDUpIHsKICAgICAgbWF4X2Jsb2NrX3NpemUgPSBzLnBlbmRpbmdfYnVmX3NpemUgLSA1OwogICAgfQogICAgZm9yICg7IDsgKSB7CiAgICAgIGlmIChzLmxvb2thaGVhZCA8PSAxKSB7CiAgICAgICAgZmlsbF93aW5kb3cocyk7CiAgICAgICAgaWYgKHMubG9va2FoZWFkID09PSAwICYmIGZsdXNoID09PSBaX05PX0ZMVVNIJDEpIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHMuc3Ryc3RhcnQgKz0gcy5sb29rYWhlYWQ7CiAgICAgIHMubG9va2FoZWFkID0gMDsKICAgICAgdmFyIG1heF9zdGFydCA9IHMuYmxvY2tfc3RhcnQgKyBtYXhfYmxvY2tfc2l6ZTsKICAgICAgaWYgKHMuc3Ryc3RhcnQgPT09IDAgfHwgcy5zdHJzdGFydCA+PSBtYXhfc3RhcnQpIHsKICAgICAgICBzLmxvb2thaGVhZCA9IHMuc3Ryc3RhcnQgLSBtYXhfc3RhcnQ7CiAgICAgICAgcy5zdHJzdGFydCA9IG1heF9zdGFydDsKICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHMuc3Ryc3RhcnQgLSBzLmJsb2NrX3N0YXJ0ID49IHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkgewogICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcy5pbnNlcnQgPSAwOwogICAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCQyKSB7CiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgdHJ1ZSk7CiAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgcmV0dXJuIEJTX0ZJTklTSF9TVEFSVEVEOwogICAgICB9CiAgICAgIHJldHVybiBCU19GSU5JU0hfRE9ORTsKICAgIH0KICAgIGlmIChzLnN0cnN0YXJ0ID4gcy5ibG9ja19zdGFydCkgewogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogIH0KICBmdW5jdGlvbiBkZWZsYXRlX2Zhc3QocywgZmx1c2gpIHsKICAgIHZhciBoYXNoX2hlYWQ7CiAgICB2YXIgYmZsdXNoOwogICAgZm9yICg7IDsgKSB7CiAgICAgIGlmIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQpIHsKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFEICYmIGZsdXNoID09PSBaX05PX0ZMVVNIJDEpIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGhhc2hfaGVhZCA9IDA7CiAgICAgIGlmIChzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICBzLmluc19oID0gKHMuaW5zX2ggPDwgcy5oYXNoX3NoaWZ0IF4gcy53aW5kb3dbcy5zdHJzdGFydCArIE1JTl9NQVRDSCAtIDFdKSAmIHMuaGFzaF9tYXNrOwogICAgICAgIGhhc2hfaGVhZCA9IHMucHJldltzLnN0cnN0YXJ0ICYgcy53X21hc2tdID0gcy5oZWFkW3MuaW5zX2hdOwogICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHMuc3Ryc3RhcnQ7CiAgICAgIH0KICAgICAgaWYgKGhhc2hfaGVhZCAhPT0gMCAmJiBzLnN0cnN0YXJ0IC0gaGFzaF9oZWFkIDw9IHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkgewogICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gbG9uZ2VzdF9tYXRjaChzLCBoYXNoX2hlYWQpOwogICAgICB9CiAgICAgIGlmIChzLm1hdGNoX2xlbmd0aCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICBiZmx1c2ggPSB0cmVlcy5fdHJfdGFsbHkocywgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQsIHMubWF0Y2hfbGVuZ3RoIC0gTUlOX01BVENIKTsKICAgICAgICBzLmxvb2thaGVhZCAtPSBzLm1hdGNoX2xlbmd0aDsKICAgICAgICBpZiAocy5tYXRjaF9sZW5ndGggPD0gcy5tYXhfbGF6eV9tYXRjaCAmJiBzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoLS07CiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHMuc3Ryc3RhcnQrKzsKICAgICAgICAgICAgcy5pbnNfaCA9IChzLmluc19oIDw8IHMuaGFzaF9zaGlmdCBeIHMud2luZG93W3Muc3Ryc3RhcnQgKyBNSU5fTUFUQ0ggLSAxXSkgJiBzLmhhc2hfbWFzazsKICAgICAgICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHMuc3Ryc3RhcnQ7CiAgICAgICAgICB9IHdoaWxlICgtLXMubWF0Y2hfbGVuZ3RoICE9PSAwKTsKICAgICAgICAgIHMuc3Ryc3RhcnQrKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcy5zdHJzdGFydCArPSBzLm1hdGNoX2xlbmd0aDsKICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gMDsKICAgICAgICAgIHMuaW5zX2ggPSBzLndpbmRvd1tzLnN0cnN0YXJ0XTsKICAgICAgICAgIHMuaW5zX2ggPSAocy5pbnNfaCA8PCBzLmhhc2hfc2hpZnQgXiBzLndpbmRvd1tzLnN0cnN0YXJ0ICsgMV0pICYgcy5oYXNoX21hc2s7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGJmbHVzaCA9IHRyZWVzLl90cl90YWxseShzLCAwLCBzLndpbmRvd1tzLnN0cnN0YXJ0XSk7CiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgIH0KICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcy5pbnNlcnQgPSBzLnN0cnN0YXJ0IDwgTUlOX01BVENIIC0gMSA/IHMuc3Ryc3RhcnQgOiBNSU5fTUFUQ0ggLSAxOwogICAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCQyKSB7CiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgdHJ1ZSk7CiAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgcmV0dXJuIEJTX0ZJTklTSF9TVEFSVEVEOwogICAgICB9CiAgICAgIHJldHVybiBCU19GSU5JU0hfRE9ORTsKICAgIH0KICAgIGlmIChzLmxhc3RfbGl0KSB7CiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBCU19CTE9DS19ET05FOwogIH0KICBmdW5jdGlvbiBkZWZsYXRlX3Nsb3cocywgZmx1c2gpIHsKICAgIHZhciBoYXNoX2hlYWQ7CiAgICB2YXIgYmZsdXNoOwogICAgdmFyIG1heF9pbnNlcnQ7CiAgICBmb3IgKDsgOyApIHsKICAgICAgaWYgKHMubG9va2FoZWFkIDwgTUlOX0xPT0tBSEVBRCkgewogICAgICAgIGZpbGxfd2luZG93KHMpOwogICAgICAgIGlmIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQgJiYgZmx1c2ggPT09IFpfTk9fRkxVU0gkMSkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgICAgaWYgKHMubG9va2FoZWFkID09PSAwKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaGFzaF9oZWFkID0gMDsKICAgICAgaWYgKHMubG9va2FoZWFkID49IE1JTl9NQVRDSCkgewogICAgICAgIHMuaW5zX2ggPSAocy5pbnNfaCA8PCBzLmhhc2hfc2hpZnQgXiBzLndpbmRvd1tzLnN0cnN0YXJ0ICsgTUlOX01BVENIIC0gMV0pICYgcy5oYXNoX21hc2s7CiAgICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gcy5zdHJzdGFydDsKICAgICAgfQogICAgICBzLnByZXZfbGVuZ3RoID0gcy5tYXRjaF9sZW5ndGg7CiAgICAgIHMucHJldl9tYXRjaCA9IHMubWF0Y2hfc3RhcnQ7CiAgICAgIHMubWF0Y2hfbGVuZ3RoID0gTUlOX01BVENIIC0gMTsKICAgICAgaWYgKGhhc2hfaGVhZCAhPT0gMCAmJiBzLnByZXZfbGVuZ3RoIDwgcy5tYXhfbGF6eV9tYXRjaCAmJiBzLnN0cnN0YXJ0IC0gaGFzaF9oZWFkIDw9IHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkgewogICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gbG9uZ2VzdF9tYXRjaChzLCBoYXNoX2hlYWQpOwogICAgICAgIGlmIChzLm1hdGNoX2xlbmd0aCA8PSA1ICYmIChzLnN0cmF0ZWd5ID09PSBaX0ZJTFRFUkVEIHx8IHMubWF0Y2hfbGVuZ3RoID09PSBNSU5fTUFUQ0ggJiYgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQgPiA0MDk2KSkgewogICAgICAgICAgcy5tYXRjaF9sZW5ndGggPSBNSU5fTUFUQ0ggLSAxOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocy5wcmV2X2xlbmd0aCA+PSBNSU5fTUFUQ0ggJiYgcy5tYXRjaF9sZW5ndGggPD0gcy5wcmV2X2xlbmd0aCkgewogICAgICAgIG1heF9pbnNlcnQgPSBzLnN0cnN0YXJ0ICsgcy5sb29rYWhlYWQgLSBNSU5fTUFUQ0g7CiAgICAgICAgYmZsdXNoID0gdHJlZXMuX3RyX3RhbGx5KHMsIHMuc3Ryc3RhcnQgLSAxIC0gcy5wcmV2X21hdGNoLCBzLnByZXZfbGVuZ3RoIC0gTUlOX01BVENIKTsKICAgICAgICBzLmxvb2thaGVhZCAtPSBzLnByZXZfbGVuZ3RoIC0gMTsKICAgICAgICBzLnByZXZfbGVuZ3RoIC09IDI7CiAgICAgICAgZG8gewogICAgICAgICAgaWYgKCsrcy5zdHJzdGFydCA8PSBtYXhfaW5zZXJ0KSB7CiAgICAgICAgICAgIHMuaW5zX2ggPSAocy5pbnNfaCA8PCBzLmhhc2hfc2hpZnQgXiBzLndpbmRvd1tzLnN0cnN0YXJ0ICsgTUlOX01BVENIIC0gMV0pICYgcy5oYXNoX21hc2s7CiAgICAgICAgICAgIGhhc2hfaGVhZCA9IHMucHJldltzLnN0cnN0YXJ0ICYgcy53X21hc2tdID0gcy5oZWFkW3MuaW5zX2hdOwogICAgICAgICAgICBzLmhlYWRbcy5pbnNfaF0gPSBzLnN0cnN0YXJ0OwogICAgICAgICAgfQogICAgICAgIH0gd2hpbGUgKC0tcy5wcmV2X2xlbmd0aCAhPT0gMCk7CiAgICAgICAgcy5tYXRjaF9hdmFpbGFibGUgPSAwOwogICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gTUlOX01BVENIIC0gMTsKICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChzLm1hdGNoX2F2YWlsYWJsZSkgewogICAgICAgIGJmbHVzaCA9IHRyZWVzLl90cl90YWxseShzLCAwLCBzLndpbmRvd1tzLnN0cnN0YXJ0IC0gMV0pOwogICAgICAgIGlmIChiZmx1c2gpIHsKICAgICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgIH0KICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcy5tYXRjaF9hdmFpbGFibGUgPSAxOwogICAgICAgIHMuc3Ryc3RhcnQrKzsKICAgICAgICBzLmxvb2thaGVhZC0tOwogICAgICB9CiAgICB9CiAgICBpZiAocy5tYXRjaF9hdmFpbGFibGUpIHsKICAgICAgYmZsdXNoID0gdHJlZXMuX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnQgLSAxXSk7CiAgICAgIHMubWF0Y2hfYXZhaWxhYmxlID0gMDsKICAgIH0KICAgIHMuaW5zZXJ0ID0gcy5zdHJzdGFydCA8IE1JTl9NQVRDSCAtIDEgPyBzLnN0cnN0YXJ0IDogTUlOX01BVENIIC0gMTsKICAgIGlmIChmbHVzaCA9PT0gWl9GSU5JU0gkMikgewogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIHRydWUpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19GSU5JU0hfU1RBUlRFRDsKICAgICAgfQogICAgICByZXR1cm4gQlNfRklOSVNIX0RPTkU7CiAgICB9CiAgICBpZiAocy5sYXN0X2xpdCkgewogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKICB9CiAgZnVuY3Rpb24gZGVmbGF0ZV9ybGUocywgZmx1c2gpIHsKICAgIHZhciBiZmx1c2g7CiAgICB2YXIgcHJldjsKICAgIHZhciBzY2FuLCBzdHJlbmQ7CiAgICB2YXIgX3dpbiA9IHMud2luZG93OwogICAgZm9yICg7IDsgKSB7CiAgICAgIGlmIChzLmxvb2thaGVhZCA8PSBNQVhfTUFUQ0gpIHsKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPD0gTUFYX01BVENIICYmIGZsdXNoID09PSBaX05PX0ZMVVNIJDEpIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHMubWF0Y2hfbGVuZ3RoID0gMDsKICAgICAgaWYgKHMubG9va2FoZWFkID49IE1JTl9NQVRDSCAmJiBzLnN0cnN0YXJ0ID4gMCkgewogICAgICAgIHNjYW4gPSBzLnN0cnN0YXJ0IC0gMTsKICAgICAgICBwcmV2ID0gX3dpbltzY2FuXTsKICAgICAgICBpZiAocHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHByZXYgPT09IF93aW5bKytzY2FuXSAmJiBwcmV2ID09PSBfd2luWysrc2Nhbl0pIHsKICAgICAgICAgIHN0cmVuZCA9IHMuc3Ryc3RhcnQgKyBNQVhfTUFUQ0g7CiAgICAgICAgICBkbyB7CiAgICAgICAgICB9IHdoaWxlIChwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHByZXYgPT09IF93aW5bKytzY2FuXSAmJiBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHByZXYgPT09IF93aW5bKytzY2FuXSAmJiBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHNjYW4gPCBzdHJlbmQpOwogICAgICAgICAgcy5tYXRjaF9sZW5ndGggPSBNQVhfTUFUQ0ggLSAoc3RyZW5kIC0gc2Nhbik7CiAgICAgICAgICBpZiAocy5tYXRjaF9sZW5ndGggPiBzLmxvb2thaGVhZCkgewogICAgICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IHMubG9va2FoZWFkOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocy5tYXRjaF9sZW5ndGggPj0gTUlOX01BVENIKSB7CiAgICAgICAgYmZsdXNoID0gdHJlZXMuX3RyX3RhbGx5KHMsIDEsIHMubWF0Y2hfbGVuZ3RoIC0gTUlOX01BVENIKTsKICAgICAgICBzLmxvb2thaGVhZCAtPSBzLm1hdGNoX2xlbmd0aDsKICAgICAgICBzLnN0cnN0YXJ0ICs9IHMubWF0Y2hfbGVuZ3RoOwogICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICBiZmx1c2ggPSB0cmVlcy5fdHJfdGFsbHkocywgMCwgcy53aW5kb3dbcy5zdHJzdGFydF0pOwogICAgICAgIHMubG9va2FoZWFkLS07CiAgICAgICAgcy5zdHJzdGFydCsrOwogICAgICB9CiAgICAgIGlmIChiZmx1c2gpIHsKICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHMuaW5zZXJ0ID0gMDsKICAgIGlmIChmbHVzaCA9PT0gWl9GSU5JU0gkMikgewogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIHRydWUpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19GSU5JU0hfU1RBUlRFRDsKICAgICAgfQogICAgICByZXR1cm4gQlNfRklOSVNIX0RPTkU7CiAgICB9CiAgICBpZiAocy5sYXN0X2xpdCkgewogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKICB9CiAgZnVuY3Rpb24gZGVmbGF0ZV9odWZmKHMsIGZsdXNoKSB7CiAgICB2YXIgYmZsdXNoOwogICAgZm9yICg7IDsgKSB7CiAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgIGZpbGxfd2luZG93KHMpOwogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgaWYgKGZsdXNoID09PSBaX05PX0ZMVVNIJDEpIHsKICAgICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBzLm1hdGNoX2xlbmd0aCA9IDA7CiAgICAgIGJmbHVzaCA9IHRyZWVzLl90cl90YWxseShzLCAwLCBzLndpbmRvd1tzLnN0cnN0YXJ0XSk7CiAgICAgIHMubG9va2FoZWFkLS07CiAgICAgIHMuc3Ryc3RhcnQrKzsKICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcy5pbnNlcnQgPSAwOwogICAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCQyKSB7CiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgdHJ1ZSk7CiAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgcmV0dXJuIEJTX0ZJTklTSF9TVEFSVEVEOwogICAgICB9CiAgICAgIHJldHVybiBCU19GSU5JU0hfRE9ORTsKICAgIH0KICAgIGlmIChzLmxhc3RfbGl0KSB7CiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBCU19CTE9DS19ET05FOwogIH0KICBmdW5jdGlvbiBDb25maWcoZ29vZF9sZW5ndGgsIG1heF9sYXp5LCBuaWNlX2xlbmd0aCwgbWF4X2NoYWluLCBmdW5jKSB7CiAgICB0aGlzLmdvb2RfbGVuZ3RoID0gZ29vZF9sZW5ndGg7CiAgICB0aGlzLm1heF9sYXp5ID0gbWF4X2xhenk7CiAgICB0aGlzLm5pY2VfbGVuZ3RoID0gbmljZV9sZW5ndGg7CiAgICB0aGlzLm1heF9jaGFpbiA9IG1heF9jaGFpbjsKICAgIHRoaXMuZnVuYyA9IGZ1bmM7CiAgfQogIHZhciBjb25maWd1cmF0aW9uX3RhYmxlOwogIGNvbmZpZ3VyYXRpb25fdGFibGUgPSBbCiAgICBuZXcgQ29uZmlnKDAsIDAsIDAsIDAsIGRlZmxhdGVfc3RvcmVkKSwKICAgIG5ldyBDb25maWcoNCwgNCwgOCwgNCwgZGVmbGF0ZV9mYXN0KSwKICAgIG5ldyBDb25maWcoNCwgNSwgMTYsIDgsIGRlZmxhdGVfZmFzdCksCiAgICBuZXcgQ29uZmlnKDQsIDYsIDMyLCAzMiwgZGVmbGF0ZV9mYXN0KSwKICAgIG5ldyBDb25maWcoNCwgNCwgMTYsIDE2LCBkZWZsYXRlX3Nsb3cpLAogICAgbmV3IENvbmZpZyg4LCAxNiwgMzIsIDMyLCBkZWZsYXRlX3Nsb3cpLAogICAgbmV3IENvbmZpZyg4LCAxNiwgMTI4LCAxMjgsIGRlZmxhdGVfc2xvdyksCiAgICBuZXcgQ29uZmlnKDgsIDMyLCAxMjgsIDI1NiwgZGVmbGF0ZV9zbG93KSwKICAgIG5ldyBDb25maWcoMzIsIDEyOCwgMjU4LCAxMDI0LCBkZWZsYXRlX3Nsb3cpLAogICAgbmV3IENvbmZpZygzMiwgMjU4LCAyNTgsIDQwOTYsIGRlZmxhdGVfc2xvdykKICBdOwogIGZ1bmN0aW9uIGxtX2luaXQocykgewogICAgcy53aW5kb3dfc2l6ZSA9IDIgKiBzLndfc2l6ZTsKICAgIHplcm8ocy5oZWFkKTsKICAgIHMubWF4X2xhenlfbWF0Y2ggPSBjb25maWd1cmF0aW9uX3RhYmxlW3MubGV2ZWxdLm1heF9sYXp5OwogICAgcy5nb29kX21hdGNoID0gY29uZmlndXJhdGlvbl90YWJsZVtzLmxldmVsXS5nb29kX2xlbmd0aDsKICAgIHMubmljZV9tYXRjaCA9IGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0ubmljZV9sZW5ndGg7CiAgICBzLm1heF9jaGFpbl9sZW5ndGggPSBjb25maWd1cmF0aW9uX3RhYmxlW3MubGV2ZWxdLm1heF9jaGFpbjsKICAgIHMuc3Ryc3RhcnQgPSAwOwogICAgcy5ibG9ja19zdGFydCA9IDA7CiAgICBzLmxvb2thaGVhZCA9IDA7CiAgICBzLmluc2VydCA9IDA7CiAgICBzLm1hdGNoX2xlbmd0aCA9IHMucHJldl9sZW5ndGggPSBNSU5fTUFUQ0ggLSAxOwogICAgcy5tYXRjaF9hdmFpbGFibGUgPSAwOwogICAgcy5pbnNfaCA9IDA7CiAgfQogIGZ1bmN0aW9uIERlZmxhdGVTdGF0ZSgpIHsKICAgIHRoaXMuc3RybSA9IG51bGw7CiAgICB0aGlzLnN0YXR1cyA9IDA7CiAgICB0aGlzLnBlbmRpbmdfYnVmID0gbnVsbDsKICAgIHRoaXMucGVuZGluZ19idWZfc2l6ZSA9IDA7CiAgICB0aGlzLnBlbmRpbmdfb3V0ID0gMDsKICAgIHRoaXMucGVuZGluZyA9IDA7CiAgICB0aGlzLndyYXAgPSAwOwogICAgdGhpcy5nemhlYWQgPSBudWxsOwogICAgdGhpcy5nemluZGV4ID0gMDsKICAgIHRoaXMubWV0aG9kID0gWl9ERUZMQVRFRCQyOwogICAgdGhpcy5sYXN0X2ZsdXNoID0gLTE7CiAgICB0aGlzLndfc2l6ZSA9IDA7CiAgICB0aGlzLndfYml0cyA9IDA7CiAgICB0aGlzLndfbWFzayA9IDA7CiAgICB0aGlzLndpbmRvdyA9IG51bGw7CiAgICB0aGlzLndpbmRvd19zaXplID0gMDsKICAgIHRoaXMucHJldiA9IG51bGw7CiAgICB0aGlzLmhlYWQgPSBudWxsOwogICAgdGhpcy5pbnNfaCA9IDA7CiAgICB0aGlzLmhhc2hfc2l6ZSA9IDA7CiAgICB0aGlzLmhhc2hfYml0cyA9IDA7CiAgICB0aGlzLmhhc2hfbWFzayA9IDA7CiAgICB0aGlzLmhhc2hfc2hpZnQgPSAwOwogICAgdGhpcy5ibG9ja19zdGFydCA9IDA7CiAgICB0aGlzLm1hdGNoX2xlbmd0aCA9IDA7CiAgICB0aGlzLnByZXZfbWF0Y2ggPSAwOwogICAgdGhpcy5tYXRjaF9hdmFpbGFibGUgPSAwOwogICAgdGhpcy5zdHJzdGFydCA9IDA7CiAgICB0aGlzLm1hdGNoX3N0YXJ0ID0gMDsKICAgIHRoaXMubG9va2FoZWFkID0gMDsKICAgIHRoaXMucHJldl9sZW5ndGggPSAwOwogICAgdGhpcy5tYXhfY2hhaW5fbGVuZ3RoID0gMDsKICAgIHRoaXMubWF4X2xhenlfbWF0Y2ggPSAwOwogICAgdGhpcy5sZXZlbCA9IDA7CiAgICB0aGlzLnN0cmF0ZWd5ID0gMDsKICAgIHRoaXMuZ29vZF9tYXRjaCA9IDA7CiAgICB0aGlzLm5pY2VfbWF0Y2ggPSAwOwogICAgdGhpcy5keW5fbHRyZWUgPSBuZXcgdXRpbHMkNS5CdWYxNihIRUFQX1NJWkUgKiAyKTsKICAgIHRoaXMuZHluX2R0cmVlID0gbmV3IHV0aWxzJDUuQnVmMTYoKDIgKiBEX0NPREVTICsgMSkgKiAyKTsKICAgIHRoaXMuYmxfdHJlZSA9IG5ldyB1dGlscyQ1LkJ1ZjE2KCgyICogQkxfQ09ERVMgKyAxKSAqIDIpOwogICAgemVybyh0aGlzLmR5bl9sdHJlZSk7CiAgICB6ZXJvKHRoaXMuZHluX2R0cmVlKTsKICAgIHplcm8odGhpcy5ibF90cmVlKTsKICAgIHRoaXMubF9kZXNjID0gbnVsbDsKICAgIHRoaXMuZF9kZXNjID0gbnVsbDsKICAgIHRoaXMuYmxfZGVzYyA9IG51bGw7CiAgICB0aGlzLmJsX2NvdW50ID0gbmV3IHV0aWxzJDUuQnVmMTYoTUFYX0JJVFMgKyAxKTsKICAgIHRoaXMuaGVhcCA9IG5ldyB1dGlscyQ1LkJ1ZjE2KDIgKiBMX0NPREVTICsgMSk7CiAgICB6ZXJvKHRoaXMuaGVhcCk7CiAgICB0aGlzLmhlYXBfbGVuID0gMDsKICAgIHRoaXMuaGVhcF9tYXggPSAwOwogICAgdGhpcy5kZXB0aCA9IG5ldyB1dGlscyQ1LkJ1ZjE2KDIgKiBMX0NPREVTICsgMSk7CiAgICB6ZXJvKHRoaXMuZGVwdGgpOwogICAgdGhpcy5sX2J1ZiA9IDA7CiAgICB0aGlzLmxpdF9idWZzaXplID0gMDsKICAgIHRoaXMubGFzdF9saXQgPSAwOwogICAgdGhpcy5kX2J1ZiA9IDA7CiAgICB0aGlzLm9wdF9sZW4gPSAwOwogICAgdGhpcy5zdGF0aWNfbGVuID0gMDsKICAgIHRoaXMubWF0Y2hlcyA9IDA7CiAgICB0aGlzLmluc2VydCA9IDA7CiAgICB0aGlzLmJpX2J1ZiA9IDA7CiAgICB0aGlzLmJpX3ZhbGlkID0gMDsKICB9CiAgZnVuY3Rpb24gZGVmbGF0ZVJlc2V0S2VlcChzdHJtKSB7CiAgICB2YXIgczsKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgewogICAgICByZXR1cm4gZXJyKHN0cm0sIFpfU1RSRUFNX0VSUk9SJDEpOwogICAgfQogICAgc3RybS50b3RhbF9pbiA9IHN0cm0udG90YWxfb3V0ID0gMDsKICAgIHN0cm0uZGF0YV90eXBlID0gWl9VTktOT1dOOwogICAgcyA9IHN0cm0uc3RhdGU7CiAgICBzLnBlbmRpbmcgPSAwOwogICAgcy5wZW5kaW5nX291dCA9IDA7CiAgICBpZiAocy53cmFwIDwgMCkgewogICAgICBzLndyYXAgPSAtcy53cmFwOwogICAgfQogICAgcy5zdGF0dXMgPSBzLndyYXAgPyBJTklUX1NUQVRFIDogQlVTWV9TVEFURTsKICAgIHN0cm0uYWRsZXIgPSBzLndyYXAgPT09IDIgPyAwIDogMTsKICAgIHMubGFzdF9mbHVzaCA9IFpfTk9fRkxVU0gkMTsKICAgIHRyZWVzLl90cl9pbml0KHMpOwogICAgcmV0dXJuIFpfT0skMjsKICB9CiAgZnVuY3Rpb24gZGVmbGF0ZVJlc2V0KHN0cm0pIHsKICAgIHZhciByZXQgPSBkZWZsYXRlUmVzZXRLZWVwKHN0cm0pOwogICAgaWYgKHJldCA9PT0gWl9PSyQyKSB7CiAgICAgIGxtX2luaXQoc3RybS5zdGF0ZSk7CiAgICB9CiAgICByZXR1cm4gcmV0OwogIH0KICBmdW5jdGlvbiBkZWZsYXRlU2V0SGVhZGVyKHN0cm0sIGhlYWQpIHsKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsKICAgIH0KICAgIGlmIChzdHJtLnN0YXRlLndyYXAgIT09IDIpIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7CiAgICB9CiAgICBzdHJtLnN0YXRlLmd6aGVhZCA9IGhlYWQ7CiAgICByZXR1cm4gWl9PSyQyOwogIH0KICBmdW5jdGlvbiBkZWZsYXRlSW5pdDIoc3RybSwgbGV2ZWwsIG1ldGhvZCwgd2luZG93Qml0cywgbWVtTGV2ZWwsIHN0cmF0ZWd5KSB7CiAgICBpZiAoIXN0cm0pIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7CiAgICB9CiAgICB2YXIgd3JhcCA9IDE7CiAgICBpZiAobGV2ZWwgPT09IFpfREVGQVVMVF9DT01QUkVTU0lPTiQxKSB7CiAgICAgIGxldmVsID0gNjsKICAgIH0KICAgIGlmICh3aW5kb3dCaXRzIDwgMCkgewogICAgICB3cmFwID0gMDsKICAgICAgd2luZG93Qml0cyA9IC13aW5kb3dCaXRzOwogICAgfSBlbHNlIGlmICh3aW5kb3dCaXRzID4gMTUpIHsKICAgICAgd3JhcCA9IDI7CiAgICAgIHdpbmRvd0JpdHMgLT0gMTY7CiAgICB9CiAgICBpZiAobWVtTGV2ZWwgPCAxIHx8IG1lbUxldmVsID4gTUFYX01FTV9MRVZFTCB8fCBtZXRob2QgIT09IFpfREVGTEFURUQkMiB8fCB3aW5kb3dCaXRzIDwgOCB8fCB3aW5kb3dCaXRzID4gMTUgfHwgbGV2ZWwgPCAwIHx8IGxldmVsID4gOSB8fCBzdHJhdGVneSA8IDAgfHwgc3RyYXRlZ3kgPiBaX0ZJWEVEKSB7CiAgICAgIHJldHVybiBlcnIoc3RybSwgWl9TVFJFQU1fRVJST1IkMSk7CiAgICB9CiAgICBpZiAod2luZG93Qml0cyA9PT0gOCkgewogICAgICB3aW5kb3dCaXRzID0gOTsKICAgIH0KICAgIHZhciBzID0gbmV3IERlZmxhdGVTdGF0ZSgpOwogICAgc3RybS5zdGF0ZSA9IHM7CiAgICBzLnN0cm0gPSBzdHJtOwogICAgcy53cmFwID0gd3JhcDsKICAgIHMuZ3poZWFkID0gbnVsbDsKICAgIHMud19iaXRzID0gd2luZG93Qml0czsKICAgIHMud19zaXplID0gMSA8PCBzLndfYml0czsKICAgIHMud19tYXNrID0gcy53X3NpemUgLSAxOwogICAgcy5oYXNoX2JpdHMgPSBtZW1MZXZlbCArIDc7CiAgICBzLmhhc2hfc2l6ZSA9IDEgPDwgcy5oYXNoX2JpdHM7CiAgICBzLmhhc2hfbWFzayA9IHMuaGFzaF9zaXplIC0gMTsKICAgIHMuaGFzaF9zaGlmdCA9IH5+KChzLmhhc2hfYml0cyArIE1JTl9NQVRDSCAtIDEpIC8gTUlOX01BVENIKTsKICAgIHMud2luZG93ID0gbmV3IHV0aWxzJDUuQnVmOChzLndfc2l6ZSAqIDIpOwogICAgcy5oZWFkID0gbmV3IHV0aWxzJDUuQnVmMTYocy5oYXNoX3NpemUpOwogICAgcy5wcmV2ID0gbmV3IHV0aWxzJDUuQnVmMTYocy53X3NpemUpOwogICAgcy5saXRfYnVmc2l6ZSA9IDEgPDwgbWVtTGV2ZWwgKyA2OwogICAgcy5wZW5kaW5nX2J1Zl9zaXplID0gcy5saXRfYnVmc2l6ZSAqIDQ7CiAgICBzLnBlbmRpbmdfYnVmID0gbmV3IHV0aWxzJDUuQnVmOChzLnBlbmRpbmdfYnVmX3NpemUpOwogICAgcy5kX2J1ZiA9IDEgKiBzLmxpdF9idWZzaXplOwogICAgcy5sX2J1ZiA9ICgxICsgMikgKiBzLmxpdF9idWZzaXplOwogICAgcy5sZXZlbCA9IGxldmVsOwogICAgcy5zdHJhdGVneSA9IHN0cmF0ZWd5OwogICAgcy5tZXRob2QgPSBtZXRob2Q7CiAgICByZXR1cm4gZGVmbGF0ZVJlc2V0KHN0cm0pOwogIH0KICBmdW5jdGlvbiBkZWZsYXRlSW5pdChzdHJtLCBsZXZlbCkgewogICAgcmV0dXJuIGRlZmxhdGVJbml0MihzdHJtLCBsZXZlbCwgWl9ERUZMQVRFRCQyLCBNQVhfV0JJVFMkMSwgREVGX01FTV9MRVZFTCwgWl9ERUZBVUxUX1NUUkFURUdZJDEpOwogIH0KICBmdW5jdGlvbiBkZWZsYXRlJDIoc3RybSwgZmx1c2gpIHsKICAgIHZhciBvbGRfZmx1c2gsIHM7CiAgICB2YXIgYmVnLCB2YWw7CiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUgfHwgZmx1c2ggPiBaX0JMT0NLJDEgfHwgZmx1c2ggPCAwKSB7CiAgICAgIHJldHVybiBzdHJtID8gZXJyKHN0cm0sIFpfU1RSRUFNX0VSUk9SJDEpIDogWl9TVFJFQU1fRVJST1IkMTsKICAgIH0KICAgIHMgPSBzdHJtLnN0YXRlOwogICAgaWYgKCFzdHJtLm91dHB1dCB8fCAhc3RybS5pbnB1dCAmJiBzdHJtLmF2YWlsX2luICE9PSAwIHx8IHMuc3RhdHVzID09PSBGSU5JU0hfU1RBVEUgJiYgZmx1c2ggIT09IFpfRklOSVNIJDIpIHsKICAgICAgcmV0dXJuIGVycihzdHJtLCBzdHJtLmF2YWlsX291dCA9PT0gMCA/IFpfQlVGX0VSUk9SJDEgOiBaX1NUUkVBTV9FUlJPUiQxKTsKICAgIH0KICAgIHMuc3RybSA9IHN0cm07CiAgICBvbGRfZmx1c2ggPSBzLmxhc3RfZmx1c2g7CiAgICBzLmxhc3RfZmx1c2ggPSBmbHVzaDsKICAgIGlmIChzLnN0YXR1cyA9PT0gSU5JVF9TVEFURSkgewogICAgICBpZiAocy53cmFwID09PSAyKSB7CiAgICAgICAgc3RybS5hZGxlciA9IDA7CiAgICAgICAgcHV0X2J5dGUocywgMzEpOwogICAgICAgIHB1dF9ieXRlKHMsIDEzOSk7CiAgICAgICAgcHV0X2J5dGUocywgOCk7CiAgICAgICAgaWYgKCFzLmd6aGVhZCkgewogICAgICAgICAgcHV0X2J5dGUocywgMCk7CiAgICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIDApOwogICAgICAgICAgcHV0X2J5dGUocywgMCk7CiAgICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIHMubGV2ZWwgPT09IDkgPyAyIDogcy5zdHJhdGVneSA+PSBaX0hVRkZNQU5fT05MWSB8fCBzLmxldmVsIDwgMiA/IDQgOiAwKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIE9TX0NPREUpOwogICAgICAgICAgcy5zdGF0dXMgPSBCVVNZX1NUQVRFOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwdXRfYnl0ZShzLCAocy5nemhlYWQudGV4dCA/IDEgOiAwKSArIChzLmd6aGVhZC5oY3JjID8gMiA6IDApICsgKCFzLmd6aGVhZC5leHRyYSA/IDAgOiA0KSArICghcy5nemhlYWQubmFtZSA/IDAgOiA4KSArICghcy5nemhlYWQuY29tbWVudCA/IDAgOiAxNikpOwogICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQudGltZSAmIDI1NSk7CiAgICAgICAgICBwdXRfYnl0ZShzLCBzLmd6aGVhZC50aW1lID4+IDggJiAyNTUpOwogICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQudGltZSA+PiAxNiAmIDI1NSk7CiAgICAgICAgICBwdXRfYnl0ZShzLCBzLmd6aGVhZC50aW1lID4+IDI0ICYgMjU1KTsKICAgICAgICAgIHB1dF9ieXRlKHMsIHMubGV2ZWwgPT09IDkgPyAyIDogcy5zdHJhdGVneSA+PSBaX0hVRkZNQU5fT05MWSB8fCBzLmxldmVsIDwgMiA/IDQgOiAwKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIHMuZ3poZWFkLm9zICYgMjU1KTsKICAgICAgICAgIGlmIChzLmd6aGVhZC5leHRyYSAmJiBzLmd6aGVhZC5leHRyYS5sZW5ndGgpIHsKICAgICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQuZXh0cmEubGVuZ3RoICYgMjU1KTsKICAgICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQuZXh0cmEubGVuZ3RoID4+IDggJiAyNTUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMpIHsKICAgICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyJDEoc3RybS5hZGxlciwgcy5wZW5kaW5nX2J1Ziwgcy5wZW5kaW5nLCAwKTsKICAgICAgICAgIH0KICAgICAgICAgIHMuZ3ppbmRleCA9IDA7CiAgICAgICAgICBzLnN0YXR1cyA9IEVYVFJBX1NUQVRFOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgaGVhZGVyID0gWl9ERUZMQVRFRCQyICsgKHMud19iaXRzIC0gOCA8PCA0KSA8PCA4OwogICAgICAgIHZhciBsZXZlbF9mbGFncyA9IC0xOwogICAgICAgIGlmIChzLnN0cmF0ZWd5ID49IFpfSFVGRk1BTl9PTkxZIHx8IHMubGV2ZWwgPCAyKSB7CiAgICAgICAgICBsZXZlbF9mbGFncyA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChzLmxldmVsIDwgNikgewogICAgICAgICAgbGV2ZWxfZmxhZ3MgPSAxOwogICAgICAgIH0gZWxzZSBpZiAocy5sZXZlbCA9PT0gNikgewogICAgICAgICAgbGV2ZWxfZmxhZ3MgPSAyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsZXZlbF9mbGFncyA9IDM7CiAgICAgICAgfQogICAgICAgIGhlYWRlciB8PSBsZXZlbF9mbGFncyA8PCA2OwogICAgICAgIGlmIChzLnN0cnN0YXJ0ICE9PSAwKSB7CiAgICAgICAgICBoZWFkZXIgfD0gUFJFU0VUX0RJQ1Q7CiAgICAgICAgfQogICAgICAgIGhlYWRlciArPSAzMSAtIGhlYWRlciAlIDMxOwogICAgICAgIHMuc3RhdHVzID0gQlVTWV9TVEFURTsKICAgICAgICBwdXRTaG9ydE1TQihzLCBoZWFkZXIpOwogICAgICAgIGlmIChzLnN0cnN0YXJ0ICE9PSAwKSB7CiAgICAgICAgICBwdXRTaG9ydE1TQihzLCBzdHJtLmFkbGVyID4+PiAxNik7CiAgICAgICAgICBwdXRTaG9ydE1TQihzLCBzdHJtLmFkbGVyICYgNjU1MzUpOwogICAgICAgIH0KICAgICAgICBzdHJtLmFkbGVyID0gMTsKICAgICAgfQogICAgfQogICAgaWYgKHMuc3RhdHVzID09PSBFWFRSQV9TVEFURSkgewogICAgICBpZiAocy5nemhlYWQuZXh0cmEpIHsKICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgd2hpbGUgKHMuZ3ppbmRleCA8IChzLmd6aGVhZC5leHRyYS5sZW5ndGggJiA2NTUzNSkpIHsKICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICBpZiAocy5nemhlYWQuaGNyYyAmJiBzLnBlbmRpbmcgPiBiZWcpIHsKICAgICAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzIkMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgICAgICAgICAgYmVnID0gcy5wZW5kaW5nOwogICAgICAgICAgICBpZiAocy5wZW5kaW5nID09PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQuZXh0cmFbcy5nemluZGV4XSAmIDI1NSk7CiAgICAgICAgICBzLmd6aW5kZXgrKzsKICAgICAgICB9CiAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzIkMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgfQogICAgICAgIGlmIChzLmd6aW5kZXggPT09IHMuZ3poZWFkLmV4dHJhLmxlbmd0aCkgewogICAgICAgICAgcy5nemluZGV4ID0gMDsKICAgICAgICAgIHMuc3RhdHVzID0gTkFNRV9TVEFURTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcy5zdGF0dXMgPSBOQU1FX1NUQVRFOwogICAgICB9CiAgICB9CiAgICBpZiAocy5zdGF0dXMgPT09IE5BTUVfU1RBVEUpIHsKICAgICAgaWYgKHMuZ3poZWFkLm5hbWUpIHsKICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgZG8gewogICAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICAgIGlmIChzLmd6aGVhZC5oY3JjICYmIHMucGVuZGluZyA+IGJlZykgewogICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMiQxKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICAgIHZhbCA9IDE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzLmd6aW5kZXggPCBzLmd6aGVhZC5uYW1lLmxlbmd0aCkgewogICAgICAgICAgICB2YWwgPSBzLmd6aGVhZC5uYW1lLmNoYXJDb2RlQXQocy5nemluZGV4KyspICYgMjU1OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIHB1dF9ieXRlKHMsIHZhbCk7CiAgICAgICAgfSB3aGlsZSAodmFsICE9PSAwKTsKICAgICAgICBpZiAocy5nemhlYWQuaGNyYyAmJiBzLnBlbmRpbmcgPiBiZWcpIHsKICAgICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMiQxKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbCA9PT0gMCkgewogICAgICAgICAgcy5nemluZGV4ID0gMDsKICAgICAgICAgIHMuc3RhdHVzID0gQ09NTUVOVF9TVEFURTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcy5zdGF0dXMgPSBDT01NRU5UX1NUQVRFOwogICAgICB9CiAgICB9CiAgICBpZiAocy5zdGF0dXMgPT09IENPTU1FTlRfU1RBVEUpIHsKICAgICAgaWYgKHMuZ3poZWFkLmNvbW1lbnQpIHsKICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgZG8gewogICAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICAgIGlmIChzLmd6aGVhZC5oY3JjICYmIHMucGVuZGluZyA+IGJlZykgewogICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMiQxKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICAgIHZhbCA9IDE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzLmd6aW5kZXggPCBzLmd6aGVhZC5jb21tZW50Lmxlbmd0aCkgewogICAgICAgICAgICB2YWwgPSBzLmd6aGVhZC5jb21tZW50LmNoYXJDb2RlQXQocy5nemluZGV4KyspICYgMjU1OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIHB1dF9ieXRlKHMsIHZhbCk7CiAgICAgICAgfSB3aGlsZSAodmFsICE9PSAwKTsKICAgICAgICBpZiAocy5nemhlYWQuaGNyYyAmJiBzLnBlbmRpbmcgPiBiZWcpIHsKICAgICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMiQxKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbCA9PT0gMCkgewogICAgICAgICAgcy5zdGF0dXMgPSBIQ1JDX1NUQVRFOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzLnN0YXR1cyA9IEhDUkNfU1RBVEU7CiAgICAgIH0KICAgIH0KICAgIGlmIChzLnN0YXR1cyA9PT0gSENSQ19TVEFURSkgewogICAgICBpZiAocy5nemhlYWQuaGNyYykgewogICAgICAgIGlmIChzLnBlbmRpbmcgKyAyID4gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgIH0KICAgICAgICBpZiAocy5wZW5kaW5nICsgMiA8PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgIHB1dF9ieXRlKHMsIHN0cm0uYWRsZXIgJiAyNTUpOwogICAgICAgICAgcHV0X2J5dGUocywgc3RybS5hZGxlciA+PiA4ICYgMjU1KTsKICAgICAgICAgIHN0cm0uYWRsZXIgPSAwOwogICAgICAgICAgcy5zdGF0dXMgPSBCVVNZX1NUQVRFOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzLnN0YXR1cyA9IEJVU1lfU1RBVEU7CiAgICAgIH0KICAgIH0KICAgIGlmIChzLnBlbmRpbmcgIT09IDApIHsKICAgICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgcy5sYXN0X2ZsdXNoID0gLTE7CiAgICAgICAgcmV0dXJuIFpfT0skMjsKICAgICAgfQogICAgfSBlbHNlIGlmIChzdHJtLmF2YWlsX2luID09PSAwICYmIHJhbmsoZmx1c2gpIDw9IHJhbmsob2xkX2ZsdXNoKSAmJiBmbHVzaCAhPT0gWl9GSU5JU0gkMikgewogICAgICByZXR1cm4gZXJyKHN0cm0sIFpfQlVGX0VSUk9SJDEpOwogICAgfQogICAgaWYgKHMuc3RhdHVzID09PSBGSU5JU0hfU1RBVEUgJiYgc3RybS5hdmFpbF9pbiAhPT0gMCkgewogICAgICByZXR1cm4gZXJyKHN0cm0sIFpfQlVGX0VSUk9SJDEpOwogICAgfQogICAgaWYgKHN0cm0uYXZhaWxfaW4gIT09IDAgfHwgcy5sb29rYWhlYWQgIT09IDAgfHwgZmx1c2ggIT09IFpfTk9fRkxVU0gkMSAmJiBzLnN0YXR1cyAhPT0gRklOSVNIX1NUQVRFKSB7CiAgICAgIHZhciBic3RhdGUgPSBzLnN0cmF0ZWd5ID09PSBaX0hVRkZNQU5fT05MWSA/IGRlZmxhdGVfaHVmZihzLCBmbHVzaCkgOiBzLnN0cmF0ZWd5ID09PSBaX1JMRSA/IGRlZmxhdGVfcmxlKHMsIGZsdXNoKSA6IGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0uZnVuYyhzLCBmbHVzaCk7CiAgICAgIGlmIChic3RhdGUgPT09IEJTX0ZJTklTSF9TVEFSVEVEIHx8IGJzdGF0ZSA9PT0gQlNfRklOSVNIX0RPTkUpIHsKICAgICAgICBzLnN0YXR1cyA9IEZJTklTSF9TVEFURTsKICAgICAgfQogICAgICBpZiAoYnN0YXRlID09PSBCU19ORUVEX01PUkUgfHwgYnN0YXRlID09PSBCU19GSU5JU0hfU1RBUlRFRCkgewogICAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcy5sYXN0X2ZsdXNoID0gLTE7CiAgICAgICAgfQogICAgICAgIHJldHVybiBaX09LJDI7CiAgICAgIH0KICAgICAgaWYgKGJzdGF0ZSA9PT0gQlNfQkxPQ0tfRE9ORSkgewogICAgICAgIGlmIChmbHVzaCA9PT0gWl9QQVJUSUFMX0ZMVVNIKSB7CiAgICAgICAgICB0cmVlcy5fdHJfYWxpZ24ocyk7CiAgICAgICAgfSBlbHNlIGlmIChmbHVzaCAhPT0gWl9CTE9DSyQxKSB7CiAgICAgICAgICB0cmVlcy5fdHJfc3RvcmVkX2Jsb2NrKHMsIDAsIDAsIGZhbHNlKTsKICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9GVUxMX0ZMVVNIKSB7CiAgICAgICAgICAgIHplcm8ocy5oZWFkKTsKICAgICAgICAgICAgaWYgKHMubG9va2FoZWFkID09PSAwKSB7CiAgICAgICAgICAgICAgcy5zdHJzdGFydCA9IDA7CiAgICAgICAgICAgICAgcy5ibG9ja19zdGFydCA9IDA7CiAgICAgICAgICAgICAgcy5pbnNlcnQgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZsdXNoX3BlbmRpbmcoc3RybSk7CiAgICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICBzLmxhc3RfZmx1c2ggPSAtMTsKICAgICAgICAgIHJldHVybiBaX09LJDI7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoZmx1c2ggIT09IFpfRklOSVNIJDIpIHsKICAgICAgcmV0dXJuIFpfT0skMjsKICAgIH0KICAgIGlmIChzLndyYXAgPD0gMCkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRU5EJDI7CiAgICB9CiAgICBpZiAocy53cmFwID09PSAyKSB7CiAgICAgIHB1dF9ieXRlKHMsIHN0cm0uYWRsZXIgJiAyNTUpOwogICAgICBwdXRfYnl0ZShzLCBzdHJtLmFkbGVyID4+IDggJiAyNTUpOwogICAgICBwdXRfYnl0ZShzLCBzdHJtLmFkbGVyID4+IDE2ICYgMjU1KTsKICAgICAgcHV0X2J5dGUocywgc3RybS5hZGxlciA+PiAyNCAmIDI1NSk7CiAgICAgIHB1dF9ieXRlKHMsIHN0cm0udG90YWxfaW4gJiAyNTUpOwogICAgICBwdXRfYnl0ZShzLCBzdHJtLnRvdGFsX2luID4+IDggJiAyNTUpOwogICAgICBwdXRfYnl0ZShzLCBzdHJtLnRvdGFsX2luID4+IDE2ICYgMjU1KTsKICAgICAgcHV0X2J5dGUocywgc3RybS50b3RhbF9pbiA+PiAyNCAmIDI1NSk7CiAgICB9IGVsc2UgewogICAgICBwdXRTaG9ydE1TQihzLCBzdHJtLmFkbGVyID4+PiAxNik7CiAgICAgIHB1dFNob3J0TVNCKHMsIHN0cm0uYWRsZXIgJiA2NTUzNSk7CiAgICB9CiAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgaWYgKHMud3JhcCA+IDApIHsKICAgICAgcy53cmFwID0gLXMud3JhcDsKICAgIH0KICAgIHJldHVybiBzLnBlbmRpbmcgIT09IDAgPyBaX09LJDIgOiBaX1NUUkVBTV9FTkQkMjsKICB9CiAgZnVuY3Rpb24gZGVmbGF0ZUVuZChzdHJtKSB7CiAgICB2YXIgc3RhdHVzOwogICAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlKSB7CiAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOwogICAgfQogICAgc3RhdHVzID0gc3RybS5zdGF0ZS5zdGF0dXM7CiAgICBpZiAoc3RhdHVzICE9PSBJTklUX1NUQVRFICYmIHN0YXR1cyAhPT0gRVhUUkFfU1RBVEUgJiYgc3RhdHVzICE9PSBOQU1FX1NUQVRFICYmIHN0YXR1cyAhPT0gQ09NTUVOVF9TVEFURSAmJiBzdGF0dXMgIT09IEhDUkNfU1RBVEUgJiYgc3RhdHVzICE9PSBCVVNZX1NUQVRFICYmIHN0YXR1cyAhPT0gRklOSVNIX1NUQVRFKSB7CiAgICAgIHJldHVybiBlcnIoc3RybSwgWl9TVFJFQU1fRVJST1IkMSk7CiAgICB9CiAgICBzdHJtLnN0YXRlID0gbnVsbDsKICAgIHJldHVybiBzdGF0dXMgPT09IEJVU1lfU1RBVEUgPyBlcnIoc3RybSwgWl9EQVRBX0VSUk9SJDEpIDogWl9PSyQyOwogIH0KICBmdW5jdGlvbiBkZWZsYXRlU2V0RGljdGlvbmFyeShzdHJtLCBkaWN0aW9uYXJ5KSB7CiAgICB2YXIgZGljdExlbmd0aCA9IGRpY3Rpb25hcnkubGVuZ3RoOwogICAgdmFyIHM7CiAgICB2YXIgc3RyLCBuOwogICAgdmFyIHdyYXA7CiAgICB2YXIgYXZhaWw7CiAgICB2YXIgbmV4dDsKICAgIHZhciBpbnB1dDsKICAgIHZhciB0bXBEaWN0OwogICAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlKSB7CiAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOwogICAgfQogICAgcyA9IHN0cm0uc3RhdGU7CiAgICB3cmFwID0gcy53cmFwOwogICAgaWYgKHdyYXAgPT09IDIgfHwgd3JhcCA9PT0gMSAmJiBzLnN0YXR1cyAhPT0gSU5JVF9TVEFURSB8fCBzLmxvb2thaGVhZCkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsKICAgIH0KICAgIGlmICh3cmFwID09PSAxKSB7CiAgICAgIHN0cm0uYWRsZXIgPSBhZGxlcjMyJDEoc3RybS5hZGxlciwgZGljdGlvbmFyeSwgZGljdExlbmd0aCwgMCk7CiAgICB9CiAgICBzLndyYXAgPSAwOwogICAgaWYgKGRpY3RMZW5ndGggPj0gcy53X3NpemUpIHsKICAgICAgaWYgKHdyYXAgPT09IDApIHsKICAgICAgICB6ZXJvKHMuaGVhZCk7CiAgICAgICAgcy5zdHJzdGFydCA9IDA7CiAgICAgICAgcy5ibG9ja19zdGFydCA9IDA7CiAgICAgICAgcy5pbnNlcnQgPSAwOwogICAgICB9CiAgICAgIHRtcERpY3QgPSBuZXcgdXRpbHMkNS5CdWY4KHMud19zaXplKTsKICAgICAgdXRpbHMkNS5hcnJheVNldCh0bXBEaWN0LCBkaWN0aW9uYXJ5LCBkaWN0TGVuZ3RoIC0gcy53X3NpemUsIHMud19zaXplLCAwKTsKICAgICAgZGljdGlvbmFyeSA9IHRtcERpY3Q7CiAgICAgIGRpY3RMZW5ndGggPSBzLndfc2l6ZTsKICAgIH0KICAgIGF2YWlsID0gc3RybS5hdmFpbF9pbjsKICAgIG5leHQgPSBzdHJtLm5leHRfaW47CiAgICBpbnB1dCA9IHN0cm0uaW5wdXQ7CiAgICBzdHJtLmF2YWlsX2luID0gZGljdExlbmd0aDsKICAgIHN0cm0ubmV4dF9pbiA9IDA7CiAgICBzdHJtLmlucHV0ID0gZGljdGlvbmFyeTsKICAgIGZpbGxfd2luZG93KHMpOwogICAgd2hpbGUgKHMubG9va2FoZWFkID49IE1JTl9NQVRDSCkgewogICAgICBzdHIgPSBzLnN0cnN0YXJ0OwogICAgICBuID0gcy5sb29rYWhlYWQgLSAoTUlOX01BVENIIC0gMSk7CiAgICAgIGRvIHsKICAgICAgICBzLmluc19oID0gKHMuaW5zX2ggPDwgcy5oYXNoX3NoaWZ0IF4gcy53aW5kb3dbc3RyICsgTUlOX01BVENIIC0gMV0pICYgcy5oYXNoX21hc2s7CiAgICAgICAgcy5wcmV2W3N0ciAmIHMud19tYXNrXSA9IHMuaGVhZFtzLmluc19oXTsKICAgICAgICBzLmhlYWRbcy5pbnNfaF0gPSBzdHI7CiAgICAgICAgc3RyKys7CiAgICAgIH0gd2hpbGUgKC0tbik7CiAgICAgIHMuc3Ryc3RhcnQgPSBzdHI7CiAgICAgIHMubG9va2FoZWFkID0gTUlOX01BVENIIC0gMTsKICAgICAgZmlsbF93aW5kb3cocyk7CiAgICB9CiAgICBzLnN0cnN0YXJ0ICs9IHMubG9va2FoZWFkOwogICAgcy5ibG9ja19zdGFydCA9IHMuc3Ryc3RhcnQ7CiAgICBzLmluc2VydCA9IHMubG9va2FoZWFkOwogICAgcy5sb29rYWhlYWQgPSAwOwogICAgcy5tYXRjaF9sZW5ndGggPSBzLnByZXZfbGVuZ3RoID0gTUlOX01BVENIIC0gMTsKICAgIHMubWF0Y2hfYXZhaWxhYmxlID0gMDsKICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICBzdHJtLmlucHV0ID0gaW5wdXQ7CiAgICBzdHJtLmF2YWlsX2luID0gYXZhaWw7CiAgICBzLndyYXAgPSB3cmFwOwogICAgcmV0dXJuIFpfT0skMjsKICB9CiAgZGVmbGF0ZSQzLmRlZmxhdGVJbml0ID0gZGVmbGF0ZUluaXQ7CiAgZGVmbGF0ZSQzLmRlZmxhdGVJbml0MiA9IGRlZmxhdGVJbml0MjsKICBkZWZsYXRlJDMuZGVmbGF0ZVJlc2V0ID0gZGVmbGF0ZVJlc2V0OwogIGRlZmxhdGUkMy5kZWZsYXRlUmVzZXRLZWVwID0gZGVmbGF0ZVJlc2V0S2VlcDsKICBkZWZsYXRlJDMuZGVmbGF0ZVNldEhlYWRlciA9IGRlZmxhdGVTZXRIZWFkZXI7CiAgZGVmbGF0ZSQzLmRlZmxhdGUgPSBkZWZsYXRlJDI7CiAgZGVmbGF0ZSQzLmRlZmxhdGVFbmQgPSBkZWZsYXRlRW5kOwogIGRlZmxhdGUkMy5kZWZsYXRlU2V0RGljdGlvbmFyeSA9IGRlZmxhdGVTZXREaWN0aW9uYXJ5OwogIGRlZmxhdGUkMy5kZWZsYXRlSW5mbyA9ICJwYWtvIGRlZmxhdGUgKGZyb20gTm9kZWNhIHByb2plY3QpIjsKICB2YXIgc3RyaW5ncyQyID0ge307CiAgdmFyIHV0aWxzJDQgPSBjb21tb24kMTsKICB2YXIgU1RSX0FQUExZX09LID0gdHJ1ZTsKICB2YXIgU1RSX0FQUExZX1VJQV9PSyA9IHRydWU7CiAgdHJ5IHsKICAgIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgWzBdKTsKICB9IGNhdGNoIChfXykgewogICAgU1RSX0FQUExZX09LID0gZmFsc2U7CiAgfQogIHRyeSB7CiAgICBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIG5ldyBVaW50OEFycmF5KDEpKTsKICB9IGNhdGNoIChfXykgewogICAgU1RSX0FQUExZX1VJQV9PSyA9IGZhbHNlOwogIH0KICB2YXIgX3V0ZjhsZW4gPSBuZXcgdXRpbHMkNC5CdWY4KDI1Nik7CiAgZm9yICh2YXIgcSA9IDA7IHEgPCAyNTY7IHErKykgewogICAgX3V0ZjhsZW5bcV0gPSBxID49IDI1MiA/IDYgOiBxID49IDI0OCA/IDUgOiBxID49IDI0MCA/IDQgOiBxID49IDIyNCA/IDMgOiBxID49IDE5MiA/IDIgOiAxOwogIH0KICBfdXRmOGxlblsyNTRdID0gX3V0ZjhsZW5bMjU0XSA9IDE7CiAgc3RyaW5ncyQyLnN0cmluZzJidWYgPSBmdW5jdGlvbihzdHIpIHsKICAgIHZhciBidWYsIGMyLCBjMjIsIG1fcG9zLCBpLCBzdHJfbGVuID0gc3RyLmxlbmd0aCwgYnVmX2xlbiA9IDA7CiAgICBmb3IgKG1fcG9zID0gMDsgbV9wb3MgPCBzdHJfbGVuOyBtX3BvcysrKSB7CiAgICAgIGMyID0gc3RyLmNoYXJDb2RlQXQobV9wb3MpOwogICAgICBpZiAoKGMyICYgNjQ1MTIpID09PSA1NTI5NiAmJiBtX3BvcyArIDEgPCBzdHJfbGVuKSB7CiAgICAgICAgYzIyID0gc3RyLmNoYXJDb2RlQXQobV9wb3MgKyAxKTsKICAgICAgICBpZiAoKGMyMiAmIDY0NTEyKSA9PT0gNTYzMjApIHsKICAgICAgICAgIGMyID0gNjU1MzYgKyAoYzIgLSA1NTI5NiA8PCAxMCkgKyAoYzIyIC0gNTYzMjApOwogICAgICAgICAgbV9wb3MrKzsKICAgICAgICB9CiAgICAgIH0KICAgICAgYnVmX2xlbiArPSBjMiA8IDEyOCA/IDEgOiBjMiA8IDIwNDggPyAyIDogYzIgPCA2NTUzNiA/IDMgOiA0OwogICAgfQogICAgYnVmID0gbmV3IHV0aWxzJDQuQnVmOChidWZfbGVuKTsKICAgIGZvciAoaSA9IDAsIG1fcG9zID0gMDsgaSA8IGJ1Zl9sZW47IG1fcG9zKyspIHsKICAgICAgYzIgPSBzdHIuY2hhckNvZGVBdChtX3Bvcyk7CiAgICAgIGlmICgoYzIgJiA2NDUxMikgPT09IDU1Mjk2ICYmIG1fcG9zICsgMSA8IHN0cl9sZW4pIHsKICAgICAgICBjMjIgPSBzdHIuY2hhckNvZGVBdChtX3BvcyArIDEpOwogICAgICAgIGlmICgoYzIyICYgNjQ1MTIpID09PSA1NjMyMCkgewogICAgICAgICAgYzIgPSA2NTUzNiArIChjMiAtIDU1Mjk2IDw8IDEwKSArIChjMjIgLSA1NjMyMCk7CiAgICAgICAgICBtX3BvcysrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoYzIgPCAxMjgpIHsKICAgICAgICBidWZbaSsrXSA9IGMyOwogICAgICB9IGVsc2UgaWYgKGMyIDwgMjA0OCkgewogICAgICAgIGJ1ZltpKytdID0gMTkyIHwgYzIgPj4+IDY7CiAgICAgICAgYnVmW2krK10gPSAxMjggfCBjMiAmIDYzOwogICAgICB9IGVsc2UgaWYgKGMyIDwgNjU1MzYpIHsKICAgICAgICBidWZbaSsrXSA9IDIyNCB8IGMyID4+PiAxMjsKICAgICAgICBidWZbaSsrXSA9IDEyOCB8IGMyID4+PiA2ICYgNjM7CiAgICAgICAgYnVmW2krK10gPSAxMjggfCBjMiAmIDYzOwogICAgICB9IGVsc2UgewogICAgICAgIGJ1ZltpKytdID0gMjQwIHwgYzIgPj4+IDE4OwogICAgICAgIGJ1ZltpKytdID0gMTI4IHwgYzIgPj4+IDEyICYgNjM7CiAgICAgICAgYnVmW2krK10gPSAxMjggfCBjMiA+Pj4gNiAmIDYzOwogICAgICAgIGJ1ZltpKytdID0gMTI4IHwgYzIgJiA2MzsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGJ1ZjsKICB9OwogIGZ1bmN0aW9uIGJ1ZjJiaW5zdHJpbmcoYnVmLCBsZW4pIHsKICAgIGlmIChsZW4gPCA2NTUzNCkgewogICAgICBpZiAoYnVmLnN1YmFycmF5ICYmIFNUUl9BUFBMWV9VSUFfT0sgfHwgIWJ1Zi5zdWJhcnJheSAmJiBTVFJfQVBQTFlfT0spIHsKICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCB1dGlscyQ0LnNocmlua0J1ZihidWYsIGxlbikpOwogICAgICB9CiAgICB9CiAgICB2YXIgcmVzdWx0ID0gIiI7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIHJlc3VsdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ1ZltpXSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICBzdHJpbmdzJDIuYnVmMmJpbnN0cmluZyA9IGZ1bmN0aW9uKGJ1ZikgewogICAgcmV0dXJuIGJ1ZjJiaW5zdHJpbmcoYnVmLCBidWYubGVuZ3RoKTsKICB9OwogIHN0cmluZ3MkMi5iaW5zdHJpbmcyYnVmID0gZnVuY3Rpb24oc3RyKSB7CiAgICB2YXIgYnVmID0gbmV3IHV0aWxzJDQuQnVmOChzdHIubGVuZ3RoKTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBidWYubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgYnVmW2ldID0gc3RyLmNoYXJDb2RlQXQoaSk7CiAgICB9CiAgICByZXR1cm4gYnVmOwogIH07CiAgc3RyaW5ncyQyLmJ1ZjJzdHJpbmcgPSBmdW5jdGlvbihidWYsIG1heCkgewogICAgdmFyIGksIG91dCwgYzIsIGNfbGVuOwogICAgdmFyIGxlbiA9IG1heCB8fCBidWYubGVuZ3RoOwogICAgdmFyIHV0ZjE2YnVmID0gbmV3IEFycmF5KGxlbiAqIDIpOwogICAgZm9yIChvdXQgPSAwLCBpID0gMDsgaSA8IGxlbjsgKSB7CiAgICAgIGMyID0gYnVmW2krK107CiAgICAgIGlmIChjMiA8IDEyOCkgewogICAgICAgIHV0ZjE2YnVmW291dCsrXSA9IGMyOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNfbGVuID0gX3V0ZjhsZW5bYzJdOwogICAgICBpZiAoY19sZW4gPiA0KSB7CiAgICAgICAgdXRmMTZidWZbb3V0KytdID0gNjU1MzM7CiAgICAgICAgaSArPSBjX2xlbiAtIDE7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgYzIgJj0gY19sZW4gPT09IDIgPyAzMSA6IGNfbGVuID09PSAzID8gMTUgOiA3OwogICAgICB3aGlsZSAoY19sZW4gPiAxICYmIGkgPCBsZW4pIHsKICAgICAgICBjMiA9IGMyIDw8IDYgfCBidWZbaSsrXSAmIDYzOwogICAgICAgIGNfbGVuLS07CiAgICAgIH0KICAgICAgaWYgKGNfbGVuID4gMSkgewogICAgICAgIHV0ZjE2YnVmW291dCsrXSA9IDY1NTMzOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChjMiA8IDY1NTM2KSB7CiAgICAgICAgdXRmMTZidWZbb3V0KytdID0gYzI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYzIgLT0gNjU1MzY7CiAgICAgICAgdXRmMTZidWZbb3V0KytdID0gNTUyOTYgfCBjMiA+PiAxMCAmIDEwMjM7CiAgICAgICAgdXRmMTZidWZbb3V0KytdID0gNTYzMjAgfCBjMiAmIDEwMjM7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBidWYyYmluc3RyaW5nKHV0ZjE2YnVmLCBvdXQpOwogIH07CiAgc3RyaW5ncyQyLnV0Zjhib3JkZXIgPSBmdW5jdGlvbihidWYsIG1heCkgewogICAgdmFyIHBvczsKICAgIG1heCA9IG1heCB8fCBidWYubGVuZ3RoOwogICAgaWYgKG1heCA+IGJ1Zi5sZW5ndGgpIHsKICAgICAgbWF4ID0gYnVmLmxlbmd0aDsKICAgIH0KICAgIHBvcyA9IG1heCAtIDE7CiAgICB3aGlsZSAocG9zID49IDAgJiYgKGJ1Zltwb3NdICYgMTkyKSA9PT0gMTI4KSB7CiAgICAgIHBvcy0tOwogICAgfQogICAgaWYgKHBvcyA8IDApIHsKICAgICAgcmV0dXJuIG1heDsKICAgIH0KICAgIGlmIChwb3MgPT09IDApIHsKICAgICAgcmV0dXJuIG1heDsKICAgIH0KICAgIHJldHVybiBwb3MgKyBfdXRmOGxlbltidWZbcG9zXV0gPiBtYXggPyBwb3MgOiBtYXg7CiAgfTsKICBmdW5jdGlvbiBaU3RyZWFtJDIoKSB7CiAgICB0aGlzLmlucHV0ID0gbnVsbDsKICAgIHRoaXMubmV4dF9pbiA9IDA7CiAgICB0aGlzLmF2YWlsX2luID0gMDsKICAgIHRoaXMudG90YWxfaW4gPSAwOwogICAgdGhpcy5vdXRwdXQgPSBudWxsOwogICAgdGhpcy5uZXh0X291dCA9IDA7CiAgICB0aGlzLmF2YWlsX291dCA9IDA7CiAgICB0aGlzLnRvdGFsX291dCA9IDA7CiAgICB0aGlzLm1zZyA9ICIiOwogICAgdGhpcy5zdGF0ZSA9IG51bGw7CiAgICB0aGlzLmRhdGFfdHlwZSA9IDI7CiAgICB0aGlzLmFkbGVyID0gMDsKICB9CiAgdmFyIHpzdHJlYW0gPSBaU3RyZWFtJDI7CiAgdmFyIHpsaWJfZGVmbGF0ZSA9IGRlZmxhdGUkMzsKICB2YXIgdXRpbHMkMyA9IGNvbW1vbiQxOwogIHZhciBzdHJpbmdzJDEgPSBzdHJpbmdzJDI7CiAgdmFyIG1zZyQxID0gbWVzc2FnZXMkMTsKICB2YXIgWlN0cmVhbSQxID0genN0cmVhbTsKICB2YXIgdG9TdHJpbmckMSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CiAgdmFyIFpfTk9fRkxVU0ggPSAwOwogIHZhciBaX0ZJTklTSCQxID0gNDsKICB2YXIgWl9PSyQxID0gMDsKICB2YXIgWl9TVFJFQU1fRU5EJDEgPSAxOwogIHZhciBaX1NZTkNfRkxVU0gkMSA9IDI7CiAgdmFyIFpfREVGQVVMVF9DT01QUkVTU0lPTiA9IC0xOwogIHZhciBaX0RFRkFVTFRfU1RSQVRFR1kgPSAwOwogIHZhciBaX0RFRkxBVEVEJDEgPSA4OwogIGZ1bmN0aW9uIERlZmxhdGUob3B0aW9ucykgewogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIERlZmxhdGUpKQogICAgICByZXR1cm4gbmV3IERlZmxhdGUob3B0aW9ucyk7CiAgICB0aGlzLm9wdGlvbnMgPSB1dGlscyQzLmFzc2lnbih7CiAgICAgIGxldmVsOiBaX0RFRkFVTFRfQ09NUFJFU1NJT04sCiAgICAgIG1ldGhvZDogWl9ERUZMQVRFRCQxLAogICAgICBjaHVua1NpemU6IDE2Mzg0LAogICAgICB3aW5kb3dCaXRzOiAxNSwKICAgICAgbWVtTGV2ZWw6IDgsCiAgICAgIHN0cmF0ZWd5OiBaX0RFRkFVTFRfU1RSQVRFR1ksCiAgICAgIHRvOiAiIgogICAgfSwgb3B0aW9ucyB8fCB7fSk7CiAgICB2YXIgb3B0ID0gdGhpcy5vcHRpb25zOwogICAgaWYgKG9wdC5yYXcgJiYgb3B0LndpbmRvd0JpdHMgPiAwKSB7CiAgICAgIG9wdC53aW5kb3dCaXRzID0gLW9wdC53aW5kb3dCaXRzOwogICAgfSBlbHNlIGlmIChvcHQuZ3ppcCAmJiBvcHQud2luZG93Qml0cyA+IDAgJiYgb3B0LndpbmRvd0JpdHMgPCAxNikgewogICAgICBvcHQud2luZG93Qml0cyArPSAxNjsKICAgIH0KICAgIHRoaXMuZXJyID0gMDsKICAgIHRoaXMubXNnID0gIiI7CiAgICB0aGlzLmVuZGVkID0gZmFsc2U7CiAgICB0aGlzLmNodW5rcyA9IFtdOwogICAgdGhpcy5zdHJtID0gbmV3IFpTdHJlYW0kMSgpOwogICAgdGhpcy5zdHJtLmF2YWlsX291dCA9IDA7CiAgICB2YXIgc3RhdHVzID0gemxpYl9kZWZsYXRlLmRlZmxhdGVJbml0Mih0aGlzLnN0cm0sIG9wdC5sZXZlbCwgb3B0Lm1ldGhvZCwgb3B0LndpbmRvd0JpdHMsIG9wdC5tZW1MZXZlbCwgb3B0LnN0cmF0ZWd5KTsKICAgIGlmIChzdGF0dXMgIT09IFpfT0skMSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IobXNnJDFbc3RhdHVzXSk7CiAgICB9CiAgICBpZiAob3B0LmhlYWRlcikgewogICAgICB6bGliX2RlZmxhdGUuZGVmbGF0ZVNldEhlYWRlcih0aGlzLnN0cm0sIG9wdC5oZWFkZXIpOwogICAgfQogICAgaWYgKG9wdC5kaWN0aW9uYXJ5KSB7CiAgICAgIHZhciBkaWN0OwogICAgICBpZiAodHlwZW9mIG9wdC5kaWN0aW9uYXJ5ID09PSAic3RyaW5nIikgewogICAgICAgIGRpY3QgPSBzdHJpbmdzJDEuc3RyaW5nMmJ1ZihvcHQuZGljdGlvbmFyeSk7CiAgICAgIH0gZWxzZSBpZiAodG9TdHJpbmckMS5jYWxsKG9wdC5kaWN0aW9uYXJ5KSA9PT0gIltvYmplY3QgQXJyYXlCdWZmZXJdIikgewogICAgICAgIGRpY3QgPSBuZXcgVWludDhBcnJheShvcHQuZGljdGlvbmFyeSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGljdCA9IG9wdC5kaWN0aW9uYXJ5OwogICAgICB9CiAgICAgIHN0YXR1cyA9IHpsaWJfZGVmbGF0ZS5kZWZsYXRlU2V0RGljdGlvbmFyeSh0aGlzLnN0cm0sIGRpY3QpOwogICAgICBpZiAoc3RhdHVzICE9PSBaX09LJDEpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnJDFbc3RhdHVzXSk7CiAgICAgIH0KICAgICAgdGhpcy5fZGljdF9zZXQgPSB0cnVlOwogICAgfQogIH0KICBEZWZsYXRlLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24oZGF0YSwgbW9kZSkgewogICAgdmFyIHN0cm0gPSB0aGlzLnN0cm07CiAgICB2YXIgY2h1bmtTaXplID0gdGhpcy5vcHRpb25zLmNodW5rU2l6ZTsKICAgIHZhciBzdGF0dXMsIF9tb2RlOwogICAgaWYgKHRoaXMuZW5kZWQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgX21vZGUgPSBtb2RlID09PSB+fm1vZGUgPyBtb2RlIDogbW9kZSA9PT0gdHJ1ZSA/IFpfRklOSVNIJDEgOiBaX05PX0ZMVVNIOwogICAgaWYgKHR5cGVvZiBkYXRhID09PSAic3RyaW5nIikgewogICAgICBzdHJtLmlucHV0ID0gc3RyaW5ncyQxLnN0cmluZzJidWYoZGF0YSk7CiAgICB9IGVsc2UgaWYgKHRvU3RyaW5nJDEuY2FsbChkYXRhKSA9PT0gIltvYmplY3QgQXJyYXlCdWZmZXJdIikgewogICAgICBzdHJtLmlucHV0ID0gbmV3IFVpbnQ4QXJyYXkoZGF0YSk7CiAgICB9IGVsc2UgewogICAgICBzdHJtLmlucHV0ID0gZGF0YTsKICAgIH0KICAgIHN0cm0ubmV4dF9pbiA9IDA7CiAgICBzdHJtLmF2YWlsX2luID0gc3RybS5pbnB1dC5sZW5ndGg7CiAgICBkbyB7CiAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHN0cm0ub3V0cHV0ID0gbmV3IHV0aWxzJDMuQnVmOChjaHVua1NpemUpOwogICAgICAgIHN0cm0ubmV4dF9vdXQgPSAwOwogICAgICAgIHN0cm0uYXZhaWxfb3V0ID0gY2h1bmtTaXplOwogICAgICB9CiAgICAgIHN0YXR1cyA9IHpsaWJfZGVmbGF0ZS5kZWZsYXRlKHN0cm0sIF9tb2RlKTsKICAgICAgaWYgKHN0YXR1cyAhPT0gWl9TVFJFQU1fRU5EJDEgJiYgc3RhdHVzICE9PSBaX09LJDEpIHsKICAgICAgICB0aGlzLm9uRW5kKHN0YXR1cyk7CiAgICAgICAgdGhpcy5lbmRlZCA9IHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCB8fCBzdHJtLmF2YWlsX2luID09PSAwICYmIChfbW9kZSA9PT0gWl9GSU5JU0gkMSB8fCBfbW9kZSA9PT0gWl9TWU5DX0ZMVVNIJDEpKSB7CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy50byA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIHRoaXMub25EYXRhKHN0cmluZ3MkMS5idWYyYmluc3RyaW5nKHV0aWxzJDMuc2hyaW5rQnVmKHN0cm0ub3V0cHV0LCBzdHJtLm5leHRfb3V0KSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLm9uRGF0YSh1dGlscyQzLnNocmlua0J1ZihzdHJtLm91dHB1dCwgc3RybS5uZXh0X291dCkpOwogICAgICAgIH0KICAgICAgfQogICAgfSB3aGlsZSAoKHN0cm0uYXZhaWxfaW4gPiAwIHx8IHN0cm0uYXZhaWxfb3V0ID09PSAwKSAmJiBzdGF0dXMgIT09IFpfU1RSRUFNX0VORCQxKTsKICAgIGlmIChfbW9kZSA9PT0gWl9GSU5JU0gkMSkgewogICAgICBzdGF0dXMgPSB6bGliX2RlZmxhdGUuZGVmbGF0ZUVuZCh0aGlzLnN0cm0pOwogICAgICB0aGlzLm9uRW5kKHN0YXR1cyk7CiAgICAgIHRoaXMuZW5kZWQgPSB0cnVlOwogICAgICByZXR1cm4gc3RhdHVzID09PSBaX09LJDE7CiAgICB9CiAgICBpZiAoX21vZGUgPT09IFpfU1lOQ19GTFVTSCQxKSB7CiAgICAgIHRoaXMub25FbmQoWl9PSyQxKTsKICAgICAgc3RybS5hdmFpbF9vdXQgPSAwOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH07CiAgRGVmbGF0ZS5wcm90b3R5cGUub25EYXRhID0gZnVuY3Rpb24oY2h1bmspIHsKICAgIHRoaXMuY2h1bmtzLnB1c2goY2h1bmspOwogIH07CiAgRGVmbGF0ZS5wcm90b3R5cGUub25FbmQgPSBmdW5jdGlvbihzdGF0dXMpIHsKICAgIGlmIChzdGF0dXMgPT09IFpfT0skMSkgewogICAgICBpZiAodGhpcy5vcHRpb25zLnRvID09PSAic3RyaW5nIikgewogICAgICAgIHRoaXMucmVzdWx0ID0gdGhpcy5jaHVua3Muam9pbigiIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSB1dGlscyQzLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpOwogICAgICB9CiAgICB9CiAgICB0aGlzLmNodW5rcyA9IFtdOwogICAgdGhpcy5lcnIgPSBzdGF0dXM7CiAgICB0aGlzLm1zZyA9IHRoaXMuc3RybS5tc2c7CiAgfTsKICBmdW5jdGlvbiBkZWZsYXRlJDEoaW5wdXQsIG9wdGlvbnMpIHsKICAgIHZhciBkZWZsYXRvciA9IG5ldyBEZWZsYXRlKG9wdGlvbnMpOwogICAgZGVmbGF0b3IucHVzaChpbnB1dCwgdHJ1ZSk7CiAgICBpZiAoZGVmbGF0b3IuZXJyKSB7CiAgICAgIHRocm93IGRlZmxhdG9yLm1zZyB8fCBtc2ckMVtkZWZsYXRvci5lcnJdOwogICAgfQogICAgcmV0dXJuIGRlZmxhdG9yLnJlc3VsdDsKICB9CiAgZnVuY3Rpb24gZGVmbGF0ZVJhdyhpbnB1dCwgb3B0aW9ucykgewogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICBvcHRpb25zLnJhdyA9IHRydWU7CiAgICByZXR1cm4gZGVmbGF0ZSQxKGlucHV0LCBvcHRpb25zKTsKICB9CiAgZnVuY3Rpb24gZ3ppcChpbnB1dCwgb3B0aW9ucykgewogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICBvcHRpb25zLmd6aXAgPSB0cnVlOwogICAgcmV0dXJuIGRlZmxhdGUkMShpbnB1dCwgb3B0aW9ucyk7CiAgfQogIGRlZmxhdGUkNC5EZWZsYXRlID0gRGVmbGF0ZTsKICBkZWZsYXRlJDQuZGVmbGF0ZSA9IGRlZmxhdGUkMTsKICBkZWZsYXRlJDQuZGVmbGF0ZVJhdyA9IGRlZmxhdGVSYXc7CiAgZGVmbGF0ZSQ0Lmd6aXAgPSBnemlwOwogIHZhciBpbmZsYXRlJDQgPSB7fTsKICB2YXIgaW5mbGF0ZSQzID0ge307CiAgdmFyIEJBRCQxID0gMzA7CiAgdmFyIFRZUEUkMSA9IDEyOwogIHZhciBpbmZmYXN0ID0gZnVuY3Rpb24gaW5mbGF0ZV9mYXN0MihzdHJtLCBzdGFydCkgewogICAgdmFyIHN0YXRlOwogICAgdmFyIF9pbjsKICAgIHZhciBsYXN0OwogICAgdmFyIF9vdXQ7CiAgICB2YXIgYmVnOwogICAgdmFyIGVuZDsKICAgIHZhciBkbWF4OwogICAgdmFyIHdzaXplOwogICAgdmFyIHdoYXZlOwogICAgdmFyIHduZXh0OwogICAgdmFyIHNfd2luZG93OwogICAgdmFyIGhvbGQ7CiAgICB2YXIgYml0czsKICAgIHZhciBsY29kZTsKICAgIHZhciBkY29kZTsKICAgIHZhciBsbWFzazsKICAgIHZhciBkbWFzazsKICAgIHZhciBoZXJlOwogICAgdmFyIG9wOwogICAgdmFyIGxlbjsKICAgIHZhciBkaXN0MjsKICAgIHZhciBmcm9tOwogICAgdmFyIGZyb21fc291cmNlOwogICAgdmFyIGlucHV0LCBvdXRwdXQ7CiAgICBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgICBfaW4gPSBzdHJtLm5leHRfaW47CiAgICBpbnB1dCA9IHN0cm0uaW5wdXQ7CiAgICBsYXN0ID0gX2luICsgKHN0cm0uYXZhaWxfaW4gLSA1KTsKICAgIF9vdXQgPSBzdHJtLm5leHRfb3V0OwogICAgb3V0cHV0ID0gc3RybS5vdXRwdXQ7CiAgICBiZWcgPSBfb3V0IC0gKHN0YXJ0IC0gc3RybS5hdmFpbF9vdXQpOwogICAgZW5kID0gX291dCArIChzdHJtLmF2YWlsX291dCAtIDI1Nyk7CiAgICBkbWF4ID0gc3RhdGUuZG1heDsKICAgIHdzaXplID0gc3RhdGUud3NpemU7CiAgICB3aGF2ZSA9IHN0YXRlLndoYXZlOwogICAgd25leHQgPSBzdGF0ZS53bmV4dDsKICAgIHNfd2luZG93ID0gc3RhdGUud2luZG93OwogICAgaG9sZCA9IHN0YXRlLmhvbGQ7CiAgICBiaXRzID0gc3RhdGUuYml0czsKICAgIGxjb2RlID0gc3RhdGUubGVuY29kZTsKICAgIGRjb2RlID0gc3RhdGUuZGlzdGNvZGU7CiAgICBsbWFzayA9ICgxIDw8IHN0YXRlLmxlbmJpdHMpIC0gMTsKICAgIGRtYXNrID0gKDEgPDwgc3RhdGUuZGlzdGJpdHMpIC0gMTsKICAgIHRvcDoKICAgICAgZG8gewogICAgICAgIGlmIChiaXRzIDwgMTUpIHsKICAgICAgICAgIGhvbGQgKz0gaW5wdXRbX2luKytdIDw8IGJpdHM7CiAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICBob2xkICs9IGlucHV0W19pbisrXSA8PCBiaXRzOwogICAgICAgICAgYml0cyArPSA4OwogICAgICAgIH0KICAgICAgICBoZXJlID0gbGNvZGVbaG9sZCAmIGxtYXNrXTsKICAgICAgICBkb2xlbjoKICAgICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgICBvcCA9IGhlcmUgPj4+IDI0OwogICAgICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgICAgIGJpdHMgLT0gb3A7CiAgICAgICAgICAgIG9wID0gaGVyZSA+Pj4gMTYgJiAyNTU7CiAgICAgICAgICAgIGlmIChvcCA9PT0gMCkgewogICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gaGVyZSAmIDY1NTM1OwogICAgICAgICAgICB9IGVsc2UgaWYgKG9wICYgMTYpIHsKICAgICAgICAgICAgICBsZW4gPSBoZXJlICYgNjU1MzU7CiAgICAgICAgICAgICAgb3AgJj0gMTU7CiAgICAgICAgICAgICAgaWYgKG9wKSB7CiAgICAgICAgICAgICAgICBpZiAoYml0cyA8IG9wKSB7CiAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbX2luKytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxlbiArPSBob2xkICYgKDEgPDwgb3ApIC0gMTsKICAgICAgICAgICAgICAgIGhvbGQgPj4+PSBvcDsKICAgICAgICAgICAgICAgIGJpdHMgLT0gb3A7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChiaXRzIDwgMTUpIHsKICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbX2luKytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W19pbisrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBoZXJlID0gZGNvZGVbaG9sZCAmIGRtYXNrXTsKICAgICAgICAgICAgICBkb2Rpc3Q6CiAgICAgICAgICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgICAgICAgICAgb3AgPSBoZXJlID4+PiAyNDsKICAgICAgICAgICAgICAgICAgaG9sZCA+Pj49IG9wOwogICAgICAgICAgICAgICAgICBiaXRzIC09IG9wOwogICAgICAgICAgICAgICAgICBvcCA9IGhlcmUgPj4+IDE2ICYgMjU1OwogICAgICAgICAgICAgICAgICBpZiAob3AgJiAxNikgewogICAgICAgICAgICAgICAgICAgIGRpc3QyID0gaGVyZSAmIDY1NTM1OwogICAgICAgICAgICAgICAgICAgIG9wICY9IDE1OwogICAgICAgICAgICAgICAgICAgIGlmIChiaXRzIDwgb3ApIHsKICAgICAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbX2luKytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoYml0cyA8IG9wKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbX2luKytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZGlzdDIgKz0gaG9sZCAmICgxIDw8IG9wKSAtIDE7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3QyID4gZG1heCkgewogICAgICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siOwogICAgICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRCQxOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWsgdG9wOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgICAgICAgICAgICAgYml0cyAtPSBvcDsKICAgICAgICAgICAgICAgICAgICBvcCA9IF9vdXQgLSBiZWc7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3QyID4gb3ApIHsKICAgICAgICAgICAgICAgICAgICAgIG9wID0gZGlzdDIgLSBvcDsKICAgICAgICAgICAgICAgICAgICAgIGlmIChvcCA+IHdoYXZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5zYW5lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siOwogICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQkMTsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhayB0b3A7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGZyb20gPSAwOwogICAgICAgICAgICAgICAgICAgICAgZnJvbV9zb3VyY2UgPSBzX3dpbmRvdzsKICAgICAgICAgICAgICAgICAgICAgIGlmICh3bmV4dCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBmcm9tICs9IHdzaXplIC0gb3A7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcCA8IGxlbikgewogICAgICAgICAgICAgICAgICAgICAgICAgIGxlbiAtPSBvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IHNfd2luZG93W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1vcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSA9IF9vdXQgLSBkaXN0MjsKICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tX3NvdXJjZSA9IG91dHB1dDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3bmV4dCA8IG9wKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gKz0gd3NpemUgKyB3bmV4dCAtIG9wOwogICAgICAgICAgICAgICAgICAgICAgICBvcCAtPSB3bmV4dDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wIDwgbGVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuIC09IG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gc193aW5kb3dbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlICgtLW9wKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod25leHQgPCBsZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wID0gd25leHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW4gLT0gb3A7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gc193aW5kb3dbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKC0tb3ApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSA9IF9vdXQgLSBkaXN0MjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb21fc291cmNlID0gb3V0cHV0OwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSArPSB3bmV4dCAtIG9wOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAob3AgPCBsZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBsZW4gLT0gb3A7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBzX3dpbmRvd1tmcm9tKytdOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKC0tb3ApOwogICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gPSBfb3V0IC0gZGlzdDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbV9zb3VyY2UgPSBvdXRwdXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChsZW4gPiAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBmcm9tX3NvdXJjZVtmcm9tKytdOwogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGZyb21fc291cmNlW2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgICAgIGxlbiAtPSAzOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgaWYgKGxlbikgewogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGZyb21fc291cmNlW2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsZW4gPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBmcm9tX3NvdXJjZVtmcm9tKytdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGZyb20gPSBfb3V0IC0gZGlzdDI7CiAgICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gb3V0cHV0W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gb3V0cHV0W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gb3V0cHV0W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgICAgIGxlbiAtPSAzOwogICAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAobGVuID4gMik7CiAgICAgICAgICAgICAgICAgICAgICBpZiAobGVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gb3V0cHV0W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsZW4gPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgob3AgJiA2NCkgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBoZXJlID0gZGNvZGVbKGhlcmUgJiA2NTUzNSkgKyAoaG9sZCAmICgxIDw8IG9wKSAtIDEpXTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBkb2Rpc3Q7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSBjb2RlIjsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEJDE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgdG9wOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKChvcCAmIDY0KSA9PT0gMCkgewogICAgICAgICAgICAgIGhlcmUgPSBsY29kZVsoaGVyZSAmIDY1NTM1KSArIChob2xkICYgKDEgPDwgb3ApIC0gMSldOwogICAgICAgICAgICAgIGNvbnRpbnVlIGRvbGVuOwogICAgICAgICAgICB9IGVsc2UgaWYgKG9wICYgMzIpIHsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gVFlQRSQxOwogICAgICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbnZhbGlkIGxpdGVyYWwvbGVuZ3RoIGNvZGUiOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQkMTsKICAgICAgICAgICAgICBicmVhayB0b3A7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgIH0gd2hpbGUgKF9pbiA8IGxhc3QgJiYgX291dCA8IGVuZCk7CiAgICBsZW4gPSBiaXRzID4+IDM7CiAgICBfaW4gLT0gbGVuOwogICAgYml0cyAtPSBsZW4gPDwgMzsKICAgIGhvbGQgJj0gKDEgPDwgYml0cykgLSAxOwogICAgc3RybS5uZXh0X2luID0gX2luOwogICAgc3RybS5uZXh0X291dCA9IF9vdXQ7CiAgICBzdHJtLmF2YWlsX2luID0gX2luIDwgbGFzdCA/IDUgKyAobGFzdCAtIF9pbikgOiA1IC0gKF9pbiAtIGxhc3QpOwogICAgc3RybS5hdmFpbF9vdXQgPSBfb3V0IDwgZW5kID8gMjU3ICsgKGVuZCAtIF9vdXQpIDogMjU3IC0gKF9vdXQgLSBlbmQpOwogICAgc3RhdGUuaG9sZCA9IGhvbGQ7CiAgICBzdGF0ZS5iaXRzID0gYml0czsKICAgIHJldHVybjsKICB9OwogIHZhciB1dGlscyQyID0gY29tbW9uJDE7CiAgdmFyIE1BWEJJVFMgPSAxNTsKICB2YXIgRU5PVUdIX0xFTlMkMSA9IDg1MjsKICB2YXIgRU5PVUdIX0RJU1RTJDEgPSA1OTI7CiAgdmFyIENPREVTJDEgPSAwOwogIHZhciBMRU5TJDEgPSAxOwogIHZhciBESVNUUyQxID0gMjsKICB2YXIgbGJhc2UgPSBbCiAgICAzLAogICAgNCwKICAgIDUsCiAgICA2LAogICAgNywKICAgIDgsCiAgICA5LAogICAgMTAsCiAgICAxMSwKICAgIDEzLAogICAgMTUsCiAgICAxNywKICAgIDE5LAogICAgMjMsCiAgICAyNywKICAgIDMxLAogICAgMzUsCiAgICA0MywKICAgIDUxLAogICAgNTksCiAgICA2NywKICAgIDgzLAogICAgOTksCiAgICAxMTUsCiAgICAxMzEsCiAgICAxNjMsCiAgICAxOTUsCiAgICAyMjcsCiAgICAyNTgsCiAgICAwLAogICAgMAogIF07CiAgdmFyIGxleHQgPSBbCiAgICAxNiwKICAgIDE2LAogICAgMTYsCiAgICAxNiwKICAgIDE2LAogICAgMTYsCiAgICAxNiwKICAgIDE2LAogICAgMTcsCiAgICAxNywKICAgIDE3LAogICAgMTcsCiAgICAxOCwKICAgIDE4LAogICAgMTgsCiAgICAxOCwKICAgIDE5LAogICAgMTksCiAgICAxOSwKICAgIDE5LAogICAgMjAsCiAgICAyMCwKICAgIDIwLAogICAgMjAsCiAgICAyMSwKICAgIDIxLAogICAgMjEsCiAgICAyMSwKICAgIDE2LAogICAgNzIsCiAgICA3OAogIF07CiAgdmFyIGRiYXNlID0gWwogICAgMSwKICAgIDIsCiAgICAzLAogICAgNCwKICAgIDUsCiAgICA3LAogICAgOSwKICAgIDEzLAogICAgMTcsCiAgICAyNSwKICAgIDMzLAogICAgNDksCiAgICA2NSwKICAgIDk3LAogICAgMTI5LAogICAgMTkzLAogICAgMjU3LAogICAgMzg1LAogICAgNTEzLAogICAgNzY5LAogICAgMTAyNSwKICAgIDE1MzcsCiAgICAyMDQ5LAogICAgMzA3MywKICAgIDQwOTcsCiAgICA2MTQ1LAogICAgODE5MywKICAgIDEyMjg5LAogICAgMTYzODUsCiAgICAyNDU3NywKICAgIDAsCiAgICAwCiAgXTsKICB2YXIgZGV4dCA9IFsKICAgIDE2LAogICAgMTYsCiAgICAxNiwKICAgIDE2LAogICAgMTcsCiAgICAxNywKICAgIDE4LAogICAgMTgsCiAgICAxOSwKICAgIDE5LAogICAgMjAsCiAgICAyMCwKICAgIDIxLAogICAgMjEsCiAgICAyMiwKICAgIDIyLAogICAgMjMsCiAgICAyMywKICAgIDI0LAogICAgMjQsCiAgICAyNSwKICAgIDI1LAogICAgMjYsCiAgICAyNiwKICAgIDI3LAogICAgMjcsCiAgICAyOCwKICAgIDI4LAogICAgMjksCiAgICAyOSwKICAgIDY0LAogICAgNjQKICBdOwogIHZhciBpbmZ0cmVlcyA9IGZ1bmN0aW9uIGluZmxhdGVfdGFibGUyKHR5cGUsIGxlbnMsIGxlbnNfaW5kZXgsIGNvZGVzLCB0YWJsZSwgdGFibGVfaW5kZXgsIHdvcmssIG9wdHMpIHsKICAgIHZhciBiaXRzID0gb3B0cy5iaXRzOwogICAgdmFyIGxlbiA9IDA7CiAgICB2YXIgc3ltID0gMDsKICAgIHZhciBtaW4gPSAwLCBtYXggPSAwOwogICAgdmFyIHJvb3QyID0gMDsKICAgIHZhciBjdXJyID0gMDsKICAgIHZhciBkcm9wID0gMDsKICAgIHZhciBsZWZ0ID0gMDsKICAgIHZhciB1c2VkID0gMDsKICAgIHZhciBodWZmID0gMDsKICAgIHZhciBpbmNyOwogICAgdmFyIGZpbGw7CiAgICB2YXIgbG93OwogICAgdmFyIG1hc2s7CiAgICB2YXIgbmV4dDsKICAgIHZhciBiYXNlID0gbnVsbDsKICAgIHZhciBiYXNlX2luZGV4ID0gMDsKICAgIHZhciBlbmQ7CiAgICB2YXIgY291bnQgPSBuZXcgdXRpbHMkMi5CdWYxNihNQVhCSVRTICsgMSk7CiAgICB2YXIgb2ZmcyA9IG5ldyB1dGlscyQyLkJ1ZjE2KE1BWEJJVFMgKyAxKTsKICAgIHZhciBleHRyYSA9IG51bGw7CiAgICB2YXIgZXh0cmFfaW5kZXggPSAwOwogICAgdmFyIGhlcmVfYml0cywgaGVyZV9vcCwgaGVyZV92YWw7CiAgICBmb3IgKGxlbiA9IDA7IGxlbiA8PSBNQVhCSVRTOyBsZW4rKykgewogICAgICBjb3VudFtsZW5dID0gMDsKICAgIH0KICAgIGZvciAoc3ltID0gMDsgc3ltIDwgY29kZXM7IHN5bSsrKSB7CiAgICAgIGNvdW50W2xlbnNbbGVuc19pbmRleCArIHN5bV1dKys7CiAgICB9CiAgICByb290MiA9IGJpdHM7CiAgICBmb3IgKG1heCA9IE1BWEJJVFM7IG1heCA+PSAxOyBtYXgtLSkgewogICAgICBpZiAoY291bnRbbWF4XSAhPT0gMCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBpZiAocm9vdDIgPiBtYXgpIHsKICAgICAgcm9vdDIgPSBtYXg7CiAgICB9CiAgICBpZiAobWF4ID09PSAwKSB7CiAgICAgIHRhYmxlW3RhYmxlX2luZGV4KytdID0gMSA8PCAyNCB8IDY0IDw8IDE2IHwgMDsKICAgICAgdGFibGVbdGFibGVfaW5kZXgrK10gPSAxIDw8IDI0IHwgNjQgPDwgMTYgfCAwOwogICAgICBvcHRzLmJpdHMgPSAxOwogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGZvciAobWluID0gMTsgbWluIDwgbWF4OyBtaW4rKykgewogICAgICBpZiAoY291bnRbbWluXSAhPT0gMCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBpZiAocm9vdDIgPCBtaW4pIHsKICAgICAgcm9vdDIgPSBtaW47CiAgICB9CiAgICBsZWZ0ID0gMTsKICAgIGZvciAobGVuID0gMTsgbGVuIDw9IE1BWEJJVFM7IGxlbisrKSB7CiAgICAgIGxlZnQgPDw9IDE7CiAgICAgIGxlZnQgLT0gY291bnRbbGVuXTsKICAgICAgaWYgKGxlZnQgPCAwKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgICB9CiAgICBpZiAobGVmdCA+IDAgJiYgKHR5cGUgPT09IENPREVTJDEgfHwgbWF4ICE9PSAxKSkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICBvZmZzWzFdID0gMDsKICAgIGZvciAobGVuID0gMTsgbGVuIDwgTUFYQklUUzsgbGVuKyspIHsKICAgICAgb2Zmc1tsZW4gKyAxXSA9IG9mZnNbbGVuXSArIGNvdW50W2xlbl07CiAgICB9CiAgICBmb3IgKHN5bSA9IDA7IHN5bSA8IGNvZGVzOyBzeW0rKykgewogICAgICBpZiAobGVuc1tsZW5zX2luZGV4ICsgc3ltXSAhPT0gMCkgewogICAgICAgIHdvcmtbb2Zmc1tsZW5zW2xlbnNfaW5kZXggKyBzeW1dXSsrXSA9IHN5bTsKICAgICAgfQogICAgfQogICAgaWYgKHR5cGUgPT09IENPREVTJDEpIHsKICAgICAgYmFzZSA9IGV4dHJhID0gd29yazsKICAgICAgZW5kID0gMTk7CiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IExFTlMkMSkgewogICAgICBiYXNlID0gbGJhc2U7CiAgICAgIGJhc2VfaW5kZXggLT0gMjU3OwogICAgICBleHRyYSA9IGxleHQ7CiAgICAgIGV4dHJhX2luZGV4IC09IDI1NzsKICAgICAgZW5kID0gMjU2OwogICAgfSBlbHNlIHsKICAgICAgYmFzZSA9IGRiYXNlOwogICAgICBleHRyYSA9IGRleHQ7CiAgICAgIGVuZCA9IC0xOwogICAgfQogICAgaHVmZiA9IDA7CiAgICBzeW0gPSAwOwogICAgbGVuID0gbWluOwogICAgbmV4dCA9IHRhYmxlX2luZGV4OwogICAgY3VyciA9IHJvb3QyOwogICAgZHJvcCA9IDA7CiAgICBsb3cgPSAtMTsKICAgIHVzZWQgPSAxIDw8IHJvb3QyOwogICAgbWFzayA9IHVzZWQgLSAxOwogICAgaWYgKHR5cGUgPT09IExFTlMkMSAmJiB1c2VkID4gRU5PVUdIX0xFTlMkMSB8fCB0eXBlID09PSBESVNUUyQxICYmIHVzZWQgPiBFTk9VR0hfRElTVFMkMSkgewogICAgICByZXR1cm4gMTsKICAgIH0KICAgIGZvciAoOyA7ICkgewogICAgICBoZXJlX2JpdHMgPSBsZW4gLSBkcm9wOwogICAgICBpZiAod29ya1tzeW1dIDwgZW5kKSB7CiAgICAgICAgaGVyZV9vcCA9IDA7CiAgICAgICAgaGVyZV92YWwgPSB3b3JrW3N5bV07CiAgICAgIH0gZWxzZSBpZiAod29ya1tzeW1dID4gZW5kKSB7CiAgICAgICAgaGVyZV9vcCA9IGV4dHJhW2V4dHJhX2luZGV4ICsgd29ya1tzeW1dXTsKICAgICAgICBoZXJlX3ZhbCA9IGJhc2VbYmFzZV9pbmRleCArIHdvcmtbc3ltXV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaGVyZV9vcCA9IDMyICsgNjQ7CiAgICAgICAgaGVyZV92YWwgPSAwOwogICAgICB9CiAgICAgIGluY3IgPSAxIDw8IGxlbiAtIGRyb3A7CiAgICAgIGZpbGwgPSAxIDw8IGN1cnI7CiAgICAgIG1pbiA9IGZpbGw7CiAgICAgIGRvIHsKICAgICAgICBmaWxsIC09IGluY3I7CiAgICAgICAgdGFibGVbbmV4dCArIChodWZmID4+IGRyb3ApICsgZmlsbF0gPSBoZXJlX2JpdHMgPDwgMjQgfCBoZXJlX29wIDw8IDE2IHwgaGVyZV92YWwgfCAwOwogICAgICB9IHdoaWxlIChmaWxsICE9PSAwKTsKICAgICAgaW5jciA9IDEgPDwgbGVuIC0gMTsKICAgICAgd2hpbGUgKGh1ZmYgJiBpbmNyKSB7CiAgICAgICAgaW5jciA+Pj0gMTsKICAgICAgfQogICAgICBpZiAoaW5jciAhPT0gMCkgewogICAgICAgIGh1ZmYgJj0gaW5jciAtIDE7CiAgICAgICAgaHVmZiArPSBpbmNyOwogICAgICB9IGVsc2UgewogICAgICAgIGh1ZmYgPSAwOwogICAgICB9CiAgICAgIHN5bSsrOwogICAgICBpZiAoLS1jb3VudFtsZW5dID09PSAwKSB7CiAgICAgICAgaWYgKGxlbiA9PT0gbWF4KSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgbGVuID0gbGVuc1tsZW5zX2luZGV4ICsgd29ya1tzeW1dXTsKICAgICAgfQogICAgICBpZiAobGVuID4gcm9vdDIgJiYgKGh1ZmYgJiBtYXNrKSAhPT0gbG93KSB7CiAgICAgICAgaWYgKGRyb3AgPT09IDApIHsKICAgICAgICAgIGRyb3AgPSByb290MjsKICAgICAgICB9CiAgICAgICAgbmV4dCArPSBtaW47CiAgICAgICAgY3VyciA9IGxlbiAtIGRyb3A7CiAgICAgICAgbGVmdCA9IDEgPDwgY3VycjsKICAgICAgICB3aGlsZSAoY3VyciArIGRyb3AgPCBtYXgpIHsKICAgICAgICAgIGxlZnQgLT0gY291bnRbY3VyciArIGRyb3BdOwogICAgICAgICAgaWYgKGxlZnQgPD0gMCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGN1cnIrKzsKICAgICAgICAgIGxlZnQgPDw9IDE7CiAgICAgICAgfQogICAgICAgIHVzZWQgKz0gMSA8PCBjdXJyOwogICAgICAgIGlmICh0eXBlID09PSBMRU5TJDEgJiYgdXNlZCA+IEVOT1VHSF9MRU5TJDEgfHwgdHlwZSA9PT0gRElTVFMkMSAmJiB1c2VkID4gRU5PVUdIX0RJU1RTJDEpIHsKICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KICAgICAgICBsb3cgPSBodWZmICYgbWFzazsKICAgICAgICB0YWJsZVtsb3ddID0gcm9vdDIgPDwgMjQgfCBjdXJyIDw8IDE2IHwgbmV4dCAtIHRhYmxlX2luZGV4IHwgMDsKICAgICAgfQogICAgfQogICAgaWYgKGh1ZmYgIT09IDApIHsKICAgICAgdGFibGVbbmV4dCArIGh1ZmZdID0gbGVuIC0gZHJvcCA8PCAyNCB8IDY0IDw8IDE2IHwgMDsKICAgIH0KICAgIG9wdHMuYml0cyA9IHJvb3QyOwogICAgcmV0dXJuIDA7CiAgfTsKICB2YXIgdXRpbHMkMSA9IGNvbW1vbiQxOwogIHZhciBhZGxlcjMyID0gYWRsZXIzMl8xOwogIHZhciBjcmMzMiA9IGNyYzMyXzE7CiAgdmFyIGluZmxhdGVfZmFzdCA9IGluZmZhc3Q7CiAgdmFyIGluZmxhdGVfdGFibGUgPSBpbmZ0cmVlczsKICB2YXIgQ09ERVMgPSAwOwogIHZhciBMRU5TID0gMTsKICB2YXIgRElTVFMgPSAyOwogIHZhciBaX0ZJTklTSCA9IDQ7CiAgdmFyIFpfQkxPQ0sgPSA1OwogIHZhciBaX1RSRUVTID0gNjsKICB2YXIgWl9PSyA9IDA7CiAgdmFyIFpfU1RSRUFNX0VORCA9IDE7CiAgdmFyIFpfTkVFRF9ESUNUID0gMjsKICB2YXIgWl9TVFJFQU1fRVJST1IgPSAtMjsKICB2YXIgWl9EQVRBX0VSUk9SID0gLTM7CiAgdmFyIFpfTUVNX0VSUk9SID0gLTQ7CiAgdmFyIFpfQlVGX0VSUk9SID0gLTU7CiAgdmFyIFpfREVGTEFURUQgPSA4OwogIHZhciBIRUFEID0gMTsKICB2YXIgRkxBR1MgPSAyOwogIHZhciBUSU1FID0gMzsKICB2YXIgT1MgPSA0OwogIHZhciBFWExFTiA9IDU7CiAgdmFyIEVYVFJBID0gNjsKICB2YXIgTkFNRSA9IDc7CiAgdmFyIENPTU1FTlQgPSA4OwogIHZhciBIQ1JDID0gOTsKICB2YXIgRElDVElEID0gMTA7CiAgdmFyIERJQ1QgPSAxMTsKICB2YXIgVFlQRSA9IDEyOwogIHZhciBUWVBFRE8gPSAxMzsKICB2YXIgU1RPUkVEID0gMTQ7CiAgdmFyIENPUFlfID0gMTU7CiAgdmFyIENPUFkgPSAxNjsKICB2YXIgVEFCTEUgPSAxNzsKICB2YXIgTEVOTEVOUyA9IDE4OwogIHZhciBDT0RFTEVOUyA9IDE5OwogIHZhciBMRU5fID0gMjA7CiAgdmFyIExFTiA9IDIxOwogIHZhciBMRU5FWFQgPSAyMjsKICB2YXIgRElTVCA9IDIzOwogIHZhciBESVNURVhUID0gMjQ7CiAgdmFyIE1BVENIID0gMjU7CiAgdmFyIExJVCA9IDI2OwogIHZhciBDSEVDSyA9IDI3OwogIHZhciBMRU5HVEggPSAyODsKICB2YXIgRE9ORSA9IDI5OwogIHZhciBCQUQgPSAzMDsKICB2YXIgTUVNID0gMzE7CiAgdmFyIFNZTkMgPSAzMjsKICB2YXIgRU5PVUdIX0xFTlMgPSA4NTI7CiAgdmFyIEVOT1VHSF9ESVNUUyA9IDU5MjsKICB2YXIgTUFYX1dCSVRTID0gMTU7CiAgdmFyIERFRl9XQklUUyA9IE1BWF9XQklUUzsKICBmdW5jdGlvbiB6c3dhcDMyKHEyKSB7CiAgICByZXR1cm4gKHEyID4+PiAyNCAmIDI1NSkgKyAocTIgPj4+IDggJiA2NTI4MCkgKyAoKHEyICYgNjUyODApIDw8IDgpICsgKChxMiAmIDI1NSkgPDwgMjQpOwogIH0KICBmdW5jdGlvbiBJbmZsYXRlU3RhdGUoKSB7CiAgICB0aGlzLm1vZGUgPSAwOwogICAgdGhpcy5sYXN0ID0gZmFsc2U7CiAgICB0aGlzLndyYXAgPSAwOwogICAgdGhpcy5oYXZlZGljdCA9IGZhbHNlOwogICAgdGhpcy5mbGFncyA9IDA7CiAgICB0aGlzLmRtYXggPSAwOwogICAgdGhpcy5jaGVjayA9IDA7CiAgICB0aGlzLnRvdGFsID0gMDsKICAgIHRoaXMuaGVhZCA9IG51bGw7CiAgICB0aGlzLndiaXRzID0gMDsKICAgIHRoaXMud3NpemUgPSAwOwogICAgdGhpcy53aGF2ZSA9IDA7CiAgICB0aGlzLnduZXh0ID0gMDsKICAgIHRoaXMud2luZG93ID0gbnVsbDsKICAgIHRoaXMuaG9sZCA9IDA7CiAgICB0aGlzLmJpdHMgPSAwOwogICAgdGhpcy5sZW5ndGggPSAwOwogICAgdGhpcy5vZmZzZXQgPSAwOwogICAgdGhpcy5leHRyYSA9IDA7CiAgICB0aGlzLmxlbmNvZGUgPSBudWxsOwogICAgdGhpcy5kaXN0Y29kZSA9IG51bGw7CiAgICB0aGlzLmxlbmJpdHMgPSAwOwogICAgdGhpcy5kaXN0Yml0cyA9IDA7CiAgICB0aGlzLm5jb2RlID0gMDsKICAgIHRoaXMubmxlbiA9IDA7CiAgICB0aGlzLm5kaXN0ID0gMDsKICAgIHRoaXMuaGF2ZSA9IDA7CiAgICB0aGlzLm5leHQgPSBudWxsOwogICAgdGhpcy5sZW5zID0gbmV3IHV0aWxzJDEuQnVmMTYoMzIwKTsKICAgIHRoaXMud29yayA9IG5ldyB1dGlscyQxLkJ1ZjE2KDI4OCk7CiAgICB0aGlzLmxlbmR5biA9IG51bGw7CiAgICB0aGlzLmRpc3RkeW4gPSBudWxsOwogICAgdGhpcy5zYW5lID0gMDsKICAgIHRoaXMuYmFjayA9IDA7CiAgICB0aGlzLndhcyA9IDA7CiAgfQogIGZ1bmN0aW9uIGluZmxhdGVSZXNldEtlZXAoc3RybSkgewogICAgdmFyIHN0YXRlOwogICAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlKSB7CiAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUjsKICAgIH0KICAgIHN0YXRlID0gc3RybS5zdGF0ZTsKICAgIHN0cm0udG90YWxfaW4gPSBzdHJtLnRvdGFsX291dCA9IHN0YXRlLnRvdGFsID0gMDsKICAgIHN0cm0ubXNnID0gIiI7CiAgICBpZiAoc3RhdGUud3JhcCkgewogICAgICBzdHJtLmFkbGVyID0gc3RhdGUud3JhcCAmIDE7CiAgICB9CiAgICBzdGF0ZS5tb2RlID0gSEVBRDsKICAgIHN0YXRlLmxhc3QgPSAwOwogICAgc3RhdGUuaGF2ZWRpY3QgPSAwOwogICAgc3RhdGUuZG1heCA9IDMyNzY4OwogICAgc3RhdGUuaGVhZCA9IG51bGw7CiAgICBzdGF0ZS5ob2xkID0gMDsKICAgIHN0YXRlLmJpdHMgPSAwOwogICAgc3RhdGUubGVuY29kZSA9IHN0YXRlLmxlbmR5biA9IG5ldyB1dGlscyQxLkJ1ZjMyKEVOT1VHSF9MRU5TKTsKICAgIHN0YXRlLmRpc3Rjb2RlID0gc3RhdGUuZGlzdGR5biA9IG5ldyB1dGlscyQxLkJ1ZjMyKEVOT1VHSF9ESVNUUyk7CiAgICBzdGF0ZS5zYW5lID0gMTsKICAgIHN0YXRlLmJhY2sgPSAtMTsKICAgIHJldHVybiBaX09LOwogIH0KICBmdW5jdGlvbiBpbmZsYXRlUmVzZXQoc3RybSkgewogICAgdmFyIHN0YXRlOwogICAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlKSB7CiAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUjsKICAgIH0KICAgIHN0YXRlID0gc3RybS5zdGF0ZTsKICAgIHN0YXRlLndzaXplID0gMDsKICAgIHN0YXRlLndoYXZlID0gMDsKICAgIHN0YXRlLnduZXh0ID0gMDsKICAgIHJldHVybiBpbmZsYXRlUmVzZXRLZWVwKHN0cm0pOwogIH0KICBmdW5jdGlvbiBpbmZsYXRlUmVzZXQyKHN0cm0sIHdpbmRvd0JpdHMpIHsKICAgIHZhciB3cmFwOwogICAgdmFyIHN0YXRlOwogICAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlKSB7CiAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUjsKICAgIH0KICAgIHN0YXRlID0gc3RybS5zdGF0ZTsKICAgIGlmICh3aW5kb3dCaXRzIDwgMCkgewogICAgICB3cmFwID0gMDsKICAgICAgd2luZG93Qml0cyA9IC13aW5kb3dCaXRzOwogICAgfSBlbHNlIHsKICAgICAgd3JhcCA9ICh3aW5kb3dCaXRzID4+IDQpICsgMTsKICAgICAgaWYgKHdpbmRvd0JpdHMgPCA0OCkgewogICAgICAgIHdpbmRvd0JpdHMgJj0gMTU7CiAgICAgIH0KICAgIH0KICAgIGlmICh3aW5kb3dCaXRzICYmICh3aW5kb3dCaXRzIDwgOCB8fCB3aW5kb3dCaXRzID4gMTUpKSB7CiAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUjsKICAgIH0KICAgIGlmIChzdGF0ZS53aW5kb3cgIT09IG51bGwgJiYgc3RhdGUud2JpdHMgIT09IHdpbmRvd0JpdHMpIHsKICAgICAgc3RhdGUud2luZG93ID0gbnVsbDsKICAgIH0KICAgIHN0YXRlLndyYXAgPSB3cmFwOwogICAgc3RhdGUud2JpdHMgPSB3aW5kb3dCaXRzOwogICAgcmV0dXJuIGluZmxhdGVSZXNldChzdHJtKTsKICB9CiAgZnVuY3Rpb24gaW5mbGF0ZUluaXQyKHN0cm0sIHdpbmRvd0JpdHMpIHsKICAgIHZhciByZXQ7CiAgICB2YXIgc3RhdGU7CiAgICBpZiAoIXN0cm0pIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SOwogICAgfQogICAgc3RhdGUgPSBuZXcgSW5mbGF0ZVN0YXRlKCk7CiAgICBzdHJtLnN0YXRlID0gc3RhdGU7CiAgICBzdGF0ZS53aW5kb3cgPSBudWxsOwogICAgcmV0ID0gaW5mbGF0ZVJlc2V0MihzdHJtLCB3aW5kb3dCaXRzKTsKICAgIGlmIChyZXQgIT09IFpfT0spIHsKICAgICAgc3RybS5zdGF0ZSA9IG51bGw7CiAgICB9CiAgICByZXR1cm4gcmV0OwogIH0KICBmdW5jdGlvbiBpbmZsYXRlSW5pdChzdHJtKSB7CiAgICByZXR1cm4gaW5mbGF0ZUluaXQyKHN0cm0sIERFRl9XQklUUyk7CiAgfQogIHZhciB2aXJnaW4gPSB0cnVlOwogIHZhciBsZW5maXgsIGRpc3RmaXg7CiAgZnVuY3Rpb24gZml4ZWR0YWJsZXMoc3RhdGUpIHsKICAgIGlmICh2aXJnaW4pIHsKICAgICAgdmFyIHN5bTsKICAgICAgbGVuZml4ID0gbmV3IHV0aWxzJDEuQnVmMzIoNTEyKTsKICAgICAgZGlzdGZpeCA9IG5ldyB1dGlscyQxLkJ1ZjMyKDMyKTsKICAgICAgc3ltID0gMDsKICAgICAgd2hpbGUgKHN5bSA8IDE0NCkgewogICAgICAgIHN0YXRlLmxlbnNbc3ltKytdID0gODsKICAgICAgfQogICAgICB3aGlsZSAoc3ltIDwgMjU2KSB7CiAgICAgICAgc3RhdGUubGVuc1tzeW0rK10gPSA5OwogICAgICB9CiAgICAgIHdoaWxlIChzeW0gPCAyODApIHsKICAgICAgICBzdGF0ZS5sZW5zW3N5bSsrXSA9IDc7CiAgICAgIH0KICAgICAgd2hpbGUgKHN5bSA8IDI4OCkgewogICAgICAgIHN0YXRlLmxlbnNbc3ltKytdID0gODsKICAgICAgfQogICAgICBpbmZsYXRlX3RhYmxlKExFTlMsIHN0YXRlLmxlbnMsIDAsIDI4OCwgbGVuZml4LCAwLCBzdGF0ZS53b3JrLCB7IGJpdHM6IDkgfSk7CiAgICAgIHN5bSA9IDA7CiAgICAgIHdoaWxlIChzeW0gPCAzMikgewogICAgICAgIHN0YXRlLmxlbnNbc3ltKytdID0gNTsKICAgICAgfQogICAgICBpbmZsYXRlX3RhYmxlKERJU1RTLCBzdGF0ZS5sZW5zLCAwLCAzMiwgZGlzdGZpeCwgMCwgc3RhdGUud29yaywgeyBiaXRzOiA1IH0pOwogICAgICB2aXJnaW4gPSBmYWxzZTsKICAgIH0KICAgIHN0YXRlLmxlbmNvZGUgPSBsZW5maXg7CiAgICBzdGF0ZS5sZW5iaXRzID0gOTsKICAgIHN0YXRlLmRpc3Rjb2RlID0gZGlzdGZpeDsKICAgIHN0YXRlLmRpc3RiaXRzID0gNTsKICB9CiAgZnVuY3Rpb24gdXBkYXRld2luZG93KHN0cm0sIHNyYywgZW5kLCBjb3B5KSB7CiAgICB2YXIgZGlzdDI7CiAgICB2YXIgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgaWYgKHN0YXRlLndpbmRvdyA9PT0gbnVsbCkgewogICAgICBzdGF0ZS53c2l6ZSA9IDEgPDwgc3RhdGUud2JpdHM7CiAgICAgIHN0YXRlLnduZXh0ID0gMDsKICAgICAgc3RhdGUud2hhdmUgPSAwOwogICAgICBzdGF0ZS53aW5kb3cgPSBuZXcgdXRpbHMkMS5CdWY4KHN0YXRlLndzaXplKTsKICAgIH0KICAgIGlmIChjb3B5ID49IHN0YXRlLndzaXplKSB7CiAgICAgIHV0aWxzJDEuYXJyYXlTZXQoc3RhdGUud2luZG93LCBzcmMsIGVuZCAtIHN0YXRlLndzaXplLCBzdGF0ZS53c2l6ZSwgMCk7CiAgICAgIHN0YXRlLnduZXh0ID0gMDsKICAgICAgc3RhdGUud2hhdmUgPSBzdGF0ZS53c2l6ZTsKICAgIH0gZWxzZSB7CiAgICAgIGRpc3QyID0gc3RhdGUud3NpemUgLSBzdGF0ZS53bmV4dDsKICAgICAgaWYgKGRpc3QyID4gY29weSkgewogICAgICAgIGRpc3QyID0gY29weTsKICAgICAgfQogICAgICB1dGlscyQxLmFycmF5U2V0KHN0YXRlLndpbmRvdywgc3JjLCBlbmQgLSBjb3B5LCBkaXN0Miwgc3RhdGUud25leHQpOwogICAgICBjb3B5IC09IGRpc3QyOwogICAgICBpZiAoY29weSkgewogICAgICAgIHV0aWxzJDEuYXJyYXlTZXQoc3RhdGUud2luZG93LCBzcmMsIGVuZCAtIGNvcHksIGNvcHksIDApOwogICAgICAgIHN0YXRlLnduZXh0ID0gY29weTsKICAgICAgICBzdGF0ZS53aGF2ZSA9IHN0YXRlLndzaXplOwogICAgICB9IGVsc2UgewogICAgICAgIHN0YXRlLnduZXh0ICs9IGRpc3QyOwogICAgICAgIGlmIChzdGF0ZS53bmV4dCA9PT0gc3RhdGUud3NpemUpIHsKICAgICAgICAgIHN0YXRlLnduZXh0ID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlLndoYXZlIDwgc3RhdGUud3NpemUpIHsKICAgICAgICAgIHN0YXRlLndoYXZlICs9IGRpc3QyOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIDA7CiAgfQogIGZ1bmN0aW9uIGluZmxhdGUkMihzdHJtLCBmbHVzaCkgewogICAgdmFyIHN0YXRlOwogICAgdmFyIGlucHV0LCBvdXRwdXQ7CiAgICB2YXIgbmV4dDsKICAgIHZhciBwdXQ7CiAgICB2YXIgaGF2ZSwgbGVmdDsKICAgIHZhciBob2xkOwogICAgdmFyIGJpdHM7CiAgICB2YXIgX2luLCBfb3V0OwogICAgdmFyIGNvcHk7CiAgICB2YXIgZnJvbTsKICAgIHZhciBmcm9tX3NvdXJjZTsKICAgIHZhciBoZXJlID0gMDsKICAgIHZhciBoZXJlX2JpdHMsIGhlcmVfb3AsIGhlcmVfdmFsOwogICAgdmFyIGxhc3RfYml0cywgbGFzdF9vcCwgbGFzdF92YWw7CiAgICB2YXIgbGVuOwogICAgdmFyIHJldDsKICAgIHZhciBoYnVmID0gbmV3IHV0aWxzJDEuQnVmOCg0KTsKICAgIHZhciBvcHRzOwogICAgdmFyIG47CiAgICB2YXIgb3JkZXIgPSBbMTYsIDE3LCAxOCwgMCwgOCwgNywgOSwgNiwgMTAsIDUsIDExLCA0LCAxMiwgMywgMTMsIDIsIDE0LCAxLCAxNV07CiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUgfHwgIXN0cm0ub3V0cHV0IHx8ICFzdHJtLmlucHV0ICYmIHN0cm0uYXZhaWxfaW4gIT09IDApIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SOwogICAgfQogICAgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgaWYgKHN0YXRlLm1vZGUgPT09IFRZUEUpIHsKICAgICAgc3RhdGUubW9kZSA9IFRZUEVETzsKICAgIH0KICAgIHB1dCA9IHN0cm0ubmV4dF9vdXQ7CiAgICBvdXRwdXQgPSBzdHJtLm91dHB1dDsKICAgIGxlZnQgPSBzdHJtLmF2YWlsX291dDsKICAgIG5leHQgPSBzdHJtLm5leHRfaW47CiAgICBpbnB1dCA9IHN0cm0uaW5wdXQ7CiAgICBoYXZlID0gc3RybS5hdmFpbF9pbjsKICAgIGhvbGQgPSBzdGF0ZS5ob2xkOwogICAgYml0cyA9IHN0YXRlLmJpdHM7CiAgICBfaW4gPSBoYXZlOwogICAgX291dCA9IGxlZnQ7CiAgICByZXQgPSBaX09LOwogICAgaW5mX2xlYXZlOgogICAgICBmb3IgKDsgOyApIHsKICAgICAgICBzd2l0Y2ggKHN0YXRlLm1vZGUpIHsKICAgICAgICAgIGNhc2UgSEVBRDoKICAgICAgICAgICAgaWYgKHN0YXRlLndyYXAgPT09IDApIHsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gVFlQRURPOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGF0ZS53cmFwICYgMiAmJiBob2xkID09PSAzNTYxNSkgewogICAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gMDsKICAgICAgICAgICAgICBoYnVmWzBdID0gaG9sZCAmIDI1NTsKICAgICAgICAgICAgICBoYnVmWzFdID0gaG9sZCA+Pj4gOCAmIDI1NTsKICAgICAgICAgICAgICBzdGF0ZS5jaGVjayA9IGNyYzMyKHN0YXRlLmNoZWNrLCBoYnVmLCAyLCAwKTsKICAgICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gRkxBR1M7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUuZmxhZ3MgPSAwOwogICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgIHN0YXRlLmhlYWQuZG9uZSA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghKHN0YXRlLndyYXAgJiAxKSB8fCAoKChob2xkICYgMjU1KSA8PCA4KSArIChob2xkID4+IDgpKSAlIDMxKSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW5jb3JyZWN0IGhlYWRlciBjaGVjayI7CiAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKGhvbGQgJiAxNSkgIT09IFpfREVGTEFURUQpIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJ1bmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCI7CiAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBob2xkID4+Pj0gNDsKICAgICAgICAgICAgYml0cyAtPSA0OwogICAgICAgICAgICBsZW4gPSAoaG9sZCAmIDE1KSArIDg7CiAgICAgICAgICAgIGlmIChzdGF0ZS53Yml0cyA9PT0gMCkgewogICAgICAgICAgICAgIHN0YXRlLndiaXRzID0gbGVuOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxlbiA+IHN0YXRlLndiaXRzKSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCB3aW5kb3cgc2l6ZSI7CiAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZS5kbWF4ID0gMSA8PCBsZW47CiAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9IDE7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBob2xkICYgNTEyID8gRElDVElEIDogVFlQRTsKICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgRkxBR1M6CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmZsYWdzID0gaG9sZDsKICAgICAgICAgICAgaWYgKChzdGF0ZS5mbGFncyAmIDI1NSkgIT09IFpfREVGTEFURUQpIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJ1bmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCI7CiAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiA1NzM0NCkgewogICAgICAgICAgICAgIHN0cm0ubXNnID0gInVua25vd24gaGVhZGVyIGZsYWdzIHNldCI7CiAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgIHN0YXRlLmhlYWQudGV4dCA9IGhvbGQgPj4gOCAmIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgNTEyKSB7CiAgICAgICAgICAgICAgaGJ1ZlswXSA9IGhvbGQgJiAyNTU7CiAgICAgICAgICAgICAgaGJ1ZlsxXSA9IGhvbGQgPj4+IDggJiAyNTU7CiAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMihzdGF0ZS5jaGVjaywgaGJ1ZiwgMiwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gVElNRTsKICAgICAgICAgIGNhc2UgVElNRToKICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgICBzdGF0ZS5oZWFkLnRpbWUgPSBob2xkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDUxMikgewogICAgICAgICAgICAgIGhidWZbMF0gPSBob2xkICYgMjU1OwogICAgICAgICAgICAgIGhidWZbMV0gPSBob2xkID4+PiA4ICYgMjU1OwogICAgICAgICAgICAgIGhidWZbMl0gPSBob2xkID4+PiAxNiAmIDI1NTsKICAgICAgICAgICAgICBoYnVmWzNdID0gaG9sZCA+Pj4gMjQgJiAyNTU7CiAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMihzdGF0ZS5jaGVjaywgaGJ1ZiwgNCwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gT1M7CiAgICAgICAgICBjYXNlIE9TOgogICAgICAgICAgICB3aGlsZSAoYml0cyA8IDE2KSB7CiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgIHN0YXRlLmhlYWQueGZsYWdzID0gaG9sZCAmIDI1NTsKICAgICAgICAgICAgICBzdGF0ZS5oZWFkLm9zID0gaG9sZCA+PiA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDUxMikgewogICAgICAgICAgICAgIGhidWZbMF0gPSBob2xkICYgMjU1OwogICAgICAgICAgICAgIGhidWZbMV0gPSBob2xkID4+PiA4ICYgMjU1OwogICAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzIoc3RhdGUuY2hlY2ssIGhidWYsIDIsIDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEVYTEVOOwogICAgICAgICAgY2FzZSBFWExFTjoKICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMTAyNCkgewogICAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzdGF0ZS5sZW5ndGggPSBob2xkOwogICAgICAgICAgICAgIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmV4dHJhX2xlbiA9IGhvbGQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDUxMikgewogICAgICAgICAgICAgICAgaGJ1ZlswXSA9IGhvbGQgJiAyNTU7CiAgICAgICAgICAgICAgICBoYnVmWzFdID0gaG9sZCA+Pj4gOCAmIDI1NTsKICAgICAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzIoc3RhdGUuY2hlY2ssIGhidWYsIDIsIDApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICAgICAgc3RhdGUuaGVhZC5leHRyYSA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUubW9kZSA9IEVYVFJBOwogICAgICAgICAgY2FzZSBFWFRSQToKICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMTAyNCkgewogICAgICAgICAgICAgIGNvcHkgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICAgICAgaWYgKGNvcHkgPiBoYXZlKSB7CiAgICAgICAgICAgICAgICBjb3B5ID0gaGF2ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGNvcHkpIHsKICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICAgICAgICAgIGxlbiA9IHN0YXRlLmhlYWQuZXh0cmFfbGVuIC0gc3RhdGUubGVuZ3RoOwogICAgICAgICAgICAgICAgICBpZiAoIXN0YXRlLmhlYWQuZXh0cmEpIHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmV4dHJhID0gbmV3IEFycmF5KHN0YXRlLmhlYWQuZXh0cmFfbGVuKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB1dGlscyQxLmFycmF5U2V0KHN0YXRlLmhlYWQuZXh0cmEsIGlucHV0LCBuZXh0LCBjb3B5LCBsZW4pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgNTEyKSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzIoc3RhdGUuY2hlY2ssIGlucHV0LCBjb3B5LCBuZXh0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgICAgICAgIG5leHQgKz0gY29weTsKICAgICAgICAgICAgICAgIHN0YXRlLmxlbmd0aCAtPSBjb3B5OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc3RhdGUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmxlbmd0aCA9IDA7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBOQU1FOwogICAgICAgICAgY2FzZSBOQU1FOgogICAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAyMDQ4KSB7CiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29weSA9IDA7CiAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgbGVuID0gaW5wdXRbbmV4dCArIGNvcHkrK107CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCAmJiBsZW4gJiYgc3RhdGUubGVuZ3RoIDwgNjU1MzYpIHsKICAgICAgICAgICAgICAgICAgc3RhdGUuaGVhZC5uYW1lICs9IFN0cmluZy5mcm9tQ2hhckNvZGUobGVuKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IHdoaWxlIChsZW4gJiYgY29weSA8IGhhdmUpOwogICAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDUxMikgewogICAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMihzdGF0ZS5jaGVjaywgaW5wdXQsIGNvcHksIG5leHQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBoYXZlIC09IGNvcHk7CiAgICAgICAgICAgICAgbmV4dCArPSBjb3B5OwogICAgICAgICAgICAgIGlmIChsZW4pIHsKICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgIHN0YXRlLmhlYWQubmFtZSA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUubGVuZ3RoID0gMDsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IENPTU1FTlQ7CiAgICAgICAgICBjYXNlIENPTU1FTlQ6CiAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDQwOTYpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb3B5ID0gMDsKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICBsZW4gPSBpbnB1dFtuZXh0ICsgY29weSsrXTsKICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5oZWFkICYmIGxlbiAmJiBzdGF0ZS5sZW5ndGggPCA2NTUzNikgewogICAgICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmNvbW1lbnQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShsZW4pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gd2hpbGUgKGxlbiAmJiBjb3B5IDwgaGF2ZSk7CiAgICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgNTEyKSB7CiAgICAgICAgICAgICAgICBzdGF0ZS5jaGVjayA9IGNyYzMyKHN0YXRlLmNoZWNrLCBpbnB1dCwgY29weSwgbmV4dCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgICAgICBuZXh0ICs9IGNvcHk7CiAgICAgICAgICAgICAgaWYgKGxlbikgewogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICAgICAgc3RhdGUuaGVhZC5jb21tZW50ID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZS5tb2RlID0gSENSQzsKICAgICAgICAgIGNhc2UgSENSQzoKICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgNTEyKSB7CiAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAxNikgewogICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChob2xkICE9PSAoc3RhdGUuY2hlY2sgJiA2NTUzNSkpIHsKICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gImhlYWRlciBjcmMgbWlzbWF0Y2giOwogICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgIHN0YXRlLmhlYWQuaGNyYyA9IHN0YXRlLmZsYWdzID4+IDkgJiAxOwogICAgICAgICAgICAgIHN0YXRlLmhlYWQuZG9uZSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RybS5hZGxlciA9IHN0YXRlLmNoZWNrID0gMDsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IFRZUEU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBESUNUSUQ6CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMzIpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9IHpzd2FwMzIoaG9sZCk7CiAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IERJQ1Q7CiAgICAgICAgICBjYXNlIERJQ1Q6CiAgICAgICAgICAgIGlmIChzdGF0ZS5oYXZlZGljdCA9PT0gMCkgewogICAgICAgICAgICAgIHN0cm0ubmV4dF9vdXQgPSBwdXQ7CiAgICAgICAgICAgICAgc3RybS5hdmFpbF9vdXQgPSBsZWZ0OwogICAgICAgICAgICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICAgICAgICAgICAgc3RybS5hdmFpbF9pbiA9IGhhdmU7CiAgICAgICAgICAgICAgc3RhdGUuaG9sZCA9IGhvbGQ7CiAgICAgICAgICAgICAgc3RhdGUuYml0cyA9IGJpdHM7CiAgICAgICAgICAgICAgcmV0dXJuIFpfTkVFRF9ESUNUOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9IDE7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFOwogICAgICAgICAgY2FzZSBUWVBFOgogICAgICAgICAgICBpZiAoZmx1c2ggPT09IFpfQkxPQ0sgfHwgZmx1c2ggPT09IFpfVFJFRVMpIHsKICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgIH0KICAgICAgICAgIGNhc2UgVFlQRURPOgogICAgICAgICAgICBpZiAoc3RhdGUubGFzdCkgewogICAgICAgICAgICAgIGhvbGQgPj4+PSBiaXRzICYgNzsKICAgICAgICAgICAgICBiaXRzIC09IGJpdHMgJiA3OwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBDSEVDSzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aGlsZSAoYml0cyA8IDMpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmxhc3QgPSBob2xkICYgMTsKICAgICAgICAgICAgaG9sZCA+Pj49IDE7CiAgICAgICAgICAgIGJpdHMgLT0gMTsKICAgICAgICAgICAgc3dpdGNoIChob2xkICYgMykgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBTVE9SRUQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBmaXhlZHRhYmxlcyhzdGF0ZSk7CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gTEVOXzsKICAgICAgICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9UUkVFUykgewogICAgICAgICAgICAgICAgICBob2xkID4+Pj0gMjsKICAgICAgICAgICAgICAgICAgYml0cyAtPSAyOwogICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gVEFCTEU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbnZhbGlkIGJsb2NrIHR5cGUiOwogICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgfQogICAgICAgICAgICBob2xkID4+Pj0gMjsKICAgICAgICAgICAgYml0cyAtPSAyOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgU1RPUkVEOgogICAgICAgICAgICBob2xkID4+Pj0gYml0cyAmIDc7CiAgICAgICAgICAgIGJpdHMgLT0gYml0cyAmIDc7CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMzIpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoaG9sZCAmIDY1NTM1KSAhPT0gKGhvbGQgPj4+IDE2IF4gNjU1MzUpKSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBzdG9yZWQgYmxvY2sgbGVuZ3RocyI7CiAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZS5sZW5ndGggPSBob2xkICYgNjU1MzU7CiAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IENPUFlfOwogICAgICAgICAgICBpZiAoZmx1c2ggPT09IFpfVFJFRVMpIHsKICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgIH0KICAgICAgICAgIGNhc2UgQ09QWV86CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBDT1BZOwogICAgICAgICAgY2FzZSBDT1BZOgogICAgICAgICAgICBjb3B5ID0gc3RhdGUubGVuZ3RoOwogICAgICAgICAgICBpZiAoY29weSkgewogICAgICAgICAgICAgIGlmIChjb3B5ID4gaGF2ZSkgewogICAgICAgICAgICAgICAgY29weSA9IGhhdmU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChjb3B5ID4gbGVmdCkgewogICAgICAgICAgICAgICAgY29weSA9IGxlZnQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChjb3B5ID09PSAwKSB7CiAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHV0aWxzJDEuYXJyYXlTZXQob3V0cHV0LCBpbnB1dCwgbmV4dCwgY29weSwgcHV0KTsKICAgICAgICAgICAgICBoYXZlIC09IGNvcHk7CiAgICAgICAgICAgICAgbmV4dCArPSBjb3B5OwogICAgICAgICAgICAgIGxlZnQgLT0gY29weTsKICAgICAgICAgICAgICBwdXQgKz0gY29weTsKICAgICAgICAgICAgICBzdGF0ZS5sZW5ndGggLT0gY29weTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZS5tb2RlID0gVFlQRTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIFRBQkxFOgogICAgICAgICAgICB3aGlsZSAoYml0cyA8IDE0KSB7CiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZS5ubGVuID0gKGhvbGQgJiAzMSkgKyAyNTc7CiAgICAgICAgICAgIGhvbGQgPj4+PSA1OwogICAgICAgICAgICBiaXRzIC09IDU7CiAgICAgICAgICAgIHN0YXRlLm5kaXN0ID0gKGhvbGQgJiAzMSkgKyAxOwogICAgICAgICAgICBob2xkID4+Pj0gNTsKICAgICAgICAgICAgYml0cyAtPSA1OwogICAgICAgICAgICBzdGF0ZS5uY29kZSA9IChob2xkICYgMTUpICsgNDsKICAgICAgICAgICAgaG9sZCA+Pj49IDQ7CiAgICAgICAgICAgIGJpdHMgLT0gNDsKICAgICAgICAgICAgaWYgKHN0YXRlLm5sZW4gPiAyODYgfHwgc3RhdGUubmRpc3QgPiAzMCkgewogICAgICAgICAgICAgIHN0cm0ubXNnID0gInRvbyBtYW55IGxlbmd0aCBvciBkaXN0YW5jZSBzeW1ib2xzIjsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmhhdmUgPSAwOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gTEVOTEVOUzsKICAgICAgICAgIGNhc2UgTEVOTEVOUzoKICAgICAgICAgICAgd2hpbGUgKHN0YXRlLmhhdmUgPCBzdGF0ZS5uY29kZSkgewogICAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMykgewogICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHN0YXRlLmxlbnNbb3JkZXJbc3RhdGUuaGF2ZSsrXV0gPSBob2xkICYgNzsKICAgICAgICAgICAgICBob2xkID4+Pj0gMzsKICAgICAgICAgICAgICBiaXRzIC09IDM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2hpbGUgKHN0YXRlLmhhdmUgPCAxOSkgewogICAgICAgICAgICAgIHN0YXRlLmxlbnNbb3JkZXJbc3RhdGUuaGF2ZSsrXV0gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmxlbmNvZGUgPSBzdGF0ZS5sZW5keW47CiAgICAgICAgICAgIHN0YXRlLmxlbmJpdHMgPSA3OwogICAgICAgICAgICBvcHRzID0geyBiaXRzOiBzdGF0ZS5sZW5iaXRzIH07CiAgICAgICAgICAgIHJldCA9IGluZmxhdGVfdGFibGUoQ09ERVMsIHN0YXRlLmxlbnMsIDAsIDE5LCBzdGF0ZS5sZW5jb2RlLCAwLCBzdGF0ZS53b3JrLCBvcHRzKTsKICAgICAgICAgICAgc3RhdGUubGVuYml0cyA9IG9wdHMuYml0czsKICAgICAgICAgICAgaWYgKHJldCkgewogICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgY29kZSBsZW5ndGhzIHNldCI7CiAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZS5oYXZlID0gMDsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IENPREVMRU5TOwogICAgICAgICAgY2FzZSBDT0RFTEVOUzoKICAgICAgICAgICAgd2hpbGUgKHN0YXRlLmhhdmUgPCBzdGF0ZS5ubGVuICsgc3RhdGUubmRpc3QpIHsKICAgICAgICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5sZW5jb2RlW2hvbGQgJiAoMSA8PCBzdGF0ZS5sZW5iaXRzKSAtIDFdOwogICAgICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgICBoZXJlX29wID0gaGVyZSA+Pj4gMTYgJiAyNTU7CiAgICAgICAgICAgICAgICBoZXJlX3ZhbCA9IGhlcmUgJiA2NTUzNTsKICAgICAgICAgICAgICAgIGlmIChoZXJlX2JpdHMgPD0gYml0cykgewogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoaGVyZV92YWwgPCAxNikgewogICAgICAgICAgICAgICAgaG9sZCA+Pj49IGhlcmVfYml0czsKICAgICAgICAgICAgICAgIGJpdHMgLT0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgc3RhdGUubGVuc1tzdGF0ZS5oYXZlKytdID0gaGVyZV92YWw7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChoZXJlX3ZhbCA9PT0gMTYpIHsKICAgICAgICAgICAgICAgICAgbiA9IGhlcmVfYml0cyArIDI7CiAgICAgICAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgbikgewogICAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaG9sZCA+Pj49IGhlcmVfYml0czsKICAgICAgICAgICAgICAgICAgYml0cyAtPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5oYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBiaXQgbGVuZ3RoIHJlcGVhdCI7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBsZW4gPSBzdGF0ZS5sZW5zW3N0YXRlLmhhdmUgLSAxXTsKICAgICAgICAgICAgICAgICAgY29weSA9IDMgKyAoaG9sZCAmIDMpOwogICAgICAgICAgICAgICAgICBob2xkID4+Pj0gMjsKICAgICAgICAgICAgICAgICAgYml0cyAtPSAyOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoZXJlX3ZhbCA9PT0gMTcpIHsKICAgICAgICAgICAgICAgICAgbiA9IGhlcmVfYml0cyArIDM7CiAgICAgICAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgbikgewogICAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaG9sZCA+Pj49IGhlcmVfYml0czsKICAgICAgICAgICAgICAgICAgYml0cyAtPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICAgIGxlbiA9IDA7CiAgICAgICAgICAgICAgICAgIGNvcHkgPSAzICsgKGhvbGQgJiA3KTsKICAgICAgICAgICAgICAgICAgaG9sZCA+Pj49IDM7CiAgICAgICAgICAgICAgICAgIGJpdHMgLT0gMzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIG4gPSBoZXJlX2JpdHMgKyA3OwogICAgICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IG4pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICAgIGJpdHMgLT0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgICBsZW4gPSAwOwogICAgICAgICAgICAgICAgICBjb3B5ID0gMTEgKyAoaG9sZCAmIDEyNyk7CiAgICAgICAgICAgICAgICAgIGhvbGQgPj4+PSA3OwogICAgICAgICAgICAgICAgICBiaXRzIC09IDc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuaGF2ZSArIGNvcHkgPiBzdGF0ZS5ubGVuICsgc3RhdGUubmRpc3QpIHsKICAgICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBiaXQgbGVuZ3RoIHJlcGVhdCI7CiAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2hpbGUgKGNvcHktLSkgewogICAgICAgICAgICAgICAgICBzdGF0ZS5sZW5zW3N0YXRlLmhhdmUrK10gPSBsZW47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGF0ZS5tb2RlID09PSBCQUQpIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhdGUubGVuc1syNTZdID09PSAwKSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBjb2RlIC0tIG1pc3NpbmcgZW5kLW9mLWJsb2NrIjsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmxlbmJpdHMgPSA5OwogICAgICAgICAgICBvcHRzID0geyBiaXRzOiBzdGF0ZS5sZW5iaXRzIH07CiAgICAgICAgICAgIHJldCA9IGluZmxhdGVfdGFibGUoTEVOUywgc3RhdGUubGVucywgMCwgc3RhdGUubmxlbiwgc3RhdGUubGVuY29kZSwgMCwgc3RhdGUud29yaywgb3B0cyk7CiAgICAgICAgICAgIHN0YXRlLmxlbmJpdHMgPSBvcHRzLmJpdHM7CiAgICAgICAgICAgIGlmIChyZXQpIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbnZhbGlkIGxpdGVyYWwvbGVuZ3RocyBzZXQiOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUuZGlzdGJpdHMgPSA2OwogICAgICAgICAgICBzdGF0ZS5kaXN0Y29kZSA9IHN0YXRlLmRpc3RkeW47CiAgICAgICAgICAgIG9wdHMgPSB7IGJpdHM6IHN0YXRlLmRpc3RiaXRzIH07CiAgICAgICAgICAgIHJldCA9IGluZmxhdGVfdGFibGUoRElTVFMsIHN0YXRlLmxlbnMsIHN0YXRlLm5sZW4sIHN0YXRlLm5kaXN0LCBzdGF0ZS5kaXN0Y29kZSwgMCwgc3RhdGUud29yaywgb3B0cyk7CiAgICAgICAgICAgIHN0YXRlLmRpc3RiaXRzID0gb3B0cy5iaXRzOwogICAgICAgICAgICBpZiAocmV0KSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZXMgc2V0IjsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU5fOwogICAgICAgICAgICBpZiAoZmx1c2ggPT09IFpfVFJFRVMpIHsKICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgIH0KICAgICAgICAgIGNhc2UgTEVOXzoKICAgICAgICAgICAgc3RhdGUubW9kZSA9IExFTjsKICAgICAgICAgIGNhc2UgTEVOOgogICAgICAgICAgICBpZiAoaGF2ZSA+PSA2ICYmIGxlZnQgPj0gMjU4KSB7CiAgICAgICAgICAgICAgc3RybS5uZXh0X291dCA9IHB1dDsKICAgICAgICAgICAgICBzdHJtLmF2YWlsX291dCA9IGxlZnQ7CiAgICAgICAgICAgICAgc3RybS5uZXh0X2luID0gbmV4dDsKICAgICAgICAgICAgICBzdHJtLmF2YWlsX2luID0gaGF2ZTsKICAgICAgICAgICAgICBzdGF0ZS5ob2xkID0gaG9sZDsKICAgICAgICAgICAgICBzdGF0ZS5iaXRzID0gYml0czsKICAgICAgICAgICAgICBpbmZsYXRlX2Zhc3Qoc3RybSwgX291dCk7CiAgICAgICAgICAgICAgcHV0ID0gc3RybS5uZXh0X291dDsKICAgICAgICAgICAgICBvdXRwdXQgPSBzdHJtLm91dHB1dDsKICAgICAgICAgICAgICBsZWZ0ID0gc3RybS5hdmFpbF9vdXQ7CiAgICAgICAgICAgICAgbmV4dCA9IHN0cm0ubmV4dF9pbjsKICAgICAgICAgICAgICBpbnB1dCA9IHN0cm0uaW5wdXQ7CiAgICAgICAgICAgICAgaGF2ZSA9IHN0cm0uYXZhaWxfaW47CiAgICAgICAgICAgICAgaG9sZCA9IHN0YXRlLmhvbGQ7CiAgICAgICAgICAgICAgYml0cyA9IHN0YXRlLmJpdHM7CiAgICAgICAgICAgICAgaWYgKHN0YXRlLm1vZGUgPT09IFRZUEUpIHsKICAgICAgICAgICAgICAgIHN0YXRlLmJhY2sgPSAtMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUuYmFjayA9IDA7CiAgICAgICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5sZW5jb2RlW2hvbGQgJiAoMSA8PCBzdGF0ZS5sZW5iaXRzKSAtIDFdOwogICAgICAgICAgICAgIGhlcmVfYml0cyA9IGhlcmUgPj4+IDI0OwogICAgICAgICAgICAgIGhlcmVfb3AgPSBoZXJlID4+PiAxNiAmIDI1NTsKICAgICAgICAgICAgICBoZXJlX3ZhbCA9IGhlcmUgJiA2NTUzNTsKICAgICAgICAgICAgICBpZiAoaGVyZV9iaXRzIDw9IGJpdHMpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZXJlX29wICYmIChoZXJlX29wICYgMjQwKSA9PT0gMCkgewogICAgICAgICAgICAgIGxhc3RfYml0cyA9IGhlcmVfYml0czsKICAgICAgICAgICAgICBsYXN0X29wID0gaGVyZV9vcDsKICAgICAgICAgICAgICBsYXN0X3ZhbCA9IGhlcmVfdmFsOwogICAgICAgICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgICAgICAgaGVyZSA9IHN0YXRlLmxlbmNvZGVbbGFzdF92YWwgKyAoKGhvbGQgJiAoMSA8PCBsYXN0X2JpdHMgKyBsYXN0X29wKSAtIDEpID4+IGxhc3RfYml0cyldOwogICAgICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgICBoZXJlX29wID0gaGVyZSA+Pj4gMTYgJiAyNTU7CiAgICAgICAgICAgICAgICBoZXJlX3ZhbCA9IGhlcmUgJiA2NTUzNTsKICAgICAgICAgICAgICAgIGlmIChsYXN0X2JpdHMgKyBoZXJlX2JpdHMgPD0gYml0cykgewogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBob2xkID4+Pj0gbGFzdF9iaXRzOwogICAgICAgICAgICAgIGJpdHMgLT0gbGFzdF9iaXRzOwogICAgICAgICAgICAgIHN0YXRlLmJhY2sgKz0gbGFzdF9iaXRzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICAgIGJpdHMgLT0gaGVyZV9iaXRzOwogICAgICAgICAgICBzdGF0ZS5iYWNrICs9IGhlcmVfYml0czsKICAgICAgICAgICAgc3RhdGUubGVuZ3RoID0gaGVyZV92YWw7CiAgICAgICAgICAgIGlmIChoZXJlX29wID09PSAwKSB7CiAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IExJVDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGVyZV9vcCAmIDMyKSB7CiAgICAgICAgICAgICAgc3RhdGUuYmFjayA9IC0xOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZXJlX29wICYgNjQpIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbnZhbGlkIGxpdGVyYWwvbGVuZ3RoIGNvZGUiOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUuZXh0cmEgPSBoZXJlX29wICYgMTU7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU5FWFQ7CiAgICAgICAgICBjYXNlIExFTkVYVDoKICAgICAgICAgICAgaWYgKHN0YXRlLmV4dHJhKSB7CiAgICAgICAgICAgICAgbiA9IHN0YXRlLmV4dHJhOwogICAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgbikgewogICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHN0YXRlLmxlbmd0aCArPSBob2xkICYgKDEgPDwgc3RhdGUuZXh0cmEpIC0gMTsKICAgICAgICAgICAgICBob2xkID4+Pj0gc3RhdGUuZXh0cmE7CiAgICAgICAgICAgICAgYml0cyAtPSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgICBzdGF0ZS5iYWNrICs9IHN0YXRlLmV4dHJhOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLndhcyA9IHN0YXRlLmxlbmd0aDsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IERJU1Q7CiAgICAgICAgICBjYXNlIERJU1Q6CiAgICAgICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5kaXN0Y29kZVtob2xkICYgKDEgPDwgc3RhdGUuZGlzdGJpdHMpIC0gMV07CiAgICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgaGVyZV9vcCA9IGhlcmUgPj4+IDE2ICYgMjU1OwogICAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDY1NTM1OwogICAgICAgICAgICAgIGlmIChoZXJlX2JpdHMgPD0gYml0cykgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKChoZXJlX29wICYgMjQwKSA9PT0gMCkgewogICAgICAgICAgICAgIGxhc3RfYml0cyA9IGhlcmVfYml0czsKICAgICAgICAgICAgICBsYXN0X29wID0gaGVyZV9vcDsKICAgICAgICAgICAgICBsYXN0X3ZhbCA9IGhlcmVfdmFsOwogICAgICAgICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgICAgICAgaGVyZSA9IHN0YXRlLmRpc3Rjb2RlW2xhc3RfdmFsICsgKChob2xkICYgKDEgPDwgbGFzdF9iaXRzICsgbGFzdF9vcCkgLSAxKSA+PiBsYXN0X2JpdHMpXTsKICAgICAgICAgICAgICAgIGhlcmVfYml0cyA9IGhlcmUgPj4+IDI0OwogICAgICAgICAgICAgICAgaGVyZV9vcCA9IGhlcmUgPj4+IDE2ICYgMjU1OwogICAgICAgICAgICAgICAgaGVyZV92YWwgPSBoZXJlICYgNjU1MzU7CiAgICAgICAgICAgICAgICBpZiAobGFzdF9iaXRzICsgaGVyZV9iaXRzIDw9IGJpdHMpIHsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaG9sZCA+Pj49IGxhc3RfYml0czsKICAgICAgICAgICAgICBiaXRzIC09IGxhc3RfYml0czsKICAgICAgICAgICAgICBzdGF0ZS5iYWNrICs9IGxhc3RfYml0czsKICAgICAgICAgICAgfQogICAgICAgICAgICBob2xkID4+Pj0gaGVyZV9iaXRzOwogICAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgICAgc3RhdGUuYmFjayArPSBoZXJlX2JpdHM7CiAgICAgICAgICAgIGlmIChoZXJlX29wICYgNjQpIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICJpbnZhbGlkIGRpc3RhbmNlIGNvZGUiOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUub2Zmc2V0ID0gaGVyZV92YWw7CiAgICAgICAgICAgIHN0YXRlLmV4dHJhID0gaGVyZV9vcCAmIDE1OwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gRElTVEVYVDsKICAgICAgICAgIGNhc2UgRElTVEVYVDoKICAgICAgICAgICAgaWYgKHN0YXRlLmV4dHJhKSB7CiAgICAgICAgICAgICAgbiA9IHN0YXRlLmV4dHJhOwogICAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgbikgewogICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHN0YXRlLm9mZnNldCArPSBob2xkICYgKDEgPDwgc3RhdGUuZXh0cmEpIC0gMTsKICAgICAgICAgICAgICBob2xkID4+Pj0gc3RhdGUuZXh0cmE7CiAgICAgICAgICAgICAgYml0cyAtPSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgICBzdGF0ZS5iYWNrICs9IHN0YXRlLmV4dHJhOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGF0ZS5vZmZzZXQgPiBzdGF0ZS5kbWF4KSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGUubW9kZSA9IE1BVENIOwogICAgICAgICAgY2FzZSBNQVRDSDoKICAgICAgICAgICAgaWYgKGxlZnQgPT09IDApIHsKICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29weSA9IF9vdXQgLSBsZWZ0OwogICAgICAgICAgICBpZiAoc3RhdGUub2Zmc2V0ID4gY29weSkgewogICAgICAgICAgICAgIGNvcHkgPSBzdGF0ZS5vZmZzZXQgLSBjb3B5OwogICAgICAgICAgICAgIGlmIChjb3B5ID4gc3RhdGUud2hhdmUpIHsKICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5zYW5lKSB7CiAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gImludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrIjsKICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChjb3B5ID4gc3RhdGUud25leHQpIHsKICAgICAgICAgICAgICAgIGNvcHkgLT0gc3RhdGUud25leHQ7CiAgICAgICAgICAgICAgICBmcm9tID0gc3RhdGUud3NpemUgLSBjb3B5OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmcm9tID0gc3RhdGUud25leHQgLSBjb3B5OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoY29weSA+IHN0YXRlLmxlbmd0aCkgewogICAgICAgICAgICAgICAgY29weSA9IHN0YXRlLmxlbmd0aDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZnJvbV9zb3VyY2UgPSBzdGF0ZS53aW5kb3c7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZnJvbV9zb3VyY2UgPSBvdXRwdXQ7CiAgICAgICAgICAgICAgZnJvbSA9IHB1dCAtIHN0YXRlLm9mZnNldDsKICAgICAgICAgICAgICBjb3B5ID0gc3RhdGUubGVuZ3RoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjb3B5ID4gbGVmdCkgewogICAgICAgICAgICAgIGNvcHkgPSBsZWZ0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxlZnQgLT0gY29weTsKICAgICAgICAgICAgc3RhdGUubGVuZ3RoIC09IGNvcHk7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBvdXRwdXRbcHV0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgICAgfSB3aGlsZSAoLS1jb3B5KTsKICAgICAgICAgICAgaWYgKHN0YXRlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIExJVDoKICAgICAgICAgICAgaWYgKGxlZnQgPT09IDApIHsKICAgICAgICAgICAgICBicmVhayBpbmZfbGVhdmU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3V0cHV0W3B1dCsrXSA9IHN0YXRlLmxlbmd0aDsKICAgICAgICAgICAgbGVmdC0tOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gTEVOOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgQ0hFQ0s6CiAgICAgICAgICAgIGlmIChzdGF0ZS53cmFwKSB7CiAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgaG9sZCB8PSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF9vdXQgLT0gbGVmdDsKICAgICAgICAgICAgICBzdHJtLnRvdGFsX291dCArPSBfb3V0OwogICAgICAgICAgICAgIHN0YXRlLnRvdGFsICs9IF9vdXQ7CiAgICAgICAgICAgICAgaWYgKF9vdXQpIHsKICAgICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9IHN0YXRlLmZsYWdzID8gY3JjMzIoc3RhdGUuY2hlY2ssIG91dHB1dCwgX291dCwgcHV0IC0gX291dCkgOiBhZGxlcjMyKHN0YXRlLmNoZWNrLCBvdXRwdXQsIF9vdXQsIHB1dCAtIF9vdXQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBfb3V0ID0gbGVmdDsKICAgICAgICAgICAgICBpZiAoKHN0YXRlLmZsYWdzID8gaG9sZCA6IHpzd2FwMzIoaG9sZCkpICE9PSBzdGF0ZS5jaGVjaykgewogICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW5jb3JyZWN0IGRhdGEgY2hlY2siOwogICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZS5tb2RlID0gTEVOR1RIOwogICAgICAgICAgY2FzZSBMRU5HVEg6CiAgICAgICAgICAgIGlmIChzdGF0ZS53cmFwICYmIHN0YXRlLmZsYWdzKSB7CiAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChob2xkICE9PSAoc3RhdGUudG90YWwgJiA0Mjk0OTY3Mjk1KSkgewogICAgICAgICAgICAgICAgc3RybS5tc2cgPSAiaW5jb3JyZWN0IGxlbmd0aCBjaGVjayI7CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBET05FOwogICAgICAgICAgY2FzZSBET05FOgogICAgICAgICAgICByZXQgPSBaX1NUUkVBTV9FTkQ7CiAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgIGNhc2UgQkFEOgogICAgICAgICAgICByZXQgPSBaX0RBVEFfRVJST1I7CiAgICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICAgIGNhc2UgTUVNOgogICAgICAgICAgICByZXR1cm4gWl9NRU1fRVJST1I7CiAgICAgICAgICBjYXNlIFNZTkM6CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICAgICAgfQogICAgICB9CiAgICBzdHJtLm5leHRfb3V0ID0gcHV0OwogICAgc3RybS5hdmFpbF9vdXQgPSBsZWZ0OwogICAgc3RybS5uZXh0X2luID0gbmV4dDsKICAgIHN0cm0uYXZhaWxfaW4gPSBoYXZlOwogICAgc3RhdGUuaG9sZCA9IGhvbGQ7CiAgICBzdGF0ZS5iaXRzID0gYml0czsKICAgIGlmIChzdGF0ZS53c2l6ZSB8fCBfb3V0ICE9PSBzdHJtLmF2YWlsX291dCAmJiBzdGF0ZS5tb2RlIDwgQkFEICYmIChzdGF0ZS5tb2RlIDwgQ0hFQ0sgfHwgZmx1c2ggIT09IFpfRklOSVNIKSkgewogICAgICBpZiAodXBkYXRld2luZG93KHN0cm0sIHN0cm0ub3V0cHV0LCBzdHJtLm5leHRfb3V0LCBfb3V0IC0gc3RybS5hdmFpbF9vdXQpKQogICAgICAgIDsKICAgIH0KICAgIF9pbiAtPSBzdHJtLmF2YWlsX2luOwogICAgX291dCAtPSBzdHJtLmF2YWlsX291dDsKICAgIHN0cm0udG90YWxfaW4gKz0gX2luOwogICAgc3RybS50b3RhbF9vdXQgKz0gX291dDsKICAgIHN0YXRlLnRvdGFsICs9IF9vdXQ7CiAgICBpZiAoc3RhdGUud3JhcCAmJiBfb3V0KSB7CiAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9IHN0YXRlLmZsYWdzID8gY3JjMzIoc3RhdGUuY2hlY2ssIG91dHB1dCwgX291dCwgc3RybS5uZXh0X291dCAtIF9vdXQpIDogYWRsZXIzMihzdGF0ZS5jaGVjaywgb3V0cHV0LCBfb3V0LCBzdHJtLm5leHRfb3V0IC0gX291dCk7CiAgICB9CiAgICBzdHJtLmRhdGFfdHlwZSA9IHN0YXRlLmJpdHMgKyAoc3RhdGUubGFzdCA/IDY0IDogMCkgKyAoc3RhdGUubW9kZSA9PT0gVFlQRSA/IDEyOCA6IDApICsgKHN0YXRlLm1vZGUgPT09IExFTl8gfHwgc3RhdGUubW9kZSA9PT0gQ09QWV8gPyAyNTYgOiAwKTsKICAgIGlmICgoX2luID09PSAwICYmIF9vdXQgPT09IDAgfHwgZmx1c2ggPT09IFpfRklOSVNIKSAmJiByZXQgPT09IFpfT0spIHsKICAgICAgcmV0ID0gWl9CVUZfRVJST1I7CiAgICB9CiAgICByZXR1cm4gcmV0OwogIH0KICBmdW5jdGlvbiBpbmZsYXRlRW5kKHN0cm0pIHsKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICB9CiAgICB2YXIgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgaWYgKHN0YXRlLndpbmRvdykgewogICAgICBzdGF0ZS53aW5kb3cgPSBudWxsOwogICAgfQogICAgc3RybS5zdGF0ZSA9IG51bGw7CiAgICByZXR1cm4gWl9PSzsKICB9CiAgZnVuY3Rpb24gaW5mbGF0ZUdldEhlYWRlcihzdHJtLCBoZWFkKSB7CiAgICB2YXIgc3RhdGU7CiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SOwogICAgfQogICAgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgaWYgKChzdGF0ZS53cmFwICYgMikgPT09IDApIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SOwogICAgfQogICAgc3RhdGUuaGVhZCA9IGhlYWQ7CiAgICBoZWFkLmRvbmUgPSBmYWxzZTsKICAgIHJldHVybiBaX09LOwogIH0KICBmdW5jdGlvbiBpbmZsYXRlU2V0RGljdGlvbmFyeShzdHJtLCBkaWN0aW9uYXJ5KSB7CiAgICB2YXIgZGljdExlbmd0aCA9IGRpY3Rpb25hcnkubGVuZ3RoOwogICAgdmFyIHN0YXRlOwogICAgdmFyIGRpY3RpZDsKICAgIHZhciByZXQ7CiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SOwogICAgfQogICAgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgaWYgKHN0YXRlLndyYXAgIT09IDAgJiYgc3RhdGUubW9kZSAhPT0gRElDVCkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1I7CiAgICB9CiAgICBpZiAoc3RhdGUubW9kZSA9PT0gRElDVCkgewogICAgICBkaWN0aWQgPSAxOwogICAgICBkaWN0aWQgPSBhZGxlcjMyKGRpY3RpZCwgZGljdGlvbmFyeSwgZGljdExlbmd0aCwgMCk7CiAgICAgIGlmIChkaWN0aWQgIT09IHN0YXRlLmNoZWNrKSB7CiAgICAgICAgcmV0dXJuIFpfREFUQV9FUlJPUjsKICAgICAgfQogICAgfQogICAgcmV0ID0gdXBkYXRld2luZG93KHN0cm0sIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgsIGRpY3RMZW5ndGgpOwogICAgaWYgKHJldCkgewogICAgICBzdGF0ZS5tb2RlID0gTUVNOwogICAgICByZXR1cm4gWl9NRU1fRVJST1I7CiAgICB9CiAgICBzdGF0ZS5oYXZlZGljdCA9IDE7CiAgICByZXR1cm4gWl9PSzsKICB9CiAgaW5mbGF0ZSQzLmluZmxhdGVSZXNldCA9IGluZmxhdGVSZXNldDsKICBpbmZsYXRlJDMuaW5mbGF0ZVJlc2V0MiA9IGluZmxhdGVSZXNldDI7CiAgaW5mbGF0ZSQzLmluZmxhdGVSZXNldEtlZXAgPSBpbmZsYXRlUmVzZXRLZWVwOwogIGluZmxhdGUkMy5pbmZsYXRlSW5pdCA9IGluZmxhdGVJbml0OwogIGluZmxhdGUkMy5pbmZsYXRlSW5pdDIgPSBpbmZsYXRlSW5pdDI7CiAgaW5mbGF0ZSQzLmluZmxhdGUgPSBpbmZsYXRlJDI7CiAgaW5mbGF0ZSQzLmluZmxhdGVFbmQgPSBpbmZsYXRlRW5kOwogIGluZmxhdGUkMy5pbmZsYXRlR2V0SGVhZGVyID0gaW5mbGF0ZUdldEhlYWRlcjsKICBpbmZsYXRlJDMuaW5mbGF0ZVNldERpY3Rpb25hcnkgPSBpbmZsYXRlU2V0RGljdGlvbmFyeTsKICBpbmZsYXRlJDMuaW5mbGF0ZUluZm8gPSAicGFrbyBpbmZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSI7CiAgdmFyIGNvbnN0YW50cyQxID0gewogICAgWl9OT19GTFVTSDogMCwKICAgIFpfUEFSVElBTF9GTFVTSDogMSwKICAgIFpfU1lOQ19GTFVTSDogMiwKICAgIFpfRlVMTF9GTFVTSDogMywKICAgIFpfRklOSVNIOiA0LAogICAgWl9CTE9DSzogNSwKICAgIFpfVFJFRVM6IDYsCiAgICBaX09LOiAwLAogICAgWl9TVFJFQU1fRU5EOiAxLAogICAgWl9ORUVEX0RJQ1Q6IDIsCiAgICBaX0VSUk5POiAtMSwKICAgIFpfU1RSRUFNX0VSUk9SOiAtMiwKICAgIFpfREFUQV9FUlJPUjogLTMsCiAgICBaX0JVRl9FUlJPUjogLTUsCiAgICBaX05PX0NPTVBSRVNTSU9OOiAwLAogICAgWl9CRVNUX1NQRUVEOiAxLAogICAgWl9CRVNUX0NPTVBSRVNTSU9OOiA5LAogICAgWl9ERUZBVUxUX0NPTVBSRVNTSU9OOiAtMSwKICAgIFpfRklMVEVSRUQ6IDEsCiAgICBaX0hVRkZNQU5fT05MWTogMiwKICAgIFpfUkxFOiAzLAogICAgWl9GSVhFRDogNCwKICAgIFpfREVGQVVMVF9TVFJBVEVHWTogMCwKICAgIFpfQklOQVJZOiAwLAogICAgWl9URVhUOiAxLAogICAgWl9VTktOT1dOOiAyLAogICAgWl9ERUZMQVRFRDogOAogIH07CiAgZnVuY3Rpb24gR1poZWFkZXIkMSgpIHsKICAgIHRoaXMudGV4dCA9IDA7CiAgICB0aGlzLnRpbWUgPSAwOwogICAgdGhpcy54ZmxhZ3MgPSAwOwogICAgdGhpcy5vcyA9IDA7CiAgICB0aGlzLmV4dHJhID0gbnVsbDsKICAgIHRoaXMuZXh0cmFfbGVuID0gMDsKICAgIHRoaXMubmFtZSA9ICIiOwogICAgdGhpcy5jb21tZW50ID0gIiI7CiAgICB0aGlzLmhjcmMgPSAwOwogICAgdGhpcy5kb25lID0gZmFsc2U7CiAgfQogIHZhciBnemhlYWRlciA9IEdaaGVhZGVyJDE7CiAgdmFyIHpsaWJfaW5mbGF0ZSA9IGluZmxhdGUkMzsKICB2YXIgdXRpbHMgPSBjb21tb24kMTsKICB2YXIgc3RyaW5ncyA9IHN0cmluZ3MkMjsKICB2YXIgYyA9IGNvbnN0YW50cyQxOwogIHZhciBtc2cgPSBtZXNzYWdlcyQxOwogIHZhciBaU3RyZWFtID0genN0cmVhbTsKICB2YXIgR1poZWFkZXIgPSBnemhlYWRlcjsKICB2YXIgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwogIGZ1bmN0aW9uIEluZmxhdGUkMShvcHRpb25zKSB7CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgSW5mbGF0ZSQxKSkKICAgICAgcmV0dXJuIG5ldyBJbmZsYXRlJDEob3B0aW9ucyk7CiAgICB0aGlzLm9wdGlvbnMgPSB1dGlscy5hc3NpZ24oewogICAgICBjaHVua1NpemU6IDE2Mzg0LAogICAgICB3aW5kb3dCaXRzOiAwLAogICAgICB0bzogIiIKICAgIH0sIG9wdGlvbnMgfHwge30pOwogICAgdmFyIG9wdCA9IHRoaXMub3B0aW9uczsKICAgIGlmIChvcHQucmF3ICYmIG9wdC53aW5kb3dCaXRzID49IDAgJiYgb3B0LndpbmRvd0JpdHMgPCAxNikgewogICAgICBvcHQud2luZG93Qml0cyA9IC1vcHQud2luZG93Qml0czsKICAgICAgaWYgKG9wdC53aW5kb3dCaXRzID09PSAwKSB7CiAgICAgICAgb3B0LndpbmRvd0JpdHMgPSAtMTU7CiAgICAgIH0KICAgIH0KICAgIGlmIChvcHQud2luZG93Qml0cyA+PSAwICYmIG9wdC53aW5kb3dCaXRzIDwgMTYgJiYgIShvcHRpb25zICYmIG9wdGlvbnMud2luZG93Qml0cykpIHsKICAgICAgb3B0LndpbmRvd0JpdHMgKz0gMzI7CiAgICB9CiAgICBpZiAob3B0LndpbmRvd0JpdHMgPiAxNSAmJiBvcHQud2luZG93Qml0cyA8IDQ4KSB7CiAgICAgIGlmICgob3B0LndpbmRvd0JpdHMgJiAxNSkgPT09IDApIHsKICAgICAgICBvcHQud2luZG93Qml0cyB8PSAxNTsKICAgICAgfQogICAgfQogICAgdGhpcy5lcnIgPSAwOwogICAgdGhpcy5tc2cgPSAiIjsKICAgIHRoaXMuZW5kZWQgPSBmYWxzZTsKICAgIHRoaXMuY2h1bmtzID0gW107CiAgICB0aGlzLnN0cm0gPSBuZXcgWlN0cmVhbSgpOwogICAgdGhpcy5zdHJtLmF2YWlsX291dCA9IDA7CiAgICB2YXIgc3RhdHVzID0gemxpYl9pbmZsYXRlLmluZmxhdGVJbml0Mih0aGlzLnN0cm0sIG9wdC53aW5kb3dCaXRzKTsKICAgIGlmIChzdGF0dXMgIT09IGMuWl9PSykgewogICAgICB0aHJvdyBuZXcgRXJyb3IobXNnW3N0YXR1c10pOwogICAgfQogICAgdGhpcy5oZWFkZXIgPSBuZXcgR1poZWFkZXIoKTsKICAgIHpsaWJfaW5mbGF0ZS5pbmZsYXRlR2V0SGVhZGVyKHRoaXMuc3RybSwgdGhpcy5oZWFkZXIpOwogICAgaWYgKG9wdC5kaWN0aW9uYXJ5KSB7CiAgICAgIGlmICh0eXBlb2Ygb3B0LmRpY3Rpb25hcnkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgb3B0LmRpY3Rpb25hcnkgPSBzdHJpbmdzLnN0cmluZzJidWYob3B0LmRpY3Rpb25hcnkpOwogICAgICB9IGVsc2UgaWYgKHRvU3RyaW5nLmNhbGwob3B0LmRpY3Rpb25hcnkpID09PSAiW29iamVjdCBBcnJheUJ1ZmZlcl0iKSB7CiAgICAgICAgb3B0LmRpY3Rpb25hcnkgPSBuZXcgVWludDhBcnJheShvcHQuZGljdGlvbmFyeSk7CiAgICAgIH0KICAgICAgaWYgKG9wdC5yYXcpIHsKICAgICAgICBzdGF0dXMgPSB6bGliX2luZmxhdGUuaW5mbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLCBvcHQuZGljdGlvbmFyeSk7CiAgICAgICAgaWYgKHN0YXR1cyAhPT0gYy5aX09LKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnW3N0YXR1c10pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBJbmZsYXRlJDEucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbihkYXRhLCBtb2RlKSB7CiAgICB2YXIgc3RybSA9IHRoaXMuc3RybTsKICAgIHZhciBjaHVua1NpemUgPSB0aGlzLm9wdGlvbnMuY2h1bmtTaXplOwogICAgdmFyIGRpY3Rpb25hcnkgPSB0aGlzLm9wdGlvbnMuZGljdGlvbmFyeTsKICAgIHZhciBzdGF0dXMsIF9tb2RlOwogICAgdmFyIG5leHRfb3V0X3V0ZjgsIHRhaWwsIHV0ZjhzdHI7CiAgICB2YXIgYWxsb3dCdWZFcnJvciA9IGZhbHNlOwogICAgaWYgKHRoaXMuZW5kZWQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgX21vZGUgPSBtb2RlID09PSB+fm1vZGUgPyBtb2RlIDogbW9kZSA9PT0gdHJ1ZSA/IGMuWl9GSU5JU0ggOiBjLlpfTk9fRkxVU0g7CiAgICBpZiAodHlwZW9mIGRhdGEgPT09ICJzdHJpbmciKSB7CiAgICAgIHN0cm0uaW5wdXQgPSBzdHJpbmdzLmJpbnN0cmluZzJidWYoZGF0YSk7CiAgICB9IGVsc2UgaWYgKHRvU3RyaW5nLmNhbGwoZGF0YSkgPT09ICJbb2JqZWN0IEFycmF5QnVmZmVyXSIpIHsKICAgICAgc3RybS5pbnB1dCA9IG5ldyBVaW50OEFycmF5KGRhdGEpOwogICAgfSBlbHNlIHsKICAgICAgc3RybS5pbnB1dCA9IGRhdGE7CiAgICB9CiAgICBzdHJtLm5leHRfaW4gPSAwOwogICAgc3RybS5hdmFpbF9pbiA9IHN0cm0uaW5wdXQubGVuZ3RoOwogICAgZG8gewogICAgICBpZiAoc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICBzdHJtLm91dHB1dCA9IG5ldyB1dGlscy5CdWY4KGNodW5rU2l6ZSk7CiAgICAgICAgc3RybS5uZXh0X291dCA9IDA7CiAgICAgICAgc3RybS5hdmFpbF9vdXQgPSBjaHVua1NpemU7CiAgICAgIH0KICAgICAgc3RhdHVzID0gemxpYl9pbmZsYXRlLmluZmxhdGUoc3RybSwgYy5aX05PX0ZMVVNIKTsKICAgICAgaWYgKHN0YXR1cyA9PT0gYy5aX05FRURfRElDVCAmJiBkaWN0aW9uYXJ5KSB7CiAgICAgICAgc3RhdHVzID0gemxpYl9pbmZsYXRlLmluZmxhdGVTZXREaWN0aW9uYXJ5KHRoaXMuc3RybSwgZGljdGlvbmFyeSk7CiAgICAgIH0KICAgICAgaWYgKHN0YXR1cyA9PT0gYy5aX0JVRl9FUlJPUiAmJiBhbGxvd0J1ZkVycm9yID09PSB0cnVlKSB7CiAgICAgICAgc3RhdHVzID0gYy5aX09LOwogICAgICAgIGFsbG93QnVmRXJyb3IgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoc3RhdHVzICE9PSBjLlpfU1RSRUFNX0VORCAmJiBzdGF0dXMgIT09IGMuWl9PSykgewogICAgICAgIHRoaXMub25FbmQoc3RhdHVzKTsKICAgICAgICB0aGlzLmVuZGVkID0gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHN0cm0ubmV4dF9vdXQpIHsKICAgICAgICBpZiAoc3RybS5hdmFpbF9vdXQgPT09IDAgfHwgc3RhdHVzID09PSBjLlpfU1RSRUFNX0VORCB8fCBzdHJtLmF2YWlsX2luID09PSAwICYmIChfbW9kZSA9PT0gYy5aX0ZJTklTSCB8fCBfbW9kZSA9PT0gYy5aX1NZTkNfRkxVU0gpKSB7CiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnRvID09PSAic3RyaW5nIikgewogICAgICAgICAgICBuZXh0X291dF91dGY4ID0gc3RyaW5ncy51dGY4Ym9yZGVyKHN0cm0ub3V0cHV0LCBzdHJtLm5leHRfb3V0KTsKICAgICAgICAgICAgdGFpbCA9IHN0cm0ubmV4dF9vdXQgLSBuZXh0X291dF91dGY4OwogICAgICAgICAgICB1dGY4c3RyID0gc3RyaW5ncy5idWYyc3RyaW5nKHN0cm0ub3V0cHV0LCBuZXh0X291dF91dGY4KTsKICAgICAgICAgICAgc3RybS5uZXh0X291dCA9IHRhaWw7CiAgICAgICAgICAgIHN0cm0uYXZhaWxfb3V0ID0gY2h1bmtTaXplIC0gdGFpbDsKICAgICAgICAgICAgaWYgKHRhaWwpIHsKICAgICAgICAgICAgICB1dGlscy5hcnJheVNldChzdHJtLm91dHB1dCwgc3RybS5vdXRwdXQsIG5leHRfb3V0X3V0ZjgsIHRhaWwsIDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMub25EYXRhKHV0ZjhzdHIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5vbkRhdGEodXRpbHMuc2hyaW5rQnVmKHN0cm0ub3V0cHV0LCBzdHJtLm5leHRfb3V0KSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChzdHJtLmF2YWlsX2luID09PSAwICYmIHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgYWxsb3dCdWZFcnJvciA9IHRydWU7CiAgICAgIH0KICAgIH0gd2hpbGUgKChzdHJtLmF2YWlsX2luID4gMCB8fCBzdHJtLmF2YWlsX291dCA9PT0gMCkgJiYgc3RhdHVzICE9PSBjLlpfU1RSRUFNX0VORCk7CiAgICBpZiAoc3RhdHVzID09PSBjLlpfU1RSRUFNX0VORCkgewogICAgICBfbW9kZSA9IGMuWl9GSU5JU0g7CiAgICB9CiAgICBpZiAoX21vZGUgPT09IGMuWl9GSU5JU0gpIHsKICAgICAgc3RhdHVzID0gemxpYl9pbmZsYXRlLmluZmxhdGVFbmQodGhpcy5zdHJtKTsKICAgICAgdGhpcy5vbkVuZChzdGF0dXMpOwogICAgICB0aGlzLmVuZGVkID0gdHJ1ZTsKICAgICAgcmV0dXJuIHN0YXR1cyA9PT0gYy5aX09LOwogICAgfQogICAgaWYgKF9tb2RlID09PSBjLlpfU1lOQ19GTFVTSCkgewogICAgICB0aGlzLm9uRW5kKGMuWl9PSyk7CiAgICAgIHN0cm0uYXZhaWxfb3V0ID0gMDsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9OwogIEluZmxhdGUkMS5wcm90b3R5cGUub25EYXRhID0gZnVuY3Rpb24oY2h1bmspIHsKICAgIHRoaXMuY2h1bmtzLnB1c2goY2h1bmspOwogIH07CiAgSW5mbGF0ZSQxLnByb3RvdHlwZS5vbkVuZCA9IGZ1bmN0aW9uKHN0YXR1cykgewogICAgaWYgKHN0YXR1cyA9PT0gYy5aX09LKSB7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMudG8gPT09ICJzdHJpbmciKSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSB0aGlzLmNodW5rcy5qb2luKCIiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJlc3VsdCA9IHV0aWxzLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpOwogICAgICB9CiAgICB9CiAgICB0aGlzLmNodW5rcyA9IFtdOwogICAgdGhpcy5lcnIgPSBzdGF0dXM7CiAgICB0aGlzLm1zZyA9IHRoaXMuc3RybS5tc2c7CiAgfTsKICBmdW5jdGlvbiBpbmZsYXRlJDEoaW5wdXQsIG9wdGlvbnMpIHsKICAgIHZhciBpbmZsYXRvciA9IG5ldyBJbmZsYXRlJDEob3B0aW9ucyk7CiAgICBpbmZsYXRvci5wdXNoKGlucHV0LCB0cnVlKTsKICAgIGlmIChpbmZsYXRvci5lcnIpIHsKICAgICAgdGhyb3cgaW5mbGF0b3IubXNnIHx8IG1zZ1tpbmZsYXRvci5lcnJdOwogICAgfQogICAgcmV0dXJuIGluZmxhdG9yLnJlc3VsdDsKICB9CiAgZnVuY3Rpb24gaW5mbGF0ZVJhdyhpbnB1dCwgb3B0aW9ucykgewogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICBvcHRpb25zLnJhdyA9IHRydWU7CiAgICByZXR1cm4gaW5mbGF0ZSQxKGlucHV0LCBvcHRpb25zKTsKICB9CiAgaW5mbGF0ZSQ0LkluZmxhdGUgPSBJbmZsYXRlJDE7CiAgaW5mbGF0ZSQ0LmluZmxhdGUgPSBpbmZsYXRlJDE7CiAgaW5mbGF0ZSQ0LmluZmxhdGVSYXcgPSBpbmZsYXRlUmF3OwogIGluZmxhdGUkNC51bmd6aXAgPSBpbmZsYXRlJDE7CiAgdmFyIGFzc2lnbiA9IGNvbW1vbiQxLmFzc2lnbjsKICB2YXIgZGVmbGF0ZSA9IGRlZmxhdGUkNDsKICB2YXIgaW5mbGF0ZSA9IGluZmxhdGUkNDsKICB2YXIgY29uc3RhbnRzID0gY29uc3RhbnRzJDE7CiAgdmFyIHBha28gPSB7fTsKICBhc3NpZ24ocGFrbywgZGVmbGF0ZSwgaW5mbGF0ZSwgY29uc3RhbnRzKTsKICB2YXIgcGFrb18xID0gcGFrbzsKICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQzID0gaW50ZXJvcFJlcXVpcmVEZWZhdWx0LmV4cG9ydHM7CiAgdmFyIF9yZWdlbmVyYXRvciQzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQzKHJlZ2VuZXJhdG9yKTsKICB2YXIgX2FzeW5jVG9HZW5lcmF0b3IyJDMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0JDMoYXN5bmNUb0dlbmVyYXRvci5leHBvcnRzKTsKICB2YXIgX3JlcXVpcmUkMiA9IHBha29fMSwgWl9TWU5DX0ZMVVNIID0gX3JlcXVpcmUkMi5aX1NZTkNfRkxVU0gsIEluZmxhdGUgPSBfcmVxdWlyZSQyLkluZmxhdGU7CiAgZnVuY3Rpb24gdW56aXAkMihfeCkgewogICAgcmV0dXJuIF91bnppcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0KICBmdW5jdGlvbiBfdW56aXAoKSB7CiAgICBfdW56aXAgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyJDMuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvciQzLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKGlucHV0RGF0YSkgewogICAgICB2YXIgc3RybSwgcG9zLCBpLCBjaHVua3MsIGluZmxhdG9yLCByZW1haW5pbmdJbnB1dCwgX2luZmxhdG9yLCByZXN1bHQ7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3IkMy5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDA7CiAgICAgICAgICAgICAgcG9zID0gMDsKICAgICAgICAgICAgICBpID0gMDsKICAgICAgICAgICAgICBjaHVua3MgPSBbXTsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIHJlbWFpbmluZ0lucHV0ID0gaW5wdXREYXRhLnNsaWNlKHBvcyk7CiAgICAgICAgICAgICAgaW5mbGF0b3IgPSBuZXcgSW5mbGF0ZSgpOwogICAgICAgICAgICAgIF9pbmZsYXRvciA9IGluZmxhdG9yOwogICAgICAgICAgICAgIHN0cm0gPSBfaW5mbGF0b3Iuc3RybTsKICAgICAgICAgICAgICBpbmZsYXRvci5wdXNoKHJlbWFpbmluZ0lucHV0LCBaX1NZTkNfRkxVU0gpOwogICAgICAgICAgICAgIGlmICghaW5mbGF0b3IuZXJyKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGluZmxhdG9yLm1zZyk7CiAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgcG9zICs9IHN0cm0ubmV4dF9pbjsKICAgICAgICAgICAgICBjaHVua3NbaV0gPSBCdWZmZXIuZnJvbShpbmZsYXRvci5yZXN1bHQpOwogICAgICAgICAgICAgIGkgKz0gMTsKICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBpZiAoc3RybS5hdmFpbF9pbikgewogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgcmVzdWx0ID0gQnVmZmVyLmNvbmNhdChjaHVua3MpOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHJlc3VsdCk7CiAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDE5OwogICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgaWYgKCFfY29udGV4dC50MC5tZXNzYWdlLm1hdGNoKC9pbmNvcnJlY3QgaGVhZGVyIGNoZWNrLykpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInByb2JsZW0gZGVjb21wcmVzc2luZyBibG9jazogaW5jb3JyZWN0IGd6aXAgaGVhZGVyIGNoZWNrIik7CiAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUsIG51bGwsIFtbMCwgMTldXSk7CiAgICB9KSk7CiAgICByZXR1cm4gX3VuemlwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQogIGZ1bmN0aW9uIHVuemlwQ2h1bmskMShfeDIpIHsKICAgIHJldHVybiBfdW56aXBDaHVuay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0KICBmdW5jdGlvbiBfdW56aXBDaHVuaygpIHsKICAgIF91bnppcENodW5rID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMiQzLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IkMy5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoaW5wdXREYXRhKSB7CiAgICAgIHZhciBzdHJtLCBjcG9zLCBkcG9zLCBibG9ja3MsIGNwb3NpdGlvbnMsIGRwb3NpdGlvbnMsIHJlbWFpbmluZ0lucHV0LCBpbmZsYXRvciwgX2J1ZmZlciwgYnVmZmVyOwogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDMuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDA7CiAgICAgICAgICAgICAgY3BvcyA9IDA7CiAgICAgICAgICAgICAgZHBvcyA9IDA7CiAgICAgICAgICAgICAgYmxvY2tzID0gW107CiAgICAgICAgICAgICAgY3Bvc2l0aW9ucyA9IFtdOwogICAgICAgICAgICAgIGRwb3NpdGlvbnMgPSBbXTsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIHJlbWFpbmluZ0lucHV0ID0gaW5wdXREYXRhLnNsaWNlKGNwb3MpOwogICAgICAgICAgICAgIGluZmxhdG9yID0gbmV3IEluZmxhdGUoKTsKICAgICAgICAgICAgICBzdHJtID0gaW5mbGF0b3Iuc3RybTsKICAgICAgICAgICAgICBpbmZsYXRvci5wdXNoKHJlbWFpbmluZ0lucHV0LCBaX1NZTkNfRkxVU0gpOwogICAgICAgICAgICAgIGlmICghaW5mbGF0b3IuZXJyKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihpbmZsYXRvci5tc2cpOwogICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgIF9idWZmZXIgPSBCdWZmZXIuZnJvbShpbmZsYXRvci5yZXN1bHQpOwogICAgICAgICAgICAgIGJsb2Nrcy5wdXNoKF9idWZmZXIpOwogICAgICAgICAgICAgIGNwb3NpdGlvbnMucHVzaChjcG9zKTsKICAgICAgICAgICAgICBkcG9zaXRpb25zLnB1c2goZHBvcyk7CiAgICAgICAgICAgICAgY3BvcyArPSBzdHJtLm5leHRfaW47CiAgICAgICAgICAgICAgZHBvcyArPSBfYnVmZmVyLmxlbmd0aDsKICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICBpZiAoc3RybS5hdmFpbF9pbikgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA2OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgIGJ1ZmZlciA9IEJ1ZmZlci5jb25jYXQoYmxvY2tzKTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgeyBidWZmZXIsIGNwb3NpdGlvbnMsIGRwb3NpdGlvbnMgfSk7CiAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAyMzsKICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgaWYgKCFfY29udGV4dDIudDAubWVzc2FnZS5tYXRjaCgvaW5jb3JyZWN0IGhlYWRlciBjaGVjay8pKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI3OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigicHJvYmxlbSBkZWNvbXByZXNzaW5nIGJsb2NrOiBpbmNvcnJlY3QgZ3ppcCBoZWFkZXIgY2hlY2siKTsKICAgICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUyLCBudWxsLCBbWzAsIDIzXV0pOwogICAgfSkpOwogICAgcmV0dXJuIF91bnppcENodW5rLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQogIGZ1bmN0aW9uIHVuemlwQ2h1bmtTbGljZSQxKF94MywgX3g0KSB7CiAgICByZXR1cm4gX3VuemlwQ2h1bmtTbGljZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0KICBmdW5jdGlvbiBfdW56aXBDaHVua1NsaWNlKCkgewogICAgX3VuemlwQ2h1bmtTbGljZSA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIkMy5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yJDMuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKGlucHV0RGF0YSwgY2h1bmspIHsKICAgICAgdmFyIHN0cm0sIGNwb3MsIGRwb3MsIGRlY29tcHJlc3NlZEJsb2NrcywgY3Bvc2l0aW9ucywgZHBvc2l0aW9ucywgcmVtYWluaW5nSW5wdXQsIGluZmxhdG9yLCBfYnVmZmVyMiwgbGVuLCBvcmlnQ3BvcywgYnVmZmVyOwogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDMuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dDMucHJldiA9IDA7CiAgICAgICAgICAgICAgY3BvcyA9IGNodW5rLm1pbnYuYmxvY2tQb3NpdGlvbjsKICAgICAgICAgICAgICBkcG9zID0gY2h1bmsubWludi5kYXRhUG9zaXRpb247CiAgICAgICAgICAgICAgZGVjb21wcmVzc2VkQmxvY2tzID0gW107CiAgICAgICAgICAgICAgY3Bvc2l0aW9ucyA9IFtdOwogICAgICAgICAgICAgIGRwb3NpdGlvbnMgPSBbXTsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIHJlbWFpbmluZ0lucHV0ID0gaW5wdXREYXRhLnNsaWNlKGNwb3MgLSBjaHVuay5taW52LmJsb2NrUG9zaXRpb24pOwogICAgICAgICAgICAgIGluZmxhdG9yID0gbmV3IEluZmxhdGUoKTsKICAgICAgICAgICAgICBzdHJtID0gaW5mbGF0b3Iuc3RybTsKICAgICAgICAgICAgICBpbmZsYXRvci5wdXNoKHJlbWFpbmluZ0lucHV0LCBaX1NZTkNfRkxVU0gpOwogICAgICAgICAgICAgIGlmICghaW5mbGF0b3IuZXJyKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihpbmZsYXRvci5tc2cpOwogICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgIF9idWZmZXIyID0gQnVmZmVyLmZyb20oaW5mbGF0b3IucmVzdWx0KTsKICAgICAgICAgICAgICBkZWNvbXByZXNzZWRCbG9ja3MucHVzaChfYnVmZmVyMik7CiAgICAgICAgICAgICAgbGVuID0gX2J1ZmZlcjIubGVuZ3RoOwogICAgICAgICAgICAgIGNwb3NpdGlvbnMucHVzaChjcG9zKTsKICAgICAgICAgICAgICBkcG9zaXRpb25zLnB1c2goZHBvcyk7CiAgICAgICAgICAgICAgaWYgKGRlY29tcHJlc3NlZEJsb2Nrcy5sZW5ndGggPT09IDEgJiYgY2h1bmsubWludi5kYXRhUG9zaXRpb24pIHsKICAgICAgICAgICAgICAgIGRlY29tcHJlc3NlZEJsb2Nrc1swXSA9IGRlY29tcHJlc3NlZEJsb2Nrc1swXS5zbGljZShjaHVuay5taW52LmRhdGFQb3NpdGlvbik7CiAgICAgICAgICAgICAgICBsZW4gPSBkZWNvbXByZXNzZWRCbG9ja3NbMF0ubGVuZ3RoOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBvcmlnQ3BvcyA9IGNwb3M7CiAgICAgICAgICAgICAgY3BvcyArPSBzdHJtLm5leHRfaW47CiAgICAgICAgICAgICAgZHBvcyArPSBsZW47CiAgICAgICAgICAgICAgaWYgKCEob3JpZ0Nwb3MgPj0gY2h1bmsubWF4di5ibG9ja1Bvc2l0aW9uKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyNjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBkZWNvbXByZXNzZWRCbG9ja3NbZGVjb21wcmVzc2VkQmxvY2tzLmxlbmd0aCAtIDFdID0gZGVjb21wcmVzc2VkQmxvY2tzW2RlY29tcHJlc3NlZEJsb2Nrcy5sZW5ndGggLSAxXS5zbGljZSgwLCBjaHVuay5tYXh2LmJsb2NrUG9zaXRpb24gPT09IGNodW5rLm1pbnYuYmxvY2tQb3NpdGlvbiA/IGNodW5rLm1heHYuZGF0YVBvc2l0aW9uIC0gY2h1bmsubWludi5kYXRhUG9zaXRpb24gKyAxIDogY2h1bmsubWF4di5kYXRhUG9zaXRpb24gKyAxKTsKICAgICAgICAgICAgICBjcG9zaXRpb25zLnB1c2goY3Bvcyk7CiAgICAgICAgICAgICAgZHBvc2l0aW9ucy5wdXNoKGRwb3MpOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJicmVhayIsIDI3KTsKICAgICAgICAgICAgY2FzZSAyNjoKICAgICAgICAgICAgICBpZiAoc3RybS5hdmFpbF9pbikgewogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA2OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICAgIGJ1ZmZlciA9IEJ1ZmZlci5jb25jYXQoZGVjb21wcmVzc2VkQmxvY2tzKTsKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgeyBidWZmZXIsIGNwb3NpdGlvbnMsIGRwb3NpdGlvbnMgfSk7CiAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgX2NvbnRleHQzLnByZXYgPSAzMTsKICAgICAgICAgICAgICBfY29udGV4dDMudDAgPSBfY29udGV4dDNbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgaWYgKCFfY29udGV4dDMudDAubWVzc2FnZS5tYXRjaCgvaW5jb3JyZWN0IGhlYWRlciBjaGVjay8pKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDM1OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigicHJvYmxlbSBkZWNvbXByZXNzaW5nIGJsb2NrOiBpbmNvcnJlY3QgZ3ppcCBoZWFkZXIgY2hlY2siKTsKICAgICAgICAgICAgY2FzZSAzNToKICAgICAgICAgICAgICB0aHJvdyBfY29udGV4dDMudDA7CiAgICAgICAgICAgIGNhc2UgMzY6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlMywgbnVsbCwgW1swLCAzMV1dKTsKICAgIH0pKTsKICAgIHJldHVybiBfdW56aXBDaHVua1NsaWNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQogIHZhciB1bnppcFBha28gPSB7CiAgICB1bnppcDogdW56aXAkMiwKICAgIHVuemlwQ2h1bms6IHVuemlwQ2h1bmskMSwKICAgIHVuemlwQ2h1bmtTbGljZTogdW56aXBDaHVua1NsaWNlJDEsCiAgICBwYWtvVW56aXA6IHVuemlwJDIsCiAgICBub2RlVW56aXA6IGZ1bmN0aW9uIG5vZGVVbnppcCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJub2RlVW56aXAgbm90IGltcGxlbWVudGVkLiIpOwogICAgfQogIH07CiAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkMiA9IGludGVyb3BSZXF1aXJlRGVmYXVsdC5leHBvcnRzOwogIHZhciBfcmVnZW5lcmF0b3IkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkMihyZWdlbmVyYXRvcik7CiAgdmFyIF9hc3luY1RvR2VuZXJhdG9yMiQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQyKGFzeW5jVG9HZW5lcmF0b3IuZXhwb3J0cyk7CiAgdmFyIF9jbGFzc0NhbGxDaGVjazIkMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkMihjbGFzc0NhbGxDaGVjay5leHBvcnRzKTsKICB2YXIgX2NyZWF0ZUNsYXNzMiQyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQyKGNyZWF0ZUNsYXNzLmV4cG9ydHMpOwogIHZhciBmcyA9IHJlcXVpcmUkJDU7CiAgdmFyIExvY2FsRmlsZSQyID0gLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gTG9jYWxGaWxlMihwYXRoKSB7CiAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syJDIuZGVmYXVsdCkodGhpcywgTG9jYWxGaWxlMik7CiAgICAgIHRoaXMuZmRQcm9taXNlID0gZnMub3BlbihwYXRoLCAiciIpOwogICAgICB0aGlzLnBhdGggPSBwYXRoOwogICAgfQogICAgKDAsIF9jcmVhdGVDbGFzczIkMi5kZWZhdWx0KShMb2NhbEZpbGUyLCBbeyBrZXk6ICJyZWFkIiwgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgX3JlYWQgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyJDIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvciQyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKGJ1Ziwgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uKSB7CiAgICAgICAgdmFyIGZkLCByZXQ7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvciQyLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmRQcm9taXNlOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGZkID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuIGZzLnJlYWQoZmQsIGJ1Ziwgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uKTsKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICByZXQgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgcmV0KTsKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgfSkpOwogICAgICBmdW5jdGlvbiByZWFkKF94LCBfeDIsIF94MywgX3g0KSB7CiAgICAgICAgcmV0dXJuIF9yZWFkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlYWQ7CiAgICB9KCkgfSwgeyBrZXk6ICJzdGF0IiwgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgX3N0YXQgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyJDIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvciQyLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgZmQ7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvciQyLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mZFByb21pc2U7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgZmQgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBmcy5mc3RhdChmZCkpOwogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgIH0pKTsKICAgICAgZnVuY3Rpb24gc3RhdCgpIHsKICAgICAgICByZXR1cm4gX3N0YXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgICByZXR1cm4gc3RhdDsKICAgIH0oKSB9XSk7CiAgICByZXR1cm4gTG9jYWxGaWxlMjsKICB9KCk7CiAgdmFyIGxvY2FsRmlsZSA9IExvY2FsRmlsZSQyOwogIHZhciBsb25nID0gTG9uZyQxOwogIHZhciB3YXNtID0gbnVsbDsKICB0cnkgewogICAgd2FzbSA9IG5ldyBXZWJBc3NlbWJseS5JbnN0YW5jZShuZXcgV2ViQXNzZW1ibHkuTW9kdWxlKG5ldyBVaW50OEFycmF5KFsKICAgICAgMCwKICAgICAgOTcsCiAgICAgIDExNSwKICAgICAgMTA5LAogICAgICAxLAogICAgICAwLAogICAgICAwLAogICAgICAwLAogICAgICAxLAogICAgICAxMywKICAgICAgMiwKICAgICAgOTYsCiAgICAgIDAsCiAgICAgIDEsCiAgICAgIDEyNywKICAgICAgOTYsCiAgICAgIDQsCiAgICAgIDEyNywKICAgICAgMTI3LAogICAgICAxMjcsCiAgICAgIDEyNywKICAgICAgMSwKICAgICAgMTI3LAogICAgICAzLAogICAgICA3LAogICAgICA2LAogICAgICAwLAogICAgICAxLAogICAgICAxLAogICAgICAxLAogICAgICAxLAogICAgICAxLAogICAgICA2LAogICAgICA2LAogICAgICAxLAogICAgICAxMjcsCiAgICAgIDEsCiAgICAgIDY1LAogICAgICAwLAogICAgICAxMSwKICAgICAgNywKICAgICAgNTAsCiAgICAgIDYsCiAgICAgIDMsCiAgICAgIDEwOSwKICAgICAgMTE3LAogICAgICAxMDgsCiAgICAgIDAsCiAgICAgIDEsCiAgICAgIDUsCiAgICAgIDEwMCwKICAgICAgMTA1LAogICAgICAxMTgsCiAgICAgIDk1LAogICAgICAxMTUsCiAgICAgIDAsCiAgICAgIDIsCiAgICAgIDUsCiAgICAgIDEwMCwKICAgICAgMTA1LAogICAgICAxMTgsCiAgICAgIDk1LAogICAgICAxMTcsCiAgICAgIDAsCiAgICAgIDMsCiAgICAgIDUsCiAgICAgIDExNCwKICAgICAgMTAxLAogICAgICAxMDksCiAgICAgIDk1LAogICAgICAxMTUsCiAgICAgIDAsCiAgICAgIDQsCiAgICAgIDUsCiAgICAgIDExNCwKICAgICAgMTAxLAogICAgICAxMDksCiAgICAgIDk1LAogICAgICAxMTcsCiAgICAgIDAsCiAgICAgIDUsCiAgICAgIDgsCiAgICAgIDEwMywKICAgICAgMTAxLAogICAgICAxMTYsCiAgICAgIDk1LAogICAgICAxMDQsCiAgICAgIDEwNSwKICAgICAgMTAzLAogICAgICAxMDQsCiAgICAgIDAsCiAgICAgIDAsCiAgICAgIDEwLAogICAgICAxOTEsCiAgICAgIDEsCiAgICAgIDYsCiAgICAgIDQsCiAgICAgIDAsCiAgICAgIDM1LAogICAgICAwLAogICAgICAxMSwKICAgICAgMzYsCiAgICAgIDEsCiAgICAgIDEsCiAgICAgIDEyNiwKICAgICAgMzIsCiAgICAgIDAsCiAgICAgIDE3MywKICAgICAgMzIsCiAgICAgIDEsCiAgICAgIDE3MywKICAgICAgNjYsCiAgICAgIDMyLAogICAgICAxMzQsCiAgICAgIDEzMiwKICAgICAgMzIsCiAgICAgIDIsCiAgICAgIDE3MywKICAgICAgMzIsCiAgICAgIDMsCiAgICAgIDE3MywKICAgICAgNjYsCiAgICAgIDMyLAogICAgICAxMzQsCiAgICAgIDEzMiwKICAgICAgMTI2LAogICAgICAzNCwKICAgICAgNCwKICAgICAgNjYsCiAgICAgIDMyLAogICAgICAxMzUsCiAgICAgIDE2NywKICAgICAgMzYsCiAgICAgIDAsCiAgICAgIDMyLAogICAgICA0LAogICAgICAxNjcsCiAgICAgIDExLAogICAgICAzNiwKICAgICAgMSwKICAgICAgMSwKICAgICAgMTI2LAogICAgICAzMiwKICAgICAgMCwKICAgICAgMTczLAogICAgICAzMiwKICAgICAgMSwKICAgICAgMTczLAogICAgICA2NiwKICAgICAgMzIsCiAgICAgIDEzNCwKICAgICAgMTMyLAogICAgICAzMiwKICAgICAgMiwKICAgICAgMTczLAogICAgICAzMiwKICAgICAgMywKICAgICAgMTczLAogICAgICA2NiwKICAgICAgMzIsCiAgICAgIDEzNCwKICAgICAgMTMyLAogICAgICAxMjcsCiAgICAgIDM0LAogICAgICA0LAogICAgICA2NiwKICAgICAgMzIsCiAgICAgIDEzNSwKICAgICAgMTY3LAogICAgICAzNiwKICAgICAgMCwKICAgICAgMzIsCiAgICAgIDQsCiAgICAgIDE2NywKICAgICAgMTEsCiAgICAgIDM2LAogICAgICAxLAogICAgICAxLAogICAgICAxMjYsCiAgICAgIDMyLAogICAgICAwLAogICAgICAxNzMsCiAgICAgIDMyLAogICAgICAxLAogICAgICAxNzMsCiAgICAgIDY2LAogICAgICAzMiwKICAgICAgMTM0LAogICAgICAxMzIsCiAgICAgIDMyLAogICAgICAyLAogICAgICAxNzMsCiAgICAgIDMyLAogICAgICAzLAogICAgICAxNzMsCiAgICAgIDY2LAogICAgICAzMiwKICAgICAgMTM0LAogICAgICAxMzIsCiAgICAgIDEyOCwKICAgICAgMzQsCiAgICAgIDQsCiAgICAgIDY2LAogICAgICAzMiwKICAgICAgMTM1LAogICAgICAxNjcsCiAgICAgIDM2LAogICAgICAwLAogICAgICAzMiwKICAgICAgNCwKICAgICAgMTY3LAogICAgICAxMSwKICAgICAgMzYsCiAgICAgIDEsCiAgICAgIDEsCiAgICAgIDEyNiwKICAgICAgMzIsCiAgICAgIDAsCiAgICAgIDE3MywKICAgICAgMzIsCiAgICAgIDEsCiAgICAgIDE3MywKICAgICAgNjYsCiAgICAgIDMyLAogICAgICAxMzQsCiAgICAgIDEzMiwKICAgICAgMzIsCiAgICAgIDIsCiAgICAgIDE3MywKICAgICAgMzIsCiAgICAgIDMsCiAgICAgIDE3MywKICAgICAgNjYsCiAgICAgIDMyLAogICAgICAxMzQsCiAgICAgIDEzMiwKICAgICAgMTI5LAogICAgICAzNCwKICAgICAgNCwKICAgICAgNjYsCiAgICAgIDMyLAogICAgICAxMzUsCiAgICAgIDE2NywKICAgICAgMzYsCiAgICAgIDAsCiAgICAgIDMyLAogICAgICA0LAogICAgICAxNjcsCiAgICAgIDExLAogICAgICAzNiwKICAgICAgMSwKICAgICAgMSwKICAgICAgMTI2LAogICAgICAzMiwKICAgICAgMCwKICAgICAgMTczLAogICAgICAzMiwKICAgICAgMSwKICAgICAgMTczLAogICAgICA2NiwKICAgICAgMzIsCiAgICAgIDEzNCwKICAgICAgMTMyLAogICAgICAzMiwKICAgICAgMiwKICAgICAgMTczLAogICAgICAzMiwKICAgICAgMywKICAgICAgMTczLAogICAgICA2NiwKICAgICAgMzIsCiAgICAgIDEzNCwKICAgICAgMTMyLAogICAgICAxMzAsCiAgICAgIDM0LAogICAgICA0LAogICAgICA2NiwKICAgICAgMzIsCiAgICAgIDEzNSwKICAgICAgMTY3LAogICAgICAzNiwKICAgICAgMCwKICAgICAgMzIsCiAgICAgIDQsCiAgICAgIDE2NywKICAgICAgMTEKICAgIF0pKSwge30pLmV4cG9ydHM7CiAgfSBjYXRjaCAoZSkgewogIH0KICBmdW5jdGlvbiBMb25nJDEobG93LCBoaWdoLCB1bnNpZ25lZCkgewogICAgdGhpcy5sb3cgPSBsb3cgfCAwOwogICAgdGhpcy5oaWdoID0gaGlnaCB8IDA7CiAgICB0aGlzLnVuc2lnbmVkID0gISF1bnNpZ25lZDsKICB9CiAgTG9uZyQxLnByb3RvdHlwZS5fX2lzTG9uZ19fOwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShMb25nJDEucHJvdG90eXBlLCAiX19pc0xvbmdfXyIsIHsgdmFsdWU6IHRydWUgfSk7CiAgZnVuY3Rpb24gaXNMb25nKG9iaikgewogICAgcmV0dXJuIChvYmogJiYgb2JqWyJfX2lzTG9uZ19fIl0pID09PSB0cnVlOwogIH0KICBMb25nJDEuaXNMb25nID0gaXNMb25nOwogIHZhciBJTlRfQ0FDSEUgPSB7fTsKICB2YXIgVUlOVF9DQUNIRSA9IHt9OwogIGZ1bmN0aW9uIGZyb21JbnQodmFsdWUsIHVuc2lnbmVkKSB7CiAgICB2YXIgb2JqLCBjYWNoZWRPYmosIGNhY2hlOwogICAgaWYgKHVuc2lnbmVkKSB7CiAgICAgIHZhbHVlID4+Pj0gMDsKICAgICAgaWYgKGNhY2hlID0gMCA8PSB2YWx1ZSAmJiB2YWx1ZSA8IDI1NikgewogICAgICAgIGNhY2hlZE9iaiA9IFVJTlRfQ0FDSEVbdmFsdWVdOwogICAgICAgIGlmIChjYWNoZWRPYmopCiAgICAgICAgICByZXR1cm4gY2FjaGVkT2JqOwogICAgICB9CiAgICAgIG9iaiA9IGZyb21CaXRzKHZhbHVlLCAodmFsdWUgfCAwKSA8IDAgPyAtMSA6IDAsIHRydWUpOwogICAgICBpZiAoY2FjaGUpCiAgICAgICAgVUlOVF9DQUNIRVt2YWx1ZV0gPSBvYmo7CiAgICAgIHJldHVybiBvYmo7CiAgICB9IGVsc2UgewogICAgICB2YWx1ZSB8PSAwOwogICAgICBpZiAoY2FjaGUgPSAtMTI4IDw9IHZhbHVlICYmIHZhbHVlIDwgMTI4KSB7CiAgICAgICAgY2FjaGVkT2JqID0gSU5UX0NBQ0hFW3ZhbHVlXTsKICAgICAgICBpZiAoY2FjaGVkT2JqKQogICAgICAgICAgcmV0dXJuIGNhY2hlZE9iajsKICAgICAgfQogICAgICBvYmogPSBmcm9tQml0cyh2YWx1ZSwgdmFsdWUgPCAwID8gLTEgOiAwLCBmYWxzZSk7CiAgICAgIGlmIChjYWNoZSkKICAgICAgICBJTlRfQ0FDSEVbdmFsdWVdID0gb2JqOwogICAgICByZXR1cm4gb2JqOwogICAgfQogIH0KICBMb25nJDEuZnJvbUludCA9IGZyb21JbnQ7CiAgZnVuY3Rpb24gZnJvbU51bWJlcih2YWx1ZSwgdW5zaWduZWQpIHsKICAgIGlmIChpc05hTih2YWx1ZSkpCiAgICAgIHJldHVybiB1bnNpZ25lZCA/IFVaRVJPIDogWkVSTzsKICAgIGlmICh1bnNpZ25lZCkgewogICAgICBpZiAodmFsdWUgPCAwKQogICAgICAgIHJldHVybiBVWkVSTzsKICAgICAgaWYgKHZhbHVlID49IFRXT19QV1JfNjRfREJMKQogICAgICAgIHJldHVybiBNQVhfVU5TSUdORURfVkFMVUU7CiAgICB9IGVsc2UgewogICAgICBpZiAodmFsdWUgPD0gLVRXT19QV1JfNjNfREJMKQogICAgICAgIHJldHVybiBNSU5fVkFMVUU7CiAgICAgIGlmICh2YWx1ZSArIDEgPj0gVFdPX1BXUl82M19EQkwpCiAgICAgICAgcmV0dXJuIE1BWF9WQUxVRTsKICAgIH0KICAgIGlmICh2YWx1ZSA8IDApCiAgICAgIHJldHVybiBmcm9tTnVtYmVyKC12YWx1ZSwgdW5zaWduZWQpLm5lZygpOwogICAgcmV0dXJuIGZyb21CaXRzKHZhbHVlICUgVFdPX1BXUl8zMl9EQkwgfCAwLCB2YWx1ZSAvIFRXT19QV1JfMzJfREJMIHwgMCwgdW5zaWduZWQpOwogIH0KICBMb25nJDEuZnJvbU51bWJlciA9IGZyb21OdW1iZXI7CiAgZnVuY3Rpb24gZnJvbUJpdHMobG93Qml0cywgaGlnaEJpdHMsIHVuc2lnbmVkKSB7CiAgICByZXR1cm4gbmV3IExvbmckMShsb3dCaXRzLCBoaWdoQml0cywgdW5zaWduZWQpOwogIH0KICBMb25nJDEuZnJvbUJpdHMgPSBmcm9tQml0czsKICB2YXIgcG93X2RibCA9IE1hdGgucG93OwogIGZ1bmN0aW9uIGZyb21TdHJpbmcoc3RyLCB1bnNpZ25lZCwgcmFkaXgpIHsKICAgIGlmIChzdHIubGVuZ3RoID09PSAwKQogICAgICB0aHJvdyBFcnJvcigiZW1wdHkgc3RyaW5nIik7CiAgICBpZiAoc3RyID09PSAiTmFOIiB8fCBzdHIgPT09ICJJbmZpbml0eSIgfHwgc3RyID09PSAiK0luZmluaXR5IiB8fCBzdHIgPT09ICItSW5maW5pdHkiKQogICAgICByZXR1cm4gWkVSTzsKICAgIGlmICh0eXBlb2YgdW5zaWduZWQgPT09ICJudW1iZXIiKSB7CiAgICAgIHJhZGl4ID0gdW5zaWduZWQsIHVuc2lnbmVkID0gZmFsc2U7CiAgICB9IGVsc2UgewogICAgICB1bnNpZ25lZCA9ICEhdW5zaWduZWQ7CiAgICB9CiAgICByYWRpeCA9IHJhZGl4IHx8IDEwOwogICAgaWYgKHJhZGl4IDwgMiB8fCAzNiA8IHJhZGl4KQogICAgICB0aHJvdyBSYW5nZUVycm9yKCJyYWRpeCIpOwogICAgdmFyIHA7CiAgICBpZiAoKHAgPSBzdHIuaW5kZXhPZigiLSIpKSA+IDApCiAgICAgIHRocm93IEVycm9yKCJpbnRlcmlvciBoeXBoZW4iKTsKICAgIGVsc2UgaWYgKHAgPT09IDApIHsKICAgICAgcmV0dXJuIGZyb21TdHJpbmcoc3RyLnN1YnN0cmluZygxKSwgdW5zaWduZWQsIHJhZGl4KS5uZWcoKTsKICAgIH0KICAgIHZhciByYWRpeFRvUG93ZXIgPSBmcm9tTnVtYmVyKHBvd19kYmwocmFkaXgsIDgpKTsKICAgIHZhciByZXN1bHQgPSBaRVJPOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpICs9IDgpIHsKICAgICAgdmFyIHNpemUgPSBNYXRoLm1pbig4LCBzdHIubGVuZ3RoIC0gaSksIHZhbHVlID0gcGFyc2VJbnQoc3RyLnN1YnN0cmluZyhpLCBpICsgc2l6ZSksIHJhZGl4KTsKICAgICAgaWYgKHNpemUgPCA4KSB7CiAgICAgICAgdmFyIHBvd2VyID0gZnJvbU51bWJlcihwb3dfZGJsKHJhZGl4LCBzaXplKSk7CiAgICAgICAgcmVzdWx0ID0gcmVzdWx0Lm11bChwb3dlcikuYWRkKGZyb21OdW1iZXIodmFsdWUpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXN1bHQgPSByZXN1bHQubXVsKHJhZGl4VG9Qb3dlcik7CiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmFkZChmcm9tTnVtYmVyKHZhbHVlKSk7CiAgICAgIH0KICAgIH0KICAgIHJlc3VsdC51bnNpZ25lZCA9IHVuc2lnbmVkOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgTG9uZyQxLmZyb21TdHJpbmcgPSBmcm9tU3RyaW5nOwogIGZ1bmN0aW9uIGZyb21WYWx1ZSh2YWwsIHVuc2lnbmVkKSB7CiAgICBpZiAodHlwZW9mIHZhbCA9PT0gIm51bWJlciIpCiAgICAgIHJldHVybiBmcm9tTnVtYmVyKHZhbCwgdW5zaWduZWQpOwogICAgaWYgKHR5cGVvZiB2YWwgPT09ICJzdHJpbmciKQogICAgICByZXR1cm4gZnJvbVN0cmluZyh2YWwsIHVuc2lnbmVkKTsKICAgIHJldHVybiBmcm9tQml0cyh2YWwubG93LCB2YWwuaGlnaCwgdHlwZW9mIHVuc2lnbmVkID09PSAiYm9vbGVhbiIgPyB1bnNpZ25lZCA6IHZhbC51bnNpZ25lZCk7CiAgfQogIExvbmckMS5mcm9tVmFsdWUgPSBmcm9tVmFsdWU7CiAgdmFyIFRXT19QV1JfMTZfREJMID0gMSA8PCAxNjsKICB2YXIgVFdPX1BXUl8yNF9EQkwgPSAxIDw8IDI0OwogIHZhciBUV09fUFdSXzMyX0RCTCA9IFRXT19QV1JfMTZfREJMICogVFdPX1BXUl8xNl9EQkw7CiAgdmFyIFRXT19QV1JfNjRfREJMID0gVFdPX1BXUl8zMl9EQkwgKiBUV09fUFdSXzMyX0RCTDsKICB2YXIgVFdPX1BXUl82M19EQkwgPSBUV09fUFdSXzY0X0RCTCAvIDI7CiAgdmFyIFRXT19QV1JfMjQgPSBmcm9tSW50KFRXT19QV1JfMjRfREJMKTsKICB2YXIgWkVSTyA9IGZyb21JbnQoMCk7CiAgTG9uZyQxLlpFUk8gPSBaRVJPOwogIHZhciBVWkVSTyA9IGZyb21JbnQoMCwgdHJ1ZSk7CiAgTG9uZyQxLlVaRVJPID0gVVpFUk87CiAgdmFyIE9ORSA9IGZyb21JbnQoMSk7CiAgTG9uZyQxLk9ORSA9IE9ORTsKICB2YXIgVU9ORSA9IGZyb21JbnQoMSwgdHJ1ZSk7CiAgTG9uZyQxLlVPTkUgPSBVT05FOwogIHZhciBORUdfT05FID0gZnJvbUludCgtMSk7CiAgTG9uZyQxLk5FR19PTkUgPSBORUdfT05FOwogIHZhciBNQVhfVkFMVUUgPSBmcm9tQml0cyg0Mjk0OTY3Mjk1IHwgMCwgMjE0NzQ4MzY0NyB8IDAsIGZhbHNlKTsKICBMb25nJDEuTUFYX1ZBTFVFID0gTUFYX1ZBTFVFOwogIHZhciBNQVhfVU5TSUdORURfVkFMVUUgPSBmcm9tQml0cyg0Mjk0OTY3Mjk1IHwgMCwgNDI5NDk2NzI5NSB8IDAsIHRydWUpOwogIExvbmckMS5NQVhfVU5TSUdORURfVkFMVUUgPSBNQVhfVU5TSUdORURfVkFMVUU7CiAgdmFyIE1JTl9WQUxVRSA9IGZyb21CaXRzKDAsIDIxNDc0ODM2NDggfCAwLCBmYWxzZSk7CiAgTG9uZyQxLk1JTl9WQUxVRSA9IE1JTl9WQUxVRTsKICB2YXIgTG9uZ1Byb3RvdHlwZSA9IExvbmckMS5wcm90b3R5cGU7CiAgTG9uZ1Byb3RvdHlwZS50b0ludCA9IGZ1bmN0aW9uIHRvSW50KCkgewogICAgcmV0dXJuIHRoaXMudW5zaWduZWQgPyB0aGlzLmxvdyA+Pj4gMCA6IHRoaXMubG93OwogIH07CiAgTG9uZ1Byb3RvdHlwZS50b051bWJlciA9IGZ1bmN0aW9uIHRvTnVtYmVyMigpIHsKICAgIGlmICh0aGlzLnVuc2lnbmVkKQogICAgICByZXR1cm4gKHRoaXMuaGlnaCA+Pj4gMCkgKiBUV09fUFdSXzMyX0RCTCArICh0aGlzLmxvdyA+Pj4gMCk7CiAgICByZXR1cm4gdGhpcy5oaWdoICogVFdPX1BXUl8zMl9EQkwgKyAodGhpcy5sb3cgPj4+IDApOwogIH07CiAgTG9uZ1Byb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIHRvU3RyaW5nMihyYWRpeCkgewogICAgcmFkaXggPSByYWRpeCB8fCAxMDsKICAgIGlmIChyYWRpeCA8IDIgfHwgMzYgPCByYWRpeCkKICAgICAgdGhyb3cgUmFuZ2VFcnJvcigicmFkaXgiKTsKICAgIGlmICh0aGlzLmlzWmVybygpKQogICAgICByZXR1cm4gIjAiOwogICAgaWYgKHRoaXMuaXNOZWdhdGl2ZSgpKSB7CiAgICAgIGlmICh0aGlzLmVxKE1JTl9WQUxVRSkpIHsKICAgICAgICB2YXIgcmFkaXhMb25nID0gZnJvbU51bWJlcihyYWRpeCksIGRpdiA9IHRoaXMuZGl2KHJhZGl4TG9uZyksIHJlbTEgPSBkaXYubXVsKHJhZGl4TG9uZykuc3ViKHRoaXMpOwogICAgICAgIHJldHVybiBkaXYudG9TdHJpbmcocmFkaXgpICsgcmVtMS50b0ludCgpLnRvU3RyaW5nKHJhZGl4KTsKICAgICAgfSBlbHNlCiAgICAgICAgcmV0dXJuICItIiArIHRoaXMubmVnKCkudG9TdHJpbmcocmFkaXgpOwogICAgfQogICAgdmFyIHJhZGl4VG9Qb3dlciA9IGZyb21OdW1iZXIocG93X2RibChyYWRpeCwgNiksIHRoaXMudW5zaWduZWQpLCByZW0gPSB0aGlzOwogICAgdmFyIHJlc3VsdCA9ICIiOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgdmFyIHJlbURpdiA9IHJlbS5kaXYocmFkaXhUb1Bvd2VyKSwgaW50dmFsID0gcmVtLnN1YihyZW1EaXYubXVsKHJhZGl4VG9Qb3dlcikpLnRvSW50KCkgPj4+IDAsIGRpZ2l0cyA9IGludHZhbC50b1N0cmluZyhyYWRpeCk7CiAgICAgIHJlbSA9IHJlbURpdjsKICAgICAgaWYgKHJlbS5pc1plcm8oKSkKICAgICAgICByZXR1cm4gZGlnaXRzICsgcmVzdWx0OwogICAgICBlbHNlIHsKICAgICAgICB3aGlsZSAoZGlnaXRzLmxlbmd0aCA8IDYpCiAgICAgICAgICBkaWdpdHMgPSAiMCIgKyBkaWdpdHM7CiAgICAgICAgcmVzdWx0ID0gIiIgKyBkaWdpdHMgKyByZXN1bHQ7CiAgICAgIH0KICAgIH0KICB9OwogIExvbmdQcm90b3R5cGUuZ2V0SGlnaEJpdHMgPSBmdW5jdGlvbiBnZXRIaWdoQml0cygpIHsKICAgIHJldHVybiB0aGlzLmhpZ2g7CiAgfTsKICBMb25nUHJvdG90eXBlLmdldEhpZ2hCaXRzVW5zaWduZWQgPSBmdW5jdGlvbiBnZXRIaWdoQml0c1Vuc2lnbmVkKCkgewogICAgcmV0dXJuIHRoaXMuaGlnaCA+Pj4gMDsKICB9OwogIExvbmdQcm90b3R5cGUuZ2V0TG93Qml0cyA9IGZ1bmN0aW9uIGdldExvd0JpdHMoKSB7CiAgICByZXR1cm4gdGhpcy5sb3c7CiAgfTsKICBMb25nUHJvdG90eXBlLmdldExvd0JpdHNVbnNpZ25lZCA9IGZ1bmN0aW9uIGdldExvd0JpdHNVbnNpZ25lZCgpIHsKICAgIHJldHVybiB0aGlzLmxvdyA+Pj4gMDsKICB9OwogIExvbmdQcm90b3R5cGUuZ2V0TnVtQml0c0FicyA9IGZ1bmN0aW9uIGdldE51bUJpdHNBYnMoKSB7CiAgICBpZiAodGhpcy5pc05lZ2F0aXZlKCkpCiAgICAgIHJldHVybiB0aGlzLmVxKE1JTl9WQUxVRSkgPyA2NCA6IHRoaXMubmVnKCkuZ2V0TnVtQml0c0FicygpOwogICAgdmFyIHZhbCA9IHRoaXMuaGlnaCAhPSAwID8gdGhpcy5oaWdoIDogdGhpcy5sb3c7CiAgICBmb3IgKHZhciBiaXQgPSAzMTsgYml0ID4gMDsgYml0LS0pCiAgICAgIGlmICgodmFsICYgMSA8PCBiaXQpICE9IDApCiAgICAgICAgYnJlYWs7CiAgICByZXR1cm4gdGhpcy5oaWdoICE9IDAgPyBiaXQgKyAzMyA6IGJpdCArIDE7CiAgfTsKICBMb25nUHJvdG90eXBlLmlzWmVybyA9IGZ1bmN0aW9uIGlzWmVybygpIHsKICAgIHJldHVybiB0aGlzLmhpZ2ggPT09IDAgJiYgdGhpcy5sb3cgPT09IDA7CiAgfTsKICBMb25nUHJvdG90eXBlLmVxeiA9IExvbmdQcm90b3R5cGUuaXNaZXJvOwogIExvbmdQcm90b3R5cGUuaXNOZWdhdGl2ZSA9IGZ1bmN0aW9uIGlzTmVnYXRpdmUoKSB7CiAgICByZXR1cm4gIXRoaXMudW5zaWduZWQgJiYgdGhpcy5oaWdoIDwgMDsKICB9OwogIExvbmdQcm90b3R5cGUuaXNQb3NpdGl2ZSA9IGZ1bmN0aW9uIGlzUG9zaXRpdmUoKSB7CiAgICByZXR1cm4gdGhpcy51bnNpZ25lZCB8fCB0aGlzLmhpZ2ggPj0gMDsKICB9OwogIExvbmdQcm90b3R5cGUuaXNPZGQgPSBmdW5jdGlvbiBpc09kZCgpIHsKICAgIHJldHVybiAodGhpcy5sb3cgJiAxKSA9PT0gMTsKICB9OwogIExvbmdQcm90b3R5cGUuaXNFdmVuID0gZnVuY3Rpb24gaXNFdmVuKCkgewogICAgcmV0dXJuICh0aGlzLmxvdyAmIDEpID09PSAwOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiBlcXVhbHMob3RoZXIpIHsKICAgIGlmICghaXNMb25nKG90aGVyKSkKICAgICAgb3RoZXIgPSBmcm9tVmFsdWUob3RoZXIpOwogICAgaWYgKHRoaXMudW5zaWduZWQgIT09IG90aGVyLnVuc2lnbmVkICYmIHRoaXMuaGlnaCA+Pj4gMzEgPT09IDEgJiYgb3RoZXIuaGlnaCA+Pj4gMzEgPT09IDEpCiAgICAgIHJldHVybiBmYWxzZTsKICAgIHJldHVybiB0aGlzLmhpZ2ggPT09IG90aGVyLmhpZ2ggJiYgdGhpcy5sb3cgPT09IG90aGVyLmxvdzsKICB9OwogIExvbmdQcm90b3R5cGUuZXEgPSBMb25nUHJvdG90eXBlLmVxdWFsczsKICBMb25nUHJvdG90eXBlLm5vdEVxdWFscyA9IGZ1bmN0aW9uIG5vdEVxdWFscyhvdGhlcikgewogICAgcmV0dXJuICF0aGlzLmVxKG90aGVyKTsKICB9OwogIExvbmdQcm90b3R5cGUubmVxID0gTG9uZ1Byb3RvdHlwZS5ub3RFcXVhbHM7CiAgTG9uZ1Byb3RvdHlwZS5uZSA9IExvbmdQcm90b3R5cGUubm90RXF1YWxzOwogIExvbmdQcm90b3R5cGUubGVzc1RoYW4gPSBmdW5jdGlvbiBsZXNzVGhhbihvdGhlcikgewogICAgcmV0dXJuIHRoaXMuY29tcChvdGhlcikgPCAwOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5sdCA9IExvbmdQcm90b3R5cGUubGVzc1RoYW47CiAgTG9uZ1Byb3RvdHlwZS5sZXNzVGhhbk9yRXF1YWwgPSBmdW5jdGlvbiBsZXNzVGhhbk9yRXF1YWwob3RoZXIpIHsKICAgIHJldHVybiB0aGlzLmNvbXAob3RoZXIpIDw9IDA7CiAgfTsKICBMb25nUHJvdG90eXBlLmx0ZSA9IExvbmdQcm90b3R5cGUubGVzc1RoYW5PckVxdWFsOwogIExvbmdQcm90b3R5cGUubGUgPSBMb25nUHJvdG90eXBlLmxlc3NUaGFuT3JFcXVhbDsKICBMb25nUHJvdG90eXBlLmdyZWF0ZXJUaGFuID0gZnVuY3Rpb24gZ3JlYXRlclRoYW4ob3RoZXIpIHsKICAgIHJldHVybiB0aGlzLmNvbXAob3RoZXIpID4gMDsKICB9OwogIExvbmdQcm90b3R5cGUuZ3QgPSBMb25nUHJvdG90eXBlLmdyZWF0ZXJUaGFuOwogIExvbmdQcm90b3R5cGUuZ3JlYXRlclRoYW5PckVxdWFsID0gZnVuY3Rpb24gZ3JlYXRlclRoYW5PckVxdWFsKG90aGVyKSB7CiAgICByZXR1cm4gdGhpcy5jb21wKG90aGVyKSA+PSAwOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5ndGUgPSBMb25nUHJvdG90eXBlLmdyZWF0ZXJUaGFuT3JFcXVhbDsKICBMb25nUHJvdG90eXBlLmdlID0gTG9uZ1Byb3RvdHlwZS5ncmVhdGVyVGhhbk9yRXF1YWw7CiAgTG9uZ1Byb3RvdHlwZS5jb21wYXJlID0gZnVuY3Rpb24gY29tcGFyZShvdGhlcikgewogICAgaWYgKCFpc0xvbmcob3RoZXIpKQogICAgICBvdGhlciA9IGZyb21WYWx1ZShvdGhlcik7CiAgICBpZiAodGhpcy5lcShvdGhlcikpCiAgICAgIHJldHVybiAwOwogICAgdmFyIHRoaXNOZWcgPSB0aGlzLmlzTmVnYXRpdmUoKSwgb3RoZXJOZWcgPSBvdGhlci5pc05lZ2F0aXZlKCk7CiAgICBpZiAodGhpc05lZyAmJiAhb3RoZXJOZWcpCiAgICAgIHJldHVybiAtMTsKICAgIGlmICghdGhpc05lZyAmJiBvdGhlck5lZykKICAgICAgcmV0dXJuIDE7CiAgICBpZiAoIXRoaXMudW5zaWduZWQpCiAgICAgIHJldHVybiB0aGlzLnN1YihvdGhlcikuaXNOZWdhdGl2ZSgpID8gLTEgOiAxOwogICAgcmV0dXJuIG90aGVyLmhpZ2ggPj4+IDAgPiB0aGlzLmhpZ2ggPj4+IDAgfHwgb3RoZXIuaGlnaCA9PT0gdGhpcy5oaWdoICYmIG90aGVyLmxvdyA+Pj4gMCA+IHRoaXMubG93ID4+PiAwID8gLTEgOiAxOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5jb21wID0gTG9uZ1Byb3RvdHlwZS5jb21wYXJlOwogIExvbmdQcm90b3R5cGUubmVnYXRlID0gZnVuY3Rpb24gbmVnYXRlKCkgewogICAgaWYgKCF0aGlzLnVuc2lnbmVkICYmIHRoaXMuZXEoTUlOX1ZBTFVFKSkKICAgICAgcmV0dXJuIE1JTl9WQUxVRTsKICAgIHJldHVybiB0aGlzLm5vdCgpLmFkZChPTkUpOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5uZWcgPSBMb25nUHJvdG90eXBlLm5lZ2F0ZTsKICBMb25nUHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIGFkZChhZGRlbmQpIHsKICAgIGlmICghaXNMb25nKGFkZGVuZCkpCiAgICAgIGFkZGVuZCA9IGZyb21WYWx1ZShhZGRlbmQpOwogICAgdmFyIGE0OCA9IHRoaXMuaGlnaCA+Pj4gMTY7CiAgICB2YXIgYTMyID0gdGhpcy5oaWdoICYgNjU1MzU7CiAgICB2YXIgYTE2ID0gdGhpcy5sb3cgPj4+IDE2OwogICAgdmFyIGEwMCA9IHRoaXMubG93ICYgNjU1MzU7CiAgICB2YXIgYjQ4ID0gYWRkZW5kLmhpZ2ggPj4+IDE2OwogICAgdmFyIGIzMiA9IGFkZGVuZC5oaWdoICYgNjU1MzU7CiAgICB2YXIgYjE2ID0gYWRkZW5kLmxvdyA+Pj4gMTY7CiAgICB2YXIgYjAwID0gYWRkZW5kLmxvdyAmIDY1NTM1OwogICAgdmFyIGM0OCA9IDAsIGMzMiA9IDAsIGMxNiA9IDAsIGMwMCA9IDA7CiAgICBjMDAgKz0gYTAwICsgYjAwOwogICAgYzE2ICs9IGMwMCA+Pj4gMTY7CiAgICBjMDAgJj0gNjU1MzU7CiAgICBjMTYgKz0gYTE2ICsgYjE2OwogICAgYzMyICs9IGMxNiA+Pj4gMTY7CiAgICBjMTYgJj0gNjU1MzU7CiAgICBjMzIgKz0gYTMyICsgYjMyOwogICAgYzQ4ICs9IGMzMiA+Pj4gMTY7CiAgICBjMzIgJj0gNjU1MzU7CiAgICBjNDggKz0gYTQ4ICsgYjQ4OwogICAgYzQ4ICY9IDY1NTM1OwogICAgcmV0dXJuIGZyb21CaXRzKGMxNiA8PCAxNiB8IGMwMCwgYzQ4IDw8IDE2IHwgYzMyLCB0aGlzLnVuc2lnbmVkKTsKICB9OwogIExvbmdQcm90b3R5cGUuc3VidHJhY3QgPSBmdW5jdGlvbiBzdWJ0cmFjdChzdWJ0cmFoZW5kKSB7CiAgICBpZiAoIWlzTG9uZyhzdWJ0cmFoZW5kKSkKICAgICAgc3VidHJhaGVuZCA9IGZyb21WYWx1ZShzdWJ0cmFoZW5kKTsKICAgIHJldHVybiB0aGlzLmFkZChzdWJ0cmFoZW5kLm5lZygpKTsKICB9OwogIExvbmdQcm90b3R5cGUuc3ViID0gTG9uZ1Byb3RvdHlwZS5zdWJ0cmFjdDsKICBMb25nUHJvdG90eXBlLm11bHRpcGx5ID0gZnVuY3Rpb24gbXVsdGlwbHkobXVsdGlwbGllcikgewogICAgaWYgKHRoaXMuaXNaZXJvKCkpCiAgICAgIHJldHVybiBaRVJPOwogICAgaWYgKCFpc0xvbmcobXVsdGlwbGllcikpCiAgICAgIG11bHRpcGxpZXIgPSBmcm9tVmFsdWUobXVsdGlwbGllcik7CiAgICBpZiAod2FzbSkgewogICAgICB2YXIgbG93ID0gd2FzbS5tdWwodGhpcy5sb3csIHRoaXMuaGlnaCwgbXVsdGlwbGllci5sb3csIG11bHRpcGxpZXIuaGlnaCk7CiAgICAgIHJldHVybiBmcm9tQml0cyhsb3csIHdhc20uZ2V0X2hpZ2goKSwgdGhpcy51bnNpZ25lZCk7CiAgICB9CiAgICBpZiAobXVsdGlwbGllci5pc1plcm8oKSkKICAgICAgcmV0dXJuIFpFUk87CiAgICBpZiAodGhpcy5lcShNSU5fVkFMVUUpKQogICAgICByZXR1cm4gbXVsdGlwbGllci5pc09kZCgpID8gTUlOX1ZBTFVFIDogWkVSTzsKICAgIGlmIChtdWx0aXBsaWVyLmVxKE1JTl9WQUxVRSkpCiAgICAgIHJldHVybiB0aGlzLmlzT2RkKCkgPyBNSU5fVkFMVUUgOiBaRVJPOwogICAgaWYgKHRoaXMuaXNOZWdhdGl2ZSgpKSB7CiAgICAgIGlmIChtdWx0aXBsaWVyLmlzTmVnYXRpdmUoKSkKICAgICAgICByZXR1cm4gdGhpcy5uZWcoKS5tdWwobXVsdGlwbGllci5uZWcoKSk7CiAgICAgIGVsc2UKICAgICAgICByZXR1cm4gdGhpcy5uZWcoKS5tdWwobXVsdGlwbGllcikubmVnKCk7CiAgICB9IGVsc2UgaWYgKG11bHRpcGxpZXIuaXNOZWdhdGl2ZSgpKQogICAgICByZXR1cm4gdGhpcy5tdWwobXVsdGlwbGllci5uZWcoKSkubmVnKCk7CiAgICBpZiAodGhpcy5sdChUV09fUFdSXzI0KSAmJiBtdWx0aXBsaWVyLmx0KFRXT19QV1JfMjQpKQogICAgICByZXR1cm4gZnJvbU51bWJlcih0aGlzLnRvTnVtYmVyKCkgKiBtdWx0aXBsaWVyLnRvTnVtYmVyKCksIHRoaXMudW5zaWduZWQpOwogICAgdmFyIGE0OCA9IHRoaXMuaGlnaCA+Pj4gMTY7CiAgICB2YXIgYTMyID0gdGhpcy5oaWdoICYgNjU1MzU7CiAgICB2YXIgYTE2ID0gdGhpcy5sb3cgPj4+IDE2OwogICAgdmFyIGEwMCA9IHRoaXMubG93ICYgNjU1MzU7CiAgICB2YXIgYjQ4ID0gbXVsdGlwbGllci5oaWdoID4+PiAxNjsKICAgIHZhciBiMzIgPSBtdWx0aXBsaWVyLmhpZ2ggJiA2NTUzNTsKICAgIHZhciBiMTYgPSBtdWx0aXBsaWVyLmxvdyA+Pj4gMTY7CiAgICB2YXIgYjAwID0gbXVsdGlwbGllci5sb3cgJiA2NTUzNTsKICAgIHZhciBjNDggPSAwLCBjMzIgPSAwLCBjMTYgPSAwLCBjMDAgPSAwOwogICAgYzAwICs9IGEwMCAqIGIwMDsKICAgIGMxNiArPSBjMDAgPj4+IDE2OwogICAgYzAwICY9IDY1NTM1OwogICAgYzE2ICs9IGExNiAqIGIwMDsKICAgIGMzMiArPSBjMTYgPj4+IDE2OwogICAgYzE2ICY9IDY1NTM1OwogICAgYzE2ICs9IGEwMCAqIGIxNjsKICAgIGMzMiArPSBjMTYgPj4+IDE2OwogICAgYzE2ICY9IDY1NTM1OwogICAgYzMyICs9IGEzMiAqIGIwMDsKICAgIGM0OCArPSBjMzIgPj4+IDE2OwogICAgYzMyICY9IDY1NTM1OwogICAgYzMyICs9IGExNiAqIGIxNjsKICAgIGM0OCArPSBjMzIgPj4+IDE2OwogICAgYzMyICY9IDY1NTM1OwogICAgYzMyICs9IGEwMCAqIGIzMjsKICAgIGM0OCArPSBjMzIgPj4+IDE2OwogICAgYzMyICY9IDY1NTM1OwogICAgYzQ4ICs9IGE0OCAqIGIwMCArIGEzMiAqIGIxNiArIGExNiAqIGIzMiArIGEwMCAqIGI0ODsKICAgIGM0OCAmPSA2NTUzNTsKICAgIHJldHVybiBmcm9tQml0cyhjMTYgPDwgMTYgfCBjMDAsIGM0OCA8PCAxNiB8IGMzMiwgdGhpcy51bnNpZ25lZCk7CiAgfTsKICBMb25nUHJvdG90eXBlLm11bCA9IExvbmdQcm90b3R5cGUubXVsdGlwbHk7CiAgTG9uZ1Byb3RvdHlwZS5kaXZpZGUgPSBmdW5jdGlvbiBkaXZpZGUoZGl2aXNvcikgewogICAgaWYgKCFpc0xvbmcoZGl2aXNvcikpCiAgICAgIGRpdmlzb3IgPSBmcm9tVmFsdWUoZGl2aXNvcik7CiAgICBpZiAoZGl2aXNvci5pc1plcm8oKSkKICAgICAgdGhyb3cgRXJyb3IoImRpdmlzaW9uIGJ5IHplcm8iKTsKICAgIGlmICh3YXNtKSB7CiAgICAgIGlmICghdGhpcy51bnNpZ25lZCAmJiB0aGlzLmhpZ2ggPT09IC0yMTQ3NDgzNjQ4ICYmIGRpdmlzb3IubG93ID09PSAtMSAmJiBkaXZpc29yLmhpZ2ggPT09IC0xKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgdmFyIGxvdyA9ICh0aGlzLnVuc2lnbmVkID8gd2FzbS5kaXZfdSA6IHdhc20uZGl2X3MpKHRoaXMubG93LCB0aGlzLmhpZ2gsIGRpdmlzb3IubG93LCBkaXZpc29yLmhpZ2gpOwogICAgICByZXR1cm4gZnJvbUJpdHMobG93LCB3YXNtLmdldF9oaWdoKCksIHRoaXMudW5zaWduZWQpOwogICAgfQogICAgaWYgKHRoaXMuaXNaZXJvKCkpCiAgICAgIHJldHVybiB0aGlzLnVuc2lnbmVkID8gVVpFUk8gOiBaRVJPOwogICAgdmFyIGFwcHJveCwgcmVtLCByZXM7CiAgICBpZiAoIXRoaXMudW5zaWduZWQpIHsKICAgICAgaWYgKHRoaXMuZXEoTUlOX1ZBTFVFKSkgewogICAgICAgIGlmIChkaXZpc29yLmVxKE9ORSkgfHwgZGl2aXNvci5lcShORUdfT05FKSkKICAgICAgICAgIHJldHVybiBNSU5fVkFMVUU7CiAgICAgICAgZWxzZSBpZiAoZGl2aXNvci5lcShNSU5fVkFMVUUpKQogICAgICAgICAgcmV0dXJuIE9ORTsKICAgICAgICBlbHNlIHsKICAgICAgICAgIHZhciBoYWxmVGhpcyA9IHRoaXMuc2hyKDEpOwogICAgICAgICAgYXBwcm94ID0gaGFsZlRoaXMuZGl2KGRpdmlzb3IpLnNobCgxKTsKICAgICAgICAgIGlmIChhcHByb3guZXEoWkVSTykpIHsKICAgICAgICAgICAgcmV0dXJuIGRpdmlzb3IuaXNOZWdhdGl2ZSgpID8gT05FIDogTkVHX09ORTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlbSA9IHRoaXMuc3ViKGRpdmlzb3IubXVsKGFwcHJveCkpOwogICAgICAgICAgICByZXMgPSBhcHByb3guYWRkKHJlbS5kaXYoZGl2aXNvcikpOwogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChkaXZpc29yLmVxKE1JTl9WQUxVRSkpCiAgICAgICAgcmV0dXJuIHRoaXMudW5zaWduZWQgPyBVWkVSTyA6IFpFUk87CiAgICAgIGlmICh0aGlzLmlzTmVnYXRpdmUoKSkgewogICAgICAgIGlmIChkaXZpc29yLmlzTmVnYXRpdmUoKSkKICAgICAgICAgIHJldHVybiB0aGlzLm5lZygpLmRpdihkaXZpc29yLm5lZygpKTsKICAgICAgICByZXR1cm4gdGhpcy5uZWcoKS5kaXYoZGl2aXNvcikubmVnKCk7CiAgICAgIH0gZWxzZSBpZiAoZGl2aXNvci5pc05lZ2F0aXZlKCkpCiAgICAgICAgcmV0dXJuIHRoaXMuZGl2KGRpdmlzb3IubmVnKCkpLm5lZygpOwogICAgICByZXMgPSBaRVJPOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCFkaXZpc29yLnVuc2lnbmVkKQogICAgICAgIGRpdmlzb3IgPSBkaXZpc29yLnRvVW5zaWduZWQoKTsKICAgICAgaWYgKGRpdmlzb3IuZ3QodGhpcykpCiAgICAgICAgcmV0dXJuIFVaRVJPOwogICAgICBpZiAoZGl2aXNvci5ndCh0aGlzLnNocnUoMSkpKQogICAgICAgIHJldHVybiBVT05FOwogICAgICByZXMgPSBVWkVSTzsKICAgIH0KICAgIHJlbSA9IHRoaXM7CiAgICB3aGlsZSAocmVtLmd0ZShkaXZpc29yKSkgewogICAgICBhcHByb3ggPSBNYXRoLm1heCgxLCBNYXRoLmZsb29yKHJlbS50b051bWJlcigpIC8gZGl2aXNvci50b051bWJlcigpKSk7CiAgICAgIHZhciBsb2cyID0gTWF0aC5jZWlsKE1hdGgubG9nKGFwcHJveCkgLyBNYXRoLkxOMiksIGRlbHRhID0gbG9nMiA8PSA0OCA/IDEgOiBwb3dfZGJsKDIsIGxvZzIgLSA0OCksIGFwcHJveFJlcyA9IGZyb21OdW1iZXIoYXBwcm94KSwgYXBwcm94UmVtID0gYXBwcm94UmVzLm11bChkaXZpc29yKTsKICAgICAgd2hpbGUgKGFwcHJveFJlbS5pc05lZ2F0aXZlKCkgfHwgYXBwcm94UmVtLmd0KHJlbSkpIHsKICAgICAgICBhcHByb3ggLT0gZGVsdGE7CiAgICAgICAgYXBwcm94UmVzID0gZnJvbU51bWJlcihhcHByb3gsIHRoaXMudW5zaWduZWQpOwogICAgICAgIGFwcHJveFJlbSA9IGFwcHJveFJlcy5tdWwoZGl2aXNvcik7CiAgICAgIH0KICAgICAgaWYgKGFwcHJveFJlcy5pc1plcm8oKSkKICAgICAgICBhcHByb3hSZXMgPSBPTkU7CiAgICAgIHJlcyA9IHJlcy5hZGQoYXBwcm94UmVzKTsKICAgICAgcmVtID0gcmVtLnN1YihhcHByb3hSZW0pOwogICAgfQogICAgcmV0dXJuIHJlczsKICB9OwogIExvbmdQcm90b3R5cGUuZGl2ID0gTG9uZ1Byb3RvdHlwZS5kaXZpZGU7CiAgTG9uZ1Byb3RvdHlwZS5tb2R1bG8gPSBmdW5jdGlvbiBtb2R1bG8oZGl2aXNvcikgewogICAgaWYgKCFpc0xvbmcoZGl2aXNvcikpCiAgICAgIGRpdmlzb3IgPSBmcm9tVmFsdWUoZGl2aXNvcik7CiAgICBpZiAod2FzbSkgewogICAgICB2YXIgbG93ID0gKHRoaXMudW5zaWduZWQgPyB3YXNtLnJlbV91IDogd2FzbS5yZW1fcykodGhpcy5sb3csIHRoaXMuaGlnaCwgZGl2aXNvci5sb3csIGRpdmlzb3IuaGlnaCk7CiAgICAgIHJldHVybiBmcm9tQml0cyhsb3csIHdhc20uZ2V0X2hpZ2goKSwgdGhpcy51bnNpZ25lZCk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5zdWIodGhpcy5kaXYoZGl2aXNvcikubXVsKGRpdmlzb3IpKTsKICB9OwogIExvbmdQcm90b3R5cGUubW9kID0gTG9uZ1Byb3RvdHlwZS5tb2R1bG87CiAgTG9uZ1Byb3RvdHlwZS5yZW0gPSBMb25nUHJvdG90eXBlLm1vZHVsbzsKICBMb25nUHJvdG90eXBlLm5vdCA9IGZ1bmN0aW9uIG5vdCgpIHsKICAgIHJldHVybiBmcm9tQml0cyh+dGhpcy5sb3csIH50aGlzLmhpZ2gsIHRoaXMudW5zaWduZWQpOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5hbmQgPSBmdW5jdGlvbiBhbmQob3RoZXIpIHsKICAgIGlmICghaXNMb25nKG90aGVyKSkKICAgICAgb3RoZXIgPSBmcm9tVmFsdWUob3RoZXIpOwogICAgcmV0dXJuIGZyb21CaXRzKHRoaXMubG93ICYgb3RoZXIubG93LCB0aGlzLmhpZ2ggJiBvdGhlci5oaWdoLCB0aGlzLnVuc2lnbmVkKTsKICB9OwogIExvbmdQcm90b3R5cGUub3IgPSBmdW5jdGlvbiBvcihvdGhlcikgewogICAgaWYgKCFpc0xvbmcob3RoZXIpKQogICAgICBvdGhlciA9IGZyb21WYWx1ZShvdGhlcik7CiAgICByZXR1cm4gZnJvbUJpdHModGhpcy5sb3cgfCBvdGhlci5sb3csIHRoaXMuaGlnaCB8IG90aGVyLmhpZ2gsIHRoaXMudW5zaWduZWQpOwogIH07CiAgTG9uZ1Byb3RvdHlwZS54b3IgPSBmdW5jdGlvbiB4b3Iob3RoZXIpIHsKICAgIGlmICghaXNMb25nKG90aGVyKSkKICAgICAgb3RoZXIgPSBmcm9tVmFsdWUob3RoZXIpOwogICAgcmV0dXJuIGZyb21CaXRzKHRoaXMubG93IF4gb3RoZXIubG93LCB0aGlzLmhpZ2ggXiBvdGhlci5oaWdoLCB0aGlzLnVuc2lnbmVkKTsKICB9OwogIExvbmdQcm90b3R5cGUuc2hpZnRMZWZ0ID0gZnVuY3Rpb24gc2hpZnRMZWZ0KG51bUJpdHMpIHsKICAgIGlmIChpc0xvbmcobnVtQml0cykpCiAgICAgIG51bUJpdHMgPSBudW1CaXRzLnRvSW50KCk7CiAgICBpZiAoKG51bUJpdHMgJj0gNjMpID09PSAwKQogICAgICByZXR1cm4gdGhpczsKICAgIGVsc2UgaWYgKG51bUJpdHMgPCAzMikKICAgICAgcmV0dXJuIGZyb21CaXRzKHRoaXMubG93IDw8IG51bUJpdHMsIHRoaXMuaGlnaCA8PCBudW1CaXRzIHwgdGhpcy5sb3cgPj4+IDMyIC0gbnVtQml0cywgdGhpcy51bnNpZ25lZCk7CiAgICBlbHNlCiAgICAgIHJldHVybiBmcm9tQml0cygwLCB0aGlzLmxvdyA8PCBudW1CaXRzIC0gMzIsIHRoaXMudW5zaWduZWQpOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5zaGwgPSBMb25nUHJvdG90eXBlLnNoaWZ0TGVmdDsKICBMb25nUHJvdG90eXBlLnNoaWZ0UmlnaHQgPSBmdW5jdGlvbiBzaGlmdFJpZ2h0KG51bUJpdHMpIHsKICAgIGlmIChpc0xvbmcobnVtQml0cykpCiAgICAgIG51bUJpdHMgPSBudW1CaXRzLnRvSW50KCk7CiAgICBpZiAoKG51bUJpdHMgJj0gNjMpID09PSAwKQogICAgICByZXR1cm4gdGhpczsKICAgIGVsc2UgaWYgKG51bUJpdHMgPCAzMikKICAgICAgcmV0dXJuIGZyb21CaXRzKHRoaXMubG93ID4+PiBudW1CaXRzIHwgdGhpcy5oaWdoIDw8IDMyIC0gbnVtQml0cywgdGhpcy5oaWdoID4+IG51bUJpdHMsIHRoaXMudW5zaWduZWQpOwogICAgZWxzZQogICAgICByZXR1cm4gZnJvbUJpdHModGhpcy5oaWdoID4+IG51bUJpdHMgLSAzMiwgdGhpcy5oaWdoID49IDAgPyAwIDogLTEsIHRoaXMudW5zaWduZWQpOwogIH07CiAgTG9uZ1Byb3RvdHlwZS5zaHIgPSBMb25nUHJvdG90eXBlLnNoaWZ0UmlnaHQ7CiAgTG9uZ1Byb3RvdHlwZS5zaGlmdFJpZ2h0VW5zaWduZWQgPSBmdW5jdGlvbiBzaGlmdFJpZ2h0VW5zaWduZWQobnVtQml0cykgewogICAgaWYgKGlzTG9uZyhudW1CaXRzKSkKICAgICAgbnVtQml0cyA9IG51bUJpdHMudG9JbnQoKTsKICAgIG51bUJpdHMgJj0gNjM7CiAgICBpZiAobnVtQml0cyA9PT0gMCkKICAgICAgcmV0dXJuIHRoaXM7CiAgICBlbHNlIHsKICAgICAgdmFyIGhpZ2ggPSB0aGlzLmhpZ2g7CiAgICAgIGlmIChudW1CaXRzIDwgMzIpIHsKICAgICAgICB2YXIgbG93ID0gdGhpcy5sb3c7CiAgICAgICAgcmV0dXJuIGZyb21CaXRzKGxvdyA+Pj4gbnVtQml0cyB8IGhpZ2ggPDwgMzIgLSBudW1CaXRzLCBoaWdoID4+PiBudW1CaXRzLCB0aGlzLnVuc2lnbmVkKTsKICAgICAgfSBlbHNlIGlmIChudW1CaXRzID09PSAzMikKICAgICAgICByZXR1cm4gZnJvbUJpdHMoaGlnaCwgMCwgdGhpcy51bnNpZ25lZCk7CiAgICAgIGVsc2UKICAgICAgICByZXR1cm4gZnJvbUJpdHMoaGlnaCA+Pj4gbnVtQml0cyAtIDMyLCAwLCB0aGlzLnVuc2lnbmVkKTsKICAgIH0KICB9OwogIExvbmdQcm90b3R5cGUuc2hydSA9IExvbmdQcm90b3R5cGUuc2hpZnRSaWdodFVuc2lnbmVkOwogIExvbmdQcm90b3R5cGUuc2hyX3UgPSBMb25nUHJvdG90eXBlLnNoaWZ0UmlnaHRVbnNpZ25lZDsKICBMb25nUHJvdG90eXBlLnRvU2lnbmVkID0gZnVuY3Rpb24gdG9TaWduZWQoKSB7CiAgICBpZiAoIXRoaXMudW5zaWduZWQpCiAgICAgIHJldHVybiB0aGlzOwogICAgcmV0dXJuIGZyb21CaXRzKHRoaXMubG93LCB0aGlzLmhpZ2gsIGZhbHNlKTsKICB9OwogIExvbmdQcm90b3R5cGUudG9VbnNpZ25lZCA9IGZ1bmN0aW9uIHRvVW5zaWduZWQoKSB7CiAgICBpZiAodGhpcy51bnNpZ25lZCkKICAgICAgcmV0dXJuIHRoaXM7CiAgICByZXR1cm4gZnJvbUJpdHModGhpcy5sb3csIHRoaXMuaGlnaCwgdHJ1ZSk7CiAgfTsKICBMb25nUHJvdG90eXBlLnRvQnl0ZXMgPSBmdW5jdGlvbiB0b0J5dGVzKGxlKSB7CiAgICByZXR1cm4gbGUgPyB0aGlzLnRvQnl0ZXNMRSgpIDogdGhpcy50b0J5dGVzQkUoKTsKICB9OwogIExvbmdQcm90b3R5cGUudG9CeXRlc0xFID0gZnVuY3Rpb24gdG9CeXRlc0xFKCkgewogICAgdmFyIGhpID0gdGhpcy5oaWdoLCBsbyA9IHRoaXMubG93OwogICAgcmV0dXJuIFsKICAgICAgbG8gJiAyNTUsCiAgICAgIGxvID4+PiA4ICYgMjU1LAogICAgICBsbyA+Pj4gMTYgJiAyNTUsCiAgICAgIGxvID4+PiAyNCwKICAgICAgaGkgJiAyNTUsCiAgICAgIGhpID4+PiA4ICYgMjU1LAogICAgICBoaSA+Pj4gMTYgJiAyNTUsCiAgICAgIGhpID4+PiAyNAogICAgXTsKICB9OwogIExvbmdQcm90b3R5cGUudG9CeXRlc0JFID0gZnVuY3Rpb24gdG9CeXRlc0JFKCkgewogICAgdmFyIGhpID0gdGhpcy5oaWdoLCBsbyA9IHRoaXMubG93OwogICAgcmV0dXJuIFsKICAgICAgaGkgPj4+IDI0LAogICAgICBoaSA+Pj4gMTYgJiAyNTUsCiAgICAgIGhpID4+PiA4ICYgMjU1LAogICAgICBoaSAmIDI1NSwKICAgICAgbG8gPj4+IDI0LAogICAgICBsbyA+Pj4gMTYgJiAyNTUsCiAgICAgIGxvID4+PiA4ICYgMjU1LAogICAgICBsbyAmIDI1NQogICAgXTsKICB9OwogIExvbmckMS5mcm9tQnl0ZXMgPSBmdW5jdGlvbiBmcm9tQnl0ZXMyKGJ5dGVzLCB1bnNpZ25lZCwgbGUpIHsKICAgIHJldHVybiBsZSA/IExvbmckMS5mcm9tQnl0ZXNMRShieXRlcywgdW5zaWduZWQpIDogTG9uZyQxLmZyb21CeXRlc0JFKGJ5dGVzLCB1bnNpZ25lZCk7CiAgfTsKICBMb25nJDEuZnJvbUJ5dGVzTEUgPSBmdW5jdGlvbiBmcm9tQnl0ZXNMRShieXRlcywgdW5zaWduZWQpIHsKICAgIHJldHVybiBuZXcgTG9uZyQxKGJ5dGVzWzBdIHwgYnl0ZXNbMV0gPDwgOCB8IGJ5dGVzWzJdIDw8IDE2IHwgYnl0ZXNbM10gPDwgMjQsIGJ5dGVzWzRdIHwgYnl0ZXNbNV0gPDwgOCB8IGJ5dGVzWzZdIDw8IDE2IHwgYnl0ZXNbN10gPDwgMjQsIHVuc2lnbmVkKTsKICB9OwogIExvbmckMS5mcm9tQnl0ZXNCRSA9IGZ1bmN0aW9uIGZyb21CeXRlc0JFKGJ5dGVzLCB1bnNpZ25lZCkgewogICAgcmV0dXJuIG5ldyBMb25nJDEoYnl0ZXNbNF0gPDwgMjQgfCBieXRlc1s1XSA8PCAxNiB8IGJ5dGVzWzZdIDw8IDggfCBieXRlc1s3XSwgYnl0ZXNbMF0gPDwgMjQgfCBieXRlc1sxXSA8PCAxNiB8IGJ5dGVzWzJdIDw8IDggfCBieXRlc1szXSwgdW5zaWduZWQpOwogIH07CiAgdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkMSA9IGludGVyb3BSZXF1aXJlRGVmYXVsdC5leHBvcnRzOwogIHZhciBfcmVnZW5lcmF0b3IkMSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkMShyZWdlbmVyYXRvcik7CiAgdmFyIF9hc3luY1RvR2VuZXJhdG9yMiQxID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQxKGFzeW5jVG9HZW5lcmF0b3IuZXhwb3J0cyk7CiAgdmFyIF9jbGFzc0NhbGxDaGVjazIkMSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQkMShjbGFzc0NhbGxDaGVjay5leHBvcnRzKTsKICB2YXIgX2NyZWF0ZUNsYXNzMiQxID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdCQxKGNyZWF0ZUNsYXNzLmV4cG9ydHMpOwogIHZhciBMb25nID0gbG9uZzsKICB2YXIgTG9jYWxGaWxlJDEgPSBsb2NhbEZpbGU7CiAgdmFyIFVOQ09NUFJFU1NFRF9QT1NJVElPTiA9IDE7CiAgdmFyIEd6aUluZGV4JDEgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBHemlJbmRleDIoX3JlZikgewogICAgICB2YXIgZmlsZWhhbmRsZTIgPSBfcmVmLmZpbGVoYW5kbGUsIHBhdGggPSBfcmVmLnBhdGg7CiAgICAgICgwLCBfY2xhc3NDYWxsQ2hlY2syJDEuZGVmYXVsdCkodGhpcywgR3ppSW5kZXgyKTsKICAgICAgaWYgKGZpbGVoYW5kbGUyKQogICAgICAgIHRoaXMuZmlsZWhhbmRsZSA9IGZpbGVoYW5kbGUyOwogICAgICBlbHNlIGlmIChwYXRoKQogICAgICAgIHRoaXMuZmlsZWhhbmRsZSA9IG5ldyBMb2NhbEZpbGUkMShwYXRoKTsKICAgICAgZWxzZQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImVpdGhlciBmaWxlaGFuZGxlIG9yIHBhdGggbXVzdCBiZSBkZWZpbmVkIik7CiAgICB9CiAgICAoMCwgX2NyZWF0ZUNsYXNzMiQxLmRlZmF1bHQpKEd6aUluZGV4MiwgW3sga2V5OiAiX3JlYWRMb25nV2l0aE92ZXJmbG93IiwgdmFsdWU6IGZ1bmN0aW9uIF9yZWFkTG9uZ1dpdGhPdmVyZmxvdyhidWYpIHsKICAgICAgdmFyIG9mZnNldCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdm9pZCAwID8gYXJndW1lbnRzWzFdIDogMDsKICAgICAgdmFyIHVuc2lnbmVkID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB2b2lkIDAgPyBhcmd1bWVudHNbMl0gOiB0cnVlOwogICAgICB2YXIgbG9uZzIgPSBMb25nLmZyb21CeXRlc0xFKGJ1Zi5zbGljZShvZmZzZXQsIG9mZnNldCArIDgpLCB1bnNpZ25lZCk7CiAgICAgIGlmIChsb25nMi5ncmVhdGVyVGhhbihOdW1iZXIuTUFYX1NBRkVfSU5URUdFUikgfHwgbG9uZzIubGVzc1RoYW4oTnVtYmVyLk1JTl9TQUZFX0lOVEVHRVIpKQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImludGVnZXIgb3ZlcmZsb3ciKTsKICAgICAgcmV0dXJuIGxvbmcyLnRvTnVtYmVyKCk7CiAgICB9IH0sIHsga2V5OiAiX2dldEluZGV4IiwgdmFsdWU6IGZ1bmN0aW9uIF9nZXRJbmRleCgpIHsKICAgICAgaWYgKCF0aGlzLmluZGV4KQogICAgICAgIHRoaXMuaW5kZXggPSB0aGlzLl9yZWFkSW5kZXgoKTsKICAgICAgcmV0dXJuIHRoaXMuaW5kZXg7CiAgICB9IH0sIHsKICAgICAga2V5OiAiX3JlYWRJbmRleCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgX3JlYWRJbmRleDIgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyJDEuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvciQxLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgICAgdmFyIGJ1ZiwgbnVtRW50cmllcywgZW50cmllcywgYnVmU2l6ZSwgZW50cnlOdW1iZXIsIGNvbXByZXNzZWRQb3NpdGlvbiwgdW5jb21wcmVzc2VkUG9zaXRpb247CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDEuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICBidWYgPSBCdWZmZXIuYWxsb2NVbnNhZmUoOCk7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlaGFuZGxlLnJlYWQoYnVmLCAwLCA4LCAwKTsKICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgbnVtRW50cmllcyA9IHRoaXMuX3JlYWRMb25nV2l0aE92ZXJmbG93KGJ1ZiwgMCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgIGlmIChudW1FbnRyaWVzKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgW1swLCAwXV0pOwogICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICBlbnRyaWVzID0gbmV3IEFycmF5KG51bUVudHJpZXMgKyAxKTsKICAgICAgICAgICAgICAgICAgZW50cmllc1swXSA9IFswLCAwXTsKICAgICAgICAgICAgICAgICAgYnVmU2l6ZSA9IDggKiAyICogbnVtRW50cmllczsKICAgICAgICAgICAgICAgICAgaWYgKCEoYnVmU2l6ZSA+IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnRlZ2VyIG92ZXJmbG93Iik7CiAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICBidWYgPSBCdWZmZXIuYWxsb2NVbnNhZmUoYnVmU2l6ZSk7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNDsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZWhhbmRsZS5yZWFkKGJ1ZiwgMCwgYnVmU2l6ZSwgOCk7CiAgICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgICBmb3IgKGVudHJ5TnVtYmVyID0gMDsgZW50cnlOdW1iZXIgPCBudW1FbnRyaWVzOyBlbnRyeU51bWJlciArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgY29tcHJlc3NlZFBvc2l0aW9uID0gdGhpcy5fcmVhZExvbmdXaXRoT3ZlcmZsb3coYnVmLCBlbnRyeU51bWJlciAqIDE2KTsKICAgICAgICAgICAgICAgICAgICB1bmNvbXByZXNzZWRQb3NpdGlvbiA9IHRoaXMuX3JlYWRMb25nV2l0aE92ZXJmbG93KGJ1ZiwgZW50cnlOdW1iZXIgKiAxNiArIDgpOwogICAgICAgICAgICAgICAgICAgIGVudHJpZXNbZW50cnlOdW1iZXIgKyAxXSA9IFtjb21wcmVzc2VkUG9zaXRpb24sIHVuY29tcHJlc3NlZFBvc2l0aW9uXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBlbnRyaWVzKTsKICAgICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgICAgfSkpOwogICAgICAgIGZ1bmN0aW9uIF9yZWFkSW5kZXgoKSB7CiAgICAgICAgICByZXR1cm4gX3JlYWRJbmRleDIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9yZWFkSW5kZXg7CiAgICAgIH0oKQogICAgfSwgewogICAgICBrZXk6ICJnZXRMYXN0QmxvY2siLAogICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIF9nZXRMYXN0QmxvY2sgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyJDEuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvciQxLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICAgIHZhciBlbnRyaWVzOwogICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvciQxLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldEluZGV4KCk7CiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgIGVudHJpZXMgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgICAgaWYgKGVudHJpZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA1OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCB2b2lkIDApOwogICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgZW50cmllc1tlbnRyaWVzLmxlbmd0aCAtIDFdKTsKICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICAgIH0pKTsKICAgICAgICBmdW5jdGlvbiBnZXRMYXN0QmxvY2soKSB7CiAgICAgICAgICByZXR1cm4gX2dldExhc3RCbG9jay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZ2V0TGFzdEJsb2NrOwogICAgICB9KCkKICAgIH0sIHsKICAgICAga2V5OiAiZ2V0UmVsZXZhbnRCbG9ja3NGb3JSZWFkIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBfZ2V0UmVsZXZhbnRCbG9ja3NGb3JSZWFkID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMiQxLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IkMS5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMobGVuZ3RoLCBwb3NpdGlvbikgewogICAgICAgICAgdmFyIGVuZFBvc2l0aW9uLCBlbnRyaWVzLCByZWxldmFudCwgY29tcGFyZSwgbG93ZXJCb3VuZCwgdXBwZXJCb3VuZCwgc2VhcmNoUG9zaXRpb24sIGNvbXBhcmlzb24sIGk7CiAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yJDEuZGVmYXVsdC53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgZW5kUG9zaXRpb24gPSBwb3NpdGlvbiArIGxlbmd0aDsKICAgICAgICAgICAgICAgICAgaWYgKCEobGVuZ3RoID09PSAwKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgW10pOwogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRJbmRleCgpOwogICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICBlbnRyaWVzID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICAgIHJlbGV2YW50ID0gW107CiAgICAgICAgICAgICAgICAgIGNvbXBhcmUgPSBmdW5jdGlvbiBjb21wYXJlMihlbnRyeSwgbmV4dEVudHJ5KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHVuY29tcHJlc3NlZFBvc2l0aW9uID0gZW50cnlbVU5DT01QUkVTU0VEX1BPU0lUSU9OXTsKICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dFVuY29tcHJlc3NlZFBvc2l0aW9uID0gbmV4dEVudHJ5ID8gbmV4dEVudHJ5W1VOQ09NUFJFU1NFRF9QT1NJVElPTl0gOiBJbmZpbml0eTsKICAgICAgICAgICAgICAgICAgICBpZiAodW5jb21wcmVzc2VkUG9zaXRpb24gPD0gcG9zaXRpb24gJiYgbmV4dFVuY29tcHJlc3NlZFBvc2l0aW9uID4gcG9zaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodW5jb21wcmVzc2VkUG9zaXRpb24gPCBwb3NpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgbG93ZXJCb3VuZCA9IDA7CiAgICAgICAgICAgICAgICAgIHVwcGVyQm91bmQgPSBlbnRyaWVzLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgICAgIHNlYXJjaFBvc2l0aW9uID0gTWF0aC5mbG9vcihlbnRyaWVzLmxlbmd0aCAvIDIpOwogICAgICAgICAgICAgICAgICBjb21wYXJpc29uID0gY29tcGFyZShlbnRyaWVzW3NlYXJjaFBvc2l0aW9uXSwgZW50cmllc1tzZWFyY2hQb3NpdGlvbiArIDFdKTsKICAgICAgICAgICAgICAgICAgd2hpbGUgKGNvbXBhcmlzb24gIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY29tcGFyaXNvbiA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgIHVwcGVyQm91bmQgPSBzZWFyY2hQb3NpdGlvbiAtIDE7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb21wYXJpc29uIDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgbG93ZXJCb3VuZCA9IHNlYXJjaFBvc2l0aW9uICsgMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2VhcmNoUG9zaXRpb24gPSBNYXRoLmNlaWwoKHVwcGVyQm91bmQgLSBsb3dlckJvdW5kKSAvIDIpICsgbG93ZXJCb3VuZDsKICAgICAgICAgICAgICAgICAgICBjb21wYXJpc29uID0gY29tcGFyZShlbnRyaWVzW3NlYXJjaFBvc2l0aW9uXSwgZW50cmllc1tzZWFyY2hQb3NpdGlvbiArIDFdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICByZWxldmFudC5wdXNoKGVudHJpZXNbc2VhcmNoUG9zaXRpb25dKTsKICAgICAgICAgICAgICAgICAgaSA9IHNlYXJjaFBvc2l0aW9uICsgMTsKICAgICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICAgIGlmICghKGkgPCBlbnRyaWVzLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDIyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJlbGV2YW50LnB1c2goZW50cmllc1tpXSk7CiAgICAgICAgICAgICAgICAgIGlmICghKGVudHJpZXNbaV1bVU5DT01QUkVTU0VEX1BPU0lUSU9OXSA+PSBlbmRQb3NpdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDE5OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJicmVhayIsIDIyKTsKICAgICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICAgIGkgKz0gMTsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgICBpZiAocmVsZXZhbnRbcmVsZXZhbnQubGVuZ3RoIC0gMV1bVU5DT01QUkVTU0VEX1BPU0lUSU9OXSA8IGVuZFBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgcmVsZXZhbnQucHVzaChbXSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHJlbGV2YW50KTsKICAgICAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgICB9KSk7CiAgICAgICAgZnVuY3Rpb24gZ2V0UmVsZXZhbnRCbG9ja3NGb3JSZWFkKF94LCBfeDIpIHsKICAgICAgICAgIHJldHVybiBfZ2V0UmVsZXZhbnRCbG9ja3NGb3JSZWFkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBnZXRSZWxldmFudEJsb2Nrc0ZvclJlYWQ7CiAgICAgIH0oKQogICAgfV0pOwogICAgcmV0dXJuIEd6aUluZGV4MjsKICB9KCk7CiAgdmFyIGd6aUluZGV4ID0gR3ppSW5kZXgkMTsKICB2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IGludGVyb3BSZXF1aXJlRGVmYXVsdC5leHBvcnRzOwogIHZhciBfc2xpY2VkVG9BcnJheTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHNsaWNlZFRvQXJyYXkuZXhwb3J0cyk7CiAgdmFyIF9yZWdlbmVyYXRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVnZW5lcmF0b3IpOwogIHZhciBfYXN5bmNUb0dlbmVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KGFzeW5jVG9HZW5lcmF0b3IuZXhwb3J0cyk7CiAgdmFyIF9jbGFzc0NhbGxDaGVjazIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KGNsYXNzQ2FsbENoZWNrLmV4cG9ydHMpOwogIHZhciBfY3JlYXRlQ2xhc3MyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChjcmVhdGVDbGFzcy5leHBvcnRzKTsKICB2YXIgX3JlcXVpcmUkMSA9IHVuemlwUGFrbywgdW56aXAkMSA9IF9yZXF1aXJlJDEudW56aXA7CiAgdmFyIExvY2FsRmlsZSA9IGxvY2FsRmlsZTsKICB2YXIgR3ppSW5kZXggPSBnemlJbmRleDsKICB2YXIgQmd6RmlsZWhhbmRsZSA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIEJnekZpbGVoYW5kbGUyKF9yZWYpIHsKICAgICAgdmFyIGZpbGVoYW5kbGUyID0gX3JlZi5maWxlaGFuZGxlLCBwYXRoID0gX3JlZi5wYXRoLCBnemlGaWxlaGFuZGxlID0gX3JlZi5nemlGaWxlaGFuZGxlLCBnemlQYXRoID0gX3JlZi5nemlQYXRoOwogICAgICAoMCwgX2NsYXNzQ2FsbENoZWNrMi5kZWZhdWx0KSh0aGlzLCBCZ3pGaWxlaGFuZGxlMik7CiAgICAgIGlmIChmaWxlaGFuZGxlMikKICAgICAgICB0aGlzLmZpbGVoYW5kbGUgPSBmaWxlaGFuZGxlMjsKICAgICAgZWxzZSBpZiAocGF0aCkKICAgICAgICB0aGlzLmZpbGVoYW5kbGUgPSBuZXcgTG9jYWxGaWxlKHBhdGgpOwogICAgICBlbHNlCiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiZWl0aGVyIGZpbGVoYW5kbGUgb3IgcGF0aCBtdXN0IGJlIGRlZmluZWQiKTsKICAgICAgaWYgKCFnemlGaWxlaGFuZGxlICYmICFnemlQYXRoICYmICFwYXRoKQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImVpdGhlciBnemlGaWxlaGFuZGxlIG9yIGd6aVBhdGggbXVzdCBiZSBkZWZpbmVkIik7CiAgICAgIHRoaXMuZ3ppID0gbmV3IEd6aUluZGV4KHsKICAgICAgICBmaWxlaGFuZGxlOiBnemlGaWxlaGFuZGxlLAogICAgICAgIHBhdGg6ICFnemlGaWxlaGFuZGxlICYmICFnemlQYXRoICYmIHBhdGggPyBnemlQYXRoIDogIiIuY29uY2F0KHBhdGgsICIuZ3ppIikKICAgICAgfSk7CiAgICB9CiAgICAoMCwgX2NyZWF0ZUNsYXNzMi5kZWZhdWx0KShCZ3pGaWxlaGFuZGxlMiwgW3sga2V5OiAic3RhdCIsIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9zdGF0ID0gKDAsIF9hc3luY1RvR2VuZXJhdG9yMi5kZWZhdWx0KSgvKiBAX19QVVJFX18gKi8gX3JlZ2VuZXJhdG9yLmRlZmF1bHQubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciBjb21wcmVzc2VkU3RhdDsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yLmRlZmF1bHQud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZWhhbmRsZS5zdGF0KCk7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgY29tcHJlc3NlZFN0YXQgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBPYmplY3Q7CiAgICAgICAgICAgICAgICBfY29udGV4dC50MSA9IGNvbXByZXNzZWRTdGF0OwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRVbmNvbXByZXNzZWRGaWxlU2l6ZSgpOwogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQyID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQzID0gdm9pZCAwOwogICAgICAgICAgICAgICAgX2NvbnRleHQudDQgPSB2b2lkIDA7CiAgICAgICAgICAgICAgICBfY29udGV4dC50NSA9IHsgc2l6ZTogX2NvbnRleHQudDIsIGJsb2NrczogX2NvbnRleHQudDMsIGJsa3NpemU6IF9jb250ZXh0LnQ0IH07CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dC50MC5hc3NpZ24uY2FsbChfY29udGV4dC50MCwgX2NvbnRleHQudDEsIF9jb250ZXh0LnQ1KSk7CiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICB9KSk7CiAgICAgIGZ1bmN0aW9uIHN0YXQoKSB7CiAgICAgICAgcmV0dXJuIF9zdGF0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHN0YXQ7CiAgICB9KCkgfSwgeyBrZXk6ICJnZXRVbmNvbXByZXNzZWRGaWxlU2l6ZSIsIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIF9nZXRVbmNvbXByZXNzZWRGaWxlU2l6ZSA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoLyogQF9fUFVSRV9fICovIF9yZWdlbmVyYXRvci5kZWZhdWx0Lm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgdmFyIF9yZWYyLCBfcmVmMywgdW5jb21wcmVzc2VkUG9zaXRpb24sIF9yZWY0LCBzaXplLCBidWYsIF9yZWY1LCBieXRlc1JlYWQsIGxhc3RCbG9ja1VuY29tcHJlc3NlZFNpemU7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3ppLmdldExhc3RCbG9jaygpOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIF9yZWYyID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICBfcmVmMyA9ICgwLCBfc2xpY2VkVG9BcnJheTIuZGVmYXVsdCkoX3JlZjIsIDIpOwogICAgICAgICAgICAgICAgdW5jb21wcmVzc2VkUG9zaXRpb24gPSBfcmVmM1sxXTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGVoYW5kbGUuc3RhdCgpOwogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIF9yZWY0ID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICBzaXplID0gX3JlZjQuc2l6ZTsKICAgICAgICAgICAgICAgIGJ1ZiA9IEJ1ZmZlci5hbGxvY1Vuc2FmZSg0KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlaGFuZGxlLnJlYWQoYnVmLCAwLCA0LCBzaXplIC0gMjggLSA0KTsKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgX3JlZjUgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIGJ5dGVzUmVhZCA9IF9yZWY1LmJ5dGVzUmVhZDsKICAgICAgICAgICAgICAgIGlmICghKGJ5dGVzUmVhZCAhPT0gNCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInJlYWQgZXJyb3IiKTsKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgbGFzdEJsb2NrVW5jb21wcmVzc2VkU2l6ZSA9IGJ1Zi5yZWFkVUludDMyTEUoMCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgdW5jb21wcmVzc2VkUG9zaXRpb24gKyBsYXN0QmxvY2tVbmNvbXByZXNzZWRTaXplKTsKICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwogICAgICBmdW5jdGlvbiBnZXRVbmNvbXByZXNzZWRGaWxlU2l6ZSgpIHsKICAgICAgICByZXR1cm4gX2dldFVuY29tcHJlc3NlZEZpbGVTaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGdldFVuY29tcHJlc3NlZEZpbGVTaXplOwogICAgfSgpIH0sIHsga2V5OiAiX3JlYWRBbmRVbmNvbXByZXNzQmxvY2siLCB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBfcmVhZEFuZFVuY29tcHJlc3NCbG9jazIgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKGJsb2NrQnVmZmVyLCBfcmVmNiwgX3JlZjcpIHsKICAgICAgICB2YXIgX3JlZjgsIGNvbXByZXNzZWRQb3NpdGlvbiwgX3JlZjksIG5leHRDb21wcmVzc2VkUG9zaXRpb24sIG5leHQsIGJsb2NrQ29tcHJlc3NlZExlbmd0aCwgdW56aXBwZWRCdWZmZXI7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX3JlZjggPSAoMCwgX3NsaWNlZFRvQXJyYXkyLmRlZmF1bHQpKF9yZWY2LCAxKSwgY29tcHJlc3NlZFBvc2l0aW9uID0gX3JlZjhbMF07CiAgICAgICAgICAgICAgICBfcmVmOSA9ICgwLCBfc2xpY2VkVG9BcnJheTIuZGVmYXVsdCkoX3JlZjcsIDEpLCBuZXh0Q29tcHJlc3NlZFBvc2l0aW9uID0gX3JlZjlbMF07CiAgICAgICAgICAgICAgICBuZXh0ID0gbmV4dENvbXByZXNzZWRQb3NpdGlvbjsKICAgICAgICAgICAgICAgIGlmIChuZXh0KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDY7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlaGFuZGxlLnN0YXQoKTsKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICBuZXh0ID0gX2NvbnRleHQzLnNlbnQuc2l6ZTsKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBibG9ja0NvbXByZXNzZWRMZW5ndGggPSBuZXh0IC0gY29tcHJlc3NlZFBvc2l0aW9uOwogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxMDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbGVoYW5kbGUucmVhZChibG9ja0J1ZmZlciwgMCwgYmxvY2tDb21wcmVzc2VkTGVuZ3RoLCBjb21wcmVzc2VkUG9zaXRpb24pOwogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgcmV0dXJuIHVuemlwJDEoYmxvY2tCdWZmZXIuc2xpY2UoMCwgYmxvY2tDb21wcmVzc2VkTGVuZ3RoKSk7CiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIHVuemlwcGVkQnVmZmVyID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgdW56aXBwZWRCdWZmZXIpOwogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICB9KSk7CiAgICAgIGZ1bmN0aW9uIF9yZWFkQW5kVW5jb21wcmVzc0Jsb2NrKF94LCBfeDIsIF94MykgewogICAgICAgIHJldHVybiBfcmVhZEFuZFVuY29tcHJlc3NCbG9jazIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgICByZXR1cm4gX3JlYWRBbmRVbmNvbXByZXNzQmxvY2s7CiAgICB9KCkgfSwgeyBrZXk6ICJyZWFkIiwgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgX3JlYWQgPSAoMCwgX2FzeW5jVG9HZW5lcmF0b3IyLmRlZmF1bHQpKC8qIEBfX1BVUkVfXyAqLyBfcmVnZW5lcmF0b3IuZGVmYXVsdC5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KGJ1Ziwgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uKSB7CiAgICAgICAgdmFyIGJsb2NrUG9zaXRpb25zLCBibG9ja0J1ZmZlciwgZGVzdGluYXRpb25PZmZzZXQsIGJ5dGVzUmVhZCwgYmxvY2tOdW0sIHVuY29tcHJlc3NlZEJ1ZmZlciwgX2Jsb2NrUG9zaXRpb25zJGJsb2NrLCB1bmNvbXByZXNzZWRQb3NpdGlvbiwgc291cmNlT2Zmc2V0LCBzb3VyY2VFbmQ7CiAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvci5kZWZhdWx0LndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3ppLmdldFJlbGV2YW50QmxvY2tzRm9yUmVhZChsZW5ndGgsIHBvc2l0aW9uKTsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBibG9ja1Bvc2l0aW9ucyA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgYmxvY2tCdWZmZXIgPSBCdWZmZXIuYWxsb2NVbnNhZmUoMzI3NjggKiAyKTsKICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uT2Zmc2V0ID0gb2Zmc2V0OwogICAgICAgICAgICAgICAgYnl0ZXNSZWFkID0gMDsKICAgICAgICAgICAgICAgIGJsb2NrTnVtID0gMDsKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBpZiAoIShibG9ja051bSA8IGJsb2NrUG9zaXRpb25zLmxlbmd0aCAtIDEpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZWFkQW5kVW5jb21wcmVzc0Jsb2NrKGJsb2NrQnVmZmVyLCBibG9ja1Bvc2l0aW9uc1tibG9ja051bV0sIGJsb2NrUG9zaXRpb25zW2Jsb2NrTnVtICsgMV0pOwogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICB1bmNvbXByZXNzZWRCdWZmZXIgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgIF9ibG9ja1Bvc2l0aW9ucyRibG9jayA9ICgwLCBfc2xpY2VkVG9BcnJheTIuZGVmYXVsdCkoYmxvY2tQb3NpdGlvbnNbYmxvY2tOdW1dLCAyKSwgdW5jb21wcmVzc2VkUG9zaXRpb24gPSBfYmxvY2tQb3NpdGlvbnMkYmxvY2tbMV07CiAgICAgICAgICAgICAgICBzb3VyY2VPZmZzZXQgPSB1bmNvbXByZXNzZWRQb3NpdGlvbiA+PSBwb3NpdGlvbiA/IDAgOiBwb3NpdGlvbiAtIHVuY29tcHJlc3NlZFBvc2l0aW9uOwogICAgICAgICAgICAgICAgc291cmNlRW5kID0gTWF0aC5taW4ocG9zaXRpb24gKyBsZW5ndGgsIHVuY29tcHJlc3NlZFBvc2l0aW9uICsgdW5jb21wcmVzc2VkQnVmZmVyLmxlbmd0aCkgLSB1bmNvbXByZXNzZWRQb3NpdGlvbjsKICAgICAgICAgICAgICAgIGlmIChzb3VyY2VPZmZzZXQgPj0gMCAmJiBzb3VyY2VPZmZzZXQgPCB1bmNvbXByZXNzZWRCdWZmZXIubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIHVuY29tcHJlc3NlZEJ1ZmZlci5jb3B5KGJ1ZiwgZGVzdGluYXRpb25PZmZzZXQsIHNvdXJjZU9mZnNldCwgc291cmNlRW5kKTsKICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb25PZmZzZXQgKz0gc291cmNlRW5kIC0gc291cmNlT2Zmc2V0OwogICAgICAgICAgICAgICAgICBieXRlc1JlYWQgKz0gc291cmNlRW5kIC0gc291cmNlT2Zmc2V0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICBibG9ja051bSArPSAxOwogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCB7IGJ5dGVzUmVhZCwgYnVmZmVyOiBidWYgfSk7CiAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgIH0pKTsKICAgICAgZnVuY3Rpb24gcmVhZChfeDQsIF94NSwgX3g2LCBfeDcpIHsKICAgICAgICByZXR1cm4gX3JlYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgICByZXR1cm4gcmVhZDsKICAgIH0oKSB9XSk7CiAgICByZXR1cm4gQmd6RmlsZWhhbmRsZTI7CiAgfSgpOwogIHZhciBiZ3pGaWxlaGFuZGxlID0gQmd6RmlsZWhhbmRsZTsKICB2YXIgQmd6ZkZpbGVoYW5kbGUgPSBiZ3pGaWxlaGFuZGxlOwogIHZhciBfcmVxdWlyZSA9IHVuemlwUGFrbywgdW56aXAgPSBfcmVxdWlyZS51bnppcCwgdW56aXBDaHVuayA9IF9yZXF1aXJlLnVuemlwQ2h1bmssIHVuemlwQ2h1bmtTbGljZSA9IF9yZXF1aXJlLnVuemlwQ2h1bmtTbGljZTsKICB2YXIgZGlzdCA9IHsgQmd6ZkZpbGVoYW5kbGUsIHVuemlwLCB1bnppcENodW5rLCB1bnppcENodW5rU2xpY2UgfTsKICBmdW5jdGlvbiBsb25nVG9OdW1iZXIobG9uZzIpIHsKICAgIGlmIChsb25nMi5ncmVhdGVyVGhhbihOdW1iZXIuTUFYX1NBRkVfSU5URUdFUikgfHwgbG9uZzIubGVzc1RoYW4oTnVtYmVyLk1JTl9TQUZFX0lOVEVHRVIpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiaW50ZWdlciBvdmVyZmxvdyIpOwogICAgfQogICAgcmV0dXJuIGxvbmcyLnRvTnVtYmVyKCk7CiAgfQogIGNsYXNzIEFib3J0RXJyb3IgZXh0ZW5kcyBFcnJvciB7CiAgfQogIGZ1bmN0aW9uIGNoZWNrQWJvcnRTaWduYWwoc2lnbmFsKSB7CiAgICBpZiAoIXNpZ25hbCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoc2lnbmFsLmFib3J0ZWQpIHsKICAgICAgaWYgKHR5cGVvZiBET01FeGNlcHRpb24gIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbigiYWJvcnRlZCIsICJBYm9ydEVycm9yIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZSA9IG5ldyBBYm9ydEVycm9yKCJhYm9ydGVkIik7CiAgICAgICAgZS5jb2RlID0gIkVSUl9BQk9SVEVEIjsKICAgICAgICB0aHJvdyBlOwogICAgICB9CiAgICB9CiAgfQogIGZ1bmN0aW9uIGNhbk1lcmdlQmxvY2tzKGNodW5rMSwgY2h1bmsyKSB7CiAgICByZXR1cm4gY2h1bmsyLm1pbnYuYmxvY2tQb3NpdGlvbiAtIGNodW5rMS5tYXh2LmJsb2NrUG9zaXRpb24gPCA2NWUzICYmIGNodW5rMi5tYXh2LmJsb2NrUG9zaXRpb24gLSBjaHVuazEubWludi5ibG9ja1Bvc2l0aW9uIDwgNWU2OwogIH0KICBmdW5jdGlvbiBvcHRpbWl6ZUNodW5rcyhjaHVua3MsIGxvd2VzdCkgewogICAgY29uc3QgbWVyZ2VkQ2h1bmtzID0gW107CiAgICBsZXQgbGFzdENodW5rID0gbnVsbDsKICAgIGlmIChjaHVua3MubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBjaHVua3M7CiAgICB9CiAgICBjaHVua3Muc29ydChmdW5jdGlvbihjMCwgYzEpIHsKICAgICAgY29uc3QgZGlmID0gYzAubWludi5ibG9ja1Bvc2l0aW9uIC0gYzEubWludi5ibG9ja1Bvc2l0aW9uOwogICAgICBpZiAoZGlmICE9PSAwKSB7CiAgICAgICAgcmV0dXJuIGRpZjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gYzAubWludi5kYXRhUG9zaXRpb24gLSBjMS5taW52LmRhdGFQb3NpdGlvbjsKICAgICAgfQogICAgfSk7CiAgICBjaHVua3MuZm9yRWFjaCgoY2h1bmspID0+IHsKICAgICAgaWYgKCFsb3dlc3QgfHwgY2h1bmsubWF4di5jb21wYXJlVG8obG93ZXN0KSA+IDApIHsKICAgICAgICBpZiAobGFzdENodW5rID09PSBudWxsKSB7CiAgICAgICAgICBtZXJnZWRDaHVua3MucHVzaChjaHVuayk7CiAgICAgICAgICBsYXN0Q2h1bmsgPSBjaHVuazsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGNhbk1lcmdlQmxvY2tzKGxhc3RDaHVuaywgY2h1bmspKSB7CiAgICAgICAgICAgIGlmIChjaHVuay5tYXh2LmNvbXBhcmVUbyhsYXN0Q2h1bmsubWF4dikgPiAwKSB7CiAgICAgICAgICAgICAgbGFzdENodW5rLm1heHYgPSBjaHVuay5tYXh2OwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtZXJnZWRDaHVua3MucHVzaChjaHVuayk7CiAgICAgICAgICAgIGxhc3RDaHVuayA9IGNodW5rOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gbWVyZ2VkQ2h1bmtzOwogIH0KICBjbGFzcyBWaXJ0dWFsT2Zmc2V0IHsKICAgIGNvbnN0cnVjdG9yKGJsb2NrUG9zaXRpb24sIGRhdGFQb3NpdGlvbikgewogICAgICB0aGlzLmJsb2NrUG9zaXRpb24gPSBibG9ja1Bvc2l0aW9uOwogICAgICB0aGlzLmRhdGFQb3NpdGlvbiA9IGRhdGFQb3NpdGlvbjsKICAgIH0KICAgIHRvU3RyaW5nKCkgewogICAgICByZXR1cm4gYCR7dGhpcy5ibG9ja1Bvc2l0aW9ufToke3RoaXMuZGF0YVBvc2l0aW9ufWA7CiAgICB9CiAgICBjb21wYXJlVG8oYikgewogICAgICByZXR1cm4gdGhpcy5ibG9ja1Bvc2l0aW9uIC0gYi5ibG9ja1Bvc2l0aW9uIHx8IHRoaXMuZGF0YVBvc2l0aW9uIC0gYi5kYXRhUG9zaXRpb247CiAgICB9CiAgICBzdGF0aWMgbWluKC4uLmFyZ3MpIHsKICAgICAgbGV0IG1pbjsKICAgICAgbGV0IGkgPSAwOwogICAgICBmb3IgKDsgIW1pbjsgaSArPSAxKSB7CiAgICAgICAgbWluID0gYXJnc1tpXTsKICAgICAgfQogICAgICBmb3IgKDsgaSA8IGFyZ3MubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICBpZiAobWluLmNvbXBhcmVUbyhhcmdzW2ldKSA+IDApIHsKICAgICAgICAgIG1pbiA9IGFyZ3NbaV07CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBtaW47CiAgICB9CiAgfQogIGZ1bmN0aW9uIGZyb21CeXRlcyhieXRlcywgb2Zmc2V0ID0gMCwgYmlnZW5kaWFuID0gZmFsc2UpIHsKICAgIGlmIChiaWdlbmRpYW4pIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJiaWctZW5kaWFuIHZpcnR1YWwgZmlsZSBvZmZzZXRzIG5vdCBpbXBsZW1lbnRlZCIpOwogICAgfQogICAgcmV0dXJuIG5ldyBWaXJ0dWFsT2Zmc2V0KGJ5dGVzW29mZnNldCArIDddICogMTA5OTUxMTYyNzc3NiArIGJ5dGVzW29mZnNldCArIDZdICogNDI5NDk2NzI5NiArIGJ5dGVzW29mZnNldCArIDVdICogMTY3NzcyMTYgKyBieXRlc1tvZmZzZXQgKyA0XSAqIDY1NTM2ICsgYnl0ZXNbb2Zmc2V0ICsgM10gKiAyNTYgKyBieXRlc1tvZmZzZXQgKyAyXSwgYnl0ZXNbb2Zmc2V0ICsgMV0gPDwgOCB8IGJ5dGVzW29mZnNldF0pOwogIH0KICBjbGFzcyBDaHVuayB7CiAgICBjb25zdHJ1Y3RvcihtaW52LCBtYXh2LCBiaW4sIGZldGNoZWRTaXplID0gdm9pZCAwKSB7CiAgICAgIHRoaXMubWludiA9IG1pbnY7CiAgICAgIHRoaXMubWF4diA9IG1heHY7CiAgICAgIHRoaXMuYmluID0gYmluOwogICAgICB0aGlzLl9mZXRjaGVkU2l6ZSA9IGZldGNoZWRTaXplOwogICAgfQogICAgdG9VbmlxdWVTdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLm1pbnZ9Li4ke3RoaXMubWF4dn0gKGJpbiAke3RoaXMuYmlufSwgZmV0Y2hlZFNpemUgJHt0aGlzLmZldGNoZWRTaXplKCl9KWA7CiAgICB9CiAgICB0b1N0cmluZygpIHsKICAgICAgcmV0dXJuIHRoaXMudG9VbmlxdWVTdHJpbmcoKTsKICAgIH0KICAgIGNvbXBhcmVUbyhiKSB7CiAgICAgIHJldHVybiB0aGlzLm1pbnYuY29tcGFyZVRvKGIubWludikgfHwgdGhpcy5tYXh2LmNvbXBhcmVUbyhiLm1heHYpIHx8IHRoaXMuYmluIC0gYi5iaW47CiAgICB9CiAgICBmZXRjaGVkU2l6ZSgpIHsKICAgICAgaWYgKHRoaXMuX2ZldGNoZWRTaXplICE9PSB2b2lkIDApIHsKICAgICAgICByZXR1cm4gdGhpcy5fZmV0Y2hlZFNpemU7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMubWF4di5ibG9ja1Bvc2l0aW9uICsgKDEgPDwgMTYpIC0gdGhpcy5taW52LmJsb2NrUG9zaXRpb247CiAgICB9CiAgfQogIGNsYXNzIEluZGV4RmlsZSB7CiAgICBjb25zdHJ1Y3Rvcih7IGZpbGVoYW5kbGU6IGZpbGVoYW5kbGUyLCByZW5hbWVSZWZTZXFzID0gKG4pID0+IG4gfSkgewogICAgICB0aGlzLmZpbGVoYW5kbGUgPSBmaWxlaGFuZGxlMjsKICAgICAgdGhpcy5yZW5hbWVSZWZTZXEgPSByZW5hbWVSZWZTZXFzOwogICAgfQogICAgYXN5bmMgZ2V0TWV0YWRhdGEob3B0cyA9IHt9KSB7CiAgICAgIGNvbnN0IHsgaW5kaWNlcywgLi4ucmVzdCB9ID0gYXdhaXQgdGhpcy5wYXJzZShvcHRzKTsKICAgICAgcmV0dXJuIHJlc3Q7CiAgICB9CiAgICBfZmluZEZpcnN0RGF0YShjdXJyZW50RmRsLCB2aXJ0dWFsT2Zmc2V0KSB7CiAgICAgIGlmIChjdXJyZW50RmRsKSB7CiAgICAgICAgcmV0dXJuIGN1cnJlbnRGZGwuY29tcGFyZVRvKHZpcnR1YWxPZmZzZXQpID4gMCA/IHZpcnR1YWxPZmZzZXQgOiBjdXJyZW50RmRsOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB2aXJ0dWFsT2Zmc2V0OwogICAgICB9CiAgICB9CiAgICBhc3luYyBwYXJzZShvcHRzID0ge30pIHsKICAgICAgaWYgKCF0aGlzLl9wYXJzZUNhY2hlKSB7CiAgICAgICAgdGhpcy5fcGFyc2VDYWNoZSA9IG5ldyBfZGVmYXVsdCh7CiAgICAgICAgICBjYWNoZTogbmV3IHF1aWNrTHJ1KHsgbWF4U2l6ZTogMSB9KSwKICAgICAgICAgIGZpbGw6ICgpID0+IHRoaXMuX3BhcnNlKG9wdHMpCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3BhcnNlQ2FjaGUuZ2V0KCJpbmRleCIsIG51bGwsIHZvaWQgMCk7CiAgICB9CiAgICBhc3luYyBoYXNSZWZTZXEoc2VxSWQsIG9wdHMgPSB7fSkgewogICAgICByZXR1cm4gISEoKGF3YWl0IHRoaXMucGFyc2Uob3B0cykpLmluZGljZXNbc2VxSWRdIHx8IHt9KS5iaW5JbmRleDsKICAgIH0KICB9CiAgY29uc3QgVEJJX01BR0lDID0gMjE1NzgzMjQ7CiAgY29uc3QgVEFEX0xJRFhfU0hJRlQgPSAxNDsKICBmdW5jdGlvbiByZWcyYmlucyhiZWcsIGVuZCkgewogICAgYmVnICs9IDE7CiAgICBlbmQgLT0gMTsKICAgIHJldHVybiBbCiAgICAgIFswLCAwXSwKICAgICAgWzEgKyAoYmVnID4+IDI2KSwgMSArIChlbmQgPj4gMjYpXSwKICAgICAgWzkgKyAoYmVnID4+IDIzKSwgOSArIChlbmQgPj4gMjMpXSwKICAgICAgWzczICsgKGJlZyA+PiAyMCksIDczICsgKGVuZCA+PiAyMCldLAogICAgICBbNTg1ICsgKGJlZyA+PiAxNyksIDU4NSArIChlbmQgPj4gMTcpXSwKICAgICAgWzQ2ODEgKyAoYmVnID4+IDE0KSwgNDY4MSArIChlbmQgPj4gMTQpXQogICAgXTsKICB9CiAgY2xhc3MgVGFiaXhJbmRleCBleHRlbmRzIEluZGV4RmlsZSB7CiAgICBhc3luYyBsaW5lQ291bnQocmVmTmFtZSwgb3B0cyA9IHt9KSB7CiAgICAgIGNvbnN0IGluZGV4RGF0YSA9IGF3YWl0IHRoaXMucGFyc2Uob3B0cyk7CiAgICAgIGlmICghaW5kZXhEYXRhKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIGNvbnN0IHJlZklkID0gaW5kZXhEYXRhLnJlZk5hbWVUb0lkW3JlZk5hbWVdOwogICAgICBjb25zdCBpZHggPSBpbmRleERhdGEuaW5kaWNlc1tyZWZJZF07CiAgICAgIGlmICghaWR4KSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIGNvbnN0IHsgc3RhdHMgfSA9IGluZGV4RGF0YS5pbmRpY2VzW3JlZklkXTsKICAgICAgaWYgKHN0YXRzKSB7CiAgICAgICAgcmV0dXJuIHN0YXRzLmxpbmVDb3VudDsKICAgICAgfQogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICBhc3luYyBfcGFyc2Uob3B0cyA9IHt9KSB7CiAgICAgIGNvbnN0IGJ5dGVzID0gYXdhaXQgZGlzdC51bnppcChhd2FpdCB0aGlzLmZpbGVoYW5kbGUucmVhZEZpbGUob3B0cykpOwogICAgICBjaGVja0Fib3J0U2lnbmFsKG9wdHMuc2lnbmFsKTsKICAgICAgaWYgKGJ5dGVzLnJlYWRVSW50MzJMRSgwKSAhPT0gVEJJX01BR0lDKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgYSBUQkkgZmlsZSIpOwogICAgICB9CiAgICAgIGNvbnN0IHJlZkNvdW50ID0gYnl0ZXMucmVhZEludDMyTEUoNCk7CiAgICAgIGNvbnN0IGZvcm1hdEZsYWdzID0gYnl0ZXMucmVhZEludDMyTEUoOCk7CiAgICAgIGNvbnN0IGNvb3JkaW5hdGVUeXBlID0gZm9ybWF0RmxhZ3MgJiA2NTUzNiA/ICJ6ZXJvLWJhc2VkLWhhbGYtb3BlbiIgOiAiMS1iYXNlZC1jbG9zZWQiOwogICAgICBjb25zdCBmb3JtYXRPcHRzID0gewogICAgICAgIDA6ICJnZW5lcmljIiwKICAgICAgICAxOiAiU0FNIiwKICAgICAgICAyOiAiVkNGIgogICAgICB9OwogICAgICBjb25zdCBmb3JtYXQgPSBmb3JtYXRPcHRzW2Zvcm1hdEZsYWdzICYgMTVdOwogICAgICBpZiAoIWZvcm1hdCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgaW52YWxpZCBUYWJpeCBwcmVzZXQgZm9ybWF0IGZsYWdzICR7Zm9ybWF0RmxhZ3N9YCk7CiAgICAgIH0KICAgICAgY29uc3QgY29sdW1uTnVtYmVycyA9IHsKICAgICAgICByZWY6IGJ5dGVzLnJlYWRJbnQzMkxFKDEyKSwKICAgICAgICBzdGFydDogYnl0ZXMucmVhZEludDMyTEUoMTYpLAogICAgICAgIGVuZDogYnl0ZXMucmVhZEludDMyTEUoMjApCiAgICAgIH07CiAgICAgIGNvbnN0IG1ldGFWYWx1ZSA9IGJ5dGVzLnJlYWRJbnQzMkxFKDI0KTsKICAgICAgY29uc3QgZGVwdGggPSA1OwogICAgICBjb25zdCBtYXhCaW5OdW1iZXIgPSAoKDEgPDwgKGRlcHRoICsgMSkgKiAzKSAtIDEpIC8gNzsKICAgICAgY29uc3QgbWF4UmVmTGVuZ3RoID0gMiAqKiAoMTQgKyBkZXB0aCAqIDMpOwogICAgICBjb25zdCBtZXRhQ2hhciA9IG1ldGFWYWx1ZSA/IFN0cmluZy5mcm9tQ2hhckNvZGUobWV0YVZhbHVlKSA6IG51bGw7CiAgICAgIGNvbnN0IHNraXBMaW5lcyA9IGJ5dGVzLnJlYWRJbnQzMkxFKDI4KTsKICAgICAgY29uc3QgbmFtZVNlY3Rpb25MZW5ndGggPSBieXRlcy5yZWFkSW50MzJMRSgzMik7CiAgICAgIGNvbnN0IHsgcmVmTmFtZVRvSWQsIHJlZklkVG9OYW1lIH0gPSB0aGlzLl9wYXJzZU5hbWVCeXRlcyhieXRlcy5zbGljZSgzNiwgMzYgKyBuYW1lU2VjdGlvbkxlbmd0aCkpOwogICAgICBsZXQgY3Vyck9mZnNldCA9IDM2ICsgbmFtZVNlY3Rpb25MZW5ndGg7CiAgICAgIGxldCBmaXJzdERhdGFMaW5lOwogICAgICBjb25zdCBpbmRpY2VzID0gbmV3IEFycmF5KHJlZkNvdW50KS5maWxsKDApLm1hcCgoKSA9PiB7CiAgICAgICAgY29uc3QgYmluQ291bnQgPSBieXRlcy5yZWFkSW50MzJMRShjdXJyT2Zmc2V0KTsKICAgICAgICBjdXJyT2Zmc2V0ICs9IDQ7CiAgICAgICAgY29uc3QgYmluSW5kZXggPSB7fTsKICAgICAgICBsZXQgc3RhdHM7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBiaW5Db3VudDsgaiArPSAxKSB7CiAgICAgICAgICBjb25zdCBiaW4gPSBieXRlcy5yZWFkVUludDMyTEUoY3Vyck9mZnNldCk7CiAgICAgICAgICBjdXJyT2Zmc2V0ICs9IDQ7CiAgICAgICAgICBpZiAoYmluID4gbWF4QmluTnVtYmVyICsgMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInRhYml4IGluZGV4IGNvbnRhaW5zIHRvbyBtYW55IGJpbnMsIHBsZWFzZSB1c2UgYSBDU0kgaW5kZXgiKTsKICAgICAgICAgIH0gZWxzZSBpZiAoYmluID09PSBtYXhCaW5OdW1iZXIgKyAxKSB7CiAgICAgICAgICAgIGNvbnN0IGNodW5rQ291bnQgPSBieXRlcy5yZWFkSW50MzJMRShjdXJyT2Zmc2V0KTsKICAgICAgICAgICAgY3Vyck9mZnNldCArPSA0OwogICAgICAgICAgICBpZiAoY2h1bmtDb3VudCA9PT0gMikgewogICAgICAgICAgICAgIHN0YXRzID0gdGhpcy5wYXJzZVBzZXVkb0JpbihieXRlcywgY3Vyck9mZnNldCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3Vyck9mZnNldCArPSAxNiAqIGNodW5rQ291bnQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBjaHVua0NvdW50ID0gYnl0ZXMucmVhZEludDMyTEUoY3Vyck9mZnNldCk7CiAgICAgICAgICAgIGN1cnJPZmZzZXQgKz0gNDsKICAgICAgICAgICAgY29uc3QgY2h1bmtzID0gbmV3IEFycmF5KGNodW5rQ291bnQpOwogICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IGNodW5rQ291bnQ7IGsgKz0gMSkgewogICAgICAgICAgICAgIGNvbnN0IHUgPSBmcm9tQnl0ZXMoYnl0ZXMsIGN1cnJPZmZzZXQpOwogICAgICAgICAgICAgIGNvbnN0IHYgPSBmcm9tQnl0ZXMoYnl0ZXMsIGN1cnJPZmZzZXQgKyA4KTsKICAgICAgICAgICAgICBjdXJyT2Zmc2V0ICs9IDE2OwogICAgICAgICAgICAgIGZpcnN0RGF0YUxpbmUgPSB0aGlzLl9maW5kRmlyc3REYXRhKGZpcnN0RGF0YUxpbmUsIHUpOwogICAgICAgICAgICAgIGNodW5rc1trXSA9IG5ldyBDaHVuayh1LCB2LCBiaW4pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJpbkluZGV4W2Jpbl0gPSBjaHVua3M7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IGxpbmVhckNvdW50ID0gYnl0ZXMucmVhZEludDMyTEUoY3Vyck9mZnNldCk7CiAgICAgICAgY3Vyck9mZnNldCArPSA0OwogICAgICAgIGNvbnN0IGxpbmVhckluZGV4ID0gbmV3IEFycmF5KGxpbmVhckNvdW50KTsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IGxpbmVhckNvdW50OyBrICs9IDEpIHsKICAgICAgICAgIGxpbmVhckluZGV4W2tdID0gZnJvbUJ5dGVzKGJ5dGVzLCBjdXJyT2Zmc2V0KTsKICAgICAgICAgIGN1cnJPZmZzZXQgKz0gODsKICAgICAgICAgIGZpcnN0RGF0YUxpbmUgPSB0aGlzLl9maW5kRmlyc3REYXRhKGZpcnN0RGF0YUxpbmUsIGxpbmVhckluZGV4W2tdKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsgYmluSW5kZXgsIGxpbmVhckluZGV4LCBzdGF0cyB9OwogICAgICB9KTsKICAgICAgcmV0dXJuIHsKICAgICAgICBpbmRpY2VzLAogICAgICAgIG1ldGFDaGFyLAogICAgICAgIG1heEJpbk51bWJlciwKICAgICAgICBtYXhSZWZMZW5ndGgsCiAgICAgICAgc2tpcExpbmVzLAogICAgICAgIGZpcnN0RGF0YUxpbmUsCiAgICAgICAgY29sdW1uTnVtYmVycywKICAgICAgICBjb29yZGluYXRlVHlwZSwKICAgICAgICBmb3JtYXQsCiAgICAgICAgcmVmSWRUb05hbWUsCiAgICAgICAgcmVmTmFtZVRvSWQsCiAgICAgICAgbWF4QmxvY2tTaXplOiAxIDw8IDE2CiAgICAgIH07CiAgICB9CiAgICBwYXJzZVBzZXVkb0JpbihieXRlcywgb2Zmc2V0KSB7CiAgICAgIGNvbnN0IGxpbmVDb3VudCA9IGxvbmdUb051bWJlcihsb25nLmZyb21CeXRlc0xFKGJ5dGVzLnNsaWNlKG9mZnNldCArIDE2LCBvZmZzZXQgKyAyNCksIHRydWUpKTsKICAgICAgcmV0dXJuIHsgbGluZUNvdW50IH07CiAgICB9CiAgICBfcGFyc2VOYW1lQnl0ZXMobmFtZXNCeXRlcykgewogICAgICBsZXQgY3VyclJlZklkID0gMDsKICAgICAgbGV0IGN1cnJOYW1lU3RhcnQgPSAwOwogICAgICBjb25zdCByZWZJZFRvTmFtZSA9IFtdOwogICAgICBjb25zdCByZWZOYW1lVG9JZCA9IHt9OwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5hbWVzQnl0ZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICBpZiAoIW5hbWVzQnl0ZXNbaV0pIHsKICAgICAgICAgIGlmIChjdXJyTmFtZVN0YXJ0IDwgaSkgewogICAgICAgICAgICBsZXQgcmVmTmFtZSA9IG5hbWVzQnl0ZXMudG9TdHJpbmcoInV0ZjgiLCBjdXJyTmFtZVN0YXJ0LCBpKTsKICAgICAgICAgICAgcmVmTmFtZSA9IHRoaXMucmVuYW1lUmVmU2VxKHJlZk5hbWUpOwogICAgICAgICAgICByZWZJZFRvTmFtZVtjdXJyUmVmSWRdID0gcmVmTmFtZTsKICAgICAgICAgICAgcmVmTmFtZVRvSWRbcmVmTmFtZV0gPSBjdXJyUmVmSWQ7CiAgICAgICAgICB9CiAgICAgICAgICBjdXJyTmFtZVN0YXJ0ID0gaSArIDE7CiAgICAgICAgICBjdXJyUmVmSWQgKz0gMTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHsgcmVmTmFtZVRvSWQsIHJlZklkVG9OYW1lIH07CiAgICB9CiAgICBhc3luYyBibG9ja3NGb3JSYW5nZShyZWZOYW1lLCBtaW4sIG1heCwgb3B0cyA9IHt9KSB7CiAgICAgIGlmIChtaW4gPCAwKSB7CiAgICAgICAgbWluID0gMDsKICAgICAgfQogICAgICBjb25zdCBpbmRleERhdGEgPSBhd2FpdCB0aGlzLnBhcnNlKG9wdHMpOwogICAgICBpZiAoIWluZGV4RGF0YSkgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfQogICAgICBjb25zdCByZWZJZCA9IGluZGV4RGF0YS5yZWZOYW1lVG9JZFtyZWZOYW1lXTsKICAgICAgY29uc3QgYmEgPSBpbmRleERhdGEuaW5kaWNlc1tyZWZJZF07CiAgICAgIGlmICghYmEpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgICAgY29uc3QgbWluT2Zmc2V0ID0gYmEubGluZWFySW5kZXgubGVuZ3RoID8gYmEubGluZWFySW5kZXhbbWluID4+IFRBRF9MSURYX1NISUZUID49IGJhLmxpbmVhckluZGV4Lmxlbmd0aCA/IGJhLmxpbmVhckluZGV4Lmxlbmd0aCAtIDEgOiBtaW4gPj4gVEFEX0xJRFhfU0hJRlRdIDogbmV3IFZpcnR1YWxPZmZzZXQoMCwgMCk7CiAgICAgIGlmICghbWluT2Zmc2V0KSB7CiAgICAgICAgY29uc29sZS53YXJuKCJxdWVyeWluZyBvdXRzaWRlIG9mIHBvc3NpYmxlIHRhYml4IHJhbmdlIik7CiAgICAgIH0KICAgICAgY29uc3Qgb3ZlcmxhcHBpbmdCaW5zID0gcmVnMmJpbnMobWluLCBtYXgpOwogICAgICBjb25zdCBjaHVua3MgPSBbXTsKICAgICAgZm9yIChjb25zdCBbc3RhcnQsIGVuZF0gb2Ygb3ZlcmxhcHBpbmdCaW5zKSB7CiAgICAgICAgZm9yIChsZXQgYmluID0gc3RhcnQ7IGJpbiA8PSBlbmQ7IGJpbisrKSB7CiAgICAgICAgICBpZiAoYmEuYmluSW5kZXhbYmluXSkgewogICAgICAgICAgICBjb25zdCBiaW5DaHVua3MgPSBiYS5iaW5JbmRleFtiaW5dOwogICAgICAgICAgICBmb3IgKGxldCBjMiA9IDA7IGMyIDwgYmluQ2h1bmtzLmxlbmd0aDsgKytjMikgewogICAgICAgICAgICAgIGNodW5rcy5wdXNoKG5ldyBDaHVuayhiaW5DaHVua3NbYzJdLm1pbnYsIGJpbkNodW5rc1tjMl0ubWF4diwgYmluKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgbmludHYgPSBiYS5saW5lYXJJbmRleC5sZW5ndGg7CiAgICAgIGxldCBsb3dlc3QgPSBudWxsOwogICAgICBjb25zdCBtaW5MaW4gPSBNYXRoLm1pbihtaW4gPj4gMTQsIG5pbnR2IC0gMSk7CiAgICAgIGNvbnN0IG1heExpbiA9IE1hdGgubWluKG1heCA+PiAxNCwgbmludHYgLSAxKTsKICAgICAgZm9yIChsZXQgaSA9IG1pbkxpbjsgaSA8PSBtYXhMaW47ICsraSkgewogICAgICAgIGNvbnN0IHZwID0gYmEubGluZWFySW5kZXhbaV07CiAgICAgICAgaWYgKHZwKSB7CiAgICAgICAgICBpZiAoIWxvd2VzdCB8fCB2cC5jb21wYXJlVG8obG93ZXN0KSA8IDApIHsKICAgICAgICAgICAgbG93ZXN0ID0gdnA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvcHRpbWl6ZUNodW5rcyhjaHVua3MsIGxvd2VzdCk7CiAgICB9CiAgfQogIGNvbnN0IENTSTFfTUFHSUMgPSAyMTU4MjY1OTsKICBjb25zdCBDU0kyX01BR0lDID0gMzgzNTk4NzU7CiAgZnVuY3Rpb24gbHNoaWZ0KG51bSwgYml0cykgewogICAgcmV0dXJuIG51bSAqIDIgKiogYml0czsKICB9CiAgZnVuY3Rpb24gcnNoaWZ0KG51bSwgYml0cykgewogICAgcmV0dXJuIE1hdGguZmxvb3IobnVtIC8gMiAqKiBiaXRzKTsKICB9CiAgY2xhc3MgQ1NJIGV4dGVuZHMgSW5kZXhGaWxlIHsKICAgIGNvbnN0cnVjdG9yKGFyZ3MpIHsKICAgICAgc3VwZXIoYXJncyk7CiAgICAgIHRoaXMubWF4QmluTnVtYmVyID0gMDsKICAgICAgdGhpcy5kZXB0aCA9IDA7CiAgICAgIHRoaXMubWluU2hpZnQgPSAwOwogICAgfQogICAgYXN5bmMgbGluZUNvdW50KHJlZk5hbWUsIG9wdHMgPSB7fSkgewogICAgICBjb25zdCBpbmRleERhdGEgPSBhd2FpdCB0aGlzLnBhcnNlKG9wdHMpOwogICAgICBpZiAoIWluZGV4RGF0YSkgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfQogICAgICBjb25zdCByZWZJZCA9IGluZGV4RGF0YS5yZWZOYW1lVG9JZFtyZWZOYW1lXTsKICAgICAgY29uc3QgaWR4ID0gaW5kZXhEYXRhLmluZGljZXNbcmVmSWRdOwogICAgICBpZiAoIWlkeCkgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfQogICAgICBjb25zdCB7IHN0YXRzIH0gPSBpbmRleERhdGEuaW5kaWNlc1tyZWZJZF07CiAgICAgIGlmIChzdGF0cykgewogICAgICAgIHJldHVybiBzdGF0cy5saW5lQ291bnQ7CiAgICAgIH0KICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgYXN5bmMgaW5kZXhDb3YoKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiQ1NJIGluZGV4ZXMgZG8gbm90IHN1cHBvcnQgaW5kZXhjb3YiKTsKICAgIH0KICAgIHBhcnNlQXV4RGF0YShieXRlcywgb2Zmc2V0LCBhdXhMZW5ndGgpIHsKICAgICAgaWYgKGF1eExlbmd0aCA8IDMwKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHJlZklkVG9OYW1lOiBbXSwKICAgICAgICAgIHJlZk5hbWVUb0lkOiB7fQogICAgICAgIH07CiAgICAgIH0KICAgICAgY29uc3QgZm9ybWF0RmxhZ3MgPSBieXRlcy5yZWFkSW50MzJMRShvZmZzZXQpOwogICAgICBjb25zdCBjb29yZGluYXRlVHlwZSA9IGZvcm1hdEZsYWdzICYgNjU1MzYgPyAiemVyby1iYXNlZC1oYWxmLW9wZW4iIDogIjEtYmFzZWQtY2xvc2VkIjsKICAgICAgY29uc3QgZm9ybWF0ID0geyAwOiAiZ2VuZXJpYyIsIDE6ICJTQU0iLCAyOiAiVkNGIiB9W2Zvcm1hdEZsYWdzICYgMTVdOwogICAgICBpZiAoIWZvcm1hdCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihgaW52YWxpZCBUYWJpeCBwcmVzZXQgZm9ybWF0IGZsYWdzICR7Zm9ybWF0RmxhZ3N9YCk7CiAgICAgIH0KICAgICAgY29uc3QgY29sdW1uTnVtYmVycyA9IHsKICAgICAgICByZWY6IGJ5dGVzLnJlYWRJbnQzMkxFKG9mZnNldCArIDQpLAogICAgICAgIHN0YXJ0OiBieXRlcy5yZWFkSW50MzJMRShvZmZzZXQgKyA4KSwKICAgICAgICBlbmQ6IGJ5dGVzLnJlYWRJbnQzMkxFKG9mZnNldCArIDEyKQogICAgICB9OwogICAgICBjb25zdCBtZXRhVmFsdWUgPSBieXRlcy5yZWFkSW50MzJMRShvZmZzZXQgKyAxNik7CiAgICAgIGNvbnN0IG1ldGFDaGFyID0gbWV0YVZhbHVlID8gU3RyaW5nLmZyb21DaGFyQ29kZShtZXRhVmFsdWUpIDogIiI7CiAgICAgIGNvbnN0IHNraXBMaW5lcyA9IGJ5dGVzLnJlYWRJbnQzMkxFKG9mZnNldCArIDIwKTsKICAgICAgY29uc3QgbmFtZVNlY3Rpb25MZW5ndGggPSBieXRlcy5yZWFkSW50MzJMRShvZmZzZXQgKyAyNCk7CiAgICAgIGNvbnN0IHsgcmVmSWRUb05hbWUsIHJlZk5hbWVUb0lkIH0gPSB0aGlzLl9wYXJzZU5hbWVCeXRlcyhieXRlcy5zbGljZShvZmZzZXQgKyAyOCwgb2Zmc2V0ICsgMjggKyBuYW1lU2VjdGlvbkxlbmd0aCkpOwogICAgICByZXR1cm4gewogICAgICAgIHJlZklkVG9OYW1lLAogICAgICAgIHJlZk5hbWVUb0lkLAogICAgICAgIHNraXBMaW5lcywKICAgICAgICBtZXRhQ2hhciwKICAgICAgICBjb2x1bW5OdW1iZXJzLAogICAgICAgIGZvcm1hdCwKICAgICAgICBjb29yZGluYXRlVHlwZQogICAgICB9OwogICAgfQogICAgX3BhcnNlTmFtZUJ5dGVzKG5hbWVzQnl0ZXMpIHsKICAgICAgbGV0IGN1cnJSZWZJZCA9IDA7CiAgICAgIGxldCBjdXJyTmFtZVN0YXJ0ID0gMDsKICAgICAgY29uc3QgcmVmSWRUb05hbWUgPSBbXTsKICAgICAgY29uc3QgcmVmTmFtZVRvSWQgPSB7fTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuYW1lc0J5dGVzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgaWYgKCFuYW1lc0J5dGVzW2ldKSB7CiAgICAgICAgICBpZiAoY3Vyck5hbWVTdGFydCA8IGkpIHsKICAgICAgICAgICAgbGV0IHJlZk5hbWUgPSBuYW1lc0J5dGVzLnRvU3RyaW5nKCJ1dGY4IiwgY3Vyck5hbWVTdGFydCwgaSk7CiAgICAgICAgICAgIHJlZk5hbWUgPSB0aGlzLnJlbmFtZVJlZlNlcShyZWZOYW1lKTsKICAgICAgICAgICAgcmVmSWRUb05hbWVbY3VyclJlZklkXSA9IHJlZk5hbWU7CiAgICAgICAgICAgIHJlZk5hbWVUb0lkW3JlZk5hbWVdID0gY3VyclJlZklkOwogICAgICAgICAgfQogICAgICAgICAgY3Vyck5hbWVTdGFydCA9IGkgKyAxOwogICAgICAgICAgY3VyclJlZklkICs9IDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB7IHJlZk5hbWVUb0lkLCByZWZJZFRvTmFtZSB9OwogICAgfQogICAgYXN5bmMgX3BhcnNlKG9wdHMgPSB7fSkgewogICAgICBjb25zdCBieXRlcyA9IGF3YWl0IGRpc3QudW56aXAoYXdhaXQgdGhpcy5maWxlaGFuZGxlLnJlYWRGaWxlKG9wdHMpKTsKICAgICAgbGV0IGNzaVZlcnNpb247CiAgICAgIGlmIChieXRlcy5yZWFkVUludDMyTEUoMCkgPT09IENTSTFfTUFHSUMpIHsKICAgICAgICBjc2lWZXJzaW9uID0gMTsKICAgICAgfSBlbHNlIGlmIChieXRlcy5yZWFkVUludDMyTEUoMCkgPT09IENTSTJfTUFHSUMpIHsKICAgICAgICBjc2lWZXJzaW9uID0gMjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBhIENTSSBmaWxlIik7CiAgICAgIH0KICAgICAgdGhpcy5taW5TaGlmdCA9IGJ5dGVzLnJlYWRJbnQzMkxFKDQpOwogICAgICB0aGlzLmRlcHRoID0gYnl0ZXMucmVhZEludDMyTEUoOCk7CiAgICAgIHRoaXMubWF4QmluTnVtYmVyID0gKCgxIDw8ICh0aGlzLmRlcHRoICsgMSkgKiAzKSAtIDEpIC8gNzsKICAgICAgY29uc3QgbWF4UmVmTGVuZ3RoID0gMiAqKiAodGhpcy5taW5TaGlmdCArIHRoaXMuZGVwdGggKiAzKTsKICAgICAgY29uc3QgYXV4TGVuZ3RoID0gYnl0ZXMucmVhZEludDMyTEUoMTIpOwogICAgICBsZXQgYXV4ID0gewogICAgICAgIHJlZklkVG9OYW1lOiBbXSwKICAgICAgICByZWZOYW1lVG9JZDoge30KICAgICAgfTsKICAgICAgaWYgKGF1eExlbmd0aCkgewogICAgICAgIGF1eCA9IHRoaXMucGFyc2VBdXhEYXRhKGJ5dGVzLCAxNiwgYXV4TGVuZ3RoKTsKICAgICAgfQogICAgICBjb25zdCByZWZDb3VudCA9IGJ5dGVzLnJlYWRJbnQzMkxFKDE2ICsgYXV4TGVuZ3RoKTsKICAgICAgbGV0IGZpcnN0RGF0YUxpbmU7CiAgICAgIGxldCBjdXJyT2Zmc2V0ID0gMTYgKyBhdXhMZW5ndGggKyA0OwogICAgICBjb25zdCBpbmRpY2VzID0gbmV3IEFycmF5KHJlZkNvdW50KS5maWxsKDApLm1hcCgoKSA9PiB7CiAgICAgICAgY29uc3QgYmluQ291bnQgPSBieXRlcy5yZWFkSW50MzJMRShjdXJyT2Zmc2V0KTsKICAgICAgICBjdXJyT2Zmc2V0ICs9IDQ7CiAgICAgICAgY29uc3QgYmluSW5kZXggPSB7fTsKICAgICAgICBsZXQgc3RhdHM7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBiaW5Db3VudDsgaiArPSAxKSB7CiAgICAgICAgICBjb25zdCBiaW4gPSBieXRlcy5yZWFkVUludDMyTEUoY3Vyck9mZnNldCk7CiAgICAgICAgICBpZiAoYmluID4gdGhpcy5tYXhCaW5OdW1iZXIpIHsKICAgICAgICAgICAgc3RhdHMgPSB0aGlzLnBhcnNlUHNldWRvQmluKGJ5dGVzLCBjdXJyT2Zmc2V0ICsgNCk7CiAgICAgICAgICAgIGN1cnJPZmZzZXQgKz0gNCArIDggKyA0ICsgMTYgKyAxNjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IGxvZmZzZXQgPSBmcm9tQnl0ZXMoYnl0ZXMsIGN1cnJPZmZzZXQgKyA0KTsKICAgICAgICAgICAgZmlyc3REYXRhTGluZSA9IHRoaXMuX2ZpbmRGaXJzdERhdGEoZmlyc3REYXRhTGluZSwgbG9mZnNldCk7CiAgICAgICAgICAgIGNvbnN0IGNodW5rQ291bnQgPSBieXRlcy5yZWFkSW50MzJMRShjdXJyT2Zmc2V0ICsgMTIpOwogICAgICAgICAgICBjdXJyT2Zmc2V0ICs9IDE2OwogICAgICAgICAgICBjb25zdCBjaHVua3MgPSBuZXcgQXJyYXkoY2h1bmtDb3VudCk7CiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgY2h1bmtDb3VudDsgayArPSAxKSB7CiAgICAgICAgICAgICAgY29uc3QgdSA9IGZyb21CeXRlcyhieXRlcywgY3Vyck9mZnNldCk7CiAgICAgICAgICAgICAgY29uc3QgdiA9IGZyb21CeXRlcyhieXRlcywgY3Vyck9mZnNldCArIDgpOwogICAgICAgICAgICAgIGN1cnJPZmZzZXQgKz0gMTY7CiAgICAgICAgICAgICAgY2h1bmtzW2tdID0gbmV3IENodW5rKHUsIHYsIGJpbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYmluSW5kZXhbYmluXSA9IGNodW5rczsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsgYmluSW5kZXgsIHN0YXRzIH07CiAgICAgIH0pOwogICAgICByZXR1cm4gewogICAgICAgIC4uLmF1eCwKICAgICAgICBjc2k6IHRydWUsCiAgICAgICAgcmVmQ291bnQsCiAgICAgICAgbWF4QmxvY2tTaXplOiAxIDw8IDE2LAogICAgICAgIGZpcnN0RGF0YUxpbmUsCiAgICAgICAgY3NpVmVyc2lvbiwKICAgICAgICBpbmRpY2VzLAogICAgICAgIGRlcHRoOiB0aGlzLmRlcHRoLAogICAgICAgIG1heEJpbk51bWJlcjogdGhpcy5tYXhCaW5OdW1iZXIsCiAgICAgICAgbWF4UmVmTGVuZ3RoCiAgICAgIH07CiAgICB9CiAgICBwYXJzZVBzZXVkb0JpbihieXRlcywgb2Zmc2V0KSB7CiAgICAgIGNvbnN0IGxpbmVDb3VudCA9IGxvbmdUb051bWJlcihsb25nLmZyb21CeXRlc0xFKEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGJ5dGVzLCBvZmZzZXQgKyAyOCwgb2Zmc2V0ICsgMzYpLCB0cnVlKSk7CiAgICAgIHJldHVybiB7IGxpbmVDb3VudCB9OwogICAgfQogICAgYXN5bmMgYmxvY2tzRm9yUmFuZ2UocmVmTmFtZSwgbWluLCBtYXgsIG9wdHMgPSB7fSkgewogICAgICBpZiAobWluIDwgMCkgewogICAgICAgIG1pbiA9IDA7CiAgICAgIH0KICAgICAgY29uc3QgaW5kZXhEYXRhID0gYXdhaXQgdGhpcy5wYXJzZShvcHRzKTsKICAgICAgaWYgKCFpbmRleERhdGEpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgICAgY29uc3QgcmVmSWQgPSBpbmRleERhdGEucmVmTmFtZVRvSWRbcmVmTmFtZV07CiAgICAgIGNvbnN0IGJhID0gaW5kZXhEYXRhLmluZGljZXNbcmVmSWRdOwogICAgICBpZiAoIWJhKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICAgIGNvbnN0IG92ZXJsYXBwaW5nQmlucyA9IHRoaXMucmVnMmJpbnMobWluLCBtYXgpOwogICAgICBjb25zdCBjaHVua3MgPSBbXTsKICAgICAgZm9yIChjb25zdCBbc3RhcnQsIGVuZF0gb2Ygb3ZlcmxhcHBpbmdCaW5zKSB7CiAgICAgICAgZm9yIChsZXQgYmluID0gc3RhcnQ7IGJpbiA8PSBlbmQ7IGJpbisrKSB7CiAgICAgICAgICBpZiAoYmEuYmluSW5kZXhbYmluXSkgewogICAgICAgICAgICBjb25zdCBiaW5DaHVua3MgPSBiYS5iaW5JbmRleFtiaW5dOwogICAgICAgICAgICBmb3IgKGxldCBjMiA9IDA7IGMyIDwgYmluQ2h1bmtzLmxlbmd0aDsgKytjMikgewogICAgICAgICAgICAgIGNodW5rcy5wdXNoKG5ldyBDaHVuayhiaW5DaHVua3NbYzJdLm1pbnYsIGJpbkNodW5rc1tjMl0ubWF4diwgYmluKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG9wdGltaXplQ2h1bmtzKGNodW5rcywgbmV3IFZpcnR1YWxPZmZzZXQoMCwgMCkpOwogICAgfQogICAgcmVnMmJpbnMoYmVnLCBlbmQpIHsKICAgICAgYmVnIC09IDE7CiAgICAgIGlmIChiZWcgPCAxKSB7CiAgICAgICAgYmVnID0gMTsKICAgICAgfQogICAgICBpZiAoZW5kID4gMiAqKiA1MCkgewogICAgICAgIGVuZCA9IDIgKiogMzQ7CiAgICAgIH0KICAgICAgZW5kIC09IDE7CiAgICAgIGxldCBsID0gMDsKICAgICAgbGV0IHQgPSAwOwogICAgICBsZXQgcyA9IHRoaXMubWluU2hpZnQgKyB0aGlzLmRlcHRoICogMzsKICAgICAgY29uc3QgYmlucyA9IFtdOwogICAgICBmb3IgKDsgbCA8PSB0aGlzLmRlcHRoOyBzIC09IDMsIHQgKz0gbHNoaWZ0KDEsIGwgKiAzKSwgbCArPSAxKSB7CiAgICAgICAgY29uc3QgYiA9IHQgKyByc2hpZnQoYmVnLCBzKTsKICAgICAgICBjb25zdCBlID0gdCArIHJzaGlmdChlbmQsIHMpOwogICAgICAgIGlmIChlIC0gYiArIGJpbnMubGVuZ3RoID4gdGhpcy5tYXhCaW5OdW1iZXIpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgcXVlcnkgJHtiZWd9LSR7ZW5kfSBpcyB0b28gbGFyZ2UgZm9yIGN1cnJlbnQgYmlubmluZyBzY2hlbWUgKHNoaWZ0ICR7dGhpcy5taW5TaGlmdH0sIGRlcHRoICR7dGhpcy5kZXB0aH0pLCB0cnkgYSBzbWFsbGVyIHF1ZXJ5IG9yIGEgY29hcnNlciBpbmRleCBiaW5uaW5nIHNjaGVtZWApOwogICAgICAgIH0KICAgICAgICBiaW5zLnB1c2goW2IsIGVdKTsKICAgICAgfQogICAgICByZXR1cm4gYmluczsKICAgIH0KICB9CiAgZnVuY3Rpb24gdGltZW91dCh0aW1lKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgc2V0VGltZW91dChyZXNvbHZlLCB0aW1lKTsKICAgIH0pOwogIH0KICBjbGFzcyBUYWJpeEluZGV4ZWRGaWxlIHsKICAgIGNvbnN0cnVjdG9yKHsgcGF0aCwgZmlsZWhhbmRsZTogZmlsZWhhbmRsZTIsIHRiaVBhdGgsIHRiaUZpbGVoYW5kbGUsIGNzaVBhdGgsIGNzaUZpbGVoYW5kbGUsIGNodW5rU2l6ZUxpbWl0ID0gNWU3LCByZW5hbWVSZWZTZXFzID0gKG4pID0+IG4sIGNodW5rQ2FjaGVTaXplID0gNSAqIDIgKiogMjAgfSkgewogICAgICBpZiAoZmlsZWhhbmRsZTIpIHsKICAgICAgICB0aGlzLmZpbGVoYW5kbGUgPSBmaWxlaGFuZGxlMjsKICAgICAgfSBlbHNlIGlmIChwYXRoKSB7CiAgICAgICAgdGhpcy5maWxlaGFuZGxlID0gbmV3IGRpc3QkMS5Mb2NhbEZpbGUocGF0aCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigibXVzdCBwcm92aWRlIGVpdGhlciBmaWxlaGFuZGxlIG9yIHBhdGgiKTsKICAgICAgfQogICAgICBpZiAodGJpRmlsZWhhbmRsZSkgewogICAgICAgIHRoaXMuaW5kZXggPSBuZXcgVGFiaXhJbmRleCh7CiAgICAgICAgICBmaWxlaGFuZGxlOiB0YmlGaWxlaGFuZGxlLAogICAgICAgICAgcmVuYW1lUmVmU2VxcwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKGNzaUZpbGVoYW5kbGUpIHsKICAgICAgICB0aGlzLmluZGV4ID0gbmV3IENTSSh7CiAgICAgICAgICBmaWxlaGFuZGxlOiBjc2lGaWxlaGFuZGxlLAogICAgICAgICAgcmVuYW1lUmVmU2VxcwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKHRiaVBhdGgpIHsKICAgICAgICB0aGlzLmluZGV4ID0gbmV3IFRhYml4SW5kZXgoewogICAgICAgICAgZmlsZWhhbmRsZTogbmV3IGRpc3QkMS5Mb2NhbEZpbGUodGJpUGF0aCksCiAgICAgICAgICByZW5hbWVSZWZTZXFzCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAoY3NpUGF0aCkgewogICAgICAgIHRoaXMuaW5kZXggPSBuZXcgQ1NJKHsKICAgICAgICAgIGZpbGVoYW5kbGU6IG5ldyBkaXN0JDEuTG9jYWxGaWxlKGNzaVBhdGgpLAogICAgICAgICAgcmVuYW1lUmVmU2VxcwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKHBhdGgpIHsKICAgICAgICB0aGlzLmluZGV4ID0gbmV3IFRhYml4SW5kZXgoewogICAgICAgICAgZmlsZWhhbmRsZTogbmV3IGRpc3QkMS5Mb2NhbEZpbGUoYCR7cGF0aH0udGJpYCksCiAgICAgICAgICByZW5hbWVSZWZTZXFzCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigibXVzdCBwcm92aWRlIG9uZSBvZiB0YmlGaWxlaGFuZGxlLCB0YmlQYXRoLCBjc2lGaWxlaGFuZGxlLCBvciBjc2lQYXRoIik7CiAgICAgIH0KICAgICAgdGhpcy5jaHVua1NpemVMaW1pdCA9IGNodW5rU2l6ZUxpbWl0OwogICAgICB0aGlzLnJlbmFtZVJlZlNlcSA9IHJlbmFtZVJlZlNlcXM7CiAgICAgIHRoaXMuY2h1bmtDYWNoZSA9IG5ldyBfZGVmYXVsdCh7CiAgICAgICAgY2FjaGU6IG5ldyBxdWlja0xydSh7CiAgICAgICAgICBtYXhTaXplOiBNYXRoLmZsb29yKGNodW5rQ2FjaGVTaXplIC8gKDEgPDwgMTYpKQogICAgICAgIH0pLAogICAgICAgIGZpbGw6IHRoaXMucmVhZENodW5rLmJpbmQodGhpcykKICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBnZXRMaW5lcyhyZWZOYW1lLCBzdGFydCwgZW5kLCBvcHRzKSB7CiAgICAgIGxldCBzaWduYWw7CiAgICAgIGxldCBvcHRpb25zID0ge307CiAgICAgIGxldCBjYWxsYmFjazsKICAgICAgaWYgKHR5cGVvZiBvcHRzID09PSAidW5kZWZpbmVkIikgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImxpbmUgY2FsbGJhY2sgbXVzdCBiZSBwcm92aWRlZCIpOwogICAgICB9CiAgICAgIGlmICh0eXBlb2Ygb3B0cyA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIGNhbGxiYWNrID0gb3B0czsKICAgICAgfSBlbHNlIHsKICAgICAgICBvcHRpb25zID0gb3B0czsKICAgICAgICBjYWxsYmFjayA9IG9wdHMubGluZUNhbGxiYWNrOwogICAgICB9CiAgICAgIGlmIChyZWZOYW1lID09PSB2b2lkIDApIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJtdXN0IHByb3ZpZGUgYSByZWZlcmVuY2Ugc2VxdWVuY2UgbmFtZSIpOwogICAgICB9CiAgICAgIGlmICghY2FsbGJhY2spIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJsaW5lIGNhbGxiYWNrIG11c3QgYmUgcHJvdmlkZWQiKTsKICAgICAgfQogICAgICBjb25zdCBtZXRhZGF0YSA9IGF3YWl0IHRoaXMuaW5kZXguZ2V0TWV0YWRhdGEob3B0aW9ucyk7CiAgICAgIGNoZWNrQWJvcnRTaWduYWwoc2lnbmFsKTsKICAgICAgaWYgKCFzdGFydCkgewogICAgICAgIHN0YXJ0ID0gMDsKICAgICAgfQogICAgICBpZiAoIWVuZCkgewogICAgICAgIGVuZCA9IG1ldGFkYXRhLm1heFJlZkxlbmd0aDsKICAgICAgfQogICAgICBpZiAoIShzdGFydCA8PSBlbmQpKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiaW52YWxpZCBzdGFydCBhbmQgZW5kIGNvb3JkaW5hdGVzLiBzdGFydCBtdXN0IGJlIGxlc3MgdGhhbiBvciBlcXVhbCB0byBlbmQiKTsKICAgICAgfQogICAgICBpZiAoc3RhcnQgPT09IGVuZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBjaHVua3MgPSBhd2FpdCB0aGlzLmluZGV4LmJsb2Nrc0ZvclJhbmdlKHJlZk5hbWUsIHN0YXJ0LCBlbmQsIG9wdGlvbnMpOwogICAgICBjaGVja0Fib3J0U2lnbmFsKHNpZ25hbCk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2h1bmtzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgY29uc3Qgc2l6ZSA9IGNodW5rc1tpXS5mZXRjaGVkU2l6ZSgpOwogICAgICAgIGlmIChzaXplID4gdGhpcy5jaHVua1NpemVMaW1pdCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUb28gbXVjaCBkYXRhLiBDaHVuayBzaXplICR7c2l6ZS50b0xvY2FsZVN0cmluZygpfSBieXRlcyBleGNlZWRzIGNodW5rU2l6ZUxpbWl0IG9mICR7dGhpcy5jaHVua1NpemVMaW1pdC50b0xvY2FsZVN0cmluZygpfS5gKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgbGV0IGxhc3QgPSBEYXRlLm5vdygpOwogICAgICBmb3IgKGxldCBjaHVua051bSA9IDA7IGNodW5rTnVtIDwgY2h1bmtzLmxlbmd0aDsgY2h1bmtOdW0gKz0gMSkgewogICAgICAgIGxldCBwcmV2aW91c1N0YXJ0Q29vcmRpbmF0ZTsKICAgICAgICBjb25zdCBjMiA9IGNodW5rc1tjaHVua051bV07CiAgICAgICAgY29uc3QgeyBidWZmZXIsIGNwb3NpdGlvbnMsIGRwb3NpdGlvbnMgfSA9IGF3YWl0IHRoaXMuY2h1bmtDYWNoZS5nZXQoYzIudG9TdHJpbmcoKSwgYzIsIHNpZ25hbCk7CiAgICAgICAgY29uc3QgbGluZXMgPSAodHlwZW9mIFRleHREZWNvZGVyICE9PSAidW5kZWZpbmVkIiA/IG5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUoYnVmZmVyKSA6IGJ1ZmZlci50b1N0cmluZygpKS5zcGxpdCgiXG4iKTsKICAgICAgICBsaW5lcy5wb3AoKTsKICAgICAgICBjaGVja0Fib3J0U2lnbmFsKHNpZ25hbCk7CiAgICAgICAgbGV0IGJsb2NrU3RhcnQgPSBjMi5taW52LmRhdGFQb3NpdGlvbjsKICAgICAgICBsZXQgcG9zOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgIGNvbnN0IGxpbmUgPSBsaW5lc1tpXTsKICAgICAgICAgIGZvciAocG9zID0gMDsgYmxvY2tTdGFydCA+PSBkcG9zaXRpb25zW3Bvc107IHBvcyArPSAxKSB7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCB7IHN0YXJ0Q29vcmRpbmF0ZSwgb3ZlcmxhcHMgfSA9IHRoaXMuY2hlY2tMaW5lKG1ldGFkYXRhLCByZWZOYW1lLCBzdGFydCwgZW5kLCBsaW5lKTsKICAgICAgICAgIGlmIChwcmV2aW91c1N0YXJ0Q29vcmRpbmF0ZSAhPT0gdm9pZCAwICYmIHN0YXJ0Q29vcmRpbmF0ZSAhPT0gdm9pZCAwICYmIHByZXZpb3VzU3RhcnRDb29yZGluYXRlID4gc3RhcnRDb29yZGluYXRlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTGluZXMgbm90IHNvcnRlZCBieSBzdGFydCBjb29yZGluYXRlICgke3ByZXZpb3VzU3RhcnRDb29yZGluYXRlfSA+ICR7c3RhcnRDb29yZGluYXRlfSksIHRoaXMgZmlsZSBpcyBub3QgdXNhYmxlIHdpdGggVGFiaXguYCk7CiAgICAgICAgICB9CiAgICAgICAgICBwcmV2aW91c1N0YXJ0Q29vcmRpbmF0ZSA9IHN0YXJ0Q29vcmRpbmF0ZTsKICAgICAgICAgIGlmIChvdmVybGFwcykgewogICAgICAgICAgICBjYWxsYmFjayhsaW5lLnRyaW0oKSwgY3Bvc2l0aW9uc1twb3NdICogKDEgPDwgOCkgKyAoYmxvY2tTdGFydCAtIGRwb3NpdGlvbnNbcG9zXSkpOwogICAgICAgICAgfSBlbHNlIGlmIChzdGFydENvb3JkaW5hdGUgIT09IHZvaWQgMCAmJiBzdGFydENvb3JkaW5hdGUgPj0gZW5kKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGJsb2NrU3RhcnQgKz0gbGluZS5sZW5ndGggKyAxOwogICAgICAgICAgaWYgKGxhc3QgLSBEYXRlLm5vdygpID4gNTAwKSB7CiAgICAgICAgICAgIGxhc3QgPSBEYXRlLm5vdygpOwogICAgICAgICAgICBjaGVja0Fib3J0U2lnbmFsKHNpZ25hbCk7CiAgICAgICAgICAgIGF3YWl0IHRpbWVvdXQoMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBhc3luYyBnZXRNZXRhZGF0YShvcHRzID0ge30pIHsKICAgICAgcmV0dXJuIHRoaXMuaW5kZXguZ2V0TWV0YWRhdGEob3B0cyk7CiAgICB9CiAgICBhc3luYyBnZXRIZWFkZXJCdWZmZXIob3B0cyA9IHt9KSB7CiAgICAgIGNvbnN0IHsgZmlyc3REYXRhTGluZSwgbWV0YUNoYXIsIG1heEJsb2NrU2l6ZSB9ID0gYXdhaXQgdGhpcy5nZXRNZXRhZGF0YShvcHRzKTsKICAgICAgY2hlY2tBYm9ydFNpZ25hbChvcHRzLnNpZ25hbCk7CiAgICAgIGNvbnN0IG1heEZldGNoID0gZmlyc3REYXRhTGluZSAmJiBmaXJzdERhdGFMaW5lLmJsb2NrUG9zaXRpb24gPyBmaXJzdERhdGFMaW5lLmJsb2NrUG9zaXRpb24gKyBtYXhCbG9ja1NpemUgOiBtYXhCbG9ja1NpemU7CiAgICAgIGxldCBieXRlcyA9IGF3YWl0IHRoaXMuX3JlYWRSZWdpb24oMCwgbWF4RmV0Y2gsIG9wdHMpOwogICAgICBjaGVja0Fib3J0U2lnbmFsKG9wdHMuc2lnbmFsKTsKICAgICAgdHJ5IHsKICAgICAgICBieXRlcyA9IGF3YWl0IGRpc3QudW56aXAoYnl0ZXMpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGVycm9yIGRlY29tcHJlc3NpbmcgYmxvY2sgJHtlLmNvZGV9IGF0IDAgKGxlbmd0aCAke21heEZldGNofSkgJHtlfWApOwogICAgICB9CiAgICAgIGlmIChtZXRhQ2hhcikgewogICAgICAgIGxldCBsYXN0TmV3bGluZSA9IC0xOwogICAgICAgIGNvbnN0IG5ld2xpbmVCeXRlID0gIlxuIi5jaGFyQ29kZUF0KDApOwogICAgICAgIGNvbnN0IG1ldGFCeXRlID0gbWV0YUNoYXIuY2hhckNvZGVBdCgwKTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ5dGVzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICBpZiAoaSA9PT0gbGFzdE5ld2xpbmUgKyAxICYmIGJ5dGVzW2ldICE9PSBtZXRhQnl0ZSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChieXRlc1tpXSA9PT0gbmV3bGluZUJ5dGUpIHsKICAgICAgICAgICAgbGFzdE5ld2xpbmUgPSBpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBieXRlcyA9IGJ5dGVzLnNsaWNlKDAsIGxhc3ROZXdsaW5lICsgMSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGJ5dGVzOwogICAgfQogICAgYXN5bmMgZ2V0SGVhZGVyKG9wdHMgPSB7fSkgewogICAgICBjb25zdCBieXRlcyA9IGF3YWl0IHRoaXMuZ2V0SGVhZGVyQnVmZmVyKG9wdHMpOwogICAgICBjaGVja0Fib3J0U2lnbmFsKG9wdHMuc2lnbmFsKTsKICAgICAgcmV0dXJuIGJ5dGVzLnRvU3RyaW5nKCJ1dGY4Iik7CiAgICB9CiAgICBhc3luYyBnZXRSZWZlcmVuY2VTZXF1ZW5jZU5hbWVzKG9wdHMgPSB7fSkgewogICAgICBjb25zdCBtZXRhZGF0YSA9IGF3YWl0IHRoaXMuZ2V0TWV0YWRhdGEob3B0cyk7CiAgICAgIHJldHVybiBtZXRhZGF0YS5yZWZJZFRvTmFtZTsKICAgIH0KICAgIGNoZWNrTGluZSh7IGNvbHVtbk51bWJlcnMsIG1ldGFDaGFyLCBjb29yZGluYXRlVHlwZSwgZm9ybWF0IH0sIHJlZ2lvblJlZk5hbWUsIHJlZ2lvblN0YXJ0LCByZWdpb25FbmQsIGxpbmUpIHsKICAgICAgaWYgKGxpbmUuY2hhckF0KDApID09PSBtZXRhQ2hhcikgewogICAgICAgIHJldHVybiB7IG92ZXJsYXBzOiBmYWxzZSB9OwogICAgICB9CiAgICAgIGxldCB7IHJlZiwgc3RhcnQsIGVuZCB9ID0gY29sdW1uTnVtYmVyczsKICAgICAgaWYgKCFyZWYpIHsKICAgICAgICByZWYgPSAwOwogICAgICB9CiAgICAgIGlmICghc3RhcnQpIHsKICAgICAgICBzdGFydCA9IDA7CiAgICAgIH0KICAgICAgaWYgKCFlbmQpIHsKICAgICAgICBlbmQgPSAwOwogICAgICB9CiAgICAgIGlmIChmb3JtYXQgPT09ICJWQ0YiKSB7CiAgICAgICAgZW5kID0gODsKICAgICAgfQogICAgICBjb25zdCBtYXhDb2x1bW4gPSBNYXRoLm1heChyZWYsIHN0YXJ0LCBlbmQpOwogICAgICBsZXQgY3VycmVudENvbHVtbk51bWJlciA9IDE7CiAgICAgIGxldCBjdXJyZW50Q29sdW1uU3RhcnQgPSAwOwogICAgICBsZXQgcmVmU2VxID0gIiI7CiAgICAgIGxldCBzdGFydENvb3JkaW5hdGUgPSAtSW5maW5pdHk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZS5sZW5ndGggKyAxOyBpICs9IDEpIHsKICAgICAgICBpZiAobGluZVtpXSA9PT0gIgkiIHx8IGkgPT09IGxpbmUubGVuZ3RoKSB7CiAgICAgICAgICBpZiAoY3VycmVudENvbHVtbk51bWJlciA9PT0gcmVmKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnJlbmFtZVJlZlNlcShsaW5lLnNsaWNlKGN1cnJlbnRDb2x1bW5TdGFydCwgaSkpICE9PSByZWdpb25SZWZOYW1lKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsgb3ZlcmxhcHM6IGZhbHNlIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoY3VycmVudENvbHVtbk51bWJlciA9PT0gc3RhcnQpIHsKICAgICAgICAgICAgc3RhcnRDb29yZGluYXRlID0gcGFyc2VJbnQobGluZS5zbGljZShjdXJyZW50Q29sdW1uU3RhcnQsIGkpLCAxMCk7CiAgICAgICAgICAgIGlmIChjb29yZGluYXRlVHlwZSA9PT0gIjEtYmFzZWQtY2xvc2VkIikgewogICAgICAgICAgICAgIHN0YXJ0Q29vcmRpbmF0ZSAtPSAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGFydENvb3JkaW5hdGUgPj0gcmVnaW9uRW5kKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsgc3RhcnRDb29yZGluYXRlLCBvdmVybGFwczogZmFsc2UgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZW5kID09PSAwIHx8IGVuZCA9PT0gc3RhcnQpIHsKICAgICAgICAgICAgICBpZiAoc3RhcnRDb29yZGluYXRlICsgMSA8PSByZWdpb25TdGFydCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHsgc3RhcnRDb29yZGluYXRlLCBvdmVybGFwczogZmFsc2UgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09PSAiVkNGIiAmJiBjdXJyZW50Q29sdW1uTnVtYmVyID09PSA0KSB7CiAgICAgICAgICAgIHJlZlNlcSA9IGxpbmUuc2xpY2UoY3VycmVudENvbHVtblN0YXJ0LCBpKTsKICAgICAgICAgIH0gZWxzZSBpZiAoY3VycmVudENvbHVtbk51bWJlciA9PT0gZW5kKSB7CiAgICAgICAgICAgIGxldCBlbmRDb29yZGluYXRlOwogICAgICAgICAgICBpZiAoZm9ybWF0ID09PSAiVkNGIikgewogICAgICAgICAgICAgIGVuZENvb3JkaW5hdGUgPSB0aGlzLl9nZXRWY2ZFbmQoc3RhcnRDb29yZGluYXRlLCByZWZTZXEsIGxpbmUuc2xpY2UoY3VycmVudENvbHVtblN0YXJ0LCBpKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZW5kQ29vcmRpbmF0ZSA9IHBhcnNlSW50KGxpbmUuc2xpY2UoY3VycmVudENvbHVtblN0YXJ0LCBpKSwgMTApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlbmRDb29yZGluYXRlIDw9IHJlZ2lvblN0YXJ0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsgb3ZlcmxhcHM6IGZhbHNlIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGN1cnJlbnRDb2x1bW5TdGFydCA9IGkgKyAxOwogICAgICAgICAgY3VycmVudENvbHVtbk51bWJlciArPSAxOwogICAgICAgICAgaWYgKGN1cnJlbnRDb2x1bW5OdW1iZXIgPiBtYXhDb2x1bW4pIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB7IHN0YXJ0Q29vcmRpbmF0ZSwgb3ZlcmxhcHM6IHRydWUgfTsKICAgIH0KICAgIF9nZXRWY2ZFbmQoc3RhcnRDb29yZGluYXRlLCByZWZTZXEsIGluZm8pIHsKICAgICAgbGV0IGVuZENvb3JkaW5hdGUgPSBzdGFydENvb3JkaW5hdGUgKyByZWZTZXEubGVuZ3RoOwogICAgICBjb25zdCBpc1RSQSA9IGluZm8uaW5kZXhPZigiU1ZUWVBFPVRSQSIpICE9PSAtMTsKICAgICAgaWYgKGluZm9bMF0gIT09ICIuIiAmJiAhaXNUUkEpIHsKICAgICAgICBsZXQgcHJldkNoYXIgPSAiOyI7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBpbmZvLmxlbmd0aDsgaiArPSAxKSB7CiAgICAgICAgICBpZiAocHJldkNoYXIgPT09ICI7IiAmJiBpbmZvLnNsaWNlKGosIGogKyA0KSA9PT0gIkVORD0iKSB7CiAgICAgICAgICAgIGxldCB2YWx1ZUVuZCA9IGluZm8uaW5kZXhPZigiOyIsIGopOwogICAgICAgICAgICBpZiAodmFsdWVFbmQgPT09IC0xKSB7CiAgICAgICAgICAgICAgdmFsdWVFbmQgPSBpbmZvLmxlbmd0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbmRDb29yZGluYXRlID0gcGFyc2VJbnQoaW5mby5zbGljZShqICsgNCwgdmFsdWVFbmQpLCAxMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgcHJldkNoYXIgPSBpbmZvW2pdOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChpc1RSQSkgewogICAgICAgIHJldHVybiBzdGFydENvb3JkaW5hdGUgKyAxOwogICAgICB9CiAgICAgIHJldHVybiBlbmRDb29yZGluYXRlOwogICAgfQogICAgYXN5bmMgbGluZUNvdW50KHJlZk5hbWUsIG9wdHMgPSB7fSkgewogICAgICByZXR1cm4gdGhpcy5pbmRleC5saW5lQ291bnQocmVmTmFtZSwgb3B0cyk7CiAgICB9CiAgICBhc3luYyBfcmVhZFJlZ2lvbihwb3NpdGlvbiwgY29tcHJlc3NlZFNpemUsIG9wdHMgPSB7fSkgewogICAgICBjb25zdCB7IGJ5dGVzUmVhZCwgYnVmZmVyIH0gPSBhd2FpdCB0aGlzLmZpbGVoYW5kbGUucmVhZChCdWZmZXIuYWxsb2MoY29tcHJlc3NlZFNpemUpLCAwLCBjb21wcmVzc2VkU2l6ZSwgcG9zaXRpb24sIG9wdHMpOwogICAgICByZXR1cm4gYnl0ZXNSZWFkIDwgY29tcHJlc3NlZFNpemUgPyBidWZmZXIuc2xpY2UoMCwgYnl0ZXNSZWFkKSA6IGJ1ZmZlcjsKICAgIH0KICAgIGFzeW5jIHJlYWRDaHVuayhjaHVuaywgb3B0cyA9IHt9KSB7CiAgICAgIGNvbnN0IGNvbXByZXNzZWREYXRhID0gYXdhaXQgdGhpcy5fcmVhZFJlZ2lvbihjaHVuay5taW52LmJsb2NrUG9zaXRpb24sIGNodW5rLmZldGNoZWRTaXplKCksIG9wdHMpOwogICAgICB0cnkgewogICAgICAgIHJldHVybiBkaXN0LnVuemlwQ2h1bmtTbGljZShjb21wcmVzc2VkRGF0YSwgY2h1bmspOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBlcnJvciBkZWNvbXByZXNzaW5nIGNodW5rICR7Y2h1bmsudG9TdHJpbmcoKX0gJHtlfWApOwogICAgICB9CiAgICB9CiAgfQogIHZhciB3b3JrZXIgPSB7fTsKICB2YXIgaXNPYnNlcnZhYmxlID0gKHZhbHVlKSA9PiB7CiAgICBpZiAoIXZhbHVlKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0eXBlb2YgU3ltYm9sLm9ic2VydmFibGUgPT09ICJzeW1ib2wiICYmIHR5cGVvZiB2YWx1ZVtTeW1ib2wub2JzZXJ2YWJsZV0gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgcmV0dXJuIHZhbHVlID09PSB2YWx1ZVtTeW1ib2wub2JzZXJ2YWJsZV0oKTsKICAgIH0KICAgIGlmICh0eXBlb2YgdmFsdWVbIkBAb2JzZXJ2YWJsZSJdID09PSAiZnVuY3Rpb24iKSB7CiAgICAgIHJldHVybiB2YWx1ZSA9PT0gdmFsdWVbIkBAb2JzZXJ2YWJsZSJdKCk7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfTsKICB2YXIgY29tbW9uID0ge307CiAgdmFyIHNlcmlhbGl6ZXJzID0ge307CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNlcmlhbGl6ZXJzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgc2VyaWFsaXplcnMuRGVmYXVsdFNlcmlhbGl6ZXIgPSBzZXJpYWxpemVycy5leHRlbmRTZXJpYWxpemVyID0gdm9pZCAwOwogIGZ1bmN0aW9uIGV4dGVuZFNlcmlhbGl6ZXIoZXh0ZW5kLCBpbXBsZW1lbnRhdGlvbikgewogICAgY29uc3QgZmFsbGJhY2tEZXNlcmlhbGl6ZXIgPSBleHRlbmQuZGVzZXJpYWxpemUuYmluZChleHRlbmQpOwogICAgY29uc3QgZmFsbGJhY2tTZXJpYWxpemVyID0gZXh0ZW5kLnNlcmlhbGl6ZS5iaW5kKGV4dGVuZCk7CiAgICByZXR1cm4gewogICAgICBkZXNlcmlhbGl6ZShtZXNzYWdlKSB7CiAgICAgICAgcmV0dXJuIGltcGxlbWVudGF0aW9uLmRlc2VyaWFsaXplKG1lc3NhZ2UsIGZhbGxiYWNrRGVzZXJpYWxpemVyKTsKICAgICAgfSwKICAgICAgc2VyaWFsaXplKGlucHV0KSB7CiAgICAgICAgcmV0dXJuIGltcGxlbWVudGF0aW9uLnNlcmlhbGl6ZShpbnB1dCwgZmFsbGJhY2tTZXJpYWxpemVyKTsKICAgICAgfQogICAgfTsKICB9CiAgc2VyaWFsaXplcnMuZXh0ZW5kU2VyaWFsaXplciA9IGV4dGVuZFNlcmlhbGl6ZXI7CiAgY29uc3QgRGVmYXVsdEVycm9yU2VyaWFsaXplciA9IHsKICAgIGRlc2VyaWFsaXplKG1lc3NhZ2UpIHsKICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oRXJyb3IobWVzc2FnZS5tZXNzYWdlKSwgewogICAgICAgIG5hbWU6IG1lc3NhZ2UubmFtZSwKICAgICAgICBzdGFjazogbWVzc2FnZS5zdGFjawogICAgICB9KTsKICAgIH0sCiAgICBzZXJpYWxpemUoZXJyb3IpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBfX2Vycm9yX21hcmtlcjogIiQkZXJyb3IiLAogICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsCiAgICAgICAgbmFtZTogZXJyb3IubmFtZSwKICAgICAgICBzdGFjazogZXJyb3Iuc3RhY2sKICAgICAgfTsKICAgIH0KICB9OwogIGNvbnN0IGlzU2VyaWFsaXplZEVycm9yID0gKHRoaW5nKSA9PiB0aGluZyAmJiB0eXBlb2YgdGhpbmcgPT09ICJvYmplY3QiICYmICJfX2Vycm9yX21hcmtlciIgaW4gdGhpbmcgJiYgdGhpbmcuX19lcnJvcl9tYXJrZXIgPT09ICIkJGVycm9yIjsKICBzZXJpYWxpemVycy5EZWZhdWx0U2VyaWFsaXplciA9IHsKICAgIGRlc2VyaWFsaXplKG1lc3NhZ2UpIHsKICAgICAgaWYgKGlzU2VyaWFsaXplZEVycm9yKG1lc3NhZ2UpKSB7CiAgICAgICAgcmV0dXJuIERlZmF1bHRFcnJvclNlcmlhbGl6ZXIuZGVzZXJpYWxpemUobWVzc2FnZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG1lc3NhZ2U7CiAgICAgIH0KICAgIH0sCiAgICBzZXJpYWxpemUoaW5wdXQpIHsKICAgICAgaWYgKGlucHV0IGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgICByZXR1cm4gRGVmYXVsdEVycm9yU2VyaWFsaXplci5zZXJpYWxpemUoaW5wdXQpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBpbnB1dDsKICAgICAgfQogICAgfQogIH07CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvbW1vbiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogIGNvbW1vbi5zZXJpYWxpemUgPSBjb21tb24uZGVzZXJpYWxpemUgPSBjb21tb24ucmVnaXN0ZXJTZXJpYWxpemVyID0gdm9pZCAwOwogIGNvbnN0IHNlcmlhbGl6ZXJzXzEgPSBzZXJpYWxpemVyczsKICBsZXQgcmVnaXN0ZXJlZFNlcmlhbGl6ZXIgPSBzZXJpYWxpemVyc18xLkRlZmF1bHRTZXJpYWxpemVyOwogIGZ1bmN0aW9uIHJlZ2lzdGVyU2VyaWFsaXplcihzZXJpYWxpemVyKSB7CiAgICByZWdpc3RlcmVkU2VyaWFsaXplciA9IHNlcmlhbGl6ZXJzXzEuZXh0ZW5kU2VyaWFsaXplcihyZWdpc3RlcmVkU2VyaWFsaXplciwgc2VyaWFsaXplcik7CiAgfQogIGNvbW1vbi5yZWdpc3RlclNlcmlhbGl6ZXIgPSByZWdpc3RlclNlcmlhbGl6ZXI7CiAgZnVuY3Rpb24gZGVzZXJpYWxpemUobWVzc2FnZSkgewogICAgcmV0dXJuIHJlZ2lzdGVyZWRTZXJpYWxpemVyLmRlc2VyaWFsaXplKG1lc3NhZ2UpOwogIH0KICBjb21tb24uZGVzZXJpYWxpemUgPSBkZXNlcmlhbGl6ZTsKICBmdW5jdGlvbiBzZXJpYWxpemUoaW5wdXQpIHsKICAgIHJldHVybiByZWdpc3RlcmVkU2VyaWFsaXplci5zZXJpYWxpemUoaW5wdXQpOwogIH0KICBjb21tb24uc2VyaWFsaXplID0gc2VyaWFsaXplOwogIHZhciB0cmFuc2ZlcmFibGUgPSB7fTsKICB2YXIgc3ltYm9scyA9IHt9OwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzeW1ib2xzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgc3ltYm9scy4kd29ya2VyID0gc3ltYm9scy4kdHJhbnNmZXJhYmxlID0gc3ltYm9scy4kdGVybWluYXRlID0gc3ltYm9scy4kZXZlbnRzID0gc3ltYm9scy4kZXJyb3JzID0gdm9pZCAwOwogIHN5bWJvbHMuJGVycm9ycyA9IFN5bWJvbCgidGhyZWFkLmVycm9ycyIpOwogIHN5bWJvbHMuJGV2ZW50cyA9IFN5bWJvbCgidGhyZWFkLmV2ZW50cyIpOwogIHN5bWJvbHMuJHRlcm1pbmF0ZSA9IFN5bWJvbCgidGhyZWFkLnRlcm1pbmF0ZSIpOwogIHN5bWJvbHMuJHRyYW5zZmVyYWJsZSA9IFN5bWJvbCgidGhyZWFkLnRyYW5zZmVyYWJsZSIpOwogIHN5bWJvbHMuJHdvcmtlciA9IFN5bWJvbCgidGhyZWFkLndvcmtlciIpOwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0cmFuc2ZlcmFibGUsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKICB0cmFuc2ZlcmFibGUuVHJhbnNmZXIgPSB0cmFuc2ZlcmFibGUuaXNUcmFuc2ZlckRlc2NyaXB0b3IgPSB2b2lkIDA7CiAgY29uc3Qgc3ltYm9sc18xID0gc3ltYm9sczsKICBmdW5jdGlvbiBpc1RyYW5zZmVyYWJsZSh0aGluZykgewogICAgaWYgKCF0aGluZyB8fCB0eXBlb2YgdGhpbmcgIT09ICJvYmplY3QiKQogICAgICByZXR1cm4gZmFsc2U7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZnVuY3Rpb24gaXNUcmFuc2ZlckRlc2NyaXB0b3IodGhpbmcpIHsKICAgIHJldHVybiB0aGluZyAmJiB0eXBlb2YgdGhpbmcgPT09ICJvYmplY3QiICYmIHRoaW5nW3N5bWJvbHNfMS4kdHJhbnNmZXJhYmxlXTsKICB9CiAgdHJhbnNmZXJhYmxlLmlzVHJhbnNmZXJEZXNjcmlwdG9yID0gaXNUcmFuc2ZlckRlc2NyaXB0b3I7CiAgZnVuY3Rpb24gVHJhbnNmZXIkMShwYXlsb2FkLCB0cmFuc2ZlcmFibGVzKSB7CiAgICBpZiAoIXRyYW5zZmVyYWJsZXMpIHsKICAgICAgaWYgKCFpc1RyYW5zZmVyYWJsZShwYXlsb2FkKSkKICAgICAgICB0aHJvdyBFcnJvcigpOwogICAgICB0cmFuc2ZlcmFibGVzID0gW3BheWxvYWRdOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgW3N5bWJvbHNfMS4kdHJhbnNmZXJhYmxlXTogdHJ1ZSwKICAgICAgc2VuZDogcGF5bG9hZCwKICAgICAgdHJhbnNmZXJhYmxlcwogICAgfTsKICB9CiAgdHJhbnNmZXJhYmxlLlRyYW5zZmVyID0gVHJhbnNmZXIkMTsKICB2YXIgbWVzc2FnZXMgPSB7fTsKICAoZnVuY3Rpb24oZXhwb3J0czIpIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzMiwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgZXhwb3J0czIuV29ya2VyTWVzc2FnZVR5cGUgPSBleHBvcnRzMi5NYXN0ZXJNZXNzYWdlVHlwZSA9IHZvaWQgMDsKICAgIChmdW5jdGlvbihNYXN0ZXJNZXNzYWdlVHlwZSkgewogICAgICBNYXN0ZXJNZXNzYWdlVHlwZVsiY2FuY2VsIl0gPSAiY2FuY2VsIjsKICAgICAgTWFzdGVyTWVzc2FnZVR5cGVbInJ1biJdID0gInJ1biI7CiAgICB9KShleHBvcnRzMi5NYXN0ZXJNZXNzYWdlVHlwZSB8fCAoZXhwb3J0czIuTWFzdGVyTWVzc2FnZVR5cGUgPSB7fSkpOwogICAgKGZ1bmN0aW9uKFdvcmtlck1lc3NhZ2VUeXBlKSB7CiAgICAgIFdvcmtlck1lc3NhZ2VUeXBlWyJlcnJvciJdID0gImVycm9yIjsKICAgICAgV29ya2VyTWVzc2FnZVR5cGVbImluaXQiXSA9ICJpbml0IjsKICAgICAgV29ya2VyTWVzc2FnZVR5cGVbInJlc3VsdCJdID0gInJlc3VsdCI7CiAgICAgIFdvcmtlck1lc3NhZ2VUeXBlWyJydW5uaW5nIl0gPSAicnVubmluZyI7CiAgICAgIFdvcmtlck1lc3NhZ2VUeXBlWyJ1bmNhdWdodEVycm9yIl0gPSAidW5jYXVnaHRFcnJvciI7CiAgICB9KShleHBvcnRzMi5Xb3JrZXJNZXNzYWdlVHlwZSB8fCAoZXhwb3J0czIuV29ya2VyTWVzc2FnZVR5cGUgPSB7fSkpOwogIH0pKG1lc3NhZ2VzKTsKICB2YXIgaW1wbGVtZW50YXRpb25fYnJvd3NlciA9IHt9OwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbXBsZW1lbnRhdGlvbl9icm93c2VyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgY29uc3QgaXNXb3JrZXJSdW50aW1lID0gZnVuY3Rpb24gaXNXb3JrZXJSdW50aW1lMigpIHsKICAgIGNvbnN0IGlzV2luZG93Q29udGV4dCA9IHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YgV2luZG93ICE9PSAidW5kZWZpbmVkIiAmJiBzZWxmIGluc3RhbmNlb2YgV2luZG93OwogICAgcmV0dXJuIHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIiAmJiBzZWxmLnBvc3RNZXNzYWdlICYmICFpc1dpbmRvd0NvbnRleHQgPyB0cnVlIDogZmFsc2U7CiAgfTsKICBjb25zdCBwb3N0TWVzc2FnZVRvTWFzdGVyID0gZnVuY3Rpb24gcG9zdE1lc3NhZ2VUb01hc3RlcjIoZGF0YSwgdHJhbnNmZXJMaXN0KSB7CiAgICBzZWxmLnBvc3RNZXNzYWdlKGRhdGEsIHRyYW5zZmVyTGlzdCk7CiAgfTsKICBjb25zdCBzdWJzY3JpYmVUb01hc3Rlck1lc3NhZ2VzID0gZnVuY3Rpb24gc3Vic2NyaWJlVG9NYXN0ZXJNZXNzYWdlczIob25NZXNzYWdlKSB7CiAgICBjb25zdCBtZXNzYWdlSGFuZGxlciA9IChtZXNzYWdlRXZlbnQpID0+IHsKICAgICAgb25NZXNzYWdlKG1lc3NhZ2VFdmVudC5kYXRhKTsKICAgIH07CiAgICBjb25zdCB1bnN1YnNjcmliZSA9ICgpID0+IHsKICAgICAgc2VsZi5yZW1vdmVFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgbWVzc2FnZUhhbmRsZXIpOwogICAgfTsKICAgIHNlbGYuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIG1lc3NhZ2VIYW5kbGVyKTsKICAgIHJldHVybiB1bnN1YnNjcmliZTsKICB9OwogIGltcGxlbWVudGF0aW9uX2Jyb3dzZXIuZGVmYXVsdCA9IHsKICAgIGlzV29ya2VyUnVudGltZSwKICAgIHBvc3RNZXNzYWdlVG9NYXN0ZXIsCiAgICBzdWJzY3JpYmVUb01hc3Rlck1lc3NhZ2VzCiAgfTsKICAoZnVuY3Rpb24oZXhwb3J0czIpIHsKICAgIHZhciBfX2F3YWl0ZXIgPSBjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2F3YWl0ZXIgfHwgZnVuY3Rpb24odGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7CiAgICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24ocmVzb2x2ZSkgewogICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RlcChnZW5lcmF0b3JbInRocm93Il0odmFsdWUpKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgewogICAgICAgICAgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7CiAgICAgICAgfQogICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTsKICAgICAgfSk7CiAgICB9OwogICAgdmFyIF9faW1wb3J0RGVmYXVsdDIgPSBjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2ltcG9ydERlZmF1bHQgfHwgZnVuY3Rpb24obW9kKSB7CiAgICAgIHJldHVybiBtb2QgJiYgbW9kLl9fZXNNb2R1bGUgPyBtb2QgOiB7ICJkZWZhdWx0IjogbW9kIH07CiAgICB9OwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMyLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CiAgICBleHBvcnRzMi5leHBvc2UgPSBleHBvcnRzMi5pc1dvcmtlclJ1bnRpbWUgPSBleHBvcnRzMi5UcmFuc2ZlciA9IGV4cG9ydHMyLnJlZ2lzdGVyU2VyaWFsaXplciA9IHZvaWQgMDsKICAgIGNvbnN0IGlzX29ic2VydmFibGVfMSA9IF9faW1wb3J0RGVmYXVsdDIoaXNPYnNlcnZhYmxlKTsKICAgIGNvbnN0IGNvbW1vbl8xID0gY29tbW9uOwogICAgY29uc3QgdHJhbnNmZXJhYmxlXzEgPSB0cmFuc2ZlcmFibGU7CiAgICBjb25zdCBtZXNzYWdlc18xID0gbWVzc2FnZXM7CiAgICBjb25zdCBpbXBsZW1lbnRhdGlvbl8xID0gX19pbXBvcnREZWZhdWx0MihpbXBsZW1lbnRhdGlvbl9icm93c2VyKTsKICAgIHZhciBjb21tb25fMiA9IGNvbW1vbjsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzMiwgInJlZ2lzdGVyU2VyaWFsaXplciIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGNvbW1vbl8yLnJlZ2lzdGVyU2VyaWFsaXplcjsKICAgIH0gfSk7CiAgICB2YXIgdHJhbnNmZXJhYmxlXzIgPSB0cmFuc2ZlcmFibGU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0czIsICJUcmFuc2ZlciIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRyYW5zZmVyYWJsZV8yLlRyYW5zZmVyOwogICAgfSB9KTsKICAgIGV4cG9ydHMyLmlzV29ya2VyUnVudGltZSA9IGltcGxlbWVudGF0aW9uXzEuZGVmYXVsdC5pc1dvcmtlclJ1bnRpbWU7CiAgICBsZXQgZXhwb3NlQ2FsbGVkID0gZmFsc2U7CiAgICBjb25zdCBhY3RpdmVTdWJzY3JpcHRpb25zID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICAgIGNvbnN0IGlzTWFzdGVySm9iQ2FuY2VsTWVzc2FnZSA9ICh0aGluZykgPT4gdGhpbmcgJiYgdGhpbmcudHlwZSA9PT0gbWVzc2FnZXNfMS5NYXN0ZXJNZXNzYWdlVHlwZS5jYW5jZWw7CiAgICBjb25zdCBpc01hc3RlckpvYlJ1bk1lc3NhZ2UgPSAodGhpbmcpID0+IHRoaW5nICYmIHRoaW5nLnR5cGUgPT09IG1lc3NhZ2VzXzEuTWFzdGVyTWVzc2FnZVR5cGUucnVuOwogICAgY29uc3QgaXNPYnNlcnZhYmxlJDEgPSAodGhpbmcpID0+IGlzX29ic2VydmFibGVfMS5kZWZhdWx0KHRoaW5nKSB8fCBpc1plbk9ic2VydmFibGUodGhpbmcpOwogICAgZnVuY3Rpb24gaXNaZW5PYnNlcnZhYmxlKHRoaW5nKSB7CiAgICAgIHJldHVybiB0aGluZyAmJiB0eXBlb2YgdGhpbmcgPT09ICJvYmplY3QiICYmIHR5cGVvZiB0aGluZy5zdWJzY3JpYmUgPT09ICJmdW5jdGlvbiI7CiAgICB9CiAgICBmdW5jdGlvbiBkZWNvbnN0cnVjdFRyYW5zZmVyKHRoaW5nKSB7CiAgICAgIHJldHVybiB0cmFuc2ZlcmFibGVfMS5pc1RyYW5zZmVyRGVzY3JpcHRvcih0aGluZykgPyB7IHBheWxvYWQ6IHRoaW5nLnNlbmQsIHRyYW5zZmVyYWJsZXM6IHRoaW5nLnRyYW5zZmVyYWJsZXMgfSA6IHsgcGF5bG9hZDogdGhpbmcsIHRyYW5zZmVyYWJsZXM6IHZvaWQgMCB9OwogICAgfQogICAgZnVuY3Rpb24gcG9zdEZ1bmN0aW9uSW5pdE1lc3NhZ2UoKSB7CiAgICAgIGNvbnN0IGluaXRNZXNzYWdlID0gewogICAgICAgIHR5cGU6IG1lc3NhZ2VzXzEuV29ya2VyTWVzc2FnZVR5cGUuaW5pdCwKICAgICAgICBleHBvc2VkOiB7CiAgICAgICAgICB0eXBlOiAiZnVuY3Rpb24iCiAgICAgICAgfQogICAgICB9OwogICAgICBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQucG9zdE1lc3NhZ2VUb01hc3Rlcihpbml0TWVzc2FnZSk7CiAgICB9CiAgICBmdW5jdGlvbiBwb3N0TW9kdWxlSW5pdE1lc3NhZ2UobWV0aG9kTmFtZXMpIHsKICAgICAgY29uc3QgaW5pdE1lc3NhZ2UgPSB7CiAgICAgICAgdHlwZTogbWVzc2FnZXNfMS5Xb3JrZXJNZXNzYWdlVHlwZS5pbml0LAogICAgICAgIGV4cG9zZWQ6IHsKICAgICAgICAgIHR5cGU6ICJtb2R1bGUiLAogICAgICAgICAgbWV0aG9kczogbWV0aG9kTmFtZXMKICAgICAgICB9CiAgICAgIH07CiAgICAgIGltcGxlbWVudGF0aW9uXzEuZGVmYXVsdC5wb3N0TWVzc2FnZVRvTWFzdGVyKGluaXRNZXNzYWdlKTsKICAgIH0KICAgIGZ1bmN0aW9uIHBvc3RKb2JFcnJvck1lc3NhZ2UodWlkLCByYXdFcnJvcikgewogICAgICBjb25zdCB7IHBheWxvYWQ6IGVycm9yLCB0cmFuc2ZlcmFibGVzIH0gPSBkZWNvbnN0cnVjdFRyYW5zZmVyKHJhd0Vycm9yKTsKICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gewogICAgICAgIHR5cGU6IG1lc3NhZ2VzXzEuV29ya2VyTWVzc2FnZVR5cGUuZXJyb3IsCiAgICAgICAgdWlkLAogICAgICAgIGVycm9yOiBjb21tb25fMS5zZXJpYWxpemUoZXJyb3IpCiAgICAgIH07CiAgICAgIGltcGxlbWVudGF0aW9uXzEuZGVmYXVsdC5wb3N0TWVzc2FnZVRvTWFzdGVyKGVycm9yTWVzc2FnZSwgdHJhbnNmZXJhYmxlcyk7CiAgICB9CiAgICBmdW5jdGlvbiBwb3N0Sm9iUmVzdWx0TWVzc2FnZSh1aWQsIGNvbXBsZXRlZCwgcmVzdWx0VmFsdWUpIHsKICAgICAgY29uc3QgeyBwYXlsb2FkLCB0cmFuc2ZlcmFibGVzIH0gPSBkZWNvbnN0cnVjdFRyYW5zZmVyKHJlc3VsdFZhbHVlKTsKICAgICAgY29uc3QgcmVzdWx0TWVzc2FnZSA9IHsKICAgICAgICB0eXBlOiBtZXNzYWdlc18xLldvcmtlck1lc3NhZ2VUeXBlLnJlc3VsdCwKICAgICAgICB1aWQsCiAgICAgICAgY29tcGxldGU6IGNvbXBsZXRlZCA/IHRydWUgOiB2b2lkIDAsCiAgICAgICAgcGF5bG9hZAogICAgICB9OwogICAgICBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQucG9zdE1lc3NhZ2VUb01hc3RlcihyZXN1bHRNZXNzYWdlLCB0cmFuc2ZlcmFibGVzKTsKICAgIH0KICAgIGZ1bmN0aW9uIHBvc3RKb2JTdGFydE1lc3NhZ2UodWlkLCByZXN1bHRUeXBlKSB7CiAgICAgIGNvbnN0IHN0YXJ0TWVzc2FnZSA9IHsKICAgICAgICB0eXBlOiBtZXNzYWdlc18xLldvcmtlck1lc3NhZ2VUeXBlLnJ1bm5pbmcsCiAgICAgICAgdWlkLAogICAgICAgIHJlc3VsdFR5cGUKICAgICAgfTsKICAgICAgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LnBvc3RNZXNzYWdlVG9NYXN0ZXIoc3RhcnRNZXNzYWdlKTsKICAgIH0KICAgIGZ1bmN0aW9uIHBvc3RVbmNhdWdodEVycm9yTWVzc2FnZShlcnJvcikgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IHsKICAgICAgICAgIHR5cGU6IG1lc3NhZ2VzXzEuV29ya2VyTWVzc2FnZVR5cGUudW5jYXVnaHRFcnJvciwKICAgICAgICAgIGVycm9yOiBjb21tb25fMS5zZXJpYWxpemUoZXJyb3IpCiAgICAgICAgfTsKICAgICAgICBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQucG9zdE1lc3NhZ2VUb01hc3RlcihlcnJvck1lc3NhZ2UpOwogICAgICB9IGNhdGNoIChzdWJFcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIk5vdCByZXBvcnRpbmcgdW5jYXVnaHQgZXJyb3IgYmFjayB0byBtYXN0ZXIgdGhyZWFkIGFzIGl0IG9jY3VyZWQgd2hpbGUgcmVwb3J0aW5nIGFuIHVuY2F1Z2h0IGVycm9yIGFscmVhZHkuXG5MYXRlc3QgZXJyb3I6Iiwgc3ViRXJyb3IsICJcbk9yaWdpbmFsIGVycm9yOiIsIGVycm9yKTsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gcnVuRnVuY3Rpb24oam9iVUlELCBmbiwgYXJncykgewogICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgewogICAgICAgIGxldCBzeW5jUmVzdWx0OwogICAgICAgIHRyeSB7CiAgICAgICAgICBzeW5jUmVzdWx0ID0gZm4oLi4uYXJncyk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIHJldHVybiBwb3N0Sm9iRXJyb3JNZXNzYWdlKGpvYlVJRCwgZXJyb3IpOwogICAgICAgIH0KICAgICAgICBjb25zdCByZXN1bHRUeXBlID0gaXNPYnNlcnZhYmxlJDEoc3luY1Jlc3VsdCkgPyAib2JzZXJ2YWJsZSIgOiAicHJvbWlzZSI7CiAgICAgICAgcG9zdEpvYlN0YXJ0TWVzc2FnZShqb2JVSUQsIHJlc3VsdFR5cGUpOwogICAgICAgIGlmIChpc09ic2VydmFibGUkMShzeW5jUmVzdWx0KSkgewogICAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gc3luY1Jlc3VsdC5zdWJzY3JpYmUoKHZhbHVlKSA9PiBwb3N0Sm9iUmVzdWx0TWVzc2FnZShqb2JVSUQsIGZhbHNlLCBjb21tb25fMS5zZXJpYWxpemUodmFsdWUpKSwgKGVycm9yKSA9PiB7CiAgICAgICAgICAgIHBvc3RKb2JFcnJvck1lc3NhZ2Uoam9iVUlELCBjb21tb25fMS5zZXJpYWxpemUoZXJyb3IpKTsKICAgICAgICAgICAgYWN0aXZlU3Vic2NyaXB0aW9ucy5kZWxldGUoam9iVUlEKTsKICAgICAgICAgIH0sICgpID0+IHsKICAgICAgICAgICAgcG9zdEpvYlJlc3VsdE1lc3NhZ2Uoam9iVUlELCB0cnVlKTsKICAgICAgICAgICAgYWN0aXZlU3Vic2NyaXB0aW9ucy5kZWxldGUoam9iVUlEKTsKICAgICAgICAgIH0pOwogICAgICAgICAgYWN0aXZlU3Vic2NyaXB0aW9ucy5zZXQoam9iVUlELCBzdWJzY3JpcHRpb24pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCByZXN1bHQgPSB5aWVsZCBzeW5jUmVzdWx0OwogICAgICAgICAgICBwb3N0Sm9iUmVzdWx0TWVzc2FnZShqb2JVSUQsIHRydWUsIGNvbW1vbl8xLnNlcmlhbGl6ZShyZXN1bHQpKTsKICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIHBvc3RKb2JFcnJvck1lc3NhZ2Uoam9iVUlELCBjb21tb25fMS5zZXJpYWxpemUoZXJyb3IpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gZXhwb3NlMihleHBvc2VkKSB7CiAgICAgIGlmICghaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LmlzV29ya2VyUnVudGltZSgpKSB7CiAgICAgICAgdGhyb3cgRXJyb3IoImV4cG9zZSgpIGNhbGxlZCBpbiB0aGUgbWFzdGVyIHRocmVhZC4iKTsKICAgICAgfQogICAgICBpZiAoZXhwb3NlQ2FsbGVkKSB7CiAgICAgICAgdGhyb3cgRXJyb3IoImV4cG9zZSgpIGNhbGxlZCBtb3JlIHRoYW4gb25jZS4gVGhpcyBpcyBub3QgcG9zc2libGUuIFBhc3MgYW4gb2JqZWN0IHRvIGV4cG9zZSgpIGlmIHlvdSB3YW50IHRvIGV4cG9zZSBtdWx0aXBsZSBmdW5jdGlvbnMuIik7CiAgICAgIH0KICAgICAgZXhwb3NlQ2FsbGVkID0gdHJ1ZTsKICAgICAgaWYgKHR5cGVvZiBleHBvc2VkID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LnN1YnNjcmliZVRvTWFzdGVyTWVzc2FnZXMoKG1lc3NhZ2VEYXRhKSA9PiB7CiAgICAgICAgICBpZiAoaXNNYXN0ZXJKb2JSdW5NZXNzYWdlKG1lc3NhZ2VEYXRhKSAmJiAhbWVzc2FnZURhdGEubWV0aG9kKSB7CiAgICAgICAgICAgIHJ1bkZ1bmN0aW9uKG1lc3NhZ2VEYXRhLnVpZCwgZXhwb3NlZCwgbWVzc2FnZURhdGEuYXJncy5tYXAoY29tbW9uXzEuZGVzZXJpYWxpemUpKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBwb3N0RnVuY3Rpb25Jbml0TWVzc2FnZSgpOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvc2VkID09PSAib2JqZWN0IiAmJiBleHBvc2VkKSB7CiAgICAgICAgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LnN1YnNjcmliZVRvTWFzdGVyTWVzc2FnZXMoKG1lc3NhZ2VEYXRhKSA9PiB7CiAgICAgICAgICBpZiAoaXNNYXN0ZXJKb2JSdW5NZXNzYWdlKG1lc3NhZ2VEYXRhKSAmJiBtZXNzYWdlRGF0YS5tZXRob2QpIHsKICAgICAgICAgICAgcnVuRnVuY3Rpb24obWVzc2FnZURhdGEudWlkLCBleHBvc2VkW21lc3NhZ2VEYXRhLm1ldGhvZF0sIG1lc3NhZ2VEYXRhLmFyZ3MubWFwKGNvbW1vbl8xLmRlc2VyaWFsaXplKSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgbWV0aG9kTmFtZXMgPSBPYmplY3Qua2V5cyhleHBvc2VkKS5maWx0ZXIoKGtleSkgPT4gdHlwZW9mIGV4cG9zZWRba2V5XSA9PT0gImZ1bmN0aW9uIik7CiAgICAgICAgcG9zdE1vZHVsZUluaXRNZXNzYWdlKG1ldGhvZE5hbWVzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBFcnJvcihgSW52YWxpZCBhcmd1bWVudCBwYXNzZWQgdG8gZXhwb3NlKCkuIEV4cGVjdGVkIGEgZnVuY3Rpb24gb3IgYW4gb2JqZWN0LCBnb3Q6ICR7ZXhwb3NlZH1gKTsKICAgICAgfQogICAgICBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQuc3Vic2NyaWJlVG9NYXN0ZXJNZXNzYWdlcygobWVzc2FnZURhdGEpID0+IHsKICAgICAgICBpZiAoaXNNYXN0ZXJKb2JDYW5jZWxNZXNzYWdlKG1lc3NhZ2VEYXRhKSkgewogICAgICAgICAgY29uc3Qgam9iVUlEID0gbWVzc2FnZURhdGEudWlkOwogICAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gYWN0aXZlU3Vic2NyaXB0aW9ucy5nZXQoam9iVUlEKTsKICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24pIHsKICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7CiAgICAgICAgICAgIGFjdGl2ZVN1YnNjcmlwdGlvbnMuZGVsZXRlKGpvYlVJRCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIGV4cG9ydHMyLmV4cG9zZSA9IGV4cG9zZTI7CiAgICBpZiAodHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiBzZWxmLmFkZEV2ZW50TGlzdGVuZXIgPT09ICJmdW5jdGlvbiIgJiYgaW1wbGVtZW50YXRpb25fMS5kZWZhdWx0LmlzV29ya2VyUnVudGltZSgpKSB7CiAgICAgIHNlbGYuYWRkRXZlbnRMaXN0ZW5lcigiZXJyb3IiLCAoZXZlbnQpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHBvc3RVbmNhdWdodEVycm9yTWVzc2FnZShldmVudC5lcnJvciB8fCBldmVudCksIDI1MCk7CiAgICAgIH0pOwogICAgICBzZWxmLmFkZEV2ZW50TGlzdGVuZXIoInVuaGFuZGxlZHJlamVjdGlvbiIsIChldmVudCkgPT4gewogICAgICAgIGNvbnN0IGVycm9yID0gZXZlbnQucmVhc29uOwogICAgICAgIGlmIChlcnJvciAmJiB0eXBlb2YgZXJyb3IubWVzc2FnZSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcG9zdFVuY2F1Z2h0RXJyb3JNZXNzYWdlKGVycm9yKSwgMjUwKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgaWYgKHR5cGVvZiBwcm9jZXNzICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YgcHJvY2Vzcy5vbiA9PT0gImZ1bmN0aW9uIiAmJiBpbXBsZW1lbnRhdGlvbl8xLmRlZmF1bHQuaXNXb3JrZXJSdW50aW1lKCkpIHsKICAgICAgcHJvY2Vzcy5vbigidW5jYXVnaHRFeGNlcHRpb24iLCAoZXJyb3IpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHBvc3RVbmNhdWdodEVycm9yTWVzc2FnZShlcnJvciksIDI1MCk7CiAgICAgIH0pOwogICAgICBwcm9jZXNzLm9uKCJ1bmhhbmRsZWRSZWplY3Rpb24iLCAoZXJyb3IpID0+IHsKICAgICAgICBpZiAoZXJyb3IgJiYgdHlwZW9mIGVycm9yLm1lc3NhZ2UgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHBvc3RVbmNhdWdodEVycm9yTWVzc2FnZShlcnJvciksIDI1MCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9KSh3b3JrZXIpOwogIHZhciBXb3JrZXJDb250ZXh0ID0gLyogQF9fUFVSRV9fICovIGdldERlZmF1bHRFeHBvcnRGcm9tQ2pzKHdvcmtlcik7CiAgY29uc3QgZXhwb3NlID0gV29ya2VyQ29udGV4dC5leHBvc2U7CiAgV29ya2VyQ29udGV4dC5yZWdpc3RlclNlcmlhbGl6ZXI7CiAgY29uc3QgVHJhbnNmZXIgPSBXb3JrZXJDb250ZXh0LlRyYW5zZmVyOwogIHZhciBmcmVlR2xvYmFsID0gdHlwZW9mIGdsb2JhbCA9PSAib2JqZWN0IiAmJiBnbG9iYWwgJiYgZ2xvYmFsLk9iamVjdCA9PT0gT2JqZWN0ICYmIGdsb2JhbDsKICB2YXIgZnJlZUdsb2JhbCQxID0gZnJlZUdsb2JhbDsKICB2YXIgZnJlZVNlbGYgPSB0eXBlb2Ygc2VsZiA9PSAib2JqZWN0IiAmJiBzZWxmICYmIHNlbGYuT2JqZWN0ID09PSBPYmplY3QgJiYgc2VsZjsKICB2YXIgcm9vdCA9IGZyZWVHbG9iYWwkMSB8fCBmcmVlU2VsZiB8fCBGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpOwogIHZhciByb290JDEgPSByb290OwogIHZhciBTeW1ib2wkMSA9IHJvb3QkMS5TeW1ib2w7CiAgdmFyIFN5bWJvbCQyID0gU3ltYm9sJDE7CiAgdmFyIG9iamVjdFByb3RvJDUgPSBPYmplY3QucHJvdG90eXBlOwogIHZhciBoYXNPd25Qcm9wZXJ0eSQzID0gb2JqZWN0UHJvdG8kNS5oYXNPd25Qcm9wZXJ0eTsKICB2YXIgbmF0aXZlT2JqZWN0VG9TdHJpbmckMSA9IG9iamVjdFByb3RvJDUudG9TdHJpbmc7CiAgdmFyIHN5bVRvU3RyaW5nVGFnJDEgPSBTeW1ib2wkMiA/IFN5bWJvbCQyLnRvU3RyaW5nVGFnIDogdm9pZCAwOwogIGZ1bmN0aW9uIGdldFJhd1RhZyh2YWx1ZSkgewogICAgdmFyIGlzT3duID0gaGFzT3duUHJvcGVydHkkMy5jYWxsKHZhbHVlLCBzeW1Ub1N0cmluZ1RhZyQxKSwgdGFnID0gdmFsdWVbc3ltVG9TdHJpbmdUYWckMV07CiAgICB0cnkgewogICAgICB2YWx1ZVtzeW1Ub1N0cmluZ1RhZyQxXSA9IHZvaWQgMDsKICAgICAgdmFyIHVubWFza2VkID0gdHJ1ZTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgIH0KICAgIHZhciByZXN1bHQgPSBuYXRpdmVPYmplY3RUb1N0cmluZyQxLmNhbGwodmFsdWUpOwogICAgaWYgKHVubWFza2VkKSB7CiAgICAgIGlmIChpc093bikgewogICAgICAgIHZhbHVlW3N5bVRvU3RyaW5nVGFnJDFdID0gdGFnOwogICAgICB9IGVsc2UgewogICAgICAgIGRlbGV0ZSB2YWx1ZVtzeW1Ub1N0cmluZ1RhZyQxXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgdmFyIG9iamVjdFByb3RvJDQgPSBPYmplY3QucHJvdG90eXBlOwogIHZhciBuYXRpdmVPYmplY3RUb1N0cmluZyA9IG9iamVjdFByb3RvJDQudG9TdHJpbmc7CiAgZnVuY3Rpb24gb2JqZWN0VG9TdHJpbmcodmFsdWUpIHsKICAgIHJldHVybiBuYXRpdmVPYmplY3RUb1N0cmluZy5jYWxsKHZhbHVlKTsKICB9CiAgdmFyIG51bGxUYWcgPSAiW29iamVjdCBOdWxsXSIsIHVuZGVmaW5lZFRhZyA9ICJbb2JqZWN0IFVuZGVmaW5lZF0iOwogIHZhciBzeW1Ub1N0cmluZ1RhZyA9IFN5bWJvbCQyID8gU3ltYm9sJDIudG9TdHJpbmdUYWcgOiB2b2lkIDA7CiAgZnVuY3Rpb24gYmFzZUdldFRhZyh2YWx1ZSkgewogICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgcmV0dXJuIHZhbHVlID09PSB2b2lkIDAgPyB1bmRlZmluZWRUYWcgOiBudWxsVGFnOwogICAgfQogICAgcmV0dXJuIHN5bVRvU3RyaW5nVGFnICYmIHN5bVRvU3RyaW5nVGFnIGluIE9iamVjdCh2YWx1ZSkgPyBnZXRSYXdUYWcodmFsdWUpIDogb2JqZWN0VG9TdHJpbmcodmFsdWUpOwogIH0KICBmdW5jdGlvbiBpc09iamVjdExpa2UodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZSAhPSBudWxsICYmIHR5cGVvZiB2YWx1ZSA9PSAib2JqZWN0IjsKICB9CiAgdmFyIHN5bWJvbFRhZyA9ICJbb2JqZWN0IFN5bWJvbF0iOwogIGZ1bmN0aW9uIGlzU3ltYm9sKHZhbHVlKSB7CiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICJzeW1ib2wiIHx8IGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgYmFzZUdldFRhZyh2YWx1ZSkgPT0gc3ltYm9sVGFnOwogIH0KICBmdW5jdGlvbiBhcnJheU1hcChhcnJheSwgaXRlcmF0ZWUpIHsKICAgIHZhciBpbmRleCA9IC0xLCBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aCwgcmVzdWx0ID0gQXJyYXkobGVuZ3RoKTsKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHJlc3VsdFtpbmRleF0gPSBpdGVyYXRlZShhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICB2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXk7CiAgdmFyIGlzQXJyYXkkMSA9IGlzQXJyYXk7CiAgdmFyIHJlV2hpdGVzcGFjZSA9IC9ccy87CiAgZnVuY3Rpb24gdHJpbW1lZEVuZEluZGV4KHN0cmluZykgewogICAgdmFyIGluZGV4ID0gc3RyaW5nLmxlbmd0aDsKICAgIHdoaWxlIChpbmRleC0tICYmIHJlV2hpdGVzcGFjZS50ZXN0KHN0cmluZy5jaGFyQXQoaW5kZXgpKSkgewogICAgfQogICAgcmV0dXJuIGluZGV4OwogIH0KICB2YXIgcmVUcmltU3RhcnQgPSAvXlxzKy87CiAgZnVuY3Rpb24gYmFzZVRyaW0oc3RyaW5nKSB7CiAgICByZXR1cm4gc3RyaW5nID8gc3RyaW5nLnNsaWNlKDAsIHRyaW1tZWRFbmRJbmRleChzdHJpbmcpICsgMSkucmVwbGFjZShyZVRyaW1TdGFydCwgIiIpIDogc3RyaW5nOwogIH0KICBmdW5jdGlvbiBpc09iamVjdCh2YWx1ZSkgewogICAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7CiAgICByZXR1cm4gdmFsdWUgIT0gbnVsbCAmJiAodHlwZSA9PSAib2JqZWN0IiB8fCB0eXBlID09ICJmdW5jdGlvbiIpOwogIH0KICB2YXIgTkFOID0gMCAvIDA7CiAgdmFyIHJlSXNCYWRIZXggPSAvXlstK10weFswLTlhLWZdKyQvaTsKICB2YXIgcmVJc0JpbmFyeSA9IC9eMGJbMDFdKyQvaTsKICB2YXIgcmVJc09jdGFsID0gL14wb1swLTddKyQvaTsKICB2YXIgZnJlZVBhcnNlSW50ID0gcGFyc2VJbnQ7CiAgZnVuY3Rpb24gdG9OdW1iZXIodmFsdWUpIHsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gIm51bWJlciIpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgaWYgKGlzU3ltYm9sKHZhbHVlKSkgewogICAgICByZXR1cm4gTkFOOwogICAgfQogICAgaWYgKGlzT2JqZWN0KHZhbHVlKSkgewogICAgICB2YXIgb3RoZXIgPSB0eXBlb2YgdmFsdWUudmFsdWVPZiA9PSAiZnVuY3Rpb24iID8gdmFsdWUudmFsdWVPZigpIDogdmFsdWU7CiAgICAgIHZhbHVlID0gaXNPYmplY3Qob3RoZXIpID8gb3RoZXIgKyAiIiA6IG90aGVyOwogICAgfQogICAgaWYgKHR5cGVvZiB2YWx1ZSAhPSAic3RyaW5nIikgewogICAgICByZXR1cm4gdmFsdWUgPT09IDAgPyB2YWx1ZSA6ICt2YWx1ZTsKICAgIH0KICAgIHZhbHVlID0gYmFzZVRyaW0odmFsdWUpOwogICAgdmFyIGlzQmluYXJ5ID0gcmVJc0JpbmFyeS50ZXN0KHZhbHVlKTsKICAgIHJldHVybiBpc0JpbmFyeSB8fCByZUlzT2N0YWwudGVzdCh2YWx1ZSkgPyBmcmVlUGFyc2VJbnQodmFsdWUuc2xpY2UoMiksIGlzQmluYXJ5ID8gMiA6IDgpIDogcmVJc0JhZEhleC50ZXN0KHZhbHVlKSA/IE5BTiA6ICt2YWx1ZTsKICB9CiAgdmFyIElORklOSVRZID0gMSAvIDAsIE1BWF9JTlRFR0VSID0gMTc5NzY5MzEzNDg2MjMxNTdlMjkyOwogIGZ1bmN0aW9uIHRvRmluaXRlKHZhbHVlKSB7CiAgICBpZiAoIXZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZSA9PT0gMCA/IHZhbHVlIDogMDsKICAgIH0KICAgIHZhbHVlID0gdG9OdW1iZXIodmFsdWUpOwogICAgaWYgKHZhbHVlID09PSBJTkZJTklUWSB8fCB2YWx1ZSA9PT0gLUlORklOSVRZKSB7CiAgICAgIHZhciBzaWduID0gdmFsdWUgPCAwID8gLTEgOiAxOwogICAgICByZXR1cm4gc2lnbiAqIE1BWF9JTlRFR0VSOwogICAgfQogICAgcmV0dXJuIHZhbHVlID09PSB2YWx1ZSA/IHZhbHVlIDogMDsKICB9CiAgZnVuY3Rpb24gdG9JbnRlZ2VyKHZhbHVlKSB7CiAgICB2YXIgcmVzdWx0ID0gdG9GaW5pdGUodmFsdWUpLCByZW1haW5kZXIgPSByZXN1bHQgJSAxOwogICAgcmV0dXJuIHJlc3VsdCA9PT0gcmVzdWx0ID8gcmVtYWluZGVyID8gcmVzdWx0IC0gcmVtYWluZGVyIDogcmVzdWx0IDogMDsKICB9CiAgdmFyIGFzeW5jVGFnID0gIltvYmplY3QgQXN5bmNGdW5jdGlvbl0iLCBmdW5jVGFnJDEgPSAiW29iamVjdCBGdW5jdGlvbl0iLCBnZW5UYWcgPSAiW29iamVjdCBHZW5lcmF0b3JGdW5jdGlvbl0iLCBwcm94eVRhZyA9ICJbb2JqZWN0IFByb3h5XSI7CiAgZnVuY3Rpb24gaXNGdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKCFpc09iamVjdCh2YWx1ZSkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdmFyIHRhZyA9IGJhc2VHZXRUYWcodmFsdWUpOwogICAgcmV0dXJuIHRhZyA9PSBmdW5jVGFnJDEgfHwgdGFnID09IGdlblRhZyB8fCB0YWcgPT0gYXN5bmNUYWcgfHwgdGFnID09IHByb3h5VGFnOwogIH0KICBmdW5jdGlvbiBjb3B5QXJyYXkoc291cmNlLCBhcnJheSkgewogICAgdmFyIGluZGV4ID0gLTEsIGxlbmd0aCA9IHNvdXJjZS5sZW5ndGg7CiAgICBhcnJheSB8fCAoYXJyYXkgPSBBcnJheShsZW5ndGgpKTsKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIGFycmF5W2luZGV4XSA9IHNvdXJjZVtpbmRleF07CiAgICB9CiAgICByZXR1cm4gYXJyYXk7CiAgfQogIHZhciBNQVhfU0FGRV9JTlRFR0VSJDEgPSA5MDA3MTk5MjU0NzQwOTkxOwogIHZhciByZUlzVWludCA9IC9eKD86MHxbMS05XVxkKikkLzsKICBmdW5jdGlvbiBpc0luZGV4KHZhbHVlLCBsZW5ndGgpIHsKICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwogICAgbGVuZ3RoID0gbGVuZ3RoID09IG51bGwgPyBNQVhfU0FGRV9JTlRFR0VSJDEgOiBsZW5ndGg7CiAgICByZXR1cm4gISFsZW5ndGggJiYgKHR5cGUgPT0gIm51bWJlciIgfHwgdHlwZSAhPSAic3ltYm9sIiAmJiByZUlzVWludC50ZXN0KHZhbHVlKSkgJiYgKHZhbHVlID4gLTEgJiYgdmFsdWUgJSAxID09IDAgJiYgdmFsdWUgPCBsZW5ndGgpOwogIH0KICBmdW5jdGlvbiBlcSh2YWx1ZSwgb3RoZXIpIHsKICAgIHJldHVybiB2YWx1ZSA9PT0gb3RoZXIgfHwgdmFsdWUgIT09IHZhbHVlICYmIG90aGVyICE9PSBvdGhlcjsKICB9CiAgdmFyIE1BWF9TQUZFX0lOVEVHRVIgPSA5MDA3MTk5MjU0NzQwOTkxOwogIGZ1bmN0aW9uIGlzTGVuZ3RoKHZhbHVlKSB7CiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICJudW1iZXIiICYmIHZhbHVlID4gLTEgJiYgdmFsdWUgJSAxID09IDAgJiYgdmFsdWUgPD0gTUFYX1NBRkVfSU5URUdFUjsKICB9CiAgZnVuY3Rpb24gaXNBcnJheUxpa2UodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZSAhPSBudWxsICYmIGlzTGVuZ3RoKHZhbHVlLmxlbmd0aCkgJiYgIWlzRnVuY3Rpb24odmFsdWUpOwogIH0KICBmdW5jdGlvbiBpc0l0ZXJhdGVlQ2FsbCh2YWx1ZSwgaW5kZXgsIG9iamVjdCkgewogICAgaWYgKCFpc09iamVjdChvYmplY3QpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciB0eXBlID0gdHlwZW9mIGluZGV4OwogICAgaWYgKHR5cGUgPT0gIm51bWJlciIgPyBpc0FycmF5TGlrZShvYmplY3QpICYmIGlzSW5kZXgoaW5kZXgsIG9iamVjdC5sZW5ndGgpIDogdHlwZSA9PSAic3RyaW5nIiAmJiBpbmRleCBpbiBvYmplY3QpIHsKICAgICAgcmV0dXJuIGVxKG9iamVjdFtpbmRleF0sIHZhbHVlKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgdmFyIG9iamVjdFByb3RvJDMgPSBPYmplY3QucHJvdG90eXBlOwogIGZ1bmN0aW9uIGlzUHJvdG90eXBlKHZhbHVlKSB7CiAgICB2YXIgQ3RvciA9IHZhbHVlICYmIHZhbHVlLmNvbnN0cnVjdG9yLCBwcm90byA9IHR5cGVvZiBDdG9yID09ICJmdW5jdGlvbiIgJiYgQ3Rvci5wcm90b3R5cGUgfHwgb2JqZWN0UHJvdG8kMzsKICAgIHJldHVybiB2YWx1ZSA9PT0gcHJvdG87CiAgfQogIGZ1bmN0aW9uIGJhc2VUaW1lcyhuLCBpdGVyYXRlZSkgewogICAgdmFyIGluZGV4ID0gLTEsIHJlc3VsdCA9IEFycmF5KG4pOwogICAgd2hpbGUgKCsraW5kZXggPCBuKSB7CiAgICAgIHJlc3VsdFtpbmRleF0gPSBpdGVyYXRlZShpbmRleCk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICB2YXIgYXJnc1RhZyQxID0gIltvYmplY3QgQXJndW1lbnRzXSI7CiAgZnVuY3Rpb24gYmFzZUlzQXJndW1lbnRzKHZhbHVlKSB7CiAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBiYXNlR2V0VGFnKHZhbHVlKSA9PSBhcmdzVGFnJDE7CiAgfQogIHZhciBvYmplY3RQcm90byQyID0gT2JqZWN0LnByb3RvdHlwZTsKICB2YXIgaGFzT3duUHJvcGVydHkkMiA9IG9iamVjdFByb3RvJDIuaGFzT3duUHJvcGVydHk7CiAgdmFyIHByb3BlcnR5SXNFbnVtZXJhYmxlID0gb2JqZWN0UHJvdG8kMi5wcm9wZXJ0eUlzRW51bWVyYWJsZTsKICB2YXIgaXNBcmd1bWVudHMgPSBiYXNlSXNBcmd1bWVudHMoZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gYXJndW1lbnRzOwogIH0oKSkgPyBiYXNlSXNBcmd1bWVudHMgOiBmdW5jdGlvbih2YWx1ZSkgewogICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgaGFzT3duUHJvcGVydHkkMi5jYWxsKHZhbHVlLCAiY2FsbGVlIikgJiYgIXByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwodmFsdWUsICJjYWxsZWUiKTsKICB9OwogIHZhciBpc0FyZ3VtZW50cyQxID0gaXNBcmd1bWVudHM7CiAgZnVuY3Rpb24gc3R1YkZhbHNlKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICB2YXIgZnJlZUV4cG9ydHMkMSA9IHR5cGVvZiBleHBvcnRzID09ICJvYmplY3QiICYmIGV4cG9ydHMgJiYgIWV4cG9ydHMubm9kZVR5cGUgJiYgZXhwb3J0czsKICB2YXIgZnJlZU1vZHVsZSQxID0gZnJlZUV4cG9ydHMkMSAmJiB0eXBlb2YgbW9kdWxlID09ICJvYmplY3QiICYmIG1vZHVsZSAmJiAhbW9kdWxlLm5vZGVUeXBlICYmIG1vZHVsZTsKICB2YXIgbW9kdWxlRXhwb3J0cyQxID0gZnJlZU1vZHVsZSQxICYmIGZyZWVNb2R1bGUkMS5leHBvcnRzID09PSBmcmVlRXhwb3J0cyQxOwogIHZhciBCdWZmZXIkMSA9IG1vZHVsZUV4cG9ydHMkMSA/IHJvb3QkMS5CdWZmZXIgOiB2b2lkIDA7CiAgdmFyIG5hdGl2ZUlzQnVmZmVyID0gQnVmZmVyJDEgPyBCdWZmZXIkMS5pc0J1ZmZlciA6IHZvaWQgMDsKICB2YXIgaXNCdWZmZXIgPSBuYXRpdmVJc0J1ZmZlciB8fCBzdHViRmFsc2U7CiAgdmFyIGlzQnVmZmVyJDEgPSBpc0J1ZmZlcjsKICB2YXIgYXJnc1RhZyA9ICJbb2JqZWN0IEFyZ3VtZW50c10iLCBhcnJheVRhZyA9ICJbb2JqZWN0IEFycmF5XSIsIGJvb2xUYWcgPSAiW29iamVjdCBCb29sZWFuXSIsIGRhdGVUYWcgPSAiW29iamVjdCBEYXRlXSIsIGVycm9yVGFnID0gIltvYmplY3QgRXJyb3JdIiwgZnVuY1RhZyA9ICJbb2JqZWN0IEZ1bmN0aW9uXSIsIG1hcFRhZyA9ICJbb2JqZWN0IE1hcF0iLCBudW1iZXJUYWcgPSAiW29iamVjdCBOdW1iZXJdIiwgb2JqZWN0VGFnID0gIltvYmplY3QgT2JqZWN0XSIsIHJlZ2V4cFRhZyA9ICJbb2JqZWN0IFJlZ0V4cF0iLCBzZXRUYWcgPSAiW29iamVjdCBTZXRdIiwgc3RyaW5nVGFnID0gIltvYmplY3QgU3RyaW5nXSIsIHdlYWtNYXBUYWcgPSAiW29iamVjdCBXZWFrTWFwXSI7CiAgdmFyIGFycmF5QnVmZmVyVGFnID0gIltvYmplY3QgQXJyYXlCdWZmZXJdIiwgZGF0YVZpZXdUYWcgPSAiW29iamVjdCBEYXRhVmlld10iLCBmbG9hdDMyVGFnID0gIltvYmplY3QgRmxvYXQzMkFycmF5XSIsIGZsb2F0NjRUYWcgPSAiW29iamVjdCBGbG9hdDY0QXJyYXldIiwgaW50OFRhZyA9ICJbb2JqZWN0IEludDhBcnJheV0iLCBpbnQxNlRhZyA9ICJbb2JqZWN0IEludDE2QXJyYXldIiwgaW50MzJUYWcgPSAiW29iamVjdCBJbnQzMkFycmF5XSIsIHVpbnQ4VGFnID0gIltvYmplY3QgVWludDhBcnJheV0iLCB1aW50OENsYW1wZWRUYWcgPSAiW29iamVjdCBVaW50OENsYW1wZWRBcnJheV0iLCB1aW50MTZUYWcgPSAiW29iamVjdCBVaW50MTZBcnJheV0iLCB1aW50MzJUYWcgPSAiW29iamVjdCBVaW50MzJBcnJheV0iOwogIHZhciB0eXBlZEFycmF5VGFncyA9IHt9OwogIHR5cGVkQXJyYXlUYWdzW2Zsb2F0MzJUYWddID0gdHlwZWRBcnJheVRhZ3NbZmxvYXQ2NFRhZ10gPSB0eXBlZEFycmF5VGFnc1tpbnQ4VGFnXSA9IHR5cGVkQXJyYXlUYWdzW2ludDE2VGFnXSA9IHR5cGVkQXJyYXlUYWdzW2ludDMyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW3VpbnQ4VGFnXSA9IHR5cGVkQXJyYXlUYWdzW3VpbnQ4Q2xhbXBlZFRhZ10gPSB0eXBlZEFycmF5VGFnc1t1aW50MTZUYWddID0gdHlwZWRBcnJheVRhZ3NbdWludDMyVGFnXSA9IHRydWU7CiAgdHlwZWRBcnJheVRhZ3NbYXJnc1RhZ10gPSB0eXBlZEFycmF5VGFnc1thcnJheVRhZ10gPSB0eXBlZEFycmF5VGFnc1thcnJheUJ1ZmZlclRhZ10gPSB0eXBlZEFycmF5VGFnc1tib29sVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2RhdGFWaWV3VGFnXSA9IHR5cGVkQXJyYXlUYWdzW2RhdGVUYWddID0gdHlwZWRBcnJheVRhZ3NbZXJyb3JUYWddID0gdHlwZWRBcnJheVRhZ3NbZnVuY1RhZ10gPSB0eXBlZEFycmF5VGFnc1ttYXBUYWddID0gdHlwZWRBcnJheVRhZ3NbbnVtYmVyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW29iamVjdFRhZ10gPSB0eXBlZEFycmF5VGFnc1tyZWdleHBUYWddID0gdHlwZWRBcnJheVRhZ3Nbc2V0VGFnXSA9IHR5cGVkQXJyYXlUYWdzW3N0cmluZ1RhZ10gPSB0eXBlZEFycmF5VGFnc1t3ZWFrTWFwVGFnXSA9IGZhbHNlOwogIGZ1bmN0aW9uIGJhc2VJc1R5cGVkQXJyYXkodmFsdWUpIHsKICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGlzTGVuZ3RoKHZhbHVlLmxlbmd0aCkgJiYgISF0eXBlZEFycmF5VGFnc1tiYXNlR2V0VGFnKHZhbHVlKV07CiAgfQogIGZ1bmN0aW9uIGJhc2VVbmFyeShmdW5jKSB7CiAgICByZXR1cm4gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgcmV0dXJuIGZ1bmModmFsdWUpOwogICAgfTsKICB9CiAgdmFyIGZyZWVFeHBvcnRzID0gdHlwZW9mIGV4cG9ydHMgPT0gIm9iamVjdCIgJiYgZXhwb3J0cyAmJiAhZXhwb3J0cy5ub2RlVHlwZSAmJiBleHBvcnRzOwogIHZhciBmcmVlTW9kdWxlID0gZnJlZUV4cG9ydHMgJiYgdHlwZW9mIG1vZHVsZSA9PSAib2JqZWN0IiAmJiBtb2R1bGUgJiYgIW1vZHVsZS5ub2RlVHlwZSAmJiBtb2R1bGU7CiAgdmFyIG1vZHVsZUV4cG9ydHMgPSBmcmVlTW9kdWxlICYmIGZyZWVNb2R1bGUuZXhwb3J0cyA9PT0gZnJlZUV4cG9ydHM7CiAgdmFyIGZyZWVQcm9jZXNzID0gbW9kdWxlRXhwb3J0cyAmJiBmcmVlR2xvYmFsJDEucHJvY2VzczsKICB2YXIgbm9kZVV0aWwgPSBmdW5jdGlvbigpIHsKICAgIHRyeSB7CiAgICAgIHZhciB0eXBlcyA9IGZyZWVNb2R1bGUgJiYgZnJlZU1vZHVsZS5yZXF1aXJlICYmIGZyZWVNb2R1bGUucmVxdWlyZSgidXRpbCIpLnR5cGVzOwogICAgICBpZiAodHlwZXMpIHsKICAgICAgICByZXR1cm4gdHlwZXM7CiAgICAgIH0KICAgICAgcmV0dXJuIGZyZWVQcm9jZXNzICYmIGZyZWVQcm9jZXNzLmJpbmRpbmcgJiYgZnJlZVByb2Nlc3MuYmluZGluZygidXRpbCIpOwogICAgfSBjYXRjaCAoZSkgewogICAgfQogIH0oKTsKICB2YXIgbm9kZVV0aWwkMSA9IG5vZGVVdGlsOwogIHZhciBub2RlSXNUeXBlZEFycmF5ID0gbm9kZVV0aWwkMSAmJiBub2RlVXRpbCQxLmlzVHlwZWRBcnJheTsKICB2YXIgaXNUeXBlZEFycmF5ID0gbm9kZUlzVHlwZWRBcnJheSA/IGJhc2VVbmFyeShub2RlSXNUeXBlZEFycmF5KSA6IGJhc2VJc1R5cGVkQXJyYXk7CiAgdmFyIGlzVHlwZWRBcnJheSQxID0gaXNUeXBlZEFycmF5OwogIHZhciBvYmplY3RQcm90byQxID0gT2JqZWN0LnByb3RvdHlwZTsKICB2YXIgaGFzT3duUHJvcGVydHkkMSA9IG9iamVjdFByb3RvJDEuaGFzT3duUHJvcGVydHk7CiAgZnVuY3Rpb24gYXJyYXlMaWtlS2V5cyh2YWx1ZSwgaW5oZXJpdGVkKSB7CiAgICB2YXIgaXNBcnIgPSBpc0FycmF5JDEodmFsdWUpLCBpc0FyZyA9ICFpc0FyciAmJiBpc0FyZ3VtZW50cyQxKHZhbHVlKSwgaXNCdWZmID0gIWlzQXJyICYmICFpc0FyZyAmJiBpc0J1ZmZlciQxKHZhbHVlKSwgaXNUeXBlID0gIWlzQXJyICYmICFpc0FyZyAmJiAhaXNCdWZmICYmIGlzVHlwZWRBcnJheSQxKHZhbHVlKSwgc2tpcEluZGV4ZXMgPSBpc0FyciB8fCBpc0FyZyB8fCBpc0J1ZmYgfHwgaXNUeXBlLCByZXN1bHQgPSBza2lwSW5kZXhlcyA/IGJhc2VUaW1lcyh2YWx1ZS5sZW5ndGgsIFN0cmluZykgOiBbXSwgbGVuZ3RoID0gcmVzdWx0Lmxlbmd0aDsKICAgIGZvciAodmFyIGtleSBpbiB2YWx1ZSkgewogICAgICBpZiAoKGluaGVyaXRlZCB8fCBoYXNPd25Qcm9wZXJ0eSQxLmNhbGwodmFsdWUsIGtleSkpICYmICEoc2tpcEluZGV4ZXMgJiYgKGtleSA9PSAibGVuZ3RoIiB8fCBpc0J1ZmYgJiYgKGtleSA9PSAib2Zmc2V0IiB8fCBrZXkgPT0gInBhcmVudCIpIHx8IGlzVHlwZSAmJiAoa2V5ID09ICJidWZmZXIiIHx8IGtleSA9PSAiYnl0ZUxlbmd0aCIgfHwga2V5ID09ICJieXRlT2Zmc2V0IikgfHwgaXNJbmRleChrZXksIGxlbmd0aCkpKSkgewogICAgICAgIHJlc3VsdC5wdXNoKGtleSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQogIGZ1bmN0aW9uIG92ZXJBcmcoZnVuYywgdHJhbnNmb3JtKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oYXJnKSB7CiAgICAgIHJldHVybiBmdW5jKHRyYW5zZm9ybShhcmcpKTsKICAgIH07CiAgfQogIHZhciBuYXRpdmVLZXlzID0gb3ZlckFyZyhPYmplY3Qua2V5cywgT2JqZWN0KTsKICB2YXIgbmF0aXZlS2V5cyQxID0gbmF0aXZlS2V5czsKICB2YXIgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOwogIHZhciBoYXNPd25Qcm9wZXJ0eSA9IG9iamVjdFByb3RvLmhhc093blByb3BlcnR5OwogIGZ1bmN0aW9uIGJhc2VLZXlzKG9iamVjdCkgewogICAgaWYgKCFpc1Byb3RvdHlwZShvYmplY3QpKSB7CiAgICAgIHJldHVybiBuYXRpdmVLZXlzJDEob2JqZWN0KTsKICAgIH0KICAgIHZhciByZXN1bHQgPSBbXTsKICAgIGZvciAodmFyIGtleSBpbiBPYmplY3Qob2JqZWN0KSkgewogICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSkgJiYga2V5ICE9ICJjb25zdHJ1Y3RvciIpIHsKICAgICAgICByZXN1bHQucHVzaChrZXkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICBmdW5jdGlvbiBrZXlzKG9iamVjdCkgewogICAgcmV0dXJuIGlzQXJyYXlMaWtlKG9iamVjdCkgPyBhcnJheUxpa2VLZXlzKG9iamVjdCkgOiBiYXNlS2V5cyhvYmplY3QpOwogIH0KICBmdW5jdGlvbiBiYXNlQ2xhbXAobnVtYmVyLCBsb3dlciwgdXBwZXIpIHsKICAgIGlmIChudW1iZXIgPT09IG51bWJlcikgewogICAgICBpZiAodXBwZXIgIT09IHZvaWQgMCkgewogICAgICAgIG51bWJlciA9IG51bWJlciA8PSB1cHBlciA/IG51bWJlciA6IHVwcGVyOwogICAgICB9CiAgICAgIGlmIChsb3dlciAhPT0gdm9pZCAwKSB7CiAgICAgICAgbnVtYmVyID0gbnVtYmVyID49IGxvd2VyID8gbnVtYmVyIDogbG93ZXI7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBudW1iZXI7CiAgfQogIGZ1bmN0aW9uIGJhc2VWYWx1ZXMob2JqZWN0LCBwcm9wcykgewogICAgcmV0dXJuIGFycmF5TWFwKHByb3BzLCBmdW5jdGlvbihrZXkpIHsKICAgICAgcmV0dXJuIG9iamVjdFtrZXldOwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIHZhbHVlcyhvYmplY3QpIHsKICAgIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IFtdIDogYmFzZVZhbHVlcyhvYmplY3QsIGtleXMob2JqZWN0KSk7CiAgfQogIHZhciBuYXRpdmVGbG9vciA9IE1hdGguZmxvb3IsIG5hdGl2ZVJhbmRvbSA9IE1hdGgucmFuZG9tOwogIGZ1bmN0aW9uIGJhc2VSYW5kb20obG93ZXIsIHVwcGVyKSB7CiAgICByZXR1cm4gbG93ZXIgKyBuYXRpdmVGbG9vcihuYXRpdmVSYW5kb20oKSAqICh1cHBlciAtIGxvd2VyICsgMSkpOwogIH0KICBmdW5jdGlvbiBzaHVmZmxlU2VsZihhcnJheSwgc2l6ZSkgewogICAgdmFyIGluZGV4ID0gLTEsIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCwgbGFzdEluZGV4ID0gbGVuZ3RoIC0gMTsKICAgIHNpemUgPSBzaXplID09PSB2b2lkIDAgPyBsZW5ndGggOiBzaXplOwogICAgd2hpbGUgKCsraW5kZXggPCBzaXplKSB7CiAgICAgIHZhciByYW5kID0gYmFzZVJhbmRvbShpbmRleCwgbGFzdEluZGV4KSwgdmFsdWUgPSBhcnJheVtyYW5kXTsKICAgICAgYXJyYXlbcmFuZF0gPSBhcnJheVtpbmRleF07CiAgICAgIGFycmF5W2luZGV4XSA9IHZhbHVlOwogICAgfQogICAgYXJyYXkubGVuZ3RoID0gc2l6ZTsKICAgIHJldHVybiBhcnJheTsKICB9CiAgZnVuY3Rpb24gYXJyYXlTYW1wbGVTaXplKGFycmF5LCBuKSB7CiAgICByZXR1cm4gc2h1ZmZsZVNlbGYoY29weUFycmF5KGFycmF5KSwgYmFzZUNsYW1wKG4sIDAsIGFycmF5Lmxlbmd0aCkpOwogIH0KICBmdW5jdGlvbiBiYXNlU2FtcGxlU2l6ZShjb2xsZWN0aW9uLCBuKSB7CiAgICB2YXIgYXJyYXkgPSB2YWx1ZXMoY29sbGVjdGlvbik7CiAgICByZXR1cm4gc2h1ZmZsZVNlbGYoYXJyYXksIGJhc2VDbGFtcChuLCAwLCBhcnJheS5sZW5ndGgpKTsKICB9CiAgZnVuY3Rpb24gc2FtcGxlU2l6ZShjb2xsZWN0aW9uLCBuLCBndWFyZCkgewogICAgaWYgKGd1YXJkID8gaXNJdGVyYXRlZUNhbGwoY29sbGVjdGlvbiwgbiwgZ3VhcmQpIDogbiA9PT0gdm9pZCAwKSB7CiAgICAgIG4gPSAxOwogICAgfSBlbHNlIHsKICAgICAgbiA9IHRvSW50ZWdlcihuKTsKICAgIH0KICAgIHZhciBmdW5jID0gaXNBcnJheSQxKGNvbGxlY3Rpb24pID8gYXJyYXlTYW1wbGVTaXplIDogYmFzZVNhbXBsZVNpemU7CiAgICByZXR1cm4gZnVuYyhjb2xsZWN0aW9uLCBuKTsKICB9CiAgZnVuY3Rpb24gYXNjZW5kaW5nKGEsIGIpIHsKICAgIHJldHVybiBhIDwgYiA/IC0xIDogYSA+IGIgPyAxIDogYSA+PSBiID8gMCA6IE5hTjsKICB9CiAgZnVuY3Rpb24gYmlzZWN0b3IoZikgewogICAgbGV0IGRlbHRhID0gZjsKICAgIGxldCBjb21wYXJlID0gZjsKICAgIGlmIChmLmxlbmd0aCA9PT0gMSkgewogICAgICBkZWx0YSA9IChkLCB4KSA9PiBmKGQpIC0geDsKICAgICAgY29tcGFyZSA9IGFzY2VuZGluZ0NvbXBhcmF0b3IoZik7CiAgICB9CiAgICBmdW5jdGlvbiBsZWZ0KGEsIHgsIGxvLCBoaSkgewogICAgICBpZiAobG8gPT0gbnVsbCkKICAgICAgICBsbyA9IDA7CiAgICAgIGlmIChoaSA9PSBudWxsKQogICAgICAgIGhpID0gYS5sZW5ndGg7CiAgICAgIHdoaWxlIChsbyA8IGhpKSB7CiAgICAgICAgY29uc3QgbWlkID0gbG8gKyBoaSA+Pj4gMTsKICAgICAgICBpZiAoY29tcGFyZShhW21pZF0sIHgpIDwgMCkKICAgICAgICAgIGxvID0gbWlkICsgMTsKICAgICAgICBlbHNlCiAgICAgICAgICBoaSA9IG1pZDsKICAgICAgfQogICAgICByZXR1cm4gbG87CiAgICB9CiAgICBmdW5jdGlvbiByaWdodChhLCB4LCBsbywgaGkpIHsKICAgICAgaWYgKGxvID09IG51bGwpCiAgICAgICAgbG8gPSAwOwogICAgICBpZiAoaGkgPT0gbnVsbCkKICAgICAgICBoaSA9IGEubGVuZ3RoOwogICAgICB3aGlsZSAobG8gPCBoaSkgewogICAgICAgIGNvbnN0IG1pZCA9IGxvICsgaGkgPj4+IDE7CiAgICAgICAgaWYgKGNvbXBhcmUoYVttaWRdLCB4KSA+IDApCiAgICAgICAgICBoaSA9IG1pZDsKICAgICAgICBlbHNlCiAgICAgICAgICBsbyA9IG1pZCArIDE7CiAgICAgIH0KICAgICAgcmV0dXJuIGxvOwogICAgfQogICAgZnVuY3Rpb24gY2VudGVyKGEsIHgsIGxvLCBoaSkgewogICAgICBpZiAobG8gPT0gbnVsbCkKICAgICAgICBsbyA9IDA7CiAgICAgIGlmIChoaSA9PSBudWxsKQogICAgICAgIGhpID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGkgPSBsZWZ0KGEsIHgsIGxvLCBoaSAtIDEpOwogICAgICByZXR1cm4gaSA+IGxvICYmIGRlbHRhKGFbaSAtIDFdLCB4KSA+IC1kZWx0YShhW2ldLCB4KSA/IGkgLSAxIDogaTsKICAgIH0KICAgIHJldHVybiB7IGxlZnQsIGNlbnRlciwgcmlnaHQgfTsKICB9CiAgZnVuY3Rpb24gYXNjZW5kaW5nQ29tcGFyYXRvcihmKSB7CiAgICByZXR1cm4gKGQsIHgpID0+IGFzY2VuZGluZyhmKGQpLCB4KTsKICB9CiAgdmFyIEVPTCA9IHt9LCBFT0YgPSB7fSwgUVVPVEUgPSAzNCwgTkVXTElORSA9IDEwLCBSRVRVUk4gPSAxMzsKICBmdW5jdGlvbiBvYmplY3RDb252ZXJ0ZXIoY29sdW1ucykgewogICAgcmV0dXJuIG5ldyBGdW5jdGlvbigiZCIsICJyZXR1cm4geyIgKyBjb2x1bW5zLm1hcChmdW5jdGlvbihuYW1lLCBpKSB7CiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShuYW1lKSArICI6IGRbIiArIGkgKyAnXSB8fCAiIic7CiAgICB9KS5qb2luKCIsIikgKyAifSIpOwogIH0KICBmdW5jdGlvbiBjdXN0b21Db252ZXJ0ZXIoY29sdW1ucywgZikgewogICAgdmFyIG9iamVjdCA9IG9iamVjdENvbnZlcnRlcihjb2x1bW5zKTsKICAgIHJldHVybiBmdW5jdGlvbihyb3csIGkpIHsKICAgICAgcmV0dXJuIGYob2JqZWN0KHJvdyksIGksIGNvbHVtbnMpOwogICAgfTsKICB9CiAgZnVuY3Rpb24gaW5mZXJDb2x1bW5zKHJvd3MpIHsKICAgIHZhciBjb2x1bW5TZXQgPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKSwgY29sdW1ucyA9IFtdOwogICAgcm93cy5mb3JFYWNoKGZ1bmN0aW9uKHJvdykgewogICAgICBmb3IgKHZhciBjb2x1bW4gaW4gcm93KSB7CiAgICAgICAgaWYgKCEoY29sdW1uIGluIGNvbHVtblNldCkpIHsKICAgICAgICAgIGNvbHVtbnMucHVzaChjb2x1bW5TZXRbY29sdW1uXSA9IGNvbHVtbik7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBjb2x1bW5zOwogIH0KICBmdW5jdGlvbiBwYWQodmFsdWUsIHdpZHRoKSB7CiAgICB2YXIgcyA9IHZhbHVlICsgIiIsIGxlbmd0aCA9IHMubGVuZ3RoOwogICAgcmV0dXJuIGxlbmd0aCA8IHdpZHRoID8gbmV3IEFycmF5KHdpZHRoIC0gbGVuZ3RoICsgMSkuam9pbigwKSArIHMgOiBzOwogIH0KICBmdW5jdGlvbiBmb3JtYXRZZWFyKHllYXIpIHsKICAgIHJldHVybiB5ZWFyIDwgMCA/ICItIiArIHBhZCgteWVhciwgNikgOiB5ZWFyID4gOTk5OSA/ICIrIiArIHBhZCh5ZWFyLCA2KSA6IHBhZCh5ZWFyLCA0KTsKICB9CiAgZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlKSB7CiAgICB2YXIgaG91cnMgPSBkYXRlLmdldFVUQ0hvdXJzKCksIG1pbnV0ZXMgPSBkYXRlLmdldFVUQ01pbnV0ZXMoKSwgc2Vjb25kcyA9IGRhdGUuZ2V0VVRDU2Vjb25kcygpLCBtaWxsaXNlY29uZHMgPSBkYXRlLmdldFVUQ01pbGxpc2Vjb25kcygpOwogICAgcmV0dXJuIGlzTmFOKGRhdGUpID8gIkludmFsaWQgRGF0ZSIgOiBmb3JtYXRZZWFyKGRhdGUuZ2V0VVRDRnVsbFllYXIoKSkgKyAiLSIgKyBwYWQoZGF0ZS5nZXRVVENNb250aCgpICsgMSwgMikgKyAiLSIgKyBwYWQoZGF0ZS5nZXRVVENEYXRlKCksIDIpICsgKG1pbGxpc2Vjb25kcyA/ICJUIiArIHBhZChob3VycywgMikgKyAiOiIgKyBwYWQobWludXRlcywgMikgKyAiOiIgKyBwYWQoc2Vjb25kcywgMikgKyAiLiIgKyBwYWQobWlsbGlzZWNvbmRzLCAzKSArICJaIiA6IHNlY29uZHMgPyAiVCIgKyBwYWQoaG91cnMsIDIpICsgIjoiICsgcGFkKG1pbnV0ZXMsIDIpICsgIjoiICsgcGFkKHNlY29uZHMsIDIpICsgIloiIDogbWludXRlcyB8fCBob3VycyA/ICJUIiArIHBhZChob3VycywgMikgKyAiOiIgKyBwYWQobWludXRlcywgMikgKyAiWiIgOiAiIik7CiAgfQogIGZ1bmN0aW9uIGRzdihkZWxpbWl0ZXIpIHsKICAgIHZhciByZUZvcm1hdCA9IG5ldyBSZWdFeHAoJ1siJyArIGRlbGltaXRlciArICJcblxyXSIpLCBERUxJTUlURVIgPSBkZWxpbWl0ZXIuY2hhckNvZGVBdCgwKTsKICAgIGZ1bmN0aW9uIHBhcnNlKHRleHQsIGYpIHsKICAgICAgdmFyIGNvbnZlcnQsIGNvbHVtbnMsIHJvd3MgPSBwYXJzZVJvd3ModGV4dCwgZnVuY3Rpb24ocm93LCBpKSB7CiAgICAgICAgaWYgKGNvbnZlcnQpCiAgICAgICAgICByZXR1cm4gY29udmVydChyb3csIGkgLSAxKTsKICAgICAgICBjb2x1bW5zID0gcm93LCBjb252ZXJ0ID0gZiA/IGN1c3RvbUNvbnZlcnRlcihyb3csIGYpIDogb2JqZWN0Q29udmVydGVyKHJvdyk7CiAgICAgIH0pOwogICAgICByb3dzLmNvbHVtbnMgPSBjb2x1bW5zIHx8IFtdOwogICAgICByZXR1cm4gcm93czsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlUm93cyh0ZXh0LCBmKSB7CiAgICAgIHZhciByb3dzID0gW10sIE4gPSB0ZXh0Lmxlbmd0aCwgSSA9IDAsIG4gPSAwLCB0LCBlb2YgPSBOIDw9IDAsIGVvbCA9IGZhbHNlOwogICAgICBpZiAodGV4dC5jaGFyQ29kZUF0KE4gLSAxKSA9PT0gTkVXTElORSkKICAgICAgICAtLU47CiAgICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQoTiAtIDEpID09PSBSRVRVUk4pCiAgICAgICAgLS1OOwogICAgICBmdW5jdGlvbiB0b2tlbigpIHsKICAgICAgICBpZiAoZW9mKQogICAgICAgICAgcmV0dXJuIEVPRjsKICAgICAgICBpZiAoZW9sKQogICAgICAgICAgcmV0dXJuIGVvbCA9IGZhbHNlLCBFT0w7CiAgICAgICAgdmFyIGksIGogPSBJLCBjMjsKICAgICAgICBpZiAodGV4dC5jaGFyQ29kZUF0KGopID09PSBRVU9URSkgewogICAgICAgICAgd2hpbGUgKEkrKyA8IE4gJiYgdGV4dC5jaGFyQ29kZUF0KEkpICE9PSBRVU9URSB8fCB0ZXh0LmNoYXJDb2RlQXQoKytJKSA9PT0gUVVPVEUpCiAgICAgICAgICAgIDsKICAgICAgICAgIGlmICgoaSA9IEkpID49IE4pCiAgICAgICAgICAgIGVvZiA9IHRydWU7CiAgICAgICAgICBlbHNlIGlmICgoYzIgPSB0ZXh0LmNoYXJDb2RlQXQoSSsrKSkgPT09IE5FV0xJTkUpCiAgICAgICAgICAgIGVvbCA9IHRydWU7CiAgICAgICAgICBlbHNlIGlmIChjMiA9PT0gUkVUVVJOKSB7CiAgICAgICAgICAgIGVvbCA9IHRydWU7CiAgICAgICAgICAgIGlmICh0ZXh0LmNoYXJDb2RlQXQoSSkgPT09IE5FV0xJTkUpCiAgICAgICAgICAgICAgKytJOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRleHQuc2xpY2UoaiArIDEsIGkgLSAxKS5yZXBsYWNlKC8iIi9nLCAnIicpOwogICAgICAgIH0KICAgICAgICB3aGlsZSAoSSA8IE4pIHsKICAgICAgICAgIGlmICgoYzIgPSB0ZXh0LmNoYXJDb2RlQXQoaSA9IEkrKykpID09PSBORVdMSU5FKQogICAgICAgICAgICBlb2wgPSB0cnVlOwogICAgICAgICAgZWxzZSBpZiAoYzIgPT09IFJFVFVSTikgewogICAgICAgICAgICBlb2wgPSB0cnVlOwogICAgICAgICAgICBpZiAodGV4dC5jaGFyQ29kZUF0KEkpID09PSBORVdMSU5FKQogICAgICAgICAgICAgICsrSTsKICAgICAgICAgIH0gZWxzZSBpZiAoYzIgIT09IERFTElNSVRFUikKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICByZXR1cm4gdGV4dC5zbGljZShqLCBpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVvZiA9IHRydWUsIHRleHQuc2xpY2UoaiwgTik7CiAgICAgIH0KICAgICAgd2hpbGUgKCh0ID0gdG9rZW4oKSkgIT09IEVPRikgewogICAgICAgIHZhciByb3cgPSBbXTsKICAgICAgICB3aGlsZSAodCAhPT0gRU9MICYmIHQgIT09IEVPRikKICAgICAgICAgIHJvdy5wdXNoKHQpLCB0ID0gdG9rZW4oKTsKICAgICAgICBpZiAoZiAmJiAocm93ID0gZihyb3csIG4rKykpID09IG51bGwpCiAgICAgICAgICBjb250aW51ZTsKICAgICAgICByb3dzLnB1c2gocm93KTsKICAgICAgfQogICAgICByZXR1cm4gcm93czsKICAgIH0KICAgIGZ1bmN0aW9uIHByZWZvcm1hdEJvZHkocm93cywgY29sdW1ucykgewogICAgICByZXR1cm4gcm93cy5tYXAoZnVuY3Rpb24ocm93KSB7CiAgICAgICAgcmV0dXJuIGNvbHVtbnMubWFwKGZ1bmN0aW9uKGNvbHVtbikgewogICAgICAgICAgcmV0dXJuIGZvcm1hdFZhbHVlKHJvd1tjb2x1bW5dKTsKICAgICAgICB9KS5qb2luKGRlbGltaXRlcik7CiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gZm9ybWF0KHJvd3MsIGNvbHVtbnMpIHsKICAgICAgaWYgKGNvbHVtbnMgPT0gbnVsbCkKICAgICAgICBjb2x1bW5zID0gaW5mZXJDb2x1bW5zKHJvd3MpOwogICAgICByZXR1cm4gW2NvbHVtbnMubWFwKGZvcm1hdFZhbHVlKS5qb2luKGRlbGltaXRlcildLmNvbmNhdChwcmVmb3JtYXRCb2R5KHJvd3MsIGNvbHVtbnMpKS5qb2luKCJcbiIpOwogICAgfQogICAgZnVuY3Rpb24gZm9ybWF0Qm9keShyb3dzLCBjb2x1bW5zKSB7CiAgICAgIGlmIChjb2x1bW5zID09IG51bGwpCiAgICAgICAgY29sdW1ucyA9IGluZmVyQ29sdW1ucyhyb3dzKTsKICAgICAgcmV0dXJuIHByZWZvcm1hdEJvZHkocm93cywgY29sdW1ucykuam9pbigiXG4iKTsKICAgIH0KICAgIGZ1bmN0aW9uIGZvcm1hdFJvd3Mocm93cykgewogICAgICByZXR1cm4gcm93cy5tYXAoZm9ybWF0Um93KS5qb2luKCJcbiIpOwogICAgfQogICAgZnVuY3Rpb24gZm9ybWF0Um93KHJvdykgewogICAgICByZXR1cm4gcm93Lm1hcChmb3JtYXRWYWx1ZSkuam9pbihkZWxpbWl0ZXIpOwogICAgfQogICAgZnVuY3Rpb24gZm9ybWF0VmFsdWUodmFsdWUpIHsKICAgICAgcmV0dXJuIHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVlIGluc3RhbmNlb2YgRGF0ZSA/IGZvcm1hdERhdGUodmFsdWUpIDogcmVGb3JtYXQudGVzdCh2YWx1ZSArPSAiIikgPyAnIicgKyB2YWx1ZS5yZXBsYWNlKC8iL2csICciIicpICsgJyInIDogdmFsdWU7CiAgICB9CiAgICByZXR1cm4gewogICAgICBwYXJzZSwKICAgICAgcGFyc2VSb3dzLAogICAgICBmb3JtYXQsCiAgICAgIGZvcm1hdEJvZHksCiAgICAgIGZvcm1hdFJvd3MsCiAgICAgIGZvcm1hdFJvdywKICAgICAgZm9ybWF0VmFsdWUKICAgIH07CiAgfQogIHZhciB0c3YgPSBkc3YoIgkiKTsKICB2YXIgdHN2UGFyc2VSb3dzID0gdHN2LnBhcnNlUm93czsKICBjb25zdCBjaHJvbUluZm9CaXNlY3RvciA9IGJpc2VjdG9yKChkKSA9PiBkLnBvcykubGVmdDsKICBjb25zdCBjaHJUb0FicyA9IChjaHJvbSwgY2hyb21Qb3MsIGNocm9tSW5mbykgPT4gY2hyb21JbmZvLmNoclBvc2l0aW9uc1tjaHJvbV0ucG9zICsgY2hyb21Qb3M7CiAgY29uc3QgYWJzVG9DaHIgPSAoYWJzUG9zaXRpb24sIGNocm9tSW5mbykgPT4gewogICAgaWYgKCFjaHJvbUluZm8gfHwgIWNocm9tSW5mby5jdW1Qb3NpdGlvbnMgfHwgIWNocm9tSW5mby5jdW1Qb3NpdGlvbnMubGVuZ3RoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgbGV0IGluc2VydFBvaW50ID0gY2hyb21JbmZvQmlzZWN0b3IoY2hyb21JbmZvLmN1bVBvc2l0aW9ucywgYWJzUG9zaXRpb24pOwogICAgY29uc3QgbGFzdENociA9IGNocm9tSW5mby5jdW1Qb3NpdGlvbnNbY2hyb21JbmZvLmN1bVBvc2l0aW9ucy5sZW5ndGggLSAxXS5jaHI7CiAgICBjb25zdCBsYXN0TGVuZ3RoID0gY2hyb21JbmZvLmNocm9tTGVuZ3Roc1tsYXN0Q2hyXTsKICAgIGluc2VydFBvaW50IC09IGluc2VydFBvaW50ID4gMCAmJiAxOwogICAgbGV0IGNoclBvc2l0aW9uID0gTWF0aC5mbG9vcihhYnNQb3NpdGlvbiAtIGNocm9tSW5mby5jdW1Qb3NpdGlvbnNbaW5zZXJ0UG9pbnRdLnBvcyk7CiAgICBsZXQgb2Zmc2V0ID0gMDsKICAgIGlmIChjaHJQb3NpdGlvbiA8IDApIHsKICAgICAgb2Zmc2V0ID0gY2hyUG9zaXRpb24gLSAxOwogICAgICBjaHJQb3NpdGlvbiA9IDE7CiAgICB9CiAgICBpZiAoaW5zZXJ0UG9pbnQgPT09IGNocm9tSW5mby5jdW1Qb3NpdGlvbnMubGVuZ3RoIC0gMSAmJiBjaHJQb3NpdGlvbiA+IGxhc3RMZW5ndGgpIHsKICAgICAgb2Zmc2V0ID0gY2hyUG9zaXRpb24gLSBsYXN0TGVuZ3RoOwogICAgICBjaHJQb3NpdGlvbiA9IGxhc3RMZW5ndGg7CiAgICB9CiAgICByZXR1cm4gW2Nocm9tSW5mby5jdW1Qb3NpdGlvbnNbaW5zZXJ0UG9pbnRdLmNociwgY2hyUG9zaXRpb24sIG9mZnNldCwgaW5zZXJ0UG9pbnRdOwogIH07CiAgZnVuY3Rpb24gcGFyc2VDaHJTaXplcyhyb3dzKSB7CiAgICBjb25zdCBpbmZvID0gewogICAgICBjdW1Qb3NpdGlvbnM6IFtdLAogICAgICBjaHJvbUxlbmd0aHM6IHt9LAogICAgICBjaHJQb3NpdGlvbnM6IHt9LAogICAgICB0b3RhbExlbmd0aDogMAogICAgfTsKICAgIHJvd3MuZm9yRWFjaCgoZCwgaSkgPT4gewogICAgICBjb25zdCBjaHIgPSBkWzBdOwogICAgICBjb25zdCBsZW5ndGggPSBOdW1iZXIoZFsxXSk7CiAgICAgIGNvbnN0IGNoclBvc2l0aW9uID0geyBpZDogaSwgY2hyLCBwb3M6IGluZm8udG90YWxMZW5ndGggfTsKICAgICAgaW5mby5jaHJQb3NpdGlvbnNbY2hyXSA9IGNoclBvc2l0aW9uOwogICAgICBpbmZvLmNocm9tTGVuZ3Roc1tjaHJdID0gbGVuZ3RoOwogICAgICBpbmZvLmN1bVBvc2l0aW9ucy5wdXNoKGNoclBvc2l0aW9uKTsKICAgICAgaW5mby50b3RhbExlbmd0aCArPSBsZW5ndGg7CiAgICB9KTsKICAgIHJldHVybiBpbmZvOwogIH0KICBhc3luYyBmdW5jdGlvbiBmZXRjaENocm9tSW5mbyh1cmwpIHsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsKTsKICAgIGNvbnN0IGNockluZm9UZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpOwogICAgY29uc3QgZGF0YSA9IHRzdlBhcnNlUm93cyhjaHJJbmZvVGV4dCk7CiAgICBjb25zdCBpbmZvID0gcGFyc2VDaHJTaXplcyhkYXRhKTsKICAgIHJldHVybiB7CiAgICAgIC4uLmluZm8sCiAgICAgIGFic1RvQ2hyOiAoYWJzUG9zKSA9PiBpbmZvLmNoclBvc2l0aW9ucyA/IGFic1RvQ2hyKGFic1BvcywgaW5mbykgOiBudWxsLAogICAgICBjaHJUb0FiczogKFtjaHJOYW1lLCBjaHJQb3NdKSA9PiBpbmZvLmNoclBvc2l0aW9ucyA/IGNoclRvQWJzKGNock5hbWUsIGNoclBvcywgaW5mbykgOiBudWxsCiAgICB9OwogIH0KICBjbGFzcyBSZW1vdGVGaWxlIGV4dGVuZHMgZGlzdCQxLlJlbW90ZUZpbGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7CiAgICAgIHRoaXMucmVhZCA9IGFzeW5jIChidWZmZXIsIG9mZnNldCA9IDAsIGxlbmd0aCwgcG9zaXRpb24gPSAwLCBvcHRzID0ge30pID0+IHsKICAgICAgICBjb25zdCB7IGhlYWRlcnMgPSB7fSwgc2lnbmFsLCBvdmVycmlkZXMgPSB7fSB9ID0gb3B0czsKICAgICAgICBpZiAobGVuZ3RoIDwgSW5maW5pdHkpIHsKICAgICAgICAgIGhlYWRlcnMucmFuZ2UgPSBgYnl0ZXM9JHtwb3NpdGlvbn0tJHtwb3NpdGlvbiArIGxlbmd0aH1gOwogICAgICAgIH0gZWxzZSBpZiAobGVuZ3RoID09PSBJbmZpbml0eSAmJiBwb3NpdGlvbiAhPT0gMCkgewogICAgICAgICAgaGVhZGVycy5yYW5nZSA9IGBieXRlcz0ke3Bvc2l0aW9ufS1gOwogICAgICAgIH0KICAgICAgICBjb25zdCBhcmdzID0gewogICAgICAgICAgLi4udGhpcy5iYXNlT3ZlcnJpZGVzLAogICAgICAgICAgLi4ub3ZlcnJpZGVzLAogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAuLi5oZWFkZXJzLAogICAgICAgICAgICAuLi5vdmVycmlkZXMuaGVhZGVycywKICAgICAgICAgICAgLi4udGhpcy5iYXNlT3ZlcnJpZGVzLmhlYWRlcnMKICAgICAgICAgIH0sCiAgICAgICAgICBtZXRob2Q6ICJHRVQiLAogICAgICAgICAgcmVkaXJlY3Q6ICJmb2xsb3ciLAogICAgICAgICAgbW9kZTogImNvcnMiLAogICAgICAgICAgc2lnbmFsCiAgICAgICAgfTsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuZmV0Y2godGhpcy51cmwsIGFyZ3MpOwogICAgICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCAke3Jlc3BvbnNlLnN0YXR1c30gJHtyZXNwb25zZS5zdGF0dXNUZXh0fSAke3RoaXMudXJsfWApOwogICAgICAgIH0KICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDAgfHwgcmVzcG9uc2Uuc3RhdHVzID09PSAyMDYpIHsKICAgICAgICAgIGNvbnN0IHJlc3BvbnNlRGF0YSA9IGF3YWl0IHRoaXMuZ2V0QnVmZmVyRnJvbVJlc3BvbnNlKHJlc3BvbnNlKTsKICAgICAgICAgIGNvbnN0IGJ5dGVzQ29waWVkID0gcmVzcG9uc2VEYXRhLmNvcHkoYnVmZmVyLCBvZmZzZXQsIDAsIE1hdGgubWluKGxlbmd0aCwgcmVzcG9uc2VEYXRhLmxlbmd0aCkpOwogICAgICAgICAgY29uc3QgcmVzID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoImNvbnRlbnQtcmFuZ2UiKTsKICAgICAgICAgIGNvbnN0IHNpemVNYXRjaCA9IC9cLyhcZCspJC8uZXhlYyhyZXMgfHwgIiIpOwogICAgICAgICAgaWYgKHNpemVNYXRjaCAmJiBzaXplTWF0Y2hbMV0pIHsKICAgICAgICAgICAgdGhpcy5fc3RhdCA9IHsgc2l6ZTogcGFyc2VJbnQoc2l6ZU1hdGNoWzFdLCAxMCkgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB7IGJ5dGVzUmVhZDogYnl0ZXNDb3BpZWQsIGJ1ZmZlciB9OwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhUVFAgJHtyZXNwb25zZS5zdGF0dXN9IGZldGNoaW5nICR7dGhpcy51cmx9YCk7CiAgICAgIH07CiAgICB9CiAgfQogIGNvbnN0IHZjZkZpbGVzID0ge307CiAgY29uc3QgdmNmSGVhZGVycyA9IHt9OwogIGNvbnN0IHRiaVZDRlBhcnNlcnMgPSB7fTsKICBjb25zdCBjaHJvbVNpemVzID0ge307CiAgY29uc3QgY2hyb21JbmZvcyA9IHt9OwogIGNvbnN0IHRpbGVWYWx1ZXMgPSB7fTsKICBjb25zdCB0aWxlc2V0SW5mb3MgPSB7fTsKICBjb25zdCBkYXRhQ29uZnMgPSB7fTsKICBjb25zdCBpbml0ID0gKHVpZCwgdmNmVXJsLCB0YmlVcmwsIGNocm9tU2l6ZXNVcmwsIHNhbXBsZUxlbmd0aCkgPT4gewogICAgdmFyIF9hOwogICAgaWYgKCF2Y2ZGaWxlc1t2Y2ZVcmxdKSB7CiAgICAgIHZjZkZpbGVzW3ZjZlVybF0gPSBuZXcgVGFiaXhJbmRleGVkRmlsZSh7CiAgICAgICAgZmlsZWhhbmRsZTogbmV3IFJlbW90ZUZpbGUodmNmVXJsKSwKICAgICAgICB0YmlGaWxlaGFuZGxlOiBuZXcgUmVtb3RlRmlsZSh0YmlVcmwpCiAgICAgIH0pOwogICAgICB2Y2ZIZWFkZXJzW3ZjZlVybF0gPSB2Y2ZGaWxlc1t2Y2ZVcmxdLmdldEhlYWRlcigpOwogICAgfQogICAgaWYgKGNocm9tU2l6ZXNVcmwpIHsKICAgICAgY2hyb21TaXplc1tjaHJvbVNpemVzVXJsXSA9IChfYSA9IGNocm9tU2l6ZXNbY2hyb21TaXplc1VybF0pICE9IG51bGwgPyBfYSA6IGZldGNoQ2hyb21JbmZvKGNocm9tU2l6ZXNVcmwpOwogICAgfQogICAgZGF0YUNvbmZzW3VpZF0gPSB7IHZjZlVybCwgY2hyb21TaXplc1VybCwgc2FtcGxlTGVuZ3RoIH07CiAgfTsKICBjb25zdCB0aWxlc2V0SW5mbyA9ICh1aWQpID0+IHsKICAgIGNvbnN0IHsgY2hyb21TaXplc1VybCwgdmNmVXJsIH0gPSBkYXRhQ29uZnNbdWlkXTsKICAgIGNvbnN0IHByb21pc2VzID0gW3ZjZkhlYWRlcnNbdmNmVXJsXSwgY2hyb21TaXplc1tjaHJvbVNpemVzVXJsXV07CiAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oKFtoZWFkZXIsIGNocm9tSW5mb10pID0+IHsKICAgICAgaWYgKCF0YmlWQ0ZQYXJzZXJzW3ZjZlVybF0pIHsKICAgICAgICB0YmlWQ0ZQYXJzZXJzW3ZjZlVybF0gPSBuZXcgVkNGKHsgaGVhZGVyIH0pOwogICAgICB9CiAgICAgIGNvbnN0IFRJTEVfU0laRSA9IDEwMjQ7CiAgICAgIGNocm9tSW5mb3NbY2hyb21TaXplc1VybF0gPSBjaHJvbUluZm87CiAgICAgIGNvbnN0IHJldFZhbCA9IHsKICAgICAgICB0aWxlX3NpemU6IFRJTEVfU0laRSwKICAgICAgICBtYXhfem9vbTogTWF0aC5jZWlsKE1hdGgubG9nKGNocm9tSW5mby50b3RhbExlbmd0aCAvIFRJTEVfU0laRSkgLyBNYXRoLmxvZygyKSksCiAgICAgICAgbWF4X3dpZHRoOiBjaHJvbUluZm8udG90YWxMZW5ndGgsCiAgICAgICAgbWluX3BvczogWzBdLAogICAgICAgIG1heF9wb3M6IFtjaHJvbUluZm8udG90YWxMZW5ndGhdCiAgICAgIH07CiAgICAgIHRpbGVzZXRJbmZvc1t1aWRdID0gcmV0VmFsOwogICAgICByZXR1cm4gcmV0VmFsOwogICAgfSk7CiAgfTsKICBjb25zdCBnZXRNdXRhdGlvblR5cGUgPSAocmVmLCBhbHQpID0+IHsKICAgIGlmICghYWx0KQogICAgICByZXR1cm4gInVua25vd24iOwogICAgaWYgKHJlZi5sZW5ndGggPT09IGFsdC5sZW5ndGgpCiAgICAgIHJldHVybiAic3Vic3RpdHV0aW9uIjsKICAgIGlmIChyZWYubGVuZ3RoID4gYWx0Lmxlbmd0aCkKICAgICAgcmV0dXJuICJkZWxldGlvbiI7CiAgICBpZiAocmVmLmxlbmd0aCA8IGFsdC5sZW5ndGgpCiAgICAgIHJldHVybiAiaW5zZXJ0aW9uIjsKICAgIHJldHVybiAidW5rbm93biI7CiAgfTsKICBjb25zdCBnZXRTdWJzdGl0dXRpb25UeXBlID0gKHJlZiwgYWx0KSA9PiB7CiAgICBzd2l0Y2ggKHJlZiArIGFsdCkgewogICAgICBjYXNlICJDQSI6CiAgICAgIGNhc2UgIkdUIjoKICAgICAgICByZXR1cm4gIkM+QSI7CiAgICAgIGNhc2UgIkNHIjoKICAgICAgY2FzZSAiR0MiOgogICAgICAgIHJldHVybiAiQz5HIjsKICAgICAgY2FzZSAiQ1QiOgogICAgICBjYXNlICJHQSI6CiAgICAgICAgcmV0dXJuICJDPlQiOwogICAgICBjYXNlICJUQSI6CiAgICAgIGNhc2UgIkFUIjoKICAgICAgICByZXR1cm4gIlQ+QSI7CiAgICAgIGNhc2UgIlRDIjoKICAgICAgY2FzZSAiQUciOgogICAgICAgIHJldHVybiAiVD5DIjsKICAgICAgY2FzZSAiVEciOgogICAgICBjYXNlICJBQyI6CiAgICAgICAgcmV0dXJuICJUPkciOwogICAgICBkZWZhdWx0OgogICAgICAgIHJldHVybiAidW5rbm93biI7CiAgICB9CiAgfTsKICBjb25zdCB0aWxlID0gYXN5bmMgKHVpZCwgeiwgeCkgPT4gewogICAgY29uc3QgeyBjaHJvbVNpemVzVXJsLCB2Y2ZVcmwgfSA9IGRhdGFDb25mc1t1aWRdOwogICAgaWYgKCF2Y2ZIZWFkZXJzW3ZjZlVybF0pCiAgICAgIHJldHVybiBbXTsKICAgIGNvbnN0IENBQ0hFX0tFWSA9IGAke3VpZH0uJHt6fS4ke3h9YDsKICAgIHRpbGVWYWx1ZXNbQ0FDSEVfS0VZXSA9IFtdOwogICAgY29uc3QgdHNJbmZvID0gYXdhaXQgdGlsZXNldEluZm8odWlkKTsKICAgIGNvbnN0IHJlY29yZFByb21pc2VzID0gW107CiAgICBjb25zdCB0aWxlV2lkdGggPSArdHNJbmZvLm1heF93aWR0aCAvIDIgKiogK3o7CiAgICBjb25zdCBtaW5YID0gdHNJbmZvLm1pbl9wb3NbMF0gKyB4ICogdGlsZVdpZHRoOwogICAgY29uc3QgbWF4WCA9IHRzSW5mby5taW5fcG9zWzBdICsgKHggKyAxKSAqIHRpbGVXaWR0aDsKICAgIGxldCBjdXJNaW5YID0gbWluWDsKICAgIGNvbnN0IHsgY2hyb21MZW5ndGhzLCBjdW1Qb3NpdGlvbnMgfSA9IGNocm9tSW5mb3NbY2hyb21TaXplc1VybF07CiAgICBjb25zdCB0YmlWQ0ZQYXJzZXIgPSB0YmlWQ0ZQYXJzZXJzW3ZjZlVybF07CiAgICBjdW1Qb3NpdGlvbnMuZm9yRWFjaCgoY3VtUG9zKSA9PiB7CiAgICAgIGNvbnN0IGNocm9tTmFtZSA9IGN1bVBvcy5jaHI7CiAgICAgIGNvbnN0IGNocm9tU3RhcnQgPSBjdW1Qb3MucG9zOwogICAgICBjb25zdCBjaHJvbUVuZCA9IGN1bVBvcy5wb3MgKyBjaHJvbUxlbmd0aHNbY2hyb21OYW1lXTsKICAgICAgY29uc3QgcGFyc2VMaW5lU3RvcmVEYXRhID0gKGxpbmUsIHByZXZQb3MpID0+IHsKICAgICAgICBjb25zdCB2Y2ZSZWNvcmQgPSB0YmlWQ0ZQYXJzZXIucGFyc2VMaW5lKGxpbmUpOwogICAgICAgIGNvbnN0IFBPUyA9IGN1bVBvcy5wb3MgKyB2Y2ZSZWNvcmQuUE9TICsgMTsKICAgICAgICBsZXQgQUxUOwogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZjZlJlY29yZC5BTFQpICYmIHZjZlJlY29yZC5BTFQubGVuZ3RoID4gMCkgewogICAgICAgICAgQUxUID0gdmNmUmVjb3JkLkFMVFswXTsKICAgICAgICB9CiAgICAgICAgY29uc3QgRElTVFBSRVYgPSAhcHJldlBvcyA/IG51bGwgOiB2Y2ZSZWNvcmQuUE9TIC0gcHJldlBvczsKICAgICAgICBjb25zdCBESVNUUFJFVkxPR0UgPSAhcHJldlBvcyA/IG51bGwgOiBNYXRoLmxvZyh2Y2ZSZWNvcmQuUE9TIC0gcHJldlBvcyk7CiAgICAgICAgY29uc3QgTVVUVFlQRSA9IGdldE11dGF0aW9uVHlwZSh2Y2ZSZWNvcmQuUkVGLCBBTFQpOwogICAgICAgIGNvbnN0IFNVQlRZUEUgPSBnZXRTdWJzdGl0dXRpb25UeXBlKHZjZlJlY29yZC5SRUYsIEFMVCk7CiAgICAgICAgY29uc3QgUE9TRU5EID0gUE9TICsgdmNmUmVjb3JkLlJFRi5sZW5ndGg7CiAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgIC4uLnZjZlJlY29yZCwKICAgICAgICAgIEFMVCwKICAgICAgICAgIE1VVFRZUEUsCiAgICAgICAgICBTVUJUWVBFLAogICAgICAgICAgSU5GTzogSlNPTi5zdHJpbmdpZnkodmNmUmVjb3JkLklORk8pLAogICAgICAgICAgT1JJR0lOQUxQT1M6IHZjZlJlY29yZC5QT1MsCiAgICAgICAgICBQT1MsCiAgICAgICAgICBQT1NFTkQsCiAgICAgICAgICBESVNUUFJFViwKICAgICAgICAgIERJU1RQUkVWTE9HRQogICAgICAgIH07CiAgICAgICAgT2JqZWN0LmtleXModmNmUmVjb3JkLklORk8pLmZvckVhY2goKGtleSkgPT4gewogICAgICAgICAgY29uc3QgdmFsID0gdmNmUmVjb3JkLklORk9ba2V5XTsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbCkpCiAgICAgICAgICAgIHJldHVybiBba2V5LCB2YWxbMF1dOwogICAgICAgICAgcmV0dXJuIFtrZXksIHZhbF07CiAgICAgICAgfSk7CiAgICAgICAgdGlsZVZhbHVlc1tDQUNIRV9LRVldID0gdGlsZVZhbHVlc1tDQUNIRV9LRVldLmNvbmNhdChbZGF0YV0pOwogICAgICAgIHJldHVybiB2Y2ZSZWNvcmQuUE9TOwogICAgICB9OwogICAgICBsZXQgc3RhcnRQb3MsIGVuZFBvczsKICAgICAgaWYgKGNocm9tU3RhcnQgPD0gY3VyTWluWCAmJiBjdXJNaW5YIDwgY2hyb21FbmQpIHsKICAgICAgICBsZXQgcHJldlBPUzsKICAgICAgICBpZiAobWF4WCA+IGNocm9tRW5kKSB7CiAgICAgICAgICBzdGFydFBvcyA9IGN1ck1pblggLSBjaHJvbVN0YXJ0OwogICAgICAgICAgZW5kUG9zID0gY2hyb21FbmQgLSBjaHJvbVN0YXJ0OwogICAgICAgICAgcmVjb3JkUHJvbWlzZXMucHVzaCh2Y2ZGaWxlc1t2Y2ZVcmxdLmdldExpbmVzKGNocm9tTmFtZSwgc3RhcnRQb3MsIGVuZFBvcywgKGxpbmUpID0+IHsKICAgICAgICAgICAgcHJldlBPUyA9IHBhcnNlTGluZVN0b3JlRGF0YShsaW5lLCBwcmV2UE9TKTsKICAgICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgfSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdGFydFBvcyA9IE1hdGguZmxvb3IoY3VyTWluWCAtIGNocm9tU3RhcnQpOwogICAgICAgICAgZW5kUG9zID0gTWF0aC5jZWlsKG1heFggLSBjaHJvbVN0YXJ0KTsKICAgICAgICAgIHJlY29yZFByb21pc2VzLnB1c2godmNmRmlsZXNbdmNmVXJsXS5nZXRMaW5lcyhjaHJvbU5hbWUsIHN0YXJ0UG9zLCBlbmRQb3MsIChsaW5lKSA9PiB7CiAgICAgICAgICAgIHByZXZQT1MgPSBwYXJzZUxpbmVTdG9yZURhdGEobGluZSwgcHJldlBPUyk7CiAgICAgICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICAgIH0pKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY3VyTWluWCA9IGNocm9tRW5kOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBQcm9taXNlLmFsbChyZWNvcmRQcm9taXNlcykudGhlbigodmFsdWVzMikgPT4gdmFsdWVzMi5mbGF0KCkpOwogIH07CiAgY29uc3QgZmV0Y2hUaWxlc0RlYm91bmNlZCA9IGFzeW5jICh1aWQsIHRpbGVJZHMpID0+IHsKICAgIGNvbnN0IHRpbGVzID0ge307CiAgICBjb25zdCB2YWxpZFRpbGVJZHMgPSBbXTsKICAgIGNvbnN0IHRpbGVQcm9taXNlcyA9IFtdOwogICAgZm9yIChjb25zdCB0aWxlSWQgb2YgdGlsZUlkcykgewogICAgICBjb25zdCBwYXJ0cyA9IHRpbGVJZC5zcGxpdCgiLiIpOwogICAgICBjb25zdCB6ID0gcGFyc2VJbnQocGFydHNbMF0sIDEwKTsKICAgICAgY29uc3QgeCA9IHBhcnNlSW50KHBhcnRzWzFdLCAxMCk7CiAgICAgIGlmIChOdW1iZXIuaXNOYU4oeCkgfHwgTnVtYmVyLmlzTmFOKHopKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJJbnZhbGlkIHRpbGUgem9vbSBvciBwb3NpdGlvbjoiLCB6LCB4KTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB2YWxpZFRpbGVJZHMucHVzaCh0aWxlSWQpOwogICAgICB0aWxlUHJvbWlzZXMucHVzaCh0aWxlKHVpZCwgeiwgeCkpOwogICAgfQogICAgcmV0dXJuIFByb21pc2UuYWxsKHRpbGVQcm9taXNlcykudGhlbigodmFsdWVzMikgPT4gewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlczIubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2YWxpZFRpbGVJZCA9IHZhbGlkVGlsZUlkc1tpXTsKICAgICAgICB0aWxlc1t2YWxpZFRpbGVJZF0gPSB2YWx1ZXMyW2ldOwogICAgICAgIHRpbGVzW3ZhbGlkVGlsZUlkXS50aWxlUG9zaXRpb25JZCA9IHZhbGlkVGlsZUlkOwogICAgICB9CiAgICAgIHJldHVybiB0aWxlczsKICAgIH0pOwogIH07CiAgY29uc3QgZ2V0VGFidWxhckRhdGEgPSAodWlkLCB0aWxlSWRzKSA9PiB7CiAgICBjb25zdCBkYXRhID0gW107CiAgICB0aWxlSWRzLmZvckVhY2goKHRpbGVJZCkgPT4gewogICAgICBjb25zdCBwYXJ0cyA9IHRpbGVJZC5zcGxpdCgiLiIpOwogICAgICBjb25zdCB6ID0gcGFyc2VJbnQocGFydHNbMF0sIDEwKTsKICAgICAgY29uc3QgeCA9IHBhcnNlSW50KHBhcnRzWzFdLCAxMCk7CiAgICAgIGNvbnN0IHRpbGVWYWx1ZSA9IHRpbGVWYWx1ZXNbYCR7dWlkfS4ke3p9LiR7eH1gXTsKICAgICAgaWYgKCF0aWxlVmFsdWUpIHsKICAgICAgICBjb25zb2xlLndhcm4oYE5vIHRpbGUgZGF0YSBjb25zdHJ1Y3RlZCAoJHt0aWxlSWR9KWApOwogICAgICB9CiAgICAgIGRhdGEucHVzaCh0aWxlVmFsdWUpOwogICAgfSk7CiAgICBsZXQgb3V0cHV0ID0gT2JqZWN0LnZhbHVlcyhkYXRhKS5mbGF0KCk7CiAgICBjb25zdCBzYW1wbGVMZW5ndGggPSBkYXRhQ29uZnNbdWlkXS5zYW1wbGVMZW5ndGg7CiAgICBpZiAob3V0cHV0Lmxlbmd0aCA+PSBzYW1wbGVMZW5ndGgpIHsKICAgICAgY29uc3QgaGlnaFByaW9yaXR5ID0gb3V0cHV0LnNvcnQoKGEsIGIpID0+IHsKICAgICAgICB2YXIgX2EsIF9iOwogICAgICAgIHJldHVybiAtKChfYSA9IGEuRElTVFBSRVYpICE9IG51bGwgPyBfYSA6IDApICsgKChfYiA9IGIuRElTVFBSRVYpICE9IG51bGwgPyBfYiA6IDApOwogICAgICB9KS5zbGljZSgwLCBzYW1wbGVMZW5ndGggLyAyKTsKICAgICAgb3V0cHV0ID0gc2FtcGxlU2l6ZShvdXRwdXQsIHNhbXBsZUxlbmd0aCAvIDIpLmNvbmNhdChoaWdoUHJpb3JpdHkpOwogICAgfQogICAgY29uc3QgYnVmZmVyID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKEpTT04uc3RyaW5naWZ5KG91dHB1dCkpLmJ1ZmZlcjsKICAgIHJldHVybiBUcmFuc2ZlcihidWZmZXIsIFtidWZmZXJdKTsKICB9OwogIGNvbnN0IHRpbGVGdW5jdGlvbnMgPSB7CiAgICBpbml0LAogICAgdGlsZXNldEluZm8sCiAgICBmZXRjaFRpbGVzRGVib3VuY2VkLAogICAgdGlsZSwKICAgIGdldFRhYnVsYXJEYXRhCiAgfTsKICBleHBvc2UodGlsZUZ1bmN0aW9ucyk7Cn0pKCk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPWFzc2V0cy92Y2Ytd29ya2VyLmEzMmJiNTY0LmpzLm1hcA==",wZ="undefined"!==typeof window&&window.Blob&&new Blob([atob(KZ)],{type:"text/javascript;charset=utf-8"});function JZ(){var I=wZ&&(window.URL||window.webkitURL).createObjectURL(wZ);try{return I?new Worker(I,{}):new Worker("data:application/javascript;base64,"+KZ,{type:"module"})}finally{I&&(window.URL||window.webkitURL).revokeObjectURL(I)}}var SZ=function(){function I(g,C){var A=this;Object(t.a)(this,I),this.dataConfig=C,this.uid=g.libraries.slugid.nice(),this.prevRequestTime=0,this.assembly=C.assembly,this.toFetch=new Set,this.worker=Object(eI.a)(new JZ).then(function(){var I=Object(e.a)(Object(i.a)().mark((function I(g){var e;return Object(i.a)().wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,g.init(A.uid,C.url,C.indexUrl,Qg(A.assembly).path,null!=(e=C.sampleLength)?e:1e3);case 2:return I.abrupt("return",g);case 3:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}())}return Object(c.a)(I,[{key:"tilesetInfo",value:function(){var I=Object(e.a)(Object(i.a)().mark((function I(g){return Object(i.a)().wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.worker;case 2:I.sent.tilesetInfo(this.uid).then(g);case 3:case"end":return I.stop()}}),I,this)})));return function(g){return I.apply(this,arguments)}}()},{key:"fetchTilesDebounced",value:function(I,g){var C=this;this.track.drawLoadingCue(),g.forEach((function(I){return C.toFetch.add(I)})),this.fetchTimeout&&clearTimeout(this.fetchTimeout),this.fetchTimeout=setTimeout((function(){C.sendFetch(I,Object(b.a)(C.toFetch)),C.toFetch.clear()}),200)}},{key:"sendFetch",value:function(){var I=Object(e.a)(Object(i.a)().mark((function I(g,C){return Object(i.a)().wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.worker;case 2:I.sent.fetchTilesDebounced(this.uid,C).then(g);case 3:case"end":return I.stop()}}),I,this)})));return function(g,C){return I.apply(this,arguments)}}()},{key:"getTabularData",value:function(){var I=Object(e.a)(Object(i.a)().mark((function I(g,C){var A;return Object(i.a)().wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,this.worker;case 2:return I.next=4,I.sent.getTabularData(g,C);case 4:return A=I.sent,I.abrupt("return",JSON.parse((new TextDecoder).decode(A)));case 6:case"end":return I.stop()}}),I,this)})));return function(g,C){return I.apply(this,arguments)}}()}]),I}(),FZ={color:"#777",stroke:"#777",strokeWidth:1,strokeOpacity:.7,opacity:.3},NZ=function(){function I(g,C,A){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(t.a)(this,I),this.range=null,this.prevExtent=[0,0],this.data=this.rangeToData(0,0),this.offset=[0,0],this.size=0,this.externals={d3Selection:C.d3Selection,d3Drag:C.d3Drag},this.style=Object.assign({},FZ,i),this.brushSelection=g.selectAll(".genomic-range-brush").data(this.data).enter().append("rect").attr("class","genomic-range-brush").call(this.onDrag()),this.onBrush=A}return Object(c.a)(I,[{key:"getRange",value:function(){return this.range}},{key:"setSize",value:function(I){return this.size=I,this}},{key:"setOffset",value:function(I,g){return this.offset=[I,g],this}},{key:"updateRange",value:function(I){return I?(this.range=[Math.min.apply(Math,Object(b.a)(I)),Math.max.apply(Math,Object(b.a)(I))],this.data=this.rangeToData.apply(this,Object(b.a)(this.range))):this.range=null,this}},{key:"drawBrush",value:function(){var I=this,g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],C=Object(r.a)(this.offset,2),A=C[0],i=C[1],e=this.size,l=function(I){return Math.abs(I.end-I.start)};return this.brushSelection.data(this.data).attr("transform",(function(I){return"translate(".concat(A+I.start,", ").concat(i+1,")")})).attr("width",(function(I){return"".concat(l(I),"px")})).attr("height","".concat(e-2,"px")).attr("fill",this.style.color).attr("stroke",this.style.stroke).attr("stroke-width","".concat(this.style.strokeWidth,"px")).attr("fill-opacity",(function(g){return"body"===g.type?I.style.opacity:0})).attr("stroke-opacity",(function(g){return"body"===g.type?I.style.strokeOpacity:0})).attr("cursor",(function(I){return I.cursor})),this.onBrush(this.getRange(),g),this}},{key:"enable",value:function(){return this.brushSelection.attr("pointer-events","all"),this}},{key:"disable",value:function(){return this.brushSelection.attr("pointer-events","none"),this}},{key:"visible",value:function(){return this.brushSelection.attr("visibility","visible"),this}},{key:"hidden",value:function(){return this.brushSelection.attr("visibility","hidden"),this}},{key:"clear",value:function(){return this.updateRange(null).drawBrush().hidden().disable(),this}},{key:"remove",value:function(){return this.brushSelection.remove(),this}},{key:"rangeToData",value:function(I,g){return[{type:"body",cursor:"grab",start:I,end:g},{type:"start",cursor:"ew-resize",start:I-3,end:I},{type:"end",cursor:"ew-resize",start:g,end:g+3}]}},{key:"onDrag",value:function(){var I=this;return this.externals.d3Drag.drag().on("start",(function(){I.startEvent=I.externals.d3Selection.event.sourceEvent,I.prevExtent=I.range})).on("drag",(function(g){var C,A=I.externals.d3Selection.event.sourceEvent.layerX-I.startEvent.layerX,i=null!=(C=I.prevExtent)?C:[0,0],e=Object(r.a)(i,2),l=e[0],o=e[1];"body"===g.type?(l+=A,o+=A):"start"===g.type?l+=A:"end"===g.type&&(o+=A),I.updateRange([l,o]).drawBrush()}))}}]),I}();function vZ(I){var g,C;return"bam"===(null==(g=I.data)?void 0:g.type)||"vcf"===(null==(C=I.data)?void 0:C.type)}var kZ={stroke:"black",strokeWidth:1,strokeOpacity:1,color:"none",opacity:1,arrange:"front"};function DZ(I){if(!(this instanceof DZ?this.constructor:void 0))throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');for(var g=I.services.tileProxy,C=function(C){Object(a.a)(o,C);var A=Object(Z.a)(o);function o(g){var C,i,e,l,c,d,s,a,Z;Object(t.a)(this,o);var b=Object(r.a)(g,2),h=b[0],G=b[1];if(vZ(G.spec))try{"bam"===(null==(i=G.spec.data)?void 0:i.type)?h.dataFetcher=new fZ(I,h.dataConfig):"vcf"===(null==(e=G.spec.data)?void 0:e.type)&&(h.dataFetcher=new SZ(I,h.dataConfig))}catch(im){console.warn("Error loading tabular data-fetcher",im)}C=A.call(this,h,G),h.dataFetcher.track=Object(n.a)(C),C.context=h,C.viewUid=h.viewUid,"overlay"in C.options.spec?C.options.spec.overlay=C.options.spec.overlay.map((function(I){return Object(m.a)(Object(m.a)({},I),{},{_renderingId:Ag()})})):C.options.spec._renderingId=Ag(),C.tileSize=null!=(c=null==(l=C.tilesetInfo)?void 0:l.tile_size)?c:1024,C.drawnAtScale=I.libraries.d3Scale.scaleLinear(),C.scalableGraphics={};var u=AZ(C.options.spec),y=u.valid,B=u.errorMessages;y||console.warn("The specification of the following track is invalid",B,C.options.spec),C.extent={min:Number.MAX_SAFE_INTEGER,max:Number.MIN_SAFE_INTEGER},C.pMouseHover=new I.libraries.PIXI.Graphics,C.pMouseSelection=new I.libraries.PIXI.Graphics,C.pMain.addChild(C.pMouseHover),C.pMain.addChild(C.pMouseSelection),C.gLegend=I.libraries.d3Selection.select(C.context.svgElement).append("g"),C.isRangeBrushActivated=!1,C.pMask.interactive=!0,C.gBrush=I.libraries.d3Selection.select(C.context.svgElement).append("g"),C.mRangeBrush=new NZ(C.gBrush,I.libraries,C.onRangeBrush.bind(Object(n.a)(C)),null==(d=C.options.spec.style)?void 0:d.brush),C.pMask.mousedown=function(I){return C.onMouseDown(I.data.getLocalPosition(C.pMain).x,I.data.getLocalPosition(C.pMain).y,I.data.originalEvent.altKey)},C.pMask.mouseup=function(I){return C.onMouseUp(I.data.getLocalPosition(C.pMain).x,I.data.getLocalPosition(C.pMain).y)},C.pMask.mousemove=function(I){return C.onMouseMove(I.data.getLocalPosition(C.pMain).x)},C.pMask.mouseout=function(){return C.onMouseOut()},C.flipText="vertical"===C.options.spec.orientation,C.hideMousePosition&&(C.hideMousePosition(),C.hideMousePosition=void 0),(null==(s=C.options)?void 0:s.showMousePosition)&&!C.hideMousePosition&&(C.hideMousePosition=I.utils.showMousePosition(Object(n.a)(C),NI(HI(C.options.spec)[0]),C.isShowGlobalMousePosition())),C.pLabel.removeChild(C.trackNotFoundText);var V=GI({color:"black",size:12});return C.loadingTextStyleObj=new I.libraries.PIXI.TextStyle(V),C.loadingTextBg=new I.libraries.PIXI.Graphics,C.loadingText=new I.libraries.PIXI.Text("",V),C.loadingText.anchor.x=1,C.loadingText.anchor.y=1,C.pLabel.addChild(C.loadingTextBg),C.pLabel.addChild(C.loadingText),C.svgData=[],C.textGraphics=[],C.textsBeingUsed=0,C.loadingStatus={loading:0,processing:0,rendering:0},I.libraries.PIXI.GRAPHICS_CURVES.adaptive=null!=(Z=null==(a=C.options.spec.style)?void 0:a.enableSmoothPath)&&Z,I.libraries.PIXI.GRAPHICS_CURVES.adaptive&&(I.libraries.PIXI.GRAPHICS_CURVES.maxLength=1,I.libraries.PIXI.GRAPHICS_CURVES.maxSegments=20480),C}return Object(c.a)(o,[{key:"draw",value:function(){var I,g,C=this;this.clearMouseEventData(),this.svgData=[],this.textsBeingUsed=0,null==(I=this.pMouseHover)||I.clear();var A=function(){C.preprocessAllTiles(),Object(d.a)(Object(s.a)(o.prototype),"draw",C).call(C),C.prevVisibleAndFetchedTiles=C.visibleAndFetchedTiles()};(this.dataFetcher instanceof fZ||this.dataFetcher instanceof SZ)&&!Object(J.a)(this.visibleAndFetchedTiles(),this.prevVisibleAndFetchedTiles)?this.updateTileAsync(this.dataFetcher,A):A(),null==(g=this.mRangeBrush)||g.drawBrush(!0)}},{key:"initTile",value:function(I){this.drawTile(I)}},{key:"updateTile",value:function(){}},{key:"renderTile",value:function(){}},{key:"drawTile",value:function(g){var C=this;g.drawnAtScale=this._xScale.copy(),g.goslingModels&&(g.graphics.clear(),g.graphics.removeChildren(),g.goslingModels.forEach((function(A){var i=C.dimensions[0],e=C._xScale.invert(i)-C._xScale.invert(0);A.trackVisibility({zoomLevel:e})&&(XI(I,C,g,A,C.options.theme),pI(I,C,g,A),WI(I,C,g,A,C.options.theme))})),this.forceDraw())}},{key:"rerender",value:function(I){this.options=I,"circular"===this.options.spec.layout&&this.mRangeBrush.remove(),this.clearMouseEventData(),this.svgData=[],this.textsBeingUsed=0,this.preprocessAllTiles(!0),this.draw(),this.forceDraw()}},{key:"clearMouseEventData",value:function(){this.visibleAndFetchedTiles().map((function(I){var g;return null!=(g=I.goslingModels)?g:[]})).flat().forEach((function(I){return I.getMouseEventModel().clear()}))}},{key:"remove",value:function(){Object(d.a)(Object(s.a)(o.prototype),"remove",this).call(this),this.gLegend&&(this.gLegend.remove(),this.gLegend=null),this.mRangeBrush.remove()}},{key:"setDimensions",value:function(I){this.oldDimensions=this.dimensions,Object(d.a)(Object(s.a)(o.prototype),"setDimensions",this).call(this,I),this.mRangeBrush.setSize(I[1])}},{key:"setPosition",value:function(I){var g;Object(d.a)(Object(s.a)(o.prototype),"setPosition",this).call(this,I);var C=Object(r.a)(this.position,2);this.pMain.position.x=C[0],this.pMain.position.y=C[1],(g=this.mRangeBrush).setOffset.apply(g,Object(b.a)(I))}},{key:"forceDraw",value:function(){this.animate()}},{key:"zoomed",value:function(I,g){var C=this.mRangeBrush.getRange();this.mRangeBrush.updateRange(C?[I(this._xScale.invert(C[0])),I(this._xScale.invert(C[1]))]:null),this.xScale(I),this.yScale(g),this.refreshTiles(),this.draw(),this.forceDraw()}},{key:"updateTileAsync",value:function(){var g=Object(e.a)(Object(i.a)().mark((function g(C,A){var e,l,o,t,c,n;return Object(i.a)().wrap((function(g){for(;;)switch(g.prev=g.next){case 0:return this.xDomain=this._xScale.domain(),this.xRange=this._xScale.range(),this.drawLoadingCue(),g.next=5,C.getTabularData(this.dataFetcher.uid,Object.values(this.fetchedTiles).map((function(I){return I.remoteId})));case 5:e=g.sent,this.drawLoadingCue(),(null==(l=this.visibleAndFetchedTiles())?void 0:l[0])&&((o=l[0]).tileData.tabularData=e,t=I.utils.trackUtils.calculate1DVisibleTiles(this.tilesetInfo,this._xScale),c=Object(r.a)(t,1),n=c[0],o.tileData.zoomLevel=n[0],o.tileData.tilePos=[n[1]]),this.drawLoadingCue(),A(),this.drawLoadingCue();case 12:case"end":return g.stop()}}),g,this)})));return function(I,C){return g.apply(this,arguments)}}()},{key:"scaleScalableGraphics",value:function(I,g,C){var A=(C.domain()[1]-C.domain()[0])/(g.domain()[1]-g.domain()[0]),i=g.domain().map(C)[0];I.forEach((function(I){I.scale.x=A,I.position.x=-i*A}))}},{key:"visibleAndFetchedIds",value:function(){var I=this;return Object.keys(this.fetchedTiles).filter((function(g){return I.visibleTileIds.has(g)}))}},{key:"visibleAndFetchedTiles",value:function(){var I=this;return this.visibleAndFetchedIds().map((function(g){return I.fetchedTiles[g]}))}},{key:"calculateVisibleTiles",value:function(){var C;if(vZ(this.options.spec)){var A,i=I.utils.trackUtils.calculate1DVisibleTiles(this.tilesetInfo,this._xScale),e=Object(l.a)(i);try{for(e.s();!(A=e.n()).done;){var o=A.value,t=this.getTilePosAndDimensions(o[0],[o[1],o[1]],this.tilesetInfo.tile_size).tileWidth,c="bam"===(null==(C=this.options.spec.data)?void 0:C.type)?2e4:Number.MAX_SAFE_INTEGER;if(t>(this.tilesetInfo.max_tile_width||c))return void this.forceDraw();this.forceDraw()}}catch(a){e.e(a)}finally{e.f()}this.setVisibleTiles(i)}else{if(!this.tilesetInfo)return;if(this.zoomLevel=this.calculateZoomLevel(),this.tilesetInfo.resolutions){var n=this.tilesetInfo.resolutions.map((function(I){return+I})).sort((function(I,g){return g-I}));this.xTiles=g.calculateTilesFromResolution(n[this.zoomLevel],this._xScale,this.tilesetInfo.min_pos[0],this.tilesetInfo.max_pos[0]),NI(HI(this.options.spec)[0])&&(this.yTiles=g.calculateTilesFromResolution(n[this.zoomLevel],this._yScale,this.tilesetInfo.min_pos[0],this.tilesetInfo.max_pos[0]));var d=this.tilesToId(this.xTiles,this.yTiles,this.zoomLevel);this.setVisibleTiles(d)}else{this.xTiles=g.calculateTiles(this.zoomLevel,this.relevantScale(),this.tilesetInfo.min_pos[0],this.tilesetInfo.max_pos[0],this.tilesetInfo.max_zoom,this.tilesetInfo.max_width),NI(HI(this.options.spec)[0])&&(this.yTiles=g.calculateTiles(this.zoomLevel,this._yScale,this.tilesetInfo.min_pos[1],this.tilesetInfo.max_pos[1],this.tilesetInfo.max_zoom,this.tilesetInfo.max_width1||this.tilesetInfo.max_width));var s=this.tilesToId(this.xTiles,this.yTiles,this.zoomLevel);this.setVisibleTiles(s)}}}},{key:"getTilePosAndDimensions",value:function(I,g,C){var A=C||this.tilesetInfo.bins_per_dimension||256;if(this.tilesetInfo.resolutions){var i=this.tilesetInfo.resolutions.map((function(I){return+I})).sort((function(I,g){return g-I}))[I],e=Object(r.a)(g,2),l=i*A;return{tileX:l*e[0],tileY:l*e[1],tileWidth:l,tileHeight:l}}var o=Object(r.a)(g,2),t=o[0],c=o[1],n=this.tilesetInfo.min_pos[0],d=this.tilesetInfo.min_pos[1],s=this.tilesetInfo.max_width/Math.pow(2,I),a=this.tilesetInfo.max_width/Math.pow(2,I);return{tileX:n+t*s,tileY:d+c*a,tileWidth:s,tileHeight:a}}},{key:"tilesToId",value:function(I,g,C){if(I&&!g)return I.map((function(I){return[C,I]}));var A=[];return I.forEach((function(I){return g.forEach((function(g){return A.push([C,I,g])}))})),A}},{key:"drawLoadingCue",value:function(){if(this.fetching.size){var g="Fetching... ".concat(Array.from(this.fetching).join(" "));this.loadingText.text=g,this.loadingText.x=this.position[0]+this.dimensions[0]-3,this.loadingText.y=this.position[1]+this.dimensions[1]-3;var C=I.libraries.PIXI.TextMetrics.measureText(g,this.loadingTextStyleObj),A=C.width,i=C.height;this.loadingTextBg.clear(),this.loadingTextBg.lineStyle(1,dI("grey"),1,.5),this.loadingTextBg.beginFill(dI("white"),.8),this.loadingTextBg.drawRect(this.position[0]+this.dimensions[0]-A-6-1,this.position[1]+this.dimensions[1]-i-6-1,A+6,i+6),this.loadingText.visible=!0,this.loadingTextBg.visible=!0}else this.loadingText.visible=!1,this.loadingTextBg.visible=!1}},{key:"reorganizeTileInfo",value:function(){var I,g,C=this.visibleAndFetchedTiles();this.tileSize=null!=(g=null==(I=this.tilesetInfo)?void 0:I.tile_size)?g:1024,C.forEach((function(I){I.gos={},Object.keys(I.tileData).filter((function(I){return!+I&&"0"!==I})).forEach((function(g){I.gos[g]=I.tileData[g]})),I.gos.raw=Array.from(I.tileData)}))}},{key:"updateScaleOffsetFromOriginalSpec",value:function(I,g,C){HI(this.options.spec).map((function(A){if(A._renderingId===I){var i=A[C];DI(i)&&(i.scaleOffset=g)}}))}},{key:"shareScaleOffsetAcrossTracksAndTiles",value:function(I,g){var C=[];this.visibleAndFetchedTiles().forEach((function(I){C.push.apply(C,Object(b.a)(I.goslingModels))})),C.forEach((function(C){var A=C.spec()[g];DI(A)&&(A.scaleOffset=I);var i=C.originalSpec()[g];DI(i)&&(i.scaleOffset=I)}))}},{key:"shouldCombineTiles",value:function(){var I,g,C,A,i,e;return(null==(I=this.options.spec.dataTransform)?void 0:I.find((function(I){return"displace"===I.type})))&&(null==(C=null==(g=this.visibleAndFetchedTiles())?void 0:g[0])?void 0:C.tileData)&&!(null==(i=null==(A=this.visibleAndFetchedTiles())?void 0:A[0])?void 0:i.tileData.dense)||"bam"===(null==(e=this.options.spec.data)?void 0:e.type)}},{key:"combineAllTilesIfNeeded",value:function(){var I,g,C;if(this.shouldCombineTiles()){var A=this.visibleAndFetchedTiles();if(A&&0!==A.length){this.tileSize=(null!=(g=null==(I=this.tilesetInfo)?void 0:I.tile_size)?g:1024)*A.length;var i=[];A.forEach((function(I,g){i=[].concat(Object(b.a)(i),Object(b.a)(I.tileData)),I.mergedToAnotherTile=0!==g})),A[0].gos.raw=i,(null==(C=A[0].gos.raw[0])?void 0:C.uid)&&(A[0].gos.raw=Object(S.a)(A[0].gos.raw,"uid"))}}}},{key:"preprocessAllTiles",value:function(){var I,g=this,C=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=[];this.reorganizeTileInfo(),this.combineAllTilesIfNeeded(),this.visibleAndFetchedTiles().forEach((function(I){C&&(I.goslingModels=[]);var i=g.preprocessTile(I);null==i||i.forEach((function(I){A.push(I)}))})),tZ(A);var i=(I=[]).concat.apply(I,Object(b.a)(A.map((function(I){return I.data()}))));0!==i.length&&pZ("rawData",{id:this.viewUid,data:i})}},{key:"preprocessTile",value:function(I){var g=this;if(I.mergedToAnotherTile)I.goslingModels=[];else{if(I.goslingModels&&0!==I.goslingModels.length)return I.goslingModels;if(I.gos.tilePos){I.goslingModels=[];var C=JSON.parse(JSON.stringify(this.options.spec)),A=Object(r.a)(this.dimensions,2),i=A[0],e=A[1];return HI(C).forEach((function(C){var A;if("brush"!==C.mark){if(!I.gos.tabularData){var l=g.getTilePosAndDimensions(I.gos.zoomLevel,I.gos.tilePos,g.tilesetInfo.bins_per_dimension||(null==(A=g.tilesetInfo)?void 0:A.tile_size)),o=l.tileX,t=l.tileY,c=l.tileWidth,n=l.tileHeight;I.gos.tabularData=VZ(C,Object(m.a)(Object(m.a)({},I.gos),{},{tileX:o,tileY:t,tileWidth:c,tileHeight:n,tileSize:g.tileSize}))}I.gos.tabularDataFiltered=Array.from(I.gos.tabularData),C.dataTransform&&C.dataTransform.forEach((function(A){switch(A.type){case"filter":I.gos.tabularDataFiltered=qg(A,I.gos.tabularDataFiltered);break;case"concat":I.gos.tabularDataFiltered=IC(A,I.gos.tabularDataFiltered);break;case"replace":I.gos.tabularDataFiltered=gC(A,I.gos.tabularDataFiltered);break;case"log":I.gos.tabularDataFiltered=CC(A,I.gos.tabularDataFiltered);break;case"exonSplit":I.gos.tabularDataFiltered=oC(A,I.gos.tabularDataFiltered,C.assembly);break;case"genomicLength":I.gos.tabularDataFiltered=AC(A,I.gos.tabularDataFiltered);break;case"svType":I.gos.tabularDataFiltered=iC(A,I.gos.tabularDataFiltered);break;case"coverage":I.gos.tabularDataFiltered=eC(A,I.gos.tabularDataFiltered,g._xScale.copy());break;case"subjson":I.gos.tabularDataFiltered=tC(A,I.gos.tabularDataFiltered);break;case"displace":I.gos.tabularDataFiltered=lC(A,I.gos.tabularDataFiltered,g._xScale.copy())}}));try{if(AI.a){var d=I.gos.tabularDataFiltered.length;AI.a.publish("data-preview",{id:g.viewUid,dataConfig:JSON.stringify({data:C.data}),data:100>d?I.gos.tabularDataFiltered:Object(w.a)(I.gos.tabularDataFiltered,100)})}}catch(im){}var s=TI(C)?sZ:0,a=i,Z=e+s,b=Math.min(a,Z)/Math.min(C.width,C.height);C.innerRadius&&(C.innerRadius=C.innerRadius*b),C.outerRadius&&(C.outerRadius=C.outerRadius*b),C.width=a,C.height=Z;var r=new BZ(C,I.gos.tabularDataFiltered,g.options.theme);I.goslingModels.push(r)}})),I.goslingModels}}}},{key:"getIndicesOfVisibleDataInTile",value:function(g){var C,A,i,e=this._xScale.range();if(!this.tilesetInfo)return[null,null];var l=this.getTilePosAndDimensions(g.gos.zoomLevel,g.gos.tilePos,this.tilesetInfo.bins_per_dimension||(null==(C=this.tilesetInfo)?void 0:C.tile_size)),o=l.tileX,t=l.tileWidth,c=I.libraries.d3Scale.scaleLinear().domain([0,(null==(A=this.tilesetInfo)?void 0:A.tile_size)||(null==(i=this.tilesetInfo)?void 0:i.bins_per_dimension)]).range([o,o+t]);return[Math.max(0,Math.round(c.invert(this._xScale.invert(e[0])))),Math.min(g.gos.dense.length,Math.round(c.invert(this._xScale.invert(e[1]))))]}},{key:"minVisibleValue",value:function(){}},{key:"maxVisibleValue",value:function(){}},{key:"exportSVG",value:function(){}},{key:"getElementsWithinMouse",value:function(I,g){var C,A=this.visibleAndFetchedTiles().map((function(I){var g;return null!=(g=I.goslingModels)?g:[]})).flat(),i=null==(C=this.options.spec.experimental)?void 0:C.mouseEvents,e=QI(i)&&i.enableMouseOverOnMultipleMarks,l=QI(i)&&i.groupMarksByField,o=A.map((function(C){return C.getMouseEventModel().findAll(I,g,!0)})).flat();if(e||o.splice(1,o.length-1),0!==o.length&&l){var t=Array.from(o);A.forEach((function(I){var g=I.getMouseEventModel().getSiblings(t,l);o.push.apply(o,Object(b.a)(g))}))}return o}},{key:"highlightMarks",value:function(I,g,C){I.lineStyle(C.strokeWidth,dI(C.stroke),C.strokeOpacity,.5),I.beginFill(dI(C.color),"none"===C.color?0:C.opacity),g.forEach((function(g){if("point"===g.type){var C=Object(r.a)(g.polygon,3),A=C[0],i=C[1],e=C[2],l=void 0===e?3:e;I.drawCircle(A,i,l)}else"line"===g.type?(I.moveTo(g.polygon[0],g.polygon[1]),dZ(g.polygon).map((function(g){return I.lineTo(g[0],g[1])}))):I.drawPolygon(g.polygon)}))}},{key:"onRangeBrush",value:function(I){var g,C,A,i,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pMouseSelection.clear(),null!==I){var l=Object(r.a)(I,2),o=l[0],t=l[1],c=this.visibleAndFetchedTiles().map((function(I){var g;return null!=(g=I.goslingModels)?g:[]})).flat(),n=c.map((function(I){return I.getMouseEventModel().findAllWithinRange(o,t,!0)})).flat(),d=null==(g=this.options.spec.experimental)?void 0:g.mouseEvents,s=QI(d)&&d.groupMarksByField;if(0!==n.length&&s&&c.forEach((function(I){var g=I.getMouseEventModel().getSiblings(n,s),C=Array.from(new Set(g.map((function(I){return I.value[s]}))));n=n.filter((function(I){return-1===C.indexOf(I.value[s])}))})),0!==n.length){var a=this.pMouseSelection;"behind"!==(null==(A=null==(C=this.options.spec.style)?void 0:C.select)?void 0:A.arrange)&&(this.pMain.removeChild(a),this.pMain.addChild(a)),this.highlightMarks(a,n,Object.assign({},kZ,null==(i=this.options.spec.style)?void 0:i.select))}if(!e){var Z=[Tg(Math.floor(this._xScale.invert(o))),Tg(Math.floor(this._xScale.invert(t)))];pZ("rangeSelect",{id:this.viewUid,genomicRange:Z,data:n.map((function(I){return I.value}))})}this.forceDraw()}else e||pZ("rangeSelect",{id:this.viewUid,genomicRange:null,data:[]})}},{key:"onMouseDown",value:function(I,g,C){var A;this.mouseDownX=I,this.mouseDownY=g;var i=null==(A=this.options.spec.experimental)?void 0:A.mouseEvents,e=!!i||QI(i)&&!!i.rangeSelect;this.isRangeBrushActivated=e&&C,this.pMouseHover.clear()}},{key:"onMouseMove",value:function(I){"circular"!==this.options.spec.layout&&this.isRangeBrushActivated&&this.mRangeBrush.updateRange([I,this.mouseDownX]).drawBrush().visible().disable()}},{key:"onMouseUp",value:function(I,g){var C,A=null==(C=this.options.spec.experimental)?void 0:C.mouseEvents,i=!!A||QI(A)&&!!A.click,e=Math.sqrt(Math.pow(this.mouseDownX-I,2)+Math.pow(this.mouseDownY-g,2))>1;if(this.isRangeBrushActivated||e?this.mRangeBrush.enable():(this.mRangeBrush.clear(),this.pMouseSelection.clear()),this.isRangeBrushActivated=!1,this.tilesetInfo&&!e&&i){var l=Tg(Math.floor(this._xScale.invert(I))),o=this.getElementsWithinMouse(I,g);0!==o.length&&pZ("click",{id:this.viewUid,genomicPosition:l,data:o.map((function(I){return I.value}))})}}},{key:"onMouseOut",value:function(){this.isRangeBrushActivated=!1,document.body.style.cursor="default",this.pMouseHover.clear()}},{key:"getMouseOverHtml",value:function(g,C){var A,i,e,l,o;if(!this.isRangeBrushActivated&&this.tilesetInfo){this.pMouseHover.clear();var t=Tg(Math.floor(this._xScale.invert(g))),c=this.getElementsWithinMouse(g,C);if(0!==c.length?document.body.style.cursor="pointer":document.body.style.cursor="default",0!==c.length){var n=null==(A=this.options.spec.experimental)?void 0:A.mouseEvents;if(!!n||QI(n)&&!!n.mouseOver){var d=this.pMouseHover;"behind"!==(null==(e=null==(i=this.options.spec.style)?void 0:i.mouseOver)?void 0:e.arrange)&&(this.pMain.removeChild(d),this.pMain.addChild(d)),this.highlightMarks(d,c,Object.assign({},kZ,null==(l=this.options.spec.style)?void 0:l.mouseOver)),pZ("mouseOver",{id:this.viewUid,genomicPosition:t,data:c.map((function(I){return I.value}))})}var s=null==(o=this.visibleAndFetchedTiles().map((function(I){var g;return null!=(g=I.goslingModels)?g:[]})).flat().find((function(I){var g;return I.spec().tooltip&&0!==(null==(g=I.spec().tooltip)?void 0:g.length)})))?void 0:o.spec().tooltip;if(s){var a=s.map((function(g){var C,A=c[0].value[g.field],i=A;if("quantitative"===g.type&&g.format)i=I.libraries.d3Format.format(g.format)(+A);else if("genomic"===g.type){var e=Tg(+A),l=e.chromosome,o=e.position;i="".concat(l,":").concat(I.libraries.d3Format.format(",")(o))}return"<tr><td style='padding: 4px 8px'>".concat(null!=(C=g.alt)?C:g.field,"</td><td style='padding: 4px 8px'><b>").concat(i,"</b></td></tr>")})).join("");return a="<table style='text-align: left; margin-top: 12px'>".concat(a,"</table>"),c.length>1&&(a+="<div style='padding: 4px 8px; margin-top: 4px; text-align: center; color: grey'>".concat(c.length-1," Additional Selections...</div>")),"<div>".concat(a,"</div>")}}}}}]),o}(I.tracks.BarTrack),A=arguments.length,o=new Array(A>1?A-1:0),h=1;h<A;h++)o[h-1]=arguments[h];return new C(o)}DZ.config={type:"gosling-track",datatype:["multivec","epilogos"],rotatable:!0,local:!1,orientation:"1d-horizontal",thumbnail:(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400" width={30} height={30}>\n    <rect style={{ fill: \'none\' }} width="400" height="400" />\n    <circle cx="110.62" cy="129.64" r="41.69" />\n    <circle style={{ fill: \'#fff\' }} cx="124.14" cy="114.12" r="10.76" />\n    <circle cx="288.56" cy="129.64" r="41.69" />\n    <circle style={{ fill: \'#fff\' }} cx="302.07" cy="114.12" r="10.76" />\n    <path\n        style={{ fill: \'#e18241\' }}\n        d="M313.1,241.64l8.61-22.09a430.11,430.11,0,0,0-88-15.87L224,225.63A384.54,384.54,0,0,1,313.1,241.64Z"\n    />\n    <path\n        style={{ fill: \'#e18241\' }}\n        d="M208.63,260.53a299.77,299.77,0,0,1,90.56,16.79L308,254.79a371.68,371.68,0,0,0-90-15.47Z"\n    />\n    <path\n        style={{ fill: \'#e18241\' }}\n        d="M174.4,225.56l-9-22a431.34,431.34,0,0,0-88,15.43l8.9,22A385.08,385.08,0,0,1,174.4,225.56Z"\n    />\n    <path\n        style={{ fill: \'#e18241\' }}\n        d="M100.71,276.35a300.51,300.51,0,0,1,87.91-15.82L180,239.29a372.51,372.51,0,0,0-88.3,14.76Z"\n    />\n    <path\n        style={{ fill: \'#e18241\' }}\n        d="M106.52,290.71c27.53,13.92,59.05,21.34,92.05,21.34h0c33.68,0,65.83-7.72,93.75-22.2a291.31,291.31,0,0,0-186.33-.4Z"\n    />\n</svg>',"text/xml").documentElement,availableOptions:["labelPosition","labelColor","labelTextOpacity","labelBackgroundOpacity","trackBorderWidth","trackBorderColor","trackType","scaledHeight","backgroundColor","barBorder","sortLargestOnTop","theme","axisPositionHorizontal"],defaultOptions:{labelPosition:"none",labelColor:"black",labelTextOpacity:.4,trackBorderWidth:0,trackBorderColor:"black",backgroundColor:"white",barBorder:!1,sortLargestOnTop:!0,axisPositionHorizontal:"left",theme:"light"}};var zZ=!1;function MZ(I){var g=0,C=0;return I.forEach((function(I){var A=I.boundingBox.x+I.boundingBox.width,i=I.boundingBox.y+I.boundingBox.height;C<i&&(C=i),g<A&&(g=A)})),{width:g,height:C}}function UZ(I,g){var C,A,i=[];xZ(I,i);var e=MZ(i);if(I.title||I.subtitle){var l=(I.title?(null!=(C=g.root.titleFontSize)?C:18)+6:0)+(I.subtitle?(null!=(A=g.root.subtitleFontSize)?A:14)+6:0);e.height+=l+4,e.height=e.height+(8-e.height%8),i.forEach((function(I){I.boundingBox.y+=l+4})),i=[{track:PZ({width:e.width,height:l},I.title,I.subtitle),boundingBox:{x:0,y:0,width:e.width,height:l},layout:{x:0,y:0,w:12,h:l/e.height*12}}].concat(Object(b.a)(i))}else e.height=e.height+(8-e.height%8);var o=!("object"!==typeof I.responsiveSize?I.responsiveSize:I.responsiveSize.height);return i.forEach((function(I){I.layout.x=I.boundingBox.x/e.width*12,I.layout.w=I.boundingBox.width/e.width*12,I.layout.y=o?I.boundingBox.y:I.boundingBox.y/e.height*12,I.layout.h=o?I.boundingBox.height:I.boundingBox.height/e.height*12})),{trackInfos:i,size:e}}function xZ(I,g){var C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],e=0,l=0,o=!0,t=!1;rg(I,(function(I){t=!0,"circular"!==I.layout&&(o=!1)}));var c=!0;hg(I,(function(I){"vertical"!==I.arrangement&&"horizontal"!==I.arrangement||(c=!1)}));var n=i&&o&&t&&c&&("views"in I&&("parallel"===I.arrangement||"serial"===I.arrangement)||"tracks"in I),d=g.length;if("tracks"in I){var s=I.tracks;"vertical"===I.orientation?(l=Math.max.apply(Math,Object(b.a)(s.map((function(I){return I.height})))),s.forEach((function(i,o,t){1===TZ([i])&&(i.width+=sZ),i.height=l,g.push({track:i,boundingBox:{x:C+e,y:A,width:i.width,height:l},layout:{x:0,y:0,w:0,h:0}}),t[o+1]&&t[o+1].overlayOnPreviousTrack||(e+=i.width,o!==t.length-1&&(e+=void 0!==I.spacing?I.spacing:0))}))):(e=Math.max.apply(Math,Object(b.a)(s.map((function(I){return I.width})))),s.forEach((function(i,o,t){1===TZ([i])&&(i.height+=sZ),NI(HI(i)[0])&&1===QZ([i])&&(e+=sZ),i.width=e,g.push({track:i,boundingBox:{x:C,y:A+l,width:e,height:i.height},layout:{x:0,y:0,w:0,h:0}}),t[o+1]&&t[o+1].overlayOnPreviousTrack||(l+=i.height,o!==t.length-1&&(l+=void 0!==I.spacing?I.spacing:0))})))}else if("parallel"===I.arrangement||"vertical"===I.arrangement){var a=void 0!==I.spacing?I.spacing:nI;I.views.forEach((function(I,o,t){var c,d,s,Z,m,b=xZ(I,g,C+(null!=(c=I.xOffset)?c:0),A+(null!=(d=I.yOffset)?d:0)+l,!n&&i);e<(null!=(s=I.xOffset)?s:0)+b.width&&(e=(null!=(Z=I.xOffset)?Z:0)+b.width),o!==t.length-1&&(l+=a),l+=(null!=(m=I.yOffset)?m:0)+b.height}))}else"serial"!==I.arrangement&&"horizontal"!==I.arrangement||I.views.forEach((function(o,t,c){var d,s,a,Z,m,b=void 0!==I.spacing?I.spacing:nI,r=xZ(o,g,C+(null!=(d=o.xOffset)?d:0)+e,A+(null!=(s=o.yOffset)?s:0),!n&&i);l<(null!=(a=o.xOffset)?a:0)+r.height&&(l=(null!=(Z=o.xOffset)?Z:0)+r.height),t!==c.length-1&&(e+=b),e+=(null!=(m=o.xOffset)?m:0)+r.width}));if(n){var Z=g.slice(d),m="views"in I&&("parallel"===I.arrangement||"serial"===I.arrangement)&&I.views.length>1,r=void 0!==I.spacing?I.spacing:nI,h=0,G=void 0!==I.centerRadius?I.centerRadius:.3,u=e/2+h,y=u*(1-G);Z.forEach((function(I,g){var i,o;I.track.layout="circular",I.track.outerRadius=u-h-(I.boundingBox.y-A)/l*y,I.track.innerRadius=u-h-(I.boundingBox.y+I.boundingBox.height-A)/l*y;var t=r/e*360;I.track.startAngle=t+(I.boundingBox.x-C)/e*(e-r)/e*360,I.track.endAngle=(I.boundingBox.x+I.boundingBox.width-C)/e*(e-r)/e*360,I.boundingBox.x=C+(null!=(i=I.track.xOffset)?i:0),I.boundingBox.y=A+(null!=(o=I.track.yOffset)?o:0),I.boundingBox.height=I.track.height=I.boundingBox.width=I.track.width=2*u,0!==g&&(I.track.overlayOnPreviousTrack=!0),m&&FI(I.track)&&(I.track.overlay=I.track.overlay.filter((function(I){return"brush"!==I.mark})))})),l=2*u}return I._assignedWidth=e,I._assignedHeight=l,{x:C,y:A,width:e,height:l}}function TZ(I){return I.filter((function(I){return TI(I)})).length}function QZ(I){return I.filter((function(I){return function(I){if((SI(I)||FI(I))&&DI(I.y)&&I.y.axis&&"none"!==I.y.axis)return!0;if(FI(I)){var g=!1;return I.overlay.forEach((function(I){g||DI(I.y)&&I.y.axis&&"none"!==I.y.axis&&(g=!0)})),g}return!1}(I)})).length}var PZ=function(I,g,C){return JSON.parse(JSON.stringify({mark:"header",width:I.width,height:I.height,title:g,subtitle:C}))};function OZ(I,g,C,A,i){var e,l,o,t,c,n,d,s,a,Z,r,h,G,u,y=HI(g)[0];y.id||(y.id=sg());var B,V,p=y.assembly;if(JI(y.data)){var X,W;if(kI(y.data)){var H=(V=y.data.url).includes("tileset_info/?d=")&&(V.includes("https:")||V.includes("http:"))?{server:V.split("tileset_info/?d=")[0],tilesetUid:V.split("tileset_info/?d=")[1]}:{server:void 0,tilesetUid:void 0};X=H.server,W=H.tilesetUid}var Y=iZ(y),R=eZ(y),f=("x"===R||"xe"===R)&&DI(Y)?Y.domain:void 0,K=NI(y)&&DI(y.y)?y.y.domain:void 0,w=C.width-("circular"!==y.layout&&"vertical"===y.orientation&&TI(y)?sZ:0),J=C.height-("circular"!==y.layout&&"horizontal"===y.orientation&&TI(y)?sZ:0),S={uid:"".concat(y.id,"-track"),type:NI(y)?"gosling-2d-track":"gosling-track",server:X,tilesetUid:W,width:w,height:J,options:{showMousePosition:"circular"!==y.layout&&i.root.showMousePosition,mousePositionColor:i.root.mousePositionColor,name:"linear"===y.layout?y.title:" ",labelPosition:y.title?"left"===i.track.titleAlign?"topLeft":"topRight":"none",labelShowResolution:!1,labelColor:i.track.titleColor,labelBackgroundColor:i.track.titleBackground,labelBackgroundOpacity:.5,labelTextOpacity:1,labelLeftMargin:1,labelTopMargin:1,labelRightMargin:0,labelBottomMargin:0,backgroundColor:"transparent",spec:Object(m.a)({},g),theme:i}};if(y.data&&JI(y.data)){var F=y.data.type;"csv"===F||"json"===F||"bigwig"===F||"bam"===F||"vcf"===F?S.data=Object(m.a)(Object(m.a)({},y.data),{},{assembly:p}):"experimentalPlugin"===F&&(S.data=Object(m.a)(Object(m.a)({},y.data.options),{},{type:y.data.name,assembly:p}))}if(NI(B=y)&&"matrix"===B.data.type&&("bar"===B.mark||"rect"===B.mark)&&B.xe&&B.ye){S.type="heatmap";var N=DI(y.color)&&"string"===typeof y.color.range?y.color.range:"viridis";S.options.colorRange=function(){var I,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,C=null!=(I=fI[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"viridis"])?I:fI.viridis;return Object(b.a)(Array(g)).map((function(I,A){return C(1/g*A)}))}(N),S.options.trackBorderWidth=null!=(l=null==(e=y.style)?void 0:e.outlineWidth)?l:i.track.outlineWidth,S.options.trackBorderColor=null!=(t=null==(o=y.style)?void 0:o.outline)?t:i.track.outline,S.options.extent=null!=(n=null==(c=y.style)?void 0:c.matrixExtent)?n:"full",S.options.colorbarPosition=(null==(d=y.color)?void 0:d.legend)?"lower-left"===S.options.extent?"bottomLeft":"topRight":"hidden"}y.overlayOnPreviousTrack?I.setViewOrientation(y.orientation).addTrackToCombined(S):I.setViewOrientation(y.orientation).setAssembly(p).addDefaultView(y.id,p).setDomain(f,null!=K?K:f).adjustDomain(y.orientation,w,J).setMainTrack(S).addTrackSourceServers(X).setZoomFixed(!0===y.static).setZoomLimits(null!=(s=y.zoomLimits)?s:[1,null]).setLayout(A);["x","y"].forEach((function(A){var e=y[A];if(DI(e)&&"axis"in e&&e.axis&&"none"!==e.axis&&"genomic"===e.type){var l=function(I){var g=arguments.length>2?arguments[2]:void 0,C=arguments.length>3?arguments[3]:void 0,A=400,i=200;return"horizontal"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"horizontal")?"x"===I&&g<=i||"y"===I&&C<=i?"narrower":"x"===I&&g<=A||"y"===I&&C<=A?"narrow":"regular":"x"===I&&C<=i||"y"===I&&g<=i?"narrower":"x"===I&&C<=A||"y"===I&&g<=A?"narrow":"regular"}(A,g.orientation,C.width,C.height);I.setAxisTrack(e.axis,l,{id:"".concat(y.id,"-").concat(e.axis,"-axis"),layout:y.layout,innerRadius:"top"===e.axis?y.outerRadius-sZ:y.innerRadius,outerRadius:"top"===e.axis?y.outerRadius:y.innerRadius+sZ,width:y.width,height:y.height,startAngle:y.startAngle,endAngle:y.endAngle,theme:i})}})),I.validateSpec(!0)}else"header"===y.mark&&(I.addDefaultView("".concat(y.id,"-title")).setLayout(A),"string"===typeof y.title&&I.setTextTrack(C.width,(null!=(a=i.root.titleFontSize)?a:18)+6,y.title,i.root.titleColor,null!=(Z=i.root.titleFontSize)?Z:18,i.root.titleFontWeight,i.root.titleAlign,i.root.titleBackgroundColor,null!=(r=i.root.titleFontFamily)?r:hI.fontFamily),"string"===typeof y.subtitle&&I.setTextTrack(C.width,(null!=(h=i.root.subtitleFontSize)?h:14)+6,y.subtitle,i.root.subtitleColor,null!=(G=i.root.subtitleFontSize)?G:14,i.root.subtitleFontWeight,i.root.subtitleAlign,i.root.subtitleBackgroundColor,null!=(u=i.root.subtitleFontFamily)?u:hI.fontFamily));return I}function jZ(I,g,C,A){if(0!==g.length){var i=new aZ;g.forEach((function(I){var g=I.track,C=I.boundingBox,e=I.layout;OZ(i,g,C,e,A)}));var e=function(I){var g=[];return I.spec().views.forEach((function(I){var C,A,i,e,l,o,t,c,n,d,s,a,Z,m,b,r=I.uid,h=null==(l=null==(e=null==(i=null==(A=null==(C=I.tracks.center)?void 0:C[0])?void 0:A.contents)?void 0:i[0])?void 0:e.options)?void 0:l.spec;h||(h=null==(d=null==(n=null==(c=null==(t=null==(o=I.tracks.left)?void 0:o[0])?void 0:t.contents)?void 0:c[0])?void 0:n.options)?void 0:d.spec)||(h=null==(b=null==(m=null==(Z=null==(a=null==(s=I.tracks.left)?void 0:s[1])?void 0:a.contents)?void 0:Z[0])?void 0:m.options)?void 0:b.spec),r&&h&&HI(h).forEach((function(I){VI.forEach((function(C){var A,i,e,l,o=I[C];DI(o)&&"linkingId"in o&&o.linkingId&&g.push({layout:"circular"===I.layout?"circular":"linear",viewId:r,linkId:o.linkingId,isBrush:"brush"===I.mark,style:{color:null==(A=I.color)?void 0:A.value,stroke:null==(i=I.stroke)?void 0:i.value,strokeWidth:null==(e=I.strokeWidth)?void 0:e.value,opacity:null==(l=I.opacity)?void 0:l.value,startAngle:I.startAngle,endAngle:I.endAngle,innerRadius:I.innerRadius,outerRadius:I.outerRadius}})}))}))})),g}(i);e.filter((function(I){return I.isBrush})).forEach((function(I){var g;i.addBrush(I.layout,I.viewId,A,null==(g=e.find((function(g){return!g.isBrush&&g.linkId===I.linkId})))?void 0:g.viewId,I.style)})),e.filter((function(I){return!I.isBrush})).forEach((function(I){i.spec().zoomLocks.locksByViewUid[I.viewId]=I.linkId,i.spec().locationLocks.locksByViewUid[I.viewId]=I.linkId})),Array.from(new Set(e.map((function(I){return I.linkId})))).forEach((function(I){i.spec().zoomLocks.locksDict[I]={uid:I},i.spec().locationLocks.locksDict[I]={uid:I},e.filter((function(I){return!I.isBrush})).filter((function(g){return g.linkId===I})).forEach((function(g){i.spec().zoomLocks.locksDict[I][g.viewId]=[124625310.5,124625310.5,249250.621],i.spec().locationLocks.locksDict[I][g.viewId]=[124625310.5,124625310.5,249250.621]}))})),C(i.spec(),MZ(g),I)}}function LZ(I,g,C,A,i){if("undefined"===typeof I._assignedWidth||"undefined"===typeof I._assignedHeight)return console.warn("Responsive spec cannot be used when width and height of a view is not determined yet."),!1;var e=!1,l=I.responsiveSpec,o=I._assignedWidth*g,t=I._assignedHeight*C,c={width:o,height:t,aspectRatio:o/t},n={width:A,height:i,aspectRatio:A/i};return l&&l.forEach((function(g){var C=g.spec;if(function(I,g,C){if(0===I.length)return!1;var A=!0;return I.forEach((function(I){var i=I.measure,e=I.operation,l=I.threshold,o=I.target;A=A&&1===ZZ(("container"===o?C:g)[i],e,l)})),A}(g.selectivity,c,n)&&!e)return Object.keys(C).forEach((function(g){I[g]=C[g]})),delete I.responsiveSpec,void(e=!0)})),"views"in I&&I.views.forEach((function(I){e=LZ(I,g,C,A,i)||e})),e}function EZ(I,g,C,A,i){var e,l,o=JSON.parse(JSON.stringify(I));!function(I){bg(I,(function(I,g,C){var A,i,e;if(I.data&&kI(I.data)&&!("alignment"in I)&&"data"in(A=I)&&"overrideTemplate"in A&&A.overrideTemplate)switch(I.data.type){case"vector":case"bigwig":C[g]=Object.assign({data:{type:"vector",url:"",column:i=I.data.column,value:e=I.data.value},mark:"bar",x:{field:i,type:"genomic",axis:"top"},y:{field:e,type:"quantitative"},width:400,height:100},I);break;case"multivec":C[g]=Object.assign(function(I,g,C,A){return A&&A.length<10?{data:{type:"multivec",url:"",row:I,column:g,value:C,categories:A},mark:"bar",x:{field:g,type:"genomic",axis:"top"},y:{field:C,type:"quantitative"},row:{field:I,type:"nominal",legend:!0},color:{field:I,type:"nominal"},width:400,height:100}:{data:{type:"multivec",url:"",row:I,column:g,value:C,categories:A},mark:"rect",x:{field:g,type:"genomic",axis:"top"},row:{field:I,type:"nominal",legend:!0},color:{field:C,type:"quantitative"},width:400,height:100}}(I.data.row,I.data.column,I.data.value,I.data.categories),I)}}))}(o),function(I,g){bg(I,(function(I,C,A){var i,e;if("template"in I){var l=I.template,o=g.find((function(I){return I.name===l}));if(!o)return I._invalidTrack=!0,void console.warn("There is no track template named '".concat(l,"'"));var t=!0;if(o.channels.forEach((function(g){!g.required||I.encoding&&g.name in I.encoding||(t=!1,console.warn("A template spec ('".concat(l,"') does not contain a required channel, ").concat(g.name)))})),t){var c=JSON.parse(JSON.stringify(I));"encoding"in c&&delete c.encoding;var n=Object(m.a)(Object(m.a)({},c),{},{alignment:"overlay",tracks:[],width:null!=(i=I.width)?i:100,height:null!=(e=I.height)?e:100});o.mapping.forEach((function(g){var C={data:I.data,mark:g.mark},A=g.dataTransform;A&&A.map((function(g){var C=g.base;C&&I.encoding&&C in I.encoding&&"field"in I.encoding[C]&&(delete g.base,g.field=I.encoding[C].field)}));var i=I.encoding;i?Object.keys(g).filter((function(I){return"mark"!==I})).forEach((function(I){var A=JSON.parse(JSON.stringify(g[I]));if("base"in A){var e=A.base;if(e in i){var l=JSON.parse(JSON.stringify(i[e]));delete A.base;var o=Object.assign(A,JSON.parse(JSON.stringify(l)));C[I]=o}else delete A.base,C[I]=A}else C[I]=A})):Object.keys(g).filter((function(I){return"mark"!==I})).forEach((function(I){var A=JSON.parse(JSON.stringify(g[I]));"base"in A&&delete A.base,C[I]=A})),n.tracks.push(C)})),A[C]=n}else I._invalidTrack=!0}}))}(o,C),ug(o);var t=UZ(o,A),c=t.trackInfos,n=t.size,d="object"===typeof I.responsiveSize&&(null==(e=I.responsiveSize)?void 0:e.width)||I.responsiveSize,s="object"===typeof I.responsiveSize&&(null==(l=I.responsiveSize)?void 0:l.height)||I.responsiveSize;LZ(o,d&&i.containerSize?i.containerSize.width/n.width:1,s&&i.containerSize?i.containerSize.height/n.height:1,i.containerParentSize?i.containerParentSize.width:Number.MAX_SAFE_INTEGER,i.containerParentSize?i.containerParentSize.height:Number.MAX_SAFE_INTEGER)&&(ug(o),c=UZ(o,A).trackInfos),jZ(JSON.parse(JSON.stringify(o)),c,g,A)}zZ||(Object(T.a)({name:"GoslingTrack",track:DZ,config:DZ.config}),Object(T.a)({name:"Gosling2DTrack",track:DZ,config:Object(m.a)(Object(m.a)({},DZ.config),{},{type:"gosling-2d-track",orientation:"2d"})}),Object(T.a)({name:"AxisTrack",track:_g,config:_g.config}),Object(T.a)({name:"TextTrack",track:Q.a,config:Q.a.config}),Object(T.a)({name:"BrushTrack",track:$g,config:$g.config}),Object(T.a)({dataFetcher:nC,config:nC.config},{pluginType:"dataFetcher"}),Object(T.a)({dataFetcher:dC,config:dC.config},{pluginType:"dataFetcher"}),Object(T.a)({dataFetcher:Nd,config:Nd.config},{pluginType:"dataFetcher"}),zZ=!0);var _Z=Object(lI.forwardRef)((function(I,g){var C,A=Object(lI.useState)(null!=(C=I.id)?C:sg()),i=Object(r.a)(A,2),e=i[0],l=i[1];Object(lI.useEffect)((function(){var g;l(null!=(g=I.id)?g:sg())}),[I.id]);var o=I.viewConfig||{},t=Object(lI.useMemo)((function(){return oI.a.createElement(tI.HiGlassComponent,{ref:g,options:{pixelPreciseMarginPadding:false,containerPaddingX:0,containerPaddingY:0,viewMarginTop:0,viewMarginBottom:0,viewMarginLeft:0,viewMarginRight:0,viewPaddingTop:0,viewPaddingBottom:0,viewPaddingLeft:0,viewPaddingRight:0,sizeMode:"bounded",rangeSelectionOnAlt:!0},viewConfig:o})}),[o,false]),c=I.options||{},n=c.padding,d=void 0===n?60:n,s=c.margin,a=void 0===s?0:s,Z=c.border,m=void 0===Z?"none":Z,b=c.background,h=c.alt,G=void 0===h?"Gosling visualization":h;return oI.a.createElement(oI.a.Fragment,null,oI.a.createElement("div",{id:e,className:"gosling-component ".concat(I.className||""),style:{position:"relative",padding:d,margin:a,border:m,background:b,width:I.options.responsiveWidth?"calc(100% - ".concat(2*d,"px)"):I.size.width,height:I.options.responsiveHeight?"calc(100% - ".concat(2*d,"px)"):I.size.height,textAlign:"left"},"aria-label":G,role:"graphics-document","aria-roledescription":"visualization"},oI.a.createElement("div",{key:JSON.stringify(o),id:"higlass-wrapper",className:"higlass-wrapper",style:{position:"relative",display:"block",background:b,margin:0,padding:0,width:I.options.responsiveWidth?"100%":I.size.width,height:I.options.responsiveHeight?"100%":I.size.height}},t)))}));_Z.displayName="HiGlassComponentWrapper";var $Z={exports:{}};!function(I,g){"undefined"!==typeof window&&window,I.exports=function(){if("undefined"===typeof window)return null;var I="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),g=I.requestAnimationFrame||I.mozRequestAnimationFrame||I.webkitRequestAnimationFrame||function(g){return I.setTimeout(g,20)},C=I.cancelAnimationFrame||I.mozCancelAnimationFrame||I.webkitCancelAnimationFrame||function(g){I.clearTimeout(g)};function A(I,g){var C=Object.prototype.toString.call(I),A="[object Array]"===C||"[object NodeList]"===C||"[object HTMLCollection]"===C||"[object Object]"===C||"undefined"!==typeof jQuery&&I instanceof jQuery||"undefined"!==typeof Elements&&I instanceof Elements,i=0,e=I.length;if(A)for(;i<e;i++)g(I[i]);else g(I)}function i(I){if(!I.getBoundingClientRect)return{width:I.offsetWidth,height:I.offsetHeight};var g=I.getBoundingClientRect();return{width:Math.round(g.width),height:Math.round(g.height)}}function e(I,g){Object.keys(g).forEach((function(C){I.style[C]=g[C]}))}var l=function I(l,o){var t=0;function c(){var I,g,C=[];this.add=function(I){C.push(I)},this.call=function(A){for(I=0,g=C.length;I<g;I++)C[I].call(this,A)},this.remove=function(A){var i=[];for(I=0,g=C.length;I<g;I++)C[I]!==A&&i.push(C[I]);C=i},this.length=function(){return C.length}}function n(I,C){if(I)if(I.resizedAttached)I.resizedAttached.add(C);else{I.resizedAttached=new c,I.resizedAttached.add(C),I.resizeSensor=document.createElement("div"),I.resizeSensor.dir="ltr",I.resizeSensor.className="resize-sensor";var A={pointerEvents:"none",position:"absolute",left:"0px",top:"0px",right:"0px",bottom:"0px",overflow:"hidden",zIndex:"-1",visibility:"hidden",maxWidth:"100%"},l={position:"absolute",left:"0px",top:"0px",transition:"0s"};e(I.resizeSensor,A);var o=document.createElement("div");o.className="resize-sensor-expand",e(o,A);var n=document.createElement("div");e(n,l),o.appendChild(n);var d=document.createElement("div");d.className="resize-sensor-shrink",e(d,A);var s=document.createElement("div");e(s,l),e(s,{width:"200%",height:"200%"}),d.appendChild(s),I.resizeSensor.appendChild(o),I.resizeSensor.appendChild(d),I.appendChild(I.resizeSensor);var a=window.getComputedStyle(I),Z=a?a.getPropertyValue("position"):null;"absolute"!==Z&&"relative"!==Z&&"fixed"!==Z&&"sticky"!==Z&&(I.style.position="relative");var m=!1,b=0,r=i(I),h=0,G=0,u=!0;t=0;var y=function(){var g=I.offsetWidth,C=I.offsetHeight;n.style.width=g+10+"px",n.style.height=C+10+"px",o.scrollLeft=g+10,o.scrollTop=C+10,d.scrollLeft=g+10,d.scrollTop=C+10},B=function C(){if(u){if(0===I.offsetWidth&&0===I.offsetHeight)return void(t||(t=g((function(){t=0,C()}))));u=!1}y()};I.resizeSensor.resetSensor=B;var V=function(){b=0,m&&(h=r.width,G=r.height,I.resizedAttached&&I.resizedAttached.call(r))},p=function(){r=i(I),(m=r.width!==h||r.height!==G)&&!b&&(b=g(V)),B()},X=function(I,g,C){I.attachEvent?I.attachEvent("on"+g,C):I.addEventListener(g,C)};X(o,"scroll",p),X(d,"scroll",p),t=g((function(){t=0,B()}))}}A(l,(function(I){n(I,o)})),this.detach=function(g){t||(C(t),t=0),I.detach(l,g)},this.reset=function(){l.resizeSensor.resetSensor()}};if(l.reset=function(I){A(I,(function(I){I.resizeSensor.resetSensor()}))},l.detach=function(I,g){A(I,(function(I){I&&(I.resizedAttached&&"function"===typeof g&&(I.resizedAttached.remove(g),I.resizedAttached.length())||I.resizeSensor&&(I.contains(I.resizeSensor)&&I.removeChild(I.resizeSensor),delete I.resizeSensor,delete I.resizedAttached))}))},"undefined"!==typeof MutationObserver){var o=new MutationObserver((function(I){for(var g in I)if(I.hasOwnProperty(g))for(var C=I[g].addedNodes,A=0;A<C.length;A++)C[A].resizeSensor&&l.reset(C[A])}));document.addEventListener("DOMContentLoaded",(function(I){o.observe(document.body,{childList:!0,subtree:!0})}))}return l}()}($Z);var qZ=$Z.exports;function Im(I,g,A){var l=function(g){var C,i,e=null!=(C=null==g?void 0:g.resolution)?C:4,l=null!=(i=null==g?void 0:g.transparentBackground)&&i,o=I.pixiRenderer,t=h.RenderTexture.create({width:o.width/2,height:o.height/2,resolution:e});o.render(I.pixiStage,t);var c=o.plugins.extract.canvas(t),n=document.createElement("canvas");n.width=c.width,n.height=c.height;var d=n.getContext("2d");return l||(d.fillStyle=A.root.background,d.fillRect(0,0,n.width,n.height)),d.drawImage(c,0,0),{canvas:n,resolution:e,canvasWidth:c.width,canvasHeight:c.height}};return{subscribe:XZ,unsubscribe:WZ,zoomTo:function(g,C){var A,i,e,l,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;if(C.includes("chr")){var c=C.split(":")[0],n=null==(i=null==(A=Qg().interval)?void 0:A[c])?void 0:i[0];if(c&&void 0!==typeof n){var d=null!=(l=null==(e=C.split(":")[1])?void 0:e.split("-"))?l:[0,Qg().size[c]],s=Object(r.a)(d,2),a=s[0],Z=s[1],m=+a+n-o,b=+Z+n+o;I.api.zoomTo(g,m,b,m,b,t)}else console.warn("Chromosome name is not valid",c)}else console.warn("Genomic interval you entered is not in a correct form.")},zoomToExtent:function(g){var C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,A=[0,Qg().total],i=A[0],e=A[1];I.api.zoomTo(g,i,e,i,e,C)},zoomToGene:function(g,C){var A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;I.api.zoomToGene(g,C,A,i)},suggestGene:function(g,C,A){I.api.suggestGene(g,C,A)},getViewIds:function(){if(!g)return[];var I,C,A=[];return C=function(I){I.uid&&A.push(I.uid)},(I=g)&&I.views&&Array.isArray(I.views)&&I.views.forEach((function(I){I&&I.uid&&C(I)})),A},getCanvas:l,exportPng:function(I){l({resolution:4,transparentBackground:I}).canvas.toBlob((function(I){var g=document.createElement("a");document.body.append(g),g.download="gosling-visualization",g.href=URL.createObjectURL(I),g.click(),g.remove()}),"image/png")},exportPdf:function(){var I=Object(e.a)(Object(i.a)().mark((function I(g){var A,e,o,t,c,n;return Object(i.a)().wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,C.e(4).then(C.bind(null,354));case 2:A=I.sent,e=A.jsPDF,o=l({resolution:4,transparentBackground:g}),t=o.canvas,c=t.toDataURL("image/jpeg",1),(n=new e({orientation:t.width<t.height?"p":"l",unit:"pt",format:[t.width,t.height]})).addImage(c,"JPEG",0,0,t.width,t.height),n.save("gosling-visualization.pdf");case 9:case"end":return I.stop()}}),I)})));return function(g){return I.apply(this,arguments)}}()}}var gm={exports:{}};function Cm(I,g){return gm.exports.cloneDeepWith(I,(function(I){I&&"object"===typeof I&&g.forEach((function(g){delete I[g]}))}))}!function(I,g){(function(){var C,A="Expected a function",i="__lodash_hash_undefined__",e="__lodash_placeholder__",l=16,o=32,t=64,c=128,n=256,d=1/0,s=9007199254740991,a=NaN,Z=4294967295,m=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",l],["flip",512],["partial",o],["partialRight",t],["rearg",n]],b="[object Arguments]",r="[object Array]",h="[object Boolean]",G="[object Date]",u="[object Error]",y="[object Function]",B="[object GeneratorFunction]",V="[object Map]",p="[object Number]",X="[object Object]",W="[object Promise]",H="[object RegExp]",Y="[object Set]",R="[object String]",f="[object Symbol]",K="[object WeakMap]",w="[object ArrayBuffer]",J="[object DataView]",S="[object Float32Array]",F="[object Float64Array]",N="[object Int8Array]",v="[object Int16Array]",k="[object Int32Array]",D="[object Uint8Array]",z="[object Uint8ClampedArray]",M="[object Uint16Array]",U="[object Uint32Array]",x=/\b__p \+= '';/g,T=/\b(__p \+=) '' \+/g,Q=/(__e\(.*?\)|\b__t\)) \+\n'';/g,P=/&(?:amp|lt|gt|quot|#39);/g,O=/[&<>"']/g,j=RegExp(P.source),L=RegExp(O.source),E=/<%-([\s\S]+?)%>/g,_=/<%([\s\S]+?)%>/g,$=/<%=([\s\S]+?)%>/g,q=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,II=/^\w*$/,gI=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,CI=/[\\^$.*+?()[\]{}|]/g,AI=RegExp(CI.source),iI=/^\s+/,eI=/\s/,lI=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,oI=/\{\n\/\* \[wrapped with (.+)\] \*/,tI=/,? & /,cI=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,nI=/[()=,{}\[\]\/\s]/,dI=/\\(\\)?/g,sI=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,aI=/\w*$/,ZI=/^[-+]0x[0-9a-f]+$/i,mI=/^0b[01]+$/i,bI=/^\[object .+?Constructor\]$/,rI=/^0o[0-7]+$/i,hI=/^(?:0|[1-9]\d*)$/,GI=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,uI=/($^)/,yI=/['\n\r\u2028\u2029\\]/g,BI="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",VI="\\u2700-\\u27bf",pI="a-z\\xdf-\\xf6\\xf8-\\xff",XI="A-Z\\xc0-\\xd6\\xd8-\\xde",WI="\\ufe0e\\ufe0f",HI="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",YI="['\u2019]",RI="[\\ud800-\\udfff]",fI="["+HI+"]",KI="["+BI+"]",wI="\\d+",JI="[\\u2700-\\u27bf]",SI="["+pI+"]",FI="[^\\ud800-\\udfff"+HI+wI+VI+pI+XI+"]",NI="\\ud83c[\\udffb-\\udfff]",vI="[^\\ud800-\\udfff]",kI="(?:\\ud83c[\\udde6-\\uddff]){2}",DI="[\\ud800-\\udbff][\\udc00-\\udfff]",zI="["+XI+"]",MI="(?:"+SI+"|"+FI+")",UI="(?:"+zI+"|"+FI+")",xI="(?:['\u2019](?:d|ll|m|re|s|t|ve))?",TI="(?:['\u2019](?:D|LL|M|RE|S|T|VE))?",QI="(?:"+KI+"|"+NI+")"+"?",PI="[\\ufe0e\\ufe0f]?",OI=PI+QI+("(?:\\u200d(?:"+[vI,kI,DI].join("|")+")"+PI+QI+")*"),jI="(?:"+[JI,kI,DI].join("|")+")"+OI,LI="(?:"+[vI+KI+"?",KI,kI,DI,RI].join("|")+")",EI=RegExp(YI,"g"),_I=RegExp(KI,"g"),$I=RegExp(NI+"(?="+NI+")|"+LI+OI,"g"),qI=RegExp([zI+"?"+SI+"+"+xI+"(?="+[fI,zI,"$"].join("|")+")",UI+"+"+TI+"(?="+[fI,zI+MI,"$"].join("|")+")",zI+"?"+MI+"+"+xI,zI+"+"+TI,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",wI,jI].join("|"),"g"),Ig=RegExp("[\\u200d\\ud800-\\udfff"+BI+WI+"]"),gg=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Cg=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ag=-1,ig={};ig[S]=ig[F]=ig[N]=ig[v]=ig[k]=ig[D]=ig[z]=ig[M]=ig[U]=!0,ig[b]=ig[r]=ig[w]=ig[h]=ig[J]=ig[G]=ig[u]=ig[y]=ig[V]=ig[p]=ig[X]=ig[H]=ig[Y]=ig[R]=ig[K]=!1;var eg={};eg[b]=eg[r]=eg[w]=eg[J]=eg[h]=eg[G]=eg[S]=eg[F]=eg[N]=eg[v]=eg[k]=eg[V]=eg[p]=eg[X]=eg[H]=eg[Y]=eg[R]=eg[f]=eg[D]=eg[z]=eg[M]=eg[U]=!0,eg[u]=eg[y]=eg[K]=!1;var lg={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},og=parseFloat,tg=parseInt,cg="object"==typeof sC&&sC&&sC.Object===Object&&sC,ng="object"==typeof self&&self&&self.Object===Object&&self,dg=cg||ng||Function("return this")(),sg=g&&!g.nodeType&&g,ag=sg&&I&&!I.nodeType&&I,Zg=ag&&ag.exports===sg,mg=Zg&&cg.process,bg=function(){try{var I=ag&&ag.require&&ag.require("util").types;return I||mg&&mg.binding&&mg.binding("util")}catch(im){}}(),rg=bg&&bg.isArrayBuffer,hg=bg&&bg.isDate,Gg=bg&&bg.isMap,ug=bg&&bg.isRegExp,yg=bg&&bg.isSet,Bg=bg&&bg.isTypedArray;function Vg(I,g,C){switch(C.length){case 0:return I.call(g);case 1:return I.call(g,C[0]);case 2:return I.call(g,C[0],C[1]);case 3:return I.call(g,C[0],C[1],C[2])}return I.apply(g,C)}function pg(I,g,C,A){for(var i=-1,e=null==I?0:I.length;++i<e;){var l=I[i];g(A,l,C(l),I)}return A}function Xg(I,g){for(var C=-1,A=null==I?0:I.length;++C<A&&!1!==g(I[C],C,I););return I}function Wg(I,g){for(var C=null==I?0:I.length;C--&&!1!==g(I[C],C,I););return I}function Hg(I,g){for(var C=-1,A=null==I?0:I.length;++C<A;)if(!g(I[C],C,I))return!1;return!0}function Yg(I,g){for(var C=-1,A=null==I?0:I.length,i=0,e=[];++C<A;){var l=I[C];g(l,C,I)&&(e[i++]=l)}return e}function Rg(I,g){return!!(null==I?0:I.length)&&Dg(I,g,0)>-1}function fg(I,g,C){for(var A=-1,i=null==I?0:I.length;++A<i;)if(C(g,I[A]))return!0;return!1}function Kg(I,g){for(var C=-1,A=null==I?0:I.length,i=Array(A);++C<A;)i[C]=g(I[C],C,I);return i}function wg(I,g){for(var C=-1,A=g.length,i=I.length;++C<A;)I[i+C]=g[C];return I}function Jg(I,g,C,A){var i=-1,e=null==I?0:I.length;for(A&&e&&(C=I[++i]);++i<e;)C=g(C,I[i],i,I);return C}function Sg(I,g,C,A){var i=null==I?0:I.length;for(A&&i&&(C=I[--i]);i--;)C=g(C,I[i],i,I);return C}function Fg(I,g){for(var C=-1,A=null==I?0:I.length;++C<A;)if(g(I[C],C,I))return!0;return!1}var Ng=xg("length");function vg(I,g,C){var A;return C(I,(function(I,C,i){if(g(I,C,i))return A=C,!1})),A}function kg(I,g,C,A){for(var i=I.length,e=C+(A?1:-1);A?e--:++e<i;)if(g(I[e],e,I))return e;return-1}function Dg(I,g,C){return g===g?function(I,g,C){var A=C-1,i=I.length;for(;++A<i;)if(I[A]===g)return A;return-1}(I,g,C):kg(I,Mg,C)}function zg(I,g,C,A){for(var i=C-1,e=I.length;++i<e;)if(A(I[i],g))return i;return-1}function Mg(I){return I!==I}function Ug(I,g){var C=null==I?0:I.length;return C?Pg(I,g)/C:a}function xg(I){return function(g){return null==g?C:g[I]}}function Tg(I){return function(g){return null==I?C:I[g]}}function Qg(I,g,C,A,i){return i(I,(function(I,i,e){C=A?(A=!1,I):g(C,I,i,e)})),C}function Pg(I,g){for(var A,i=-1,e=I.length;++i<e;){var l=g(I[i]);l!==C&&(A=A===C?l:A+l)}return A}function Og(I,g){for(var C=-1,A=Array(I);++C<I;)A[C]=g(C);return A}function jg(I){return I?I.slice(0,dC(I)+1).replace(iI,""):I}function Lg(I){return function(g){return I(g)}}function Eg(I,g){return Kg(g,(function(g){return I[g]}))}function _g(I,g){return I.has(g)}function $g(I,g){for(var C=-1,A=I.length;++C<A&&Dg(g,I[C],0)>-1;);return C}function qg(I,g){for(var C=I.length;C--&&Dg(g,I[C],0)>-1;);return C}function IC(I,g){for(var C=I.length,A=0;C--;)I[C]===g&&++A;return A}var gC=Tg({"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss","\u0100":"A","\u0102":"A","\u0104":"A","\u0101":"a","\u0103":"a","\u0105":"a","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u010e":"D","\u0110":"D","\u010f":"d","\u0111":"d","\u0112":"E","\u0114":"E","\u0116":"E","\u0118":"E","\u011a":"E","\u0113":"e","\u0115":"e","\u0117":"e","\u0119":"e","\u011b":"e","\u011c":"G","\u011e":"G","\u0120":"G","\u0122":"G","\u011d":"g","\u011f":"g","\u0121":"g","\u0123":"g","\u0124":"H","\u0126":"H","\u0125":"h","\u0127":"h","\u0128":"I","\u012a":"I","\u012c":"I","\u012e":"I","\u0130":"I","\u0129":"i","\u012b":"i","\u012d":"i","\u012f":"i","\u0131":"i","\u0134":"J","\u0135":"j","\u0136":"K","\u0137":"k","\u0138":"k","\u0139":"L","\u013b":"L","\u013d":"L","\u013f":"L","\u0141":"L","\u013a":"l","\u013c":"l","\u013e":"l","\u0140":"l","\u0142":"l","\u0143":"N","\u0145":"N","\u0147":"N","\u014a":"N","\u0144":"n","\u0146":"n","\u0148":"n","\u014b":"n","\u014c":"O","\u014e":"O","\u0150":"O","\u014d":"o","\u014f":"o","\u0151":"o","\u0154":"R","\u0156":"R","\u0158":"R","\u0155":"r","\u0157":"r","\u0159":"r","\u015a":"S","\u015c":"S","\u015e":"S","\u0160":"S","\u015b":"s","\u015d":"s","\u015f":"s","\u0161":"s","\u0162":"T","\u0164":"T","\u0166":"T","\u0163":"t","\u0165":"t","\u0167":"t","\u0168":"U","\u016a":"U","\u016c":"U","\u016e":"U","\u0170":"U","\u0172":"U","\u0169":"u","\u016b":"u","\u016d":"u","\u016f":"u","\u0171":"u","\u0173":"u","\u0174":"W","\u0175":"w","\u0176":"Y","\u0177":"y","\u0178":"Y","\u0179":"Z","\u017b":"Z","\u017d":"Z","\u017a":"z","\u017c":"z","\u017e":"z","\u0132":"IJ","\u0133":"ij","\u0152":"Oe","\u0153":"oe","\u0149":"'n","\u017f":"s"}),CC=Tg({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function AC(I){return"\\"+lg[I]}function iC(I){return Ig.test(I)}function eC(I){var g=-1,C=Array(I.size);return I.forEach((function(I,A){C[++g]=[A,I]})),C}function lC(I,g){return function(C){return I(g(C))}}function oC(I,g){for(var C=-1,A=I.length,i=0,l=[];++C<A;){var o=I[C];o!==g&&o!==e||(I[C]=e,l[i++]=C)}return l}function tC(I){var g=-1,C=Array(I.size);return I.forEach((function(I){C[++g]=I})),C}function cC(I){return iC(I)?function(I){var g=$I.lastIndex=0;for(;$I.test(I);)++g;return g}(I):Ng(I)}function nC(I){return iC(I)?function(I){return I.match($I)||[]}(I):function(I){return I.split("")}(I)}function dC(I){for(var g=I.length;g--&&eI.test(I.charAt(g)););return g}var aC=Tg({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var ZC=function I(g){var eI=(g=null==g?dg:ZC.defaults(dg.Object(),g,ZC.pick(dg,Cg))).Array,BI=g.Date,VI=g.Error,pI=g.Function,XI=g.Math,WI=g.Object,HI=g.RegExp,YI=g.String,RI=g.TypeError,fI=eI.prototype,KI=pI.prototype,wI=WI.prototype,JI=g["__core-js_shared__"],SI=KI.toString,FI=wI.hasOwnProperty,NI=0,vI=function(){var I=/[^.]+$/.exec(JI&&JI.keys&&JI.keys.IE_PROTO||"");return I?"Symbol(src)_1."+I:""}(),kI=wI.toString,DI=SI.call(WI),zI=dg._,MI=HI("^"+SI.call(FI).replace(CI,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),UI=Zg?g.Buffer:C,xI=g.Symbol,TI=g.Uint8Array,QI=UI?UI.allocUnsafe:C,PI=lC(WI.getPrototypeOf,WI),OI=WI.create,jI=wI.propertyIsEnumerable,LI=fI.splice,$I=xI?xI.isConcatSpreadable:C,Ig=xI?xI.iterator:C,lg=xI?xI.toStringTag:C,cg=function(){try{var I=ne(WI,"defineProperty");return I({},"",{}),I}catch(im){}}(),ng=g.clearTimeout!==dg.clearTimeout&&g.clearTimeout,sg=BI&&BI.now!==dg.Date.now&&BI.now,ag=g.setTimeout!==dg.setTimeout&&g.setTimeout,mg=XI.ceil,bg=XI.floor,Ng=WI.getOwnPropertySymbols,Tg=UI?UI.isBuffer:C,sC=g.isFinite,mC=fI.join,bC=lC(WI.keys,WI),rC=XI.max,hC=XI.min,GC=BI.now,uC=g.parseInt,yC=XI.random,BC=fI.reverse,VC=ne(g,"DataView"),pC=ne(g,"Map"),XC=ne(g,"Promise"),WC=ne(g,"Set"),HC=ne(g,"WeakMap"),YC=ne(WI,"create"),RC=HC&&new HC,fC={},KC=ve(VC),wC=ve(pC),JC=ve(XC),SC=ve(WC),FC=ve(HC),NC=xI?xI.prototype:C,vC=NC?NC.valueOf:C,kC=NC?NC.toString:C;function DC(I){if(Io(I)&&!xl(I)&&!(I instanceof xC)){if(I instanceof UC)return I;if(FI.call(I,"__wrapped__"))return ke(I)}return new UC(I)}var zC=function(){function I(){}return function(g){if(!ql(g))return{};if(OI)return OI(g);I.prototype=g;var A=new I;return I.prototype=C,A}}();function MC(){}function UC(I,g){this.__wrapped__=I,this.__actions__=[],this.__chain__=!!g,this.__index__=0,this.__values__=C}function xC(I){this.__wrapped__=I,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Z,this.__views__=[]}function TC(I){var g=-1,C=null==I?0:I.length;for(this.clear();++g<C;){var A=I[g];this.set(A[0],A[1])}}function QC(I){var g=-1,C=null==I?0:I.length;for(this.clear();++g<C;){var A=I[g];this.set(A[0],A[1])}}function PC(I){var g=-1,C=null==I?0:I.length;for(this.clear();++g<C;){var A=I[g];this.set(A[0],A[1])}}function OC(I){var g=-1,C=null==I?0:I.length;for(this.__data__=new PC;++g<C;)this.add(I[g])}function jC(I){var g=this.__data__=new QC(I);this.size=g.size}function LC(I,g){var C=xl(I),A=!C&&Ul(I),i=!C&&!A&&Ol(I),e=!C&&!A&&!i&&to(I),l=C||A||i||e,o=l?Og(I.length,YI):[],t=o.length;for(var c in I)!g&&!FI.call(I,c)||l&&("length"==c||i&&("offset"==c||"parent"==c)||e&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||re(c,t))||o.push(c);return o}function EC(I){var g=I.length;return g?I[OA(0,g-1)]:C}function _C(I,g){return Se(Yi(I),lA(g,0,I.length))}function $C(I){return Se(Yi(I))}function qC(I,g,A){(A!==C&&!Dl(I[g],A)||A===C&&!(g in I))&&iA(I,g,A)}function IA(I,g,A){var i=I[g];FI.call(I,g)&&Dl(i,A)&&(A!==C||g in I)||iA(I,g,A)}function gA(I,g){for(var C=I.length;C--;)if(Dl(I[C][0],g))return C;return-1}function CA(I,g,C,A){return dA(I,(function(I,i,e){g(A,I,C(I),e)})),A}function AA(I,g){return I&&Ri(g,Ko(g),I)}function iA(I,g,C){"__proto__"==g&&cg?cg(I,g,{configurable:!0,enumerable:!0,value:C,writable:!0}):I[g]=C}function eA(I,g){for(var A=-1,i=g.length,e=eI(i),l=null==I;++A<i;)e[A]=l?C:Wo(I,g[A]);return e}function lA(I,g,A){return I===I&&(A!==C&&(I=I<=A?I:A),g!==C&&(I=I>=g?I:g)),I}function oA(I,g,A,i,e,l){var o,t=1&g,c=2&g,n=4&g;if(A&&(o=e?A(I,i,e,l):A(I)),o!==C)return o;if(!ql(I))return I;var d=xl(I);if(d){if(o=function(I){var g=I.length,C=new I.constructor(g);g&&"string"==typeof I[0]&&FI.call(I,"index")&&(C.index=I.index,C.input=I.input);return C}(I),!t)return Yi(I,o)}else{var s=ae(I),a=s==y||s==B;if(Ol(I))return Bi(I,t);if(s==X||s==b||a&&!e){if(o=c||a?{}:me(I),!t)return c?function(I,g){return Ri(I,se(I),g)}(I,function(I,g){return I&&Ri(g,wo(g),I)}(o,I)):function(I,g){return Ri(I,de(I),g)}(I,AA(o,I))}else{if(!eg[s])return e?I:{};o=function(I,g,C){var A=I.constructor;switch(g){case w:return Vi(I);case h:case G:return new A(+I);case J:return function(I,g){var C=g?Vi(I.buffer):I.buffer;return new I.constructor(C,I.byteOffset,I.byteLength)}(I,C);case S:case F:case N:case v:case k:case D:case z:case M:case U:return pi(I,C);case V:return new A;case p:case R:return new A(I);case H:return function(I){var g=new I.constructor(I.source,aI.exec(I));return g.lastIndex=I.lastIndex,g}(I);case Y:return new A;case f:return i=I,vC?WI(vC.call(i)):{}}var i}(I,s,t)}}l||(l=new jC);var Z=l.get(I);if(Z)return Z;l.set(I,o),eo(I)?I.forEach((function(C){o.add(oA(C,g,A,C,I,l))})):go(I)&&I.forEach((function(C,i){o.set(i,oA(C,g,A,i,I,l))}));var m=d?C:(n?c?Ae:Ce:c?wo:Ko)(I);return Xg(m||I,(function(C,i){m&&(C=I[i=C]),IA(o,i,oA(C,g,A,i,I,l))})),o}function tA(I,g,A){var i=A.length;if(null==I)return!i;for(I=WI(I);i--;){var e=A[i],l=g[e],o=I[e];if(o===C&&!(e in I)||!l(o))return!1}return!0}function cA(I,g,i){if("function"!=typeof I)throw new RI(A);return fe((function(){I.apply(C,i)}),g)}function nA(I,g,C,A){var i=-1,e=Rg,l=!0,o=I.length,t=[],c=g.length;if(!o)return t;C&&(g=Kg(g,Lg(C))),A?(e=fg,l=!1):g.length>=200&&(e=_g,l=!1,g=new OC(g));I:for(;++i<o;){var n=I[i],d=null==C?n:C(n);if(n=A||0!==n?n:0,l&&d===d){for(var s=c;s--;)if(g[s]===d)continue I;t.push(n)}else e(g,d,A)||t.push(n)}return t}DC.templateSettings={escape:E,evaluate:_,interpolate:$,variable:"",imports:{_:DC}},DC.prototype=MC.prototype,DC.prototype.constructor=DC,UC.prototype=zC(MC.prototype),UC.prototype.constructor=UC,xC.prototype=zC(MC.prototype),xC.prototype.constructor=xC,TC.prototype.clear=function(){this.__data__=YC?YC(null):{},this.size=0},TC.prototype.delete=function(I){var g=this.has(I)&&delete this.__data__[I];return this.size-=g?1:0,g},TC.prototype.get=function(I){var g=this.__data__;if(YC){var A=g[I];return A===i?C:A}return FI.call(g,I)?g[I]:C},TC.prototype.has=function(I){var g=this.__data__;return YC?g[I]!==C:FI.call(g,I)},TC.prototype.set=function(I,g){var A=this.__data__;return this.size+=this.has(I)?0:1,A[I]=YC&&g===C?i:g,this},QC.prototype.clear=function(){this.__data__=[],this.size=0},QC.prototype.delete=function(I){var g=this.__data__,C=gA(g,I);return!(C<0)&&(C==g.length-1?g.pop():LI.call(g,C,1),--this.size,!0)},QC.prototype.get=function(I){var g=this.__data__,A=gA(g,I);return A<0?C:g[A][1]},QC.prototype.has=function(I){return gA(this.__data__,I)>-1},QC.prototype.set=function(I,g){var C=this.__data__,A=gA(C,I);return A<0?(++this.size,C.push([I,g])):C[A][1]=g,this},PC.prototype.clear=function(){this.size=0,this.__data__={hash:new TC,map:new(pC||QC),string:new TC}},PC.prototype.delete=function(I){var g=te(this,I).delete(I);return this.size-=g?1:0,g},PC.prototype.get=function(I){return te(this,I).get(I)},PC.prototype.has=function(I){return te(this,I).has(I)},PC.prototype.set=function(I,g){var C=te(this,I),A=C.size;return C.set(I,g),this.size+=C.size==A?0:1,this},OC.prototype.add=OC.prototype.push=function(I){return this.__data__.set(I,i),this},OC.prototype.has=function(I){return this.__data__.has(I)},jC.prototype.clear=function(){this.__data__=new QC,this.size=0},jC.prototype.delete=function(I){var g=this.__data__,C=g.delete(I);return this.size=g.size,C},jC.prototype.get=function(I){return this.__data__.get(I)},jC.prototype.has=function(I){return this.__data__.has(I)},jC.prototype.set=function(I,g){var C=this.__data__;if(C instanceof QC){var A=C.__data__;if(!pC||A.length<199)return A.push([I,g]),this.size=++C.size,this;C=this.__data__=new PC(A)}return C.set(I,g),this.size=C.size,this};var dA=wi(GA),sA=wi(uA,!0);function aA(I,g){var C=!0;return dA(I,(function(I,A,i){return C=!!g(I,A,i)})),C}function ZA(I,g,A){for(var i=-1,e=I.length;++i<e;){var l=I[i],o=g(l);if(null!=o&&(t===C?o===o&&!oo(o):A(o,t)))var t=o,c=l}return c}function mA(I,g){var C=[];return dA(I,(function(I,A,i){g(I,A,i)&&C.push(I)})),C}function bA(I,g,C,A,i){var e=-1,l=I.length;for(C||(C=be),i||(i=[]);++e<l;){var o=I[e];g>0&&C(o)?g>1?bA(o,g-1,C,A,i):wg(i,o):A||(i[i.length]=o)}return i}var rA=Ji(),hA=Ji(!0);function GA(I,g){return I&&rA(I,g,Ko)}function uA(I,g){return I&&hA(I,g,Ko)}function yA(I,g){return Yg(g,(function(g){return El(I[g])}))}function BA(I,g){for(var A=0,i=(g=hi(g,I)).length;null!=I&&A<i;)I=I[Ne(g[A++])];return A&&A==i?I:C}function VA(I,g,C){var A=g(I);return xl(I)?A:wg(A,C(I))}function pA(I){return null==I?I===C?"[object Undefined]":"[object Null]":lg&&lg in WI(I)?function(I){var g=FI.call(I,lg),A=I[lg];try{I[lg]=C;var i=!0}catch(im){}var e=kI.call(I);i&&(g?I[lg]=A:delete I[lg]);return e}(I):function(I){return kI.call(I)}(I)}function XA(I,g){return I>g}function WA(I,g){return null!=I&&FI.call(I,g)}function HA(I,g){return null!=I&&g in WI(I)}function YA(I,g,A){for(var i=A?fg:Rg,e=I[0].length,l=I.length,o=l,t=eI(l),c=1/0,n=[];o--;){var d=I[o];o&&g&&(d=Kg(d,Lg(g))),c=hC(d.length,c),t[o]=!A&&(g||e>=120&&d.length>=120)?new OC(o&&d):C}d=I[0];var s=-1,a=t[0];I:for(;++s<e&&n.length<c;){var Z=d[s],m=g?g(Z):Z;if(Z=A||0!==Z?Z:0,!(a?_g(a,m):i(n,m,A))){for(o=l;--o;){var b=t[o];if(!(b?_g(b,m):i(I[o],m,A)))continue I}a&&a.push(m),n.push(Z)}}return n}function RA(I,g,A){var i=null==(I=We(I,g=hi(g,I)))?I:I[Ne(Le(g))];return null==i?C:Vg(i,I,A)}function fA(I){return Io(I)&&pA(I)==b}function KA(I,g,A,i,e){return I===g||(null==I||null==g||!Io(I)&&!Io(g)?I!==I&&g!==g:function(I,g,A,i,e,l){var o=xl(I),t=xl(g),c=o?r:ae(I),n=t?r:ae(g),d=(c=c==b?X:c)==X,s=(n=n==b?X:n)==X,a=c==n;if(a&&Ol(I)){if(!Ol(g))return!1;o=!0,d=!1}if(a&&!d)return l||(l=new jC),o||to(I)?Ie(I,g,A,i,e,l):function(I,g,C,A,i,e,l){switch(C){case J:if(I.byteLength!=g.byteLength||I.byteOffset!=g.byteOffset)return!1;I=I.buffer,g=g.buffer;case w:return!(I.byteLength!=g.byteLength||!e(new TI(I),new TI(g)));case h:case G:case p:return Dl(+I,+g);case u:return I.name==g.name&&I.message==g.message;case H:case R:return I==g+"";case V:var o=eC;case Y:var t=1&A;if(o||(o=tC),I.size!=g.size&&!t)return!1;var c=l.get(I);if(c)return c==g;A|=2,l.set(I,g);var n=Ie(o(I),o(g),A,i,e,l);return l.delete(I),n;case f:if(vC)return vC.call(I)==vC.call(g)}return!1}(I,g,c,A,i,e,l);if(!(1&A)){var Z=d&&FI.call(I,"__wrapped__"),m=s&&FI.call(g,"__wrapped__");if(Z||m){var y=Z?I.value():I,B=m?g.value():g;return l||(l=new jC),e(y,B,A,i,l)}}if(!a)return!1;return l||(l=new jC),function(I,g,A,i,e,l){var o=1&A,t=Ce(I),c=t.length,n=Ce(g).length;if(c!=n&&!o)return!1;var d=c;for(;d--;){var s=t[d];if(!(o?s in g:FI.call(g,s)))return!1}var a=l.get(I),Z=l.get(g);if(a&&Z)return a==g&&Z==I;var m=!0;l.set(I,g),l.set(g,I);var b=o;for(;++d<c;){var r=I[s=t[d]],h=g[s];if(i)var G=o?i(h,r,s,g,I,l):i(r,h,s,I,g,l);if(!(G===C?r===h||e(r,h,A,i,l):G)){m=!1;break}b||(b="constructor"==s)}if(m&&!b){var u=I.constructor,y=g.constructor;u==y||!("constructor"in I)||!("constructor"in g)||"function"==typeof u&&u instanceof u&&"function"==typeof y&&y instanceof y||(m=!1)}return l.delete(I),l.delete(g),m}(I,g,A,i,e,l)}(I,g,A,i,KA,e))}function wA(I,g,A,i){var e=A.length,l=e,o=!i;if(null==I)return!l;for(I=WI(I);e--;){var t=A[e];if(o&&t[2]?t[1]!==I[t[0]]:!(t[0]in I))return!1}for(;++e<l;){var c=(t=A[e])[0],n=I[c],d=t[1];if(o&&t[2]){if(n===C&&!(c in I))return!1}else{var s=new jC;if(i)var a=i(n,d,c,I,g,s);if(!(a===C?KA(d,n,3,i,s):a))return!1}}return!0}function JA(I){return!(!ql(I)||(g=I,vI&&vI in g))&&(El(I)?MI:bI).test(ve(I));var g}function SA(I){return"function"==typeof I?I:null==I?At:"object"==typeof I?xl(I)?zA(I[0],I[1]):DA(I):st(I)}function FA(I){if(!Be(I))return bC(I);var g=[];for(var C in WI(I))FI.call(I,C)&&"constructor"!=C&&g.push(C);return g}function NA(I){if(!ql(I))return function(I){var g=[];if(null!=I)for(var C in WI(I))g.push(C);return g}(I);var g=Be(I),C=[];for(var A in I)("constructor"!=A||!g&&FI.call(I,A))&&C.push(A);return C}function vA(I,g){return I<g}function kA(I,g){var C=-1,A=Ql(I)?eI(I.length):[];return dA(I,(function(I,i,e){A[++C]=g(I,i,e)})),A}function DA(I){var g=ce(I);return 1==g.length&&g[0][2]?pe(g[0][0],g[0][1]):function(C){return C===I||wA(C,I,g)}}function zA(I,g){return Ge(I)&&Ve(g)?pe(Ne(I),g):function(A){var i=Wo(A,I);return i===C&&i===g?Ho(A,I):KA(g,i,3)}}function MA(I,g,A,i,e){I!==g&&rA(g,(function(l,o){if(e||(e=new jC),ql(l))!function(I,g,A,i,e,l,o){var t=Ye(I,A),c=Ye(g,A),n=o.get(c);if(n)return void qC(I,A,n);var d=l?l(t,c,A+"",I,g,o):C,s=d===C;if(s){var a=xl(c),Z=!a&&Ol(c),m=!a&&!Z&&to(c);d=c,a||Z||m?xl(t)?d=t:Pl(t)?d=Yi(t):Z?(s=!1,d=Bi(c,!0)):m?(s=!1,d=pi(c,!0)):d=[]:Ao(c)||Ul(c)?(d=t,Ul(t)?d=ro(t):ql(t)&&!El(t)||(d=me(c))):s=!1}s&&(o.set(c,d),e(d,c,i,l,o),o.delete(c));qC(I,A,d)}(I,g,o,A,MA,i,e);else{var t=i?i(Ye(I,o),l,o+"",I,g,e):C;t===C&&(t=l),qC(I,o,t)}}),wo)}function UA(I,g){var A=I.length;if(A)return re(g+=g<0?A:0,A)?I[g]:C}function xA(I,g,C){g=g.length?Kg(g,(function(I){return xl(I)?function(g){return BA(g,1===I.length?I[0]:I)}:I})):[At];var A=-1;return g=Kg(g,Lg(oe())),function(I,g){var C=I.length;for(I.sort(g);C--;)I[C]=I[C].value;return I}(kA(I,(function(I,C,i){return{criteria:Kg(g,(function(g){return g(I)})),index:++A,value:I}})),(function(I,g){return function(I,g,C){var A=-1,i=I.criteria,e=g.criteria,l=i.length,o=C.length;for(;++A<l;){var t=Xi(i[A],e[A]);if(t)return A>=o?t:t*("desc"==C[A]?-1:1)}return I.index-g.index}(I,g,C)}))}function TA(I,g,C){for(var A=-1,i=g.length,e={};++A<i;){var l=g[A],o=BA(I,l);C(o,l)&&$A(e,hi(l,I),o)}return e}function QA(I,g,C,A){var i=A?zg:Dg,e=-1,l=g.length,o=I;for(I===g&&(g=Yi(g)),C&&(o=Kg(I,Lg(C)));++e<l;)for(var t=0,c=g[e],n=C?C(c):c;(t=i(o,n,t,A))>-1;)o!==I&&LI.call(o,t,1),LI.call(I,t,1);return I}function PA(I,g){for(var C=I?g.length:0,A=C-1;C--;){var i=g[C];if(C==A||i!==e){var e=i;re(i)?LI.call(I,i,1):ni(I,i)}}return I}function OA(I,g){return I+bg(yC()*(g-I+1))}function jA(I,g){var C="";if(!I||g<1||g>s)return C;do{g%2&&(C+=I),(g=bg(g/2))&&(I+=I)}while(g);return C}function LA(I,g){return Ke(Xe(I,g,At),I+"")}function EA(I){return EC(zo(I))}function _A(I,g){var C=zo(I);return Se(C,lA(g,0,C.length))}function $A(I,g,A,i){if(!ql(I))return I;for(var e=-1,l=(g=hi(g,I)).length,o=l-1,t=I;null!=t&&++e<l;){var c=Ne(g[e]),n=A;if("__proto__"===c||"constructor"===c||"prototype"===c)return I;if(e!=o){var d=t[c];(n=i?i(d,c,t):C)===C&&(n=ql(d)?d:re(g[e+1])?[]:{})}IA(t,c,n),t=t[c]}return I}var qA=RC?function(I,g){return RC.set(I,g),I}:At,Ii=cg?function(I,g){return cg(I,"toString",{configurable:!0,enumerable:!1,value:It(g),writable:!0})}:At;function gi(I){return Se(zo(I))}function Ci(I,g,C){var A=-1,i=I.length;g<0&&(g=-g>i?0:i+g),(C=C>i?i:C)<0&&(C+=i),i=g>C?0:C-g>>>0,g>>>=0;for(var e=eI(i);++A<i;)e[A]=I[A+g];return e}function Ai(I,g){var C;return dA(I,(function(I,A,i){return!(C=g(I,A,i))})),!!C}function ii(I,g,C){var A=0,i=null==I?A:I.length;if("number"==typeof g&&g===g&&i<=2147483647){for(;A<i;){var e=A+i>>>1,l=I[e];null!==l&&!oo(l)&&(C?l<=g:l<g)?A=e+1:i=e}return i}return ei(I,g,At,C)}function ei(I,g,A,i){var e=0,l=null==I?0:I.length;if(0===l)return 0;for(var o=(g=A(g))!==g,t=null===g,c=oo(g),n=g===C;e<l;){var d=bg((e+l)/2),s=A(I[d]),a=s!==C,Z=null===s,m=s===s,b=oo(s);if(o)var r=i||m;else r=n?m&&(i||a):t?m&&a&&(i||!Z):c?m&&a&&!Z&&(i||!b):!Z&&!b&&(i?s<=g:s<g);r?e=d+1:l=d}return hC(l,4294967294)}function li(I,g){for(var C=-1,A=I.length,i=0,e=[];++C<A;){var l=I[C],o=g?g(l):l;if(!C||!Dl(o,t)){var t=o;e[i++]=0===l?0:l}}return e}function oi(I){return"number"==typeof I?I:oo(I)?a:+I}function ti(I){if("string"==typeof I)return I;if(xl(I))return Kg(I,ti)+"";if(oo(I))return kC?kC.call(I):"";var g=I+"";return"0"==g&&1/I==-1/0?"-0":g}function ci(I,g,C){var A=-1,i=Rg,e=I.length,l=!0,o=[],t=o;if(C)l=!1,i=fg;else if(e>=200){var c=g?null:ji(I);if(c)return tC(c);l=!1,i=_g,t=new OC}else t=g?[]:o;I:for(;++A<e;){var n=I[A],d=g?g(n):n;if(n=C||0!==n?n:0,l&&d===d){for(var s=t.length;s--;)if(t[s]===d)continue I;g&&t.push(d),o.push(n)}else i(t,d,C)||(t!==o&&t.push(d),o.push(n))}return o}function ni(I,g){return null==(I=We(I,g=hi(g,I)))||delete I[Ne(Le(g))]}function di(I,g,C,A){return $A(I,g,C(BA(I,g)),A)}function si(I,g,C,A){for(var i=I.length,e=A?i:-1;(A?e--:++e<i)&&g(I[e],e,I););return C?Ci(I,A?0:e,A?e+1:i):Ci(I,A?e+1:0,A?i:e)}function ai(I,g){var C=I;return C instanceof xC&&(C=C.value()),Jg(g,(function(I,g){return g.func.apply(g.thisArg,wg([I],g.args))}),C)}function Zi(I,g,C){var A=I.length;if(A<2)return A?ci(I[0]):[];for(var i=-1,e=eI(A);++i<A;)for(var l=I[i],o=-1;++o<A;)o!=i&&(e[i]=nA(e[i]||l,I[o],g,C));return ci(bA(e,1),g,C)}function mi(I,g,A){for(var i=-1,e=I.length,l=g.length,o={};++i<e;){var t=i<l?g[i]:C;A(o,I[i],t)}return o}function bi(I){return Pl(I)?I:[]}function ri(I){return"function"==typeof I?I:At}function hi(I,g){return xl(I)?I:Ge(I,g)?[I]:Fe(ho(I))}var Gi=LA;function ui(I,g,A){var i=I.length;return A=A===C?i:A,!g&&A>=i?I:Ci(I,g,A)}var yi=ng||function(I){return dg.clearTimeout(I)};function Bi(I,g){if(g)return I.slice();var C=I.length,A=QI?QI(C):new I.constructor(C);return I.copy(A),A}function Vi(I){var g=new I.constructor(I.byteLength);return new TI(g).set(new TI(I)),g}function pi(I,g){var C=g?Vi(I.buffer):I.buffer;return new I.constructor(C,I.byteOffset,I.length)}function Xi(I,g){if(I!==g){var A=I!==C,i=null===I,e=I===I,l=oo(I),o=g!==C,t=null===g,c=g===g,n=oo(g);if(!t&&!n&&!l&&I>g||l&&o&&c&&!t&&!n||i&&o&&c||!A&&c||!e)return 1;if(!i&&!l&&!n&&I<g||n&&A&&e&&!i&&!l||t&&A&&e||!o&&e||!c)return-1}return 0}function Wi(I,g,C,A){for(var i=-1,e=I.length,l=C.length,o=-1,t=g.length,c=rC(e-l,0),n=eI(t+c),d=!A;++o<t;)n[o]=g[o];for(;++i<l;)(d||i<e)&&(n[C[i]]=I[i]);for(;c--;)n[o++]=I[i++];return n}function Hi(I,g,C,A){for(var i=-1,e=I.length,l=-1,o=C.length,t=-1,c=g.length,n=rC(e-o,0),d=eI(n+c),s=!A;++i<n;)d[i]=I[i];for(var a=i;++t<c;)d[a+t]=g[t];for(;++l<o;)(s||i<e)&&(d[a+C[l]]=I[i++]);return d}function Yi(I,g){var C=-1,A=I.length;for(g||(g=eI(A));++C<A;)g[C]=I[C];return g}function Ri(I,g,A,i){var e=!A;A||(A={});for(var l=-1,o=g.length;++l<o;){var t=g[l],c=i?i(A[t],I[t],t,A,I):C;c===C&&(c=I[t]),e?iA(A,t,c):IA(A,t,c)}return A}function fi(I,g){return function(C,A){var i=xl(C)?pg:CA,e=g?g():{};return i(C,I,oe(A,2),e)}}function Ki(I){return LA((function(g,A){var i=-1,e=A.length,l=e>1?A[e-1]:C,o=e>2?A[2]:C;for(l=I.length>3&&"function"==typeof l?(e--,l):C,o&&he(A[0],A[1],o)&&(l=e<3?C:l,e=1),g=WI(g);++i<e;){var t=A[i];t&&I(g,t,i,l)}return g}))}function wi(I,g){return function(C,A){if(null==C)return C;if(!Ql(C))return I(C,A);for(var i=C.length,e=g?i:-1,l=WI(C);(g?e--:++e<i)&&!1!==A(l[e],e,l););return C}}function Ji(I){return function(g,C,A){for(var i=-1,e=WI(g),l=A(g),o=l.length;o--;){var t=l[I?o:++i];if(!1===C(e[t],t,e))break}return g}}function Si(I){return function(g){var A=iC(g=ho(g))?nC(g):C,i=A?A[0]:g.charAt(0),e=A?ui(A,1).join(""):g.slice(1);return i[I]()+e}}function Fi(I){return function(g){return Jg(_o(xo(g).replace(EI,"")),I,"")}}function Ni(I){return function(){var g=arguments;switch(g.length){case 0:return new I;case 1:return new I(g[0]);case 2:return new I(g[0],g[1]);case 3:return new I(g[0],g[1],g[2]);case 4:return new I(g[0],g[1],g[2],g[3]);case 5:return new I(g[0],g[1],g[2],g[3],g[4]);case 6:return new I(g[0],g[1],g[2],g[3],g[4],g[5]);case 7:return new I(g[0],g[1],g[2],g[3],g[4],g[5],g[6])}var C=zC(I.prototype),A=I.apply(C,g);return ql(A)?A:C}}function vi(I){return function(g,A,i){var e=WI(g);if(!Ql(g)){var l=oe(A,3);g=Ko(g),A=function(I){return l(e[I],I,e)}}var o=I(g,A,i);return o>-1?e[l?g[o]:o]:C}}function ki(I){return ge((function(g){var i=g.length,e=i,l=UC.prototype.thru;for(I&&g.reverse();e--;){var o=g[e];if("function"!=typeof o)throw new RI(A);if(l&&!t&&"wrapper"==ee(o))var t=new UC([],!0)}for(e=t?e:i;++e<i;){var c=ee(o=g[e]),n="wrapper"==c?ie(o):C;t=n&&ue(n[0])&&424==n[1]&&!n[4].length&&1==n[9]?t[ee(n[0])].apply(t,n[3]):1==o.length&&ue(o)?t[c]():t.thru(o)}return function(){var I=arguments,C=I[0];if(t&&1==I.length&&xl(C))return t.plant(C).value();for(var A=0,e=i?g[A].apply(this,I):C;++A<i;)e=g[A].call(this,e);return e}}))}function Di(I,g,A,i,e,l,o,t,n,d){var s=g&c,a=1&g,Z=2&g,m=24&g,b=512&g,r=Z?C:Ni(I);return function C(){for(var c=arguments.length,h=eI(c),G=c;G--;)h[G]=arguments[G];if(m)var u=le(C),y=IC(h,u);if(i&&(h=Wi(h,i,e,m)),l&&(h=Hi(h,l,o,m)),c-=y,m&&c<d){var B=oC(h,u);return Pi(I,g,Di,C.placeholder,A,h,B,t,n,d-c)}var V=a?A:this,p=Z?V[I]:I;return c=h.length,t?h=He(h,t):b&&c>1&&h.reverse(),s&&n<c&&(h.length=n),this&&this!==dg&&this instanceof C&&(p=r||Ni(p)),p.apply(V,h)}}function zi(I,g){return function(C,A){return function(I,g,C,A){return GA(I,(function(I,i,e){g(A,C(I),i,e)})),A}(C,I,g(A),{})}}function Mi(I,g){return function(A,i){var e;if(A===C&&i===C)return g;if(A!==C&&(e=A),i!==C){if(e===C)return i;"string"==typeof A||"string"==typeof i?(A=ti(A),i=ti(i)):(A=oi(A),i=oi(i)),e=I(A,i)}return e}}function Ui(I){return ge((function(g){return g=Kg(g,Lg(oe())),LA((function(C){var A=this;return I(g,(function(I){return Vg(I,A,C)}))}))}))}function xi(I,g){var A=(g=g===C?" ":ti(g)).length;if(A<2)return A?jA(g,I):g;var i=jA(g,mg(I/cC(g)));return iC(g)?ui(nC(i),0,I).join(""):i.slice(0,I)}function Ti(I){return function(g,A,i){return i&&"number"!=typeof i&&he(g,A,i)&&(A=i=C),g=ao(g),A===C?(A=g,g=0):A=ao(A),function(I,g,C,A){for(var i=-1,e=rC(mg((g-I)/(C||1)),0),l=eI(e);e--;)l[A?e:++i]=I,I+=C;return l}(g,A,i=i===C?g<A?1:-1:ao(i),I)}}function Qi(I){return function(g,C){return"string"==typeof g&&"string"==typeof C||(g=bo(g),C=bo(C)),I(g,C)}}function Pi(I,g,A,i,e,l,c,n,d,s){var a=8&g;g|=a?o:t,4&(g&=~(a?t:o))||(g&=-4);var Z=[I,g,e,a?l:C,a?c:C,a?C:l,a?C:c,n,d,s],m=A.apply(C,Z);return ue(I)&&Re(m,Z),m.placeholder=i,we(m,I,g)}function Oi(I){var g=XI[I];return function(I,C){if(I=bo(I),(C=null==C?0:hC(Zo(C),292))&&sC(I)){var A=(ho(I)+"e").split("e");return+((A=(ho(g(A[0]+"e"+(+A[1]+C)))+"e").split("e"))[0]+"e"+(+A[1]-C))}return g(I)}}var ji=WC&&1/tC(new WC([,-0]))[1]==d?function(I){return new WC(I)}:tt;function Li(I){return function(g){var C=ae(g);return C==V?eC(g):C==Y?function(I){var g=-1,C=Array(I.size);return I.forEach((function(I){C[++g]=[I,I]})),C}(g):function(I,g){return Kg(g,(function(g){return[g,I[g]]}))}(g,I(g))}}function Ei(I,g,i,d,s,a,Z,m){var b=2&g;if(!b&&"function"!=typeof I)throw new RI(A);var r=d?d.length:0;if(r||(g&=-97,d=s=C),Z=Z===C?Z:rC(Zo(Z),0),m=m===C?m:Zo(m),r-=s?s.length:0,g&t){var h=d,G=s;d=s=C}var u=b?C:ie(I),y=[I,g,i,d,s,h,G,a,Z,m];if(u&&function(I,g){var C=I[1],A=g[1],i=C|A,l=i<131,o=A==c&&8==C||A==c&&C==n&&I[7].length<=g[8]||384==A&&g[7].length<=g[8]&&8==C;if(!l&&!o)return I;1&A&&(I[2]=g[2],i|=1&C?0:4);var t=g[3];if(t){var d=I[3];I[3]=d?Wi(d,t,g[4]):t,I[4]=d?oC(I[3],e):g[4]}(t=g[5])&&(d=I[5],I[5]=d?Hi(d,t,g[6]):t,I[6]=d?oC(I[5],e):g[6]);(t=g[7])&&(I[7]=t);A&c&&(I[8]=null==I[8]?g[8]:hC(I[8],g[8]));null==I[9]&&(I[9]=g[9]);I[0]=g[0],I[1]=i}(y,u),I=y[0],g=y[1],i=y[2],d=y[3],s=y[4],!(m=y[9]=y[9]===C?b?0:I.length:rC(y[9]-r,0))&&24&g&&(g&=-25),g&&1!=g)B=8==g||g==l?function(I,g,A){var i=Ni(I);return function e(){for(var l=arguments.length,o=eI(l),t=l,c=le(e);t--;)o[t]=arguments[t];var n=l<3&&o[0]!==c&&o[l-1]!==c?[]:oC(o,c);return(l-=n.length)<A?Pi(I,g,Di,e.placeholder,C,o,n,C,C,A-l):Vg(this&&this!==dg&&this instanceof e?i:I,this,o)}}(I,g,m):g!=o&&33!=g||s.length?Di.apply(C,y):function(I,g,C,A){var i=1&g,e=Ni(I);return function g(){for(var l=-1,o=arguments.length,t=-1,c=A.length,n=eI(c+o),d=this&&this!==dg&&this instanceof g?e:I;++t<c;)n[t]=A[t];for(;o--;)n[t++]=arguments[++l];return Vg(d,i?C:this,n)}}(I,g,i,d);else var B=function(I,g,C){var A=1&g,i=Ni(I);return function g(){return(this&&this!==dg&&this instanceof g?i:I).apply(A?C:this,arguments)}}(I,g,i);return we((u?qA:Re)(B,y),I,g)}function _i(I,g,A,i){return I===C||Dl(I,wI[A])&&!FI.call(i,A)?g:I}function $i(I,g,A,i,e,l){return ql(I)&&ql(g)&&(l.set(g,I),MA(I,g,C,$i,l),l.delete(g)),I}function qi(I){return Ao(I)?C:I}function Ie(I,g,A,i,e,l){var o=1&A,t=I.length,c=g.length;if(t!=c&&!(o&&c>t))return!1;var n=l.get(I),d=l.get(g);if(n&&d)return n==g&&d==I;var s=-1,a=!0,Z=2&A?new OC:C;for(l.set(I,g),l.set(g,I);++s<t;){var m=I[s],b=g[s];if(i)var r=o?i(b,m,s,g,I,l):i(m,b,s,I,g,l);if(r!==C){if(r)continue;a=!1;break}if(Z){if(!Fg(g,(function(I,g){if(!_g(Z,g)&&(m===I||e(m,I,A,i,l)))return Z.push(g)}))){a=!1;break}}else if(m!==b&&!e(m,b,A,i,l)){a=!1;break}}return l.delete(I),l.delete(g),a}function ge(I){return Ke(Xe(I,C,Te),I+"")}function Ce(I){return VA(I,Ko,de)}function Ae(I){return VA(I,wo,se)}var ie=RC?function(I){return RC.get(I)}:tt;function ee(I){for(var g=I.name+"",C=fC[g],A=FI.call(fC,g)?C.length:0;A--;){var i=C[A],e=i.func;if(null==e||e==I)return i.name}return g}function le(I){return(FI.call(DC,"placeholder")?DC:I).placeholder}function oe(){var I=DC.iteratee||it;return I=I===it?SA:I,arguments.length?I(arguments[0],arguments[1]):I}function te(I,g){var C=I.__data__;return function(I){var g=typeof I;return"string"==g||"number"==g||"symbol"==g||"boolean"==g?"__proto__"!==I:null===I}(g)?C["string"==typeof g?"string":"hash"]:C.map}function ce(I){for(var g=Ko(I),C=g.length;C--;){var A=g[C],i=I[A];g[C]=[A,i,Ve(i)]}return g}function ne(I,g){var A=function(I,g){return null==I?C:I[g]}(I,g);return JA(A)?A:C}var de=Ng?function(I){return null==I?[]:(I=WI(I),Yg(Ng(I),(function(g){return jI.call(I,g)})))}:mt,se=Ng?function(I){for(var g=[];I;)wg(g,de(I)),I=PI(I);return g}:mt,ae=pA;function Ze(I,g,C){for(var A=-1,i=(g=hi(g,I)).length,e=!1;++A<i;){var l=Ne(g[A]);if(!(e=null!=I&&C(I,l)))break;I=I[l]}return e||++A!=i?e:!!(i=null==I?0:I.length)&&$l(i)&&re(l,i)&&(xl(I)||Ul(I))}function me(I){return"function"!=typeof I.constructor||Be(I)?{}:zC(PI(I))}function be(I){return xl(I)||Ul(I)||!!($I&&I&&I[$I])}function re(I,g){var C=typeof I;return!!(g=null==g?s:g)&&("number"==C||"symbol"!=C&&hI.test(I))&&I>-1&&I%1==0&&I<g}function he(I,g,C){if(!ql(C))return!1;var A=typeof g;return!!("number"==A?Ql(C)&&re(g,C.length):"string"==A&&g in C)&&Dl(C[g],I)}function Ge(I,g){if(xl(I))return!1;var C=typeof I;return!("number"!=C&&"symbol"!=C&&"boolean"!=C&&null!=I&&!oo(I))||(II.test(I)||!q.test(I)||null!=g&&I in WI(g))}function ue(I){var g=ee(I),C=DC[g];if("function"!=typeof C||!(g in xC.prototype))return!1;if(I===C)return!0;var A=ie(C);return!!A&&I===A[0]}(VC&&ae(new VC(new ArrayBuffer(1)))!=J||pC&&ae(new pC)!=V||XC&&ae(XC.resolve())!=W||WC&&ae(new WC)!=Y||HC&&ae(new HC)!=K)&&(ae=function(I){var g=pA(I),A=g==X?I.constructor:C,i=A?ve(A):"";if(i)switch(i){case KC:return J;case wC:return V;case JC:return W;case SC:return Y;case FC:return K}return g});var ye=JI?El:bt;function Be(I){var g=I&&I.constructor;return I===("function"==typeof g&&g.prototype||wI)}function Ve(I){return I===I&&!ql(I)}function pe(I,g){return function(A){return null!=A&&(A[I]===g&&(g!==C||I in WI(A)))}}function Xe(I,g,A){return g=rC(g===C?I.length-1:g,0),function(){for(var C=arguments,i=-1,e=rC(C.length-g,0),l=eI(e);++i<e;)l[i]=C[g+i];i=-1;for(var o=eI(g+1);++i<g;)o[i]=C[i];return o[g]=A(l),Vg(I,this,o)}}function We(I,g){return g.length<2?I:BA(I,Ci(g,0,-1))}function He(I,g){for(var A=I.length,i=hC(g.length,A),e=Yi(I);i--;){var l=g[i];I[i]=re(l,A)?e[l]:C}return I}function Ye(I,g){if(("constructor"!==g||"function"!==typeof I[g])&&"__proto__"!=g)return I[g]}var Re=Je(qA),fe=ag||function(I,g){return dg.setTimeout(I,g)},Ke=Je(Ii);function we(I,g,C){var A=g+"";return Ke(I,function(I,g){var C=g.length;if(!C)return I;var A=C-1;return g[A]=(C>1?"& ":"")+g[A],g=g.join(C>2?", ":" "),I.replace(lI,"{\n/* [wrapped with "+g+"] */\n")}(A,function(I,g){return Xg(m,(function(C){var A="_."+C[0];g&C[1]&&!Rg(I,A)&&I.push(A)})),I.sort()}(function(I){var g=I.match(oI);return g?g[1].split(tI):[]}(A),C)))}function Je(I){var g=0,A=0;return function(){var i=GC(),e=16-(i-A);if(A=i,e>0){if(++g>=800)return arguments[0]}else g=0;return I.apply(C,arguments)}}function Se(I,g){var A=-1,i=I.length,e=i-1;for(g=g===C?i:g;++A<g;){var l=OA(A,e),o=I[l];I[l]=I[A],I[A]=o}return I.length=g,I}var Fe=function(I){var g=Jl(I,(function(I){return 500===C.size&&C.clear(),I})),C=g.cache;return g}((function(I){var g=[];return 46===I.charCodeAt(0)&&g.push(""),I.replace(gI,(function(I,C,A,i){g.push(A?i.replace(dI,"$1"):C||I)})),g}));function Ne(I){if("string"==typeof I||oo(I))return I;var g=I+"";return"0"==g&&1/I==-1/0?"-0":g}function ve(I){if(null!=I){try{return SI.call(I)}catch(im){}try{return I+""}catch(im){}}return""}function ke(I){if(I instanceof xC)return I.clone();var g=new UC(I.__wrapped__,I.__chain__);return g.__actions__=Yi(I.__actions__),g.__index__=I.__index__,g.__values__=I.__values__,g}var De=LA((function(I,g){return Pl(I)?nA(I,bA(g,1,Pl,!0)):[]})),ze=LA((function(I,g){var A=Le(g);return Pl(A)&&(A=C),Pl(I)?nA(I,bA(g,1,Pl,!0),oe(A,2)):[]})),Me=LA((function(I,g){var A=Le(g);return Pl(A)&&(A=C),Pl(I)?nA(I,bA(g,1,Pl,!0),C,A):[]}));function Ue(I,g,C){var A=null==I?0:I.length;if(!A)return-1;var i=null==C?0:Zo(C);return i<0&&(i=rC(A+i,0)),kg(I,oe(g,3),i)}function xe(I,g,A){var i=null==I?0:I.length;if(!i)return-1;var e=i-1;return A!==C&&(e=Zo(A),e=A<0?rC(i+e,0):hC(e,i-1)),kg(I,oe(g,3),e,!0)}function Te(I){return(null==I?0:I.length)?bA(I,1):[]}function Qe(I){return I&&I.length?I[0]:C}var Pe=LA((function(I){var g=Kg(I,bi);return g.length&&g[0]===I[0]?YA(g):[]})),Oe=LA((function(I){var g=Le(I),A=Kg(I,bi);return g===Le(A)?g=C:A.pop(),A.length&&A[0]===I[0]?YA(A,oe(g,2)):[]})),je=LA((function(I){var g=Le(I),A=Kg(I,bi);return(g="function"==typeof g?g:C)&&A.pop(),A.length&&A[0]===I[0]?YA(A,C,g):[]}));function Le(I){var g=null==I?0:I.length;return g?I[g-1]:C}var Ee=LA(_e);function _e(I,g){return I&&I.length&&g&&g.length?QA(I,g):I}var $e=ge((function(I,g){var C=null==I?0:I.length,A=eA(I,g);return PA(I,Kg(g,(function(I){return re(I,C)?+I:I})).sort(Xi)),A}));function qe(I){return null==I?I:BC.call(I)}var Il=LA((function(I){return ci(bA(I,1,Pl,!0))})),gl=LA((function(I){var g=Le(I);return Pl(g)&&(g=C),ci(bA(I,1,Pl,!0),oe(g,2))})),Cl=LA((function(I){var g=Le(I);return g="function"==typeof g?g:C,ci(bA(I,1,Pl,!0),C,g)}));function Al(I){if(!I||!I.length)return[];var g=0;return I=Yg(I,(function(I){if(Pl(I))return g=rC(I.length,g),!0})),Og(g,(function(g){return Kg(I,xg(g))}))}function il(I,g){if(!I||!I.length)return[];var A=Al(I);return null==g?A:Kg(A,(function(I){return Vg(g,C,I)}))}var el=LA((function(I,g){return Pl(I)?nA(I,g):[]})),ll=LA((function(I){return Zi(Yg(I,Pl))})),ol=LA((function(I){var g=Le(I);return Pl(g)&&(g=C),Zi(Yg(I,Pl),oe(g,2))})),tl=LA((function(I){var g=Le(I);return g="function"==typeof g?g:C,Zi(Yg(I,Pl),C,g)})),cl=LA(Al);var nl=LA((function(I){var g=I.length,A=g>1?I[g-1]:C;return A="function"==typeof A?(I.pop(),A):C,il(I,A)}));function dl(I){var g=DC(I);return g.__chain__=!0,g}function sl(I,g){return g(I)}var al=ge((function(I){var g=I.length,A=g?I[0]:0,i=this.__wrapped__,e=function(g){return eA(g,I)};return!(g>1||this.__actions__.length)&&i instanceof xC&&re(A)?((i=i.slice(A,+A+(g?1:0))).__actions__.push({func:sl,args:[e],thisArg:C}),new UC(i,this.__chain__).thru((function(I){return g&&!I.length&&I.push(C),I}))):this.thru(e)}));var Zl=fi((function(I,g,C){FI.call(I,C)?++I[C]:iA(I,C,1)}));var ml=vi(Ue),bl=vi(xe);function rl(I,g){return(xl(I)?Xg:dA)(I,oe(g,3))}function hl(I,g){return(xl(I)?Wg:sA)(I,oe(g,3))}var Gl=fi((function(I,g,C){FI.call(I,C)?I[C].push(g):iA(I,C,[g])}));var ul=LA((function(I,g,C){var A=-1,i="function"==typeof g,e=Ql(I)?eI(I.length):[];return dA(I,(function(I){e[++A]=i?Vg(g,I,C):RA(I,g,C)})),e})),yl=fi((function(I,g,C){iA(I,C,g)}));function Bl(I,g){return(xl(I)?Kg:kA)(I,oe(g,3))}var Vl=fi((function(I,g,C){I[C?0:1].push(g)}),(function(){return[[],[]]}));var pl=LA((function(I,g){if(null==I)return[];var C=g.length;return C>1&&he(I,g[0],g[1])?g=[]:C>2&&he(g[0],g[1],g[2])&&(g=[g[0]]),xA(I,bA(g,1),[])})),Xl=sg||function(){return dg.Date.now()};function Wl(I,g,A){return g=A?C:g,g=I&&null==g?I.length:g,Ei(I,c,C,C,C,C,g)}function Hl(I,g){var i;if("function"!=typeof g)throw new RI(A);return I=Zo(I),function(){return--I>0&&(i=g.apply(this,arguments)),I<=1&&(g=C),i}}var Yl=LA((function(I,g,C){var A=1;if(C.length){var i=oC(C,le(Yl));A|=o}return Ei(I,A,g,C,i)})),Rl=LA((function(I,g,C){var A=3;if(C.length){var i=oC(C,le(Rl));A|=o}return Ei(g,A,I,C,i)}));function fl(I,g,i){var e,l,o,t,c,n,d=0,s=!1,a=!1,Z=!0;if("function"!=typeof I)throw new RI(A);function m(g){var A=e,i=l;return e=l=C,d=g,t=I.apply(i,A)}function b(I){return d=I,c=fe(h,g),s?m(I):t}function r(I){var A=I-n;return n===C||A>=g||A<0||a&&I-d>=o}function h(){var I=Xl();if(r(I))return G(I);c=fe(h,function(I){var C=g-(I-n);return a?hC(C,o-(I-d)):C}(I))}function G(I){return c=C,Z&&e?m(I):(e=l=C,t)}function u(){var I=Xl(),A=r(I);if(e=arguments,l=this,n=I,A){if(c===C)return b(n);if(a)return yi(c),c=fe(h,g),m(n)}return c===C&&(c=fe(h,g)),t}return g=bo(g)||0,ql(i)&&(s=!!i.leading,o=(a="maxWait"in i)?rC(bo(i.maxWait)||0,g):o,Z="trailing"in i?!!i.trailing:Z),u.cancel=function(){c!==C&&yi(c),d=0,e=n=l=c=C},u.flush=function(){return c===C?t:G(Xl())},u}var Kl=LA((function(I,g){return cA(I,1,g)})),wl=LA((function(I,g,C){return cA(I,bo(g)||0,C)}));function Jl(I,g){if("function"!=typeof I||null!=g&&"function"!=typeof g)throw new RI(A);var C=function C(){var A=arguments,i=g?g.apply(this,A):A[0],e=C.cache;if(e.has(i))return e.get(i);var l=I.apply(this,A);return C.cache=e.set(i,l)||e,l};return C.cache=new(Jl.Cache||PC),C}function Sl(I){if("function"!=typeof I)throw new RI(A);return function(){var g=arguments;switch(g.length){case 0:return!I.call(this);case 1:return!I.call(this,g[0]);case 2:return!I.call(this,g[0],g[1]);case 3:return!I.call(this,g[0],g[1],g[2])}return!I.apply(this,g)}}Jl.Cache=PC;var Fl=Gi((function(I,g){var C=(g=1==g.length&&xl(g[0])?Kg(g[0],Lg(oe())):Kg(bA(g,1),Lg(oe()))).length;return LA((function(A){for(var i=-1,e=hC(A.length,C);++i<e;)A[i]=g[i].call(this,A[i]);return Vg(I,this,A)}))})),Nl=LA((function(I,g){var A=oC(g,le(Nl));return Ei(I,o,C,g,A)})),vl=LA((function(I,g){var A=oC(g,le(vl));return Ei(I,t,C,g,A)})),kl=ge((function(I,g){return Ei(I,n,C,C,C,g)}));function Dl(I,g){return I===g||I!==I&&g!==g}var zl=Qi(XA),Ml=Qi((function(I,g){return I>=g})),Ul=fA(function(){return arguments}())?fA:function(I){return Io(I)&&FI.call(I,"callee")&&!jI.call(I,"callee")},xl=eI.isArray,Tl=rg?Lg(rg):function(I){return Io(I)&&pA(I)==w};function Ql(I){return null!=I&&$l(I.length)&&!El(I)}function Pl(I){return Io(I)&&Ql(I)}var Ol=Tg||bt,jl=hg?Lg(hg):function(I){return Io(I)&&pA(I)==G};function Ll(I){if(!Io(I))return!1;var g=pA(I);return g==u||"[object DOMException]"==g||"string"==typeof I.message&&"string"==typeof I.name&&!Ao(I)}function El(I){if(!ql(I))return!1;var g=pA(I);return g==y||g==B||"[object AsyncFunction]"==g||"[object Proxy]"==g}function _l(I){return"number"==typeof I&&I==Zo(I)}function $l(I){return"number"==typeof I&&I>-1&&I%1==0&&I<=s}function ql(I){var g=typeof I;return null!=I&&("object"==g||"function"==g)}function Io(I){return null!=I&&"object"==typeof I}var go=Gg?Lg(Gg):function(I){return Io(I)&&ae(I)==V};function Co(I){return"number"==typeof I||Io(I)&&pA(I)==p}function Ao(I){if(!Io(I)||pA(I)!=X)return!1;var g=PI(I);if(null===g)return!0;var C=FI.call(g,"constructor")&&g.constructor;return"function"==typeof C&&C instanceof C&&SI.call(C)==DI}var io=ug?Lg(ug):function(I){return Io(I)&&pA(I)==H};var eo=yg?Lg(yg):function(I){return Io(I)&&ae(I)==Y};function lo(I){return"string"==typeof I||!xl(I)&&Io(I)&&pA(I)==R}function oo(I){return"symbol"==typeof I||Io(I)&&pA(I)==f}var to=Bg?Lg(Bg):function(I){return Io(I)&&$l(I.length)&&!!ig[pA(I)]};var co=Qi(vA),no=Qi((function(I,g){return I<=g}));function so(I){if(!I)return[];if(Ql(I))return lo(I)?nC(I):Yi(I);if(Ig&&I[Ig])return function(I){for(var g,C=[];!(g=I.next()).done;)C.push(g.value);return C}(I[Ig]());var g=ae(I);return(g==V?eC:g==Y?tC:zo)(I)}function ao(I){return I?(I=bo(I))===d||I===-1/0?17976931348623157e292*(I<0?-1:1):I===I?I:0:0===I?I:0}function Zo(I){var g=ao(I),C=g%1;return g===g?C?g-C:g:0}function mo(I){return I?lA(Zo(I),0,Z):0}function bo(I){if("number"==typeof I)return I;if(oo(I))return a;if(ql(I)){var g="function"==typeof I.valueOf?I.valueOf():I;I=ql(g)?g+"":g}if("string"!=typeof I)return 0===I?I:+I;I=jg(I);var C=mI.test(I);return C||rI.test(I)?tg(I.slice(2),C?2:8):ZI.test(I)?a:+I}function ro(I){return Ri(I,wo(I))}function ho(I){return null==I?"":ti(I)}var Go=Ki((function(I,g){if(Be(g)||Ql(g))Ri(g,Ko(g),I);else for(var C in g)FI.call(g,C)&&IA(I,C,g[C])})),uo=Ki((function(I,g){Ri(g,wo(g),I)})),yo=Ki((function(I,g,C,A){Ri(g,wo(g),I,A)})),Bo=Ki((function(I,g,C,A){Ri(g,Ko(g),I,A)})),Vo=ge(eA);var po=LA((function(I,g){I=WI(I);var A=-1,i=g.length,e=i>2?g[2]:C;for(e&&he(g[0],g[1],e)&&(i=1);++A<i;)for(var l=g[A],o=wo(l),t=-1,c=o.length;++t<c;){var n=o[t],d=I[n];(d===C||Dl(d,wI[n])&&!FI.call(I,n))&&(I[n]=l[n])}return I})),Xo=LA((function(I){return I.push(C,$i),Vg(So,C,I)}));function Wo(I,g,A){var i=null==I?C:BA(I,g);return i===C?A:i}function Ho(I,g){return null!=I&&Ze(I,g,HA)}var Yo=zi((function(I,g,C){null!=g&&"function"!=typeof g.toString&&(g=kI.call(g)),I[g]=C}),It(At)),Ro=zi((function(I,g,C){null!=g&&"function"!=typeof g.toString&&(g=kI.call(g)),FI.call(I,g)?I[g].push(C):I[g]=[C]}),oe),fo=LA(RA);function Ko(I){return Ql(I)?LC(I):FA(I)}function wo(I){return Ql(I)?LC(I,!0):NA(I)}var Jo=Ki((function(I,g,C){MA(I,g,C)})),So=Ki((function(I,g,C,A){MA(I,g,C,A)})),Fo=ge((function(I,g){var C={};if(null==I)return C;var A=!1;g=Kg(g,(function(g){return g=hi(g,I),A||(A=g.length>1),g})),Ri(I,Ae(I),C),A&&(C=oA(C,7,qi));for(var i=g.length;i--;)ni(C,g[i]);return C}));var No=ge((function(I,g){return null==I?{}:function(I,g){return TA(I,g,(function(g,C){return Ho(I,C)}))}(I,g)}));function vo(I,g){if(null==I)return{};var C=Kg(Ae(I),(function(I){return[I]}));return g=oe(g),TA(I,C,(function(I,C){return g(I,C[0])}))}var ko=Li(Ko),Do=Li(wo);function zo(I){return null==I?[]:Eg(I,Ko(I))}var Mo=Fi((function(I,g,C){return g=g.toLowerCase(),I+(C?Uo(g):g)}));function Uo(I){return Eo(ho(I).toLowerCase())}function xo(I){return(I=ho(I))&&I.replace(GI,gC).replace(_I,"")}var To=Fi((function(I,g,C){return I+(C?"-":"")+g.toLowerCase()})),Qo=Fi((function(I,g,C){return I+(C?" ":"")+g.toLowerCase()})),Po=Si("toLowerCase");var Oo=Fi((function(I,g,C){return I+(C?"_":"")+g.toLowerCase()}));var jo=Fi((function(I,g,C){return I+(C?" ":"")+Eo(g)}));var Lo=Fi((function(I,g,C){return I+(C?" ":"")+g.toUpperCase()})),Eo=Si("toUpperCase");function _o(I,g,A){return I=ho(I),(g=A?C:g)===C?function(I){return gg.test(I)}(I)?function(I){return I.match(qI)||[]}(I):function(I){return I.match(cI)||[]}(I):I.match(g)||[]}var $o=LA((function(I,g){try{return Vg(I,C,g)}catch(im){return Ll(im)?im:new VI(im)}})),qo=ge((function(I,g){return Xg(g,(function(g){g=Ne(g),iA(I,g,Yl(I[g],I))})),I}));function It(I){return function(){return I}}var gt=ki(),Ct=ki(!0);function At(I){return I}function it(I){return SA("function"==typeof I?I:oA(I,1))}var et=LA((function(I,g){return function(C){return RA(C,I,g)}})),lt=LA((function(I,g){return function(C){return RA(I,C,g)}}));function ot(I,g,C){var A=Ko(g),i=yA(g,A);null!=C||ql(g)&&(i.length||!A.length)||(C=g,g=I,I=this,i=yA(g,Ko(g)));var e=!(ql(C)&&"chain"in C)||!!C.chain,l=El(I);return Xg(i,(function(C){var A=g[C];I[C]=A,l&&(I.prototype[C]=function(){var g=this.__chain__;if(e||g){var C=I(this.__wrapped__),i=C.__actions__=Yi(this.__actions__);return i.push({func:A,args:arguments,thisArg:I}),C.__chain__=g,C}return A.apply(I,wg([this.value()],arguments))})})),I}function tt(){}var ct=Ui(Kg),nt=Ui(Hg),dt=Ui(Fg);function st(I){return Ge(I)?xg(Ne(I)):function(I){return function(g){return BA(g,I)}}(I)}var at=Ti(),Zt=Ti(!0);function mt(){return[]}function bt(){return!1}var rt=Mi((function(I,g){return I+g}),0),ht=Oi("ceil"),Gt=Mi((function(I,g){return I/g}),1),ut=Oi("floor");var yt=Mi((function(I,g){return I*g}),1),Bt=Oi("round"),Vt=Mi((function(I,g){return I-g}),0);return DC.after=function(I,g){if("function"!=typeof g)throw new RI(A);return I=Zo(I),function(){if(--I<1)return g.apply(this,arguments)}},DC.ary=Wl,DC.assign=Go,DC.assignIn=uo,DC.assignInWith=yo,DC.assignWith=Bo,DC.at=Vo,DC.before=Hl,DC.bind=Yl,DC.bindAll=qo,DC.bindKey=Rl,DC.castArray=function(){if(!arguments.length)return[];var I=arguments[0];return xl(I)?I:[I]},DC.chain=dl,DC.chunk=function(I,g,A){g=(A?he(I,g,A):g===C)?1:rC(Zo(g),0);var i=null==I?0:I.length;if(!i||g<1)return[];for(var e=0,l=0,o=eI(mg(i/g));e<i;)o[l++]=Ci(I,e,e+=g);return o},DC.compact=function(I){for(var g=-1,C=null==I?0:I.length,A=0,i=[];++g<C;){var e=I[g];e&&(i[A++]=e)}return i},DC.concat=function(){var I=arguments.length;if(!I)return[];for(var g=eI(I-1),C=arguments[0],A=I;A--;)g[A-1]=arguments[A];return wg(xl(C)?Yi(C):[C],bA(g,1))},DC.cond=function(I){var g=null==I?0:I.length,C=oe();return I=g?Kg(I,(function(I){if("function"!=typeof I[1])throw new RI(A);return[C(I[0]),I[1]]})):[],LA((function(C){for(var A=-1;++A<g;){var i=I[A];if(Vg(i[0],this,C))return Vg(i[1],this,C)}}))},DC.conforms=function(I){return function(I){var g=Ko(I);return function(C){return tA(C,I,g)}}(oA(I,1))},DC.constant=It,DC.countBy=Zl,DC.create=function(I,g){var C=zC(I);return null==g?C:AA(C,g)},DC.curry=function I(g,A,i){var e=Ei(g,8,C,C,C,C,C,A=i?C:A);return e.placeholder=I.placeholder,e},DC.curryRight=function I(g,A,i){var e=Ei(g,l,C,C,C,C,C,A=i?C:A);return e.placeholder=I.placeholder,e},DC.debounce=fl,DC.defaults=po,DC.defaultsDeep=Xo,DC.defer=Kl,DC.delay=wl,DC.difference=De,DC.differenceBy=ze,DC.differenceWith=Me,DC.drop=function(I,g,A){var i=null==I?0:I.length;return i?Ci(I,(g=A||g===C?1:Zo(g))<0?0:g,i):[]},DC.dropRight=function(I,g,A){var i=null==I?0:I.length;return i?Ci(I,0,(g=i-(g=A||g===C?1:Zo(g)))<0?0:g):[]},DC.dropRightWhile=function(I,g){return I&&I.length?si(I,oe(g,3),!0,!0):[]},DC.dropWhile=function(I,g){return I&&I.length?si(I,oe(g,3),!0):[]},DC.fill=function(I,g,A,i){var e=null==I?0:I.length;return e?(A&&"number"!=typeof A&&he(I,g,A)&&(A=0,i=e),function(I,g,A,i){var e=I.length;for((A=Zo(A))<0&&(A=-A>e?0:e+A),(i=i===C||i>e?e:Zo(i))<0&&(i+=e),i=A>i?0:mo(i);A<i;)I[A++]=g;return I}(I,g,A,i)):[]},DC.filter=function(I,g){return(xl(I)?Yg:mA)(I,oe(g,3))},DC.flatMap=function(I,g){return bA(Bl(I,g),1)},DC.flatMapDeep=function(I,g){return bA(Bl(I,g),d)},DC.flatMapDepth=function(I,g,A){return A=A===C?1:Zo(A),bA(Bl(I,g),A)},DC.flatten=Te,DC.flattenDeep=function(I){return(null==I?0:I.length)?bA(I,d):[]},DC.flattenDepth=function(I,g){return(null==I?0:I.length)?bA(I,g=g===C?1:Zo(g)):[]},DC.flip=function(I){return Ei(I,512)},DC.flow=gt,DC.flowRight=Ct,DC.fromPairs=function(I){for(var g=-1,C=null==I?0:I.length,A={};++g<C;){var i=I[g];A[i[0]]=i[1]}return A},DC.functions=function(I){return null==I?[]:yA(I,Ko(I))},DC.functionsIn=function(I){return null==I?[]:yA(I,wo(I))},DC.groupBy=Gl,DC.initial=function(I){return(null==I?0:I.length)?Ci(I,0,-1):[]},DC.intersection=Pe,DC.intersectionBy=Oe,DC.intersectionWith=je,DC.invert=Yo,DC.invertBy=Ro,DC.invokeMap=ul,DC.iteratee=it,DC.keyBy=yl,DC.keys=Ko,DC.keysIn=wo,DC.map=Bl,DC.mapKeys=function(I,g){var C={};return g=oe(g,3),GA(I,(function(I,A,i){iA(C,g(I,A,i),I)})),C},DC.mapValues=function(I,g){var C={};return g=oe(g,3),GA(I,(function(I,A,i){iA(C,A,g(I,A,i))})),C},DC.matches=function(I){return DA(oA(I,1))},DC.matchesProperty=function(I,g){return zA(I,oA(g,1))},DC.memoize=Jl,DC.merge=Jo,DC.mergeWith=So,DC.method=et,DC.methodOf=lt,DC.mixin=ot,DC.negate=Sl,DC.nthArg=function(I){return I=Zo(I),LA((function(g){return UA(g,I)}))},DC.omit=Fo,DC.omitBy=function(I,g){return vo(I,Sl(oe(g)))},DC.once=function(I){return Hl(2,I)},DC.orderBy=function(I,g,A,i){return null==I?[]:(xl(g)||(g=null==g?[]:[g]),xl(A=i?C:A)||(A=null==A?[]:[A]),xA(I,g,A))},DC.over=ct,DC.overArgs=Fl,DC.overEvery=nt,DC.overSome=dt,DC.partial=Nl,DC.partialRight=vl,DC.partition=Vl,DC.pick=No,DC.pickBy=vo,DC.property=st,DC.propertyOf=function(I){return function(g){return null==I?C:BA(I,g)}},DC.pull=Ee,DC.pullAll=_e,DC.pullAllBy=function(I,g,C){return I&&I.length&&g&&g.length?QA(I,g,oe(C,2)):I},DC.pullAllWith=function(I,g,A){return I&&I.length&&g&&g.length?QA(I,g,C,A):I},DC.pullAt=$e,DC.range=at,DC.rangeRight=Zt,DC.rearg=kl,DC.reject=function(I,g){return(xl(I)?Yg:mA)(I,Sl(oe(g,3)))},DC.remove=function(I,g){var C=[];if(!I||!I.length)return C;var A=-1,i=[],e=I.length;for(g=oe(g,3);++A<e;){var l=I[A];g(l,A,I)&&(C.push(l),i.push(A))}return PA(I,i),C},DC.rest=function(I,g){if("function"!=typeof I)throw new RI(A);return LA(I,g=g===C?g:Zo(g))},DC.reverse=qe,DC.sampleSize=function(I,g,A){return g=(A?he(I,g,A):g===C)?1:Zo(g),(xl(I)?_C:_A)(I,g)},DC.set=function(I,g,C){return null==I?I:$A(I,g,C)},DC.setWith=function(I,g,A,i){return i="function"==typeof i?i:C,null==I?I:$A(I,g,A,i)},DC.shuffle=function(I){return(xl(I)?$C:gi)(I)},DC.slice=function(I,g,A){var i=null==I?0:I.length;return i?(A&&"number"!=typeof A&&he(I,g,A)?(g=0,A=i):(g=null==g?0:Zo(g),A=A===C?i:Zo(A)),Ci(I,g,A)):[]},DC.sortBy=pl,DC.sortedUniq=function(I){return I&&I.length?li(I):[]},DC.sortedUniqBy=function(I,g){return I&&I.length?li(I,oe(g,2)):[]},DC.split=function(I,g,A){return A&&"number"!=typeof A&&he(I,g,A)&&(g=A=C),(A=A===C?Z:A>>>0)?(I=ho(I))&&("string"==typeof g||null!=g&&!io(g))&&!(g=ti(g))&&iC(I)?ui(nC(I),0,A):I.split(g,A):[]},DC.spread=function(I,g){if("function"!=typeof I)throw new RI(A);return g=null==g?0:rC(Zo(g),0),LA((function(C){var A=C[g],i=ui(C,0,g);return A&&wg(i,A),Vg(I,this,i)}))},DC.tail=function(I){var g=null==I?0:I.length;return g?Ci(I,1,g):[]},DC.take=function(I,g,A){return I&&I.length?Ci(I,0,(g=A||g===C?1:Zo(g))<0?0:g):[]},DC.takeRight=function(I,g,A){var i=null==I?0:I.length;return i?Ci(I,(g=i-(g=A||g===C?1:Zo(g)))<0?0:g,i):[]},DC.takeRightWhile=function(I,g){return I&&I.length?si(I,oe(g,3),!1,!0):[]},DC.takeWhile=function(I,g){return I&&I.length?si(I,oe(g,3)):[]},DC.tap=function(I,g){return g(I),I},DC.throttle=function(I,g,C){var i=!0,e=!0;if("function"!=typeof I)throw new RI(A);return ql(C)&&(i="leading"in C?!!C.leading:i,e="trailing"in C?!!C.trailing:e),fl(I,g,{leading:i,maxWait:g,trailing:e})},DC.thru=sl,DC.toArray=so,DC.toPairs=ko,DC.toPairsIn=Do,DC.toPath=function(I){return xl(I)?Kg(I,Ne):oo(I)?[I]:Yi(Fe(ho(I)))},DC.toPlainObject=ro,DC.transform=function(I,g,C){var A=xl(I),i=A||Ol(I)||to(I);if(g=oe(g,4),null==C){var e=I&&I.constructor;C=i?A?new e:[]:ql(I)&&El(e)?zC(PI(I)):{}}return(i?Xg:GA)(I,(function(I,A,i){return g(C,I,A,i)})),C},DC.unary=function(I){return Wl(I,1)},DC.union=Il,DC.unionBy=gl,DC.unionWith=Cl,DC.uniq=function(I){return I&&I.length?ci(I):[]},DC.uniqBy=function(I,g){return I&&I.length?ci(I,oe(g,2)):[]},DC.uniqWith=function(I,g){return g="function"==typeof g?g:C,I&&I.length?ci(I,C,g):[]},DC.unset=function(I,g){return null==I||ni(I,g)},DC.unzip=Al,DC.unzipWith=il,DC.update=function(I,g,C){return null==I?I:di(I,g,ri(C))},DC.updateWith=function(I,g,A,i){return i="function"==typeof i?i:C,null==I?I:di(I,g,ri(A),i)},DC.values=zo,DC.valuesIn=function(I){return null==I?[]:Eg(I,wo(I))},DC.without=el,DC.words=_o,DC.wrap=function(I,g){return Nl(ri(g),I)},DC.xor=ll,DC.xorBy=ol,DC.xorWith=tl,DC.zip=cl,DC.zipObject=function(I,g){return mi(I||[],g||[],IA)},DC.zipObjectDeep=function(I,g){return mi(I||[],g||[],$A)},DC.zipWith=nl,DC.entries=ko,DC.entriesIn=Do,DC.extend=uo,DC.extendWith=yo,ot(DC,DC),DC.add=rt,DC.attempt=$o,DC.camelCase=Mo,DC.capitalize=Uo,DC.ceil=ht,DC.clamp=function(I,g,A){return A===C&&(A=g,g=C),A!==C&&(A=(A=bo(A))===A?A:0),g!==C&&(g=(g=bo(g))===g?g:0),lA(bo(I),g,A)},DC.clone=function(I){return oA(I,4)},DC.cloneDeep=function(I){return oA(I,5)},DC.cloneDeepWith=function(I,g){return oA(I,5,g="function"==typeof g?g:C)},DC.cloneWith=function(I,g){return oA(I,4,g="function"==typeof g?g:C)},DC.conformsTo=function(I,g){return null==g||tA(I,g,Ko(g))},DC.deburr=xo,DC.defaultTo=function(I,g){return null==I||I!==I?g:I},DC.divide=Gt,DC.endsWith=function(I,g,A){I=ho(I),g=ti(g);var i=I.length,e=A=A===C?i:lA(Zo(A),0,i);return(A-=g.length)>=0&&I.slice(A,e)==g},DC.eq=Dl,DC.escape=function(I){return(I=ho(I))&&L.test(I)?I.replace(O,CC):I},DC.escapeRegExp=function(I){return(I=ho(I))&&AI.test(I)?I.replace(CI,"\\$&"):I},DC.every=function(I,g,A){var i=xl(I)?Hg:aA;return A&&he(I,g,A)&&(g=C),i(I,oe(g,3))},DC.find=ml,DC.findIndex=Ue,DC.findKey=function(I,g){return vg(I,oe(g,3),GA)},DC.findLast=bl,DC.findLastIndex=xe,DC.findLastKey=function(I,g){return vg(I,oe(g,3),uA)},DC.floor=ut,DC.forEach=rl,DC.forEachRight=hl,DC.forIn=function(I,g){return null==I?I:rA(I,oe(g,3),wo)},DC.forInRight=function(I,g){return null==I?I:hA(I,oe(g,3),wo)},DC.forOwn=function(I,g){return I&&GA(I,oe(g,3))},DC.forOwnRight=function(I,g){return I&&uA(I,oe(g,3))},DC.get=Wo,DC.gt=zl,DC.gte=Ml,DC.has=function(I,g){return null!=I&&Ze(I,g,WA)},DC.hasIn=Ho,DC.head=Qe,DC.identity=At,DC.includes=function(I,g,C,A){I=Ql(I)?I:zo(I),C=C&&!A?Zo(C):0;var i=I.length;return C<0&&(C=rC(i+C,0)),lo(I)?C<=i&&I.indexOf(g,C)>-1:!!i&&Dg(I,g,C)>-1},DC.indexOf=function(I,g,C){var A=null==I?0:I.length;if(!A)return-1;var i=null==C?0:Zo(C);return i<0&&(i=rC(A+i,0)),Dg(I,g,i)},DC.inRange=function(I,g,A){return g=ao(g),A===C?(A=g,g=0):A=ao(A),function(I,g,C){return I>=hC(g,C)&&I<rC(g,C)}(I=bo(I),g,A)},DC.invoke=fo,DC.isArguments=Ul,DC.isArray=xl,DC.isArrayBuffer=Tl,DC.isArrayLike=Ql,DC.isArrayLikeObject=Pl,DC.isBoolean=function(I){return!0===I||!1===I||Io(I)&&pA(I)==h},DC.isBuffer=Ol,DC.isDate=jl,DC.isElement=function(I){return Io(I)&&1===I.nodeType&&!Ao(I)},DC.isEmpty=function(I){if(null==I)return!0;if(Ql(I)&&(xl(I)||"string"==typeof I||"function"==typeof I.splice||Ol(I)||to(I)||Ul(I)))return!I.length;var g=ae(I);if(g==V||g==Y)return!I.size;if(Be(I))return!FA(I).length;for(var C in I)if(FI.call(I,C))return!1;return!0},DC.isEqual=function(I,g){return KA(I,g)},DC.isEqualWith=function(I,g,A){var i=(A="function"==typeof A?A:C)?A(I,g):C;return i===C?KA(I,g,C,A):!!i},DC.isError=Ll,DC.isFinite=function(I){return"number"==typeof I&&sC(I)},DC.isFunction=El,DC.isInteger=_l,DC.isLength=$l,DC.isMap=go,DC.isMatch=function(I,g){return I===g||wA(I,g,ce(g))},DC.isMatchWith=function(I,g,A){return A="function"==typeof A?A:C,wA(I,g,ce(g),A)},DC.isNaN=function(I){return Co(I)&&I!=+I},DC.isNative=function(I){if(ye(I))throw new VI("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return JA(I)},DC.isNil=function(I){return null==I},DC.isNull=function(I){return null===I},DC.isNumber=Co,DC.isObject=ql,DC.isObjectLike=Io,DC.isPlainObject=Ao,DC.isRegExp=io,DC.isSafeInteger=function(I){return _l(I)&&I>=-9007199254740991&&I<=s},DC.isSet=eo,DC.isString=lo,DC.isSymbol=oo,DC.isTypedArray=to,DC.isUndefined=function(I){return I===C},DC.isWeakMap=function(I){return Io(I)&&ae(I)==K},DC.isWeakSet=function(I){return Io(I)&&"[object WeakSet]"==pA(I)},DC.join=function(I,g){return null==I?"":mC.call(I,g)},DC.kebabCase=To,DC.last=Le,DC.lastIndexOf=function(I,g,A){var i=null==I?0:I.length;if(!i)return-1;var e=i;return A!==C&&(e=(e=Zo(A))<0?rC(i+e,0):hC(e,i-1)),g===g?function(I,g,C){for(var A=C+1;A--;)if(I[A]===g)return A;return A}(I,g,e):kg(I,Mg,e,!0)},DC.lowerCase=Qo,DC.lowerFirst=Po,DC.lt=co,DC.lte=no,DC.max=function(I){return I&&I.length?ZA(I,At,XA):C},DC.maxBy=function(I,g){return I&&I.length?ZA(I,oe(g,2),XA):C},DC.mean=function(I){return Ug(I,At)},DC.meanBy=function(I,g){return Ug(I,oe(g,2))},DC.min=function(I){return I&&I.length?ZA(I,At,vA):C},DC.minBy=function(I,g){return I&&I.length?ZA(I,oe(g,2),vA):C},DC.stubArray=mt,DC.stubFalse=bt,DC.stubObject=function(){return{}},DC.stubString=function(){return""},DC.stubTrue=function(){return!0},DC.multiply=yt,DC.nth=function(I,g){return I&&I.length?UA(I,Zo(g)):C},DC.noConflict=function(){return dg._===this&&(dg._=zI),this},DC.noop=tt,DC.now=Xl,DC.pad=function(I,g,C){I=ho(I);var A=(g=Zo(g))?cC(I):0;if(!g||A>=g)return I;var i=(g-A)/2;return xi(bg(i),C)+I+xi(mg(i),C)},DC.padEnd=function(I,g,C){I=ho(I);var A=(g=Zo(g))?cC(I):0;return g&&A<g?I+xi(g-A,C):I},DC.padStart=function(I,g,C){I=ho(I);var A=(g=Zo(g))?cC(I):0;return g&&A<g?xi(g-A,C)+I:I},DC.parseInt=function(I,g,C){return C||null==g?g=0:g&&(g=+g),uC(ho(I).replace(iI,""),g||0)},DC.random=function(I,g,A){if(A&&"boolean"!=typeof A&&he(I,g,A)&&(g=A=C),A===C&&("boolean"==typeof g?(A=g,g=C):"boolean"==typeof I&&(A=I,I=C)),I===C&&g===C?(I=0,g=1):(I=ao(I),g===C?(g=I,I=0):g=ao(g)),I>g){var i=I;I=g,g=i}if(A||I%1||g%1){var e=yC();return hC(I+e*(g-I+og("1e-"+((e+"").length-1))),g)}return OA(I,g)},DC.reduce=function(I,g,C){var A=xl(I)?Jg:Qg,i=arguments.length<3;return A(I,oe(g,4),C,i,dA)},DC.reduceRight=function(I,g,C){var A=xl(I)?Sg:Qg,i=arguments.length<3;return A(I,oe(g,4),C,i,sA)},DC.repeat=function(I,g,A){return g=(A?he(I,g,A):g===C)?1:Zo(g),jA(ho(I),g)},DC.replace=function(){var I=arguments,g=ho(I[0]);return I.length<3?g:g.replace(I[1],I[2])},DC.result=function(I,g,A){var i=-1,e=(g=hi(g,I)).length;for(e||(e=1,I=C);++i<e;){var l=null==I?C:I[Ne(g[i])];l===C&&(i=e,l=A),I=El(l)?l.call(I):l}return I},DC.round=Bt,DC.runInContext=I,DC.sample=function(I){return(xl(I)?EC:EA)(I)},DC.size=function(I){if(null==I)return 0;if(Ql(I))return lo(I)?cC(I):I.length;var g=ae(I);return g==V||g==Y?I.size:FA(I).length},DC.snakeCase=Oo,DC.some=function(I,g,A){var i=xl(I)?Fg:Ai;return A&&he(I,g,A)&&(g=C),i(I,oe(g,3))},DC.sortedIndex=function(I,g){return ii(I,g)},DC.sortedIndexBy=function(I,g,C){return ei(I,g,oe(C,2))},DC.sortedIndexOf=function(I,g){var C=null==I?0:I.length;if(C){var A=ii(I,g);if(A<C&&Dl(I[A],g))return A}return-1},DC.sortedLastIndex=function(I,g){return ii(I,g,!0)},DC.sortedLastIndexBy=function(I,g,C){return ei(I,g,oe(C,2),!0)},DC.sortedLastIndexOf=function(I,g){if(null==I?0:I.length){var C=ii(I,g,!0)-1;if(Dl(I[C],g))return C}return-1},DC.startCase=jo,DC.startsWith=function(I,g,C){return I=ho(I),C=null==C?0:lA(Zo(C),0,I.length),g=ti(g),I.slice(C,C+g.length)==g},DC.subtract=Vt,DC.sum=function(I){return I&&I.length?Pg(I,At):0},DC.sumBy=function(I,g){return I&&I.length?Pg(I,oe(g,2)):0},DC.template=function(I,g,A){var i=DC.templateSettings;A&&he(I,g,A)&&(g=C),I=ho(I),g=yo({},g,i,_i);var e,l,o=yo({},g.imports,i.imports,_i),t=Ko(o),c=Eg(o,t),n=0,d=g.interpolate||uI,s="__p += '",a=HI((g.escape||uI).source+"|"+d.source+"|"+(d===$?sI:uI).source+"|"+(g.evaluate||uI).source+"|$","g"),Z="//# sourceURL="+(FI.call(g,"sourceURL")?(g.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ag+"]")+"\n";I.replace(a,(function(g,C,A,i,o,t){return A||(A=i),s+=I.slice(n,t).replace(yI,AC),C&&(e=!0,s+="' +\n__e("+C+") +\n'"),o&&(l=!0,s+="';\n"+o+";\n__p += '"),A&&(s+="' +\n((__t = ("+A+")) == null ? '' : __t) +\n'"),n=t+g.length,g})),s+="';\n";var m=FI.call(g,"variable")&&g.variable;if(m){if(nI.test(m))throw new VI("Invalid `variable` option passed into `_.template`")}else s="with (obj) {\n"+s+"\n}\n";s=(l?s.replace(x,""):s).replace(T,"$1").replace(Q,"$1;"),s="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(e?", __e = _.escape":"")+(l?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+s+"return __p\n}";var b=$o((function(){return pI(t,Z+"return "+s).apply(C,c)}));if(b.source=s,Ll(b))throw b;return b},DC.times=function(I,g){if((I=Zo(I))<1||I>s)return[];var C=Z,A=hC(I,Z);g=oe(g),I-=Z;for(var i=Og(A,g);++C<I;)g(C);return i},DC.toFinite=ao,DC.toInteger=Zo,DC.toLength=mo,DC.toLower=function(I){return ho(I).toLowerCase()},DC.toNumber=bo,DC.toSafeInteger=function(I){return I?lA(Zo(I),-9007199254740991,s):0===I?I:0},DC.toString=ho,DC.toUpper=function(I){return ho(I).toUpperCase()},DC.trim=function(I,g,A){if((I=ho(I))&&(A||g===C))return jg(I);if(!I||!(g=ti(g)))return I;var i=nC(I),e=nC(g);return ui(i,$g(i,e),qg(i,e)+1).join("")},DC.trimEnd=function(I,g,A){if((I=ho(I))&&(A||g===C))return I.slice(0,dC(I)+1);if(!I||!(g=ti(g)))return I;var i=nC(I);return ui(i,0,qg(i,nC(g))+1).join("")},DC.trimStart=function(I,g,A){if((I=ho(I))&&(A||g===C))return I.replace(iI,"");if(!I||!(g=ti(g)))return I;var i=nC(I);return ui(i,$g(i,nC(g))).join("")},DC.truncate=function(I,g){var A=30,i="...";if(ql(g)){var e="separator"in g?g.separator:e;A="length"in g?Zo(g.length):A,i="omission"in g?ti(g.omission):i}var l=(I=ho(I)).length;if(iC(I)){var o=nC(I);l=o.length}if(A>=l)return I;var t=A-cC(i);if(t<1)return i;var c=o?ui(o,0,t).join(""):I.slice(0,t);if(e===C)return c+i;if(o&&(t+=c.length-t),io(e)){if(I.slice(t).search(e)){var n,d=c;for(e.global||(e=HI(e.source,ho(aI.exec(e))+"g")),e.lastIndex=0;n=e.exec(d);)var s=n.index;c=c.slice(0,s===C?t:s)}}else if(I.indexOf(ti(e),t)!=t){var a=c.lastIndexOf(e);a>-1&&(c=c.slice(0,a))}return c+i},DC.unescape=function(I){return(I=ho(I))&&j.test(I)?I.replace(P,aC):I},DC.uniqueId=function(I){var g=++NI;return ho(I)+g},DC.upperCase=Lo,DC.upperFirst=Eo,DC.each=rl,DC.eachRight=hl,DC.first=Qe,ot(DC,function(){var I={};return GA(DC,(function(g,C){FI.call(DC.prototype,C)||(I[C]=g)})),I}(),{chain:!1}),DC.VERSION="4.17.21",Xg(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(I){DC[I].placeholder=DC})),Xg(["drop","take"],(function(I,g){xC.prototype[I]=function(A){A=A===C?1:rC(Zo(A),0);var i=this.__filtered__&&!g?new xC(this):this.clone();return i.__filtered__?i.__takeCount__=hC(A,i.__takeCount__):i.__views__.push({size:hC(A,Z),type:I+(i.__dir__<0?"Right":"")}),i},xC.prototype[I+"Right"]=function(g){return this.reverse()[I](g).reverse()}})),Xg(["filter","map","takeWhile"],(function(I,g){var C=g+1,A=1==C||3==C;xC.prototype[I]=function(I){var g=this.clone();return g.__iteratees__.push({iteratee:oe(I,3),type:C}),g.__filtered__=g.__filtered__||A,g}})),Xg(["head","last"],(function(I,g){var C="take"+(g?"Right":"");xC.prototype[I]=function(){return this[C](1).value()[0]}})),Xg(["initial","tail"],(function(I,g){var C="drop"+(g?"":"Right");xC.prototype[I]=function(){return this.__filtered__?new xC(this):this[C](1)}})),xC.prototype.compact=function(){return this.filter(At)},xC.prototype.find=function(I){return this.filter(I).head()},xC.prototype.findLast=function(I){return this.reverse().find(I)},xC.prototype.invokeMap=LA((function(I,g){return"function"==typeof I?new xC(this):this.map((function(C){return RA(C,I,g)}))})),xC.prototype.reject=function(I){return this.filter(Sl(oe(I)))},xC.prototype.slice=function(I,g){I=Zo(I);var A=this;return A.__filtered__&&(I>0||g<0)?new xC(A):(I<0?A=A.takeRight(-I):I&&(A=A.drop(I)),g!==C&&(A=(g=Zo(g))<0?A.dropRight(-g):A.take(g-I)),A)},xC.prototype.takeRightWhile=function(I){return this.reverse().takeWhile(I).reverse()},xC.prototype.toArray=function(){return this.take(Z)},GA(xC.prototype,(function(I,g){var A=/^(?:filter|find|map|reject)|While$/.test(g),i=/^(?:head|last)$/.test(g),e=DC[i?"take"+("last"==g?"Right":""):g],l=i||/^find/.test(g);e&&(DC.prototype[g]=function(){var g=this.__wrapped__,o=i?[1]:arguments,t=g instanceof xC,c=o[0],n=t||xl(g),d=function(I){var g=e.apply(DC,wg([I],o));return i&&s?g[0]:g};n&&A&&"function"==typeof c&&1!=c.length&&(t=n=!1);var s=this.__chain__,a=!!this.__actions__.length,Z=l&&!s,m=t&&!a;if(!l&&n){g=m?g:new xC(this);var b=I.apply(g,o);return b.__actions__.push({func:sl,args:[d],thisArg:C}),new UC(b,s)}return Z&&m?I.apply(this,o):(b=this.thru(d),Z?i?b.value()[0]:b.value():b)})})),Xg(["pop","push","shift","sort","splice","unshift"],(function(I){var g=fI[I],C=/^(?:push|sort|unshift)$/.test(I)?"tap":"thru",A=/^(?:pop|shift)$/.test(I);DC.prototype[I]=function(){var I=arguments;if(A&&!this.__chain__){var i=this.value();return g.apply(xl(i)?i:[],I)}return this[C]((function(C){return g.apply(xl(C)?C:[],I)}))}})),GA(xC.prototype,(function(I,g){var C=DC[g];if(C){var A=C.name+"";FI.call(fC,A)||(fC[A]=[]),fC[A].push({name:g,func:C})}})),fC[Di(C,2).name]=[{name:"wrapper",func:C}],xC.prototype.clone=function(){var I=new xC(this.__wrapped__);return I.__actions__=Yi(this.__actions__),I.__dir__=this.__dir__,I.__filtered__=this.__filtered__,I.__iteratees__=Yi(this.__iteratees__),I.__takeCount__=this.__takeCount__,I.__views__=Yi(this.__views__),I},xC.prototype.reverse=function(){if(this.__filtered__){var I=new xC(this);I.__dir__=-1,I.__filtered__=!0}else(I=this.clone()).__dir__*=-1;return I},xC.prototype.value=function(){var I=this.__wrapped__.value(),g=this.__dir__,C=xl(I),A=g<0,i=C?I.length:0,e=function(I,g,C){var A=-1,i=C.length;for(;++A<i;){var e=C[A],l=e.size;switch(e.type){case"drop":I+=l;break;case"dropRight":g-=l;break;case"take":g=hC(g,I+l);break;case"takeRight":I=rC(I,g-l)}}return{start:I,end:g}}(0,i,this.__views__),l=e.start,o=e.end,t=o-l,c=A?o:l-1,n=this.__iteratees__,d=n.length,s=0,a=hC(t,this.__takeCount__);if(!C||!A&&i==t&&a==t)return ai(I,this.__actions__);var Z=[];I:for(;t--&&s<a;){for(var m=-1,b=I[c+=g];++m<d;){var r=n[m],h=r.iteratee,G=r.type,u=h(b);if(2==G)b=u;else if(!u){if(1==G)continue I;break I}}Z[s++]=b}return Z},DC.prototype.at=al,DC.prototype.chain=function(){return dl(this)},DC.prototype.commit=function(){return new UC(this.value(),this.__chain__)},DC.prototype.next=function(){this.__values__===C&&(this.__values__=so(this.value()));var I=this.__index__>=this.__values__.length;return{done:I,value:I?C:this.__values__[this.__index__++]}},DC.prototype.plant=function(I){for(var g,A=this;A instanceof MC;){var i=ke(A);i.__index__=0,i.__values__=C,g?e.__wrapped__=i:g=i;var e=i;A=A.__wrapped__}return e.__wrapped__=I,g},DC.prototype.reverse=function(){var I=this.__wrapped__;if(I instanceof xC){var g=I;return this.__actions__.length&&(g=new xC(this)),(g=g.reverse()).__actions__.push({func:sl,args:[qe],thisArg:C}),new UC(g,this.__chain__)}return this.thru(qe)},DC.prototype.toJSON=DC.prototype.valueOf=DC.prototype.value=function(){return ai(this.__wrapped__,this.__actions__)},DC.prototype.first=DC.prototype.head,Ig&&(DC.prototype[Ig]=function(){return this}),DC}();ag?((ag.exports=ZC)._=ZC,sg._=ZC):dg._=ZC}).call(sC)}(gm,gm.exports);var Am=Object(lI.forwardRef)((function(I,g){var C,A,i,e=Object(lI.useState)(),l=Object(r.a)(e,2),o=l[0],t=l[1],c=Object(lI.useState)({width:200,height:200}),n=Object(r.a)(c,2),d=n[0],s=n[1],a=Object(lI.useRef)(),Z=Object(lI.useRef)(),m=Object(lI.useRef)(),b=Object(lI.useRef)(null),h=bZ(I.theme||"light"),G=null!=(C=I.id)?C:sg();Object(lI.useEffect)((function(){if(g&&(null==b?void 0:b.current)){var I=b.current,C=Im(I,o,h);"function"==typeof g?g({api:C,hgApi:I}):g.current={api:C,hgApi:I}}}),[o,h]);var u=Object(lI.useCallback)((function(){if(I.spec){if("error"===gZ(I.spec).state)return void console.warn("Gosling spec is not valid. Please refer to the console message.");EZ(I.spec,(function(g,C,A){var i,e;if(!m.current||!gm.exports.isEqual(Cm(m.current,["linkingId"]),Cm(A,["linkingId"]))){null==(i=I.compiled)||i.call(I,I.spec,g),s(C);var l="undefined"!==typeof o;(null==(e=I.experimental)?void 0:e.reactive)&&l?setTimeout((function(){var I;null==(I=b.current)||I.api.setViewConfig(g)}),300):t(g),m.current=A}}),[].concat(yg),h,{containerSize:a.current,containerParentSize:Z.current})}}),[I.spec,h]);Object(lI.useEffect)((function(){var I=document.getElementById(G);if(I){var g=new qZ(I,(function(I){a.current&&a.current.height===I.height&&a.current.width===I.width||(a.current=I,u())})),C=I.parentElement;if(C){var A=new qZ(C,(function(I){Z.current&&Z.current.height===I.height&&Z.current.width===I.width||(Z.current=I,u())}));return function(){g.detach(),A.detach()}}}})),Object(lI.useEffect)((function(){u()}),[I.spec,h]);var y="object"!==typeof(null==(A=I.spec)?void 0:A.responsiveSize)?null==(i=I.spec)?void 0:i.responsiveSize:I.spec.responsiveSize.height;return Object(lI.useMemo)((function(){var g,C,A;return oI.a.createElement(_Z,{ref:b,viewConfig:o,size:d,id:G,className:I.className,options:{padding:I.padding,border:I.border,margin:I.margin,responsiveWidth:"object"!==typeof(null==(g=I.spec)?void 0:g.responsiveSize)?null==(C=I.spec)?void 0:C.responsiveSize:I.spec.responsiveSize.width,responsiveHeight:y,background:h.root.background,alt:null==(A=I.spec)?void 0:A.description}})}),[o,d,h,y])}))}).call(this,C(65),C(70).Buffer)},244:function(I,g){},247:function(I,g){},336:function(I,g,C){},339:function(I,g,C){"use strict";C.r(g);var A=C(15),i=C.n(A),e=C(116),l=C.n(e),o=C(201),t=C(119),c=C(13),n=C(16),d=C(17),s=C(9),a=C(366),Z=C(216),m=[25,50,100,200,500,1e3,2e3,4e3,8e3,16e3,32e3,64e3,128e3],b=function(I,g,C){return C.chrPositions[I].pos+g};function r(I,g){var C={chrToAbs:function(){var I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],g=Object(s.a)(I,2),A=g[0],i=g[1];return C.chrPositions?b(A,i,C):null}};return Object(Z.a)(I,(function(I,A){if(I)g&&g(null);else{var i=function(I){for(var g=[],C={},A={},i=0,e=0;e<I.length;e++){var l=Number(I[e][1]);i+=l;var o={id:e,chr:I[e][0],pos:i-l};g.push(o),A[o.chr]=o,C[I[e][0]]=l}return{chrToAbs:function(I){var g=Object(s.a)(I,2),C=g[0],i=g[1];return b(C,i,{chrPositions:A})},cumPositions:g,chrPositions:A,totalLength:i,chromLengths:C}}(Object(a.b)(A));Object.keys(i).forEach((function(I){C[I]=i[I]})),g&&g(C)}}))}var h=function I(g){if(!(this instanceof I?this.constructor:void 0))throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');for(var C=function(){function I(g){Object(n.a)(this,I),this.dataConfig=g,this.bwFileHeader=null,this.bwFile=null,this.TILE_SIZE=1024,this.errorTxt="",this.dataPromises=[],this.dataPromises.push(this.loadChromsizes(g))}return Object(d.a)(I,[{key:"loadChromsizes",value:function(I){var g=this;return I.chromSizesUrl?new Promise((function(C){r(I.chromSizesUrl,(function(I){g.chromSizes=I,C()}))})):(console.error('Please enter a "chromSizesUrl" field to the data config'),null)}},{key:"tilesetInfo",value:function(I){var g=this;return this.tilesetInfoLoading=!0,Promise.all(this.dataPromises).then((function(){g.tilesetInfoLoading=!1;var C,A=g.chromSizes.totalLength;return C={tile_size:g.TILE_SIZE,max_zoom:Math.ceil(Math.log(A/g.TILE_SIZE)/Math.log(2)),max_width:Math.pow(2,Math.ceil(Math.log(A)/Math.log(2))),min_pos:[0],max_pos:[A]},I&&I(C),C})).catch((function(C){g.tilesetInfoLoading=!1,console.error(C),I&&I({error:"Error parsing bigwig: ".concat(C)})}))}},{key:"fetchTilesDebounced",value:function(I,g){var C,A={},i=[],e=[],l=Object(c.a)(g);try{for(l.s();!(C=l.n()).done;){var o=C.value,t=o.split("."),n=parseInt(t[0],10),d=parseInt(t[1],10);Number.isNaN(d)||Number.isNaN(n)?console.warn("Invalid tile zoom or position:",n,d):(i.push(o),e.push(this.tile(n,d)))}}catch(s){l.e(s)}finally{l.f()}return Promise.all(e).then((function(g){for(var C=0;C<g.length;C++){var e=i[C];A[e]=g[C],A[e].tilePositionId=e}I(A)})),A}},{key:"tile",value:function(I,g){var C=this;return this.tilesetInfo().then((function(A){for(var i=+A.max_width/Math.pow(2,+I),e=[],l={tilePos:[g],tileId:"bigwig."+I+"."+g,zoomLevel:I},o=A.min_pos[0]+g*i,t=o,c=A.min_pos[0]+(g+1)*i,n=function(I){var g=I/C.TILE_SIZE,A=m[m.length-1];return m.forEach((function(C){Math.abs(g-C)<Math.abs(g-A)&&I/C<500&&(A=C)})),A}(c-t),d=[],s=0;s<C.TILE_SIZE;s++)d.push(t+s*n);var a=C.chromSizes,Z=a.chromLengths,b=a.cumPositions,r=function(I,g,A,i){return fetch("http://develop.cistrome.org/cistrome/samples/".concat(C.dataConfig.cid,"/track?chrom=").concat(I,"&start_pos=").concat(g,"&end_pos=").concat(A,"&bin_length=").concat(n)).then((function(I){return I.json()})).then((function(I){var C=I.values,A=I.multiplier,e=I.bin_size;return C.map((function(I,C){return{value:I/A,start:i+g+C*e,end:i+g+(C+1)*e}}))}))};for(s=0;s<b.length;s++){var h=b[s].chr,G=b[s].pos,u=b[s].pos+Z[h],y=void 0,B=void 0;if(G<=t&&t<u){if(!(c>u)){if((c-t)/n>500)for(var V=Math.ceil((c-t)/n/500),p=Math.ceil((c-t)/V),X=0;t+p*X<c;X++)y=Math.floor(t+p*X-G),B=Math.ceil(t+Math.min(c,p*(X+1))-G),e.push(r(h,y,B,G));else y=Math.floor(t-G),B=Math.ceil(c-G),e.push(r(h,y,B,G));break}if((u-t)/n>500)for(var W=Math.ceil((u-t)/n/500),H=Math.ceil((u-t)/W),Y=0;t+H*Y<u;Y++)y=Math.floor(t+H*Y-G),B=Math.ceil(Math.min(u,t+H*(Y+1))-G),e.push(r(h,y,B,G));else y=t-G,B=u-G,e.push(r(h,y,B,G));t=u}}return Promise.all(e).then((function(I){for(var g=I.flat(),A=[],i=0;i<C.TILE_SIZE;i++)A.push(null);return d.forEach((function(I,C){if(!(I<o||I>c)){var i=g.filter((function(g){return I>=g.startAbs&&I<g.endAbs})).map((function(I){return I.score}));A[C]=i.length>0?i[0]:null}})),l.tabularData=g,l}))}))}},{key:"determineScale",value:function(I,g){var C=[1],A=g-I;this.bwFileHeader.zoomLevels.forEach((function(I){C.push(I.reductionLevel)}));for(var i=0;i<C.length;i++){var e=C[i];if(A/e<=20*this.TILE_SIZE)return e}return C.slice(-1)[0]}}]),I}(),A=arguments.length,i=new Array(A>1?A-1:0),e=1;e<A;e++)i[e-1]=arguments[e];return Object(t.a)(C,i)};h.config={type:"bigwig"};var G=h,u=C(215);Object(u.a)({dataFetcher:G,config:G.config},{pluginType:"dataFetcher",force:!0});var y=function(){return A.createElement(o.a,{spec:{tracks:[{data:{type:"experimentalPlugin",name:"bigwig",options:{cid:1,chromSizesUrl:"https://aveit.s3.amazonaws.com/higlass/data/sequence/hg38.chrom.sizes"}},title:"Gosling Track Based On Plugin Data-Fetcher",mark:"bar",x:{field:"start",type:"genomic"},xe:{field:"end",type:"genomic"},y:{field:"value",type:"quantitative",axis:"none"},color:{value:"#22908D"},tooltip:[{field:"start",type:"genomic"},{field:"end",type:"genomic"},{field:"value",type:"quantitative"}],style:{outlineWidth:0},width:600,height:100}]}})};C(336);l.a.render(i.a.createElement(y,null),document.getElementById("root"))}},[[339,1,2]]]);
//# sourceMappingURL=main.ce22009c.chunk.js.map